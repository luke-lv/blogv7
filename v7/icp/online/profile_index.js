if(typeof Sina=="undefined"){Sina={}}Sina.pkg=function(ns){if(!ns||!ns.length){return null}var levels=ns.split(".");var nsobj=Sina;for(var i=levels[0]=="Sina"?1:0;i<levels.length;++i){nsobj[levels[i]]=nsobj[levels[i]]||{};nsobj=nsobj[levels[i]]}return nsobj};function $E(oID){var node=typeof oID=="string"?document.getElementById(oID):oID;if(node!=null){return node}return null}function $C(tagName){return document.createElement(tagName)}function $N(name){return document.getElementsByName(name)}function $T(obj,tagName){return obj.getElementsByTagName(tagName)}try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}(function(){var bind=function(fFunction,object){var __method=fFunction;return function(){return __method.apply(object,arguments)}};var debug_namespace="Debug";if(window[debug_namespace]==null||typeof window[debug_namespace].log=="undefined"){window[debug_namespace]={cacheData:[],base_url:"http://sjs.sinajs.cn/bind2/",product:scope.$PRODUCT_NAME,baseColor:{1:{color:"#FFF",bgcolor:"#E00"},2:{color:"#F00"},3:{color:"#FFF000"},4:{color:"#0F0"},5:{color:"#FFF"}},fatal:function(sInfo){this.addData(sInfo,1)},error:function(sInfo){this.addData(sInfo,2)},warning:function(sInfo){this.addData(sInfo,3)},info:function(sInfo){this.addData(sInfo,4)},log:function(sInfo){this.addData(sInfo,5)},dir:function(oInfo){this.addData(oInfo,5)},addData:function(sInfo,nType,sColor,sBgColor){if(sInfo==null){return}if(typeof sInfo!="object"){sInfo=sInfo.toString()}var oOption={type:nType||"5",color:sColor||this.baseColor[nType].color,bgcolor:sBgColor||this.baseColor[nType].bgcolor};this.cacheData.push([sInfo,oOption]);if(this.initFinished==true){this.showCurrentData([sInfo,oOption])}}};window.trace=bind(window[debug_namespace].log,window[debug_namespace]);window.traceError=bind(window[debug_namespace].error,window[debug_namespace])}})();Sina.pkg("Core");if(typeof Core=="undefined"){Core=Sina.Core}Sina.pkg("Core.Array");Core.Array.foreach=function(ar,insp){if(ar==null&&ar.constructor!=Array){return[]}var i=0,len=ar.length,r=[];while(i<len){var x=insp(ar[i],i);if(x!==null){r[r.length]=x}i++}return r};Sina.pkg("Core.Events");(function(_s){var _ua=navigator.userAgent.toLowerCase();var system={$winXP:/windows nt 5.1/.test(_ua),$winVista:/windows nt 6.0/.test(_ua),$win7:/windows nt 6.1/.test(_ua),$macOS:/mac/.test(_ua)};var browser={$OPERA:false,$IE6:false,$IE7:false,$IE8:false,$IE9:false,$SAFARI:false,$FF2:false,$FF3:false,$FF4:false,$FF:false,$CHROME:false,$TT:false,$360:false,$SOGO:false,$Maxthon:false};var engine={$IE:0,$MOZ:false,$WEBKIT:false,$KHTML:false};if(/opera/.test(_ua)||_s.opera){browser.$OPERA=true}else if(/chrome\/(\S+)/.test(_ua)){browser.$CHROME=true}else if(/safari\/(\S+)/.test(_ua)){browser.$SAFARI=true}else if(/msie/.test(_ua)){engine.$IE=true;if(/360se/.test(_ua)){browser.$360=true}else if(/tencenttraveler/.test(_ua)){browser.$TT=true}else if(/se\s\S+\smetasr\s\d+\.\d+/.test(_ua)){browser.$SOGO=true}var uaVersionArray=_ua.match(/msie (\d+)/);var version=parseInt(uaVersionArray[1]);engine.$IE=version;if(version===8){browser.$IE8=true}else if(version===6){browser.$IE6=true}else if(version===9){browser.$IE9=true}else if(version===7){browser.$IE7=true}else if(version===10){browser.$IE10=true}}else if(/firefox/.test(_ua)){var uaVersionArray=_ua.match(/firefox\/(\d+)/);browser.$FF=parseInt(uaVersionArray[1]);if(/firefox\/3/.test(_ua)){browser.$FF3=true}else if(/firefox\/4/.test(_ua)){browser.$FF4=true}else if(/firefox\/2/.test(_ua)){browser.$FF2=true}}else if(/trident\/7.0/.test(_ua)&&/rv:11.0/.test(_ua)){engine.$IE=11;browser.$IE11=true}try{var t=window.external;browser.$Maxthon=t.max_version?true:false}catch(e){}if(/applewebkit\/(\S+)/.test(_ua)){engine.$WEBKIT=true}else if(/khtml\/(\S+)/.test(_ua)){engine.$KHTML=true}else if(/rv:([^\)]+)\) gecko\/\d{8}/.test(_ua)){engine.$MOZ=true}browser.$MOBILE=/mobile/i.test(_ua);if(!browser.$MOBILE){browser.$MOBILE=/HTC/.test(_ua)}function apply(thisObj,cfg){var p;for(p in cfg){thisObj[p]=cfg[p]}}apply(_s,browser);apply(_s,engine);apply(_s,system)})(window);Core.Events.addEvent=function(elm,func,evType,useCapture){var _el=typeof elm=="string"?$E(elm):elm;if(_el==null){trace("addEvent 找不到对象："+elm);return}if(typeof useCapture=="undefined"){useCapture=false}if(typeof evType=="undefined"){evType="click"}if(_el.addEventListener){if(evType=="mousewheel"&&$FF){evType="DOMMouseScroll"}_el.addEventListener(evType,func,useCapture);return true}else if(_el.attachEvent){var r=_el.attachEvent("on"+evType,func);return true}else{_el["on"+evType]=func}};Core.Events.removeEvent=function(oElement,fHandler,sName){var _el=$E(oElement);if(_el==null){trace("removeEvent 找不到对象："+oElement);return}if(typeof fHandler!="function"){return}if(typeof sName=="undefined"){sName="click"}if(_el.addEventListener){_el.removeEventListener(sName,fHandler,false)}else if(_el.attachEvent){_el.detachEvent("on"+sName,fHandler)}fHandler[sName]=null};Sina.pkg("Core.Function");Core.Function.bind3=function(fFunc,object,args){args=args==null?[]:args;var __method=fFunc;return function(){return __method.apply(object,args)}};Core.Array.findit=function(arr,v){var k=-1;Core.Array.foreach(arr,function(value,index){if(v==value){k=index}});return k};window.onerror=function(err,file,line){trace("Error occured:"+err+"<br/>file:"+file+"<br/>line:"+line+"<br/>");return true};function Jobs(oOption){this.option=oOption||{};this._jobTable=[[],[],[],[]]}Jobs.prototype={_registedJobTable:{},errorMsg:[],_registJob:function(jobName,rel){this._registedJobTable[jobName]=rel},error:function(sMsg){Debug.error(sMsg);this.errorMsg.push(sMsg)},add:function(jobName,type){type=type||1;if(Core.Array.findit(this._jobTable[type],jobName)==-1){this._jobTable[type].push(jobName)}else{this.error("Error: Job <b>"+jobName+"</b> is existed now.")}},start:function(){if(this.option.onStart!=null){this.option.onStart()}var regJobs=this._registedJobTable;var jobs=this._jobTable[1].concat(this._jobTable[2]);var _this=this;this.fe=Core.Function.bind3(_this.focus,_this,[]);var addFocus=function(){if(_this._jobTable[3].length==0){if(_this.option.onEnd!=null){_this.option.onEnd()}return}Core.Events.addEvent(document.body,_this.fe,"focus");Core.Events.addEvent(window,_this.fe,"scroll");Core.Events.addEvent(document.body,_this.fe,"mousemove");Core.Events.addEvent(document.body,_this.fe,"mouseover")};this.queue(jobs,addFocus)},focus:function(){var _this=this;if(this.focusdown){Core.Events.removeEvent(document.body,_this.fe,"focus");Core.Events.removeEvent(window,_this.fe,"scroll");Core.Events.removeEvent(document.body,_this.fe,"mousemove");Core.Events.removeEvent(document.body,_this.fe,"mouseover");_this.fe=null;return}this.focusdown=true;var jobs=this._jobTable[3];this.queue(jobs,this.option.onEnd)},queue:function(jobs,callback){var _this=this;var getTime=function(){return(new Date).valueOf()};var regJobs=this._registedJobTable;var joblen=jobs.length;var i=0;var interNum=window.setInterval(function(){if(i>=joblen){clearInterval(interNum);interNum=null;if(callback!=null){callback()}return}var jobName=jobs[i];var job=regJobs[jobName];i++;if(typeof job=="undefined"){_this.error("<b>Job["+jobName+"] is undefiend!!!</b>");return}var _try=true;var _start=getTime();try{job.call()}catch(e){_this.error("<b>Job["+jobName+"] failed!!!</b>"+e.message+"");if(callback!=null){callback()}_try=false;throw e}finally{if(_try){var _end=getTime();Debug.info("<b>Job["+jobName+"] done in "+(_end-_start)+"ms.</b>")}}},10)},call:function(jobName,args){if(typeof this._registedJobTable[jobName]!="undefined"){this._registedJobTable[jobName].apply(this,args)}else{trace("<b>Job["+jobName+"] is undefined!!!</b>",{color:"#900",bgColor:"#FFF;"})}}};$registJob=function(name,rel){Jobs.prototype._registJob(name,rel)};$callJob=function(name){var args=[];if(arguments.length>1){Core.Array.foreach(arguments,function(v,i){args[i]=v});args.shift()}Jobs.prototype.call(name,args)};if(typeof Lib=="undefined"){Lib={}}Lib.pkg=function(ns){if(!ns||!ns.length){return null}var levels=ns.split(".");var nsobj=Lib;for(var i=levels[0]=="Lib"?1:0;i<levels.length;++i){nsobj[levels[i]]=nsobj[levels[i]]||{};nsobj=nsobj[levels[i]]}return nsobj};(function(){function object(o){function F(){}F.prototype=o;return new F}Function.prototype.$define=function(def){var k;for(k in def){this.prototype[k]=def[k]}if(this.__interface__){for(k in this.prototype){if(this.prototype[k]==="NI"){throw new Error("类定义错误，接口方法["+k+"]未实现")}}}this.prototype.constructor=this;this.$extends=this.$define=this.$implements=function(){throw new Error("$define语句定义后面不能再作其它定义")};return this};Function.prototype.$extends=function(){var me=this,i=arguments.length,sup,fn;if(i===0){throw new Error("$extends语句错误：未指定父类")}sup=arguments[0];fn=function(){sup.apply(this,arguments);me.apply(this,arguments)};fn.prototype=object(sup.prototype);fn.prototype.constructor=fn;fn.$super=sup.prototype;return fn};Function.prototype.$implements=function(){var arg=Array.prototype.slice.call(arguments,0),fn,i=arg.length,k;while(i--){if(typeof arg[i]!=="object"){throw new Error("$implements语句错误：参数必须为object类型")}for(k in arg[i]){typeof this.prototype[k]==="undefined"&&(this.prototype[k]="NI")}}this.__interface__=true;this.$extends=function(){throw new Error("$extends语句错误:$extends语句不能出现在$implements定义之后")};return this}})();Core.Events.getEvent=function(){return window.event};if(!$IE||$IE>8){Core.Events.getEvent=function(){if(!$IE&&window.event){return window.event}var o=arguments.callee.caller;var e;var n=0;while(o!=null&&n<40){e=o.arguments[0];if(e&&(e.constructor==Event||e.constructor==MouseEvent)){return e}n++;o=o.caller}return e}}Core.Events.stopEvent=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.cancelBubble=true;ev.returnValue=false}};if(!$IE||$IE>8){Core.Events.stopEvent=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.preventDefault();ev.stopPropagation()}}}Sina.pkg("Ui");if(typeof Ui=="undefined"){Ui=Sina.Ui}Core.Function.bind2=function(fFunc,object){var __method=fFunc;return function(){return __method.apply(object,arguments)}};Function.prototype.bind2=function(object){var __method=this;return function(){return __method.apply(object,arguments)}};Ui.Template=function(tmpl){this.tmpl=tmpl;this.pattern=/(#\{(.*?)\})/g};Ui.Template.prototype={evaluate:function(data){return this.tmpl.replace(this.pattern,function(){return data[arguments[2]]||""})},evaluateMulti:function(data,reverse){var _buffer=[];Core.Array.foreach(data,Core.Function.bind2(function(v,i){i=reverse?data.length-i:i;_buffer[i]=this.evaluate(v)},this));return _buffer.join("")}};Sina.pkg("Core.Dom");Core.Dom.setStyle=function(el,property,val){switch(property){case"opacity":el.style.filter="alpha(opacity="+val*100+")";if(!el.currentStyle||!el.currentStyle.hasLayout){el.style.zoom=1}break;case"float":property="styleFloat";default:el.style[property]=val}};if(!$IE||!($IE<9)){Core.Dom.setStyle=function(el,property,val){if(property=="float"){property="cssFloat"}el.style[property]=val}}(function(){Core.Function.defineGetter=function(obj,p,fn){if(p instanceof Array&&fn instanceof Array){var i=Math.min(p.length,fn.length);while(i--){if(typeof p[i]==="string"&&__checkFunction(fn[i])){obj[p[i]]={valueOf:function(j){return function(){return __getValue(obj,fn[j])}}(i),toString:this.valueOf}}}}else if(typeof p==="string"&&__checkFunction(fn)){obj[p]={valueOf:function(){return __getValue(obj,fn)},toString:this.valueOf}}};function __checkFunction(fn){return typeof fn!=="string"&&String.prototype.slice.call(fn,0,8)=="function"}function __getValue(obj,fn){var ret=fn.call(obj);return typeof ret==="string"||typeof ret==="number"?ret:null}})();Ui.IE6FixedController=function(){var me=this;this.node=null;this.iframeNode=null;this.__orgX=0;this.__orgY=0;this.__isBindScroll=false;this.__fixedHandle=function(){if(me.node){me.node.style.left=document.documentElement.scrollLeft+me.__orgX+"px";me.node.style.top=document.documentElement.scrollTop+me.__orgY+"px"}if(me.iframeNode){me.iframeNode.style.left=me.node.style.left;me.iframeNode.style.top=me.node.style.top}}}.$define({setFixed:function(node,state){this.updateOrgPosition();if(state&&!this.__isBindScroll){Core.Events.addEvent(window,this.__fixedHandle,"scroll");this.__isBindScroll=true}if(!state&&this.__isBindScroll){Core.Events.removeEvent(window,this.__fixedHandle,"scroll");this.__isBindScroll=false}},setPosition:function(node,fixedState,p){if(typeof p.x!=="undefined"){if(fixedState){node.style.left=p.x+document.documentElement.scrollLeft+"px";this.__orgX=parseInt(this.node.style.left)-document.documentElement.scrollLeft}else{node.style.left=p.x+"px"}}if(typeof p.y!=="undefined"){if(fixedState){node.style.top=p.y+document.documentElement.scrollTop+"px";this.__orgY=parseInt(this.node.style.top)-document.documentElement.scrollTop}else{node.style.top=p.y+"px"}}typeof p.z!=="undefined"&&(node.style.zIndex=p.z)},getX:function(node,fixedState){if(fixedState){return parseInt(node.style.left)-document.documentElement.scrollLeft}else{return parseInt(node.style.left)}},getY:function(node,fixedState){if(fixedState){return parseInt(node.style.top)-document.documentElement.scrollTop}else{return parseInt(node.style.top)}},updateIframe:function(isFixed){this.setFixed(this.iframeNode,isFixed);isFixed&&this.__fixedHandle()},updateOrgPosition:function(){if(!this.node){return}this.__orgX=parseInt(this.node.style.left)-document.documentElement.scrollLeft;this.__orgY=parseInt(this.node.style.top)-document.documentElement.scrollTop},destroy:function(){Core.Events.removeEvent(window,this.__fixedHandle,"scroll");this.__isBindScroll=false;this.node=null;this.iframeNode=null}});Core.Events.EventDispatcher=function(target){this.__target=target;this.__events={}}.$define({addEventListener:function(type,handle){if(!this.__checkFunction(handle)){return}var evts=this.__events;type=type.toLowerCase();!evts[type]&&(evts[type]=[]);evts[type].push(handle)},removeEventListener:function(type,handle){var evts=this.__events[type];type=type.toLowerCase();if(!this.__checkFunction(handle)||!evts||!evts.length){return}for(var i=evts.length-1;i>=0;i--){evts[i]==handle&&evts.splice(i,1)}},dispatchEvent:function(type){type=type.toLowerCase();var evts=this.__events[type];if(!evts||!evts.length){return}var args=Array.prototype.slice.call(arguments,0);args.shift();for(var i=0,l=evts.length;i<l;i++){evts[i].apply(this.__target,args)}},__checkFunction:function(func){return typeof func!=="string"&&String.prototype.slice.call(func,0,8)=="function"}});Ui.IRenderer={setCanShow:function(state){},setCanHidden:function(state){},show:function(node){},hidden:function(node){},addEventListener:function(type,handle){},removeEventListener:function(type,handle){}};Ui.SimpleRenderer=function(){this.__canShow=true;this.__canHidden=true;this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$implements(Ui.IRenderer).$define({setCanShow:function(state){this.__canShow=!!state},setCanHidden:function(state){this.__canHidden=!!state},show:function(node){this.__eventDispatcher.dispatchEvent("beforeShow");if(this.__canShow){node.style.display="";this.__eventDispatcher.dispatchEvent("show")}return this},hidden:function(node){this.__eventDispatcher.dispatchEvent("beforeHidden");if(this.__canHidden){node.style.display="none";this.__eventDispatcher.dispatchEvent("hidden")}return this},addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this}});Ui.DisplayObject=function(parent,node){Core.Function.defineGetter(this,["x","y","z","width","height"],[this.__getX,this.__getY,this.__getZ,this.__getWidth,this.__getHeight]);this.__renderer=null;this.__entity=node;this.__isInited=false;this.__parent=parent||document.body;this.__eventDispatcher=new Core.Events.EventDispatcher(this);var ed=this.__eventDispatcher;this.__onBeforeShow=function(){ed.dispatchEvent("beforeShow")};this.__onShow=function(){ed.dispatchEvent("show")};this.__onBeforeHidden=function(){ed.dispatchEvent("beforeHidden")};this.__onHidden=function(){ed.dispatchEvent("hidden")};this.__updateRenderer(Ui.SimpleRenderer)}.$define({isShow:!1,isHidden:!0,setPosition:function(p){!this.__isInited&&this.__initEntity();typeof p.x!=="undefined"&&(this.__entity.style.left=p.x+"px");typeof p.y!=="undefined"&&(this.__entity.style.top=p.y+"px");typeof p.z!=="undefined"&&(this.__entity.style.zIndex=p.z);return this},setSize:function(p){!this.__isInited&&this.__initEntity();typeof p.width!=="undefined"&&(this.__entity.style.width=p.width+"px");typeof p.height!=="undefined"&&(this.__entity.style.height=p.height+"px");return this},setRenderer:function(rendererConstructor){!this.__isInited&&this.__initEntity();this.__updateRenderer(rendererConstructor);return this},show:function(rendererConstructor){this.isHidden=!1;this.isShow=!0;!this.__isInited&&this.__initEntity();this.__updateRenderer(rendererConstructor);this.__renderer.show(this.__entity);return this},hidden:function(rendererConstructor){return this.hide(rendererConstructor)},hide:function(rendererConstructor){this.isHidden=!0;this.isShow=!1;!this.__isInited&&this.__initEntity();this.__updateRenderer(rendererConstructor);this.__renderer.hidden(this.__entity);return this},setCanShow:function(state){this.__renderer.setCanShow(state);return this},setCanHidden:function(state){this.__renderer.setCanHidden(state);return this},addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},destroy:function(){if(!this.__entity){return}!this.__isInited&&this.__initEntity();this.__entity.parentNode&&this.__entity.parentNode.removeChild(this.__entity);this.__entity=null},__initEntity:function(){var st;!this.__entity&&(this.__entity=$C("div"));st=this.__entity.style;st.position="absolute";st.left=0;st.top=0;!this.__entity.parentNode&&this.__parent.appendChild(this.__entity);this.__isInited=true},__updateRenderer:function(rendererConstructor){if(!rendererConstructor){return}var addEvent=function(){this.__renderer.addEventListener("beforeShow",this.__onBeforeShow).addEventListener("show",this.__onShow).addEventListener("beforeHidden",this.__onBeforeHidden).addEventListener("hidden",this.__onHidden)};if(!this.__renderer){this.__renderer=new rendererConstructor;addEvent.call(this)}else if(this.__renderer.constructor!==rendererConstructor){this.__renderer.removeEventListener("beforeShow",this.__onBeforeShow).removeEventListener("show",this.__onShow).removeEventListener("beforeHidden",this.__onBeforeHidden).removeEventListener("hidden",this.__onHidden);this.__renderer=new rendererConstructor;addEvent.call(this)}},__getX:function(){!this.__isInited&&this.__initEntity();return parseInt(this.__entity.style.left)},__getY:function(){!this.__isInited&&this.__initEntity();return parseInt(this.__entity.style.top)},__getZ:function(){!this.__isInited&&this.__initEntity();return parseInt(this.__entity.style.zIndex)},__getWidth:function(){!this.__isInited&&this.__initEntity();return this.__getSize(this.__entity,"offsetWidth")},__getHeight:function(){!this.__isInited&&this.__initEntity();return this.__getSize(this.__entity,"offsetHeight")},__getSize:function(node,p){var et=node,v,ov=et.style.visibility;if(et.style.display=="none"){et.style.visibility="hidden";et.style.display="";v=et[p];et.style.display="none";et.style.visibility=ov}else{v=et[p]}return v}});Ui.Panel=function(parent,node){this.nodes={};this.uniqueID=this.__getUniqueID();this.entity=null;this.__iframe=null;this.__isSetAdamant=false;this.__templateNodesIDs=[];this.__isFixed=false;$IE6&&(this.__ie6FixedController=new Ui.IE6FixedController)}.$extends(Ui.DisplayObject).$define({setTemplate:function(tpl){var nd=$C("div");nd.innerHTML=new Ui.Template(tpl).evaluate(this.__getNodes(tpl,"i"));nd.style.display="none";this.__parent.appendChild(nd);this.__updateTemplate(nd);this.nodes=this.__getNodes(tpl);this.entity=this.__entity;this.nodes.panel=this.entity;return this},setFixed:function(state){!this.__isInited&&this.__initEntity();var x=parseInt(this.__entity.style.left),y=parseInt(this.__entity.style.top);if($IE6){this.__ie6FixedController.setFixed(this.__entity,state);this.__isSetAdamant&&this.__ie6FixedController.setFixed(this.__iframe,state)}else{if(state&&!this.__isFixed){this.setPosition({x:x-Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),y:y-Math.max(document.documentElement.scrollTop,document.body.scrollTop)});this.__entity.style.position="fixed"}if(!state&&this.__isFixed){this.setPosition({x:x+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),y:y+Math.max(document.documentElement.scrollTop,document.body.scrollTop)});this.__entity.style.position="absolute"}}this.__isFixed=!!state;this.__updateIframe();return this},setAdamant:function(state){this.__isSetAdamant=!!state;this.__isSetAdamant&&!this.__iframe&&this.__createIframe();this.__updateIframe();return this},destroy:function(){if(!this.__entity){return}Ui.Panel.$super.destroy.call(this);this.__ie6FixedController&&this.__ie6FixedController.destroy();this.__iframe&&this.__iframe.parentNode.removeChild(this.__iframe)},setPosition:function(p){!this.__isInited&&this.__initEntity();if($IE6){this.__ie6FixedController.setPosition(this.__entity,this.__isFixed,p)}else{Ui.Panel.$super.setPosition.call(this,p)}this.__updateIframe();return this},setSize:function(p){Ui.Panel.$super.setSize.call(this,p).__updateIframe();return this},show:function(renderer){Ui.Panel.$super.show.call(this,renderer).__updateIframe();return this},hidden:function(renderer){Ui.Panel.$super.hidden.call(this,renderer).__updateIframe();return this},__getX:function(){!this.__isInited&&this.__initEntity();if($IE6){return this.__ie6FixedController.getX(this.__entity,this.__isFixed)}else{return parseInt(this.__entity.style.left)}},__getY:function(){!this.__isInited&&this.__initEntity();if($IE6){return this.__ie6FixedController.getY(this.__entity,this.__isFixed)}else{return parseInt(this.__entity.style.top)}},__createIframe:function(){this.__iframe=$C("iframe");this.__iframe.frameBorder="none";this.__parent.insertBefore(this.__iframe,this.__entity);Core.Dom.setStyle(this.__iframe,"opacity",0);this.__ie6FixedController&&(this.__ie6FixedController.iframeNode=this.__iframe);this.__updateIframe()},__updateIframe:function(){if(this.__iframe){var st=this.__iframe.style;st.backgroundColor="#ffffff";st.left=this.x+"px";st.top=this.y+"px";st.width=this.width+"px";st.height=this.height+"px";st.position=this.__entity.style.position;st.display=this.__entity.style.display;st.zIndex=this.__entity.style.zIndex;$IE6&&this.__ie6FixedController.updateIframe(this.__isFixed)}},__updateIE6FCOrgPosition:function(){this.__ie6FixedController&&this.__ie6FixedController.updateOrgPosition()},__updateTemplate:function(nd){var l,t,z,p,d,et=this.__entity;if(et){et.parentNode&&et.parentNode.removeChild(et);l=et.style.left;t=et.style.top;z=et.style.zIndex;p=et.style.position;d=et.style.display}else{d="none"}et=this.__entity=$E("_"+this.uniqueID+"_panel");if(!et){et=this.__entity=$E("_"+this.uniqueID+"_entity")}if(!et){throw new Error("[Panel Error]there missing identifier #{panel} in panel template")}et.style.left=l||0;et.style.top=t||0;et.style.zIndex=z||0;et.style.position=p||"absolute";et.style.display=d;this.__parent.replaceChild(et,nd);this.__ie6FixedController&&(this.__ie6FixedController.node=this.__entity)},__getNodes:function(template,mode){var m=mode||"o",p=/\{[^\}]+(?=\})/g,i,nodes={},rets,r;this.__templateNodesIDs=template.match(p);rets=this.__templateNodesIDs;if(rets){i=rets.length;while(i--){r=rets[i].replace("{","");switch(m){case"o":nodes[r]=$E("_"+this.uniqueID+"_"+r);break;case"i":nodes[r]="_"+this.uniqueID+"_"+r;break}}}return nodes},__getUniqueID:function(){return parseInt(Math.random()*1e3).toString()+(new Date).getTime().toString()},setContent:function(str){this.nodes.content&&(this.nodes.content.innerHTML=str)},getNodes:function(){return this.nodes}});Ui.Drag=function(captureNode,attachNodes,isDragCapureNode){var me=this;this.canDrag=true;this.isLock=false;this.lockArea={left:0,right:0,top:0,bottom:0};this.__captureNode=captureNode;this.__dragNodes=[];this.__deltaX=[];this.__deltaY=[];this.__eventDispatcher=new Core.Events.EventDispatcher(this);this.__isDraging=false;this.__canDragX=true;this.__canDragY=true;this.__dragHandle=function(){me.__drag()};this.__mouseDownHandle=function(){me.__isDraging=true;me.__eventDispatcher.dispatchEvent("beforeDrag");me.__setCapture(true)};this.__mouseUpHandle=function(){me.__isDraging&&me.__eventDispatcher.dispatchEvent("afterDrag");me.__isDraging=false;me.__setCapture(false)};this.__initNodes(captureNode,attachNodes,isDragCapureNode);this.__initCaputerNode()}.$define({addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},destroy:function(){Core.Events.removeEvent(this.__captureNode,this.__mouseDownHandle,"mousedown");Core.Events.removeEvent(document,this.__mouseUpHandle,"mouseup");this.__captureNode=null;this.__dragNodes=null},__initNodes:function(captureNode,attachNodes,isDragCapureNode){if(attachNodes){attachNodes instanceof Array?this.__dragNodes=attachNodes:this.__dragNodes.push(attachNodes);(typeof isDragCapureNode==="undefined"||isDragCapureNode)&&this.__dragNodes.push(this.__captureNode)}else{this.__dragNodes.push(this.__captureNode)}var dns=this.__dragNodes,i=dns.length;while(i--){!dns[i].style.position&&(dns[i].style.position="absolute");!dns[i].style.left&&(dns[i].style.left=0);!dns[i].style.top&&(dns[i].style.top=0)}},__initCaputerNode:function(){var cn=this.__captureNode,me=this;Core.Events.addEvent(cn,this.__mouseDownHandle,"mousedown");Core.Events.addEvent(document,this.__mouseUpHandle,"mouseup")},__setCapture:function(isCapture){var cn=this.__captureNode,dns=this.__dragNodes,evt=Core.Events.getEvent(),i=dns.length;while(i--){this.__deltaX[i]=evt.clientX-parseInt(dns[i].style.left);this.__deltaY[i]=evt.clientY-parseInt(dns[i].style.top)}if(isCapture){if($IE){cn.setCapture();Core.Events.addEvent(cn,this.__dragHandle,"mousemove")}else{Core.Events.addEvent(document,this.__dragHandle,"mousemove")}}else{if($IE){cn.releaseCapture();Core.Events.removeEvent(cn,this.__dragHandle,"mousemove")}else{Core.Events.removeEvent(document,this.__dragHandle,"mousemove")}}},__drag:function(){if(!this.canDrag){return}var dns=this.__dragNodes,evt=Core.Events.getEvent(),i=dns.length,la=this.lockArea,dX=0,dY=0;this.__eventDispatcher.dispatchEvent("drag");while(i--){dX=evt.clientX-this.__deltaX[i];dY=evt.clientY-this.__deltaY[i];if(this.isLock){dX=Math.min(Math.max(dX,la.left),la.right);dY=Math.min(Math.max(dY,la.top),la.bottom)}dns[i].style.left=dX+"px";dns[i].style.top=dY+"px"}}});Ui.IDragger={addEventListener:function(type,handle){},removeEventListener:function(type,handle){},setDrag:function(node,attachNodes,isDragCapureNode){},setLock:function(state){},setArea:function(area){},destroy:function(){}};Ui.SimpleDragger=function(){this.__drag=null;this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$implements(Ui.IDragger).$define({addEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.addEventListener(type,handle)}else{this.__drag.addEventListener(type,handle)}return this},removeEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.removeEventListener(type,handle)}else{this.__drag.removeEventListener(type,handle)}return this},setDrag:function(node,attachNode,isDragCapureNode){var me=this;this.__drag=new Ui.Drag(node,attachNode,isDragCapureNode);this.__drag.addEventListener("afterDrag",function(){me.__eventDispatcher.dispatchEvent("afterDrag")});return this},setLock:function(state){this.__drag.isLock=!!state;return this},setArea:function(area){this.__drag.lockArea=area;return this},destroy:function(){this.__drag.destroy()}});Ui.Dialog=function(parent,node){var me=this;this.__dragger=null;this.__isBindUpadateAreaEvent=false;this.__isBindUpdateIE6AreaEvent=false;this.__beforeDragHandle=function(){me.__updateDraggerArea();me.__eventDispatcher.dispatchEvent("beforedrag")};this.__dragHandle=function(){me.__isSetAdamant&&me.__updateIframe();me.__eventDispatcher.dispatchEvent("drag")};this.__afterDragHandle=function(){me.__isFixed&&$IE6&&me.__updateIE6FCOrgPosition();me.__eventDispatcher.dispatchEvent("afterdrag")};this.__updateDraggerAreaHandle=function(){setTimeout(function(){me.__updateDraggerArea()},1)};this.__setMiddleHandle=function(){me.setMiddle()}}.$extends(Ui.Panel).$define({setTemplate:function(tpl){Ui.Dialog.$super.setTemplate.call(this,tpl);this.__initTitleBar();this.setDragger(Ui.SimpleDragger);return this},setContent:function(content){if(!this.nodes.content){return this}this.nodes.content.innerHTML=new Ui.Template(content).evaluate(this.__getNodes(content,"i"));this.__addContentNodes(this.__getNodes(content));return this},setFixed:function(state){Ui.Dialog.$super.setFixed.call(this,state);if(state){Core.Events.addEvent(window,this.__setMiddleHandle,"resize")}else{Core.Events.removeEvent(window,this.__setMiddleHandle,"resize")}this.__updateDraggerArea();return this},setMiddle:function(){var areaHeight=this.__getDocumentSize().height-this.height,goldenSection=(Math.sqrt(5)-1)/2,totalSection=1,goldenSectionY=areaHeight*goldenSection/(goldenSection+totalSection),middleX=this.__getDocumentSize().width/2-this.width/2;if(!this.__isFixed){goldenSectionY+=Math.max(document.documentElement.scrollTop,document.body.scrollTop);middleX+=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft)}this.setPosition({x:Math.max(middleX,0),y:Math.max(goldenSectionY,0)});return this},setAreaLocked:function(state){if(!this.__dragger){return this}this.__dragger.setLock(state);return this},setSize:function(p){!this.__isInited&&this.__initEntity();if(this.nodes.content){typeof p.width!=="undefined"&&(this.nodes.content.style.width=p.width+"px");typeof p.height!=="undefined"&&(this.nodes.content.style.height=p.height+"px")}else{typeof p.width!=="undefined"&&(this.__entity.style.width=p.width+"px");typeof p.height!=="undefined"&&(this.__entity.style.height=p.height+"px")}return this},setDragger:function(draggerConstructor){if(!this.nodes.titleBar||!draggerConstructor){return this}if(!this.__dragger){this.__dragger=new draggerConstructor}else if(this.__dragger.constructor===draggerConstructor){return this}this.__updateDragger(draggerConstructor);return this},destroy:function(){if(!this.__entity){return}Ui.Dialog.$super.destroy.call(this);Core.Events.removeEvent(window,this.__updateDraggerAreaHandle,"resize");Core.Events.removeEvent(window,this.__setMiddleHandle,"resize")},__addContentNodes:function(nodes){var nds=this.nodes,k;for(k in nodes){nds[k]=nodes[k]}},__updateDragger:function(draggerConstructor){if(this.__dragger.constructor!==draggerConstructor){this.__dragger.removeEventListener("beforedrag",this.__beforeDragHandle).removeEventListener("drag",this.__dragHandle).removeEventListener("afterdrag",this.__afterDragHandle);this.__dragger.destroy();this.__dragger=new draggerConstructor}this.__dragger.setDrag(this.nodes.titleBar,this.__entity,false);this.__dragger.addEventListener("beforedrag",this.__beforeDragHandle).addEventListener("drag",this.__dragHandle).addEventListener("afterdrag",this.__afterDragHandle)},__updateDraggerArea:function(){var l,t,r,b;if(this.__isFixed){l=$IE6?document.documentElement.scrollLeft:0;t=$IE6?document.documentElement.scrollTop:0;r=$IE6?document.documentElement.scrollLeft+this.__getDocumentSize().width-this.width:this.__getDocumentSize().width-this.width;b=$IE6?document.documentElement.scrollTop+this.__getDocumentSize().height-this.height:this.__getDocumentSize().height-this.height;

}else{l=0;t=0;r=document.documentElement.scrollWidth-this.width;b=document.documentElement.scrollHeight-this.height}this.__dragger.setArea({left:l,top:t,right:r,bottom:b})},__initTitleBar:function(){if(!this.nodes.titleBar){return}var tb=this.nodes.titleBar;tb.style.cursor="move";if($IE){Core.Events.addEvent(tb,function(){return false},"selectstart")}else{tb.style.MozUserSelect="none"}},__getDocumentSize:function(){var w=document.documentElement.clientWidth||document.body.clientWidth,h=document.documentElement.clientHeight||document.body.clientHeight;return{width:w,height:h}}});Ui.ModuleDialog=function(tplConfig,iconSet,cfg){this.__bgShadow=null;this.__dialog=null;this.__isInitBgShadow=false;this.__tplConfig=tplConfig;this.__iconSet=iconSet;this.__dialogQueue=[];this.__zIndex=cfg&&cfg.zIndex||5e3;this.__cfg=cfg||{};this.__initDialogEvent()}.$define({alert:function(text,cfg){cfg=cfg||{};var dlg=this.__createMessageDialog(cfg.tplConfig||this.__tplConfig.alert,cfg);dlg.nodes.text&&(dlg.nodes.text.innerHTML=text||"");dlg.show(cfg.renderer||this.__cfg.renderer).addEventListener("hidden",function(){this.destroy()});dlg.nodes.linkOk&&dlg.nodes.linkOk.style.display!=="none"&&dlg.nodes.linkOk.focus();return dlg},newAlert:function(text,cfg,name){cfg.tplConfig=this.__tplConfig.newAlert;this.alert(text,cfg,name)},confirm:function(text,cfg){cfg=cfg||{};var dlg=this.__createMessageDialog(cfg.tplConfig||this.__tplConfig.confirm,cfg),me=this;dlg.nodes.text&&(dlg.nodes.text.innerHTML=text||"");if(dlg.nodes.btnCancel){dlg.nodes.btnCancel.innerHTML=cfg.textCancel||"取消";Core.Events.addEvent(dlg.nodes.btnCancel,function(){cfg.funcCancel&&cfg.funcCancel.call(dlg);dlg.hidden(cfg.renderer||me.__cfg.renderer);Core.Events.stopEvent()},"click");dlg.nodes.linkCancel&&Core.Events.addEvent(dlg.nodes.linkCancel,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){cfg.funcCancel&&cfg.funcCancel.call(dlg);dlg.hidden(cfg.renderer||me.__cfg.renderer)}},"keydown")}dlg.show(cfg.renderer||me.__cfg.renderer).addEventListener("hidden",function(){this.destroy()});if(cfg.defaultButton==0){dlg.nodes.linkCancel&&dlg.nodes.linkCancel.style.display!=="none"&&dlg.nodes.linkCancel.focus()}else{dlg.nodes.linkOk&&dlg.nodes.linkOk.style.display!=="none"&&dlg.nodes.linkOk.focus()}return dlg},newConfirm:function(text,cfg,name){cfg.tplConfig=this.__tplConfig.newConfirm;this.confirm(text,cfg,name)},create:function(cfg){var me=this;cfg=cfg||{};var dlg=new Ui.Dialog;dlg.setTemplate(cfg.tpl||this.__tplConfig.customs);cfg.content&&dlg.setContent(cfg.content);cfg.width&&!isNaN(cfg.width)&&dlg.setSize({width:cfg.width});cfg.height&&!isNaN(cfg.height)&&dlg.setSize({height:cfg.height});return this.__initDialog(dlg,cfg)},__initDialogEvent:function(){var queue=this.__dialogQueue;Core.Events.addEvent(document,function(){var e=Core.Events.getEvent();if(queue.length&&e.keyCode=="27"){queue[queue.length-1].hidden()}},"keydown")},__createMessageDialog:function(tpl,cfg){var dlg=new Ui.Dialog,me=this,i;dlg.setTemplate(tpl);cfg.width&&!isNaN(cfg.width)&&dlg.setSize({width:cfg.width});cfg.height&&!isNaN(cfg.height)&&dlg.setSize({height:cfg.height});dlg.nodes.subText&&(dlg.nodes.subText.innerHTML=cfg.subText||"");if(dlg.nodes.icon){dlg.nodes.icon.className=this.__iconSet[cfg.icon||"01"]["class"];dlg.nodes.icon.alt=this.__iconSet[cfg.icon||"01"]["alt"]}if(dlg.nodes.btnOk){dlg.nodes.btnOk.innerHTML=cfg.textOk||"确定";Core.Events.addEvent(dlg.nodes.btnOk,function(){dlg.hidden(cfg.renderer||me.__cfg.renderer);cfg.funcOk&&cfg.funcOk.call(dlg);Core.Events.stopEvent()},"click")}dlg.nodes.linkOk&&Core.Events.addEvent(dlg.nodes.linkOk,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){dlg.hidden(cfg.renderer||me.__cfg.renderer);cfg.funcOk&&cfg.funcOk.call(dlg)}},"keydown");dlg.setDragger(cfg.dragger||me.__cfg.dragger).setFixed(true).setAreaLocked(true);return this.__initDialog(dlg,cfg)},__initDialog:function(dlg,cfg){var me=this;cfg.zIndex&&(me.__zIndex=cfg.zIndex);dlg.nodes.titleName&&(dlg.nodes.titleName.innerHTML=cfg.title||"提示");if(dlg.nodes.btnClose){Core.Events.addEvent(dlg.nodes.btnClose,function(){var isCanHidden=true;cfg.funcBeforeClose&&(isCanHidden=cfg.funcBeforeClose.call(dlg)!==false);cfg.funcClose&&cfg.funcClose.call(dlg);isCanHidden&&dlg.hidden()},"click");Core.Events.addEvent(dlg.nodes.btnClose,function(){Core.Events.stopEvent()},"mousedown")}dlg.setPosition({z:cfg.zIndex||me.__zIndex});dlg.setRenderer(cfg.renderer||this.__cfg.renderer);dlg.setDragger(cfg.dragger||this.__cfg.dragger);dlg.setMiddle();dlg.addEventListener("beforeHidden",function(){me.__updateDialogQueue(this,"remove")});dlg.addEventListener("beforeShow",function(){this.nodes.panel.parentNode.appendChild(this.nodes.panel);var that=this;if(!me.__isInitBgShadow){me.__initBGShadow(this,cfg.isAdamant||me.__cfg.isAdamant)}me.__setBGShadowOpacity(cfg.bgShadowOpacity!==0?cfg.bgShadowOpacity||.4:cfg.bgShadowOpacity);window.setTimeout(function(){me.__bgShadow.show();me.__updateDialogQueue(that,"add")},1)});dlg.setTitle=function(title){this.nodes.titleName&&(this.nodes.titleName.innerHTML=title)};dlg.setHelp=function(url){this.nodes.btnHelp&&(this.nodes.btnHelp.href=url)};dlg.close=function(){this.hidden()};dlg.getNodes=function(){return this.nodes};dlg.getX=function(){return this.x};dlg.getY=function(){return this.y};dlg.getWidth=function(){return this.width};dlg.getHeight=function(){return this.height};return dlg},__initBGShadow:function(dlg,isAdamant){var w=this.__getDocumentSize().width,h=this.__getDocumentSize().height,me=this;this.__bgShadow=new Ui.Panel;this.__bgShadow.setTemplate('<div id="#{panel}" style="background-color:black"></div>').setSize({width:w,height:h}).setAdamant(isAdamant).setFixed(true).setPosition({x:0,y:0,z:me.__zIndex});Core.Events.addEvent(window,function(){me.__bgShadow.setPosition({x:0,y:0}).setSize({width:me.__getDocumentSize().width,height:me.__getDocumentSize().height})},"resize");this.__isInitBgShadow=true},__updateDialogQueue:function(dialog,op){var i,dlg;if(op==="add"){this.__dialogQueue.push(dialog)}else if(op==="remove"){i=this.__dialogQueue.length;while(i--){this.__dialogQueue[i]===dialog&&this.__dialogQueue.splice(i,1)}}if(this.__dialogQueue.length===0){this.__bgShadow.hidden()}else{dlg=this.__dialogQueue[this.__dialogQueue.length-1];this.__bgShadow.nodes.panel.parentNode.insertBefore(this.__bgShadow.nodes.panel,dlg.nodes.panel);this.__bgShadow.__iframe&&this.__bgShadow.__iframe.parentNode.insertBefore(this.__bgShadow.__iframe,this.__bgShadow.nodes.panel);dlg.nodes.linkOk&&dlg.nodes.linkOk.style.display!=="none"&&dlg.nodes.linkOk.focus()}},__setBGShadowOpacity:function(v){v=isNaN(v)?0:Math.max(Math.min(v,1),0);Core.Dom.setStyle(this.__bgShadow.nodes.panel,"opacity",v)},__getDocumentSize:function(){var w=document.documentElement.clientWidth||document.body.clientWidth,h=document.documentElement.clientHeight||document.body.clientHeight;return{width:w,height:h}}});Ui.Transition={simple:function(t,b,c,d){return c*t/d+b},backEaseIn:function(t,b,c,d){var s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b},backEaseOut:function(t,b,c,d){var s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},backEaseInOut:function(t,b,c,d){var s=1.70158;if((t/=d/2)<1){return c/2*(t*t*(((s*=1.525)+1)*t-s))+b}return c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b},bounceEaseOut:function(t,b,c,d){if((t/=d)<1/2.75){return c*(7.5625*t*t)+b}else if(t<2/2.75){return c*(7.5625*(t-=1.5/2.75)*t+.75)+b}else if(t<2.5/2.75){return c*(7.5625*(t-=2.25/2.75)*t+.9375)+b}else{return c*(7.5625*(t-=2.625/2.75)*t+.984375)+b}},bounceEaseIn:function(t,b,c,d){return c-Transition.bounceEaseOut(d-t,0,c,d)+b},bounceEaseInOut:function(t,b,c,d){if(t<d/2){return Transition.bounceEaseIn(t*2,0,c,d)*.5+b}else{return Transition.bounceEaseOut(t*2-d,0,c,d)*.5+c*.5+b}},regularEaseIn:function(t,b,c,d){return c*(t/=d)*t+b},regularEaseOut:function(t,b,c,d){return-c*(t/=d)*(t-2)+b},regularEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b}return-c/2*(--t*(t-2)-1)+b},strongEaseIn:function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},strongEaseOut:function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},strongEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t*t+b}return c/2*((t-=2)*t*t*t*t+2)+b},elasticEaseIn:function(t,b,c,d){var a,p;if(t==0){return b}if((t/=d)==1){return b+c}p=d*.3;if(!a||a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b},elasticEaseOut:function(t,b,c,d){var a,p;if(t==0){return b}if((t/=d)==1){return b+c}if(!p){p=d*.3}if(!a||a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b},elasticEaseInOut:function(t,b,c,d){var a,p;if(t==0){return b}if((t/=d/2)==2){return b+c}if(!p){var p=d*(.3*1.5)}if(!a||a<Math.abs(c)){var a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}if(t<1){return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b}return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b}};Ui.TweenStrategy=function(startValue,endValue,duration,motion){this.startValue=startValue||0;this.endValue=endValue||0;this.duration=duration||0;this.motion=motion||Ui.Transition.simple;this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$define({motion:null,duration:0,startValue:0,endValue:0,_itvID:0,_isTweenning:false,addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},start:function(){if(this._isTweenning){return}this._isTweenning=true;var me=this,t,sv=this.startValue,ev=this.endValue,d=this.duration,value,startTime=(new Date).getTime();this._itvID=window.setInterval(function(){t=((new Date).getTime()-startTime)/1e3;t>me.duration&&(t=me.duration);value=me.motion(t,sv,ev-sv,d);me.onTween&&me.onTween(value);me.__eventDispatcher.dispatchEvent("tween",value);t==me.duration&&me.stop()},25);return this},stop:function(){window.clearInterval(this._itvID);this._isTweenning=false;this.onEnd&&this.onEnd();this.__eventDispatcher.dispatchEvent("end");return this},onTween:function(value){},onEnd:function(){}});Ui.OpacityRenderer=function(){this.__canShow=true;this.__canHidden=true;this.__node=null;this.__tween=new Ui.TweenStrategy(0,0,.6,Ui.Transition.strongEaseOut);this.__state="";this.__lastState="";this.__value=0;this.__node=null;this.__eventDispatcher=new Core.Events.EventDispatcher(this);this.__initTweenEvent()}.$implements(Ui.IRenderer).$define({setCanShow:function(state){this.__canShow=!!state},setCanHidden:function(state){this.__canHidden=!!state},show:function(node){var tn=this.__tween;tn.stop();Core.Dom.setStyle(node,"opacity",this.__value);node.style.display="";this.__node=node;this.__state="show";this.__eventDispatcher.dispatchEvent("beforeShow");if(this.__canShow){tn.startValue=this.__value;tn.endValue=1;tn.start()}return this},hidden:function(node){var tn=this.__tween;tn.stop();this.__node=node;this.__state="hidden";this.__eventDispatcher.dispatchEvent("beforeHidden");if(this.__canHidden){tn.startValue=this.__value;tn.endValue=0;tn.start()}return this},addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},__initTweenEvent:function(){var me=this;this.__tween.addEventListener("tween",function(v){me.__value=v;Core.Dom.setStyle(me.__node,"opacity",v)});this.__tween.addEventListener("end",function(){me.__node&&me.__node.style.filter&&(me.__node.style.filter="");if(me.__state!==""&&me.__state!==me.__lastState){me.__lastState=me.__state;me.__eventDispatcher.dispatchEvent(me.__state)}me.__state==="hidden"&&(me.__node.style.display="none")})}});Ui.BorderDragger=function(){this.__drag=null;this.__isBindEvent=false;this.__border=null;this.__dragNode=null;this.__isCreated=false;this.__tweenX=new Ui.TweenStrategy(0,0,.5,Ui.Transition.strongEaseOut);this.__tweenY=new Ui.TweenStrategy(0,0,.5,Ui.Transition.strongEaseOut);this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$implements(Ui.IDragger).$define({addEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.addEventListener(type,handle)}else{this.__drag.addEventListener(type,handle)}return this},removeEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.removeEventListener(type,handle)}else{this.__drag.removeEventListener(type,handle)}return this},setDrag:function(node,attachNode,isDragCapureNode){if(!this.__isCreated){this.__createBorder(attachNode);this.__initTweenEvent(attachNode)}this.__drag=new Ui.Drag(node,this.__border,isDragCapureNode);this.__dragNode=attachNode;this.__initDragEvent();return this},setLock:function(state){this.__drag.isLock=!!state;return this},setArea:function(area){this.__drag.lockArea=area;return this},destroy:function(){this.__drag.destroy()},__createBorder:function(node){this.__border=$C("div");var st=this.__border.style;st.border="2px dashed #BCC4D0";st.position="absolute";st.display="none";st.backgroundColor="transparent";st.MozUserSelect="none";document.body.appendChild(this.__border);this.__isCreated=true},__initDragEvent:function(){if(this.__isBindEvent){return}var me=this,bst=this.__border.style,nst=this.__dragNode.style,twX=this.__tweenX,twY=this.__tweenY;this.__drag.addEventListener("beforeDrag",function(){bst.zIndex=nst.zIndex+1;bst.position=nst.position;bst.width=me.__dragNode.offsetWidth-4+"px";bst.height=me.__dragNode.offsetHeight-4+"px";bst.left=parseInt(nst.left)+"px";bst.top=parseInt(nst.top)+"px";bst.display=""});this.__drag.addEventListener("afterDrag",function(){if($IE6){nst.left=parseInt(bst.left)+"px";nst.top=parseInt(bst.top)+"px";bst.display="none";me.__eventDispatcher.dispatchEvent("afterDrag")}else{twX.startValue=parseInt(nst.left);twX.endValue=parseInt(bst.left);twY.startValue=parseInt(nst.top);twY.endValue=parseInt(bst.top);twX.start();twY.start()}});this.__isBindEvent=true},__initTweenEvent:function(node){var nst=node.style,bst=this.__border.style,me=this;this.__tweenX.addEventListener("tween",function(v){nst.left=v+"px"});this.__tweenY.addEventListener("tween",function(v){nst.top=v+"px"});this.__tweenX.addEventListener("end",function(){bst.display="none";me.__eventDispatcher.dispatchEvent("afterDrag")})}});var winDialog={};var DialogTemplate={};(function(){var dialogTemplates={alert:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示标题</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}" class="CP_layercon1">','<div class="CP_prompt">','<img id="#{icon}" class="SG_icon SG_icon201" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="50" height="50" align="absmiddle"/>','<table class="CP_w_ttl"><tr><td id="#{text}"></td></tr></table>','<div id="#{subText}" class="CP_w_cnt SG_txtb"></div>','<p class="CP_w_btns_Mid"><a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnOk}"> </cite></a></p>',"</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),newAlert:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div class="CP_layercon2 pop_v">','<div class="v_prompt">','<img id="#{icon}" class="SG_icon SG_icon148" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="20" height="20" align="absmiddle" />','<div id="#{text}" class="v_cnt SG_txtb"></div>','<div id="#{subText}"></div>','<p class="v_btns">','<a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#"><cite id="#{btnOk}">确定</cite></a>',"</p>","</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),confirm:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示标题</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}" class="CP_layercon1">','<div class="CP_prompt">','<img id="#{icon}" class="SG_icon SG_icon201" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="50" height="50" align="absmiddle"/>','<table class="CP_w_ttl"><tr><td id="#{text}"></td></tr></table>','<div id="#{subText}" class="CP_w_cnt SG_txtb"></div>','<p class="CP_w_btns">','<a  id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnOk}"></cite></a>','<a style="margin-left:5px;" id="#{linkCancel}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnCancel}"> <span id="#{cancel}"></span> </cite></a></p>',"</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),newConfirm:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div class="CP_layercon2 pop_v">','<div class="v_prompt">','<img id="#{icon}" class="SG_icon SG_icon148" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="20" height="20" align="absmiddle" />','<div id="#{text}" class="v_cnt SG_txtb"></div>','<div id="#{subText}"></div>','<p class="v_btns">','<a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#"><cite id="#{btnOk}">确定</cite></a>&nbsp;&nbsp;','<a id="#{linkCancel}" class="SG_aBtn SG_aBtnB SG_aBtn_g" href="#"><cite id="#{btnCancel}">取消</cite></a>',"</p>","</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),customs:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}">提示标题</strong>','<cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">',"</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join("")};var iconSet={"01":{"class":"SG_icon SG_icon201",alt:"警告"},"02":{"class":"SG_icon SG_icon202",alt:"失败"},"03":{"class":"SG_icon SG_icon203",alt:"成功"},"04":{"class":"SG_icon SG_icon204",alt:"询问"},"05":{"class":"SG_icon SG_bigLoading",alt:"正在加载"},"06":{"class":"SG_icon SG_icon148",alt:"警告"}};var dialogs={};var moduleDialog=new Ui.ModuleDialog(dialogTemplates,iconSet,{renderer:Ui.OpacityRenderer,dragger:Ui.BorderDragger,isAdamant:$IE6});winDialog.create=winDialog.createCustomsDialog=function(args,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.create(args);return dialogs[name]}else{return moduleDialog.create(args)}};winDialog.alert=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.alert(text,cfg);return dialogs[name]}else{return moduleDialog.alert(text,cfg)}};winDialog.newAlert=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.newAlert(text,cfg);return dialogs[name]}else{return moduleDialog.newAlert(text,cfg)}};winDialog.confirm=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.confirm(text,cfg);return dialogs[name]}else{return moduleDialog.confirm(text,cfg)}};winDialog.newConfirm=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.newConfirm(text,cfg);return dialogs[name]}else{return moduleDialog.newConfirm(text,cfg)}};winDialog.getDialog=function(name){if(name&&typeof name==="string"){return dialogs[name]}};DialogTemplate=dialogTemplates})();Sina.pkg("Core.Class");Core.Class.AsPrototype={};Core.Class.create=function(){return function(t){if(t!=Core.Class.AsPrototype){this.initialize.apply(this,arguments)}}};Sina.pkg("Core.Math");Core.Math.getUniqueId=function(_start,_end){return parseInt(Math.random()*1e4).toString()+(new Date).getTime().toString()};Lib.IframeDialog=Core.Class.create();Lib.IframeDialog.prototype={dialog:null,initialize:function(option){this.id=Core.Math.getUniqueId();this.option=option},initDialog:function(){var _this=this,this_option=this.option;var obj={ad:false,drag:true,tpl:this_option.tpl||_this.tpl,title:this_option.title,content:'<iframe frameborder="0" id="ifrDialog_'+_this.id+'" scrolling="no"></iframe>',renderer:Ui.SimpleRenderer,width:this_option.width,height:this_option.height};this.dialog=winDialog.createCustomsDialog(obj);this.dialog.setAreaLocked(true);var iframe=$E("ifrDialog_"+this.id);iframe.src=this_option.url;iframe.style.width=this_option.width+"px";iframe.style.height=this_option.height+"px";this_option.funcClose&&this.bindColseFunc()},tpl:'<table id="#{entity}" class="CP_w">'+'<thead id="#{titleBar}">'+"<tr>"+'<th class="tLeft"><span></span></th>'+'<th class="tMid">'+'<div class="bLyTop">'+'<strong id="#{titleName}">提示</strong>'+'<cite><a id="#{btnClose}" href="javascript:;" class="CP_w_shut" title="关闭">关闭</a></cite>'+"</div>"+"</th>"+'<th class="tRight"><span></span></th>'+"</tr>"+"</thead>"+"<tfoot>"+"<tr>"+'<td class="tLeft"><span></span></td>'+'<td class="tMid"><span></span></td>'+'<td class="tRight"><span></span></td>'+"</tr>"+"</tfoot>"+"<tbody>"+"<tr>"+'<td class="tLeft"><span></span></td>'+'<td class="tMid" id="#{content}">'+"</td>"+'<td class="tRight"><span></span></td>'+"</tr>"+"</tbody>"+"</table>",reset:function(){if(this.dialog){this.hidden();var dialogParentNode=this.dialog.nodes.panel||this.dialog.nodes.entity;dialogParentNode.parentNode.removeChild(dialogParentNode);this.dialog=null}},bindColseFunc:function(){Core.Events.addEvent(this.dialog.nodes.btnClose,this.option.funcClose)},setSize:function(nWidth,nHeight){var ele=this.dialog.nodes.content.firstChild;this.dialog.setSize(nWidth,nHeight);ele.style.width=nWidth+"px";ele.style.height=nHeight+"px"},show:function(){this.reset();this.initDialog();this.dialog.show();this.dialog.setMiddle()},close:function(){this.dialog.hidden()}};Core.Events.fireEvent=function(oElement,sEvent){var evt;oElement=$E(oElement);if(oElement.fireEvent){oElement.fireEvent("on"+sEvent)}else{if($MOBILE){evt=document.createEvent("HTMLEvents")}else{evt=document.createEvent("MouseEvents")}evt.initEvent(sEvent,true,true);oElement.dispatchEvent(evt)}};Lib.AccountChecker=Core.Class.create();Lib.AccountChecker.prototype={initialize:function(ssoUrl){if(ssoUrl.indexOf("vt=1")>0||ssoUrl.indexOf("vt=2")>0){this.showDialog(ssoUrl)}else{window.location.href=ssoUrl}},showDialog:function(ssoUrl){document.domain="sina.com.cn";if(!window.accDialog){window.accDialog=new Lib.IframeDialog({url:ssoUrl,title:"账号安全",width:300,height:165});scope.accCallback=function(){window.accDialog.close()}}window.accDialog.show();var nodes=window.accDialog.dialog.nodes;var content=nodes.content;content.firstChild.style.marginLeft="25px";nodes.btnClose.style.display="none";var p=document.createElement("p");p.style.lineHeight="70px";p.innerHTML="　　为了您的账号安全，请输入验证码后再进行操作";content.insertBefore(p,content.firstChild)},hideDialog:function(){window.accDialog&&window.accDialog.hidden()}};$registJob("checkAccount",function(){var url=scope.$ssoUseUrl;if(url&&url!=="0"){new Lib.AccountChecker(url)}});Core.Dom.getChildrenByClass=function(el,clz){var rs=[];var cldr=el.childNodes||el.children;var clz=" "+clz+" ";var len=cldr.length;for(var i=0;i<len;++i){var o=cldr[i];var ecl=" "+o.className+" ";if(ecl.indexOf(clz)!=-1){rs[rs.length]=o}}return rs};Core.Dom.insertHTML=function(el,html,where){el=$E(el)||document.body;where=where.toLowerCase()||"beforeend";if(el.insertAdjacentHTML){switch(where){case"beforebegin":el.insertAdjacentHTML("BeforeBegin",html);return el.previousSibling;case"afterbegin":el.insertAdjacentHTML("AfterBegin",html);return el.firstChild;case"beforeend":el.insertAdjacentHTML("BeforeEnd",html);return el.lastChild;case"afterend":el.insertAdjacentHTML("AfterEnd",html);return el.nextSibling}throw'Illegal insertion point -> "'+where+'"'}var range=el.ownerDocument.createRange();var frag;switch(where){case"beforebegin":range.setStartBefore(el);frag=range.createContextualFragment(html);el.parentNode.insertBefore(frag,el);return el.previousSibling;case"afterbegin":if(el.firstChild){range.setStartBefore(el.firstChild);frag=range.createContextualFragment(html);el.insertBefore(frag,el.firstChild);return el.firstChild}else{el.innerHTML=html;return el.firstChild}break;case"beforeend":if(el.lastChild){range.setStartAfter(el.lastChild);frag=range.createContextualFragment(html);el.appendChild(frag);return el.lastChild}else{el.innerHTML=html;return el.lastChild}break;case"afterend":range.setStartAfter(el);frag=range.createContextualFragment(html);el.parentNode.insertBefore(frag,el.nextSibling);return el.nextSibling}throw'Illegal insertion point -> "'+where+'"'};if(document.documentElement.contains){Core.Dom.contains=function(oParentNode,oNode){return oParentNode.contains?oParentNode.contains(oNode):true}}else if(document.documentElement.compareDocumentPosition){Core.Dom.contains=function(oParentNode,oNode){return oParentNode===oNode||!!(oParentNode.compareDocumentPosition(oNode)&16)}}else{Core.Dom.contains=function(oParentNode,oNode){while(oNode){if(oParentNode===oNode){return true}oNode=oNode.parentNode}return false}}Core.Dom.insertAfter=function(newElement,targetElement){var parent=targetElement.parentNode;if(parent.lastChild==targetElement){parent.appendChild(newElement)}else{parent.insertBefore(newElement,targetElement.nextSibling)}return newElement};Sina.pkg("Utils");if(typeof Utils=="undefined"){Utils=Sina.Utils}Sina.pkg("Utils.Cookie");Utils.Cookie.getCookie=function(name){name=name.replace(/([\.\[\]\$])/g,"\\$1");var rep=new RegExp(name+"=([^;]*)?;","i");var co=document.cookie+";";var res=co.match(rep);if(res){return res[1]||""}else{return""}};Utils.Cookie.setCookie=function(name,value,expire,path,domain,secure){var cstr=[];cstr.push(name+"="+escape(value));if(expire){var dd=new Date;var expires=dd.getTime()+expire*36e5;dd.setTime(expires);cstr.push("expires="+dd.toGMTString())}if(path){cstr.push("path="+path)}if(domain){cstr.push("domain="+domain)}if(secure){cstr.push(secure)}document.cookie=cstr.join(";")};Lib.applyIf=function(o,s,defaults){if(defaults){Lib.applyIf(o,defaults)}if(o&&s&&Lib.isObject(s)){for(var p in s){if(s.hasOwnProperty(p)&&!o[p]){o[p]=s[p]}}}return o};Lib.isObject=function(o){return Object.prototype.toString.call(o)==="[object Object]"};Lib.apply=function(o,ref,defaults,deep,original){if(defaults){Lib.applyIf(o,defaults)}for(var p in ref){if(original&&o[p]&&!Lib.isObject(o[p])){continue}if(ref.hasOwnProperty(p)){if(deep&&Lib.isObject(ref[p])){o[p]=Lib.apply(o[p]||{},ref[p],deep,original)}else{o[p]=ref[p]}}}return o};Lib.register=function(name,fn){var ns=name.split(".");var obj={},tmp,nsobj=Lib;while(tmp=ns.shift()){if(ns.length){if(nsobj[tmp]===undefined){nsobj[tmp]={}}nsobj=nsobj[tmp]}else{if(nsobj[tmp]===undefined){nsobj[tmp]=fn(Lib)}}}};Core.Dom.getTop=function(element){var top=0;var el=$E(element);if(typeof el.offsetParent!="unknown"){while(el.offsetParent){top+=el.offsetTop;el=el.offsetParent}}else if(el.y){top+=el.y}return top};Core.Dom.getLeft=function(element){var left=0;var el=$E(element);if(typeof el.offsetParent!="unknown"){while(el.offsetParent){left+=el.offsetLeft;el=el.offsetParent}}else if(el.x){left+=el.x}return left};Lib.HtmlTemplate=function(tmpl,uniqueID){this.uniqueID=uniqueID}.$extends(Ui.Template).$define({getHtmlString:function(){if(!this._htmlStr){this._htmlStr=this.evaluate(this.getNodeIds())}return this._htmlStr},getNodeIds:function(){if(!this._nodes){var p=/\{[^\}]+(?=\})/g,i,nodes={},rets,r,uniqueID=this._getUniqueID();this.__templateNodesIDs=this.tmpl.match(p);rets=this.__templateNodesIDs;if(rets){i=rets.length;while(i--){r=rets[i].replace("{","");nodes[r]="_"+uniqueID+"_"+r}}this._nodes=nodes}return this._nodes},getNodeId:function(name){if(!this._nodes){this.getNodeIds()}return this._nodes[name]},getNode:function(name){var id=this.getNodeId(name);return!id?null:$E(id)},_getUniqueID:function(){if(!this.uniqueID){this.uniqueID=parseInt(Math.random()*1e3).toString()+(new Date).getTime().toString()}return this.uniqueID}});Lib.Panel=Core.Class.create();Lib.Panel.prototype={noIframe:!1,isPostion:!0,appendTo:null,entity:null,backIframe:null,uniqueID:null,isFixed:false,isShow:!1,isHidden:!0,x:0,y:0,template:"",initialize:function(cfg){Lib.apply(this,cfg);var _this=this;this.uniqueID=this._getUniqueID();this._ie6Fixed=function(){if(_this.entity){_this.entity.style.left=document.documentElement.scrollLeft+_this.x+"px";_this.entity.style.top=document.documentElement.scrollTop+_this.y+"px"}if(_this.backIframe){_this.backIframe.style.left=_this.entity.style.left;_this.backIframe.style.top=_this.entity.style.top}}},getNode:function(name){return this.tpl.getNode(name)},setTemplate:function(template){this.template=template;if(this.entity&&this.entity.parentNode){this.entity.parentNode.removeChild(this.entity);this.backIframe&&this.backIframe.parentNode.removeChild(this.backIframe)}this.entity=$C("div");var tempEntity=$C("div");var tmp=new Lib.HtmlTemplate(this.template,this.uniqueID);this.tpl=tmp;tempEntity.innerHTML=tmp.getHtmlString();tempEntity.style.display="none";if(this.appendTo){$E(this.appendTo).appendChild(tempEntity)}else{document.body.appendChild(tempEntity)}this.entity=$E("_"+this.uniqueID+"_panel");if(this.isPostion){this.entity.style.position="absolute"}this.entity.style.display="none";if(this.appendTo){$E(this.appendTo).replaceChild(this.entity,tempEntity)}else{document.body.replaceChild(this.entity,tempEntity)}tempEntity=null;if(!this.noIframe){this.backIframe=$C("iframe");this.backIframe.style.display="none";this.backIframe.style.border="none";this.backIframe.style.zIndex=this.entity.style.zIndex-1;document.body.appendChild(this.backIframe);this._updateBackIframe()}},setPosition:function(x,y){this.x=x;this.y=y;this.entity.style.left=x+"px";this.entity.style.top=y+"px";if($IE6&&this.isFixed){this.entity.style.left=x+document.documentElement.scrollLeft+"px";

this.entity.style.top=y+document.documentElement.scrollTop+"px"}if(this.backIframe){this.backIframe.style.left=this.entity.style.left;this.backIframe.style.top=this.entity.style.top}},setFixed:function(state){this.isFixed=state;if($IE6){var _this=this;this.entity.style.position="absolute";if(this.isFixed){_this._ie6Fixed();Core.Events.addEvent(window,_this._ie6Fixed,"scroll")}else{Core.Events.removeEvent(window,_this._ie6Fixed,"scroll")}return}this.entity.style.position=this.isFixed?"fixed":"absolute";if(this.backIframe){this.backIframe.style.position=this.entity.style.position}},show:function(){this.entity.style.display="";this.isHidden=!1;this.isShow=!0;if(this.backIframe){this._updateBackIframe();this.backIframe.style.display=""}},hidden:function(){this.hide()},hide:function(){this.entity.style.display="none";this.isHidden=!0;this.isShow=!1;if(this.backIframe){this.backIframe.style.display="none"}},close:function(){this.hidden();this.destroy()},destroy:function(){Core.Events.removeEvent(window,this._ie6Fixed,"scroll");this.entity.parentNode.removeChild(this.entity);this.entity=null;if(this.backIframe){this.backIframe.parentNode.removeChild(this.backIframe);this.backIframe=null}},showWithDom:function(dom,offsetLeft,offsetTop){var x=Core.Dom.getLeft(dom)+dom.offsetWidth+offsetLeft;var y=Core.Dom.getTop(dom)+dom.offsetHeight+offsetTop;if($IE6&&this.isFixed){x=x-document.documentElement.scrollLeft;y=y-document.documentElement.scrollTop}this.setPosition(x,y);this.show()},getWidth:function(){var ld=this.entity.style.display;var lv=this.entity.style.visibility;this.entity.style.visibility="hidden";this.entity.style.display="";w=this.entity.offsetWidth;this.entity.style.display=ld;this.entity.style.visibility=lv;return w},getHeight:function(){var ld=this.entity.style.display;var lv=this.entity.style.visibility;this.entity.style.visibility="hidden";this.entity.style.display="";h=this.entity.offsetHeight;this.entity.style.display=ld;this.entity.style.visibility=lv;return h},getX:function(){return parseInt(this.entity.style.left)},getY:function(){return parseInt(this.entity.style.top)},getNodes:function(mode){var m=mode||"o";var pattern=/[^\{\}]+(?=\})/g;var i;var nodes={};var result=this.template.match(pattern);if(result){for(i=0;i<result.length;i++){var r=result[i];switch(m){case"o":nodes[r]=$E("_"+this.uniqueID+"_"+r);break;case"i":nodes[r]="_"+this.uniqueID+"_"+r;break}}}return nodes},_updateBackIframe:function(){Core.Dom.setStyle(this.backIframe,"opacity",0);this.backIframe.style.display="";this.backIframe.style.position=this.entity.style.position;this.backIframe.style.width=this.entity.offsetWidth+"px";this.backIframe.style.height=this.entity.offsetHeight+"px";this.backIframe.style.left=this.entity.style.left;this.backIframe.style.top=this.entity.style.top},_getUniqueID:function(){return parseInt(Math.random()*1e3).toString()+(new Date).getTime().toString()}};Lib.register("Listener",function(){var _this={};_this.listeners={};return{add:function(name){if(_this.listeners[name]){throw new Error("listener '"+name+"' has registed!")}_this.listeners[name]=[]},remove:function(name){if(_this.listeners[name]){_this.listeners[name]=null;return true}return false},notify:function(name,data){var listeners=_this.listeners[name],handle=null;if(!listeners){return}for(var i=0,len=listeners.length;i<len;i++){handle=listeners[i];handle.callBack.call(handle.scope,data)}},on:function(o){var args=arguments,handle=null;for(var i=0,len=args.length;i<len;i++){handle=args[i];if(!this.isListen(handle)){if(!_this.listeners[handle.name]){_this.listeners[handle.name]=[]}_this.listeners[handle.name].push(handle)}}},off:function(o){var handlers=_this.listeners[o.name];if(!handlers){return true}var handle=null;for(var i=0,len=handlers.length;i<len;i++){handle=handlers[i];if(handle.callBack==o.callBack&&handle.scope==o.scope){handlers.splice(i,1)}}},isListen:function(listener){var handlers=_this.listeners[listener.name];var handle=null;if(!handlers){return false}for(var i=0,len=handlers.length;i<len;i++){handle=handlers[i];if(handle.callBack==listener.callBack&&handle.scope==listener.scope){return true}}return false}}});Lib.register("util.JSON",function(lib){var json=function(wnd,undefined){if(wnd.JSON)return wnd.JSON;var json={parse:function(sJSON){return new Function("return "+sJSON)()},stringify:function(vContent){if(vContent instanceof Object){var sOutput="";if(vContent.constructor===Array){for(var nId=0;nId<vContent.length;sOutput+=this.stringify(vContent[nId])+",",nId++);return"["+sOutput.substr(0,sOutput.length-1)+"]"}if(vContent.toString!==Object.prototype.toString){return'"'+vContent.toString().replace(/"/g,"\\$&")+'"'}for(var sProp in vContent){sOutput+='"'+sProp.replace(/"/g,"\\$&")+'":'+this.stringify(vContent[sProp])+","}return"{"+sOutput.substr(0,sOutput.length-1)+"}"}return typeof vContent==="string"?'"'+vContent.replace(/"/g,"\\$&")+'"':String(vContent)}};return json}(window);return json});Core.Events.fixEvent=function(e){if(typeof e=="undefined")e=window.event;if(!e.target){e.target=e.srcElement;e.pageX=e.x;e.pageY=e.y}if(typeof e.layerX=="undefined")e.layerX=e.offsetX;if(typeof e.layerY=="undefined")e.layerY=e.offsetY;return e};Core.Events.getEventTarget=function(ev){ev=ev||Core.Events.getEvent();Core.Events.fixEvent(ev);return ev.target};Lib.pkg("util");Lib.util.hoverJq=function(conf){var _default={elm:document.body,mouseenter:function(evt,el,index){},mouseleave:function(evt,el,index){},delay:0};conf=Lib.apply(_default,conf);var enterType=$IE?"mouseenter":"mouseover",leaveType=$IE?"mouseleave":"mouseout";if(!("length"in conf.elm)){conf.elm=[conf.elm]}else{try{conf.elm=Array.prototype.slice.call(conf.elm,0)}catch(e){var tmpArr=[];for(var i=0,len=conf.elm.length;i<len;i++){tmpArr.push(conf.elm[i])}conf.elm=tmpArr}}Core.Array.foreach(conf.elm,function(one,index){Core.Events.removeEvent(one,enterType);Core.Events.removeEvent(one,leaveType);Core.Events.addEvent(one,function(el,func,i){return function(evt){evt=evt||window.event;if($IE){func.apply(el,[evt,el,i])}else{withinElement(evt,"mouseenter",el,i)}}}(one,conf[enterType],index),enterType);Core.Events.addEvent(one,function(el,func,i){return function(event){if($IE){func.apply(el,[event,el,i])}else{withinElement(event,"mouseleave",el,i)}}}(one,conf[leaveType],index),leaveType)});var withinElement=function(event,mouseType,elm,i){var parent=event.relatedTarget;try{if(parent&&parent!==document&&!parent.parentNode){return}while(parent&&parent!==elm){parent=parent.parentNode}if(parent!==elm){conf[mouseType].apply(elm,[event,elm,i])}}catch(e){}return false}};Lib.register("tray.tpl.loginMemu",function(){var tpl=['<div class="ntopbar_menu" id="#{panel}">','<div id="#{openBlog}" style="display:none;">','<span class="link" id="#{userMenu}"><a id="#{userNick}" onclick="v7sendLog(\'40_01_21\');return false;" href="###">读取中...</a><a href="javascript:;" class="link_arrow" title=""></a></span>','<span id="#{msnHolder}" class="ico_msn" style="display:none"><a id="#{msnLink}" href="http://control.blog.sina.com.cn/blogprofile/msnbind.php?c=" target="_blank"><img height="18" width="18" align="absmiddle" class="SG_icon SG_icon136" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif"></a></span>','<span class="line_s"></span>','<span class="link"><a onclick="v7sendLog(\'40_01_27\')" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1">个人中心</a></span>','<span class="line_s"></span>','<em id="#{newFeed}" class="mtip" style="left:341px;display:none;cursor:pointer;"></em>','<span class="link" id="#{blogMenu}"><a target="_blank" onclick="v7sendLog(\'40_01_24\')" href="http://control.blog.sina.com.cn/admin/article/article_add.php">发博文</a><a id="#{addArticle}" onclick="v7sendLog(\'40_01_25\');return false;" href="###" class="link_arrow"></a></span>','<span class="line_s"></span>','<span class="link" id="#{trayMsg}" msg-panel-show-state="0"><a onclick="v7sendLog(\'40_01_30\');return false;" href="###">消息</a><a href="javascript:return false;" class="link_arrow" title=""></a></span>','<em id="#{newTips}" onclick="v7sendLog(\'40_01_29\')" class="mtip" style="left:341px;display:none;cursor:pointer;"></em>',"</div>",'<div id="#{noOpenBlog}" style="display:none;">','<span class="link"><a id="#{ssoNick}" onclick="v7sendLog(\'40_01_40\');return false;" href="###">读取中...</a></span>','<span class="line_s"></span>','<span class="link"><a id="#{ssoLoginOut}" onclick="v7sendLog(\'40_01_41\');return false;" href="###">退出</a></span>','<div class="ntopbar_login" style="float:left;"><a id="#{openBlogBtn}" onclick="v7sendLog(\'40_01_42\')" class="login" href="###"><span>立即拥有一个新博客</span></a></div>',"</div>","</div>"].join("");return tpl});Lib.register("tray.tpl.loginOutMemu",function(){var uid=scope.$uid||"";var regLink="http://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid="+uid+"&src=";if(scope.$channel==2){regLink+="baby"}else{regLink+="blogicp"}var tpl=['<div id="#{panel}" class="ntopbar_login">','<a class="login" onclick="v7sendLog(\'40_01_38\');return false;" href="###" action-type="tray-login-btn"><span>登录</span></a>','<a class="register" onclick="v7sendLog(\'40_01_39\')" target="_blank" href="',regLink,'">注册</a></div>'].join("");return tpl});Core.Class.extend=function(destination,supClass,bForce){for(var property in supClass){if(bForce!=null){if(!destination[property]){destination[property]=supClass[property]}}else{destination[property]=supClass[property]}}return destination};Core.Class.define=function(init,superClz,methods){if(init&&init.__isClass&&init.__isClass()){throw new Error("class cnt be used as another class' constructor : "+init)}superClz=superClz||Object;methods=methods||{};methods.initialize=init||methods.initialize||superClz.prototype.initialize||function(){};if(typeof methods.initialize!="function"){throw new Error("only function can be used as constructor")}methods.__isClass=function(){return true};var clz=Core.Class.create();clz.__isClass=methods.__isClass;var proto=superClz==Object?{}:new superClz(Core.Class.AsPrototype);clz.prototype=Core.Class.extend(proto,methods);return clz};Sina.pkg("Utils.Io");Sina.pkg("Core.System");(function(){var parseParam=function(oSource,oParams){var key;try{if(typeof oParams!="undefined"){for(key in oSource){if(oParams[key]!=null){oSource[key]=oParams[key]}}}}finally{key=null;return oSource}};Core.System.parseParam=parseParam})();Sina.pkg("Core.String");Utils.Url=function(url){url=url||"";this.url=url;this.query={};this.parse()};Utils.Url.prototype={parse:function(url){if(url){this.url=url}this.parseAnchor();this.parseParam()},parseAnchor:function(){var anchor=this.url.match(/\#(.*)/);anchor=anchor?anchor[1]:null;this._anchor=anchor;if(anchor!=null){this.anchor=this.getNameValuePair(anchor);this.url=this.url.replace(/\#.*/,"")}},parseParam:function(){var query=this.url.match(/\?([^\?]*)/);query=query?query[1]:null;if(query!=null){this.url=this.url.replace(/\?([^\?]*)/,"");this.query=this.getNameValuePair(query)}},getNameValuePair:function(str){var o={};str.replace(/([^&=]*)(?:\=([^&]*))?/gim,function(w,n,v){if(n==""){return}o[n]=v||""});return o},getParam:function(sPara){return this.query[sPara]||""},clearParam:function(){this.query={}},setParam:function(name,value){if(name==null||name==""||typeof name!="string"){throw new Error("no param name set")}this.query=this.query||{};this.query[name]=value},setParams:function(o){this.query=o},serialize:function(o){var ar=[];for(var i in o){if(o[i]==null||o[i]==""){ar.push(i+"=")}else{ar.push(i+"="+o[i])}}return ar.join("&")},toString:function(){var queryStr=this.serialize(this.query);return this.url+(queryStr.length>0?"?"+queryStr:"")+(this.anchor?"#"+this.serialize(this.anchor):"")},getHashStr:function(forceSharp){return this.anchor?"#"+this.serialize(this.anchor):forceSharp?"#":""}};Core.String.encodeDoubleByte=function(str){if(typeof str!="string"){return str}return encodeURIComponent(str)};Utils.Io.JsLoad={};(function(){function createScripts(oOpts,oCFG){processUrl(oOpts,oCFG);var urls=oOpts.urls;var i,len=urls.length;for(i=0;i<len;i++){var js=$C("script");js.src=urls[i].url;js.charset=urls[i].charset;js.onload=js.onerror=js.onreadystatechange=function(){if(js&&js.readyState&&js.readyState!="loaded"&&js.readyState!="complete"){return}oCFG.script_loaded_num++;js.onload=js.onreadystatechange=js.onerror=null;if(!1!==oOpts.isRemove){js.src="";js.parentNode.removeChild(js)}js=null};document.getElementsByTagName("head")[0].appendChild(js)}}function processUrl(oOpts,oCFG){var urls=oOpts.urls;var get_hash=oOpts.GET;var i,len=urls.length;var key,url_cls,varname,rnd;for(i=0;i<len;i++){rnd=window.parseInt(Math.random()*1e8);url_cls=new Utils.Url(urls[i].url);for(key in get_hash){if(oOpts.noencode==true){url_cls.setParam(key,get_hash[key])}else{url_cls.setParam(key,Core.String.encodeDoubleByte(get_hash[key]))}}varname=url_cls.getParam("varname")||"requestId_"+rnd;if(oOpts.noreturn!=true){url_cls.setParam("varname",varname)}if(oOpts.returnType=="jsonp"){var name=url_cls.getParam("callback")||"callback_"+rnd;var callback="script_callbackes."+name;url_cls.setParam("callback",callback);if(!window.script_callbackes){window.script_callbackes=[]}window.script_callbackes[name]=function(res){oCFG.is_loadcomplete=true;delete window.script_callbackes[name];if(oCFG.timeout_flag!=null){clearTimeout(oCFG.timeout_flag)}if(oCFG.is_timeout){return}if(oOpts.onComplete!=null){oOpts.onComplete(res)}}}oCFG.script_var_arr.push(varname);urls[i].url=url_cls.toString();urls[i].charset=urls[i].charset||oOpts.charset}}function ancestor(aUrls,oOpts){var _opts={isRemove:!0,urls:[],charset:"utf-8",noreturn:false,noencode:false,returnType:"",timeout:-1,POST:{},GET:{},onComplete:null,onException:null};var _cfg={script_loaded_num:0,is_timeout:false,is_loadcomplete:false,script_var_arr:[],timeout_flag:null};_opts.urls=typeof aUrls=="string"?[{url:aUrls}]:aUrls;Core.System.parseParam(_opts,oOpts);createScripts(_opts,_cfg);if(_opts.returnType!="jsonp"){(function(){if(_opts.noreturn==true&&_opts.onComplete==null){return}var i,data=[];if(_cfg.script_loaded_num==_opts.urls.length){_cfg.is_loadcomplete=true;if(_opts.onComplete!=null){for(i=0;i<_cfg.script_var_arr.length;i++){data.push(window[_cfg.script_var_arr[i]])}if(_cfg.script_var_arr.length<2){_opts.onComplete(data[0])}else{_opts.onComplete(data)}}return}if(_cfg.is_timeout==true){return}setTimeout(arguments.callee,50)})()}if(_opts.timeout>0){_cfg.timeout_flag=setTimeout(function(){if(_cfg.is_loadcomplete!=true){if(_opts.onException!=null){_opts.onException()}_cfg.is_timeout=true}},_opts.timeout)}}Utils.Io.JsLoad.request=function(aUrls,oOpts){new ancestor(aUrls,oOpts)}})();Core.System.keyValue=function(string,key){var arr=string.match(new RegExp("(\\?|&)"+key+"=([^&]*)(&|$)"));if(arr!=null)return arr[2];return null};Lib.checkAuthor=function(){var AuthorInfo=unescape(Utils.Cookie.getCookie("SUP"));if(AuthorInfo&&AuthorInfo!=""){$UID=Core.System.keyValue(AuthorInfo,"uid");$nick=decodeURIComponent(Core.System.keyValue(AuthorInfo,"nick"));$isLogin=!!$UID;if(typeof scope.$uid=="undefined"){$isAdmin=false}else{$isAdmin=scope.$uid==$UID}}else{AuthorInfo=Utils.Cookie.getCookie("SU");if(AuthorInfo&&AuthorInfo!=""){var match=AuthorInfo.match(/^([^:]*:){2}(\d{5,11})/);$UID=match&&match[2]||null;window.$isLogin=!!$UID;if(typeof scope.$uid=="undefined"){window.$isAdmin=false}else{window.$isAdmin=scope.$uid==$UID}}else{$UID=null;$isLogin=false;$isAdmin=false}}};function v6SendLog(type,label){}function v7sendLog(type,pageid,msg){if(!type){return false}if(type.split("_").length==3){Lib.checkAuthor();if($isLogin){type+="_"+$UID}}if(typeof scope=="undefined"){window.scope={};scope.$pageid=""}pageid=pageid||scope.$pageid;msg=msg||"";Utils.Io.JsLoad.request("http://hits.sinajs.cn/A2/b.html?type="+type+"&pageid="+pageid+"&msg="+msg,{onComplete:function(){}})}Lib.register("tray.tpl.userMenu",function(){var tpl=['<div id="#{panel}" class="mUserMenu">',"<ul>","<li>",'<span class="tb_ps_nm"><a id="#{linkBlog}" onclick="v7sendLog(\'40_01_22\')" href="###"><img class="SG_icon SG_icon15" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="博客" align="absmiddle">博客</a></span>','<span class="rlink"><a target="_blank" onclick="v7sendLog(\'40_01_22\')" id="#{linkPostBlog}" href="http://control.blog.sina.com.cn/admin/article/article_add.php">发博文</a></span>',"</li>",'<li> <span class="tb_ps_nm"><a id="#{linkPhoto}" onclick="v7sendLog(\'40_01_22\')" href="###"><img class="SG_icon SG_icon18" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="相册" align="absmiddle">相册</a></span> <span class="rlink"><a target="_blank" id="#{linkPostPhoto}" onclick="v7sendLog(\'40_01_22\')" href="http://photo.blog.sina.com.cn/upload/upload.php">发图片</a></span> </li>','<li> <span class="tb_ps_nm"><a id="#{miniblog}" onclick="v7sendLog(\'40_01_22\')" href="###" target="_blank"><img class="SG_icon SG_icon110" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="17" title="微博" align="absmiddle">微博</a></span> </li>','<li style="display:none;" id="#{mail}"> <span class="tb_ps_nm"><a id="#{bindEmail}" target="_blank" href="http://mail.sina.com.cn/?s=2" onclick="v7sendLog(\'40_01_22\')"><img class="SG_icon SG_icon212" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="13" title="邮件" align="absmiddle">邮件</a></span> </li>','<li> <span class="tb_ps_nm"><a id="#{mySpace}" onclick="v7sendLog(\'40_01_22\')" href="###"><img class="SG_icon SG_icon41" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="关于我" align="absmiddle">关于我</a></span> </li>',"</ul>",'<div class="links">','<p><a target="_blank" id="#{linkChangeFace}" onclick="v7sendLog(\'40_01_22\')" href="###">修改头像昵称&gt;&gt;</a></p>','<p><a target="_blank" id="#{linkChangePassword}" onclick="v7sendLog(\'40_01_22\')" href="###">修改登录密码&gt;&gt;</a></p>','<p><a target="_blank" id="#{linkAccountSetup}" onclick="v7sendLog(\'40_01_22\')" href="###">帐号安全设置&gt;&gt;</a></p>','<p><a id="#{loginOut}" onclick="v7sendLog(\'40_01_23\');return false;" href="#">退出&gt;&gt;</a></p>',"</div>","</div>"].join("");return tpl});Core.String.j2o=function(str){if(!str||str==""){return null}try{var o=window.eval("("+str+")");return o}catch(e){trace("j2o : 数据分析出错");traceError(e);return null}};Core.Dom.getElementsByClass=function(el,tg,clz){el=el||document;var rs=[];clz=" "+clz+" ";var cldr=el.getElementsByTagName(tg),len=cldr.length;for(var i=0;i<len;++i){var o=cldr[i];if(o.nodeType==1){var ecl=" "+o.className+" ";if(ecl.indexOf(clz)!=-1){rs[rs.length]=o}}}return rs};Core.Dom.byClz=Core.Dom.getElementsByClass;Utils.Io.Ijax={arrTaskLists:[],createLoadingIframe:function(){if(this.loadFrames!=null){return false}var rndId1="loadingIframe_thread"+Math.ceil(Math.random()*1e4);var rndId2="loadingIframe_thread"+Math.ceil((Math.random()+1)*1e4);this.loadFrames=[rndId1,rndId2];var html='<iframe id="'+rndId1+'" name="'+rndId1+'" class="invisible"\r\n	              scrolling="no" src=""\r\n	              allowTransparency="true" style="display:none;" frameborder="0"\r\n	              ></iframe>\r\n				  <iframe id="'+rndId2+'" name="'+rndId2+'" class="invisible"\r\n	              scrolling="no" src=""\r\n	              allowTransparency="true" style="display:none;" frameborder="0"\r\n	              ></iframe>';var oIjaxIframeCnt=$C("div");oIjaxIframeCnt.id="ijax_iframes";oIjaxIframeCnt.innerHTML=html;trace("创建 Ijax 需要的 iframe");document.body.appendChild(oIjaxIframeCnt);var loadTimer=setInterval(Core.Function.bind2(function(){if($E(this.loadFrames[0])!=null&&$E(this.loadFrames[1])!=null){clearInterval(loadTimer);loadTimer=null;this.loadingIframe={thread1:{container:$E(this.loadFrames[0]),isBusy:false},thread2:{container:$E(this.loadFrames[1]),isBusy:false}};this.loadByList()}},this),10)},isIjaxReady:function(){if(typeof this.loadingIframe=="undefined"){return false}for(var oLoadCnt in this.loadingIframe){if(this.loadingIframe[oLoadCnt].isBusy==false){this.loadingIframe[oLoadCnt].isBusy=true;return this.loadingIframe[oLoadCnt]}}return false},request:function(url,option){var oTask={};oTask.url=url;oTask.option=option||{};this.arrTaskLists.push(oTask);if(this.loadFrames==null){this.createLoadingIframe()}else{this.loadByList()}},loadByList:function(){if(this.arrTaskLists.length==0){return false}var loadStatus=this.isIjaxReady();if(loadStatus==false){return false}var newData=this.arrTaskLists[0];this.loadData(newData.url,newData.option,loadStatus);this.arrTaskLists.shift()},loadData:function(url,option,loader){var _url=new Utils.Url(url);if(option.GET){for(var key in option.GET){_url.setParam(key,Core.String.encodeDoubleByte(option.GET[key]))}}if(!/\bdomain\b/.test(url)){_url.setParam("domain","1")}_url=_url.toString();var ifm=loader.container;ifm.listener=Core.Function.bind2(function(){try{var iframeObject=ifm.contentWindow.document,sResult;var tArea=Core.Dom.byClz(iframeObject,"textarea","")[0];if(typeof tArea!="undefined"){sResult=tArea.value}else{sResult=iframeObject.body.innerHTML}if(option.onComplete){option.onComplete(sResult)}else{option.onException()}}catch(e){traceError(e);if(option.onException){option.onException(e.message,_url.toString())}}loader.isBusy=false;Core.Events.removeEvent(ifm,ifm.listener,"load");this.loadByList()},this);Core.Events.addEvent(ifm,ifm.listener,"load");if(option.POST){var oIjaxForm=$C("form");oIjaxForm.id="IjaxForm";oIjaxForm.action=_url;oIjaxForm.method="post";oIjaxForm.target=ifm.id;for(var oItem in option.POST){var value;if(option.noEncode){value=Core.String.encodeDoubleByte(option.POST[oItem])}else{value=option.POST[oItem]}var oInput=$C("input");oInput.type="hidden";oInput.name=oItem;oInput.value=value;oIjaxForm.appendChild(oInput)}document.body.appendChild(oIjaxForm);oIjaxForm.submit()}else{try{window.frames(ifm.id).location.href=_url}catch(e){ifm.src=_url}}}};Utils.Io.Ajax={createRequest:function(){var request=null;try{request=new XMLHttpRequest}catch(trymicrosoft){try{request=new ActiveXObject("Msxml2.XMLHTTP")}catch(othermicrosoft){try{request=ActiveXObject("Microsoft.XMLHTTP")}catch(failed){}}}if(request==null){}else{return request}},request:function(url,option){option=option||{};option.onComplete=option.onComplete||function(){};option.onException=option.onException||function(){};option.returnType=option.returnType||"txt";option.method=option.method||"get";option.data=option.data||{};if(typeof option.GET!="undefined"&&typeof option.GET.url_random!="undefined"&&option.GET.url_random==0){this.rand=false;option.GET.url_random=null}return this.loadData(url,option)},loadData:function(url,option){var request=this.createRequest(),tmpArr=[];var _url=new Utils.Url(url);if(option.POST){for(var postkey in option.POST){var postvalue=option.POST[postkey];if(postvalue!=null){tmpArr.push(postkey+"="+Core.String.encodeDoubleByte(postvalue))}}}var sParameter=tmpArr.join("&")||"";if(option.GET){for(var key in option.GET){if(key!="url_random"){_url.setParam(key,Core.String.encodeDoubleByte(option.GET[key]))}}}if(this.rand!=false){}request.onreadystatechange=function(){if(request.readyState==4){var response,type=option.returnType;try{switch(type){case"txt":response=request.responseText;break;case"xml":if($IE){response=request.responseXML}else{var Dparser=new DOMParser;response=Dparser.parseFromString(request.responseText,"text/xml")}break;case"json":response=eval("("+request.responseText+")");break}option.onComplete(response)}catch(e){option.onException(e.message,_url);return false}}};try{if(option.POST){request.open("POST",_url,true);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");request.send(sParameter)}else{request.open("GET",_url,true);request.send(null)}}catch(e){option.onException(e.message,_url);return false}return request}};if($IE6&&typeof Utils.Io.Ijax!="undefined"){Utils.Io.Ijax.loadData=function(url,option,loader){var _url=new Utils.Url(url);if(option.GET){for(var key in option.GET){_url.setParam(key,Core.String.encodeDoubleByte(option.GET[key]))}}if(!/\bdomain\b/.test(url)){_url.setParam("domain","1")}_url=_url.toString();var ifm=loader.container;ifm.listener=Core.Function.bind2(function(){try{var iframeObject=ifm.contentWindow.document,sResult;var tArea=Core.Dom.byClz(iframeObject,"textarea","")[0];if(typeof tArea!="undefined"){sResult=tArea.value}else{sResult=iframeObject.body.innerHTML}if(option.onComplete){option.onComplete(sResult)}else{option.onException()}}catch(e){traceError(e);if(option.onException){option.onException(e.message,_url.toString())}}loader.isBusy=false;Core.Events.removeEvent(ifm,ifm.listener,"load");this.loadByList()},this);Core.Events.addEvent(ifm,ifm.listener,"load");if(option.POST){var oIjaxForm=$C("form");oIjaxForm.id="IjaxForm";oIjaxForm.action=_url;oIjaxForm.method="post";oIjaxForm.target=ifm.id;for(var oItem in option.POST){var value;if(option.noEncode){value=Core.String.encodeDoubleByte(option.POST[oItem])}else{value=option.POST[oItem]}var oInput=$C("input");oInput.type="hidden";oInput.name=oItem;oInput.value=value;oIjaxForm.appendChild(oInput)}document.body.appendChild(oIjaxForm);var timenum=100;function innerfun(){if(timenum>0){try{oIjaxForm.submit()}catch(e){setTimeout(innerfun,10)}}timenum--}innerfun()}else{try{window.frames(ifm.id).location.href=_url}catch(e){ifm.src=_url}}}}var Interface=function(url,type){this.url=new Utils.Url(url);this.type=type.toLowerCase()};Interface.prototype={url:null,type:"",request:function(option){var err=option.onError;var suc=option.onSuccess;option.onComplete=option.onSuccess=function(result){try{if(typeof result=="string"){result=result.replace(/;$/,"")}result=typeof result=="string"&&/\s*{/.test(result)?Core.String.j2o(result):result;if(result!=null&&typeof result.code=="undefined"){trace("接口数据异常："+this.url,"#F00");return}if(result!=null){if(result.code=="A00006"){suc(result.data)}else{err(result)}}else{err(result)}}catch(e){traceError(e)}}.bind2(this);option.onException=option.onError=option.onFail||function(){trace("接口失败："+this.url,"#F00");if(arguments.length>0){for(var i=0,len=arguments.length;i<len;i++){if(arguments[i]&&typeof arguments[i]!="undefined"){trace("错误信息："+arguments[i].toString())}}}}.bind2(this);var requestURL=this.url.toString();switch(this.type){case"ijax":Utils.Io.Ijax.request(requestURL,option);break;case"ajax":Utils.Io.Ajax.request(requestURL,option);break;case"script":case"jsload":Utils.Io.JsLoad.request(requestURL,option);break;default:throw new Error("未指定有效的数据传输类型")}}};Lib.register("tray.loginOut",function(lib){var ls=lib.Listener;return function(cb,reload){var _curHref=encodeURIComponent(window.location.href);new Interface("http://control.blog.sina.com.cn/blog_rebuild/msn/api/msnLoginOut.php","jsload").request({onSuccess:function(res){ls.notify("global-login-out",res);cb&&cb(res);if(reload){window.location.href="http://login.sina.com.cn/cgi/login/logout.php?r="+_curHref}},onError:function(res){ls.notify("global-login-out",res);if(reload){window.location.href="http://login.sina.com.cn/cgi/login/logout.php?r="+_curHref}},onFail:function(res){ls.notify("global-login-out",res);if(reload){window.location.href="http://login.sina.com.cn/cgi/login/logout.php?r="+_curHref}}})}});Lib.register("tray.UserMenuPanel",function(lib){var userMenu=Core.Class.define(function(){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.userMenu)},lib.Panel,{initUserInfo:function(uid){var nodes=this.getNodes();nodes["linkBlog"].href="http://blog.sina.com.cn/u/"+uid;nodes["linkPhoto"].href="http://photo.blog.sina.com.cn/u/"+uid;nodes["miniblog"].href="http://control.blog.sina.com.cn/t_sina_blog/tb.php?uname="+uid;nodes["mySpace"].href="http://blog.sina.com.cn/s/profile_"+uid+".html";nodes["linkChangeFace"].href="http://control.blog.sina.com.cn/blogprofile/nick.php";nodes["linkChangePassword"].href="http://login.sina.com.cn/member/security/password.php";nodes["linkAccountSetup"].href="http://login.sina.com.cn/member/security.php";this.initLoginOut(nodes["loginOut"])},initLoginOut:function(outBtn){outBtn.onclick=function(){return false};Core.Events.addEvent(outBtn,function(){lib.tray.loginOut(null,!0)})}});return userMenu});Lib.register("tray.tpl.blogMenu",function(){var tpl=['<div id="#{panel}" class="wrtBlog_sub">','<div class="wrtBlog_sub3">','<p><a target="_blank" onclick="v7sendLog(\'40_01_26\')" href="http://control.blog.sina.com.cn/admin/article/article_add.php?tag365">写365</a></p>','<p><a target="_blank" onclick="v7sendLog(\'40_01_26\')" href="http://control.blog.sina.com.cn/admin/article/changWeiBo.php">长微博</a></p>','<p><a target="_blank" onclick="v7sendLog(\'40_01_26\')" href="http://photo.blog.sina.com.cn/upload/upload.php">发照片</a></p>',"</div>","</div>"].join("");return tpl});Lib.register("tray.BlogMenuPanel",function(lib){var blogMenu=Core.Class.define(function(){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.blogMenu)},lib.Panel,{});return blogMenu});Core.String.trimHead=function(str){return str.replace(/^(\u3000|\s|\t)*/gi,"")};Core.String.trimTail=function(str){return str.replace(/(\u3000|\s|\t)*$/gi,"")};Core.String.trim=function(str){return Core.String.trimHead(Core.String.trimTail(str))};Lib.register("tray.tpl.searchForm",function(){var tpl=['<div class="ntopbar_input" id="#{panel}">','<form id="#{searchForm}" method="get" target="_blank" action="http://search.sina.com.cn">','<input id="#{queryTxt}" class="ntopbar_txt" type="text" name="q" autocomplete="off"/>','<input id="#{submit}" type="submit" onclick="v7sendLog(\'40_01_44\')" class="ntopbar_searchBtn" value=""/>','<input type="hidden" name="ie" value="utf-8"/>','<input type="hidden" name="e" value="utf-8"/>','<input id="#{range}" type="hidden" name="range" value="article"/>','<input id="#{t}" type="hidden" name="t" value=""/>','<input id="#{s}" type="hidden" name="s" value="sup"/>','<input id="#{by}" type="hidden" name="by" value="all"/>','<input id="#{type}" type="hidden" name="type" value=""/>','<input id="#{stype}" type="hidden" name="stype" value="1"/>','<input id="#{c}" type="hidden" name="c" value="blog"/>',"</form>","</div>"].join("");return tpl});Core.Dom.addClass=function(obj,className){var _trim=Core.String.trim;className=_trim(className);if(!className){return obj}obj=$E(obj);var oldClz=_trim(obj.className||"");var tmpOldClz=" "+oldClz+" ";if(!oldClz){obj.className=_trim(className);return obj}var uClzs=className.split(" ");var uClz,newClzs=[];for(var i=0;i<uClzs.length;i++){uClz=uClzs[i];if(uClz&&-1===tmpOldClz.indexOf(" "+uClz+" ")){newClzs.push(uClz)}}obj.className=oldClz+" "+newClzs.join(" ");return obj};Core.Dom.removeClass=function(obj,className){obj=$E(obj);obj.className=obj.className.replace(new RegExp("\\s*\\b"+className+"\\b"),"")};Core.String.byteLength=function(str){if(typeof str=="undefined"){return 0}var aMatch=str.match(/[^\x00-\x80]/g);return str.length+(!aMatch?0:aMatch.length)};Core.String.leftB=function(str,len){var s=str.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**");str=str.slice(0,s.slice(0,len).replace(/\*\*/g," ").replace(/\*/g,"").length);if(Core.String.byteLength(str)>len)str=str.slice(0,str.length-1);return str};Lib.util.getActionData=function(evt,actionType,typeAttrName,dataAttrName){if(!actionType){throw"[Lib.util.getActionData] param actionType is undefined!"}evt=evt||window.event;var _getTarget=Core.Events.getEventTarget,tEl,delegateEl,typeStr,types,type,data,typeAttrName=typeAttrName||"action-type",dataAttrName=dataAttrName||"action-data";tEl=_getTarget(evt);delegateEl=evt.currentTarget||(document.documentElement||document.body);while(tEl&&tEl!=delegateEl){typeStr=tEl.getAttribute(typeAttrName)||"";types=typeStr.split(",");for(var i=0,len=types.length;i<len;i++){type=types[i];if(actionType===type){data=tEl.getAttribute(dataAttrName);return{actionType:actionType,targetEl:tEl,data:data}}}tEl=tEl.parentNode}return null};Lib.register("tray.tpl.cateSearch",function(){
var tpl=['<div id="#{panel}" class="mCatSearch">',"<ul>",'<li action-type="tray-search" onclick="v7sendLog(\'40_01_43\')" action-data="article" class="current">含“<span id="#{article}"></span>”的博文</li>','<li action-type="tray-search" onclick="v7sendLog(\'40_01_43\')" action-data="bloger">含“<span id="#{bloger}"></span>”的博主</li>','<li action-type="tray-search" onclick="v7sendLog(\'40_01_43\')" action-data="music">含“<span id="#{music}"></span>”的音乐</li>','<li action-type="tray-search" onclick="v7sendLog(\'40_01_43\')" action-data="video">含“<span id="#{video}"></span>”的视频</li>',"</ul>","</div>"].join("");return tpl});Lib.register("tray.CateSearchPanel",function(lib){var _addEvt=Core.Events.addEvent;var leftB=Core.String.leftB;var byteLength=Core.String.byteLength;var catePanel=Core.Class.define(function(){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.cateSearch);this.initEvt()},lib.Panel,{initEvt:function(){var nodes=this.getNodes();var $lis=$T(nodes["panel"],"li");lib.util.hoverJq({elm:$lis,mouseenter:function(evt,el,index){Core.Dom.addClass(el,"current")},mouseleave:function(evt,el,index){Core.Dom.removeClass(el,"current")},delay:50});_addEvt(nodes["panel"],function(evt){evt=evt||window.event;var searchData=lib.util.getActionData(evt,"tray-search");if(searchData){lib.Listener.notify("tray-categroy-search",searchData.data)}})},updateSearch:function(v){if(5<byteLength(v)){v=leftB(v,4)+"..."}var value=v.replace(/(<|>)/g,function($1){if("<"===$1){return"&lt;"}else{return"&gt;"}});var nodes=this.getNodes();nodes["article"].innerHTML=value;nodes["bloger"].innerHTML=value;nodes["music"].innerHTML=value;nodes["video"].innerHTML=value}});return catePanel});Lib.register("tray.SearchFormPanel",function(lib){var _addEvt=Core.Events.addEvent;var _trim=Core.String.trim;var searchForm=Core.Class.define(function(cfg){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.searchForm);this.initEvt();this.catePanel=new lib.tray.CateSearchPanel;this.catePanel.entity.style.zIndex=512;lib.Listener.on({name:"tray-categroy-search",callBack:this.search,scope:this})},lib.Panel,{initEvt:function(){var me=this;var $queryTxt=this.getNode("queryTxt");_addEvt($queryTxt,function(evt){evt=evt||window.event;var target=evt.target||evt.srcElement;var offset=target.offsetWidth;me.showCateSearch(target,offset,target.value)},"input");_addEvt($queryTxt,function(evt){console.log(evt);evt=evt||window.event;if("value"!==evt.propertyName){return}var target=evt.target||evt.srcElement;var offset=target.offsetWidth;me.showCateSearch(target,offset,target.value)},"propertychange");_addEvt($queryTxt,function(evt){evt=evt||window.event;var target=evt.target||evt.srcElement;var offset=target.offsetWidth;me.showCateSearch(target,offset,target.value)},"focus");_addEvt(this.getNode("searchForm"),function(evt){evt=evt||window.event;var form=evt.target||evt.srcElement;if(!me.checkValidate(form)){Core.Events.stopEvent(evt)}else{setTimeout(function(){me.hideCateSearch();me.resetForm()},100)}},"submit");_addEvt(window,function(){if(me.catePanel.isShow){var offset=$queryTxt.offsetWidth;me.catePanel.showWithDom($queryTxt,-offset,4)}},"resize")},checkValidate:function(form){if("q"in form&&!_trim(form["q"].value))return false;else if("k"in form&&!_trim(form["k"].value))return false;else return true},setForm:function(url,cfg){var defaultValue={queryTxt:"q",ie:"utf-8",range:"",t:"",s:"",by:"",type:"",stype:"",e:"utf-8",c:""};var $searchForm=this.getNode("searchForm");$searchForm.action=url;lib.apply(defaultValue,cfg);var $queryTxt=this.getNode("queryTxt");$queryTxt.name=defaultValue["queryTxt"];delete defaultValue["queryTxt"];var attr,$query;for(var p in defaultValue){attr=defaultValue[p];if(typeof attr==="string"&&($query=this.getNode(p))){$query.value=attr}}},resetForm:function(){this.setForm("http://search.sina.com.cn",{queryTxt:"q",range:"article",s:"sup",by:"all",stype:"1",c:"blog"})},search:function(type){var $searchForm=this.getNode("searchForm");var blogSearchUrl="http://search.sina.com.cn";var videoSearchUrl="http://video.sina.com.cn/search/index.php";var musicSearchUrl="http://music.sina.com.cn/yueku/search/s.php";switch(type){case"video":this.setForm(videoSearchUrl,{queryTxt:"k",s:"sup",type:"boke",stype:"1"});break;case"bloger":this.setForm(blogSearchUrl,{queryTxt:"q",range:"author",s:"sup",by:"all",stype:"1",c:"blog"});break;case"music":this.setForm(musicSearchUrl,{queryTxt:"k",t:"song"});break;default:this.setForm(blogSearchUrl,{queryTxt:"q",range:"article",s:"sup",by:"all",stype:"1",c:"blog"})}if($IE){this.getNode("submit").click()}else{Core.Events.fireEvent(this.getNode("submit"),"click")}},showCateSearch:function($withEl,offset,v){var catePanel=this.catePanel;if(v&&catePanel.isHidden){catePanel.showWithDom($withEl,-offset,4)}else if(!v){this.hideCateSearch()}catePanel.updateSearch(v)},hideCateSearch:function(){var catePanel=this.catePanel;catePanel.hide();catePanel.updateSearch("")}});return searchForm});Core.Array.ArrayWithout=function(){if(arguments.length<2){return arguments.length==1?arguments[0]:null}var results=[];var aa=arguments[0];if(aa===null||aa.constructor!=Array){return null}if(arguments[1].constructor==Array){var args=[];args[0]=aa;Core.Array.foreach(arguments[1],function(v,i){args[i+1]=v})}else{args=arguments}for(var i=0;i<aa.length;i++){var isWithout=true;for(var j=1;j<args.length;j++){if(aa[i]==args[j]){isWithout=false;break}}if(isWithout){results.push(aa[i])}}return results};Lib.register("util.LS",function(lib){var ls;var Storage=function(wnd,undefined){var localStorageName="data-sina-blog-storage",localStorageKeys="data-sina-blog-storage-keys",doc=wnd.document,storageContainer=doc.createElement("input"),length,keys,removeArray=Core.Array.ArrayWithout,mark=function(key,isRemove,temp,reg){storageContainer.load(localStorageName);temp=storageContainer.getAttribute(localStorageKeys)||"";reg=RegExp("\\b"+key+"\\b,?","i");var hasKey=reg.test(temp)?1:0;temp=isRemove?temp.replace(reg,""):hasKey?temp:temp===""?key:temp.split(",").concat(key).join(",");storageContainer.setAttribute(localStorageKeys,temp);storageContainer.save(localStorageName)};var box=document.body||document.getElementsByTagName("head")[0]||document.documentElement;storageContainer.id="____storage_container_box";storageContainer.type="hidden";box.appendChild(storageContainer);storageContainer.addBehavior("#default#userData");storageContainer.load(localStorageName);var keyStr=storageContainer.getAttribute(localStorageKeys);keys=keyStr?keyStr.split(","):[];length=keys.length;return{key:function(index){if(isNaN(index)){index=0}return keys[parseInt(index,10)]},getItem:function(key){storageContainer.load(localStorageName);return storageContainer.getAttribute(key)},setItem:function(key,value){storageContainer.setAttribute(key,value);storageContainer.save(localStorageName);this.length++;keys.push(key);mark(key)},removeItem:function(key){storageContainer.removeAttribute(key);storageContainer.save(localStorageName);this.length--;removeArray(keys,key);mark(key,1)},clear:function(){storageContainer.load(localStorageName);var attrs=storageContainer.getAttribute(localStorageKeys).split(","),len=attrs.length;if(attrs[0]==="")return;for(var i=0;i<len;i++){storageContainer.removeAttribute(attrs[i]);storageContainer.save(localStorageName)}storageContainer.setAttribute(localStorageKeys,"");storageContainer.save(localStorageName);this.length=0},length:length}};var getStorage=function(wnd){if(wnd.localStorage){return wnd.localStorage}else if(wnd.sessionStorage){return wnd.sessionStorage}else if(wnd.globalStorage){return wnd.globalStorage}else{return Storage(wnd)}};var getLS=function(){if(!ls){ls=getStorage(window)}return ls};return{key:function(index){return getLS().key(index)},getItem:function(key){return getLS().getItem(key)},setItem:function(key,value){try{getLS().setItem(key,value);return true}catch(e){return false}},removeItem:function(key){return getLS().removeItem(key)},clear:function(){return getLS().clear()}}});Lib.register("tray.loadUserInfo",function(lib){var LS=lib.util.LS;var JSON=lib.util.JSON;var sendSever=function(uid,cb){var url="http://interface.blog.sina.com.cn/riaapi/profile/getNickName.php";Utils.Io.JsLoad.request(url,{GET:{uid:uid},onComplete:function(r){if(r&&"A00006"===r.code){var n=r.data.nickname;var saveObj={time:(new Date).getTime()/1e3};lib.apply(saveObj,r.data);LS.setItem("uid"+uid,JSON.stringify(saveObj));cb(saveObj)}},onException:function(){},timeout:1e4})};return function(uid,cb,froceSever){var nickInfo=LS.getItem("uid"+uid);if(!froceSever&&nickInfo){nickInfo=JSON.parse(nickInfo);var currentTime=(new Date).getTime()/1e3;var waitTime=currentTime-nickInfo.time;if(waitTime<4*60&&nickInfo.nickname){cb(nickInfo);return}}sendSever(uid,cb)}});Sina.pkg("Utils.Flash");if(typeof deconcept=="undefined")var deconcept=new Object;if(typeof deconcept.util=="undefined")deconcept.util=new Object;if(typeof deconcept.SWFObjectUtil=="undefined")deconcept.SWFObjectUtil=new Object;deconcept.SWFObject=function(swf,id,w,h,ver,c,quality,xiRedirectUrl,redirectUrl,detectKey){if(!document.getElementById){return}this.DETECT_KEY=detectKey?detectKey:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object;this.variables=new Object;this.attributes=new Array;if(swf){this.setAttribute("swf",swf)}if(id){this.setAttribute("id",id)}if(w){this.setAttribute("width",w)}if(h){this.setAttribute("height",h)}if(ver){this.setAttribute("version",new deconcept.PlayerVersion(ver.toString().split(".")))}this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){deconcept.SWFObject.doPrepUnload=true}if(c){this.addParam("bgcolor",c)}var q=quality?quality:"high";this.addParam("quality",q);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var xir=xiRedirectUrl?xiRedirectUrl:window.location;this.setAttribute("xiRedirectUrl",xir);this.setAttribute("redirectUrl","");if(redirectUrl){this.setAttribute("redirectUrl",redirectUrl)}};deconcept.SWFObject.prototype={useExpressInstall:function(path){this.xiSWFPath=!path?"expressinstall.swf":path;this.setAttribute("useExpressInstall",true)},setAttribute:function(name,value){this.attributes[name]=value},getAttribute:function(name){return this.attributes[name]},addParam:function(name,value){this.params[name]=value},getParams:function(){return this.params},addVariable:function(name,value){this.variables[name]=value},getVariable:function(name){return this.variables[name]},getVariables:function(){return this.variables},getVariablePairs:function(){var variablePairs=new Array;var key;var variables=this.getVariables();for(key in variables){variablePairs[variablePairs.length]=key+"="+variables[key]}return variablePairs},getSWFHTML:function(){var swfNode="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath)}swfNode='<embed pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" src="'+this.getAttribute("swf")+'" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'"';swfNode+=' id="'+this.getAttribute("id")+'" name="'+this.getAttribute("id")+'" ';var params=this.getParams();for(var key in params){swfNode+=[key]+'="'+params[key]+'" '}var pairs=this.getVariablePairs().join("&");if(pairs.length>0){swfNode+="flashvars="+pairs+'&realfull=1&moz=1"'}swfNode+="/>"}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath)}swfNode='<object id="'+this.getAttribute("id")+'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'">';swfNode+='<param name="movie" value="'+this.getAttribute("swf")+'" />';var params=this.getParams();for(var key in params){swfNode+='<param name="'+key+'" value="'+params[key]+'" />'}var pairs=this.getVariablePairs().join("&");if(pairs.length>0){swfNode+='<param name="flashvars" value="'+pairs+'" />'}swfNode+="</object>"}return swfNode},write:function(elementId){if(this.getAttribute("useExpressInstall")){var expressInstallReqVer=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(expressInstallReqVer)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title)}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){}else{if(this.getAttribute("redirectUrl")!=""){document.location.replace(this.getAttribute("redirectUrl"))}}var n=typeof elementId=="string"?document.getElementById(elementId):elementId;var oldTitle=document.title;n.innerHTML=this.getSWFHTML();if(oldTitle!==document.title){document.title=oldTitle}return true}};deconcept.SWFObjectUtil.getPlayerVersion=function(){var PlayerVersion=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description){PlayerVersion=new deconcept.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."))}}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;var counter=3;while(axo){try{counter++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+counter);PlayerVersion=new deconcept.PlayerVersion([counter,0,0])}catch(e){axo=null}}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");PlayerVersion=new deconcept.PlayerVersion([6,0,21]);axo.AllowScriptAccess="always"}catch(e){if(PlayerVersion.major==6){return PlayerVersion}}try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){}}if(axo!=null){PlayerVersion=new deconcept.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","))}}return PlayerVersion};deconcept.PlayerVersion=function(arrVersion){this.major=arrVersion[0]!=null?parseInt(arrVersion[0]):0;this.minor=arrVersion[1]!=null?parseInt(arrVersion[1]):0;this.rev=arrVersion[2]!=null?parseInt(arrVersion[2]):0};deconcept.PlayerVersion.prototype.versionIsValid=function(fv){if(this.major<fv.major)return false;if(this.major>fv.major)return true;if(this.minor<fv.minor)return false;if(this.minor>fv.minor)return true;if(this.rev<fv.rev)return false;return true};deconcept.util={getRequestParameter:function(param){var q=document.location.search||document.location.hash;if(param==null){return q}if(q){var pairs=q.substring(1).split("&");for(var i=0;i<pairs.length;i++){if(pairs[i].substring(0,pairs[i].indexOf("="))==param){return pairs[i].substring(pairs[i].indexOf("=")+1)}}}return""}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var objects=document.getElementsByTagName("OBJECT");for(var i=objects.length-1;i>=0;i--){objects[i].style.display="none";for(var x in objects[i]){if(typeof objects[i][x]=="function"){objects[i][x]=function(){}}}}};if(deconcept.SWFObject.doPrepUnload){if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs)};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true}}if(!document.getElementById&&document.all){document.getElementById=function(id){return document.all[id]}}var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;Utils.Flash.swfObject=deconcept.SWFObject;Lib.register("tray.MsgLoader",function(lib){var addFlash=function($flash){var $wrapper=$C("div");$wrapper.style.cssText="position:absolute;top:-1000px;left:-1000px;";document.body.appendChild($wrapper);$flash.write($wrapper)};var random="",FlaDom;if(window.$Maxthon||window.$360||window.$TT){random="?t="+Core.Math.getUniqueId()}var msgLoader=function(cfg){lib.apply(this,cfg);if(!FlaDom){try{var FlashPlayer=new Utils.Flash.swfObject($_GLOBAL.flashBasicURL+"blogMessageReminding.swf"+random,"__msgTipsPlayer","1px","1px","9","#00ff00");FlashPlayer.addParam("quality","high");FlashPlayer.addParam("wmode","transparent");FlashPlayer.addParam("allowScriptAccess","always");FlashPlayer.addParam("freeTime",27*1e3);if("complete"===document.readyState){addFlash(FlashPlayer);FlaDom=$E("__msgTipsPlayer")}else{_addEvt(window,function(){addFlash(FlashPlayer);FlaDom=$E("__msgTipsPlayer")},"load")}}catch(e){}}}.$define({time:30,url:"http://comet.blog.sina.com.cn/api?maintype=notice",getFlaDom:function(){return FlaDom},play:function(){if($_GLOBAL.msgPlaySound&&FlaDom&&FlaDom.PlaySound){try{FlaDom.PlaySound()}catch(e){}}},load:function(uid,cb){var $this=this;var blogid=scope.$articleid||"";if(!uid){return}Utils.Io.JsLoad.request(this.url,{GET:{uid:uid||"",blogid:blogid},onComplete:function(r){if(r&&"A00006"==r.code){var d,articleMsg;if(uid&&(d=r.data[uid])){var userMsg={};userMsg.sum=0;for(var k in d){userMsg[k]=d[k];userMsg.sum+=d[k]}userMsg.blogrecomment=userMsg.blogrecomment?userMsg.blogrecomment:0;lib.Listener.notify("tray-newmsg-loaded",userMsg)}if(blogid&&(articleMsg=r.data[blogid])){lib.Listener.notify("article-msg-loaded",articleMsg)}}},onException:function(){},timeout:1e4})}});return msgLoader});Lib.register("tray.tpl.notice",function(){var tpl=['<div id="#{panel}" class="horn">','<div id="#{tj}" class="horn_con" style="display:none;">推荐：<a id="#{noticeAd1}" target="_blank" href="#"></a><a id="#{noticeAd2}" target="_blank" href="#"></a></div>','<div id="#{announce}" class="horn_con" style="display:none;"><p id="#{announceCon}">公告：<em>请您及时更换请请请您正在使用的模版将于2周后被下线，请您及时更换</em></p></div>','<a class="close" title="关闭" id="#{close}" style="float:none;">×</a>',"</div>"].join("");return tpl});Lib.register("tray.BlogNotice",function(lib){var _addEvt=Core.Events.addEvent,setCookie=Utils.Cookie.setCookie,pageId=scope.$pageid;var notice=Core.Class.define(function(){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.notice);this.initEvt()},lib.Panel,{initEvt:function(){var $this=this;_addEvt(this.getNode("close"),function(evt){evt=evt||window.event;setCookie("closeNotice_fzp",$UID,24,"/",".blog.sina.com.cn");lib.Listener.notify("tray-announce-close",{});$this.destroy()})},update:function(json){var $tj=this.getNode("tj"),$announce=this.getNode("announce");var slotres="";var sourceArr=["SLOT_58","SLOT_59","SLOT_98","SLOT_99","SLOT_100","SLOT_101","SLOT_102"];var sloturl="http://comet.blog.sina.com.cn/api?maintype=pageslot";var reqdata={id:sourceArr};if(typeof scope!="undefined"){reqdata.blogeruid=scope.$uid}if($UID){reqdata.loginuid=$UID}if($isLogin&&json.announce.result&&(pageId==="indexM"||pageId==="articleM"||pageId==="articlelistM")){$announce.innerHTML=json.announce.announce_con;$announce.style.display=""}else{var noticeAd1=this.getNode("noticeAd1");var noticeAd2=this.getNode("noticeAd2");var complete=function(res){var randomIndex=0;var adcon1=res[sourceArr[0]].res;var adcon2=res[sourceArr[1]].res;if(adcon1||adcon2){if(adcon1){randomIndex=0;if(adcon1.length>1){randomIndex=Math.floor((adcon1.length+1)*Math.random())}noticeAd1.innerHTML=adcon1[randomIndex].words;noticeAd1.href=adcon1[randomIndex].a_href;noticeAd1.title=adcon1[randomIndex].a_title;noticeAd1.setAttribute("suda-uatrack",adcon1[randomIndex].a_c_suda.replace("suda-uatrack=","").replace('"',"").replace('"',""));if(typeof SUDA!=="undefined"){SUDA.uaTrack(adcon1[randomIndex].a_v_suda_key,adcon1[randomIndex].a_v_suda_value)}}if(adcon2){randomIndex=0;if(adcon2.length>1){randomIndex=Math.floor((adcon2.length+1)*Math.random())}noticeAd2.innerHTML=adcon2[randomIndex].words;noticeAd2.href=adcon2[randomIndex].a_href;noticeAd2.title=adcon2[randomIndex].a_title;noticeAd2.setAttribute("suda-uatrack",adcon2[randomIndex].a_c_suda.replace("suda-uatrack=","").replace('"',"").replace('"',""));if(typeof SUDA!=="undefined"){SUDA.uaTrack(adcon2[randomIndex].a_v_suda_key,adcon2[randomIndex].a_v_suda_value)}}$tj.style.display=""}};if(scope.__subscribeSlot==="waitting"){scope.__subscribeSlotFunc=complete}else if(typeof scope.__subscribeSlot==="object"){complete(scope.__subscribeSlot)}else{scope.__subscribeSlot="waitting";Utils.Io.JsLoad.request(sloturl,{GET:reqdata,onComplete:function(res){complete(res);scope.__subscribeSlot=res;if("function"==typeof scope.__subscribeSlotFunc){scope.__subscribeSlotFunc(res)}},onException:function(){}})}}},setTemplate:function(template){this.template=template;var tmp=new Lib.HtmlTemplate(this.template,this.uniqueID);this.tpl=tmp;Core.Dom.insertHTML($E(this.appendTo),tmp.getHtmlString(),"afterbegin");this.entity=$E("_"+this.uniqueID+"_panel");this.entity.style.display="none";tempEntity=null}});return notice});Core.Dom.getStyle=function(el,property){switch(property){case"opacity":var val=100;try{val=el.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(e){try{val=el.filters("alpha").opacity}catch(e){}}return val/100;case"float":property="styleFloat";default:var value=el.currentStyle?el.currentStyle[property]:null;return el.style[property]||value}};if(!$IE||$IE>8){Core.Dom.getStyle=function(el,property){if(property=="float"){property="cssFloat"}try{var computed=document.defaultView.getComputedStyle(el,"")}catch(e){traceError(e)}return el.style[property]||computed?computed[property]:null}}Core.System.getScrollPos=function(oDocument){oDocument=oDocument||document;var dd=oDocument.documentElement;var db=oDocument.body;return[Math.max(dd.scrollTop,db.scrollTop),Math.max(dd.scrollLeft,db.scrollLeft),Math.max(dd.scrollWidth,db.scrollWidth),Math.max(dd.scrollHeight,db.scrollHeight)]};Core.Dom.getXY=function(el){if((el.parentNode==null||el.offsetParent==null||Core.Dom.getStyle(el,"display")=="none")&&el!=document.body){return false}var parentNode=null;var pos=[];var box;var doc=el.ownerDocument;box=el.getBoundingClientRect();var scrollPos=Core.System.getScrollPos(el.ownerDocument);return[box.left+scrollPos[1],box.top+scrollPos[0]];parentNode=el.parentNode;while(parentNode.tagName&&!/^body|html$/i.test(parentNode.tagName)){if(Core.Dom.getStyle(parentNode,"display").search(/^inline|table-row.*$/i)){pos[0]-=parentNode.scrollLeft;pos[1]-=parentNode.scrollTop}parentNode=parentNode.parentNode}return pos};if(!$IE){Core.Dom.getXY=function(el){if((el.parentNode==null||el.offsetParent==null||Core.Dom.getStyle(el,"display")=="none")&&el!=document.body){return false}var parentNode=null;var pos=[];var box;var doc=el.ownerDocument;pos=[el.offsetLeft,el.offsetTop];parentNode=el.offsetParent;var hasAbs=Core.Dom.getStyle(el,"position")=="absolute";if(parentNode!=el){while(parentNode){pos[0]+=parentNode.offsetLeft;pos[1]+=parentNode.offsetTop;if($SAFARI&&!hasAbs&&Core.Dom.getStyle(parentNode,"position")=="absolute"){hasAbs=true}parentNode=parentNode.offsetParent}}if($SAFARI&&hasAbs){pos[0]-=el.ownerDocument.body.offsetLeft;pos[1]-=el.ownerDocument.body.offsetTop}parentNode=el.parentNode;while(parentNode.tagName&&!/^body|html$/i.test(parentNode.tagName)){if(Core.Dom.getStyle(parentNode,"display").search(/^inline|table-row.*$/i)){pos[0]-=parentNode.scrollLeft;pos[1]-=parentNode.scrollTop}parentNode=parentNode.parentNode}return pos}}Lib.register("tray.unReadMsgPanel",function(lib){var unReadMsgPanel=Core.Class.define(function(ele){lib.Panel.prototype.initialize();if(scope.$pageid=="editor"){return}this._lockstate=0;this._scrolling=0;this._srcPot=ele;var template=['<div class="cor"></div>','<div class="bd">','<a href="#" id="j-unread-msg-close" class="close" title="关闭">×</a>','<ul id="j-unre-list">',"</ul>","</div>"].join("");this.setTemplate('<div class="messageTips" id="#{panel}" style="left:850px; top:10px;">'+template+"</div>");this.entity.style.zIndex=500;this._bindEvent()},lib.Panel,{show:function(){if(this.isShow){return}v7sendLog("40_02_01");this.entity.style.display="";this._srcPot&&this._srcPot.setAttribute("unread-show-state",1);this.isHidden=!1;this.isShow=!0;if(this.backIframe){this._updateBackIframe();this.backIframe.style.display=""}lib.Listener.notify("tray-unread-panel-show",{})},hide:function(){lib.Panel.prototype.hide.call(this);this._srcPot&&this._srcPot.setAttribute("unread-show-state",0);lib.Listener.notify("tray-unread-panel-hide",{})},_updatePanelIframe:function(){if(this.backIframe){this._updateBackIframe()}},_updateCont:function(data){var _list=[];if(data.comment+data.message+data.notice+data.gbook==0){this.hide();return}if(data.comment>0){_list.push("<li>"+data.comment+'条新评论，<a onclick="v7sendLog(\'40_02_02\')" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1">查看评论</a></li>')}if(data.message>0){_list.push("<li>"+data.message+'条新纸条，<a onclick="v7sendLog(\'40_02_03\')" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1">查看纸条</a></li>')}if(data.gbook>0){_list.push("<li>"+data.gbook+'条新留言，<a onclick="v7sendLog(\'40_02_04\')" href="http://i.blog.sina.com.cn/blogprofile/wall.php">查看留言</a></li>')}if(data.notice>0){var sysurl={notice:"http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote",like:"http://i.blog.sina.com.cn/profilelist/profilelikelist.php",notice_favourite:"http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice",notice_quote:"http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice",invite:"http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php",unreadnotices:"http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice",point:"http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/points_note.php"};var url=sysurl.notice;for(var key in data.notices){if(data.notices[key]>0){url=sysurl[key]||url;break}}_list.push("<li>"+data.notice+'条新通知，<a onclick="v7sendLog(\'40_02_05\')" href="'+url+'">查看通知</a></li>')}$E("j-unre-list").innerHTML=_list.join("");this.show();this._setThePos()},_setThePos:function(){var pop=Core.Dom.getXY(this._srcPot);var sv=this._srcPot.className=="link"?-2:0;var width=$IE7||$IE6?this.entity.offsetWidth:this.entity.clientWidth;if(pop[0]){var x=pop[0]+this._srcPot.clientWidth-width+sv;var _y=0;if(this._srcPot.getAttribute("adshow")==1&&this._scrolling==0){_y=pop[1]}var y=this._srcPot.clientHeight+_y+10;this.setPosition(x,y)}},_bindEvent:function(){var _this=this;Lib.Listener.on({name:"tray-newmsg-loaded",callBack:function(data){if(_this._lockstate){return}_this._eventHandle(data);_this._setThePos()}});Lib.Listener.on({name:"tray-scrolling-fix",callBack:function(data){_this._scrolling=1;if(_this._lockstate){return}_this.setFixed(1);_this._setThePos()}});Lib.Listener.on({name:"tray-scrolling-nofix",callBack:function(data){_this._scrolling=0;if(_this._lockstate){return}_this.setFixed(0);_this._setThePos()}});Lib.Listener.on({name:"topad680-show-end",callBack:function(data){_this._srcPot.setAttribute("adshow",1);if(_this.isShow){_this._setThePos()}}});Core.Events.addEvent($E("j-unread-msg-close"),function(e){var evt=e||window.event;if(evt.preventDefault){evt.preventDefault()}else{evt.returnValue=false}_this.hide();_this._lockstate=1},"click");Core.Events.addEvent(window,function(){if(_this.isShow){_this._setThePos()}},"resize")},_eventHandle:function(data){var _data={};_data.comment=data.blogcomment-0+(data.photocomment-0)+data.blogrecomment;_data.notice=data.notice+data.like+data.notice_favourite+data.notice_quote+data.invite+data.unreadnotices+data.point;_data.notices={notice:data.notice,like:data.like,notice_favourite:data.notice_favourite,notice_quote:data.notice_quote,invite:data.invite,unreadnotices:data.unreadnotices,point:data.point};_data.message=data.message;_data.gbook=data.gbook;this._updateCont(_data)}});return unReadMsgPanel});Lib.register("tray.msgSummaryPanel",function(lib){var JSON=lib.util.JSON;var nolist=['<li><a onclick="v7sendLog(\'40_02_12\')" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1"><span class="icoms_comment"></span>查看评论</a></li>','<li><a onclick="v7sendLog(\'40_02_13\')" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1"><span class="icoms_tips"></span>查看纸条</a></li>','<li><a onclick="v7sendLog(\'40_02_14\')" href="http://i.blog.sina.com.cn/blogprofile/wall.php"><span class="icoms_message"></span>查看留言</a></li>','<li><a onclick="v7sendLog(\'40_02_15\')" href="http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice"><span class="icoms_notice"></span>查看通知</a></li>'];var msgSummaryPanel=Core.Class.define(function(ele){lib.Panel.prototype.initialize();this._srcPot=ele;this._lock=1;this._scrolling=0;this._requirestate=1;this._nums={};var template=['<div class="bd">','<ul id="j-summary-list">',nolist.join(""),"</ul>","</div>"].join("");this.setTemplate('<div class="messageBox" id="#{panel}">'+template+"</div>");this.entity.style.zIndex=500;this._bindEvent();this._initNums()},lib.Panel,{show:function(){var _this=this;if(this._checkNumChange()){this._updateCont()}else{this._showAction()}},_showAction:function(){if(this.isHidden){this._srcPot&&this._srcPot.setAttribute("msg-panel-show-state",1);this.entity.style.display="";this.isHidden=!1;this.isShow=!0;if(this.backIframe){this._updateBackIframe();this.backIframe.style.display=""}this._setThePos()}else{this._setThePos()}},_checkNumChange:function(){var oldnum=this._srcPot.getAttribute("msg-count");var newnum=this._srcPot.getAttribute("old-msg-count");if(oldnum==newnum){return false}else{return true}},hide:function(){lib.Panel.prototype.hide.call(this);this._srcPot&&this._srcPot.setAttribute("msg-panel-show-state",0);lib.Listener.notify("tray-msg-panel-hide",{})},_initNums:function(){var data=JSON.parse(this._srcPot.getAttribute("msg-count"));this._formatData(data)},_setThePos:function(){if($IE6||$IE7||$IE8){this.entity.style.width="auto"}var pop=Core.Dom.getXY(this._srcPot);var sv=this._srcPot.className=="link"?-2:0;var width=$IE7||$IE6?this.entity.offsetWidth:this.entity.clientWidth;var x=pop[0]+this._srcPot.clientWidth-width+sv;var _y=0;if(this._srcPot.getAttribute("adshow")==1&&this._scrolling==0){if($IE6||$IE7||$IE8){_y=pop[1]-2}else{_y=pop[1]}}var y=this._srcPot.clientHeight+_y+1;if($IE6||$IE7||$IE8){this.entity.style.width=this.entity.clientWidth+1+"px";this.entity.style.width=this.entity.clientWidth-1+"px"}this.setPosition(x,y)},_updatePanelIframe:function(){if(this.backIframe){this._updateBackIframe()}},_updateCont:function(fun){var _list=[];var _this=this;this._lock=0;if(this._requirestate){this._getDate({},function(_data){_list.push(_this._getComment(_data));_list.push(_this._getMessage(_data));_list.push(_this._getGbook(_data));_list.push(_this._getNotice(_data));$E("j-summary-list").innerHTML=_list.join("");_this._srcPot.setAttribute("old-msg-count",_this._srcPot.getAttribute("msg-count"));if($IE6){$E("j-summary-list").style.width="270px"}_this._showAction()},function(_data){});this._requirestate=0}},_getDate:function(opt,funsuc,funerr){funsuc=funsuc||function(){};funerr=funerr||function(){};var _this=this;Lib.checkAuthor();var inter=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/note/notelist.php","jsload");inter.request({GET:{uid:$UID},onSuccess:function(result){funsuc(result)}.bind2(this),onError:function(result){funerr({num:0})}.bind2(this),onFail:function(){funerr({num:0})}.bind2(this)})},_getUserPicUrl:function(uid,size){var size=size||50;var n=parseInt(uid)%8+1;return"http://portrait"+n+".sinaimg.cn/"+uid+"/blog/"+size;

},getLen:function(a){if(!a){return 0}var b=a.match(/[^\x00-\xff]/g);return a.length+(b?b.length:0)},strTruncate:function(str,len,suffix){str=str||"";if(typeof suffix=="undefined"){suffix="..."}return this.getLen(str)>len?this.truncete(str,len)+suffix:str},truncete:function(b,c){var d=b.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**");b=b.slice(0,d.slice(0,c).replace(/\*\*/g," ").replace(/\*/g,"").length);this.getLen(b)>c&&c>0&&(b=b.slice(0,b.length-1));return b},getVipIcon:function(index){if(!index){return""}var vipicon={1:{icon:"SG_icon146",info:"新浪个人认证"},2:{icon:"SG_icon147",info:"新浪机构认证"}};var index=index||1;var pic='<img class="SG_icon '+vipicon[index].icon+'" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="13" title="'+vipicon[index].info+'" alt="'+vipicon[index].info+'" align="absmiddle" />';return pic},_setNameforIE6:function(name){if($IE6){return this.strTruncate(name,4)}else{return name}},_getComment:function(_data){var str="";if(this._nums._comment>0){var data=_data.msg.cms;if(data.length>0){var typemsg={1:"评论了你的博文",2:"评论了你的图片",6:"回复了你的评论"};var typeurl={1:"http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1",2:"http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=2",6:"http://i.blog.sina.com.cn/blogprofile/profilereplylist.php"};var types=[];for(var i=0,len=data.length;i<len;i++){var item=data[i];var name=item.nick_name||item.name;name=this._setNameforIE6(name);var img=this._getUserPicUrl(item.uid,30);var type=item.msg_type;types.push(type);var index=item.user_type||0;var time=item.time;str+='<li><a onclick="v7sendLog(\'40_02_06\')" href="'+typeurl[type]+'"><img src="'+img+'"><em class="nl">'+name+"</em>"+this.getVipIcon(index)+'<em class="tm">'+time+"</em>"+typemsg[type]+"</a></li>"}types.sort();if(this._nums._comment>3){str+='<li class="lcount"><a onclick="v7sendLog(\'40_02_07\')" href="'+typeurl[types[0]]+'">总共'+this._nums._comment+"条新评论</a></li>"}else{}}else{str=nolist[0]}}else{str=nolist[0]}return str},_getMessage:function(_data){var str="";if(this._nums._message>0){var data=_data.msg.note[0];var name=data.name||data.nick_name;name=this._setNameforIE6(name);var numstr=this._nums._message>1?"等"+this._nums._message+"人":"";var index=data.user_type||0;str+='<li class="bgc"><a onclick="v7sendLog(\'40_02_08\')" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1"><span class="icoms_tips"></span><em class="nl">'+name+"</em>"+this.getVipIcon(index)+numstr+'发来纸条<em class="nr">查看纸条</em></a></li>'}else{str=nolist[1]}return str},_getGbook:function(_data){var str="";if(this._nums._gbook>0){var data=_data.msg.note[1];var name=data.name||data.nick_name;if(name){name=this._setNameforIE6(name);var numstr=this._nums._gbook>1?"等"+this._nums._gbook+"人":"给你";var index=data.user_type||0;str+='<li class="bgc"><a onclick="v7sendLog(\'40_02_09\')" href="http://i.blog.sina.com.cn/blogprofile/wall.php"><span class="icoms_message"></span><em class="nl">'+name+"</em>"+this.getVipIcon(index)+numstr+'留言<em class="nr">查看留言</em></a></li>'}}else{str=nolist[2]}return str},_getNotice:function(_data){var str="";var _pronotice="http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice";var _sysnotice="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote";var typeurl={3:"http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php",7:_pronotice,8:_pronotice,9:_pronotice,23:_pronotice,55:"http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/points_note.php",13:"http://i.blog.sina.com.cn/profilelist/profilelikelist.php",100:_sysnotice,101:_sysnotice,102:_sysnotice,103:_sysnotice,104:_sysnotice,105:_sysnotice,106:_sysnotice,107:_sysnotice,108:_sysnotice,109:_sysnotice,110:_sysnotice,111:_sysnotice,112:_sysnotice};if(this._nums._notice>0){var data=_data.msg.note[2];var type=data.msg_type||23;str+='<li class="bgc last"><a onclick="v7sendLog(\'40_02_10\')" href="'+typeurl[type]+'"><span class="icoms_notice"></span>'+this._nums._notice+'条新通知<em class="nr">查看通知</em></a></li>'}else{str=nolist[3]}return str},_bindEvent:function(){var _this=this;Lib.Listener.on({name:"tray-newmsg-loaded",callBack:function(data){_this._requirestate=1;_this._eventHandle(data)}});Lib.Listener.on({name:"tray-scrolling-nofix",callBack:function(data){_this._scrolling=0;if(_this._lockstate){return}_this.setFixed(0);_this._setThePos()}});Lib.Listener.on({name:"tray-scrolling-fix",callBack:function(data){_this._scrolling=1;if(_this._lockstate){return}_this.setFixed(1);_this._setThePos()}});Lib.Listener.on({name:"topad680-show-end",callBack:function(data){if(_this.isShow){_this._setThePos()}}})},_eventHandle:function(data){this._formatData(data);if(this.isShow){this._updateCont()}},_formatData:function(data){var _data={};_data._comment=data.blogcomment-0+(data.photocomment-0)+data.blogrecomment;_data._notice=data.notice+data.like+data.notice_favourite+data.notice_quote+data.invite+data.unreadnotices+data.point;_data._message=data.message;_data._gbook=data.gbook;this._cacheNums(data,_data)},_cacheNums:function(data,_data){for(var k in data){this._nums[k]=data[k]}for(var key in _data){this._nums[key]=_data[key]}}});return msgSummaryPanel});Core.System.winSize=function(_target){var w,h;if(_target){target=_target.document}else{target=document}if(self.innerHeight){if(_target){target=_target.self}else{target=self}w=target.innerWidth;h=target.innerHeight}else if(target.documentElement&&target.documentElement.clientHeight){w=target.documentElement.clientWidth;h=target.documentElement.clientHeight}else if(target.body){w=target.body.clientWidth;h=target.body.clientHeight}return{width:w,height:h}};Core.System.pageSize=function(_target){if(_target){target=_target.document}else{target=document}var _rootEl=target.compatMode=="CSS1Compat"?target.documentElement:target.body;var xScroll,yScroll;if(window.innerHeight&&window.scrollMaxY){xScroll=_rootEl.scrollWidth;yScroll=window.innerHeight+window.scrollMaxY}else if(_rootEl.scrollHeight>_rootEl.offsetHeight){xScroll=_rootEl.scrollWidth;yScroll=_rootEl.scrollHeight}else{xScroll=_rootEl.offsetWidth;yScroll=_rootEl.offsetHeight}var win_s=Core.System.winSize(_target);if(yScroll<win_s.height){pageHeight=win_s.height}else{pageHeight=yScroll}if(xScroll<win_s.width){pageWidth=win_s.width}else{pageWidth=xScroll}return[pageWidth,pageHeight,win_s.width,win_s.height]};(function(){function LazyLoad(oObjects,oOptions){this.node=oObjects;this.config=oOptions;for(var key in this.defaultConfig){this.config[key]=this.defaultConfig[key]}this.initialize();return this}LazyLoad.prototype={defaultConfig:{preloadPixel:500},initialize:function(){this.viewableHeight=LazyLoadListener.getViewableHeight();LazyLoadListener.enrol(this)},callback:function(nHeight){if(this.node.length==0){return}this.viewableHeight=nHeight||this.viewableHeight;var remanent=[];for(var i=0,len=this.node.length;i<len;i++){if(this.node[i]&&this.node[i].dom==null&&Core.Dom.getXY(this.node[i])[1]<this.viewableHeight+this.config.preloadPixel){this.config.callback(this.node[i]);this.node[i]=null}else if(this.node[i]&&this.node[i].dom&&Core.Dom.getXY(this.node[i].dom)[1]<this.viewableHeight+this.config.preloadPixel){this.node[i].callback(this.node[i].dom);this.node[i]=null}else{remanent.push(this.node[i])}}this.node=remanent}};var LazyLoadListener={_isInit:null,_binder:null,_isWindow:null,_member:[],initialize:function(){var container=window,isWindow=container==window||container==document||!container.tagName||/^(?:body|html)$/i.test(container.tagName);if(isWindow){var doc=container.document;container=doc.compatMode=="CSS1Compat"&&($IE||$FF||$OPERA)?doc.documentElement:doc.body}this._container=container;this._binder=isWindow?window:container;this._isWindow=isWindow;this._isInit=true;this.delayResize();this.bindEvent()},getViewableHeight:function(){var eyeableHeight=LazyLoadListener._container.scrollTop+Core.System.winSize().height;this.eyeableHeight=eyeableHeight;return eyeableHeight},bindEvent:function(){if(!this._isInit){this.initialize();return}Core.Events.addEvent(this._binder,LazyLoadListener.delayLoad,"scroll");if(this._isWindow){Core.Events.addEvent(this._binder,LazyLoadListener.delayResize,"resize")}this.binded=true},unbindEvent:function(){Core.Events.removeEvent(LazyLoadListener._binder,LazyLoadListener.delayLoad,"scroll");if(this._isWindow){Core.Events.removeEvent(LazyLoadListener._binder,LazyLoadListener.delayResize,"resize")}this.binded=false},delayLoad:function(){if(LazyLoadListener.scrollWatch){clearTimeout(LazyLoadListener.scrollWatch)}LazyLoadListener.scrollWatch=setTimeout(function(){LazyLoadListener.callback();clearTimeout(LazyLoadListener.scrollWatch);LazyLoadListener.scrollWatch=null},100)},delayResize:function(){if(LazyLoadListener.resizeWatch){clearTimeout(LazyLoadListener.resizeWatch)}LazyLoadListener.resizeWatch=setTimeout(function(){LazyLoadListener.callback();clearTimeout(LazyLoadListener.resizeWatch);LazyLoadListener.resizeWatch=null},100)},enrol:function(oLazy){LazyLoadListener._member.push(oLazy)},callback:function(){LazyLoadListener.getViewableHeight();if(LazyLoadListener._member.length>0){for(var i=0,len=LazyLoadListener._member.length;i<len;i++){LazyLoadListener._member[i].callback(LazyLoadListener.eyeableHeight)}}if(LazyLoadListener.eyeableHeight==Core.System.pageSize()[1]){LazyLoadListener.unbindEvent()}}};Lib.LazyLoad=function(oObjects,oOptions){if(LazyLoadListener.binded!=true){LazyLoadListener.bindEvent(oObjects,oOptions)}new LazyLoad(oObjects,oOptions)}})();var Layer=function(template){this.entity=null;this.ifm=null;var _this=this;var Property={width:0,height:0,x:0,y:0,isFixed:false,uniqueID:"",entityID:"",contentID:"",template:template,templateString:"",nodes:{}};this.getProperty=function(){return Property};(function initialize(){var p=_this.getProperty();p.uniqueID="_"+_this.getUniqueID();p.entityID=p.uniqueID+"_entity";p.contentID=p.uniqueID+"_content";_this.setTemplate(p.template);p.width=parseInt(_this.entity.style.width);if($IE6){_this.addIframe()}document.body.appendChild(_this.entity);_this.hidden()})();this._ie6Fixed=function(){_this.entity.style.left=document.documentElement.scrollLeft+_this.getProperty().x+"px";_this.entity.style.top=document.documentElement.scrollTop+_this.getProperty().y+"px";if(_this.ifm){_this.ifm.style.left=document.documentElement.scrollLeft+_this.getProperty().x+"px";_this.ifm.style.top=document.documentElement.scrollTop+_this.getProperty().y+"px"}}};Layer.prototype={setTemplate:function(template){var p=this.getProperty();if(this.entity){this.entity.parentNode.removeChild(this.entity);this.entity=null}if(typeof template=="object"){p.nodes=template;if(this.entity){this.entity.parentNode.removeChild(this.entity);this.entity=null}this.entity=p.nodes.entity;document.body.appendChild(this.entity);if(!p.nodes.entity||!p.nodes.content){throw new Error("[layer.js] missing entity or content in layer nodes")}else{this.entity.style.position="absolute";this.entity.style.zIndex="1024";this.entity.style.left=p.x+"px";this.entity.style.top=p.y+"px"}return}var pattern=/[^\{\}]+(?=\})/g;p.template=template;p.templateString=p.template.match(pattern);this.entity=$C("div");var tempEntity=$C("div");var tmp=new Ui.Template(p.template);tempEntity.innerHTML=tmp.evaluate(this.getNodes("i"));document.body.appendChild(tempEntity);if(!$E(p.entityID)||!$E(p.contentID)){throw new Error("[layer.js] there missing #{entityID} or #{contentID} in layer template")}else{this.entity=$E(p.entityID);this.entity.style.position="absolute";this.entity.style.zIndex="1024";this.entity.style.left=p.x+"px";this.entity.style.top=p.y+"px";document.body.replaceChild(this.entity,tempEntity);tempEntity=null}p.nodes=this.getNodes()},setSize:function(opts){var p=this.getProperty();Core.System.parseParam(p,opts);if(opts.width){p.nodes.content.style.width=p.width+"px"}if(opts.height){p.nodes.content.style.height=p.height+"px"}this.updateIfmSize()},setPosition:function(opts){var p=this.getProperty();Core.System.parseParam(p,opts);this.entity.style.left=p.x+"px";this.entity.style.top=p.y+"px";if($IE6&&p.isFixed){this.entity.style.left=p.x+document.documentElement.scrollLeft+"px";this.entity.style.top=p.y+document.documentElement.scrollTop+"px"}if(this.ifm){this.ifm.style.left=this.entity.style.left;this.ifm.style.top=this.entity.style.top}},getWidth:function(){var ld=this.entity.style.display;var lv=this.entity.style.visibility;this.entity.style.visibility="hidden";this.entity.style.display="";w=this.entity.offsetWidth;this.entity.style.display=ld;this.entity.style.visibility=lv;return w},getHeight:function(){var ld=this.entity.style.display;var lv=this.entity.style.visibility;this.entity.style.visibility="hidden";this.entity.style.display="";h=this.entity.offsetHeight;this.entity.style.display=ld;this.entity.style.visibility=lv;return h},getX:function(){return parseInt(this.entity.style.left)},getY:function(){return parseInt(this.entity.style.top)},updateIfmSize:function(){if(this.ifm){var _this=this;_this.ifm.style.width=_this.entity.offsetWidth+"px";_this.ifm.style.height=_this.entity.offsetHeight+"px"}},setFixed:function(isFixed){var p=this.getProperty();p.isFixed=isFixed;var _this=this;if($IE6){_this.entity.style.position="absolute";if(p.isFixed){_this._ie6Fixed();Core.Events.addEvent(window,_this._ie6Fixed,"scroll")}else{Core.Events.removeEvent(window,_this._ie6Fixed,"scroll")}return}if(p.isFixed&&$FF2){_this.updateFixed();return}this.entity.style.position=p.isFixed?"fixed":"absolute"},updateFixed:function(){var p=this.getProperty();if(p.isFixed&&$FF2){var _this=this;var lastX=p.x,lastY=p.y;_this.entity.style.position="absolute";_this.setPosition({x:p.x+document.documentElement.scrollLeft,y:p.y+document.documentElement.scrollTop});_this.entity.style.position="fixed";_this.setPosition({x:lastX,y:lastY})}},show:function(){this.entity.style.display="";if(this.ifm){this.ifm.style.display="";this.updateIfmSize()}},hidden:function(){this.entity.style.display="none";if(this.ifm){this.ifm.style.display="none"}},addIframe:function(){this.ifm=$C("iframe");this.ifm.style.position="absolute";this.ifm.style.zIndex="1024";this.ifm.style.left=this.entity.style.left;this.ifm.style.top=this.entity.style.top;document.body.appendChild(this.ifm);Core.Dom.setStyle(this.ifm,"opacity",0)},getNodes:function(mode){var p=this.getProperty();var m=mode||"o";var i;var nodes={};var result=p.templateString;if(result){for(i=0;i<result.length;i++){var r=result[i];switch(m){case"o":nodes[r]=$E(p.uniqueID+"_"+r);break;case"i":nodes[r]=p.uniqueID+"_"+r;break}}}return"entity"in nodes?nodes:p.nodes},getUniqueID:function(){return parseInt(Math.random()*1e4).toString()+(new Date).getTime().toString()},setContent:function(sHTML){var p=this.getProperty();if(sHTML){p.nodes.content.innerHTML=sHTML}}};(function(){var transitions={simple:function(time,startValue,changeValue,duration){return changeValue*time/duration+startValue},backEaseIn:function(t,b,c,d){var s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b},backEaseOut:function(t,b,c,d,a,p){var s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},backEaseInOut:function(t,b,c,d,a,p){var s=1.70158;if((t/=d/2)<1){return c/2*(t*t*(((s*=1.525)+1)*t-s))+b}return c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b},bounceEaseOut:function(t,b,c,d){if((t/=d)<1/2.75){return c*(7.5625*t*t)+b}else if(t<2/2.75){return c*(7.5625*(t-=1.5/2.75)*t+.75)+b}else if(t<2.5/2.75){return c*(7.5625*(t-=2.25/2.75)*t+.9375)+b}else{return c*(7.5625*(t-=2.625/2.75)*t+.984375)+b}},bounceEaseIn:function(t,b,c,d){return c-transitions.bounceEaseOut(d-t,0,c,d)+b},bounceEaseInOut:function(t,b,c,d){if(t<d/2){return transitions.bounceEaseIn(t*2,0,c,d)*.5+b}else{return transitions.bounceEaseOut(t*2-d,0,c,d)*.5+c*.5+b}},strongEaseInOut:function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},regularEaseIn:function(t,b,c,d){return c*(t/=d)*t+b},regularEaseOut:function(t,b,c,d){return-c*(t/=d)*(t-2)+b},regularEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b}return-c/2*(--t*(t-2)-1)+b},strongEaseIn:function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},strongEaseOut:function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},strongEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t*t+b}return c/2*((t-=2)*t*t*t*t+2)+b},elasticEaseIn:function(t,b,c,d,a,p){if(t==0){return b}if((t/=d)==1){return b+c}if(!p){p=d*.3}if(!a||a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b},elasticEaseOut:function(t,b,c,d,a,p){if(t==0){return b}if((t/=d)==1){return b+c}if(!p){p=d*.3}if(!a||a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b},elasticEaseInOut:function(t,b,c,d,a,p){if(t==0){return b}if((t/=d/2)==2){return b+c}if(!p){var p=d*(.3*1.5)}if(!a||a<Math.abs(c)){var a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}if(t<1){return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b}return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b}};var getUniqueID=function(oNode){return oNode.uniqueID};if(!$IE){getUniqueID=function(oNode){try{var rnd_ID;if(oNode.getAttribute("uniqueID")==null){rnd_ID="moz__id"+parseInt(Math.random()*100)+"_"+(new Date).getTime();oNode.setAttribute("uniqueID",rnd_ID);return rnd_ID}return oNode.getAttribute("uniqueID")}finally{rnd_ID=null}}}function getType(oObject){try{var s=oObject.constructor.toString().toLowerCase();return s.slice(s.indexOf("function")+9,s.indexOf("()"))}finally{s=null}}function getStartValue(oNode,aProperty){var i,_len,_arr=[];_len=aProperty.length;for(i=0;i<_len;i++){_arr[_arr.length]=parseFloat(Core.Dom.getStyle(oNode,aProperty[i]))}return _arr}function formatProperty(oProperty){return getType(oProperty)!="array"?[oProperty]:oProperty}function formatValue(oEndingValue,aProperty){try{var _type=getType(oEndingValue);var _valuearray=[],_suffixarray=[],i,_len,_suffix;if(_type!="array"){_suffix=getSuffix(oEndingValue);_suffix[1]=aProperty=="opacity"?"":_suffix[1];_valuearray=[_suffix[0]];_suffixarray=[_suffix[1]]}else{_len=oEndingValue.length;for(i=0;i<_len;i++){_suffix=getSuffix(oEndingValue[i]);_suffix[1]=aProperty[i]=="opacity"?"":_suffix[1];_valuearray[_valuearray.length]=_suffix[0];_suffixarray[_suffixarray.length]=_suffix[1]}}return[_valuearray,_suffixarray]}finally{_type=_valuearray=_suffixarray=i=_len=_suffix=null}}function getSuffix(sValue){try{var charCase=/(-?\d.?\d*)([a-z%]*)/i.exec(sValue);return[charCase[1],charCase[2]?charCase[2]:"px"]}finally{charCase=null}}var runList={};var saveList={};function getInstance(oNode){try{var uID=getUniqueID(oNode);var runFunc;if(runList[uID]!=true){runFunc=new ancestor;saveList[uID]={node:oNode,func:runFunc};runList[uID]=true;return runFunc}else{return saveList[uID].func}}finally{uID=runFunc=null}}function ancestor(){this._timer=null}ancestor.prototype.start=function(oNode,oProperty,oEndingValue,nSeconds,sAnimation,oFunc){this.reset();oFunc=oFunc||{};if(oFunc.before){this._func.before=oFunc.before}if(oFunc.end){this._func.end=oFunc.end}if(oFunc.tween){this._func.tween=oFunc.tween}var _propertyArr=formatProperty(oProperty);var _startValueArr=getStartValue(oNode,_propertyArr);var _endValueArr=formatValue(oEndingValue,_propertyArr);this._node=oNode;this._property=_propertyArr;this._endingvalue=_endValueArr[0];this._suffixvalue=_endValueArr[1];this._startvalue=_startValueArr;this._end=false;this._fps=0;if(nSeconds!=null){this._seconds=nSeconds}if(transitions[sAnimation]!=null){this._animation=transitions[sAnimation]}this._starttime=(new Date).getTime();this._func.before();this._timer=setInterval(Core.Function.bind3(this.play,this),10)};ancestor.prototype.play=function(){var nTime=((new Date).getTime()-this._starttime)/1e3;var i,ani,_len=this._property.length;if(nTime>this._seconds){nTime=this._seconds}for(i=0;i<_len;i++){ani=this._animation(nTime,this._startvalue[i],this._endingvalue[i]-this._startvalue[i],this._seconds);Core.Dom.setStyle(this._node,this._property[i],ani+this._suffixvalue[i])}this._fps++;this._func.tween();if(nTime==this._seconds){this.stop()}};ancestor.prototype.stop=function(){clearInterval(this._timer);this._end=true;this._func.end()};ancestor.prototype.reset=function(){clearInterval(this._timer);this._end=false;this._node=null;this._property=[];this._startvalue=[];this._endingvalue=[];this._suffixvalue=[];this._fps=0;this._seconds=.5;this._animation=transitions.simple;this._func={end:function(){},tween:function(){},before:function(){}}};function tween(oNode,oProperty,oEndingValue,nSeconds,sAnimation,oFunc){var instance=getInstance(oNode);instance.start.apply(instance,arguments)}tween.stop=function(oNode){getInstance(oNode).stop()};tween.isTween=function(oNode){return!getInstance(oNode)._end};Ui.tween=tween})();var DialogDisplaySet={alpha1:{show:function(dom,offsetY,callBack){var v=0,deltaY=0,startY=parseInt(dom.style.top)-offsetY;dom.style.top=startY;Core.Dom.setStyle(dom,"opacity",v);dom.style.display="";var itvId=window.setInterval(function(){if(v<=1){Core.Dom.setStyle(dom,"opacity",v)}if(deltaY<=startY+offsetY){dom.style.top=startY+deltaY+"px"}deltaY+=1.5;v+=.05;if(v>.9&&parseInt(dom.style.top)>=startY+offsetY){window.clearInterval(itvId);if(callBack){callBack()}}},10)},hidden:function(dom,offsetY,callBack){var v=1;var startY=parseInt(dom.style.top);var endY=startY-offsetY;var currentY=startY;var itvId=window.setInterval(function(){if(v>=0){Core.Dom.setStyle(dom,"opacity",v)}if(currentY>=endY){dom.style.top=currentY+"px"}currentY-=1.5;v-=.05;if(v<=0&&currentY<endY){window.clearInterval(itvId);if(callBack){callBack()}}},10)}},alpha:{show:function(dom,offsetY,callBack){Core.Dom.setStyle(dom,"opacity",.3);dom.style.display="";dom.style.top=parseInt(dom.style.top)-offsetY+"px";var y1=parseInt(dom.style.top)+offsetY;Ui.tween(dom,["top","opacity"],[y1,.9],.4,"simple",{end:callBack})},hidden:function(dom,offsetY,callBack){var y1=parseInt(dom.style.top)-offsetY;Ui.tween(dom,["top","opacity"],[y1,0],.2,"simple",{end:callBack})}},fallDown:{show:function(dom,y0,y1,callBack){dom.style.display="";dom.style.top=y0+"px";Ui.tween(dom,"top",y1,.6,"bounceEaseOut",{end:callBack})},hidden:function(dom,y0,y1,callBack){dom.style.display="";dom.style.top=y0+"px";Ui.tween(dom,"top",y1,.6,"strongEaseIn",{end:callBack})}}};var Drag3=function(beDragObj,movedObjs,dragMode){var _this=this;this.beDragObj=beDragObj;this.movedObjs=movedObjs||this.beDragObj;this.dragMode=dragMode||"normal";this.canDrag=true;this.isLock=false;this.lockArea={left:0,right:0,top:0,bottom:0};this.dragSet={normal:function(){_this.normalDrag()},border:function(){_this.borderDrag()},opacity:function(){_this.opacityDrag()}};this.dragObjsFunc=function(){_this.onDrag();_this.dragObjs()};(function initialize(){_this.beDragObj.style.MozUserSelect="none";Core.Events.addEvent(_this.beDragObj,function(){return false},"selectstart");Core.Events.addEvent(_this.beDragObj,function(){return false},"drag");for(var i=0;i<_this.movedObjs.length;i++){if(_this.movedObjs[i]!=_this.beDragObj){_this.movedObjs[i].style.position="absolute";if(!_this.movedObjs[i].style.left){_this.movedObjs[i].style.left=_this.movedObjs[i].offsetLeft+"px"}if(!_this.movedObjs[i].style.top){_this.movedObjs[i].style.top=_this.movedObjs[i].offsetTop+"px"}}}Core.Events.addEvent(_this.beDragObj,_this.dragSet[_this.dragMode],"mousedown");if($IE){Core.Events.addEvent(_this.beDragObj,function(){Core.Events.removeEvent(_this.beDragObj,_this.dragObjsFunc,"mousemove");_this.beDragObj.releaseCapture();_this.onDragEnd()},"mouseup")}else{Core.Events.addEvent(document,function(){Core.Events.removeEvent(document,_this.dragObjsFunc,"mousemove");_this.onDragEnd()},"mouseup")}})()};Drag3.prototype={capture:function(){this.canDrag=true},release:function(){this.canDrag=false},onDragStart:function(){},onDrag:function(){},onDragEnd:function(){},dragObjs:function(){e=Core.Events.getEvent();for(var i=0;i<this.movedObjs.length;i++){if(this.isLock){if(e.clientX-this.movedObjs[i].deltaX<this.lockArea.left){this.movedObjs[i].style.left=this.lockArea.left+"px"}else{if(e.clientX-this.movedObjs[i].deltaX>this.lockArea.right-this.movedObjs[i].offsetWidth){this.movedObjs[i].style.left=this.lockArea.right-this.movedObjs[i].offsetWidth+"px"}else{this.movedObjs[i].style.left=e.clientX-this.movedObjs[i].deltaX+"px"}}if(e.clientY-this.movedObjs[i].deltaY<this.lockArea.top){this.movedObjs[i].style.top=this.lockArea.top+"px"}else{if(e.clientY-this.movedObjs[i].deltaY>this.lockArea.bottom-this.movedObjs[i].offsetHeight){this.movedObjs[i].style.top=this.lockArea.bottom-this.movedObjs[i].offsetHeight+"px"}else{this.movedObjs[i].style.top=e.clientY-this.movedObjs[i].deltaY+"px"}}}else{this.movedObjs[i].style.left=e.clientX-this.movedObjs[i].deltaX+"px";this.movedObjs[i].style.top=e.clientY-this.movedObjs[i].deltaY+"px"}}},normalDrag:function(){var _this=this;e=Core.Events.getEvent();for(var i=0;i<_this.movedObjs.length;i++){_this.movedObjs[i].deltaX=e.clientX-parseInt(_this.movedObjs[i].style.left);_this.movedObjs[i].deltaY=e.clientY-parseInt(_this.movedObjs[i].style.top)}if(_this.canDrag){if($IE){_this.beDragObj.setCapture();Core.Events.addEvent(_this.beDragObj,_this.dragObjsFunc,"mousemove")}else{Core.Events.addEvent(document,_this.dragObjsFunc,"mousemove")}}_this.onDragStart()},borderDrag:function(obj,borderWidth){},opacityDrag:function(obj,opacityValue){}};Ui.Drag3=Drag3;var Dialog=function(template){var _this=this;_this.entity=null;_this.ifm=null;var Property={id:"",x:0,y:0,width:0,height:0,isFixed:false,layer:new Layer(template),template:template,canDrag:false,dragEntity:null,name:"",uniqueID:"",isShow:false,nodes:{},focusNode:null,displayMode:"normal",_modeDisplayRuning:false,enabled:true};this.getProperty=function(){return Property};(function initialize(){var p=_this.getProperty();var i;p.uniqueID=p.layer.getProperty().uniqueID;p.id=p.uniqueID+"_dialog";p.nodes=_this.getNodes();_this.entity=p.layer.entity;_this.ifm=p.layer.ifm;p.width=parseInt(_this.entity.style.width);if(p.nodes.titleBar){p.dragEntity=new Ui.Drag3(p.nodes.titleBar,_this.ifm?[_this.ifm,_this.entity]:[_this.entity]);p.nodes.titleBar.style.cursor="move";Core.Events.addEvent(p.nodes.titleBar,function(){return false},"selectstart");p.dragEntity.onDrag=function(){_this.onDrag()}}Core.Events.addEvent(window,function(){if(p.isShow&&p.isFixed){var win=Core.System.winSize();var _x=win.width/2-_this.getWidth()/2;var _y=win.height/2-_this.getHeight()/2;_x=_x<0?0:_x;_y=_y<0?0:_y;_this.setPosition({x:_x,y:_y})}},"resize")})()};Dialog.prototype={setPosition:function(opts){var p=this.getProperty();Core.System.parseParam(p,opts);this.getProperty().layer.setPosition(opts)},setSize:function(opts){var p=this.getProperty();Core.System.parseParam(p,opts);p.layer.setSize(opts)},setFixed:function(isFixed){var p=this.getProperty();p.isFixed=isFixed;this.getProperty().layer.setFixed(p.isFixed)},setContent:function(sHTML){var p=this.getProperty();this.getProperty().layer.setContent(sHTML)},setTemplate:function(template){var p=this.getProperty();p.template=template;p.layer.setTemplate(p.template)},setDrag:function(canDrag){var p=this.getProperty();p.canDrag=canDrag;if(p.canDrag){p.dragEntity.capture()}else{p.dragEntity.release()}},getWidth:function(){return this.getProperty().layer.getWidth()},getHeight:function(){return this.getProperty().layer.getHeight()},getX:function(){return this.getProperty().layer.getX()},getY:function(){return this.getProperty().layer.getY()},show:function(mode){var p=this.getProperty();var _this=this;p.isShow=true;if(this.ifm){this.ifm.style.display=""}this.onShow();if(p.displayMode=="normal"||mode=="normal"){this.entity.style.display=""}else{p._modeDisplayRuning=true;p.enabled=false;this._showWithMode(function(){p._modeDisplayRuning=false;p.enabled=true;if(_this.onDisplaied){_this.onDisplaied()}})}},close:function(mode){var _this=this;var p=this.getProperty();if(p.displayMode=="normal"||mode=="normal"){p.isShow=false;p.layer.hidden();this.destroy();this.onClose();if(_this.onDisplayFinished){_this.onDisplayFinished()}}else if(!p._modeDisplayRuning){p._modeDisplayRuning=true;p.enabled=false;this._hiddenWithMode(function(){p.isShow=false;p.layer.hidden();p._modeDisplayRuning=false;p.enabled=true;_this.destroy();_this.onClose();if(_this.onDisplayFinished){_this.onDisplayFinished()}})}},hidden:function(mode){var _this=this;var p=this.getProperty();if(p.displayMode=="normal"||mode=="normal"){p.isShow=false;p.layer.hidden();this.onHidden();if(_this.onDisplayFinished){_this.onDisplayFinished()}}else if(!p._modeDisplayRuning){p._modeDisplayRuning=true;p.enabled=false;this._hiddenWithMode(function(){p.isShow=false;p.layer.hidden();_this.onHidden();p._modeDisplayRuning=false;p.enabled=true;if(_this.onDisplayFinished){_this.onDisplayFinished()}})}},_showWithMode:function(callBack){var p=this.getProperty();var win=Core.System.winSize();var _this=this;switch(p.displayMode){case"alpha":DialogDisplaySet["alpha"].show(this.entity,20,callBack);break}},_hiddenWithMode:function(callBack){var p=this.getProperty();var _this=this;var win=Core.System.winSize();switch(p.displayMode){case"alpha":DialogDisplaySet["alpha"].hidden(this.entity,20,callBack);break}},destroy:function(){try{if(this.getProperty().nodes.iframe){this.getProperty().nodes.iframe.src=""}}catch(ex){}this.entity&&this.entity.parentNode.removeChild(this.entity);this.entity=null;if(this.ifm){this.ifm.parentNode.removeChild(this.ifm);this.ifm=null}},onShow:function(){},onClose:function(){},onHidden:function(){},onDrag:function(){},onDisplaied:function(){},onDisplayFinished:function(){},setAreaLocked:function(state){var p=this.getProperty();p.dragEntity.isLock=state;var _this=this;if(state){_this._updateLockArea();Core.Events.addEvent(window,function(){_this._updateLockArea()},"resize")}},_updateLockArea:function(){var p=this.getProperty();var win=Core.System.winSize();if(p.isFixed){if($IE6){p.dragEntity.lockArea={left:document.documentElement.scrollLeft,right:document.documentElement.scrollLeft+win.width,top:document.documentElement.scrollTop,bottom:document.documentElement.scrollTop+win.height};Core.Events.addEvent(window,function(){p.dragEntity.lockArea={left:document.documentElement.scrollLeft,right:document.documentElement.scrollLeft+win.width,top:document.documentElement.scrollTop,bottom:document.documentElement.scrollTop+win.height}},"scroll");Core.Events.addEvent(window,function(){p.dragEntity.lockArea={left:document.documentElement.scrollLeft,right:document.documentElement.scrollLeft+win.width,top:document.documentElement.scrollTop,bottom:document.documentElement.scrollTop+win.height}},"resize")}else{p.dragEntity.lockArea={left:0,right:win.width,top:0,bottom:win.height}}}else{p.dragEntity.lockArea={left:0,right:document.documentElement.scrollWidth,top:0,bottom:document.documentElement.scrollHeight}}},updateFixed:function(){this.getProperty().layer.updateFixed()},getNodes:function(mode){return this.getProperty().layer.getNodes(mode)},setFocus:function(){var p=this.getProperty();if(p.focusNode&&p.focusNode.style.display!="none"){try{p.focusNode.focus()}catch(ex){}}else if(this.entity.style.display!="none"){this.entity.focus()}},getUniqueID:function(){return this.getProperty().layer.getUniqueID()}};var $SYSMSG={};$SYSMSG.extend=function(info,override){for(var i in info){$SYSMSG[i]=!!override==false?info[i]:$SYSMSG[i]}};$SYSMSG.extend({A00001:"系统繁忙，请稍候再试。",A00007:"未登录。",A00004:"系统繁忙，请稍候再试。",A00112:"博客名称超长。",A00113:"您已开通博客，请点击<a href='http://control.blog.sina.com.cn/blogprofile/index.php'>个人中心</a>进入。",A00116:"不能包含 sina 等有特殊含义的字符。",A11003:"此账户已完成博客快速设置，点击确定，直接进入博客。",A44001:"博客个性地址不能为空。",A44002:"地址格式不对。",A44003:"抱歉，此地址已被占用。",A44005:"抱歉，请按照正确格式填写博客地址。"});(function(){if(scope.blogOpener){scope.addBlogOpenerEvent=function(){};return}var openURL="http://control.blog.sina.com.cn/riaapi/reg/open_blog.php";var openBlog=function(){this._hasInit=false};openBlog.prototype={getCon:function(){
var checkcodeHTML=['<div class="boxA" style="margin: 20px 0; overflow: hidden; zoom: 1;">','<div id="checkCodeBox_open_msg" class="check-code-box clearfix" > </div>',"</div>"].join("");return['<div class="CP_layercon8">'+'<div class="nowOpenBlog">'+"<strong>您的博客尚未开通,仅一步操作就能开通您的个人博客</strong>"+'<div class="boxA">'+"<label>博客名称：</label>"+'<input id="blogNameInput_t" type="text" class="ipt" />'+'<img style="display:none" id="blogNameIcon_t" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" class="SG_icon SG_icon49 tips">'+'<p id="blogNameError_t" class="tip">名称不能为空</p>'+"</div>"+'<div  class="boxA"> '+"<p>隐私设置："+'<input type="radio" name="isPrivate_t" checked id="openAll1_t" class="rd" /><label for="openAll1_t">对所有人开放</label>'+'<input type="radio" name="isPrivate_t" id="openMe1_t" class="rd" /><label for="openMe1_t">仅对自己开放，私密博客</label>'+"</p>"+"</div>"+checkcodeHTML+'<div id="ErrTips_t" class="ErrTips">系统繁忙，请稍后再试</div>'+'<div class="boxB">'+'<p><a id="openBlogOkBtn_t" class="btn" href="javascript:void(0)">完成开通</a><a id="openBlogCancel" href="javascript:void(0)">取消</a></p>'+"</div>"+"</div>"+"</div>"].join("")},_initDialog:function(){Lib.checkAuthor();this.key=getKeyName();this._dialog=winDialog.createCustomsDialog({content:this.getCon()},"openblog");var checkCodeBox_open_msg={id:"#checkCodeBox_open_msg"};checkManager_open_msg=new Lib.checkManager(checkCodeBox_open_msg);this.bindEvent();blogNameEvent($E("blogNameInput_t"),$E("blogNameError_t"),[],$E("blogNameIcon_t"))},showDialog:function(callBack,needToOpen,forceOpen){needToOpen=needToOpen||false;if(!this._hasInit){this._initDialog();this._hasInit=true}var me=this;scope.whenOpenBlogCallback=callBack;if(!scope.hasOpenBlog){trace("这是一位后登陆的用户");var t=0;var timmer=setInterval(function(){trace("呀，怎么还没有出结果啊--"+t);if(scope.hasOpenBlog){clearInterval(timmer);if(scope.hasOpenBlog=="open"){trace("并且他开通的博客");if(scope.whenOpenBlogCallback){scope.whenOpenBlogCallback()}}else{trace("他们没有开通博客");me._showDialog(needToOpen)}}t++;if(t==10){Lib.checkAuthor();trace("等不及了，自己发吧。。。");clearInterval(timmer);new Interface("http://control.blog.sina.com.cn/riaapi/profile/unread.php","jsload").request({GET:{uid:$UID,product:"blog"},onSuccess:function(data){scope.hasOpenBlog=data.isbloguser==1?"open":"no";trace("~~~~~~~~~~~~~~~~~~~"+scope.hasOpenBlog);if(scope.hasOpenBlog=="open"){trace("并且他开通的博客");if(scope.whenOpenBlogCallback){scope.whenOpenBlogCallback()}}else{if(!$E("openblogcss")){Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"})}trace("他们没有开通博客");me._showDialog(needToOpen)}}})}},10)}else{trace("这是已登陆的用户");if(scope.hasOpenBlog=="open"){trace("并且他开通的博客");if(scope.whenOpenBlogCallback){scope.whenOpenBlogCallback()}}else{if(!$E("openblogcss")){Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"})}trace("他们没有开通博客");this._showDialog(needToOpen)}}if(forceOpen){$E("openBlogCancel").style.display="none";this._dialog.getNodes().btnClose.style.display="none"}},_showDialog:function(needToOpen){$E("blogNameInput_t").value=getShotName();hiddenError($E("blogNameError_t"),$E("blogNameIcon_t"));$E("ErrTips_t").style.visibility="hidden";$E("blogNameIcon_t").style.display="none";this._dialog.show();this._dialog.setAreaLocked(true);this._dialog.setMiddle()},bindEvent:function(){var me=this;Core.Events.addEvent($E("openBlogCancel"),function(){me.closeDialog();return false});Core.Events.addEvent($E("openBlogOkBtn_t"),function(){if(!checkManager_open_msg.validate()){if(!$E("comment_check_img")){winDialog.alert("请拖动滑块儿开始验证")}else{winDialog("验证码不能为空")}return}whenOpenBlog({nameErrorEle:$E("blogNameError_t"),nameOkIcon:$E("blogNameIcon_t"),openName:$E("blogNameInput_t").value||getShotName(),isprivate:$E("openAll1_t").checked?0:1,errorEle:$E("ErrTips_t"),from:"floatingLayer",okCallback:function(res,blogInfo){if(scope.whenOpenBlogCallback){scope.whenOpenBlogCallback(res,blogInfo)}if($E("openedBlogTray")&&$E("openedBlogTray").style.display=="none"){$E("outOfOpenBlogTray").style.display="none";$E("noOpenedBlogTray").style.display="none";$E("openedBlogTray").style.display=""}if($E("noOpendBlogSearchTip")&&$E("noOpendBlogSearchTip").style.display=="block"){$E("noOpendBlogSearchTip").style.display="none";$E("opendBlogSearchTip").style.display="block"}scope.hasOpenBlog="open";me.closeDialog();scope.whenOpenBlogCallback=function(){}}});return false})},closeDialog:function(){var me=this;this._dialog.hidden()}};function getShotName(){var val=$nick;var nameLen=Core.String.byteLength(val);while(nameLen>18){val=val.substring(0,val.length-1);nameLen=Core.String.byteLength(val)}return val+"的博客"}scope.openBlogGetShotName=getShotName;function blogNameEvent(inputEle,errEle,optArr,icon){inputEle.onfocus=function(){inputEle.className="ipt focus";styleThey(optArr,"");icon.style.display=""};inputEle.onblur=function(){inputEle.className="ipt";checkBlogName(inputEle,errEle,icon);styleThey(optArr,"none")};inputEle.onkeyup=function(){checkBlogName(inputEle,errEle,icon)}}scope.openBlogNameEvent=blogNameEvent;function whenOpenBlog(opt){if(whenOpenBlog.requestComplete===false){return}if(opt.nameErrorEle.innerHTML){changeTextBgC(opt.nameErrorEle.parentNode);setTimeout(function(){changeTextBgC(opt.nameErrorEle.parentNode)},442);return}var targetButtonId=opt.from==="floatingLayer"?"openBlogOkBtn_t":"openBlogOkBtn";$E(targetButtonId).className="loading";var blogInfo={loginName:getKeyName(),blogName:opt.openName};var my_data={uid:$UID,loginname:blogInfo.loginName,blogname:blogInfo.blogName,version:7,src:"layer",isprivate:opt.isprivate};var data_my=checkManager_open_msg.getPostData(my_data);new Interface(openURL,"jsload").request({GET:data_my,onSuccess:function(res){whenOpenBlog.requestComplete=true;$E(targetButtonId).className="btn";opt.okCallback(res,blogInfo);blogInfo=null},onError:function(res){var nameErr=$E("blogNameError"),nameIcon=$E("blogNameIcon"),layerNameErr=$E("blogNameError_t"),layerNameIcon=$E("blogNameIcon_t");switch(res.code){case"A11008":if(nameErr&&nameIcon){showError(nameErr,"输入内容有误，请修改",nameIcon)};if(layerNameErr&&layerNameIcon){showError(layerNameErr,"输入内容有误，请修改",layerNameIcon)};break;case"A11010":if(nameErr&&nameIcon){showError(nameErr,"输入内容有误，请修改",nameIcon)};if(layerNameErr&&layerNameIcon){showError(layerNameErr,"输入内容有误，请修改",layerNameIcon)};break;case"B36002":winDialog.alert("验证码错误，请修改。");break;default:showError(opt.errorEle,"系统繁忙，请稍后再试。");break}whenOpenBlog.requestComplete=true;$E(targetButtonId).className="btn"}})}scope.openBlogWhenOpenBlog=whenOpenBlog;function changeTextBgC(ele){for(var i=1;i<=55;i++){(function(val){setTimeout(function(){ele.style.backgroundColor="rgb(255, "+ +(200+val)+", "+(200+val)+")"},val*8)})(i)}}function getKeyName(){var key=decodeURIComponent(Utils.Cookie.getCookie("SUP"));key=key.split("&name=")[1];key=decodeURIComponent(key.split("&")[0]);return key}function styleThey(eleArr,str){for(var i=0;eleArr[i];i++){eleArr[i].style.display=str}}function checkBlogName(inputEle,errEle,icon){var val=inputEle.value;if(/^(?:\s|[　])+|(?:\s|[　])+$/.test(val)){inputEle.value=Core.String.trim(val);val=inputEle.value}if(val){var nameLen=Core.String.byteLength(val);if(nameLen>24){showError(errEle,"博客名称超长",icon)}else{hiddenError(errEle,icon)}}else{showError(errEle,"博客名称不能为空",icon)}}function showError(ele,str,icon){ele.innerHTML=str;ele.style.display="block";if(ele.id.indexOf("ErrTips")>=0){ele.style.visibility="visible"}if(icon){icon.className="SG_icon SG_icon48 tips"}}function hiddenError(ele,icon){ele.innerHTML="";ele.style.display="none";if(icon){icon.className="SG_icon SG_icon49 tips"}}scope.blogOpener=new openBlog;scope.addBlogOpenerEvent=function(el){Core.Events.addEvent(el,function(e){scope.blogOpener.showDialog(function(res,blogInfo){Lib.LocalDB.clearCache(1,"uid_"+$UID+"unread");Lib.util.LS.removeItem("uid"+$UID);if(scope.$pageid=="fakeIndex"){window.location.href="http://i.blog.sina.com.cn/blogprofile/index.php?atten=1";return}if($E("openedBlogTray")){$E("openedBlogTray").style.display="";$E("noOpenedBlogTray").style.display="none";$E("outOfOpenBlogTray").style.display="none";if(blogInfo){$E("loginBarAppMenuLabel").innerHTML=blogInfo.loginNick}}else{var wnd=window;wnd.$tray&&wnd.$tray.renderLogin()}var successOpenFun=function(){if(scope.___importV){scope.___importV();scope.___openBlogFlag=1}};var alertConf={subText:!scope.___importV?['<div class="CP_w_cnt SG_txtb">欢迎您在新浪博客安家！除了写博客，看博客外，您还可以进入个人中心完善您的个人资料，更有很多有趣的应用等着您哦。</div>','<ul class="CP_w_part CP_w_aLine">','<li><a href="http://control.blog.sina.com.cn/blogprofile/index.php" onclick="winDialog.getDialog(\'unregister\').hidden();" target="_blank">到博客个人中心&gt;&gt;</a></li>',"</ul>"].join(""):"",icon:"03",funcOk:successOpenFun,funcClose:successOpenFun,width:300};winDialog.alert("开通博客成功",alertConf,"unregister");var commentNickEl=$E("commentNick");if(commentNickEl){var child=commentNickEl.firstChild;while(child){commentNickEl.removeChild(child);child=commentNickEl.firstChild}commentNickEl.innerHTML=blogInfo.loginNick+":"}},true)},"click")}})();Lib.register("TrayPanel",function(lib){var _addEvt=Core.Events.addEvent;var _removeEvt=Core.Events.removeEvent;var _getCookie=Utils.Cookie.getCookie;var _contains=Core.Dom.contains;var JSON=lib.util.JSON;var byClass=Core.Dom.getChildrenByClass;var logoId="login_bar_logo_link_350";var _trayHolder="______noticeTrayHolder";var loadCount=0;var tray=null;var renderLogin=!1;var attr=function(el,attr,v){if(typeof v!=="string"){return el.getAttribute(attr)}else{el.setAttribute(attr,v)}};var TrayPanel=Core.Class.define(function(){var $topBaner=byClass(document.body,"nsinatopbar")[0];var $main=this.$main=byClass($topBaner,"ntopbar_main")[0];this.newTipsLog=0;lib.Panel.prototype.initialize.call(this,{appendTo:$main,isPostion:!1,noIframe:!0});lib.Listener.on({name:"tray-data-loaded",callBack:this.showPublishWare,scope:this},{name:"tray-newmsg-loaded",callBack:this.showNewMsgTips,scope:this},{name:"global-login-out",callBack:function(){clearInterval(this._msgTimer)},scope:this},{name:"tray-announce-loaed",callBack:function(json){var args=arguments;var $this=this;if(this.notice){this.notice.update(json);return}setTimeout(function(){args.callee.call($this,json)},200)},scope:this},{name:"tray-unread-panel-hide",callBack:function(){var $trayMsg=this.getNode("trayMsg");var data=JSON.parse($trayMsg.getAttribute("msg-count"));this.showNewMsgTips(data,1)},scope:this},{name:"tray-unread-panel-show",callBack:function(){var $tips=this.getNode("newTips");$tips.style.display="none"},scope:this},{name:"tray-msg-panel-hide",callBack:function(){var $trayMsg=this.getNode("trayMsg");var data=JSON.parse($trayMsg.getAttribute("msg-count"));this.showNewMsgTips(data,1)},scope:this},{name:"tray-announce-close",callBack:function(json){this.setTrayPosition()},scope:this},{name:"topad680-show-start",callBack:function(data){this._hideActiveSub()},scope:this});if(loadCount){loadCount++}},lib.Panel,{subPanels:[],hoverTimeout:"",hoverTime:400,load:function(loginState){if(!loadCount){var $logo=$E(logoId);if($logo&&$_GLOBAL&&$_GLOBAL.platformTrayLogo){if(!$IE6&&$_GLOBAL.platformTrayLogo.imgForOtherBrs){$logo.children[0].src=$_GLOBAL.platformTrayLogo.imgForOtherBrs}else if($_GLOBAL.platformTrayLogo.imgForIE6){$logo.children[0].src=$_GLOBAL.platformTrayLogo.imgForIE6}}this.initSearch()}switch(loginState){case"login":if(/ipad/i.test(navigator.userAgent)){v7sendLog("48_01_02")}var start_time=new Date;var $this=this;lib.tray.loadUserInfo($UID,function(info){scope.unreadMsg=info;scope.nickname=info["full_nickname"];scope.loginUserWtype=info["login_wtype"];if(!$this._isRenderUser){$this.renderRight(lib.tray.tpl.loginMemu);$this._isRenderUser=!0}var $nick,$userInfo,$msnHolder;if(info.isbloguser){var $noOpenBlog=$this.getNode("noOpenBlog");$noOpenBlog.style.display="none";$this.initUserMenu();$this.initBlogMenu(info);$this.initNewMsgEvt();$this.initMsg();$this.initMsgLoder();$this.initHideSub();$this.initunReadMsgPanel();$nick=$this.getNode("userNick");$userInfo=$this.getNode("openBlog")}else{$nick=$this.getNode("ssoNick");$nick.href="http://control.blog.sina.com.cn/myblog/htmlsource/blog_notopen.php?uid="+$UID+"&version=7";$this.initOpenBlog();$this.initLogout();$userInfo=$this.getNode("noOpenBlog")}$nick.innerHTML="";var $nickTxt=document.createTextNode(info.nickname);$nick.appendChild($nickTxt);$userInfo.style.display="block";var isMsnLogin=Utils.Cookie.getCookie("loginFromMsn");if(isMsnLogin&&$nick){$msnHolder=$this.getNode("msnHolder");$msnHolder.style.display="block";var $msnLink=$this.getNode("msnLink");$msnLink.href+=$UID}if($msnHolder){Core.Dom.insertAfter($msnHolder,$nick.parentNode)}$this.initNotice()});break;case"logout":if(!this.trayLogin){this.trayLogin=new lib.Login.Ui;this.renderRight(lib.tray.tpl.loginOutMemu)}this.initLogin();this.initNotice();break;case"oncelogedon":break}loadCount++},initMsgLoder:function(){if(!this.msgLoader){this.msgLoader=new lib.tray.MsgLoader;this.msgLoader.load($UID);var $this=this;this._msgTimer=setInterval(function(){$this.msgLoader.load($UID)},30*1e3)}},initLogin:function(){var $this=this;var isInit=attr(this._el,"login");if(!isInit){attr(this._el,"login","1");_addEvt(this._el,function(evt){var data=lib.util.getActionData(evt,"tray-login-btn");if(!data){return}if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};$this.trayLogin.login(function(){Lib.checkAuthor();var str=$UID==scope.$uid?"02":"01";v7sendLog("87_01_"+str+"_"+$UID,scope.$pageid);setTimeout(function(){window.location=window.location.toString().replace(/#.*/,"")},100)},false,"referer:"+location.hostname+location.pathname+",func:0007")},"click")}},initLogout:function(){var $loginOut=this.getNode("ssoLoginOut");var isInit=attr($loginOut,"loginout");if(!isInit){attr(this._el,"login","1");_addEvt($loginOut,function(){lib.tray.loginOut(null,!0)})}$loginOut=null},initHideSub:function(){var $this=this;_addEvt(document.body,function(evt){if(!$this._activeTab){return}var target=evt.target||evt.srcElement;var panels=$this.subPanels;var item;for(var i=panels.length-1;i>=0;i--){item=panels[i];if(item.tab===target||_contains(item.tab,target)){return}if(item.panel.entity===target||_contains(item.panel.entity,target)){return}}$this._hideActiveSub()},"click");_addEvt(window,function(){var activeTab=$this._activeTab;if(!activeTab){return}var $tabEl=activeTab.tab;var panel=activeTab.panel;var offsetLeft=activeTab.left;var offsetTop=activeTab.top;var x=Core.Dom.getLeft($tabEl)+$tabEl.offsetWidth+offsetLeft;var y=Core.Dom.getTop($tabEl)+$tabEl.offsetHeight+offsetTop;if($IE6&&this.isFixed){x=x-document.documentElement.scrollLeft;y=y-document.documentElement.scrollTop}panel.setPosition(x,y)},"resize")},_hideActiveSub:function(){var $this=this;if($this._activeTab){var tabEl=$this._activeTab.tab;var panel=$this._activeTab.panel;$this._activeTab=null;panel.hidden();tabEl.className=tabEl.className.replace(/(?:[ ]*)\bcurrent\b/g,"")}},initUserMenu:function(){var $bindEl=this.getNode("userMenu");var isInit=attr($bindEl,"init");if(!isInit){attr($bindEl,"init","1");var $this=this;var hasEmail;var $tabEl=$this.getNode("userMenu");var userMenu=$this._findSub("userMenu");var flag=0;Lib.util.hoverJq({elm:$bindEl,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);if(!flag){flag=1;var panel;if(!userMenu){panel=new lib.tray.UserMenuPanel;$this.addSubPanel("userMenu",panel,$bindEl,$tabEl)}else{panel=userMenu.panel}var $userPanelNode=panel.getNode("panel");panel.initUserInfo($UID);Lib.util.hoverJq({elm:$userPanelNode,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);$this._showPanel("userMenu",-160,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}});getEmail(function(hasEmail){if(hasEmail){panel.getNode("mail").style.display=""}})}$this._showPanel("userMenu",-160,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}});var getEmail=function(cb){if(typeof hasEmail==="boolean"){cb(hasEmail)}else{Utils.Io.JsLoad.request("http://service.mail.sina.com.cn/mailproxy/mail.php",{onComplete:function(){var email=sinamailinfo.email;if(email!=""){hasEmail=!0}else{hasEmail=!1}cb(hasEmail)},onException:function(){}})}}}},initBlogMenu:function(info){var $bindEl=this.getNode("addArticle");var isInit=attr($bindEl,"init");if(!isInit){attr($bindEl,"init","1");var $this=this;var $tabEl=$this.getNode("blogMenu");var flag=0;Lib.util.hoverJq({elm:$tabEl,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);if(!flag){flag=1;var blogMenu=$this._findSub("blogMenu");var panel;if(!blogMenu){panel=new lib.tray.BlogMenuPanel;$this.addSubPanel("blogMenu",panel,$bindEl,$tabEl);if(info["tbh_status"]===1){panel.getNode("tbh_status").style.display=""}}var $blogMenuPanel=panel.getNode("panel");Lib.util.hoverJq({elm:$blogMenuPanel,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);$this._showPanel("blogMenu",-74,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}})}$this._showPanel("blogMenu",-74,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}})}},initNotice:function(){var productName=scope.$PRODUCT_NAME;var pageId=scope.$pageid;if("blog7"!==productName){this.noNotice=!0;return}if(-1===pageId.indexOf("article")&&-1===pageId.indexOf("index")){this.noNotice=!0;return}var flagUid=_getCookie("closeNotice_fzp");var $blogBody=$E("sinablogHead");Lib.checkAuthor();if(flagUid&&flagUid===$UID||!$blogBody){this.noNotice=!0;return}if(!this.notice){var notice=new lib.tray.BlogNotice({appendTo:$E(logoId).parentNode,isPostion:!1,noIframe:!0});this.notice=notice;var $this=this;var height=$blogBody.offsetHeight+30;var logFlag;var onshow=function(){var doc=document;var scrolltop=doc.body.scrollTop+doc.documentElement.scrollTop;if(scrolltop>height){$this.hideActive();$this.setTrayFixed();if(!logFlag){logFlag=1;v7sendLog("48_01_11_"+scope.$pageid)}}else{setTimeout(function(){$this.setTrayPosition();notice.hide()})}};_addEvt(window,onshow,"scroll");lib.Listener.on({name:"tray-announce-close",callBack:function(){_removeEvt(window,onshow,"scroll")}})}},initNewMsgEvt:function(){var tpl=this.tpl;var $newTips=this.getNode("newTips");var isInit=attr($newTips,"init");if(!isInit){attr($newTips,"init","1");var $this=this;_addEvt($newTips,function(evt){evt=evt||window.event;var $target=evt.target||evt.srcElement;Core.Events.stopEvent(evt);$target.style.display="none";$target.innerHTML="";var $msgTab=$this.getNode("trayMsg");Core.Events.fireEvent($msgTab,"click")},"click");$newTips=null}},initMsg:function(){var $bindEl=this.getNode("trayMsg");var isInit=attr($bindEl,"init");if(!isInit){attr($bindEl,"init","1");var $this=this;var flag=0;Lib.util.hoverJq({elm:$bindEl,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);if(!flag){flag=1;var ev=window.event||e;if(ev.preventDefault){ev.preventDefault()}else{ev.returnValue=false}var $bindEl=$this.getNode("trayMsg");var msgPanel=$this._findSub("msgPanel");var panel;if(!msgPanel){panel=new Lib.tray.msgSummaryPanel($bindEl);$this.addSubPanel("msgPanel",panel,$bindEl,$bindEl)}var $msgPanel=panel.getNode("panel");Lib.util.hoverJq({elm:$msgPanel,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);$this._showPanel("msgPanel",-400,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}})}$this._showPanel("msgPanel",-400,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}})}},initunReadMsgPanel:function(){var $bindEl=this.getNode("trayMsg");var isInit=attr($bindEl,"init-unre");if(!isInit){attr($bindEl,"init-unre","1");new lib.tray.unReadMsgPanel($bindEl)}},initSearch:function(){if(!loadCount){var panel=new lib.tray.SearchFormPanel({isPostion:!1,appendTo:"traySearchBar",noIframe:!0});panel.show();_addEvt(document.body,function(evt){evt=evt||window.event;var target=evt.target||evt.srcElement;var $query=panel.getNode("queryTxt");if($query!==target&&panel.entity!==target&&!_contains(target,panel.entity)){panel.catePanel.hide()}},"click")}},initOpenBlog:function(){var $openblogcss=$E("openblogcss");if(!$openblogcss){Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"});var $openBlog=this.getNode("openBlogBtn");scope.addBlogOpenerEvent($openBlog)}},notifyMsgPanel:function($msgTab){var newMsg=$msgTab.getAttribute("msg-count");if(newMsg){try{newMsg=JSON.parse(newMsg)}catch(e){newMsg={}}}else{newMsg=-1}},renderRight:function(tpl){this.setTemplate(tpl);this._el=this.entity;var $loading=byClass(this.$main,"ntopbar_loading")[0];$loading.style.display="none";this.show()},addSubPanel:function(name,panel,bindEl,tabEl){var $this=this;this.subPanels.push({name:name,tab:tabEl,bind:bindEl,panel:panel})},_showPanel:function(name,offsetLeft,offsetTop){var subBar=this._findSub(name);if(!subBar){return}var panel=subBar.panel;var $tabEl=subBar.tab;panel.entity.style.zIndex=512;if("msgPanel"===name){var $newTips=this.getNode("newTips");this.notifyMsgPanel($tabEl);$newTips.style.display="none"}var i,item,$tab;item=this._activeTab;if(item){$tab=item["tab"];if($tab===$tabEl){return}item["panel"].hide();$tab.className=$tab.className.replace(/(?:[ ]*)\bcurrent\b/g,"")}var className=$tabEl.className;if(!/\bcurrent\b/.test(className)){$tabEl.className+=" current"}this._activeTab={name:name,tab:$tabEl,panel:panel,left:offsetLeft,top:offsetTop};var $entity=panel.entity;if(this.isFixed&&(!$IE||$IE>6)){$entity.style.position="fixed"}else{$entity.style.position="absolute"}panel.showWithDom($tabEl,offsetLeft,offsetTop)},_findSub:function(name){var item;for(var i=this.subPanels.length-1;i>=0;i--){item=this.subPanels[i];if(name===item.name){return item}}return null},showNewMsgTips:function(data,sign){var sum=data.sum-data.feed;var $tips=this.getNode("newTips");var $trayMsg=this.getNode("trayMsg");if(sum){if($trayMsg.getAttribute("unread-show-state")==0&&$trayMsg.getAttribute("msg-panel-show-state")==0){$tips.style.display="block"}if(scope.$pageid=="editor"){$tips.style.display="block"}var offsetWidth=this.entity.offsetWidth;$tips.style.left=offsetWidth-$tips.offsetWidth-10+"px";if(sum<10){$tips.innerHTML=sum}else{$tips.innerHTML="•••"}if(!this.newTipsLog){v7sendLog("40_01_49_"+$UID);this.newTipsLog=1}$trayMsg.setAttribute("msg-count",JSON.stringify(data));this.startTitleTips(sum)}else{$trayMsg.setAttribute("msg-count",JSON.stringify(data));this.stopTitleTips()}var feed=data.feed;if(feed){var $feed=this.getNode("newFeed");$feed.style.display="block";var offsetWidth=this.entity.offsetWidth;$feed.style.left=offsetWidth-$feed.offsetWidth-197+"px";feed=feed<10?feed:"•••";$feed.innerHTML=feed;if(!$feed.addEvt){$feed.addEvt=1;_addEvt($feed,function(){location.href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1";$feed.style.display="none";$feed.innerHTML=""})}}},stopTitleTips:function(){if(scope.$pageid=="editor"){return}var title=document.title.replace(/\(\d+\+*\)/,"");document.title=title},startTitleTips:function(sum){if(scope.$pageid=="editor"){return}var title;if(sum){sum=sum>=1e5?"99999+":sum;if(/\(\d+\+*\)/.test(document.title)){title=document.title.replace(/\(\d+\+*\)/,"("+sum+")")}else{title="("+sum+")"+document.title}}document.title=title},hideActive:function(){var item,$tab;if(item=this._activeTab){item["panel"].hide();$tab=item["tab"];$tab.className=$tab.className.replace(/(?:[ ]*)\bcurrent\b/g,"");this._activeTab=null}},setTrayFixed:function(){var $logo=$E(logoId);this.notice.show();var $this=this;setTimeout(function(){$E("traySearchBar").parentNode.style.display="none";$logo.style.display="none";var $tray=$logo.parentNode.parentNode;if(!$IE||$IE>6){lib.Listener.notify("tray-scrolling-fix",{});$tray.style.position="fixed";$tray.style.top="0px"}else if($IE===6){if(!$this.__isFixie6){_addEvt(window,function(evt){if(!$this.isFixed){return}var oldScrollTop=document.documentElement.scrollTop;setTimeout(function(){var current=document.documentElement.scrollTop;if(oldScrollTop===current){$tray.style.display="block";$this._ie6fix(evt)}else if($this.isFixed){$tray.style.display="none"}},50)},"scroll");$this.__isFixie6=!0}}$tray.style.width="100%";if(!$E(_trayHolder)){var height=$tray.offsetHeight;var $holder=$C("div");$holder.style.height=height+"px";$holder.id=_trayHolder;Core.Dom.insertAfter($holder,$tray)}$this.isFixed=!0})},_ie6fix:function(evt){if(this.isFixed){var $logo=$E(logoId);var $tray=$logo.parentNode.parentNode;$tray.style.position="absolute";$tray.style.top=document.documentElement.scrollTop+"px";var trayMsg=this.getNode("trayMsg");if(trayMsg){trayMsg.style.display="none";trayMsg.style.display=""}lib.Listener.notify("tray-scrolling-fix",{})}},setTrayPosition:function(){if($IE6){var trayMsg=this.getNode("trayMsg");if(trayMsg){trayMsg.style.display="none";trayMsg.style.display=""}}lib.Listener.notify("tray-scrolling-nofix",{});var $logo=$E(logoId);var $tray=$logo.parentNode.parentNode;if($E(_trayHolder)){$tray.parentNode.removeChild($E(_trayHolder))}$tray.style.position="";var $search=$E("traySearchBar");$search.style.position="";$search.style.top="";this.notice.hide();$tray.style.display="block";$logo.style.display="block";$E("traySearchBar").parentNode.style.display="block";this.isFixed=!1}});Lib.tray.TrayPanel=TrayPanel;return function(){if(!tray){tray=new TrayPanel}return tray}});Sina.pkg("Utils.Form");Utils.Form.limitMaxLen=function(oTextNode,nMaxLen){var nValue;var keyup=function(){nValue=oTextNode.value;var strLen=Core.String.byteLength(nValue);if(strLen>nMaxLen){oTextNode.value=Core.String.leftB(nValue,nMaxLen)}};Core.Events.addEvent(oTextNode,Core.Function.bind3(keyup,oTextNode),"keyup");Core.Events.addEvent(oTextNode,Core.Function.bind3(keyup,oTextNode),"blur");Core.Events.addEvent(oTextNode,Core.Function.bind3(keyup,oTextNode),"focus")};Core.System.htmlFilter=function(content){var codeHash={"&":"&#038;","<":"&#060;",">":"&#062;"};var k;for(k in codeHash){content=content.replace(new RegExp(k,"g"),codeHash[k])}return content};Utils.Io.loadExternalCSS=function(url,callback){if(typeof url!=="string"){return}var linkObj,styleObj,head=document.getElementsByTagName("head")[0];if($FF){styleObj=$C("style");styleObj.type="text/css";styleObj.innerHTML="@import url("+url+")";head.appendChild(styleObj);(function(){try{styleObj.sheet.cssRules;typeof callback==="function"&&callback()}catch(e){setTimeout(arguments.callee,50)}})()}else{linkObj=$C("link");linkObj.href=url;linkObj.type="text/css";linkObj.rel="stylesheet";linkObj.media="all";head.appendChild(linkObj);if($SAFARI||$CHROME){(function(){try{linkObj.sheet.cssRules;typeof callback==="function"&&callback()}catch(e){setTimeout(arguments.callee,50)}})()}else{linkObj.onload=function(){linkObj.onload=null;typeof callback==="function"&&callback()}}}};Core.Events.click=function(){var isMobile=/mobile/i.test(navigator.userAgent);if($IE&&$IE<9){return function(clickBtn){clickBtn.click()}}else{return function(clickBtn){var evt;if(isMobile){evt=document.createEvent("HTMLEvents")}else{evt=document.createEvent("MouseEvents")}evt.initEvent("click",true,true);clickBtn.dispatchEvent(evt)}}}();Core.Dom.removeClassName=Core.Dom.removeClass;scope.trayPlusTemplayLogout=['<div class="topbar_menu">','<span class="link"><a target="_blank" href="http://blog.sina.com.cn">博客首页</a></span>','<span class="line_s"></span>',"</div>",'<div class="topbar_login"><a id="linkTrayLogin" class="login" href="javascript:;">登录</a><a id="linkReg" target="_blank" class="register" href="">注册</a></div>','<div id="divPopularize" class="topbar_ad"></div>','<div id="loginBarActivity" class="topbar_activity"></div>'].join("");scope.trayPlusTemplayLogin=['<div class="topbar_menu" id="openedBlogTray">','<span id="loginBarOptApp" class="link"><a id="loginBarAppMenuLabel" href="javascript:;">读取中...</a><a href="javascript:;" class="link_arrow" title=""></a></span>','<span class="line_s"></span>','<span style="display:none;" id="loginBarMail" class="link imfor blog_to_mail"><a target="_blank" href="http://mail.sina.com.cn/?s=2">邮件</a><div id="mailpiaohong" style="display:none;" class="imforbox"></div></span>','<span class="line_s" style="display:none;" id="line"></span>','<span id="loginBarCenter" class="link"><a target="_self" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1">个人中心</a></span>','<span class="line_s"></span>','<span id="loginBarFriend" class="link"><a target="_blank" href="http://control.blog.sina.com.cn/blogprofile/profilefriendlist.php">好友</a></span>','<span class="line_s"></span>','<span id="loginBarInbox" class="link imfor"><img id="imgNewMessage" style="display:none;" class="topbar_msg" src="http://simg.sinajs.cn/blog7style/images/common/topbar/topbar_msg.gif"/><a href="#" onclick="return false;">消息</a><a href="#" onclick="return false;" class="link_arrow" title=""></a><div id="ccnotepiaohong" style="display:none;" class="imforbox"></div></span>','<span class="line_s"></span>','<span class="link" id="logOut"><a href="#">退出</a></span>',"</div>",'<div style="display:none" class="topbar_menu" id="noOpenedBlogTray">','<span class="link" style="cursor:default;"><a id="noOpenBlogName">读取中...</a></span>','<span class="line_s"></span>','<span class="link"><a href="#">退出</a></span>',"</div>",'<div class="topbar_noopen" style="display:none" id="outOfOpenBlogTray">','<a id="openBlogBtnTray" title="立即开通博客" class="nowopen" href="javascript:void(0)" onclick="return false;"></a>',"</div>",'<div id="loginBarActivity" class="topbar_activity"></div>'].join("");scope.trayPlusTemplayOnceLoged=['<div class="topbar_menu" id="openedBlogTray">','<span id="loginBarOptApp" class="link"><a id="loginBarAppMenuLabel" href="javascript:;">读取中...</a></span>','<span class="line_s"></span>','<span id="loginBarMail" class="link imfor blog_to_mail"><a target="_blank" href="http://mail.sina.com.cn/?s=2">邮件</a><div id="mailpiaohong" style="display:none;" class="imforbox"></div></span>','<span class="line_s" id="line"></span>','<span id="loginBarCenter" class="link"><a target="_self" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1">个人中心</a></span>','<span class="line_s"></span>','<span id="loginBarFriend" class="link"><a target="_blank" href="http://control.blog.sina.com.cn/blogprofile/profilefriendlist.php">好友</a></span>','<span class="line_s"></span>','<span id="loginBarInbox" class="link imfor"><img id="imgNewMessage" style="display:none;" class="topbar_msg" src="http://simg.sinajs.cn/blog7style/images/common/topbar/topbar_msg.gif"/><a href="#" onclick="return false;">消息</a><div id="ccnotepiaohong" style="display:none;" class="imforbox"></div></span>',"</div>",'<div style="display:none" class="topbar_menu" id="noOpenedBlogTray">','<span class="link" style="cursor:default;"><a id="noOpenBlogName">读取中...</a></span>','<span class="line_s"></span>','<span class="link"><a href="#">退出</a></span>',"</div>",'<div class="topbar_noopen" style="display:none" id="outOfOpenBlogTray">','<a id="openBlogBtnTray" title="立即开通博客" class="nowopen" href="javascript:void(0)" onclick="return false;"></a>',"</div>",'<div id="divPopularize" class="topbar_ad"></div>','<div id="loginBarActivity" class="topbar_activity"></div>'].join("");scope.newStatusTipTemplay=['<div class="tb_layer_arrow"></div>','<div class="tb_layer_Y_main tip_ps" style="width:130px;text-align:left;padding:5px 0 2px 5px;color:#000000">','<a onclick="$E(\'newStatusTip\').style.display=\'none\';return false" href="#" class="tb_friend_inputDel" title="关闭" style="margin-top: 5px;"></a>','<a href="http://i.blog.sina.com.cn/blogprofile/index.php?type=3&from=newstatus&com=2"><span id="nstFeed" style="padding:2px 2px;display:none;">你有<span style="color:red">新动态</span>可查看</span></a>','<a href="http://control.blog.sina.com.cn/blogprofile/profileremind.php?com=2"><span id="nstFavorite" style="padding:3px 2px;display:none;">你有博文被<span style="color:red">转载/收藏</span></span></a>','<img id="gbimg" class="SG_icon SG_icon83" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="17" height="15" align="absmiddle" style="display:none"/><a style="display:none" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=g" id="gbmsg">官博<em>新动态</em></a>',"</div>"].join("");

scope.onceLogedStatusTipTemplay=['<div class="tb_layer_arrow"></div>','<div class="tb_layer_Y_main tip_ps" style="width:130px;text-align:left;padding:5px 0 2px 5px;color:#000000">','<a onclick="$E(\'newStatusTip\').style.display=\'none\';return false" href="#" class="tb_friend_inputDel" title="关闭" style="margin-top: 5px;"></a>','<a href="javascript:void(0);return false;"><span id="nstUnread" style="padding:3px 2px;display:none;">你有<span style="color:red">未读消息</span>可查看</span></a>','<a href="javascript:void(0);return false;"><span id="nstFeed" style="padding:2px 2px;display:none;">你有<span style="color:red">新动态</span>可查看</span></a>','<a href="javascript:void(0);return false;"><span id="nstUpdate" style="padding:3px 2px;display:none;">你最近浏览的博主<span style="color:red">有更新</span></span></a>','<a href="javascript:void(0);return false;"><span id="nstUnpub" style="padding:2px 2px;display:none;">你有<span style="color:red">尚未发表</span>的博文</span></a>',"</div>"].join("");scope.nicknamePanelTemplate=['<div id="#{panel}" class="tb_layer_Y tb_layer_w2" style="z-index:512;">','<div class="tb_layer_arrow"></div>','<div class="tb_layer_Y_main">','<div class="tb_ps">','<div class="tb_ps_list">',"<ul>","<li>",'<span class="tb_ps_nm"><a id="#{linkBlog}" href="javascript:;"><img class="SG_icon SG_icon15" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="博客" align="absmiddle" /><strong>博客</strong></a></span>','<span class="tb_ps_set">[<a target="_blank" id="#{linkPostBlog}" href="http://control.blog.sina.com.cn/admin/article/article_add.php">发博文</a>]</span>',"</li>","<li>",'<span class="tb_ps_nm"><a id="#{linkPhoto}" href="javascript:;"><img class="SG_icon SG_icon18" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="相册" align="absmiddle" /><strong>相册</strong></a></span>','<span class="tb_ps_set">[<a target="_blank" id="#{linkPostPhoto}" href="http://photo.blog.sina.com.cn/upload/upload.php">发图片</a>]</span>',"</li>","<li>",'<span class="tb_ps_nm"><a target="_blank" id="#{linkVBlog}" href="javascript:;"><img class="SG_icon SG_icon16" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="播客" align="absmiddle" /><strong>播客</strong></a></span>','<span class="tb_ps_set">[<a target="_blank" id="#{linkUpload}" href="http://vupload.you.video.sina.com.cn/u.php?m=1">发视频</a>][<a id="#{linkRecord}" href="http://vupload.you.video.sina.com.cn/r.php" target="_blank">录视频</a>]</span>',"</li>","<li>",'<span class="tb_ps_nm"><a id="#{miniblog}" href="javascript:;" target="_blank"><img class="SG_icon SG_icon51" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="微博" align="absmiddle" /><strong>微博</strong></a></span>',"</li>","<li>",'<span class="tb_ps_nm"><a id="#{mySpace}" href="javascript:;"><img class="SG_icon SG_icon41" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="关于我" align="absmiddle" /><strong>关于我</strong></a></span>',"</li>","</ul>",'<div class="clearit"></div>',"</div>",'<div class="tb_ps_manage">','<p><a target="_blank" id="#{linkChangeFace}" href="javascript:;">修改头像昵称</a></p>','<p><a target="_blank" id="#{linkChangePassword}" href="javascript:;">修改登录密码</a></p>','<p><a target="_blank" id="#{linkAccountSetup}" href="javascript:;">账号安全设置</a></p>','<p><a target="_blank" id="#{bindEmail}" href="javascript:;">绑定邮箱</a></p>',"</div>","</div>","</div>","</div>"].join("");scope.NicknamePanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.nicknamePanelTemplate)},Lib.Panel,{initUserInfo:function(uid){var nodes=this.getNodes();scope.$bindEmail=function(data){var node=nodes["bindEmail"];if(data.ret!="y"&&data.errcode!="not_verify"){node.parentNode.removeChild(node)}else{node.href="http://login.sina.com.cn/bindmail/bindmail.php?entry=blog"}};try{var username=/user=([^&]+)&/g.exec(decodeURIComponent(Utils.Cookie.getCookie("SUP")))[1];Utils.Io.JsLoad.request("http://login.sina.com.cn/bindmail/checkmailuser.php?entry=blog&name="+encodeURIComponent(username)+"&utf82bgk=1&callback=scope.$bindEmail",{noreturn:true})}catch(e){}nodes["linkBlog"].href="http://blog.sina.com.cn/u/"+uid;nodes["linkPhoto"].href="http://photo.blog.sina.com.cn/u/"+uid;nodes["linkVBlog"].href="http://you.video.sina.com.cn/m/"+uid;nodes["miniblog"].href="http://control.blog.sina.com.cn/t_sina_blog/tb.php?uname="+uid;nodes["mySpace"].href="http://blog.sina.com.cn/s/profile_"+uid+".html";nodes["linkChangeFace"].href="http://control.blog.sina.com.cn/blogprofile/nick.php";nodes["linkChangePassword"].href="http://login.sina.com.cn/member/security/password.php";nodes["linkAccountSetup"].href="http://login.sina.com.cn/member/security.php";var node=["linkBlog","linkPhoto","linkVBlog","miniblog","mySpace","linkChangeFace","linkChangePassword","linkAccountSetup"];for(var i=0;i<node.length;i++){nodes[node[i]].onclick=function(){v7sendLog("40_01_02_"+$UID)}}}});var st=['<div id="#{panel}" style="z-index:512;" class="tb_layerBox">',"<ul>",'<li id="#{blog}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">博文</a></li>','<li id="#{bauthor}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">博主</a></li>','<li id="#{song}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">音乐</a></li>','<li id="#{video}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">视频</a></li>','<li id="#{vauthor}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">播主 </a></li>',"</ul>","</div>"];scope.searchPanelTemplate=st.join("");scope.SearchPanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.searchPanelTemplate)},Lib.Panel,{config:{blog:{text:"博文",url:"http://search.sina.com.cn/?c=blog",keyName:"q",range:"article",by:"all"},bauthor:{text:"博主",url:"http://search.sina.com.cn/?c=blog",keyName:"q",range:"author",by:"all"},song:{text:"音乐",url:"http://music.sina.com.cn/yueku/search/s.php",keyName:"k",t:"song",s:"",ts:"",type:"",stype:""},video:{text:"视频",url:"http://search.video.sina.com.cn/search.php",keyName:"k",t:"",s:"sup",ts:"",type:"boke",stype:"1"},vauthor:{text:"播主",url:"http://search.video.sina.com.cn/search.php",keyName:"k",t:"",s:"sup",ts:"",type:"boke",stype:"3"}}});Utils.Flash.swfView={swfList:[],Add:function(sURL,sID,sPID,nWidth,nHeight,nVersion,sBGColor,oVar,oParam){if(sURL&&sPID){this.swfList[this.swfList.length]={sURL:sURL,sID:sID,sPID:sPID,nWidth:nWidth,nHeight:nHeight,nVersion:nVersion,sBGColor:sBGColor,oVar:oVar,oParam:oParam};this.Init();return}},Init:function(){var so;var list=this.swfList;for(var i=0,len=list.length;i<len;i++){var _list=list[i];so=new Utils.Flash.swfObject(_list.sURL,_list.sPID,_list.nWidth,_list.nHeight,_list.nVersion,_list.sBGColor);if(_list.oVar){for(var key in _list.oVar){so.addVariable(key,_list.oVar[key])}}if(_list.oParam){for(var Key in _list.oParam){so.addParam(Key,_list.oParam[Key])}}so.write(_list.sID)}list=[];_list=null;so=null}};Utils.Io.loadCss=function(oCss,oTarget){if(oCss==null){return false}oTarget=oTarget||window;var _target=oTarget.document;oCss.id=oCss.id||"";var _css;if(oCss.url){_css=_target.createElement("link");_css.setAttribute("rel","stylesheet");_css.setAttribute("type","text/css");_css.setAttribute("href",oCss.url)}else if(oCss.text){_css=_target.createElement("style");_css.setAttribute("type","text/css");if($IE){_css.styleSheet.cssText=oCss.text}else{_css.innerHTML=oCss.text}}_css.setAttribute("id",oCss.id);_target.getElementsByTagName("head")[0].appendChild(_css)};Core.Dom.opacity=function(elm,value){elm=typeof elm=="string"?$E(elm):elm;elm.style.filter="alpha(opacity="+value+")";elm.style.opacity=value/100};var st=['<div id="#{panel}" style="z-index:512;" class="tb_layer_Y tb_layer_w6" style="left:400px; top:700px;">','<div class="tb_layer_arrow"></div>','<div class="tb_layer_Y_main">','<div class="tb_mas" id="#{newInboxList}" style="">','<div class="tb_mas_list">','<ul id="#{changebgli1}"  style="display:none" >','<li  style="display:none" >','<span id="#{ccsysgonggao}" class="tb_friend_nm">[<strong>公告</strong>] <a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">新浪邀你一起共度中秋活动</a></span>','<span class="tb_friend_set"><a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">&gt;&gt;</a></span>',"</li>",'<li style="display:none">','<span id="#{ccsystongzhi}" class="tb_friend_nm">[<strong>通知</strong>] <a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">新浪2010邀你一起共度中秋活动...</a></span>','<span class="tb_friend_set"><a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">&gt;&gt;</a></span>',"</li>","</ul>",'<ul class="bd" id="#{changebgli2}">','<li  id="#{newInboxLoding}" style="cursor:default" ><div style="margin: 0pt; padding: 10px;text-align:center;"><img src="http://simg.sinajs.cn/blog7style/images/common/loading.gif"><div></li>','<li  id="#{nomsgli}" style="cursor:default;" >还没有消息</li>','<li style="float:none;"><span class="mas_more"><a id="#{mas_moremsg}" href="http://i.blog.sina.com.cn/blogprofile/profilelatestnote.php">全部消息</a></span></li>',"</ul>",'<div class="clearit"></div>',"</div>",'<ul class="commentslist" id="commentdata">','<li><a class="conn" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1">评论</a><a class="num" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1" id="#{commentRelapseCount}" ></a></li>','<li><a class="conn" href="http://i.blog.sina.com.cn/blogprofile/wall.php">留言</a><a class="num" href="http://i.blog.sina.com.cn/blogprofile/wall.php" id="#{guestBookCount}">1</a></li>','<li class="lst"><a class="conn" href="http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php">好友邀请</a><a class="num" href="http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php" id="#{inviteCount}" ></a></li>','<li><a class="conn" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1">纸条</a><a class="num" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1" id="#{messageCount}" ></a></li>','<li><a class="conn" target="_blank" href="http://mail.sina.com.cn" reject="1">邮箱</a><a class="num" href="http://mail.sina.com.cn" id="#{mailCount}" target="_blank" reject="1"></a></li>','<li><a class="conn" href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">系统消息</a><a class="num" href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote" id="#{sysnoticeCount}" ></a></li>',"</ul>","</div>","</div>","</div>"];scope.newInboxPanelTemplate=st.join("");Lib.LocalDB={_this:null,isFlashReady:false,FlaDom:null,updataFun:null,loadedFun:null,regiFun:[],regiFunArgs:[],scacheReady:function(){var me=Lib.LocalDB;me.isFlashReady=true;if(me.loadedFun){me.loadedFun(me._this)}var f=me.regiFun;var a=me.regiFunArgs;for(var i=0;i<f.length;i++){f[i].apply(null,a[i])}},registerFun:function(fun,args){this.regiFun.push(fun);var a=args||[];this.regiFunArgs.push(a)},set:function(key,data){if(this.isFlashReady){try{this.FlaDom.setLazyInterface(key,data);return true}catch(e){trace("set函数出错")}}return false},get:function(key,escapeMsecond,ignore){if(this.isFlashReady){try{return this.FlaDom.getLazyInterface(key,escapeMsecond,ignore)}catch(e){trace("get函数出错")}}return false},clearCache:function(escapeMsecond,key){if(this.isFlashReady){try{$E("scache").clearCache(escapeMsecond,key)}catch(e){trace("gclearCache函数出错")}}return false},loadFlash:function(containerDiv){var random="";if(window.$Maxthon||window.$360||window.$TT){random="?t="+Core.Math.getUniqueId()}if(!this.FlaDom){var FlashPlayer=new Utils.Flash.swfObject($_GLOBAL.flashBasicURL+"scache.swf"+random,"scache","1","1","9","#00ff00");FlashPlayer.addParam("quality","high");FlashPlayer.addParam("wmode","transparent");FlashPlayer.addParam("allowScriptAccess","always");FlashPlayer.write(containerDiv);this.FlaDom=$E("scache")}},getServer:function(){try{return this.FlaDom.isServer()}catch(e){trace("判断是否是通信主机发生错误");return false}},login:function(uid){try{this.FlaDom.login(uid)}catch(e){trace("login函数出错");trace(uid)}},sendToClient:function(data){try{if(this.getServer()){this.FlaDom.sendToClient(data)}else{}}catch(e){trace("sendToClient函数出错")}},setClientJsFun:function(jsFun){try{if(this.getServer()){this.FlaDom.setClientJsFun(jsFun)}else{trace("非主机不可以设置接收函数")}}catch(e){trace("setClientJsFun函数出错")}},receive:function(data){this.updataFun(data)}};scope.msnTipsTemplate=['<div id="#{panel}" style="position: absolute; width: 369px; padding-top: 7px; font-size: 12px; z-index:511">',"<div  style=\"top: 0pt; left: 65px; position: absolute; width: 16px; height: 8px; background: url('http://simg.sinajs.cn/blog7style/images/special/move/bg_boxtop_01.png') no-repeat scroll 0pt 0pt transparent; z-index: 100;\"></div>","<div style=\"padding: 5px 6px 9px 14px; border: 1px solid rgb(181, 202, 214); background: url('http://simg.sinajs.cn/blog7style/images/special/move/bg_asiangames.jpg') no-repeat scroll left bottom rgb(255, 255, 255); z-index: 1;\">",'<p id="#{close}" class="close" style="float: right; margin: 0pt; cursor: pointer; width: 8px; height: 8px; font-size: 0pt;background:url(\'http://simg.sinajs.cn/blog7style/images/special/move/btn_close.gif\') no-repeat 0 0;"></p>','<div style="width: 342px; margin: 10px 0pt 0pt; padding: 0pt 0pt 3px;">','<a style="float: left; margin: 0pt 10px 0pt 0pt;" href="#"><img height="91" width="122" style="border: 0pt none;" alt="MSN" src="http://simg.sinajs.cn/blog7style/images/special/move/img_msnphoto.png"></a>','<h3 style="padding: 2px 0pt 5px; color: rgb(0, 0, 0); margin: 0pt; font-size: 12px;">各位拥有MSN帐号的同学注意啦!</h3>','<p style="width: 268px; display: inline; text-indent: 0pt; padding: 0pt; color: rgb(51, 51, 51); line-height: 19px;">新浪博客帐号与MSN帐号已经实现关联。您可以使用MSN帐号来登录博客，绑定后发博文、发图片可同步到Live，第一时间让您的MSN好友知晓。</p>',"</div>",'<p style="clear: both; height: 30px; margin: 12px 10px 4px 0pt; padding: 12px 0pt 0pt; border-top: 1px solid rgb(220, 213, 211); text-align: right;"><a style="float: right; color: rgb(176, 173, 172); margin-top: 10px; text-decoration: none;" href="javascript:void(0);" id="#{noMoreShow}">不再显示</a><a style="float: right; text-decoration: none; margin: 10px 14px 0pt 16px;color:#2d3186;" href="http://blog.sina.com.cn/s/blog_4b0f52990100lt3i.html">帮助</a><a id="#{setNow}"style="float: right;" href="http://control.blog.sina.com.cn/blogprofile/msnbind.php"><img height="32" width="105" style="border: medium none;" alt="立即设置" src="http://simg.sinajs.cn/blog7style/images/special/move/btn_receive01.jpg"></a></p>',"</div>","</div>"].join("");scope.msnTips=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.msnTipsTemplate)},Lib.Panel,{initUserInfo:function(nick,uid){var nodes=this.getNodes();this.setFixed($E("loginBarActivity"),-230,-2);var _this=this;nodes["close"].onclick=function(){_this.hidden()};nodes["noMoreShow"].onclick=function(){_this.hidden();Utils.Cookie.setCookie("noMoreMsnTips"+$UID,1,24*100,"/",".blog.sina.com.cn")};nodes["setNow"].onclick=function(){v7sendLog("95_02_01",scope.$pageid,"")}},setFixed:function(dom,offsetLeft,offsetTop){var _this=this;setTimeout(function(){_this.showWithDom(dom,offsetLeft,offsetTop);_this.fadeIn()},2e3);Core.Events.addEvent(window,function(){var x=Core.Dom.getLeft(dom)+dom.offsetWidth+offsetLeft;var y=Core.Dom.getTop(dom)+dom.offsetHeight+offsetTop;if($IE6&&_this.isFixed){x=x-document.documentElement.scrollLeft;y=y-document.documentElement.scrollTop}_this.setPosition(x,y)},"resize")},fadeIn:function(){var entity=this.entity;Core.Dom.opacity(entity,0);var i=0;(function fn(){Core.Dom.opacity(entity,i+=5);if(Core.Dom.getStyle(entity,"opacity")<1){setTimeout(fn,20)}})()}});scope.NewInboxPanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.newInboxPanelTemplate);this.nodes=this.getNodes();var me=this;var t=Lib.LocalDB;if(/Mobile/i.test(navigator.userAgent)){setTimeout(function(){me.requestDataInterface()},100)}else{if(!t.FlaDom){t._this=me;t.loadedFun=me.FlashLoaded;t.loadFlash("trayFlashConnetion")}else{me.FlashLoaded(me)}}Core.Events.addEvent($E("loginBarInbox"),function(event){v7sendLog("40_01_09_"+$UID);var target=event&&event.target||window.event&&window.event.srcElement;if(target&&target.tagName&&target.tagName.toLowerCase()=="a"){v7sendLog("45_01_10_"+$UID)}me._hasOverview=true;$E("ccnotepiaohong").style.display="none";me.requestMsgDate()},"click");this.interfaceMessages=new Interface("http://interface.blog.sina.com.cn/riaapi/profile/unread.php","jsload")},Lib.Panel,{nodes:null,_connectSWF:null,_SWFChannelName:"inboxConnection",interfaceMessges:null,isMessageLoaded:false,isUICServiceLoaded:true,isHaveNewMessage:false,_listData:null,_productIDs:{blog:1,vblog:2,group:4,photo:8,cube:16},_msgIsLoad:false,_newnote:0,_hasOverview:false,interfaceUICServiceURL:"http://uic.sinajs.cn/uic?type=service&uids=#{uids}&varname=service",FlashLoaded:function(me){var t=Lib.LocalDB;var _this=me;window.$updateData=function(dataObj){_this.updateData(dataObj)};Lib.checkAuthor();t.login($UID);t.setClientJsFun("$updateData");setTimeout(function(){_this.requestDataInterface()},100)},requestMsgDate:function(){this.updateView("loading");var me=this;var clearnum=0;if(this._hasOverview){clearnum=this._newnote;this._newnote=0;this._hasOverview=false}var inter=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/note/notetips.php?clearnum="+clearnum,"jsload");inter.request({GET:{uid:$UID},onSuccess:function(res){if(typeof res.announcement!="undefined"&&res.announcement){me.nodes["ccsysgonggao"].innerHTML='[<strong>公告</strong>]&nbsp;<a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">'+res.announcement+"</a>";me.nodes["ccsysgonggao"].parentNode.style.display=""}else{me.nodes["ccsysgonggao"].parentNode.style.display="none"}if(typeof res.sysNote!="undefined"&&res.sysNote){me.nodes["ccsystongzhi"].innerHTML='[<strong>通知</strong>]&nbsp;<a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">'+res.sysNote+"</a>";me.nodes["ccsystongzhi"].parentNode.style.display=""}else{me.nodes["ccsystongzhi"].parentNode.style.display="none"}if(typeof res.sysNote=="undefined"&&typeof res.announcement=="undefined"){me.nodes["ccsystongzhi"].parentNode.parentNode.style.display="none"}else{me.nodes["ccsystongzhi"].parentNode.parentNode.style.display=""}me.nodes["nomsgli"].style.display="";if(typeof res.notice!="undefined"&&res.notice){var aNotice=res.notice;while(me.nodes["changebgli2"].childNodes.length>2){me.nodes["changebgli2"].removeChild(me.nodes["changebgli2"].childNodes[me.nodes["changebgli2"].childNodes.length-3])}for(var i=aNotice.length-1;i>=0;i--){var li=$C("li");li.innerHTML=aNotice[i].data;li._href=aNotice[i].url;me.nodes["changebgli2"].insertBefore(li,me.nodes["changebgli2"].firstChild);li.onclick=function(){v7sendLog("45_01_11_"+$UID);window.location.href=this._href};me.nodes["nomsgli"].style.display="none"}}if(parseInt($E("ccnotepiaohong").innerHTML,10)>0){var num=parseInt($E("ccnotepiaohong").innerHTML,10);var cn=me.nodes["changebgli2"].childNodes;for(var j=0;j<cn.length-2&&j<num;j++){Core.Dom.removeClassName(cn[j],"cur");cn[j].className+=" cur"}}me.updateView("loaded");me._msgIsLoad=true;me.bindliEvent()},onError:function(data){},onFail:function(){}});var mailInter=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/note/unreadmail.php","jsload");mailInter.request({onSuccess:function(data){var tota=parseInt(data)||0;if(tota>99){tota="99+"}me.nodes.mailCount.innerHTML=tota||""},onError:function(){me.nodes.mailCount.innerHTML=""}})},requestDataInterface:function(){var _this=this;Lib.checkAuthor();var t=Lib.LocalDB;var d=null;if(t.isFlashReady&&!this.checkCache){this.clearCache();d=t.get("uid_"+$UID+"unread",60*1e3*4);this.checkCache=true}var unreadOk=function(data,isCache){if(!d&&!isCache){t.set("uid_"+$UID+"unread",data)}if(data["isBindToMsn"]==0&&Utils.Cookie.getCookie("noMoreMsnTips"+$UID)!=1){}_this.isMessageLoaded=true;_this.onMessageLoad(data["nickname"]);_this._listData=data;scope.unreadMsg=data;scope.nickname=data["full_nickname"];scope.loginUserWtype=data["login_wtype"];if(data.svr_time)scope.$svr_time=data.svr_time;if(data.nfn>=1){v7sendLog("40_01_03_"+$UID);_this.initNewStatusTip(data)}else{}_this.updateListData(data);if(_this.isMessageLoaded){_this.updateData({data:_this._listData});_this.onLoaded()}scope.hasOpenBlog=data.isbloguser==1?"open":"no";scope.bindTrayOpenTime=1;Lib.Listener.notify("tray-data-loaded",data);if(scope.hasOpenBlog=="no"&&scope.bindTrayOpenTime==1){if(!$E("openblogcss")){Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"})}$E("openedBlogTray").style.display="none";$E("noOpenedBlogTray").style.display="";$E("outOfOpenBlogTray").style.display="";scope.addBlogOpenerEvent($E("openBlogBtnTray"));$E("noOpenBlogName").href="http://blog.sina.com.cn/u/"+$UID;scope.bindTrayOpenTime=2}scope.unreadOkExecuted=true};if(d){unreadOk(d,true);trace("-------unread 使用缓存的数据!!!----")}else{trace("-----直接调用unread接口！！！");this.interfaceMessages.request({GET:{uid:$UID,product:"blog"},onSuccess:unreadOk,onError:function(data){},onFail:function(){}})}},clearCache:function(){var pageId={profile_notice:"notice",profile_paperlist:"message",profile_invitelist:"invite",profile_commlist:"blogcomment",profile_replylist:"blogrecomment",profile_guestBookM:"gbook",profile_commtrash:"trashcomment",profile_commphotolist:"photocomment",profile_index:"profile_index",profile_remind:"profile_remind"};var t=Lib.LocalDB;var d=t.get("uid_"+$UID+"unread",60*1e3*4);if(d&&pageId[scope.$pageid]&&typeof d[pageId[scope.$pageid]]!=undefined){trace("-----清除缓存");t.clearCache(10,"uid_"+$UID+"unread")}var ccn=$UID+"_clear_flash";var clearFlash=Utils.Cookie.getCookie(ccn);if(clearFlash==1){trace("【活动】根据cookie标记,清除Flash缓存");t.clearCache(10,"uid_"+$UID+"unread");Utils.Cookie.setCookie(ccn,"",0,"/",".sina.com.cn")}},initMsnTips:function(){Lib.checkAuthor();(new scope.msnTips).initUserInfo($nick,$UID)},initNewStatusTip:function(data){if(scope.$pageid=="profile_index"||scope.$pageid=="pageSetM"||scope.$pageid=="editor"){return}var tip=$E("newStatusTip");if(tip||!data){return}v7sendLog("45_01_07_"+$UID);tip=$C("div");tip.id="newStatusTip";tip.className="tb_layer_Y tb_layer_w3";tip.style.width="138px";tip.innerHTML=scope.newStatusTipTemplay;var a=$T($E("loginBarCenter"),"a")[0];var loc=Core.Dom.getXY(a);tip.style.left=loc[0]-(138/2-a.offsetWidth/2)+"px";tip.style.top=loc[1]+a.offsetHeight+"px";tip.style.zIndex="510";if(a.href.indexOf("?")==-1){a.href+="?type=2&from="+scope.$pageid}Core.Dom.opacity(tip,0);document.body.appendChild(tip);if(data.nfn>=1){$E("nstFeed").style.display="block";$E("nstFeed").onclick=function(){v7sendLog("45_01_09_"+$UID);v7sendLog("40_01_04_"+$UID)}}if(data.official_blog==1){$E("gbimg").style.display="";$E("gbmsg").style.display=""}for(var i=1;i<=500;i++){(function(val){setTimeout(function(){Core.Dom.opacity(tip,val*2/10)},val*2)})(i)}if(scope.$pageid=="editor"){a.target="_blank";$E("nstFeed").parentNode.target="_blank";$E("gbmsg").style.target="_blank";Core.Events.addEvent(a,this.closeTip(a),"click")}Core.Events.addEvent(window,function(){var a=$T($E("loginBarCenter"),"a")[0];var loc=Core.Dom.getXY(a);tip.style.left=loc[0]-(138/2-a.offsetWidth/2)+"px";tip.style.top=loc[1]+a.offsetHeight+"px"},"resize")},closeTip:function(ele){return function(){$E("newStatusTip").style.display="none";ele.href=ele.href.split("?")[0]}},updateData:function(dataObj){var t=Lib.LocalDB;var _this=this;Lib.checkAuthor();try{if($UID&&$UID==dataObj.uid||t.getServer()==true){_this.isHaveNewMessage=false;_this.isMessageLoaded=false;_this.updateListData(dataObj.data);if(_this._newnote>0){v7sendLog("45_01_08_"+$UID);v7sendLog("40_01_08_"+$UID)}if(dataObj.data.nfn>=1){_this.initNewStatusTip()}}}catch(ex){}if(t.getServer()==true){Lib.checkAuthor();t.sendToClient({data:dataObj.data,uid:$UID});setTimeout(function(){_this.requestUICService();_this.requestDataInterface()},6e4*4)}else{setTimeout(function(){if(t.getServer()){t.setClientJsFun("$updateData");_this.requestUICService();_this.requestDataInterface()}},6e4*4)}},initializeList:function(){this.requestUICService();this.checkCache=false},updateListData:function(dataCollection){try{var tota=0;tota+=parseInt(this._getFormatCountString(dataCollection["invite"])||0);if(tota>500){tota="500+"}this.nodes["inviteCount"].innerHTML=tota?tota:""}catch(e){}try{var tota=0;tota+=parseInt(this._getFormatCountString(dataCollection["message"])||0);if(tota>500){tota="500+"}this.nodes["messageCount"].innerHTML=tota?tota:""}catch(e){}try{var tota=0;tota+=parseInt(dataCollection["unreadnotices"]||0);tota+=parseInt(dataCollection["notice"]||0);if(tota>500){tota="500+"}this.nodes["sysnoticeCount"].innerHTML=tota?tota:""}catch(e){}Lib.checkAuthor();try{var tota=0;tota+=parseInt(this._getFormatCountString(dataCollection["gbook"])||0);tota+=parseInt(this._getFormatCountString(dataCollection["trashwall"])||0);if(tota>500){tota="500+"}this.nodes["guestBookCount"].innerHTML=tota?tota:""}catch(e){}try{var tota=0;tota+=parseInt(dataCollection["blogcomment"]||0);tota+=parseInt(dataCollection["blogrecomment"]||0);tota+=parseInt(dataCollection["photocomment"]||0);tota+=parseInt(dataCollection["trashcomment"]||0);if(tota>500){tota="500+"}this.nodes["commentRelapseCount"].innerHTML=tota?tota:""}catch(e){}this._newnote=parseInt(dataCollection["newnotes"],10);if(this._newnote>0){$E("ccnotepiaohong").innerHTML=this._newnote>500?"500+":this._newnote;$E("ccnotepiaohong").style.display=""}else{$E("ccnotepiaohong").style.display="none"}var i,msgCfg=["notice","invite","message","blogcomment","blogrecomment","photocomment","trashcomment","vblogcomment","gbook"],len=msgCfg.length;for(i=0;i<len;i++){if(parseInt(dataCollection[msgCfg[i]])>0){this.isHaveNewMessage=true}var k;for(k in dataCollection){if(k!="version"&&window.parseInt(dataCollection[k])>0){if($E("left_"+k)){$E("left_"+k).innerHTML="("+dataCollection[k]+")"}}}}},requestUICService:function(){Lib.checkAuthor();if(this.isMessageLoaded){this.updateData({data:this._listData});this.onLoaded()}},_getFormatCountString:function(count){var result="";if(!isNaN(parseInt(count))&&parseInt(count)!=0){if(parseInt(count)>500){result="(<strong>500+</strong>)"}else{result=count}}return result},updateView:function(loadState){this.nodes["newInboxLoding"].style.display=loadState=="loaded"?"none":"";if(loadState=="loading"){this.nodes["nomsgli"].style.display="none"}},onLoaded:function(){},onMessageLoad:function(nickname){$E("loginBarAppMenuLabel").innerHTML=Core.System.htmlFilter(nickname);$E("noOpenBlogName").innerHTML=Core.System.htmlFilter(nickname)},bindliEvent:function(){var lis=this.nodes["changebgli1"].getElementsByTagName("li");var lis2=this.nodes["changebgli2"].getElementsByTagName("li");for(var i=0;i<lis.length;i++){lis[i].style.cursor="pointer";lis[i].onmouseover=function(){this._className=this.className;this.className="on"};lis[i].onmouseout=function(){this.className=this._className}}for(var i=0;i<lis2.length-1;i++){if(lis2[i]==this.nodes["nomsgli"]){continue}lis2[i].style.cursor="pointer";lis2[i].onmouseover=function(){this._className=this.className;this.className="on"};lis2[i].onmouseout=function(){this.className=this._className}}var commentdata=$E("commentdata");if(commentdata){Core.Events.addEvent(commentdata,function(event){logFunc(event)})}Core.Events.addEvent(this.nodes["changebgli1"],function(event){logFunc(event)});Core.Events.addEvent(this.nodes["changebgli2"],function(event){logFunc(event)});function logFunc(event){var target=event&&event.target||window.event&&window.event.srcElement;if(target&&target.tagName&&(target.tagName.toLowerCase()=="a"||target.tagName.toLowerCase()=="li")&&!target.getAttribute("reject")){v7sendLog("40_01_10_"+$UID);v7sendLog("45_01_11_"+$UID)}}}});scope.addArticleTemplate=['<div id="#{panel}" class="wrtBlog_sub" style="z-index:512;">','<div class="wrtBlog_sub2">','<p><img width="15" height="16" align="absmiddle" title="写365" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon138"><a onclick="v7sendLog(\'48_01_18\');v7sendLog(\'40_01_14\');" href="http://control.blog.sina.com.cn/admin/article/article_add.php?tag365" target="_blank">写365</a></p>','<div class="SG_j_linedot"></div>','<p><img class="SG_icon SG_icon88" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="长微博" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\'40_01_14\')" href="http://control.blog.sina.com.cn/admin/article/changWeiBo.php">长微博</a></p>','<div class="SG_j_linedot"></div>','<p><img class="SG_icon SG_icon18" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="发照片" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\'40_01_14\')" href="http://photo.blog.sina.com.cn/upload/upload.php">发照片</a></p>','<div class="SG_j_linedot"></div>','<p><img class="SG_icon SG_icon16" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="发视频" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\'40_01_14\')" href="http://vupload.you.video.sina.com.cn/u.php?m=1">发视频</a></p>','<div id="tray_tbh_ware_linedot" style="display:none;" class="SG_j_linedot"></div>','<p id="tray_tbh_ware_link" style="display:none;"><img class="SG_icon SG_icon150" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="发商品" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\'40_01_14\')" href="http://control.blog.sina.com.cn/admin/article/article_add.php?tbh=1">发商品</a></p>',"</div>","</div>"].join("");scope.addArticlePanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.addArticleTemplate);this.hidden()},Lib.Panel,{});String.prototype.format=function(){var r=!arguments[0]||typeof arguments[0]=="undefined"?"":arguments[0].toString();var re=/(.*?)({(\d+)(:([0-9a-z]+))?})/gi;var t=this.match(re);if(t){for(var i=0,l=t.length;i<l;i++){t[i]=t[i].replace(re,function(){return RegExp.$1});t[i]=RegExp.$1;switch(typeof arguments[parseInt(RegExp.$3)]){case"undefined":t[i]+=RegExp.$2;break;case"number":t[i]+=isNaN(RegExp.$5)||RegExp.$5==""?arguments[parseInt(RegExp.$3)]:arguments[parseInt(RegExp.$3)].toString(Math.max(Math.min(Math.round(RegExp.$5),36),2));break;default:t[i]+=arguments[parseInt(RegExp.$3)]}}t.push(this.replace(re,""));return t.join("")}return this};Lib.pkg("Login");Lib.Login.info=function(){var info;if(window["sinaSSOController"]&&(info=sinaSSOController.getLoginInfo())){return info}else{return{}}};Lib.Login.LoginPost=Core.Class.create();Lib.Login.LoginPost.prototype={url:"http://i.sso.sina.com.cn/js/ssologin.js",callback:null,initialize:function(callback,clearDomain,from){window.sinaSSOConfig=new function(){if(from){this.from=from}this.pageCharset="utf-8";this.noActiveTime=14400;this.setDomain=true;this.entry="boke";this.customInit=function(){};this.customLoginCallBack=callback;this.customLogoutCallBack=function(result){};this.useIframe=true}},login:function(username,password,time){var _this=this;if(typeof sinaSSOController=="undefined"||!sinaSSOController){trace("no sso");Utils.Io.JsLoad.request(this.url,{onComplete:function(){__login()},onException:function(){},timeout:3e4,isRemove:false})}else{trace("has sso");sinaSSOController.init();if(typeof sinaSSOController.setLoginType=="function"){sinaSSOController.setLoginType(2)}if(typeof sinaSSOController.getServerTime=="function"){}
trace("init ok");__login()}function __login(){if(typeof time=="undefined"){sinaSSOController.login(username,password)}else{sinaSSOController.login(username,password,time)}}},parse:function(loginStatus){this.callback.call(loginStatus)}};(function(){var _inputNode;var _rndID=parseInt(Math.random()*100);var _showMenuItems=[];var _selectMenuIndex=-1;var _selectMenuText="";var _css="#userPosition {padding: 0;margin: 0;border: 0;position: absolute;z-index: 999;}\r\n				#sinaNote {position: absolute;z-index: 999999;width: auto;overflow: hidden;padding: 0;margin: 0;\r\n				border: 1px solid #CCCCCC;background: #ffffff;text-align:left;}\r\n				#sinaNote li {font-size: 12px;list-style: none;margin: 0 1px;height: 20px;padding: 0 5px;clear: both;\r\n				line-height: 20px;cursor: pointer;color: #999999;}\r\n				#sinaNote li.note {text-align: left;color: #999999;}";var _viewWindow=window;var passcardOBJ={overfcolor:"#999",overbgcolor:"#e8f4fc",outfcolor:"#000000",outbgcolor:"",menuStatus:{"sina.com":true,"sina.cn":true,"vip.sina.com":true,"qq.com":true,"163.com":true,"126.com":true,"hotmail.com":true,"yahoo.com.cn":true,"gmail.com":true}};passcardOBJ.createNode=function(){var d=_viewWindow.document;var div=d.createElement("div");div.innerHTML='<ul id="sinaNote" style="display:none;"></ul>';var obj=d.createElement("style");obj.setAttribute("type","text/css");try{if($IE){obj.styleSheet.cssText=_css}else{obj.innerHTML=_css}}catch(e){trace(e.message)}var total=d.createElement("div");total.appendChild(div);total.appendChild(obj);d.body.appendChild(total)};passcardOBJ.arrowKey=function(keyCodeNum){if(keyCodeNum==38){if(_selectMenuIndex<=0){_selectMenuIndex=_showMenuItems.length}_selectMenuIndex--;passcardOBJ.selectLi(_selectMenuIndex)}if(keyCodeNum==40){if(_selectMenuIndex>=_showMenuItems.length-1){_selectMenuIndex=-1}_selectMenuIndex++;passcardOBJ.selectLi(_selectMenuIndex)}};passcardOBJ.showList=function(e){_selectMenuText="";var keyCodeNum=Core.Events.getEvent().keyCode;if(keyCodeNum==38||keyCodeNum==40){passcardOBJ.arrowKey(keyCodeNum);return false}if(!$E("sinaNote")){passcardOBJ.createNode()}var username=$E(e).value;var menuList={};var atIndex=username.indexOf("@");var InputCase="";var InputStr="";if(atIndex>-1){InputCase=username.substr(atIndex+1);InputStr=username.substr(0,atIndex)}_showMenuItems=[];_selectMenuIndex=0;_showMenuItems[_showMenuItems.length]="sinaNote_MenuItem_Title_"+_rndID;for(var key in this.menuStatus){this.menuStatus[key]=true;if(InputCase!=""&&InputCase!=key.substr(0,InputCase.length)){this.menuStatus[key]=false}else{_showMenuItems[_showMenuItems.length]="sinaNote_MenuItem_"+key+"_"+_rndID}}var listcontent='<li class="note">请选择登录类型</li>';listcontent+='<li id="sinaNote_MenuItem_Title_'+_rndID+'">'+username+"</li>";var itemLabel;for(var mykey in this.menuStatus){if(this.menuStatus[mykey]==true){if(InputStr==""){itemLabel=username+"@"+mykey}else{itemLabel=InputStr+"@"+mykey}listcontent+='<li id="sinaNote_MenuItem_'+mykey+"_"+_rndID+'" title="'+itemLabel+'">'+itemLabel+"</li>"}}$E("sinaNote").innerHTML=listcontent;for(var i=0;i<username.length;i++){if(username.charCodeAt(i)<160){$E("sinaNote").style.display="";this.selectList(e)}else{this.hideList()}}var el=$E(e);var note=$E("sinaNote");var frameLeft=0;var frameTop=0;var framePos;if(_viewWindow!=window){framePos=Core.Dom.getXY(window.frameElement);frameLeft=framePos[0];frameTop=framePos[1]}var inputWidth=el.offsetWidth;if(inputWidth<200){inputWidth=200}note.style.width=inputWidth-2+"px";var inputXY=Core.Dom.getXY(el);note.style.left=inputXY[0]-($IE?2:-1)+frameLeft+"px";note.style.top=inputXY[1]+el.offsetHeight-($IE?2:-1)+frameTop+"px"};passcardOBJ.selectList=function(e){var unames=$E("sinaNote").getElementsByTagName("li");for(var i=1;i<unames.length;i++){unames[1].style.backgroundColor=passcardOBJ.overbgcolor;unames[1].style.color=passcardOBJ.outfcolor;unames[i].onmousedown=function(){var temp=this.innerHTML;if(temp.indexOf("非新浪邮箱")>-1){var pos=temp.split("@");$E(e).value=pos[0]}else{$E(e).value=this.innerHTML}if(Core.Events.getEvent()!=null){Core.Events.stopEvent()}};unames[i].onmouseover=function(){if(i!=1){unames[1].style.backgroundColor=passcardOBJ.outbgcolor;unames[1].style.color=passcardOBJ.overfcolor}this.style.backgroundColor=passcardOBJ.overbgcolor;this.style.color=passcardOBJ.outfcolor};unames[i].onmouseout=function(){this.style.backgroundColor=passcardOBJ.outbgcolor;this.style.color=passcardOBJ.overfcolor;unames[1].style.backgroundColor=passcardOBJ.overbgcolor;unames[1].style.color=passcardOBJ.outfcolor}}};passcardOBJ.selectLi=function(nIndex){var menuNode;$E("sinaNote_MenuItem_Title_"+_rndID).style.backgroundColor=passcardOBJ.outbgcolor;$E("sinaNote_MenuItem_Title_"+_rndID).style.color=passcardOBJ.overfcolor;for(var i=0;i<_showMenuItems.length;i++){menuNode=$E(_showMenuItems[i]);menuNode.style.backgroundColor=passcardOBJ.outbgcolor;menuNode.style.color=passcardOBJ.overfcolor}$E(_showMenuItems[nIndex]).style.backgroundColor=passcardOBJ.overbgcolor;$E(_showMenuItems[nIndex]).style.color=passcardOBJ.outfcolor;_selectMenuText=$E(_showMenuItems[nIndex]).innerHTML};passcardOBJ.hideList=function(){if(!$E("sinaNote")){passcardOBJ.createNode()}$E("sinaNote").style.display="none"};passcardOBJ.init=function(oNode,oColors,oFocusNode,oWindowTarget){oWindowTarget=oWindowTarget||window;if(oWindowTarget.document.body==null){setTimeout(Core.Function.bind3(function(){this.init(oNode,oColors,oFocusNode,oWindowTarget)},this),100)}for(var key in oColors){this[key]=oColors[key]}Core.Events.addEvent(document,passcardOBJ.hideList,"click");Core.Events.addEvent(oNode,passcardOBJ.hideList,"blur");Core.Events.addEvent(oNode,Core.Function.bind3(passcardOBJ.showList,this,[oNode]),"keyup");Core.Events.addEvent(oNode,function(e){var keyCodeNum=Core.Events.getEvent().keyCode;var isSinaMail;if(keyCodeNum==13||keyCodeNum==9){if(_selectMenuText!=""){var temp=_selectMenuText;if(temp.indexOf("非新浪邮箱")>-1){var pos=temp.split("@");oNode.value=pos[0]+"@";isSinaMail=false}else{oNode.value=_selectMenuText;isSinaMail=true}}if(isSinaMail){if(oFocusNode!=null){setTimeout(function(){oFocusNode.focus()},0)}}else{if(oNode){oNode.focus()}}}},"keydown");if(oWindowTarget){_viewWindow=oWindowTarget}};Lib.passcardOBJ=passcardOBJ})();Lib.Login.Ui=Core.Class.create();var msnRefreshTimer=0;function msnrefreshWindow(){var setCookie=Utils.Cookie.setCookie;var getCookie=Utils.Cookie.getCookie;clearTimeout(msnRefreshTimer);var reg_token=getCookie("reg_token");if(reg_token){trace("token find out...");setCookie("reg_token","","","/",".blog.sina.com.cn")}else{trace("no token...");msnRefreshTimer=setTimeout(msnrefreshWindow,1e3);return}var cookieArr;var cid;var code;var c_cid=getCookie("c_uid");var CBcookie=getCookie("msnLinkCB");var altReg=getCookie("AlT");setCookie("msnLoginComeFrom",window.location.href,1,"/",".blog.sina.com.cn");if(CBcookie){cookieArr=CBcookie.split("_");cid=cookieArr[0];code=cookieArr[1]}if(c_cid!=cid)return;switch(code){case"noCid":break;case"loginError":break;case"unlink":deleteCookie("msnLinkCB");funcNoAccount(reg_token);break;case"done":deleteCookie("msnLinkCB");setCookie("loginFromMsn","msn",24,"/",".blog.sina.com.cn");funcSuccess(altReg,reg_token);break;case"pass":break}function funcSuccess(arg,reg_tk){trace("has Account");if(arg){trace("alt:"+arg);var iframe=$C("iframe");iframe.setAttribute("height",0);iframe.setAttribute("width",0);document.body.appendChild(iframe);iframe.src="https://login.sina.com.cn/sso/login.php?entry=blogmsn&service=blogmsn&alt="+encodeURIComponent(arg)+"&savestate=7&returntype=TEXT";(function(){var me=arguments.callee;if(!me.count)me.count=0;if(me.count++>10){trace("放弃获取SUP");iframe.parentNode.removeChild(iframe);return}trace("尝试获取SUP, count:"+me.count);if(getCookie("SUP")){trace("获取到 SUP"+getCookie("SUP"));window.location.reload();return}setTimeout(me,1e3)})()}else{window.location.reload()}}function funcNoAccount(){trace("noAccount");window.location.href="http://blog.sina.com.cn/blog_rebuild/msn/interface/connect_user_confirm.php"}function deleteCookie(name){var Then=new Date;Then.setTime(Then.getTime()-1);document.cookie=name+"=_pass;path=/;domain=.blog.sina.com.cn;expires="+Then.toGMTString()}function jsonDecode(str){if(!str||str==""){return null}try{return window.eval("("+str+")")}catch(e){return null}}}Lib.Login.Ui.prototype={dialog:null,isInit:false,request:null,callback:null,initialize:function(){},login:function(callback,clearDomain,from){this.callback=callback||null;this.clearDomain=clearDomain||false;this.from=from||null;this.initDom();this.initEvent();this.dialog.show();this.dialog.setAreaLocked(true);this.reloadName();this.onShow();this.focus();if(scope.$pageid==="blogMove"){$E("login_move_tip").style.display=""}if($IE6){this.initAD()}Lib.passcardOBJ.init($E("login_name_d"),{overfcolor:"#999",overbgcolor:"#e8f4fc",outfcolor:"#000000",outbgcolor:""},$E("login_pass_d"))},reloadName:function(){var userInfo=Lib.Login.info();var defaultName=userInfo.ln;if(defaultName){$E("login_name_d").value=defaultName}var alf=Utils.Cookie.getCookie("ALF");if(alf!=""&&$E("login_save")){$E("login_save").checked=true;$E("login_save_tips").style.display="none"}alf=Utils.Cookie.getCookie("LiRe");if(alf!=""&&$E("login_save")){$E("login_save").checked=true;$E("login_save_tips").style.display="none"}},initDom:function(){var me=this;this.dialog=winDialog.createCustomsDialog({tpl:me.tpl});this.dialog.addEventListener("hidden",function(){this.destroy()});this.dialog.setContent(this.struc);this.dialog.setTitle("登录新浪博客");this.dialog.setMiddle()},initEvent:function(){var callback=this.parse.bind2(this);this.request=new Lib.Login.LoginPost(callback,this.clearDomain,this.from);Core.Events.addEvent("login_button",this.doLogin.bind2(this));Core.Events.addEvent("login_name_d",function(e){var code=e.keyCode;if(code==13){this.doLogin()}}.bind2(this),"keydown");Core.Events.addEvent("login_pass_d",function(e){var code=e.keyCode;if(code==13){this.doLogin()}}.bind2(this),"keydown");var cancelStatus=1;Core.Events.addEvent("login_save",function(){if($E("login_save").checked){$E("login_save_tips").style.display=""}else{$E("login_save_tips").style.display="none"}if(cancelStatus){var url="http://control.blog.sina.com.cn/blog_rebuild/riaapi/padblog/padInfo.php?ck_login=A00001&rnd="+Math.random();Utils.Io.JsLoad.request(url,{onComplete:function(){},onException:function(){}});cancelStatus=null}})},doLogin:function(){Core.Events.stopEvent();var username=$E("login_name_d").value;var password=$E("login_pass_d").value;username=Core.String.trim(username);password=password;if(username==""){this.error("请输入登录名");return false}if(password==""){this.error("请输入密码");return false}if(typeof sinaSSOController!="undefined"&&typeof sinaSSOController.loginExtraQuery!="undefined"){if(typeof sinaSSOController.loginExtraQuery.door!="undefined"){var vcode=$E("login_vcode").value;sinaSSOController.loginExtraQuery.door=vcode||1}}if($E("login_save").checked){v7sendLog("48_01_38_1");this.request.login(username,password,60)}else{v7sendLog("48_01_38_0");this.request.login(username,password)}return false},parse:function(loginStatus){if(loginStatus.result){Lib.checkAuthor();if($E("login_save").checked){Utils.Cookie.setCookie("LiRe",true,2400,"/",".blog.sina.com.cn")}else{Utils.Cookie.setCookie("LiRe","",2400,"/",".blog.sina.com.cn")}var date=new Date,y=date.getFullYear(),m=date.getMonth(),d=date.getDate();var time=new Date(y,m,d,24).getTime();Utils.Cookie.setCookie("onceloggedonblog",time,720,"/",".blog.sina.com.cn");var me=this;function cbreload(){if(this.callback){try{$tray.renderLogin()}catch(e){}this.callback.call()}else{window.location=window.location.toString().replace(/#.*/,"")}}var cbed=false;Utils.Io.JsLoad.request("http://login.sina.com.cn/bindmail/checkmailuser.php?entry=blog&name="+encodeURIComponent($E("login_name_d").value)+"&utf82gbk=1&callback=scope.$bindEmailAlert",{noreturn:true,timeout:5e3,onException:function(){if(!cbed){cbreload.call(me)}}});scope.$bindEmailAlert=function(data){cbed=true;if(data.ret!="y"&&data.errcode!="not_verify"||Utils.Cookie.getCookie("sbr_noTBE")==1){cbreload.call(me)}else{var dialog=winDialog.createCustomsDialog({content:['<div id="#{entityID} style="width:358px;height:144px" class="CP_layercon2 unilayer">','<div id="#{contentID}" class="CP_prompt">','<img height="50" align="absmiddle" width="50" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon201">','<table class="CP_w_ttl"><tbody><tr><td>经检测您的帐号存在一定的安全隐患！<br>建议绑定邮箱</td></tr></tbody></table>','<p class="CP_w_btns_Mid"><a href="javascript:;" class="SG_aBtn SG_aBtnB" id="#{bindit}" target="_blank"><cite> 绑定 </cite></a>&nbsp;&nbsp;<a href="javascript:;" class="SG_aBtn SG_aBtnB" id="#{nobind}"><cite> 暂不绑定 </cite></a></p>',"</div>",'<div class="unilayerB SG_j_linedot1">','<p class="SG_txtb"><input type="checkbox" id="#{noalertbind}"><label for="#{noalertbind}">一周内不提醒</label></p>',"</div>","</div>"].join(""),shadow:1},"bindEmail");dialog.setMiddle();dialog.show();dialog.nodes["btnClose"].onclick=function(){cbreload.call(me);dialog.hidden()};dialog.nodes["nobind"].onclick=function(){setTimeout(function(){cbreload.call(me);dialog.hidden()},100)};dialog.nodes["bindit"].href="http://login.sina.com.cn/bindmail/bindmail.php?entry=blog";dialog.nodes["bindit"].onclick=function(){cbreload.call(me)};dialog.nodes["noalertbind"].onclick=function(){if(this.checked){Utils.Cookie.setCookie("sbr_noTBE","1",24*7,"/",".blog.sina.com.cn")}else{Utils.Cookie.setCookie("sbr_noTBE","",0,"/",".blog.sina.com.cn")}}}};this.dialog.hidden()}else{if(loginStatus.errno==="4049"){sinaSSOController.loginExtraQuery={door:0};$E("login_ckimg").style.display="";$E("login_vcode").value="";$E("checkImg").src="http://login.sina.com.cn/cgi/pin.php?r="+Core.Math.getUniqueId()+"&s=0";Core.Events.addEvent($E("reloadCode"),function(){$E("checkImg").src="http://login.sina.com.cn/cgi/pin.php?r="+Core.Math.getUniqueId()+"&s=0";$E("login_vcode").value="";$E("login_div_error").innerHTML=""});this.error("");return}if(loginStatus.errno==="2070"){Core.Events.fireEvent($E("reloadCode"),"click");this.error(loginStatus.reason);return}if(loginStatus.errno=="4047"){this.error(loginStatus.reason);return}else if(loginStatus.errno=="4057"){this.error(loginStatus.reason);return}else if(loginStatus.errno=="4040"){this.error(loginStatus.reason);return}this.error("登录名或密码错误");$E("checkImg").src="http://login.sina.com.cn/cgi/pin.php?r="+Core.Math.getUniqueId()+"&s=0";$E("login_vcode").value=""}},friendlyTip:function(reason){var ret=reason;var node=$E("login_name_d");var name=node.value;var me=this;if(!/[\u0391-\uFFE5]+/.test(name)&&!/^\d+$/.test(name)&&!/^@/.test(name)){var str="你的登录名可能是 ";var linkTpl='<a href="#" class="underline" onclick="$_RENAME(/@.*/, \'{1}\');return false">{0}{1}</a>';var linkArr=["@sina.com","@sina.cn"];var finalLink="";if(/@sina\.cn$/.test(name)){finalLink=linkTpl.format("{0}",linkArr[0])}else if(/@sina\.com$/.test(name)){finalLink=linkTpl.format("{0}",linkArr[1])}else{finalLink=linkTpl.format("{0}",linkArr[0])+" 或 "+linkTpl.format("{0}",linkArr[1])}ret=(str+finalLink).format(name.replace(/@.*/,""))}return ret},rename:function(){window.$_RENAME=function(reg,suf){var node=$E("login_name_d");node.value=node.value.replace(reg,"")+suf;$E("login_pass_d").focus();$E("login_div_error").innerHTML=""};return window.$_RENAME}(),focus:function(){var nameEl=$E("login_name_d");if(nameEl.value==""){nameEl.focus()}else{$E("login_pass_d").focus()}},initAD:function(){$E("login_ad").src="http://blog.sina.com.cn/lm/iframe/71/2008/0731/21.html"},onShow:function(){},error:function(msg){$E("login_div_error").innerHTML=msg;$E("login_pass_d").value="";this.focus()},tpl:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}">提示标题</strong>','<cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">',"</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),struc:'		<div class="CP_layercon2 passLoginItem">			<div>				<div id="login_move_tip" style="display:none;margin-bottom:12px">可以使用新浪微博、邮箱、通行证的帐号进行登录</div>				<div class="boxA">登录名：					<input tabIndex="201" type="text" class="fm1" style="width:215px;" name="login_name" id="login_name_d" tabIndex=1/>  <a style="font-size: 12px;" href="http://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid='+scope.$uid+'&src=blogicp" target="_blank">立即注册</a>				</div>				<div class="boxA">密　码：					<input tabIndex="202" type="password" class="fm1" style="width:215px;" name="login_pass" maxlength="16" id="login_pass_d" tabIndex=2/>  <a style="font-size: 12px;" href="http://login.sina.com.cn/getpass.html" target="_blank">找回密码</a>				</div>				<div id="login_ckimg" class="boxA" style="display:none"> <p class="p_img">验证码：                  	<input type="text" id="login_vcode" name="login_vcode" class="fm1" size="10" maxlength="5" />                  	<img width="100" align="absmiddle" id="checkImg" src="http://login.sina.com.cn/cgi/pin.php?r='+Core.Math.getUniqueId()+'&s=0" /> <a href="javascript:;" onclick="return false;" style="font-size: 12px;"><span id="reloadCode">换一换</span></a></p> 			    </div>				<div class="ErrTips" id="login_div_error"></div>				<div class="boxB"><p><input tabIndex="203" type="checkbox" value="" id="login_save" checked="checked" /><label for="login_save"> 记住登录状态</label></p><p id="login_save_tips" style="color:#999;display:none;">建议在网吧/公用电脑上取消该选项</p><p style="margin-top: 8px;"><a id="login_button" class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;" tabIndex=204><cite>登录<input type="text"/></cite></a> </p></div>			</div>			<div class="connect_msn" id="connect_msn" style="position:relative;">				<span>使用 MSN 帐号登录博客</span>				<a href="#" onclick="Lib.checkAuthor();v7sendLog(\'48_01_36\'); window.open(\'https://login.live.com/oauth20_authorize.srf?client_id=0000000040046F08&redirect_uri=http%3A%2F%2Fcontrol.blog.sina.com.cn%2Fblog_rebuild%2Fmsn%2FmsnLoginCallBack.php&response_type=code&scope=wl.basic%20wl.signin%20wl.offline_access%20wl.share%20wl.emails\',\'neww\',\'left='+(screen.width-440)/2+",top="+(screen.height-400)/2+',height=400,width=440\');msnrefreshWindow();" style="background:transparent url(http://simg.sinajs.cn/blog7style/images/msn_login01.gif) no-repeat left top; width:70px; height:22px; line-height:22px; display:inline-block; text-align:left; text-indent:2em; text-decoration:none; color:white; font-weight:bold; font-size:14px;">登录</a>			</div>			<a href="http://blog.sina.com.cn/s/blog_4b0f52990100miil.html" target="_blank"style="left:308px;position:relative;top:-24px;">如何登录？</a>			<div class="CP_lg_ad SG_j_linedot1">				<iframe id="login_ad" src="http://blog.sina.com.cn/lm/iframe/71/2008/0731/21.html" frameborder="0" scrolling="no" height="25" width="auto"></iframe>			</div>		</div>'};Core.Events.stopBubble=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.cancelBubble=true}};if(!$IE||$IE>8){Core.Events.stopBubble=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.stopPropagation()}}}Lib.PlatformTrayPlus=Core.Class.create();Lib.PlatformTrayPlus.prototype={tray:null,subPanels:[],trayLogin:null,initialize:function(){},load:function(loginState){var bar_logo=$E("login_bar_logo_link_350");if(bar_logo&&$_GLOBAL&&$_GLOBAL.platformTrayLogo){if(!$IE6&&$_GLOBAL.platformTrayLogo.imgForOtherBrs){bar_logo.children[0].src=$_GLOBAL.platformTrayLogo.imgForOtherBrs}else if($_GLOBAL.platformTrayLogo.imgForIE6){bar_logo.children[0].src=$_GLOBAL.platformTrayLogo.imgForIE6}}switch(loginState){case"login":if($E("loginBarOptApp")==null||!$isAdmin){this.render(scope.trayPlusTemplayLogin);trace("++++js渲染 登陆后++++++")}this.initStatic();if(/ipad/i.test(navigator.userAgent)){v7sendLog("48_01_02")}this.setNodesMouseHoverStyle(["loginBarOptApp","loginBarMail","loginBarCenter","loginBarFriend","loginBarInbox"]);this.initNicknamePanel();this.initNewInboxPanel();this.initActivityPanel();var that=this;Utils.Io.JsLoad.request("http://service.mail.sina.com.cn/mailproxy/mail.php",{onComplete:function(){var email=sinamailinfo.email;if(email!=""){that.initMailRemind()}},onException:function(){}});this.initMsnLogout();if(scope&&scope.$private&&scope.$private.msnfeed){var _this=this;setTimeout(function(){_this.displayUserGuideTips()},1e3)}break;case"logout":this.trayLogin=new Lib.Login.Ui;if($E("phprender")===null){this.render(scope.trayPlusTemplayLogout);trace("-----------js渲染---------")}else{trace("-----------php渲染---------")}this.initLogin();this.initPopularize();break;case"oncelogedon":this.trayLogin=new Lib.Login.Ui;this.render(scope.trayPlusTemplayOnceLoged);this.setNodesMouseHoverStyle(["loginBarOptApp","loginBarMail","loginBarCenter","loginBarFriend","loginBarInbox"]);var info=Lib.Login.info();var uid=info&&info.uid;$E("loginBarAppMenuLabel").innerHTML=info&&info.nick;this.initPopularize();this.initOnceLogedEvent(["loginBarOptApp","loginBarMail","loginBarCenter","loginBarFriend","loginBarInbox"],uid);this.initOnceLogedTips(uid);this.initStatic();break}this.initAddArticlePanel();this.initSearchPanel();this.initFilmSearch()},displayUserGuideTips:function(){if(!window.scope||scope.$pageid==="profile_index"){Utils.Cookie.setCookie($UID+"alreadyVisitProfileIndex","true","86400","/",".sina.com.cn");return}var _this=this;function updateTipPos(){var loginBarCenter=$E("loginBarCenter");if(loginBarCenter){var pos=Core.Dom.getXY(loginBarCenter),left=pos[0]+loginBarCenter.offsetWidth/2-_this.tipsUserGuide.offsetWidth/2+"px",top=pos[1]+loginBarCenter.offsetHeight+10+"px"}_this.tipsUserGuide.style.left=left;_this.tipsUserGuide.style.top=top}},initStatic:function(){if(!this._commetTimer){var send=function(){var uid=scope.$uid;var blogid=scope.$articleid||"";var url="http://comet.blog.sina.com.cn/api?maintype=notice";Utils.Io.JsLoad.request(url,{GET:{uid:uid||"",blogid:blogid},onComplete:function(r){}})};this._commetTimer=setInterval(send,30*1e3);setTimeout(function(){send()},15)}},initFilmSearch:function(){var ele=$E("loginBarSearchInput");ele&&(ele.value="");var tag=$E("loginBarSearchSType");tag&&(tag.value="title")},render:function(html){$E("trayContainer").innerHTML=html},initLogin:function(){var me=this;var homeNode=Core.Dom.getElementsByClass($E("trayContainer"),"span","link")[0];homeNode.onclick=function(){v7sendLog("40_01_15")};Core.Events.addEvent($E("linkTrayLogin"),function(){v7sendLog("40_01_16");if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};me.trayLogin.login(function(){Lib.checkAuthor();var str=$UID==scope.$uid?"02":"01";v7sendLog("87_01_"+str+"_"+$UID,scope.$pageid);setTimeout(function(){window.location=window.location.toString().replace(/#.*/,"")},100)},false,"referer:"+location.hostname+location.pathname+",func:0007")},"click");$E("linkReg").href="http://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid="+scope.$uid+"&src=blogicp";$E("linkReg").onclick=function(){v7sendLog("40_01_17")};if(scope.$channel){if(scope.$channel==2){$E("linkReg").href="http://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid="+scope.$uid+"&src=baby"}}},initPopularize:function(){var popEl=$E("divPopularize");if(popEl){this.hideActiLink(popEl);this._loadPopularizeData(popEl)}},_loadPopularizeData:function(parentEl){Utils.Io.JsLoad.request("http://blog.sina.com.cn/lm/iframe/283/2012/0705/1.js",{charset:"utf-8",onComplete:function(data){var cfg=$_GLOBAL.popularizeConfig;if(!cfg||parentEl.innerHTML){return}var len=cfg.length;var cookieUtil=Utils.Cookie;var index=parseInt(cookieUtil.getCookie("blogPopularizeIndex")||0);if(len<=index){index=0}cookieUtil.setCookie("blogPopularizeIndex",1+index,24,"/",".blog.sina.com.cn");parentEl.innerHTML=cfg[index];if($E("err_i8t9c")){var txt=parentEl.innerText||parentEl.textContent||"";if(txt.length>10){parentEl.children[0].innerHTML=txt.substr(0,9)+"..."}}}})},setNodesMouseHoverStyle:function(nodeNames){var i,len=nodeNames.length;for(i=0;i<len;i++){Core.Events.addEvent($E(nodeNames[i]),function(idx){return function(){Core.Dom.removeClassName($E(nodeNames[idx]),"current");$E(nodeNames[idx]).className+=" current"}}(i),"mouseover");Core.Events.addEvent($E(nodeNames[i]),function(idx){return function(){Core.Dom.removeClassName($E(nodeNames[idx]),"current")}}(i),"mouseout")}$E("loginBarCenter").onclick=function(){v7sendLog("40_01_05_"+$UID)};$E("loginBarFriend").onclick=function(){v7sendLog("40_01_06_"+$UID)};$E("logOut").onclick=function(){v7sendLog("40_01_11_"+$UID)}},initNicknamePanel:function(){var nicknamePanel=new scope.NicknamePanel;Lib.checkAuthor();nicknamePanel.initUserInfo($UID);this.addSubPanel(nicknamePanel,$E("loginBarOptApp"),-98,-9);var me=this;if(Utils.Cookie.getCookie("loginFromMsn")&&!$E("msnLoginIcon")){var holder=$C("img");holder.src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif";holder.style.cssFloat=holder.style.styleFloat="left";holder.width="18";holder.height="0";holder.style.padding="9px 0";holder.align="absmiddle";Core.Dom.insertAfter(holder,$E("loginBarAppMenuLabel"));trace("创建msn icon");createLinkMask(holder)}else{trace("不渲染msn icon")}function createLinkMask(holder){var mask=$C("a");var span=holder.parentNode;var container=span.parentNode;var node=$C("img");container.style.position="relative";span.style.position="relative";node.id="msnLoginIcon";node.className="SG_icon SG_icon136";node.src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif";node.style.width="18px";node.style.height="18px";node.align="absmiddle";mask.appendChild(node);mask.href="http://control.blog.sina.com.cn/blogprofile/msnbind.php?c="+ +new Date;mask.target="_blank";mask.style.cssText="display:block; width:18px; height:18px; position:absolute; z-index:1024;";mask.style.paddingTop="4px";mask.title="MSN账号登录";container.insertBefore(mask,container.childNodes[0]);Core.Events.addEvent(window,relocation,"resize");trace("创建msn icon mask");relocation();function relocation(){var timer=setInterval(function(){var adminName=$E("loginBarAppMenuLabel").innerHTML;if(adminName!=="读取中..."){var strLeft=holder.offsetLeft+"px";mask.style.left=strLeft;trace("刷新msn icon mask");clearInterval(timer)}},300)}scope.$msnRelocation=relocation}},initAddArticlePanel:function(){var addArticlePanel=new scope.addArticlePanel;this.addSubPanel(addArticlePanel,$E("arrowAddArticle"),-81,0);$E("arrowAddArticle").onclick=function(){v7sendLog("40_01_13_"+($UID?$UID:""))};$E("arrowAddArticle").parentNode.children[0].onclick=function(){v7sendLog("40_01_12_"+($UID?$UID:""))}},showPublishWare:function(data){if(data["tbh_status"]&&parseInt(data["tbh_status"],10)){$E("tray_tbh_ware_linedot").style.display="";var publishBtn=$E("tray_tbh_ware_link");publishBtn.style.display="";try{var link=$T(publishBtn,"a")[0];if(scope&&"editor"==scope.$pageid){link.href="javascript:;";link.target="";link.onclick=function(){var plugin=$E("shortcut_content");var imgs=$T(plugin,"img");for(var i=0;i<imgs.length;i++){if(-1!=imgs[i].src.indexOf("element_shop")){Core.Events.click(imgs[i])}}}}link=null;publishBtn=null}catch(e){}}Lib.Listener.off({name:"tray-data-loaded",callBack:this.showPublishWare,scope:this})},initSearchPanel:function(){var searchPanel=new scope.SearchPanel;this.addSubPanel(searchPanel,$E("searchSelect"),-54,-4);Utils.Form.limitMaxLen($E("loginBarSearchInput"),50);var spNodes=searchPanel.getNodes();var cfg;for(cfg in searchPanel.config){(function(c){Core.Events.addEvent(spNodes[c],function(){_setActiveOption(c)},"click")})(cfg)}_setActiveOption("blog");$E("searchSelect").onclick=function(){v7sendLog("40_01_18")};var searchNode=Core.Dom.getElementsByClass($E("loginBarSearchForm"),"input","topbar_searchBtn")[0];searchNode.onclick=function(){v7sendLog("40_01_20")};Core.Events.addEvent($E("loginBarSearchInput"),function(e){var c=e.keyCode||e.charCode;if(c==15){v7sendLog("40_01_20")}},"keyup");function _setActiveOption(opt){var formEl=$E("loginBarSearchForm");formEl.action=searchPanel.config[opt]["url"];$E("loginBarSearchMenuLabel").innerHTML=spNodes[opt].getElementsByTagName("a")[0].innerHTML;var searchCEl=$E("loginBarSearchC"),searchTEl=$E("loginBarSearchT"),searchTypeEl=$E("loginBarSearchType"),searchSEl=$E("loginBarSearchS"),searchTSEl=$E("loginBarSearchTS"),searchTextEl=$E("loginBarSearchInput");switch(opt){case"all":case"blog":case"bauthor":if(!searchCEl){searchCEl=$C("input");searchCEl.type="hidden";searchCEl.name="c";searchCEl.id="loginBarSearchC";formEl.appendChild(searchCEl)}searchCEl.value="blog";searchTEl.value=searchPanel.config[opt]["range"];searchTEl.name="range";searchTypeEl.value=searchPanel.config[opt]["by"];searchTypeEl.name="by";searchTextEl.name=searchPanel.config[opt]["keyName"];break;case"song":case"video":case"vauthor":searchCEl&&(searchCEl.value="");searchTEl.value=searchPanel.config[opt]["t"];searchTEl.name="t";searchSEl.value=searchPanel.config[opt]["s"];searchTSEl.value=searchPanel.config[opt]["ts"];searchTypeEl.value=searchPanel.config[opt]["type"];searchTypeEl.name="type";$E("loginBarSearchSType").value=searchPanel.config[opt]["stype"];searchTextEl.name=searchPanel.config[opt]["keyName"];break}}},hideActiLink:function(el){var pageId=scope.$pageid;if("pageSetM"!==pageId&&"editor"!==pageId){el.style.display="none";el.setAttribute("shouldShow","1")}setTimeout(function(){if(typeof BLOG_AD_TIPS=="undefined"||!BLOG_AD_TIPS){el.style.display="";return}},3e3)},initActivityPanel:function(){if($_GLOBAL){var loginActLink=$E("loginBarActivity");if(loginActLink){this.hideActiLink(loginActLink);this._loadPopularizeData(loginActLink)}}if($_GLOBAL.activityBlackList&&$_GLOBAL.activityBlackList[scope.$pageid]){trace("【活动】当前页面在黑名单");return}},initMsnLogout:function(){var _tray=$E("openedBlogTray");var _a_list=_tray.getElementsByTagName("a");var _logout_a=_a_list[_a_list.length-1];_logout_a.href="#";_logout_a.onclick=function(){return false};var _tray_noIn=$E("noOpenedBlogTray");var _a_list_noIn=_tray_noIn.getElementsByTagName("a");var _logout_a_noIn=_a_list_noIn[_a_list_noIn.length-1];_logout_a_noIn.href="#";_logout_a_noIn.onclick=function(){return false};var _curHref=encodeURIComponent(window.location.href);if(_tray)Core.Events.addEvent(_logout_a,logoutMsnAndBlog);if(_tray_noIn)Core.Events.addEvent(_logout_a_noIn,logoutMsnAndBlog);function logoutMsnAndBlog(){new Interface("http://control.blog.sina.com.cn/blog_rebuild/msn/api/msnLoginOut.php","jsload").request({onSuccess:function(res){window.location.href="http://login.sina.com.cn/cgi/login/logout.php?r="+_curHref},onError:function(res){window.location.href="http://login.sina.com.cn/cgi/login/logout.php?r="+_curHref},onFail:function(res){window.location.href="http://login.sina.com.cn/cgi/login/logout.php?r="+_curHref}})}},addSubPanel:function(panel,dom,offsetLeft,offsetTop){var _this=this;this.subPanels.push(panel);function _showPanel(){Core.Events.stopEvent();var i,len=_this.subPanels.length;for(i=0;i<len;i++){_this.subPanels[i].hidden()}panel.showWithDom(dom,offsetLeft,offsetTop)}Core.Events.addEvent(dom,function(){if(dom===$E("loginBarOptApp")){v7sendLog("40_01_01_"+$UID)}_showPanel()},"click");Core.Events.addEvent(document.body,function(){panel.hidden()},"click");Core.Events.addEvent(panel.entity,function(){Core.Events.stopEvent()},"mousedown");Core.Events.addEvent(window,function(){var x=Core.Dom.getLeft(dom)+dom.offsetWidth+offsetLeft;var y=Core.Dom.getTop(dom)+dom.offsetHeight+offsetTop;if($IE6&&this.isFixed){x=x-document.documentElement.scrollLeft;y=y-document.documentElement.scrollTop}panel.setPosition(x,y)},"resize")},initNewInboxPanel:function(){var newInboxPanel=new scope.NewInboxPanel;

this.addSubPanel(newInboxPanel,$E("loginBarInbox"),-137,-9);try{if(!$E("ccnotepiaohong")){var di=$C("div");di.className="imforbox";di.style.display="none";di.id="ccnotepiaohong";$E("loginBarInbox").appendChild(di)}$E("loginBarInbox").className="link imfor"}catch(e){}newInboxPanel.onMessageLoad=function(nickname){$E("loginBarAppMenuLabel").innerHTML=nickname;$E("noOpenBlogName").innerHTML=Core.System.htmlFilter(nickname)}},initMailRemind:function(){if($E("loginBarMail")&&$E("line")){$E("loginBarMail").style.display="";$E("line").style.display=""}function remindEmail(){var mailInter=new Interface("http://interface.blog.sina.com.cn/riaapi/profile/unreadmail.php","jsload");mailInter.request({onSuccess:function(data){var tota=parseInt(data,10);if(tota>99){tota="99+"}if(tota!==0&&$E("mailpiaohong")){var num=$E("mailpiaohong");num.style.display="";num.innerHTML=tota}else{$E("mailpiaohong").style.display="none"}},onError:function(){$E("mailpiaohong").style.display="none"}})}remindEmail();var remind=setInterval(remindEmail,5*60*1e3);Core.Events.addEvent($E("loginBarMail"),function(){v7sendLog("40_01_07_"+$UID);var redEl=$E("mailpiaohong");var isRed=!redEl.style.display;if(isRed){redEl.style.display="none"}},"click");Core.Events.addEvent($E("mailpiaohong"),function(){var redEl=$E("mailpiaohong");redEl.style.display="none";window.open("http://mail.sina.com.cn/?s=2")},"click")},initOnceLogedEvent:function(nodeNames,uid){var i,len=nodeNames.length;var me=this;for(i=0;i<len;i++){$E(nodeNames[i]).onclick=function(){switch(this.id){case"loginBarOptApp":v7sendLog("44_01_07_"+uid);break;case"loginBarMail":v7sendLog("44_01_08_"+uid);break;case"loginBarCenter":v7sendLog("44_01_09_"+uid);break;case"loginBarFriend":v7sendLog("44_01_10_"+uid);break;case"loginBarInbox":v7sendLog("44_01_11_"+uid);break}if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};me.trayLogin.login(function(){setTimeout(function(){window.location=window.location.toString().replace(/#.*/,"")},100)},false);return false}}},initOnceLogedTips:function(uid){var me=this;var messageUrl="http://interface.blog.sina.com.cn/riaapi/profile/unread.php";Utils.Io.JsLoad.request(messageUrl,{GET:{uid:uid,product:"blog"},onComplete:function(res){if(scope.$pageid=="profile_index"||scope.$pageid=="pageSetM"||scope.$pageid=="editor"){return}var tip=$E("newStatusTip");if(!tip){tip=$C("div");tip.id="newStatusTip";tip.className="tb_layer_Y tb_layer_w3";tip.style.width="138px";tip.innerHTML=scope.onceLogedStatusTipTemplay;var a=$T($E("loginBarCenter"),"a")[0];var loc=Core.Dom.getXY(a);tip.style.left=loc[0]-(138/2-a.offsetWidth/2)+"px";tip.style.top=loc[1]+a.offsetHeight+"px";tip.style.zIndex="510";tip.style.display="none";document.body.appendChild(tip)}if(res.data.unreadnotes>=1){v7sendLog("44_01_12_"+uid);tip.style.display="block";$E("nstUnread").style.display="block";$E("nstUnread").onclick=function(){v7sendLog("44_01_13_"+uid);if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};me.trayLogin.login(function(){setTimeout(function(){window.location="http://i.blog.sina.com.cn/blogprofile/profilelatestnote.php"},100)},false);return false}}else if(res.data.nfn>=1){v7sendLog("44_01_14_"+uid);tip.style.display="block";$E("nstFeed").style.display="block";$E("nstFeed").onclick=function(){v7sendLog("44_01_15_"+uid);if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};me.trayLogin.login(function(){setTimeout(function(){window.location="http://i.blog.sina.com.cn/blogprofile/index.php?type=3&from=newstatus&com=2"},100)},false);return false}}Core.Events.addEvent(window,function(){var a=$T($E("loginBarCenter"),"a")[0];var loc=Core.Dom.getXY(a);tip.style.left=loc[0]-(138/2-a.offsetWidth/2)+"px";tip.style.top=loc[1]+a.offsetHeight+"px"},"resize")},onException:function(data){}})}};$registJob("tray",function(){Lib.Listener.add("tray-data-loaded");Lib.checkAuthor();var tray;var $logo=$E("login_bar_logo_link_350");var isNewTray="ntopbar_main"===$logo.parentNode.className;if(isNewTray){tray=Lib.TrayPanel()}else{tray=new Lib.PlatformTrayPlus}var userInfo=Lib.Login.info();var uid=userInfo.uid;window.$onceLog=false;var onceloggedonblog=unescape(Utils.Cookie.getCookie("onceloggedonblog"));if(onceloggedonblog&&uid){time=onceloggedonblog;var now=(new Date).getTime();if(time&&now>time){$onceLog=true}}if($isLogin){tray.load("login")}else if(!isNewTray&&$onceLog){tray.load("oncelogedon")}else{tray.load("logout")}window.$tray={};window.$tray.renderLogin=function(){Lib.checkAuthor();if($isLogin){tray.load("login")}};window.$tray.renderLogout=function(){tray.load("logout")}});if(typeof App=="undefined"){var App={}}Utils.tpl=function(tpl,data){return tpl.replace(/{(\w+)}/g,function(all,match){return data[match]})};var BackShadow=function(opacity){this.entity=null;this.isShow=false;this._ie6Fixed=function(){if(_this.entity){_this.entity.style.top=document.documentElement.scrollTop+"px";_this.entity.style.left=document.documentElement.scrollLeft+"px";if(_this.ifm){_this.ifm.style.top=_this.entity.style.top;_this.ifm.style.left=_this.entity.style.left}_this.updateSize()}};var _this=this;(function initialize(){_this.entity=$C("div");_this.entity.style.position="absolute";_this.entity.style.width=_this.getAreaWidth()+"px";_this.entity.style.height=_this.getAreaHeight()+"px";_this.entity.style.left="0px";_this.entity.style.top="0px";_this.entity.style.zIndex=1024;_this.entity.style.backgroundColor="black";document.body.appendChild(_this.entity);_this._setOpacity(_this.entity,isNaN(opacity)?.5:opacity);if($IE6){_this.entity.style.top=document.documentElement.scrollTop+"px";_this.addIframe()}Core.Events.addEvent(window,function(){if(_this.entity){if($IE6&&_this.isShow){document.documentElement.scrollLeft=0;_this._ie6Fixed()}setTimeout(function(){_this.updateSize()},1)}},"resize");_this.setFixed(true);_this.hidden()})()};BackShadow.prototype={show:function(){this.entity.style.display="";if(this.ifm){this.ifm.style.display=""}this.isShow=true;this.onShow()},hidden:function(){this.entity.style.display="none";if(this.ifm){this.ifm.style.display="none"}this.isShow=false;this.onHidden()},close:function(){this.hidden();this.destroy()},destroy:function(){Core.Events.removeEvent(window,this._ie6Fixed,"scroll");this.entity.parentNode.removeChild(this.entity);this.entity=null;if(this.ifm){this.ifm.parentNode.removeChild(this.ifm);this.ifm=null}},addIframe:function(){this.ifm=$C("iframe");this._setOpacity(this.ifm,0);this.ifm.style.position="absolute";this.ifm.style.zIndex=this.entity.style.zIndex;this.ifm.style.left=this.entity.style.left;this.ifm.style.top=this.entity.style.top;this.ifm.style.width=this.entity.style.width;this.ifm.style.height=this.entity.style.height;document.body.insertBefore(this.ifm,this.entity)},insertBefore:function(obj){document.body.insertBefore(this.entity,obj);if(this.ifm){document.body.insertBefore(this.ifm,this.entity)}},updateSize:function(){this.entity.style.width=this.getAreaWidth()+"px";this.entity.style.height=this.getAreaHeight()+"px";if(this.ifm){this.ifm.style.width=this.getAreaWidth()+"px";this.ifm.style.height=this.getAreaHeight()+"px"}},getAreaHeight:function(){return document.documentElement.clientHeight},getAreaWidth:function(){return document.documentElement.clientWidth},setFixed:function(state){if($IE6){var _this=this;if(state){_this._ie6Fixed();Core.Events.addEvent(window,_this._ie6Fixed,"scroll")}else{Core.Events.removeEvent(window,_this._ie6Fixed,"scroll")}}else{this.entity.style.position=state?"fixed":"absolute"}},_setOpacity:function(obj,v){if($IE&&$IE<=9){obj.style.filter="alpha(opacity="+v*100+")"}else{obj.style.opacity=v}},onShow:function(){},onHidden:function(){}};Core.Events.stopDefaultEvent=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){if(ev.preventDefault){ev.preventDefault()}else{ev.returnValue=false}}};Lib.register("jfCheckIn",function(lib){var checkEL=$E("jf_check");var addEvent=Core.Events.addEvent;var stopDefaultEvent=Core.Events.stopDefaultEvent;var getEvent=Core.Events.getEvent;var getEventTarget=Core.Events.getEventTarget;var reqType=location.host=="control.blog.sina.com.cn"?"ajax":"ijax";var itf=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/points/register_get_points.php",reqType);var initHtml='<a href="javascript:void();" class="checkbtn">签到领积分</a><p>连续签到可领取更多积分<a href="javascript:void();">详情</a></p>';var checkedHtml='<a href="javascript:void();" class="checkbtn">已签到<span>＋{points}分</span></a><p>已连续签到<span>{days}</span>天，继续可获得更多积分 <a href="javascript:void();">详情</a></p>';var lock=0;var jfck={status:0,init:function(){if(!checkEL)return;var self=this;itf.request({POST:{act:"get"},onSuccess:function(data){var status=self.status=data.code/1;checkEL.innerHTML=status?Utils.tpl(checkedHtml,data):initHtml;addEvent(checkEL,function(){var ev=getEvent();var tarEl=getEventTarget(ev);stopDefaultEvent(ev);if(tarEl.tagName.toUpperCase()=="A"){if(/详情/.test(tarEl.innerHTML)){jfPannl.show()}else{if(!self.status&&!lock){lock=1;self.checkIn()}}}})},onError:function(){},onFail:function(){}})},checkIn:function(){var self=this;itf.request({POST:{},onSuccess:function(data){var status=self.status=data.code/1;checkEL.innerHTML=status?Utils.tpl(checkedHtml,data):initHtml},onError:function(result){winDialog.alert(result&&result.data||"操作失败");lock=0;if(result&&result.code=="A11109"){self.init()}},onFail:function(){winDialog.alert("请求异常");lock=0}})}};var jfPannl={tpl:'<table class="CP_w" id="#{panel}" style="z-index:9999">\r\n                <thead>\r\n                    <tr>\r\n                        <th class="tLeft"><span></span></th>\r\n                        <th class="tMid"><div class="bLyTop"><strong>签到积分规则：</strong><cite><a node-data="btnclose" href="#" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>\r\n                        <th class="tRight"><span></span></th>\r\n                    </tr>\r\n                </thead>\r\n                <tfoot>\r\n                    <tr>\r\n                        <td class="tLeft"><span></span></td>\r\n                        <td class="tMid"><span></span></td>\r\n                        <td class="tRight"><span></span></td>\r\n                    </tr>\r\n                </tfoot>\r\n                <tbody>\r\n                    <tr>\r\n                        <td class="tLeft"><span></span></td>\r\n                        <td class="tMid">\r\n                        <div class="CP_layercon1">\r\n                            <div class="CP_check">\r\n                              <table class="CP_w_ttl" width="100%">\r\n                                <tbody><tr><td class="td1">1天签到</td><td class="td2">每日＋1分</td></tr>\r\n                                <tr><td class="td1">连续3天签到</td><td class="td2">每日＋2分</td></tr>\r\n                                <tr><td class="td1">连续10天签到</td><td class="td2">每日＋4分</td></tr>\r\n                                <tr><td class="td1">连续20天签到</td><td class="td2">每日＋6分</td></tr>\r\n                                <tr><td class="td1">连续30天签到</td><td class="td2">每日＋8分</td></tr>\r\n                               </tbody></table>\r\n                               <div class="CP_w_cnt SG_tetb">如果连续签到中断（有一天未签到）重新计算积分</div>\r\n                               <p class="CP_w_btns_Mid"><a node-data="btnclose" class="SG_aBtn SG_aBtnB" href="#" ><cite>关闭</cite></a></p>\r\n                            </div>\r\n                        </div>\r\n                        </td>\r\n                        <td class="tRight"><span></span></td>\r\n                    </tr>\r\n                </tbody>\r\n            </table>',bs:null,panel:null,width:303,height:346,isInit:0,init:function(){var self=this;var bs=self.bs=new BackShadow(.4);var panel=self.panel=new Lib.Panel;panel.setTemplate(self.tpl);var box=panel.getNode("panel");addEvent(box,function(){var ev=getEvent();var tarEl=getEventTarget(ev);var nd=tarEl.getAttribute("node-data")||tarEl.parentNode.getAttribute("node-data");stopDefaultEvent(ev);if(nd=="btnclose"){self.hide()}});self.setPosition();self.isInit=1},setPosition:function(){var self=this;var win=Core.System.winSize();var x=win.width/2-self.width/2;var y=win.height/2-self.height/2-20;self.panel.setPosition(x,y);self.panel.setFixed(true)},show:function(obj){if(!this.isInit){this.init()}this.bs.show();this.panel.show()},hide:function(){this.panel.hide();this.bs.hidden()}};return jfck});App.navMenuFolding=function(){Lib.jfCheckIn.init();if(!$E("leftmenu_2"))return;var alwaysUnfold=false;var exceptId=["profile_notice","profile_paperlist","profile_invitelist","profile_replylist","profile_guestBookM","profile_commlist","profile_commphotolist"];for(var i=0;i<exceptId.length;i++){if(scope.$pageid==exceptId[i]){alwaysUnfold=true;break}}for(var i=1;i<9;i++){if(!$E("leftmenu_"+i)){continue}Core.Events.addEvent($E("leftmenu_"+i).parentNode,function(e){Core.Events.stopEvent(e);var evt=Core.Events.getEvent(e);var _target=evt.target||evt.srcElement;while(Core.String.trim(_target.className)!="centerMenu_tit"){_target=_target.parentNode}var wrap=_target.parentNode;var cla=Core.String.trim(wrap.className);if(cla==="centerMenu"){wrap.className="centerMenu centerMenu_on"}else{wrap.className="centerMenu"}})}};$registJob("index",function(){App.navMenuFolding()});Core.Dom.wrap=function(elm,tagName){var wrapper=$C(tagName);Core.Dom.insertAfter(wrapper,elm);wrapper.appendChild(elm);return wrapper};Ui.Slide=Core.Class.create();Ui.Slide.prototype={node:null,container:null,status:"show",offset:0,onSlideIn:new Function,onSlideOut:new Function,initialize:function(node,options){var options=options||{};this.node=$E(node);this.container=Core.Dom.wrap(this.node,"div");this.container.style.overflow="hidden";this.offset=this.node.offsetHeight;this.opacity=true;this.animation=options.animation||"strongEaseOut";this.duration=options.duration||1;this.container.style.height=this.offset+"px";this.node.style.marginTop="0px"},slideIn:function(opt){opt=opt||{};if(this.opacity){new Ui.tween(this.node,"opacity",1,this.duration,this.animation,{})}new Ui.tween(this.container,"height",this.offset,this.duration,this.animation,opt);new Ui.tween(this.node,"marginTop",0,this.duration,this.animation,{tween:function(x){}.bind2(this),end:this.onSlideIn})},slideOut:function(opt){opt=opt||{};if(this.opacity){new Ui.tween(this.node,"opacity",0,this.duration,this.animation,{})}new Ui.tween(this.container,"height",0,this.duration,this.animation,opt);new Ui.tween(this.node,"marginTop",-this.offset,this.duration,this.animation,{end:this.onSlideOut})},show:function(){if(this.opacity){}this.container.style.height=this.offset+"px";this.node.style.marginTop=0+"px"},hide:function(){if(this.opacity){}this.container.style.height=0+"px";this.node.style.marginTop=-this.offset+"px"}};if(typeof Mojie==="undefined"){Mojie={}}Mojie.slideShow=function(el,startHeight,endHeight,time){var isShow=startHeight<endHeight;el.style.overflow="hidden";el.style.height=startHeight+"px";if(isShow){el.style.display=""}var tween=new Ui.TweenStrategy(startHeight,endHeight,time||.5);tween.onTween=function(v){el.style.height=v+"px"};tween.onEnd=isShow?function(){el.style.overflow="";el.style.height=""}:function(){el.style.display="none"};tween.start()};Mojie.feedTypeList=function(x1,x2,x3){var dropNode=$E("allfeed"),subtype=$E("subtype");if(dropNode){var allBtn=Core.Dom.getXY(dropNode)}if(subtype){subtype.style.position="absolute"}if($IE6||$IE7||document.documentMode&&document.documentMode===7){subtype.style.top=allBtn[1]+x3+"px";subtype.style.left=allBtn[0]-2+"px"}else if($IE8&&document.documentMode>7){subtype.style.top=allBtn[1]+x2+"px";subtype.style.left=allBtn[0]+"px"}else{subtype.style.top=allBtn[1]+x1+"px";subtype.style.left=allBtn[0]+1+"px"}};$registJob("write",function(){var dropNode=$E("allfeed"),subtype=$E("subtype"),guanboWrap=$E("guanbofeedout");var allBtn,cver;var guanbofeed=Utils.Cookie.getCookie("guanbofeedver"+scope.$uid);Mojie.feedTypeList(24,23,21);if(dropNode!=null){Core.Events.addEvent(dropNode,function(){if(subtype.style.display===""){return}else{Mojie.feedTypeList(24,23,21);Mojie.slideShow(subtype,0,190)}},"mouseover")}Core.Events.addEvent(dropNode,function(e){Core.Events.stopEvent(e)});Core.Events.addEvent("subtype",function(){Core.Events.stopBubble();setTimeout(function(){Mojie.slideShow(subtype,180,0)},300)},"mousedown");Core.Events.addEvent(document.body,function(){Mojie.slideShow(subtype,190,0)},"mousedown")});Lib.pkg("Lib.Component");Lib.Component=Core.Class.create();Lib.Component.instances=Lib.Component.instances||{};Lib.Component.compSize={};Lib.Component.getInitCompSize=function(){if(scope.component_lists!=null){var compList=scope.component_lists;for(var key in compList){if(compList[key].list.length>0){Core.Array.foreach(compList[key].list,function(oItem){Lib.Component.compSize[oItem]=compList[key].size})}}return true}else{return null}};Lib.Component.refresh=function(sCompId,oOption){oOption=oOption||{};try{if(Lib.Component.instances[sCompId]==null){if(typeof Lib.Component["Comp_"+sCompId]=="undefined"){$registComp(sCompId,{},"static")}Lib.Component.instances[sCompId]=new Lib.Component["Comp_"+sCompId](sCompId)}}catch(e){}Debug.log("刷新组件 "+sCompId+" ，新宽度是 "+oOption.width);Debug.log("组件 "+sCompId+" 增加管理链接："+oOption.addManage);Lib.Component.instances[sCompId].reload(oOption.width,oOption.addManage,oOption.forceRefresh)};Lib.Component.set=function(sCompId){Debug.log("展开组件 "+sCompId+" 的设置功能");if(Lib.Component.instances[sCompId]==null){Lib.Component.instances[sCompId]=new Lib.Component["Comp_"+sCompId](sCompId)}Lib.Component.instances[sCompId].getUserSet()};$registComp=Lib.Component.registComp=function(id,override,superClass){superClass=superClass==null?Lib.Component.Comp:Lib.Component["Comp_"+superClass];superClass=superClass||Lib.Component.Comp;override.compId=id;Lib.Component["Comp_"+id]=Core.Class.define(null,superClass,override)};Lib.Component.renderByList=function(arrDefaultList){Core.Array.foreach(arrDefaultList,function(oItem){try{if($E("module_"+oItem)!=null){var comp=Lib.Component.instances[oItem]||new Lib.Component["Comp_"+oItem](oItem);if(comp.size!=null&&comp.load!=null){comp.size=Lib.Component.compSize[oItem];try{comp.load()}catch(e){}Debug.log("组件："+oItem+" 初始化成功")}else{Debug.error("组件："+oItem+" 初始化失败，组件尺寸信息不存在")}}else{Debug.error("组件："+oItem+" 初始化失败，页面内缺少组件的HTML节点")}}catch(e){Debug.error(e.message||"组件："+oItem+" 初始化失败，请确认该组件类是否定义过")}finally{}})};Lib.Component.lazyRenderByList=function(arrDefaultList){var lazyList=[];Core.Array.foreach(arrDefaultList,function(oItem){try{if($E("module_"+oItem)!=null){var comp=Lib.Component.instances[oItem]||new Lib.Component["Comp_"+oItem](oItem);if(comp.size!=null&&comp.load!=null){comp.size=Lib.Component.compSize[oItem];try{lazyList.push({dom:$E("module_"+oItem),callback:Lib.Component.instances[oItem].load.bind2(Lib.Component.instances[oItem])})}catch(e){}Debug.log("组件："+oItem+" 初始化成功")}else{Debug.error("组件："+oItem+" 初始化失败，组件尺寸信息不存在")}}else{Debug.error("组件："+oItem+" 初始化失败，页面内缺少组件的HTML节点")}}catch(e){Debug.error(e.message||"组件："+oItem+" 初始化失败，请确认该组件类是否定义过")}finally{}});Lib.LazyLoad(lazyList,{})};Core.Dom.removeNode=function(node){node=$E(node)||node;try{node.parentNode.removeChild(node)}catch(e){}};Lib.Component.Comp=Core.Class.create();Lib.Component.Comp.prototype={initialize:function(sId){if(this.isInit==true||sId==null||Lib.Component.compSize[sId]==null){return}else{this.isInit=true;this.compId=sId;this.size=Lib.Component.compSize[sId];Lib.Component.instances[sId]=this;return this}},compId:null,getContainer:function(){return $E("module_"+this.compId)},getTitle:function(){return Core.Dom.getElementsByClass($E("module_"+this.compId),"span","title")[0]},getManage:function(){var manageNode=Core.Dom.getElementsByClass($E("module_"+this.compId),"span","edit");if(manageNode.length!=0){return manageNode[0]}else{Debug.error("组件添加管理链接失败，检查组件"+this.compId+"标题栏 SPAN[class=edit] 是否存在");return null}},getContent:function(){var contentNode=Core.Dom.getElementsByClass($E("module_"+this.compId),"div","SG_connBody");if(contentNode.length!=0){return contentNode[0]}else{Debug.error("组件内容节点获取失败，检查组件"+this.compId+"内 DIV[class=SG_connBody] 是否存在");return null}},load:function(){trace("load compId="+this.compId);this.setContent("")},reload:function(sSize){this.clearContent();this.load()},setTitle:function(sTitle){var titleNode=this.getTitle();if(titleNode){titleNode.innerHTML=sTitle||""}},setManage:function(){var manageNode=this.getManage();if($isAdmin&&manageNode){manageNode.innerHTML='<span class="move"><a href="#" '+'onclick="funcMoveUpDown.up('+this.compId+');return false;">↑</a><a href="#" '+'onclick="funcMoveUpDown.down('+this.compId+');return false;">↓</a></span>'+'<a href="#" onclick="hiddenComponents(\''+this.compId+'\');return false;" class="CP_a_fuc">[<cite>隐藏</cite>]</a>'}},setContent:function(sContent){sContent=typeof sContent=="string"?sContent:sContent+"";this.getContent().innerHTML=sContent||""},clearContent:function(){this.getContent().innerHTML=""},remove:function(){Core.Dom.removeNode(this.getContainer());this.finalize()},finalize:function(){this.isInit=null;Lib.Component.instances[this.compId]=null}};Core.String.shorten=function(str,len,suffix){if(Core.String.byteLength(str)<=len){return str}if(suffix!=""){suffix=suffix||"..."}else{suffix=""}return Core.String.leftB(str,len)+suffix};scope.Group={};scope.Group.prov0="请选择";scope.Group.code0="0";scope.Group.prov11="东城,西城,崇文,宣武,朝阳,丰台,石景山,海淀,门头沟,房山,通州,顺义,昌平,大兴,怀柔,平谷,密云,延庆";scope.Group.code11="2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19";scope.Group.prov12="和平,河东,河西,南开,河北,红桥,东丽,西青,津南,北辰,武清,宝坻,塘沽,汉沽,大港,静海,宁河,蓟县";scope.Group.code12="2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19";scope.Group.prov13="石家庄,唐山,秦皇岛,邯郸,邢台,保定,张家口,承德,沧州,廊坊,衡水";scope.Group.code13="1,2,3,4,5,6,7,8,9,10,11";scope.Group.prov14="太原,大同,阳泉,长治,晋城,朔州,晋中,运城,忻州,临汾,吕梁";scope.Group.code14="1,2,3,4,5,6,7,8,9,10,23";scope.Group.prov15="呼和浩特,包头,乌海,赤峰,通辽,鄂尔多斯,呼伦贝尔,兴安盟,锡林郭勒盟,乌兰察布盟,巴彦淖尔盟,阿拉善盟";scope.Group.code15="1,2,3,4,5,6,7,22,25,26,28,29";scope.Group.prov21="沈阳,大连,鞍山,抚顺,本溪,丹东,锦州,营口,阜新,辽阳,盘锦,铁岭,朝阳,葫芦岛";scope.Group.code21="1,2,3,4,5,6,7,8,9,10,11,12,13,14";scope.Group.prov22="长春,吉林,四平,辽源,通化,白山,松原,白城,延边";scope.Group.code22="1,2,3,4,5,6,7,8,24";scope.Group.prov23="哈尔滨,齐齐哈尔,鸡西,鹤岗,双鸭山,大庆,伊春,佳木斯,七台河,牡丹江,黑河,绥化,大兴安岭";scope.Group.code23="1,2,3,4,5,6,7,8,9,10,11,12,27";scope.Group.prov31="黄浦,卢湾,徐汇,长宁,静安,普陀,闸北,虹口,杨浦,浦东新,宝山,闵行,嘉定,金山,松江,青浦,奉贤,南汇,崇明";scope.Group.code31="2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20";scope.Group.prov32="南京,无锡,徐州,常州,苏州,南通,连云港,淮安,盐城,扬州,镇江,泰州,宿迁";scope.Group.code32="1,2,3,4,5,6,7,8,9,10,11,12,13";scope.Group.prov33="杭州,宁波,温州,嘉兴,湖州,绍兴,金华,衢州,舟山,台州,丽水";scope.Group.code33="1,2,3,4,5,6,7,8,9,10,11";scope.Group.prov34="合肥,芜湖,蚌埠,淮南,马鞍山,淮北,铜陵,安庆,黄山,滁州,阜阳,宿州,巢湖,六安,亳州,池州,宣城";scope.Group.code34="1,2,3,4,5,6,7,8,10,11,12,13,14,15,16,17,18";scope.Group.prov35="福州,厦门,莆田,三明,泉州,漳州,南平,龙岩,宁德";scope.Group.code35="1,2,3,4,5,6,7,8,9";scope.Group.prov36="南昌,景德镇,萍乡,九江,新余,鹰潭,赣州,吉安,宜春,抚州,上饶";scope.Group.code36="1,2,3,4,5,6,7,8,9,10,11";scope.Group.prov37="济南,青岛,淄博,枣庄,东营,烟台,潍坊,济宁,泰安,威海,日照,莱芜,临沂,德州,聊城,滨州,菏泽";scope.Group.code37="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17";scope.Group.prov41="郑州,开封,洛阳,平顶山,安阳,鹤壁,新乡,焦作,濮阳,许昌,漯河,三门峡,南阳,商丘,信阳,周口,驻马店";scope.Group.code41="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17";scope.Group.prov42="武汉,黄石,十堰,宜昌,襄樊,鄂州,荆门,孝感,荆州,黄冈,咸宁,随州,恩施";scope.Group.code42="1,2,3,5,6,7,8,9,10,11,12,13,28";scope.Group.prov43="长沙,株洲,湘潭,衡阳,邵阳,岳阳,常德,张家界,益阳,郴州,永州,怀化,娄底,湘西";scope.Group.code43="1,2,3,4,5,6,7,8,9,10,11,12,13,31";scope.Group.prov44="广州,韶关,深圳,珠海,汕头,佛山,江门,湛江,茂名,肇庆,惠州,梅州,汕尾,河源,阳江,清远,东莞,中山,潮州,揭阳,云浮";scope.Group.code44="1,2,3,4,5,6,7,8,9,12,13,14,15,16,17,18,19,20,51,52,53";scope.Group.prov45="南宁,柳州,桂林,梧州,北海,防城港,钦州,贵港,玉林,百色,贺州,河池";scope.Group.code45="1,2,3,4,5,6,7,8,9,10,11,12";scope.Group.prov46="海口,三亚,其他";scope.Group.code46="1,2,90";scope.Group.prov50="渝中,沙坪坝,九龙坡,大渡口,江北,渝北,北碚,南岸,巴南,万州,涪陵,黔江,长寿,万盛,双桥,永川,合川,江津,南川,綦江,潼南,荣昌,璧山,大足,铜梁,梁平,城口,垫江,武隆,丰都,奉节,开县,云阳,忠县,巫溪,巫山,石柱土家族自治县,秀山土家族苗族自治县,酉阳土家族苗族自治县,彭水苗族土家族自治县";scope.Group.code50="2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41";scope.Group.prov51="成都,自贡,攀枝花,泸州,德阳,绵阳,广元,遂宁,内江,乐山,南充,眉山,宜宾,广安,达州,雅安,巴中,资阳,阿坝,甘孜,凉山";scope.Group.code51="1,3,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,32,33,34";scope.Group.prov52="贵阳,六盘水,遵义,安顺,铜仁,黔西南,毕节,黔东南,黔南";scope.Group.code52="1,2,3,4,22,23,24,26,27";scope.Group.prov53="昆明,曲靖,玉溪,保山,昭通,楚雄,红河,文山,思茅,西双版纳,大理,德宏,丽江,怒江,迪庆,临沧";scope.Group.code53="1,3,4,5,6,23,25,26,27,28,29,31,32,33,34,35";scope.Group.prov54="拉萨,昌都,山南,日喀则,那曲,阿里,林芝";scope.Group.code54="1,21,22,23,24,25,26";scope.Group.prov61="西安,铜川,宝鸡,咸阳,渭南,延安,汉中,榆林,安康,商洛";scope.Group.code61="1,2,3,4,5,6,7,8,9,10";scope.Group.prov62="兰州,嘉峪关,金昌,白银,天水,武威,张掖,平凉,酒泉,庆阳,定西,陇南,临夏,甘南";scope.Group.code62="1,2,3,4,5,6,7,8,9,10,24,26,29,30";scope.Group.prov63="西宁,海东,海北,黄南,海南,果洛,玉树,海西";scope.Group.code63="1,21,22,23,25,26,27,28";scope.Group.prov64="银川,石嘴山,吴忠,固原";scope.Group.code64="1,2,3,4";scope.Group.prov65="乌鲁木齐,克拉玛依,吐鲁番,哈密,昌吉,博尔塔拉,巴音郭楞,阿克苏,克孜勒苏,喀什,和田,伊犁,塔城,阿勒泰";scope.Group.code65="1,2,21,22,23,27,28,29,30,31,32,40,42,43";scope.Group.prov71="台北,高雄,其他";scope.Group.code71="1,2,90";scope.Group.prov81="香港岛,九龙,新界";scope.Group.code81="1,2,3";scope.Group.prov82="花地玛堂区,圣安多尼堂区,大堂区,望德堂区,风顺堂区";scope.Group.code82="1,2,3,4,5";scope.Group.prov600="澳洲";scope.Group.code600="1";scope.Group.prov500="北美洲";scope.Group.code500="1";scope.Group.prov199="亚洲其他国家";scope.Group.code199="1";scope.Group.prov300="欧洲";scope.Group.code300="1";scope.Group.prov999="其他";scope.Group.code999="1";scope.Group.provinces="安徽,北京,重庆,福建,甘肃,广东,广西,贵州,海南,河北,黑龙江,河南,湖北,湖南,内蒙古,江苏,江西,吉林,辽宁,宁夏,青海,山西,山东,上海,四川,天津,西藏,新疆,云南,浙江,陕西,台湾,香港,澳门,海外";scope.Group.provcodes="34,11,50,35,62,44,45,52,46,13,23,41,42,43,15,32,36,22,21,64,63,14,37,31,51,12,54,65,53,33,61,71,81,82,1001";App.CitySelect=Core.Class.create();App.CitySelect.prototype={canton_id:"cs_canton",city_id:"cs_city",submit_id:"cs_submit",cancel_id:"cs_cancel",initialize:function(container,hiddenFunc){this.container=container;this.hiddenFunc=hiddenFunc;this.initTemplate();this.bindEvents();this.buildCanton()},bindEvents:function(){Core.Events.addEvent($E(this.cancel_id),this.hidden.bind2(this),"click");Core.Events.addEvent($E(this.submit_id),this.save.bind2(this),"click")},hidden:function(){$E(this.container).style.display="none";this.hiddenFunc()},save:function(){Lib.checkAuthor();if(!$isLogin){(new Lib.Login.Ui).login(this.save.bind2(this),true);return}var cantonEle=$E(this.canton_id);var cityEle=$E(this.city_id);var cantonId=cantonEle.value;var canton=cantonEle.childNodes;for(var i=0;canton[i];i++){if(canton[i]&&canton[i].value&&canton[i].value==cantonId){canton=canton[i].innerHTML;break}}var cityId=cityEle.value;var city=cityEle.childNodes;for(var i=0;city[i];i++){if(city[i]&&city[i].value&&city[i].value==cityId){city=city[i].innerHTML;break}}if(cantonId=="0"){return}if(cityId=="0"){return}var postStr='{"place1":'+cantonId+',"place2":'+cityId+"}";if(!this._saveInterface){this._saveInterface=new Interface("http://control.blog.sina.com.cn/riaapi/profile/edit_currentCity.php","jsload")}this._saveInterface.request({GET:{uid:scope.$uid,data:postStr,rand:Math.random()},onSuccess:function(_data){this.hidden();$E("wt_city_change").style.display="none";$E("cs_canton").value="0";$E("cs_city").value="0";scope.weacher.setIsLoadOne(false);var con=$E("wt_city_show");con.innerHTML=['<div style="padding:30px 0 0 30px; height:200px">','<img src="http://simg.sinajs.cn/blog7style/images/common/loading.gif">加载中…',"</div>"].join("");var stro=$E("place").children[0];stro.innerHTML=canton+city;stro.title=canton+city;$E("weather_city").value=cantonId+","+cityId;var cityEle=$E(this.city_id);cityEle.length=1;Lib.Component.renderByList([978])}.bind2(this),onError:function(_data){showError(_data.code)},onFail:function(){}})},buildCanton:function(){var selectEle=$E(this.canton_id);var cantonNames=scope.Group.provinces.split(",");var cantonCodes=scope.Group.provcodes.split(",");cantonNames.pop();cantonCodes.pop();this._createOption(selectEle,cantonNames,cantonCodes);Core.Events.addEvent(selectEle,this.huildCity.bind2(this),"change")},huildCity:function(){var ele=Core.Events.getEventTarget();var selectId=ele.value;var cityNames,cityCodes;if(selectId==""||selectId==="0"){cityNames=[];cityCodes=[]}else{cityNames=scope.Group["prov"+selectId].split(",");cityCodes=scope.Group["code"+selectId].split(",")}cityNames.unshift("请选择城市");cityCodes.unshift("0");var cityEle=$E(this.city_id);cityEle.innerHTML="";if(selectId!=""){this._createOption(cityEle,cityNames,cityCodes)}},_createOption:function(container,names,codes){var html="",len=names.length;for(var i=0;i<len;i++){var option=$C("option");option.value=codes[i];option.title=names[i];option.alt=names[i];option.innerHTML=Core.String.shorten(names[i],10);container.appendChild(option)}},initTemplate:function(){html="<p>"+'<select id="'+this.canton_id+'" style="margin-right:5px;"><option value="0">请选择地区</option></select>'+'<select id="'+this.city_id+'"><option value="0">请选择城市</option></select>'+"</p>"+"<p>"+'<a class="SG_aBtn SG_aBtnB" href="#" id="'+this.submit_id+'" onclick="return false"><cite>更改</cite></a>'+'<a class="SG_aBtn SG_aBtnB" href="#" id="'+this.cancel_id+'" onclick="return false"><cite>取消</cite></a>'+"</p>";$E(this.container).innerHTML=html}};App.Weacher=Core.Class.create();App.Weacher.prototype={initialize:function(container,hiddenFunc){this.container=container;this.initTemplate();this.initDetailTemplate();this.bindEvent();var gotoCity},get:function(citys){trace("get_citys:"+citys);this.citysCode=citys;this.citysName=this.getCity();trace("citysName:"+this.citysName);if(this.citysName[0]=="北京"&&this.citysName[1]=="朝阳"){this.citysName[1]="北京"}this.loadDate(this.citysName[1])},loadDate:function(city){Utils.Io.JsLoad.request("http://php.weather.sina.com.cn/iframe/index/w_cl.php",{GET:{city:city,day:"1",code:"js",charset:"utf-8",cbf:"scope.weacher.render"}})},getCity:function(){if(!this.allCityCodes){this.allCityCodes=scope.Group.provcodes.split(",");this.allCityNames=scope.Group.provinces.split(",")}var citysName=[];var len=this.allCityCodes.length;for(var i=0;i<len;i++){if(this.citysCode[0]==this.allCityCodes[i]){switch(this.allCityNames[i]){case"天津":case"北京":case"上海":case"香港":case"澳门":case"重庆":citysName.push(this.allCityNames[i]);break;default:citysName.push(scope.Group["prov"+this.allCityCodes[i]].split(",")[0]);break}var data=scope.Group["code"+this.allCityCodes[i]].split(",");for(var j=0;j<data.length;j++){if(this.citysCode[1]==data[j]){var name=scope.Group["prov"+this.allCityCodes[i]].split(",")[j];citysName.push(name);trace("names:"+citysName);return citysName}}}}return false},initTemplate:function(){var html='<div class="weather_l" style="cursor:pointer;">\r\n		               	<span class="ico_wd"></span>\r\n		               	<p class="temper">#{t1}</p>\r\n						<p class="temper_num">#{t1}</p>\r\n	               </div>';this._temp=new Ui.Template(html)},initDetailTemplate:function(){var htmls='<div class="tempbox" style = "display:none;">\r\n		               	<span></span>\r\n		               	<span class="tempnum">#{t1}℃~#{t2}℃</span>\r\n						<p class="wind">#{d1}<br/>#{s1}</p>\r\n	               </div>';this._tpl=new Ui.Template(htmls)},render:function(data){var wData=data.w;var city;for(var name in wData){trace("result:"+name);city=name}var _data=wData[city];if(_data){var obj={f1:_data[0].f1,f2:_data[0].f2,t1:_data[0].t1!=""?_data[0].t1:_data[0].t2,t2:_data[0].t2,s1:_data[0].s1!=""?_data[0].s1:_data[0].s2,s2:_data[0].s2,d1:_data[0].d1!=""?_data[0].d1:_data[0].d2,d2:_data[0].d2};if(_data[0].s1!=_data[0].s2){obj.s1=_data[0].s1+"转"+_data[0].s2}var detail=$E("detailTem");if(_data[0].f1){detail.className="ico_temp "+_data[0].f1+"_0"}else{detail.className="ico_temp "+_data[0].f2+"_0"}$E(this.container).innerHTML=this._temp.evaluate(obj);$E("detailTem").innerHTML=this._tpl.evaluate(obj);if(!this.isLoadOne){
$E("detailTem").children[0].children[0].innerHTML=city}else{var provcodes=scope.Group.provcodes.split(",");var provinces=scope.Group.provinces.split(",");for(var i=0;provcodes[i];i++){if(provcodes[i]==this.citysCode[0]){$E("detailTem").children[0].children[0].innerHTML=provinces[i];break}}}gotoCity=city;$E("wt_city_change").style.display=""}else{if(!this.isLoadOne){this.loadDate(this.citysName[0]);this.isLoadOne=true}}},bindEvent:function(){Core.Events.addEvent($E("goto"),function(){$E("detailTem").children[0].style.display=""},"mouseover");Core.Events.addEvent($E("goto"),function(){$E("detailTem").children[0].style.display="none"},"mouseout");Core.Events.addEvent($E("goto"),function(){Core.Events.stopEvent();if(!this.isLoadOne){window.open("http://php.weather.sina.com.cn/search.php?c=1&city="+encodeURIComponent(gotoCity)+"&dpc=1")}})},setIsLoadOne:function(data){this.isLoadOne=data}};$registComp(978,{change_city_id:"wt_city_change",weather_con_id:"wt_city_show",city_select_id:"wt_city_select",change_select_btn:"place",city_value_id:"weather_city",viewType:"select",load:function(){var citys=$E(this.city_value_id).value.split(",");if(this.checkCitys(citys)){this.showDate();this.showView();this.createWeacher();scope.weacher.get(citys)}else{this.selectView();this.createCitySelect()}this.bindBtn()},showDate:function(){var dateWrapper=$E("timeDate");dateWrapper.style.cursor="pointer";var monthTime=dateWrapper.children[0],dateTime=dateWrapper.children[1];var myDate=new Date;var ary=["一","二","三","四","五","六","日"];monthTime.innerHTML=myDate.getMonth()+1+"月"+myDate.getDate()+"日";var day=parseInt(myDate.getDay());day=day===0?day=6:day=day-1;dateTime.innerHTML="星期"+ary[day]},checkCitys:function(array){var len=array.length;for(var i=0;i<len;i++){if(array[i]){return true}}return false},showView:function(){$E(this.city_select_id).style.display="none";$E(this.change_city_id).style.display="";$E(this.change_city_id).parentNode.style.display="";$E(this.weather_con_id).style.display="";this.viewType="show"},selectView:function(){$E(this.city_select_id).style.display="";this.viewType="select"},createCitySelect:function(){if(!this.citySelect){this.citySelect=new App.CitySelect(this.city_select_id,this.showView.bind2(this))}},createWeacher:function(){if(!scope.weacher){scope.weacher=new App.Weacher(this.weather_con_id)}},showSelect:function(e){Core.Events.stopEvent();this.createCitySelect();this.selectView()},bindBtn:function(){Core.Events.addEvent($E(this.change_city_id),this.showSelect.bind2(this),"click")}});$registJob("render_push",function(){Lib.Component.compSize={978:210};Lib.Component.renderByList([978])});Core.Dom.up=function(element,className){var el=$E(element);while(el.parentNode){if(new RegExp("\\b"+className+"\\b").test(el.className)){return el}el=el.parentNode}};$SYSMSG.extend({A00001:"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电4006900000。",A00002:"很抱歉，您的IP出现异常，请稍后再试",A00003:"无权限进行此操作，请重新登录。",A00004:"无权限进行此操作，请重新登录。",A00005:"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电4006900000。",A00006:"操作成功",A00007:"无权限进行此操作，请重新登录。",A00009:"网络繁忙，请稍后再试",A00010:"无升级权限",A11007:"你还未开通新浪博客，请先<a href='http://login.sina.com.cn/hd/reg_sec.php?entry=blog'> 开通博客</a>",A00800:"对不起，您短时间点击喜欢过多，请多休息，注意身体！感谢您对新浪博客的支持和关注！"});$SYSMSG.extend({A80001:"暂无内容。",A80002:"暂无内容。",A80101:"组件加载失败，请刷新。",A80201:"你要删除留下的访问记录吗？",A80202:'<div class="CP_w_cnt SG_txtb">删除后一小时内不会在此留下访问记录。</div>',A80203:"确实要删除此访问记录吗？",A80204:['<ul class="CP_w_part SG_txtb">'+'<li><input type="checkbox" id="comp_12_deleteToBlack" class="CP_w_fm1" />'+'<label for="comp_12_deleteToBlack" >将此人加入黑名单</label></li>'+'</ul><div class="CP_w_cnt SG_txtb">加入黑名单的用户无法和你沟通。</div>'].join(""),A02003:"已添加过此模块，不能重复添加。",A02004:"抱歉，该模块不能被克隆。",A02005:"抱歉，您的博客尚未升级，请<a href='http://blog.sina.com.cn/u/#UID' target='_blank'>升级</a>后再“添加到您的博客”。",A02006:"模块已成功添加到你的博客。",A02007:"确实要隐藏此模块吗？隐藏后可在“页面设置”中恢复。",A02008:"确实要隐藏此模块吗？此模块活动时间已结束，隐藏后不可恢复。"});function showError(code,ico){var msg=$SYSMSG[code]||code;winDialog.alert(msg,{icon:ico||"01"})}$SYSMSG.extend({A11102:"已添加过此模块，不能重复添加。",A11103:"抱歉，您的组件已经太多。",A11104:"抱歉！你不是博客7.0用户，不能添加此组件。",A11007:'你还未开通新浪博客，请先 <a href="http://login.sina.com.cn/hd/reg_sec.php?entry=blog">开通博客</a>'});Lib.Component.clone=function(sCompId,nSize){if(sCompId==null||isNaN(sCompId)){Debug.log("请提供被克隆组件的有效ID，当前是："+sCompId);return}nSize=nSize.toString().replace(/0$/,"");var cloneStart=function(){Debug.log("start to clone "+sCompId);if(!$isLogin){Lib.checkAuthor();$tray.renderLogin()}var i_cloneComp=new Interface("http://control.blog.sina.com.cn/riaapi/conf/module_clone.php","jsload");var param={productid:"0x00000001",suid:$UID,uid:scope.$uid,moduleid:sCompId,cwidth:nSize,version:7,feed:1};i_cloneComp.request({GET:param,onSuccess:function(_data){winDialog.alert($SYSMSG.A02006,{icon:"03",funcOk:function(){window.open("http://blog.sina.com.cn/u/"+$UID,"_blank","")}})},onError:function(_data){switch(_data.code){case"A00003":winDialog.confirm($SYSMSG.A02005.replace("#UID",$UID),{funcOk:function(){window.open("http://blog.sina.com.cn/u/"+$UID,"_blank","")},textOk:"升级",textCancel:"关闭",icon:"03"});break;case"A11007":winDialog.confirm($SYSMSG.A11007.replace("#{linkNewBlog}","http://blog.sina.com.cn/u/"+$UID),{funcOk:function(){window.open("http://login.sina.com.cn/hd/reg_sec.php?entry=blog","_blank","")},textOk:"开通",textCancel:"关闭",icon:"01"});break;default:showError(_data.code);break}},onFail:function(){showError($SYSMSG.A00001)}})};Lib.checkAuthor();if(!$isLogin){(new Lib.Login.Ui).login(Core.Function.bind3(cloneStart,null,[sCompId]))}else{cloneStart(sCompId)}};$CloneComp=function(sCompId){Lib.Component.clone(sCompId,210)};$registJob("Comp_clone",function(){var cloneLinks=Core.Dom.getElementsByClass(document.body,"a","SG_comClone");if(cloneLinks.length>0){Core.Array.foreach(cloneLinks,function(x){var comp_cnt=Core.Dom.up(x,"SG_conn");if(comp_cnt!=null){var comp_id=comp_cnt.id.replace("module_","");var size=comp_cnt.parentNode.className.substr(7,2);Core.Events.addEvent(x,Core.Function.bind3(Lib.Component.clone,null,[comp_id,size]))}})}});$TEMPLATECLONE_MSG={A00001:"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电4006900000。",A00002:"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电4006900000。",A00003:"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电4006900000。",A00004:"未登录",A00005:"抱歉，你暂时不能复制该模板",A00006:"操作成功",A11007:'你还未开通新浪博客，请先 <a href="http://login.sina.com.cn/hd/reg_sec.php?entry=blog"  id="cloneTemplateButNoReg">开通博客</a>'};Lib.TemplateClone=Core.Class.create();Lib.TemplateClone.prototype={type:"1",version:"7",interfaceClone:null,btnClone:null,initialize:function(btnClone,callBack){var _this=this;this.interfaceClone=new Interface("http://control.blog.sina.com.cn/riaapi/conf/template_clone.php","jsload");this.btnClone=btnClone;if(this.btnClone){Core.Events.addEvent(this.btnClone,function(){_this.clone(callBack)},"click")}},clone:function(callBack,tplNum){var _this=this;var a315="<a style='color:red' href='http://finance.sina.com.cn/333/2010-02-05/guest920.shtml' target='_blank'>315十大行业满意度调查</a>";var tipText=tplNum?a315:"";Lib.checkAuthor();if($isLogin){winDialog.confirm("确定使用此模板吗?",{subText:tipText,funcOk:function(){scope.blogOpener.showDialog(function(){_this.request(callBack)})}})}else{var templateCloneLogin=new Lib.Login.Ui;templateCloneLogin.login(function(){winDialog.confirm("确定使用此模板吗?",{subText:tipText,funcOk:function(){scope.blogOpener.showDialog(function(){_this.request(callBack)})},funcCancel:function(){location.reload()}})})}},request:function(callBack){var _this=this;this.interfaceClone.request({GET:{uid_cloned:scope.$uid,type:_this.type,version:_this.version},onSuccess:function(data){if(callBack){callBack()}},onError:function(data){if(data["code"]=="A11007"){Lib.checkAuthor();var tempAlertDialog=winDialog.alert($TEMPLATECLONE_MSG[data["code"]].replace(/#\{linkNewBlog\}/g,"http://control.blog.sina.com.cn/reg/reg_blog.php?version=7"),{icon:"01"});$E("cloneTemplateButNoReg").onclick=function(){tempAlertDialog.hidden().destroy()}}else{winDialog.alert($TEMPLATECLONE_MSG[data["code"]],{icon:"02"})}},onFail:function(){}})}};Lib.insertMoban=function(){if(scope.tpl&&scope.tpl!=""&&(scope.tpl.split("_")[0]=="13"||$_GLOBAL.flashtemplate[scope.tpl])){Lib.insertMobanFunc(scope.tpl)}};Lib.insertMobanFunc=function(id){var headflash=$E("headflash");if(headflash){headflash.innerHTML="";headflash.style.display="";var swf_url="http://simg.sinajs.cn/blog7newtpl/css/"+id.split("_")[0]+"/"+id+"/top.swf";var width=950,height=266;if($_GLOBAL.flashtemplate[id].width){width=$_GLOBAL.flashtemplate[id].width}if($_GLOBAL.flashtemplate[id].height){height=$_GLOBAL.flashtemplate[id].height}trace("flash height="+height);var x=Utils.Flash.swfView.Add(swf_url,"headflash","headflash_f",width,height,"9.0.0.0","#000",{},{allowScriptAccess:"false",wmode:"transparent",allowFullScreen:"false"})}};Lib.tplFuncArr={};Lib.tplFuncCount=0;Lib.getTplNum=function(func){Lib.tplFuncArr[Lib.tplFuncCount++]=func||function(){};if($isAdmin&&scope.tpl&&scope.tpl!=""){for(var k in Lib.tplFuncArr){Lib.tplFuncArr[k]();Lib.tplFuncArr[k]=null;delete Lib.tplFuncArr[k]}return}else{if($IE){var ss=document.styleSheets;var re=/\S*(blog7tpl([^t]*))\S*/gi;var re2=/\S*(blog7newtpl\/css([^t]*))\S*/gim;for(var i=0;i<ss.length;i++){if(ss[i].id=="uid_link_css"){var res=re.exec(ss[i].cssText);var res2=re2.exec(ss[i].cssText);if(res!=null||res2!=null){if(res!=null){scope.tpl=res[2].split("/")[2]}else if(res2!=null){scope.tpl=res2[2].split("/")[2]}}break}}for(var k in Lib.tplFuncArr){Lib.tplFuncArr[k]();Lib.tplFuncArr[k]=null;delete Lib.tplFuncArr[k]}}else if(!$IE&&scope.$PRODUCT_NAME=="blog7"){for(var k in Lib.tplFuncArr){Lib.tplFuncArr[k]();Lib.tplFuncArr[k]=null;delete Lib.tplFuncArr[k]}return;Utils.Io.Ajax.request("http://blog.sina.com.cn/s/"+scope.$uid+".css?",{onComplete:function(text){text=text.replace("\n","");var re=/\S*(blog7tpl([^t]*))\S*/gim;var re2=/\S*(blog7newtpl\/css([^t]*))\S*/gim;var res=re.exec(text);var res2=re2.exec(text);if(res!=null||res2!=null){if(res!=null){scope.tpl=res[2].split("/")[2]}else if(res2!=null){scope.tpl=res2[2].split("/")[2]}}for(var k in Lib.tplFuncArr){Lib.tplFuncArr[k]();Lib.tplFuncArr[k]=null;delete Lib.tplFuncArr[k]}}.bind2(this),returnType:"txt"})}else if(!$IE&&scope.$PRODUCT_NANM!="blog7"){Utils.Io.JsLoad.request("http://blog.sina.com.cn/s/"+scope.$uid+".js",{GET:{tm:(new Date).getTime()},onComplete:function(){for(var k in Lib.tplFuncArr){Lib.tplFuncArr[k]();Lib.tplFuncArr[k]=null;delete Lib.tplFuncArr[k]}}.bind2(this)})}}};$registJob("insertDynaMoban",function(){Lib.getTplNum(function(){Lib.insertMoban()})});$registJob("templateClone",function(){Lib.checkAuthor();if($isAdmin){trace("博主。不执行代码");return}Lib.getTplNum(function(){var tmpCloneFuc=function(){function formatPv(num){var tmp=new Ui.Template($_GLOBAL.cloneTemplateConfig[scope["tpl"]].count_text);var cnf={};cnf.template_pv=num;$E("template_clone_link").innerHTML=tmp.evaluate(cnf)}if(scope["tpl"]){var tc;var tcInfo=$_GLOBAL.cloneTemplateConfig[scope["tpl"]];if(tcInfo&&tcInfo["template_clone_pic"].replace(/\s/g,"")!=""){$E("template_clone_pic").innerHTML=tcInfo["template_clone_pic"];$E("template_clone_link").innerHTML=tcInfo["template_clone_link"];$E("template_clone_other").innerHTML=tcInfo["template_clone_other"];if(scope["tpl"]=="8_52"){$E("template_clone_pic").parentNode.parentNode.style.top="0px";if(window.screen.width<1280){$E("template_clone_pic").parentNode.parentNode.style.right="88px"}$E("template_clone_pic").parentNode.parentNode.style.zIndex=201}if(tcInfo["count_id"]){Utils.Io.JsLoad.request("http://comet.blog.sina.com.cn/api?maintype=hits&act=3&uid="+tcInfo["count_id"]+"&varname=templatecc",{onComplete:function(){if(typeof templatecc!="undefined"){formatPv(templatecc.pv)}else{$E("template_clone_link").style.display="none"}}})}tc=new Lib.TemplateClone($E("template_clone_pic"),function(){winDialog.alert("克隆模板成功!",{icon:"03",funcOk:function(){Lib.checkAuthor();window.location.href="http://blog.sina.com.cn/u/"+$UID}})})}var gwinfo=$_GLOBAL.GUANWANG[scope["tpl"]];if(gwinfo&&gwinfo["template_clone_pic"].replace(/\s/g,"")!=""){$E("template_clone_pic").innerHTML=gwinfo["template_clone_pic"];$E("template_clone_other").innerHTML=gwinfo["template_clone_other"];if($E("template_clone_pic")){if($E("template_clone_pic").parentNode.tagName.toLowerCase()=="a"){$E("template_clone_pic").parentNode.href=gwinfo["template_clone_link"];$E("template_clone_pic").parentNode.target="_blank"}}}var fmInfo=$_GLOBAL.famous_conf[scope["tpl"]];if(fmInfo&&fmInfo["template_clone_pic"].replace(/\s/g,"")!=""){$E("template_clone_pic").innerHTML=fmInfo["template_clone_pic"];$E("template_clone_link").innerHTML=fmInfo["template_clone_link"];$E("template_clone_other").innerHTML=fmInfo["template_clone_other"];if($E("template_clone_pic")){if($E("template_clone_pic").parentNode.tagName.toLowerCase()=="a"){$E("template_clone_pic").parentNode.href="http://ba.sass.sina.com.cn/front/tp/deliver?blogId="+scope.$uid+"&tp="+scope.tpl}}}}};if($_GLOBAL.cloneTemplateConfig){tmpCloneFuc()}else{Utils.Io.JsLoad.request("http://sjs.sinajs.cn/blog7common/conf/tmp_clone.js",{onComplete:function(){tmpCloneFuc()},noreturn:true,isRemove:false})}})});Lib.Tip=Core.Class.create();Lib.Tip.prototype={initialize:function(){}};$registJob("modify_tip",function(){scope.tip=new Lib.Tip($E("sinablogb"))});$registJob("moduleBind",function(){var link=$E("module_109_link");var img=$E("module_109_img");if(link){link.onclick=function(){$CloneComp(109);Utils.Io.JsLoad.request("http://sina.allyes.com/main/adfclick?db=sina&bid=181511,226697,231717&cid=0,0,0&sid=220693&advid=3406&camid=32667&show=ignore",{onComplete:function(){}})}}if(img){img.onclick=function(){$CloneComp(109);Utils.Io.JsLoad.request("http://sina.allyes.com/main/adfclick?db=sina&bid=181511,226697,231717&cid=0,0,0&sid=220693&advid=3406&camid=32667&show=ignore",{onComplete:function(){}})}}});Lib.deleteVisitByUid=function(sUid,sProductId,fCallBack,sSubId){Lib.checkAuthor();if(!$isLogin){var Login=new Lib.Login.Ui;Login.login(Core.Function.bind3(Lib.deleteWallByMsgid,null,arguments));return}Debug.log("删除访客："+sUid);var confirmMsg="";if($isAdmin){confirmMsg=$SYSMSG.A80203}else if($isLogin){confirmMsg=$SYSMSG.A80201}else{return true}winDialog.confirm(confirmMsg,{funcOk:function(){var i_deleteVisit=new Interface("http://footprint.cws.api.sina.com.cn/del.php","jsload");var param={pid:sProductId,uid:scope.$uid,deleteuid:sUid};if(sSubId!=null){param.subid=sSubId}if($E("comp_12_deleteToBlack")&&$E("comp_12_deleteToBlack").checked==true){param.inblack=1}i_deleteVisit.request({GET:param,onSuccess:function(){if(fCallBack){fCallBack(null,null,true)}else{Debug.log("Reload page");window.location.reload()}}})},subText:$isAdmin?$SYSMSG.A80204:$SYSMSG.A80202,textOk:"是",textCancel:"否",icon:"04"})};$ATTENTION_MSG={A00001:"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电4006900000。",A00002:"参数错误",A00003:"非法操作",A00004:"无权限进行此操作，请重新登录。",A00005:"输入敏感信息",A00006:"操作成功",A33005:"你不能添加自己为关注！",A33001:"对方已经被你加为关注了！<br/>请不要重复添加。",A33002:"对方拒绝了你的关注请求！",A33003:"关注已达上限300，不能再添加新的关注了！<br/>可以到<a target='_blank' href='#{url}'>我关注的人</a>去取消关注一些人，再回来关注吧。",A33004:"关注成功!",A33008:"取消关注失败<br/>请重试！",A33009:"加黑名单失败<br/>请重试！"};Core.Dom.next=function(elm,_className){var o=$E(elm);var next=o.nextSibling;if(!next)return null;else if(next.nodeType!=1){return Core.Dom.next(next,_className)}else if(next.nodeType==8){next.parentNode.removeChild(next);return Core.Dom.next(o,_className)}if(new RegExp("\\b"+_className+"\\b").test(next.className)){return next}else{return Core.Dom.next(next,_className)}};App.popFeedRecomm_toggleEx=function(me,num){var popFeedRecomm_feedsBox=$E("popFeedRecomm_feedsBox");var popFeedRecomm_moreFeeds=$E("popFeedRecomm_moreFeeds");if(!popFeedRecomm_feedsBox)return;var popFeedRecomm_nextPage=Core.Dom.next(popFeedRecomm_moreFeeds,"SG_page");var allFeeds=Core.Dom.byClz(popFeedRecomm_feedsBox,"div","feedList_cell");var batches=Math.ceil(allFeeds.length/num);if(App.curBatch>batches){App.curBatch=1}var curBatch_1st_id=num*(App.curBatch-1);var i;if(me.getAttribute("evolved")=="yes"){popFeedRecomm_nextPage.style.display="none";for(i=1;i<num;i++){if(allFeeds[curBatch_1st_id+i])allFeeds[curBatch_1st_id+i].parentNode.style.display="none"}me.setAttribute("evolved","no");me.className="center_cmdfeedarrow";me.setAttribute("title","展开");toAnchor("attentionfeed")}else{popFeedRecomm_nextPage.style.display="";for(i=1;i<num;i++){if(allFeeds[curBatch_1st_id+i])allFeeds[curBatch_1st_id+i].parentNode.style.display=""}me.setAttribute("evolved","yes");me.className="center_cmdfeedarrow center_cmdfeedarrowUp";me.setAttribute("title","收起")}function toAnchor(a){var href=window.location.href;href=href.replace(/#.*/,"");if(a.indexOf("#")>-1){href+=a}else{href+="#"+a}window.location.href=href}};App.resetCurBatch=function(){App.curBatch=1;App.nextBatch=2};App.curBatch=1;App.nextBatch=2;App.popFeedRecomm_otherRecomm=function(num){Lib.checkAuthor();if(!$isAdmin){(new Lib.Login.Ui).login(function(){location.reload()});return}var popFeedRecomm_feedsBox=$E("popFeedRecomm_feedsBox");animateScroll(popFeedRecomm_feedsBox.parentNode,changeDom);function changeDom(){var allFeeds=Core.Dom.byClz(popFeedRecomm_feedsBox,"div","feedList_cell");var len=allFeeds.length;var batches=Math.ceil(len/num);var i;if(len<num)return;if(App.curBatch>batches)App.curBatch=1;if(App.nextBatch>batches)App.nextBatch=1;for(i=0;i<num;i++){var curBatch_elemIdx=num*(App.curBatch-1)+i;var nextBatch_elemIdx=num*(App.nextBatch-1)+i;if(allFeeds[nextBatch_elemIdx])allFeeds[nextBatch_elemIdx].style.display="";if(allFeeds[curBatch_elemIdx])allFeeds[curBatch_elemIdx].style.display="none"}App.curBatch++;App.nextBatch++}function toAnchor(a){var href=window.location.href;href=href.replace(/#.*/,"");if(a.indexOf("#")>-1){href+=a}else{href+="#"+a}window.location.href=href}function animateScroll(matchDom,func){var matchClientY=matchDom.getBoundingClientRect().top;var curScrollTop=document.documentElement.scrollTop;var _tween;_tween=new Ui.TweenStrategy(document.documentElement.scrollTop,curScrollTop+matchClientY,.6,Ui.Transition.strongEaseInOut);_tween.onTween=function(val){document.documentElement.scrollTop=val};_tween.onEnd=func||function(){};_tween.start()}};(function(){var popFeedRecomm_expend=$E("popFeedRecomm_expend");var holeBox=$E("popFeedRecomm_feedsBox_parent");var noNeedFeedRecomm=Utils.Cookie.getCookie("noNeedFeedRecomm");if(noNeedFeedRecomm!="yes"){trace("is Need");if(holeBox)holeBox.style.display=""}else{trace("no Need");if(holeBox)holeBox.style.display="none"}if(!popFeedRecomm_expend)return;var allFeedCells=Core.Dom.byClz(popFeedRecomm_expend,"div","feedList_cell");var i;for(i=0;i<allFeedCells.length;i++){if(i==0)allFeedCells[i].style.cssText="position:absolute;";else allFeedCells[i].style.cssText="position:absolute; top:70px;"}})();App.popFeedRecomm_close=function(_id){winDialog.confirm("确认关闭名博动态推荐？",{subText:"<span style='color:#999;'>关闭后一周内将不再显示</span>",funcOk:function(){var toBeClosse=$E(_id);if(toBeClosse){toBeClosse.style.display="none"}Utils.Cookie.setCookie("noNeedFeedRecomm","yes",168,"/",".sina.com.cn")}})};App.isTween=false;App.popFeedRecomm_slideDown=function(){if(App.isTween){trace("isTween...");return false}App.isTween=true;var popFeedRecomm_expend=$E("popFeedRecomm_expend");var allFeedCells=Core.Dom.byClz(popFeedRecomm_expend,"div","feedList_cell");var step=allFeedCells[0].offsetHeight;var firstFrame=allFeedCells[0];var secondFrame=allFeedCells[1];var firstFrameTop=parseInt(Core.Dom.getStyle(firstFrame,"top"));if(isNaN(firstFrameTop)){firstFrame.style.top="0px"}Ui.tween(firstFrame,"top",-step,.4,"regularEaseIn",{end:function(){firstFrame.style.top=step+"px";popFeedRecomm_expend.appendChild(firstFrame);App.isTween=false}});Ui.tween(secondFrame,"top",parseInt(Core.Dom.getStyle(secondFrame,"top"))-step,.4,"regularEaseIn",{end:function(){}})};scope.Attention=Core.Class.create();scope.Attention.prototype={interfaceAddURL:"http://control.blog.sina.com.cn/riaapi/profile/attention_add.php",interfaceCancel:null,interfaceRemove:null,initialize:function(){this.interfaceCancel=new Interface("http://control.blog.sina.com.cn/riaapi/profile/attention_del.php","jsload");this.interfaceRemove=new Interface("http://control.blog.sina.com.cn/riaapi/profile/attention_move.php","jsload")},add:function(uid,aid,simpleMode,fCallback){var _this=this;new Interface(this.interfaceAddURL,"ijax").request({POST:{uid:uid,aid:aid},onComplete:function(data){Lib.checkAuthor();if(data.code=="A33004"){if(simpleMode){winDialog.alert("关注成功！",{width:300,icon:"03"});Core.Dom.removeNode($E("attention_"+aid));if(Core.String.trim($E("attention_list").innerHTML).replace(/"/g,"").toLowerCase()=="<div class=clearit></div>"){$E("attention_list").parentNode.innerHTML='<div class="SG_nodata">暂无推荐!</div>'}}else{winDialog.alert($ATTENTION_MSG[data.code],{width:300,icon:"03",subText:['<div class="CP_w_cnt SG_txtb">你将在关注动态页面接收到对方的新消息</div>','<ul class="CP_w_part CP_w_aLine">','<li><a href="javascript:void(0);" onclick="scope.pa_add.add(\''+aid+'\');winDialog.getDialog(\'attention\').close();">手机订阅此用户&gt;&gt;</a><img height="15" align="absmiddle" width="15" class="SG_icon SG_icon11" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" title="新"/></li>','<li><a href="http://profile.blog.sina.com.cn/attention_feed.php?uid='+$UID+'" onclick="winDialog.getDialog(\'attention\').close();">查看关注动态&gt;&gt;</a></li>','<li><a href="http://profile.blog.sina.com.cn/attention.php?uid='+$UID+'&type=0" onclick="winDialog.getDialog(\'attention\').close();">查看我关注的人&gt;&gt;</a></li>','<li><a href="http://profile.blog.sina.com.cn/attention.php?uid='+$UID+'&type=1" onclick="winDialog.getDialog(\'attention\').close();">查看谁在关注我&gt;&gt;</a></li>',"</ul>"].join(""),funcOk:function(){if(fCallback){fCallback()}else{window.location=window.location.toString().replace(/#.*/,"")}}},"attention")}}else{var errorMSG=$ATTENTION_MSG[data.code];if(data["code"=="A33003"]){errorMSG=$ATTENTION_MSG[data.code].replace(/#\{url\}/g,"http://profile.blog.sina.com.cn/attention.php?type=0&uid="+$UID)}winDialog.alert(errorMSG,{funcOk:_this.errorHandle,funcClose:_this.errorHandle,icon:"02"})}}})},cancel:function(uid,aid){var _this=this;this.interfaceCancel.request({GET:{uid:uid,aid:aid},onSuccess:function(data){window.location=window.location.toString().replace(/#.*/,"")},onError:function(data){winDialog.alert($ATTENTION_MSG[data.code],{funcOk:_this.errorHandle,funcClose:_this.errorHandle,icon:"02"})},onFail:function(){}})},remove:function(uid,aid,isBlack){var _this=this;this.interfaceRemove.request({GET:{uid:uid,aid:aid,isblack:isBlack},onSuccess:function(data){window.location=window.location.toString().replace(/#.*/,"")},onError:function(data){winDialog.alert($ATTENTION_MSG[data.code],{funcOk:_this.errorHandle,funcClose:_this.errorHandle,icon:"02"})},onFail:function(){}})},errorHandle:function(){}};if(!App.curTab)App.curTab=0;App.popBlogRecomm_toTabs=function(toIdx,curDom){var tabsBox=$E("popBlogRecomm_tabsBox");var pagesBox=$E("popBlogRecomm_pagesBox");var tabs=$T(tabsBox,"li");var pages=$T(pagesBox,"ul");if(toIdx==App.curTab)return;if(!$T(curDom,"a")[0])return;seal_A($T(curDom,"a")[0]);release_A($T(tabs[App.curTab],"a")[0]);curDom.className="borderc current";tabs[App.curTab].className="borderc";pages[toIdx].style.display="";pages[App.curTab].style.display="none";App.curTab=toIdx;function seal_A(sDom){sDom.removeAttribute("href");sDom.style.textDecoration="none";sDom.blur()}function release_A(rDom){rDom.setAttribute("href","javascript:return false;");rDom.style.textDecoration="underline"}};App.popBlogRecomm_addAttention=function(uid,node){$T(node,"a")[0].blur();new Interface("http://control.blog.sina.com.cn/riaapi/profile/attention_add.php","ijax").request({POST:{uid:scope.$uid,aid:uid},onSuccess:function(data){},onError:function(err){var SUCC_MSG="已关注";var hrefNode=$T(node,"a")[0];var txtNode=$T(node,"cite")[0];switch(err.code){case"A33004":case"A33001":txtNode.innerHTML=SUCC_MSG;hrefNode.style.cssText+="; cursor:text; color:#999;";txtNode.style.cssText+="; cursor:text !important; text-decoration:none;";node.onclick=function(){return false};break;default:winDialog.alert($ATTENTION_MSG[err["code"]]);break}}});function updateAttButton(oParam){oParam.fontSize=oParam.fontSize||"12px";oParam.color=oParam.color||"#5f9b00";var top=Core.Dom.getTop(oParam.txtNode);var left=Core.Dom.getLeft(oParam.txtNode);var colorTxtNode=$C("p");colorTxtNode.innerHTML=oParam.text;colorTxtNode.style.cssText+="; position:absolute; font-size:"+oParam.fontSize+"; color:"+oParam.color+"; left:"+left+"px; top:"+top+"px;";oParam.txtNode.innerHTML=oParam.text;Core.Dom.setStyle(oParam.txtNode,"opacity",0);document.body.appendChild(colorTxtNode);Ui.tween(oParam.txtNode,"opacity",1,1,"regularEaseIn");Ui.tween(colorTxtNode,"opacity",0,1,"regularEaseIn",{end:function(){document.body.removeChild(colorTxtNode)}})}};App.popBlogRecomm_addAttention=function(aid,node){var SUCC_MSG="已关注";var hrefNode=$T(node,"a")[0];var txtNode=$T(node,"cite")[0];var attObj=new scope.Attention;Lib.checkAuthor();if(!$isAdmin){(new Lib.Login.Ui).login(function(){location.reload()});return}attObj.add(scope.$uid,aid,false,function(){txtNode.innerHTML=SUCC_MSG;hrefNode.style.cssText+="; cursor:text; color:#999;";txtNode.style.cssText+="; cursor:text !important; text-decoration:none;";node.onclick=function(){return false}})};App.popBlogRecomm_pagination=function(_class,_type,_page,_id){var mod=_id.split("_")[1];new Interface("http://control.blog.sina.com.cn/riaapi/feed/feed_class.php?version=7","jsload").request({GET:{"class":_class,type:_type,page:_page,file:mod},onSuccess:function(res){var feedPartDom=$E(_id);if(!feedPartDom)return;feedPartDom.innerHTML=res.html;toAnchor(_id);function toAnchor(a){var href=window.location.href;href=href.replace(/#.*/,"");if(a.indexOf("#")>-1){href+=a}else{href+="#"+a}window.location.href=href}},onError:function(res){winDialog.alert($SYSMSG[res.code])}})};$registJob("dynaRecomm",function(){});if(typeof Lib.flashComponent=="undefined"){Lib.flashComponent={}}Lib.FlashDetector=function(ver){this.version=ver}.$define({version:"",detect:function(){var nav=window.navigator,i,l,isFlashed,clientVersion="0.0.0";if(nav.plugins&&nav.plugins.length){for(i=0,l=nav.plugins.length;i<l;i++){if(nav.plugins[i].name.toLowerCase().indexOf("shockwave flash")!=-1){clientVersion=nav.plugins[i].description.toLowerCase().replace(/shockwave flash\s?/,"").split(" ")[0];isFlashed=true;break}}}else if(window.ActiveXObject){for(i=11;i>=1;i--){try{if(new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+i)){clientVersion=i+".0";isFlashed=true;break}}catch(ex){}}}if(isFlashed){this._detectVersion(clientVersion)}else{this.onUninstalled&&this.onUninstalled.call(this)}},_detectVersion:function(clientVersion){var cvs=this._getFormatVersion(clientVersion).split("."),vs=this._getFormatVersion(this.version).split("."),i,l=vs.length;for(i=0;i<l;i++){if(+cvs[i]>+vs[i]){this.onSuccess&&this.onSuccess.call(this);return}else{if(+cvs[i]<+vs[i]){this.onVersionLower&&this.onVersionLower.call(this,clientVersion);return}}}this.onSuccess&&this.onSuccess.call(this)},_getFormatVersion:function(ver){var v=ver+"";v.indexOf(".")==-1&&(v+=".0.0");v.split(".").length<3&&(v+=".0");return v},onVersionLower:function(clientVersion){},onUninstalled:function(){},onSuccess:function(){}});Lib.flashComponent.FlashContianer=function(cfg){this._initCfg(cfg);this._flashDetector=new Lib.FlashDetector(this.flashCfg.version);this._detect()}.$define({flashCfg:{url:"",width:0,height:0,containerID:"divContainer",flashID:"flashID",flashVar:"",version:"9",wmode:"transparent",allowScriptAccess:"always"},rerender:function(){this._initFlash()},_renderText:["#{reason}，为了能够正常显示，请您 ",'<a target="_blank" href="http://get.adobe.com/cn/flashplayer/">','<img src="http://simg.sinajs.cn/blog7style/images/common/baby/flash.png">',"下载最新版本","</a>","。"].join(""),_flash:null,_falshEntity:null,_flashDetector:null,_initFlash:function(){this._addFlash();this._initFlashEntity()},_detect:function(){var fd=this._flashDetector,me=this;fd.onSuccess=function(){me._initFlash()};fd.onUninstalled=function(){me._renderUninstalled()};fd.onVersionLower=function(clientVersion){me._renderVersionLower()};fd.detect()},_renderVersionLower:function(){$E(this.flashCfg.containerID).innerHTML=this._renderText.replace(/\#\{reason\}/g,"您的Flash播放器版本过低")},_renderUninstalled:function(){$E(this.flashCfg.containerID).innerHTML=this._renderText.replace(/\#\{reason\}/g,"您的浏览器未安装Flash播放器")},_initCfg:function(cfg){var k;for(k in this.flashCfg){typeof cfg[k]!="undefined"&&(this.flashCfg[k]=cfg[k])}},_addFlash:function(){var fc=this.flashCfg,me=this;this._flash=new Utils.Flash.swfObject(fc.url,fc.flashID,fc.width,fc.height,fc.version,"#ffffff");this._flash.addParam("allowScriptAccess",fc.allowScriptAccess);this._flash.addParam("wmode",fc.wmode);this._flash.addParam("flashVars",fc.flashVar);this._flash.write(fc.containerID)},_initFlashEntity:function(){this._flashEntity=$IE?window[this.flashCfg.flashID]:document[this.flashCfg.flashID]}});Lib.flashComponent.HeadPhoto=function(cfg){}.$extends(Lib.flashComponent.FlashContianer).$define({setMaskPosition:function(x,y){x=isNaN(x)?0:x;y=isNaN(y)?0:y;this._flashEntity.setMaskPosition&&this._flashEntity.setMaskPosition(x,y)},setPhotoURL:function(url){this._flashEntity.setPhotoURL&&this._flashEntity.setPhotoURL(url)},getPhotoURL:function(url){if(this._flashEntity.getPhotoURL){return this._flashEntity.getPhotoURL()}},setPhotoPosition:function(x,y){x=isNaN(x)?0:x;y=isNaN(y)?0:y;this._flashEntity.setPhotoPosition&&this._flashEntity.setPhotoPosition(x,y)},setPhotoZoom:function(zoom){zoom=isNaN(zoom)?1:zoom;this._flashEntity.setPhotoZoom&&this._flashEntity.setPhotoZoom(zoom)},setPhotoAngle:function(angle){angle=isNaN(angle)?0:angle;this._flashEntity.setPhotoAngle&&this._flashEntity.setPhotoAngle(angle)}});Lib.flashComponent.HeadPhotoEditorConfig={t3_34:{middlePointX:350,middlePointY:100,maskX:108,maskY:0,maskURL:"http://simg.sinajs.cn/blog7swf/baby/mask3_34.swf",frameURL:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/frame3_34.png",defaultPhoto:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/babyPhoto.png"},t3_35:{middlePointX:200,middlePointY:100,maskX:6,maskY:0,maskURL:"http://simg.sinajs.cn/blog7swf/baby/mask3_35.swf",frameURL:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/frame3_35.png",defaultPhoto:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/babyPhoto.png"},t3_36:{middlePointX:300,middlePointY:120,maskX:131,maskY:23,maskURL:"http://simg.sinajs.cn/blog7swf/baby/mask3_36.swf",frameURL:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/frame3_36.png",defaultPhoto:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/babyPhoto.png"},t3_37:{middlePointX:230,middlePointY:100,maskX:71,maskY:0,maskURL:"http://simg.sinajs.cn/blog7swf/baby/mask3_37.swf",frameURL:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/frame3_37.png",defaultPhoto:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/babyPhoto.png"}};$registJob("baby_headPhoto",function(){var cfg=Lib.flashComponent.HeadPhotoEditorConfig["t"+scope.tpl]||Lib.flashComponent.HeadPhotoEditorConfig["t3_34"],headPhotoInfo=scope.UserBabyPic||{},headFlash=$E("headflash"),babyTpls=scope.babyTpl_conf||["3_34","3_35","3_36","3_37"],isShowHead=false;for(var i=0,l=babyTpls.length;i<l;i++){if(babyTpls[i]==scope.tpl){isShowHead=true;break}}if(!headFlash||!isShowHead){return}headFlash.style.display="";scope.headPhoto=new Lib.flashComponent.HeadPhoto({url:$_GLOBAL.flashBasicURL+"baby/headPhoto.swf",width:540,height:285,containerID:"headflash",flashID:"flashHeadPhoto",flashVar:["maskURL=",cfg.maskURL,"&maskX=",cfg.maskX,"&maskY=",cfg.maskY,"&middlePointX=",cfg.middlePointX,"&middlePointY=",cfg.middlePointY,"&photoURL=",headPhotoInfo.photoURL||cfg.defaultPhoto,"&photoX=",headPhotoInfo.photoX||0,"&photoY=",headPhotoInfo.photoY||0,"&photoZoom=",headPhotoInfo.zoom||1,"&photoAngle=",headPhotoInfo.angle||0].join("")
})});Utils.insertTemplate=function(el,template,where){var ids=[],nodes={},idreg=/#{(\w+)}/g,rndNum="_"+(new Date).getTime().toString().slice(-5)+Math.floor(Math.random()*1e5);template=template.replace(idreg,function(match,id){ids.push(id);return id+rndNum});Core.Dom.insertHTML(el,template,where);for(var i=ids.length,id;i--;){id=ids[i];nodes[id]=$E(id+rndNum)}return nodes};Utils.Cookie.deleteCookie=function(name){document.cookie=name+"=;"+"expires=Fri, 31 Dec 1999 23:59:59 GMT;"};(function(){var toStyleAttribute=function(styleName){var arr=styleName.split("-");var cc=arr[0];for(var i=1;i<arr.length;i++){cc+=arr[i].charAt(0).toUpperCase()+arr[i].substring(1)}return cc};Core.Dom.setStyle2=function(elem,style){if(typeof elem=="string"){elem=$E(elem)}for(var name in style){styleAttr=toStyleAttribute(name);Core.Dom.setStyle(elem,styleAttr,style[name])}}})();Core.Array.uniq=function(ar){var result=[],x;for(var i=0;i<ar.length;i++){x=ar[i];if(Core.Array.findit(result,x)==-1){result.push(x)}}return result};$registJob("profileUserGuide",function(){var __getCookie=Utils.Cookie.getCookie,__setCookie=Utils.Cookie.setCookie,__addEvent=Core.Events.addEvent,url,cver=scope.$uid,getCook=__getCookie("ugv2s_fzp"),isAtten=window.location.href.indexOf("atten=1")>-1;var nickCookie=__getCookie("nickGuild");var template={startRelate:'<div class="l_guide" id="#{relateGuide}" style="z-index:20000;" >'+'<div class="guide_nav">'+'<ul id="labelList">'+'<li class="label"><a href="javascript:void(0);"></a></li>'+'<li class="label"><a href="javascript:void(0);"></a></li>'+'<li class="label"><a href="javascript:void(0);"></a></li>'+'<li class="label"><a href="javascript:void(0);"></a></li>'+'<li class="label"><a href="javascript:void(0);"></a></li>'+'<li class="label"><a href="javascript:void(0);"></a></li>'+'<li class="label"><a href="javascript:void(0);"></a></li>'+'<li class="label"><a href="javascript:void(0);"></a></li>'+'<li class="label"><a href="javascript:void(0);"></a></li>'+'<li class="label"><a href="javascript:void(0);"></a></li>'+'<li class="label"><a href="javascript:void(0);"></a></li>'+"</ul>"+"</div>"+'<div class="gd_cnt">'+'<div class="hd">'+'<a title="关闭" class="CP_w_shut" href="javascript:void(0);" id="#{close}">关闭</a>'+'<h3 id="#{nick}"></h3>'+'<p class="wlcm">你好，欢迎来到新浪博客！告诉我们你的爱好，我们将根据你的爱好为你推荐优质博主</p>'+"</div>"+'<div class="user_lst" id="#{userList}">'+"</div>"+'<div class="ft">'+'<div class="select_all"><input type="checkbox" id="#{selectAll}"/><label for="">关注全部</label></div>'+'<div class="opt"><a href="#" id="#{noSelect}">不，谢谢</a><a href="#" class="btn_complete" id="#{doneRelate}">完成</a></div>'+"</div>"+"</div>"+"</div>",guildNick:'<div id="#{nickGuild}" class="guide_nctx" style="left:300px; top:20px;"><a id="#{close}" href="javascript:void(0)" class="close" title="关闭"></a><a id="#{modifyBtn}" href="javascript:;" class="btn" title="马上修改"></a></div>'};var timer=setInterval(nicks,300);function nicks(){if(scope.nickname){try{_layer.nick.innerHTML=scope.nickname;clearInterval(timer)}catch(e){}}}if(getCook&&getCook===cver||!isAtten){if(nickCookie!="done"&&isAtten){window.setTimeout(function(){renderNickGuild()},500);return}else{return}}var option={css:{"z-index":"5002",position:$IE6?"absolute":"fixed",top:"50%",left:"50%"},mid:{"z-index":"5002",position:$IE6?"absolute":"fixed",left:"50%"}};var screenW=screen.width,screenH=screen.height;if(isAtten){initRelate()}Utils.Io.loadExternalCSS("http://simg.sinajs.cn/blog7style/css/module/layer/layer21.css");var mask,_layer,_guide,_userStruc,_default,diffUser=[],idx;var _layer_nick;function initRelate(){mask=new BackShadow(.4);mask.show();_layer=Utils.insertTemplate(document.body,template.startRelate,"BeforeEnd");_layer.userList.innerHTML=['<div id="loading" style="text-align:center;padding-top:200px; height:400px">','<img src="http://simg.sinajs.cn/blog7style/images/common/loading.gif">加载中…',"</div>"].join("");if(screenW<882||screenH<600){_layer.relateGuide.style.position="absolute";_layer.relateGuide.style.top="0px";_layer.relateGuide.style.left="0px"}else{if($IE6){Core.Events.addEvent(window,function(){_layer.relateGuide&&setPos(_layer.relateGuide)},"scroll")}setTimeout(function(){setPos(_layer.relateGuide)},200)}url="http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/userguide/userGuideData.php";Utils.Io.Ijax.request(url,{onComplete:function(result){var result=Core.String.j2o(result);if(result&&result.code==="A00006"){var labList=Core.Dom.byClz(_layer.labelList,"li","label");var tags=[],tagId=[];for(i in result.data){tags.push(result.data[i].tag);tagId.push(result.data[i].tag_id)}for(var i=0;i<labList.length;i++){labList[i].children[0].innerHTML=tags[i];labList[i].children[0].setAttribute("tag_id",tagId[i])}var struc="";for(i in result.data){var diffId=i;diffUser.push(diffId);var renderUser=result.data[i].users;for(i in renderUser){var detail=renderUser[i];if(detail.resume===null){detail.resume=""}struc+='<div class="user_item" style="display:none;" diffuser="'+diffId+'">'+'<div class="thumb"><img src="'+detail.imgurl+'" width="110px" height="110px" title="'+detail.nickname+'"/><span class="hvbtn addcan" userId="'+i+'">加关注</span></div>'+'<dl class="detail" id="#{detail}">'+'<dt class="name" title="'+detail.nickname+'">'+detail.nickname.substring(0,5)+"</dt>"+"<dd>访问 "+detail.pv+"</dd>"+"<dd>关注 "+detail.attention+"</dd>"+'<dd class="outline">'+detail.resume+"</dd>"+"</dl>"+"</div>"}}_userStruc=Utils.insertTemplate(_layer.userList,struc,"AfterBegin");idx=parseInt(10*Math.random());_default=Core.Dom.byClz(_layer.userList,"div","user_item");for(var i=0;i<_default.length;i++){if(_default[i].getAttribute("diffuser")===diffUser[idx]){_default[i].style.display="";labList[idx].children[0].className="cur"}}if($E("loading")){var load=$E("loading");Core.Dom.removeNode(load)}initRelateEvent()}else if(result&&result.code==="A00001"){_layer.relateGuide.style.display="none";mask.close()}else if(result&&result.code==="A00007"){window.location.href="http://blog.sina.com.cn"}},returnType:"json",POST:{type:1}})}function initRelateEvent(){var userList=Core.Dom.byClz(_layer.userList,"div","thumb");var labelList=Core.Dom.byClz(_layer.labelList,"li","label");__addEvent(_layer.doneRelate,function(){var followArr=Core.Dom.byClz(_layer.userList,"span","hvbtn addyet");if(followArr.length!==0){var ids=[],tagid=[];for(var i=0;i<followArr.length;i++){ids.push(followArr[i].getAttribute("userid"));tagid.push(followArr[i].parentNode.parentNode.getAttribute("diffuser"))}tagid=Core.Array.uniq(tagid);var str_ids=ids.join(",");var tagids=tagid.join(",");var urlAtten="http://control.blog.sina.com.cn/riaapi/reg/attention_add_batch.php?"+Math.random();Utils.Io.Ijax.request(url,{POST:{type:3,tagid:tagids},onComplete:function(result){var result=Core.String.j2o(result);if(result&&result.code==="A00006"){Utils.Io.Ijax.request(urlAtten,{POST:{uid:scope.$uid,aids:str_ids},onComplete:function(result){var result=Core.String.j2o(result);var address=window.location.href;if(result&&result.code==="A00006"){_layer.relateGuide.style.display="none";mask.close();__setCookie("ugv2s_fzp",scope.$uid,10*365*24,"/",".blog.sina.com.cn");window.location.href=address.replace(/#/g,"")}else{_layer.relateGuide.style.display="none";__setCookie("ugv2s_fzp",scope.$uid,10*365*24,"/",".blog.sina.com.cn");mask.close();window.location.href=address.replace(/#/g,"")}},onException:function(){window.location.href=window.location.href.replace(/#/g,"")}})}}})}else{closeRequest()}});__addEvent(_layer.close,function(){closeRequest()});__addEvent(_layer.selectAll,function(){if(!_layer.selectAll.checked){for(var i=0;i<userList.length;i++){if(userList[i].parentNode.style.display===""){userList[i].children[1].className="hvbtn addcan"}}}else{for(var i=0;i<userList.length;i++){if(userList[i].parentNode.style.display===""){userList[i].children[1].className="hvbtn addyet"}}}});__addEvent(_layer.noSelect,function(){closeRequest()});for(var i=0;i<userList.length;i++){__addEvent(userList[i].children[1],function(e){var evn=Core.Events.getEvent(e);var ele=Core.Events.getEventTarget(evn);if(ele.className==="hvbtn addyet"){ele.className="hvbtn addcan"}else{ele.className="hvbtn addyet"}})}var isClicked;for(var i=0;i<labelList.length;i++){__addEvent(labelList[i].children[0],function(e){_layer.userList.scrollTop="0px";var evn=Core.Events.getEvent(e);var ele=Core.Events.getEventTarget(evn);labelList[idx].children[0].className="";ele.parentNode.parentNode.children[0].children[0].className="";if(isClicked&&isClicked.className==="cur"){isClicked.className=""}ele.className="cur";isClicked=ele;var tagId=ele.getAttribute("tag_id");for(var i=0;i<diffUser.length;i++){if(tagId===diffUser[i]){for(var i=0;i<_default.length;i++){_default[i].style.display="none";if(_default[i].getAttribute("diffuser")===tagId){_default[i].style.display=""}}}}_layer.selectAll.checked=false})}}function renderNickGuild(){var nickel=Core.Dom.byClass("ntopbar_menu","div",document.body);var leftpx=parseInt(Core.Dom.getLeft(nickel[0]));var nickwidth=parseInt(nickel[0].children[0].children[0].children[0].offsetWidth);if(!mask){mask=new BackShadow(.4);mask.show()}_layer_nick=Utils.insertTemplate(document.body,template.guildNick,"BeforeEnd");_layer_nick.nickGuild.style.left=leftpx+nickwidth/2+"px";initNickGuildEvent()}function initNickGuildEvent(){__addEvent(_layer_nick.close,function(){__setCookie("nickGuild","done",10*365*24,"/",".blog.sina.com.cn");_layer_nick.nickGuild.style.display="none";mask.close()});__addEvent(_layer_nick.modifyBtn,function(e){var ev=window.event||e;if(ev.preventDefault){ev.preventDefault()}else{ev.returnValue=false}__setCookie("nickGuild","done",10*365*24,"/",".blog.sina.com.cn");window.location.href="http://control.blog.sina.com.cn/blogprofile/nick.php"})}function closeRequest(){Utils.Io.Ijax.request(url,{onComplete:function(result){var result=Core.String.j2o(result);if(result&&result.code==="A00006"){_layer.relateGuide.style.display="none";__setCookie("ugv2s_fzp",scope.$uid,10*365*24,"/",".blog.sina.com.cn");renderNickGuild()}},returnType:"json",POST:{type:2}})}function setPos(obj){var w=882,h=547;obj.style.marginLeft=w/2*-1+"px";if($IE6){obj.style.top=document.documentElement.scrollTop+parseInt(Math.abs((document.documentElement.offsetHeight-h)/2),10);delete option.css.top}else{obj.style.marginTop=h/2*-1+"px"}Core.Dom.setStyle2(obj,option.css)}function setMiddle(obj){var w=952;obj.style.marginLeft=w/2*-1+"px";Core.Dom.setStyle2(obj,option.mid)}});$registJob("delAttentionTags",function(){window.delAttentionTags=function(el,tagid){var tagId=tagid;winDialog.confirm("确定要取消此关注标签吗?",{subText:"",funcOk:function(){var url="http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/attentags/userDelTag.php";Utils.Io.Ijax.request(url,{onComplete:function(result){var result=Core.String.j2o(result);if(result&&result.code==="A00006"){if(scope.$pageid=="profile_tags"){var tag=el.parentNode.tagName.toLowerCase();if(tag==="p"){window.location=window.location.toString().replace(/#.*/,"")}else{var li=el.parentNode.parentNode.parentNode.parentNode;Core.Dom.removeNode(li)}}else{var li=el.parentNode.parentNode.parentNode.parentNode;Core.Dom.removeNode(li)}}else{showError(result.code)}},returnType:"json",POST:{tagid:tagId}})}})}});Core.Dom.findNode=function(element,direction,start){for(var node=element[start];node;node=node[direction]){if(node.nodeType==1){return node}}return null};Core.Dom.nextNode=function(srcEl){return Core.Dom.findNode(srcEl,"nextSibling","nextSibling")};Lib.templateUtils=function(){};Lib.templateUtils.prototype.getTemplateNodes=function(template){var box=document.createElement("div");var nodes={};var ids_without_rndNum=[];var rndNum=(new Date).getTime().toString().slice(-5)+Math.floor(Math.random()*1e5);var testReg=/#{([a-z0-9_]+)}/gi;template=template.replace(testReg,function(match,f1){ids_without_rndNum.push(f1);return f1+"_"+rndNum});box.innerHTML=template;var i;var len=ids_without_rndNum.length;var key;for(i=0;i<len;i++){key=ids_without_rndNum[i];nodes[key]=this.findById(key+"_"+rndNum,box)}return nodes};Lib.templateUtils.prototype.getIdNodes=function(template){var i,j,len,tagsLen,idName,idNode;var nodes={};var ids=[];var idTags=[];var tags=[];var box=document.createElement("div");box.innerHTML=template;tags=box.getElementsByTagName("*");template.replace(/id *= *"([^{ ]+?)"/gi,function(match,f1){ids[ids.length]=f1});len=tags.length;for(i=0;i<len;i++){if(tags[i].id)idTags[idTags.length]=tags[i]}len=ids.length;for(i=0;i<len;i++){idName=ids[i];j=0;tagsLen=idTags.length;while(j<tagsLen){idNode=idTags[j];if(idName==idNode.id){nodes[idName]=idNode;idTags.splice(j,1)}j++}}return nodes};Lib.templateUtils.prototype.findById=function(id,context,tag){var i;var context=context||document;var tags=context.getElementsByTagName(tag||"*");var len=tags.length;for(i=0;i<len;i++){if(tags[i].getAttribute("id")==id){return tags[i]}}};Lib.templateUtils.prototype.formatTemplate=function(curStr,oParam){var curStr;var formatReg=new RegExp("#{([a-z0-9]+)}","ig");curStr=curStr.replace(formatReg,function(match,f1,index,srcStr){return oParam[f1]});return curStr};(function(){Function.prototype.$defineProto=function(def){var k;for(k in def){this.prototype[k]=def[k]}if(this.__interface__){for(k in this.prototype){if(this.prototype[k]==="NI"){throw new Error("类定义错误，接口方法["+k+"]未实现")}}}this.prototype.constructor=this;this.$extendClass=this.$defineProto=this.$implements=function(){throw new Error("$defineProto 语句定义后面不能再作其它定义")};return this};Function.prototype.$extendClass=function(){var me=this;var i=arguments.length;var sup;var fn;if(i===0){throw new Error("$extendClass 语句错误：未指定父类")}sup=arguments[0];fn=function(){var _this=this;this.$super={};for(var fName in sup.prototype){if(!sup.prototype[fName])continue;this.$super[fName]=function(f){return function(){sup.prototype[f].apply(_this,arguments)}}(fName)}sup.apply(this,arguments);me.apply(this,arguments)};fn.prototype=object(sup.prototype);fn.prototype.constructor=fn;return fn};Function.prototype.$implements=function(){var arg=Array.prototype.slice.call(arguments,0);var fn;var i=arg.length;var k;while(i--){if(typeof arg[i]!=="object"){throw new Error("$implements 语句错误：参数必须为 object 类型")}for(k in arg[i]){typeof this.prototype[k]==="undefined"&&(this.prototype[k]="NI")}}this.__interface__=true;this.$extendClass=function(){throw new Error("$extendClass 语句错误：$extendClass 语句不能出现在 $implements 定义之后")};return this};Function.prototype.$mixProto=function(){this.$extendClass=this.$defineProto=function(){throw new Error("$mixProto 必须放在最后使用")};var srcCls=arguments[0];var srcClsProto=srcCls.prototype;for(var fn in srcClsProto){if(this[fn])throw new Error("目标类有同名方法");if(!srcClsProto[fn])continue;this.prototype[fn]=srcClsProto[fn]}return this};function object(o){function F(){}F.prototype=o;return new F}})();var blogAd={};blogAd.getInitPermission=function(oParam){var __root;if(oParam&&oParam.ads&&oParam.ads[0]){__root=oParam&&oParam.ads&&oParam.ads[0];return __root.type=="mixed"||__root.ref}else{return false}};blogAd.shareToWeibo=function(oParam){var url=new Utils.Url("http://v.t.sina.com.cn/share/share.php"),encode=encodeURIComponent;if(oParam.clickCode){(new Image).src=oParam.clickCode}for(var p in oParam){if(oParam.hasOwnProperty(p)){url.setParam(p,encode(oParam[p]))}}if(!oParam.title){url.setParam("title",encode(oParam.title||document.title))}url.setParam("content","utf-8");var openWnd=function(){url=url.toString();if(!window.open(url,"mb",["toolbar=0,status=0,resizable=1,width=440,height=430,left=",(screen.width-440)/2,",top=",(screen.height-430)/2].join("")))location.href=url};if(/Firefox/.test(navigator.userAgent)){setTimeout(openWnd,0)}else{openWnd()}};function commonLog(url){var image=window.clog_img=new Image;image.onload=image.onerror=function(){window.clog_img=null};image.src=url+(url.indexOf("?")>0?"&__rnd=":"?")+Math.random();image=null}blogAd.nickTrayAd=function(oParam,relativeNode){relativeNode.innerHTML=oParam["adLink"];var __this=this,__template=['<div id="#{entity}" class="tips_layer1 tips_bg_a" style="z-index:150;position:absolute;top:23px;left:0px;display:none;">','<div id="#{body}" class="tips_bd">','<a id="#{imageLink}" href="" class="link" title="" target="_blank"></a>','<div class="tips_detail"> <span id="#{closeBtn}" class="close" title="关闭">×</span>','<p id="#{userNick}" class="tips_nickname"></p>','<p id="#{tipsTitle}" class="tips_txt"></p>','<p id="#{tipsTxtLink}" class="tips_ad"></p>','<p id="#{tipsBtn}" class="tips_btn"></p>',"</div>","</div>","</div>"].join("");this.relativeNodeId=relativeNode.id;this.MARK_ID=1;this.LIMITED=24;var nodes=this.nodes=this.getTemplateNodes(__template);Core.Dom.insertAfter(nodes.entity,document.body.lastChild);if($IE6&&oParam.ie6BackgroundPic){nodes.entity.style.backgroundImage="url("+oParam.ie6BackgroundPic+")"}else if(oParam.backgroundPic){try{nodes.entity.style.backgroundImage="url("+oParam.backgroundPic+")"}catch(e){}}nodes.imageLink.href=oParam.imageLinkHref;var nick=typeof $nick;if("undefined"==nick){nick="亲爱的网友"}else{nick=$nick}nodes.userNick.innerHTML="HI，"+nick.replace(/</g,"&lt;");nodes.tipsTitle.innerHTML=oParam.tipsTitle;if(oParam.tipsTxtLink){nodes.tipsTxtLink.innerHTML=oParam.tipsTxtLink}var link=nodes.tipsTxtLink.children[0],linkStyle=link.style;if(!$IE6&&oParam.tipsTxtLinkBgPic){linkStyle.backgroundImage="url("+oParam.tipsTxtLinkBgPic+")";linkStyle.backgroundRepeat="no-repeat"}else if($IE6&&oParam.ie6TipsTxtLinkBgPic){linkStyle.backgroundImage="url("+oParam.ie6TipsTxtLinkBgPic+")";linkStyle.backgroundRepeat="no-repeat"}nodes.tipsBtn.innerHTML=oParam.tipsBtn;Core.Events.addEvent(nodes.closeBtn,function(){__this.hide();scope.$channel=null;var closeLog=oParam.status.adclose;if(closeLog){(new Image).src=closeLog}},"click");setTimeout(function(){__this.setPos();__this.show();__this.initResizeEvent()},15);var adclose=oParam.status&&oParam.status.adclose;Core.Events.addEvent(nodes.entity,function(e){var target=e.target||e.srcElement,entity=nodes.entity;do{if("A"===target.nodeName.toUpperCase()&&-1!=target.href.indexOf("http")){__this.hide();scope.$channel=null;var closeLog=oParam.status.adclose;if(closeLog){(new Image).src=closeLog}break}}while(target&&target==entity)},"click");if(oParam.status.adstart){(new Image).src=oParam.status.adstart}if(!oParam.blogTip){commonLog("http://1090.adsina.allyes.com/main/adfshow?user=AFP6_for_SINA|2012_add|2012_blog_tip&db=sina&border=0&local=yes&js=ie")}else{v7sendLog(oParam.logCode)}}.$defineProto({setMark:function(){var hours=(new Date).getHours();var nextShowHours=24-hours;Utils.Cookie.setCookie("blogTipsAd",1,nextShowHours,"/",".blog.sina.com.cn")},setPos:function(){var relativeNode=$E(this.relativeNodeId);var xy=Core.Dom.getXY(relativeNode);var linkWidth=relativeNode.offsetWidth,nodeStyle=this.nodes.entity.style;nodeStyle.left=parseInt(xy[0])+(linkWidth-100)+"px";nodeStyle.top=parseInt(xy[1])+23+"px"},show:function(){this.isHidden=false;var tipsEl=this.nodes.entity,_setStyle=Core.Dom.setStyle;var tween=new Ui.TweenStrategy(0,1,.5,function(t,b,c,d){return-c*(t/=d)*(t-2)+b});tween.onTween=function(val){_setStyle(tipsEl,"opacity",val)};tween.onEnd=function(){if(!$IE){_setStyle(tipsEl,"opacity","none")}else{tipsEl.style.filter="none"}};_setStyle(tipsEl,"opacity",0);tipsEl.style.display="block";tween.start()},hide:function(){this.setMark();this.isHidden=true;var tipsEl=this.nodes.entity,_setStyle=Core.Dom.setStyle;var tween=new Ui.TweenStrategy(1,0,.5,function(t,b,c,d){return-c*(t/=d)*(t-2)+b});tween.onTween=function(val){_setStyle(tipsEl,"opacity",val)};tween.onEnd=function(){if(!$IE){_setStyle(tipsEl,"opacity","none")}else{tipsEl.style.filter="none"}tipsEl.style.display="none"};tween.start()},initResizeEvent:function(){var me=this;Core.Events.addEvent(window,function(){if(!me.isHidden){me.setPos()}},"resize")}}).$mixProto(Lib.templateUtils);blogAd.loadNickTrayAd=function(data){var listener=Lib.Listener;var actBtn=$E("loginBarActivity")||$E("divPopularize");var isShow=actBtn.getAttribute("shouldShow"),day=(new Date).getDay(),isClosed=Utils.Cookie.getCookie("blogTipsAd");actBtn.style.display="";var isShowTime=day==1||day==3||day==5;if(!isShowTime){return}if(isClosed){return}var cssUrl="http://simg.sinajs.cn/blog7style/css/module/layer/layer20.css";Utils.Io.loadExternalCSS(cssUrl,function(){if(data){if(!data||!data["isShow"]){return}if(data.logCode){data.logCode=data.logCode+"|"+$UID}blogAd.trayAdHandle=new blogAd.nickTrayAd(data,actBtn);actBtn=null}})};Lib.register("util.loadScript",function(){var TRUE=!0,FALSE=!1,cache={};var loadScript=function(url,item){Utils.Io.JsLoad.request(url,{isRemove:FALSE,noreturn:TRUE,onComplete:function(data){cache[url].isLoading=FALSE;var cb=cache[url].cb;for(var i=0,len=cb.length;i<len;i++){cb[i](data)}cache[url].cb=null}})};return function(url,fun){var item=cache[url];var cb=item&&item["cb"];if(!item){cb=[fun];item={isLoading:TRUE,cb:cb};cache[url]=item;loadScript(url,item)}else if(item.isLoading){cb.push(fun)}else{fun()}}});Lib.register("execZhitou",function(lib){var url="http://d5.sina.com.cn/litong/zhitou/sinaads/release/sinaads.js";document.createElement("inc");return function(fun){lib.util.loadScript(url,fun)}});blogAd.insertIns=function(pdps,relateEl,inc,style){inc=inc||"beforeend",style=style||"display:block;";var html='<ins class="sinaads" data-ad-pdps="'+pdps+'" style="'+(style||"")+'"></ins>';relateEl=relateEl||document.body;return Core.Dom.insertHTML(relateEl,html,inc)};$registJob("trayTipsAd",function(){function renderTipsAd(){function showOrHideChild(isShow){var node=actBtn.firstChild,style=isShow?"":"none";while(node){if("a"===node.nodeName.toLowerCase()){node.style.display=style}node=node.nextSibling}}var actBtn=$E("loginBarActivity")||$E("divPopularize");actBtn.style.display="";var top=30,left=Core.Dom.getXY(actBtn)[0];showOrHideChild(false);var $adEl=blogAd.insertIns("PDPS000000033238",actBtn,"","display:inline");(window.sinaads||[]).push({element:$adEl,params:{sinaads_tip_top:top,sinaads_tip_left:left,sinaads_success_handler:function(){try{window.BLOG_AD_TIPS=1}catch(e){}},sinaads_fail_handler:function(){showOrHideChild(true);var refer=document.referrer;if(refer){var host=refer.match(/(\:\/\/)(.*?)(\/)/g);refer=host&&host[0].replace(/(\:\/\/){0,}(\/){0,}/g,"")}else{refer=""}var url="http://comet.blog.sina.com.cn/api?maintype=load_channel";Utils.Io.JsLoad.request(url,{GET:{uid:window.$UID,bloguid:scope.$uid,refer:refer},onComplete:function(result){if(result&&result.code==="A00006"){data=result.data;data=data&&data.weicaopan&&data.weicaopan.weicaopan_con;blogAd.loadNickTrayAd(data)}}})},sinaads_ad_zindex:590}})}function renderPDPS000000033236(){if($E("module_980")){blogAd.insertIns("PDPS000000033236",$E("module_980").children[0],"beforeend");(window.sinaads||[]).push({})}}Lib.execZhitou(function(){renderTipsAd();renderPDPS000000033236()})});$registJob("errorTips",function(){Lib.checkAuthor();function createNode(html){var elem=$C("div");elem.innerHTML=html;return elem.firstChild}if($isLogin){Utils.Io.JsLoad.request("http://control.blog.sina.com.cn/riaapi/warning.php",{GET:{uid:$UID},onComplete:function(result){if(result&&result.iswarning==1){var isShow=Utils.Cookie.getCookie("i8t9c"+$UID)!==result.date?"block":"none";var html='<div id="err_i8t9c" class="tb_layer_Y tb_layer_w6" style="display:'+isShow+';z-index:500;position:absolute;top:-300px;">'+'<div class="tb_layer_arrow" style="margin:0 0;left:219px"></div>'+'<div class="tb_layer_Y_main">'+'<div class="tb_mas">'+'<span style="float:right;"><a class="conn" href="javascript:;" onclick="scope.i8t9c()">×</a></span>'+"</div>"+'<div class="tb_mas">'+result.msg+'<p style="text-align:center;padding:6px;"><input type="button" value="知道了" onclick="scope.i8t9c()" /></p></div>'+"</div>"+"</div>"+"</div>";scope.i8t9c=function(){$E("err_i8t9c").style.display="none";Utils.Cookie.setCookie("i8t9c"+$UID,result.date,8760,"/");Utils.Cookie.setCookie("i8t9c"+$UID,result.date,8760,"/","blog.sina.com.cn")};scope.i8t9c.show=function(){$E("err_i8t9c").style.display="";updatePos()};var errorTips=createNode(html);document.body.appendChild(errorTips);var act=$E("loginBarActivity"),txt;var target=createNode('<div class="topbar_activity"><a href="javascript:;" onclick="scope.i8t9c&&scope.i8t9c.show();">[公告]</a></div>');act.parentNode.insertBefore(target,act);setTimeout(updatePos,10);Core.Events.addEvent(window,function(){updatePos()},"resize");Core.Events.addEvent(window,function(){setTimeout(function(){var currentTop=document.documentElement.scrollTop+document.body.scrollTop;if(oldSrcollTop==currentTop){updatePos()}else{oldSrcollTop=currentTop}},30)},"scroll");var oldSrcollTop=document.documentElement.scrollTop+document.body.scrollTop;function updatePos(){var pos=Core.Dom.getXY(target);var width=errorTips.offsetWidth;errorTips.style.visibility="inherit";errorTips.style.top=pos[1]+23+"px";errorTips.style.left=pos[0]-width+41+"px"}}}})}});$SYSMSG.extend({A33001:"对方已经被你加为关注了！<br/>请不要重复添加。",A33002:"对方拒绝了你的关注请求！",A33003:"关注已达上限，不能再添加新的关注了！<br/>可以到<a href='http://control.blog.sina.com.cn/blogprofile/attention.php"+"' target='_blank'>关注的人</a>去取消关注一些人，再回来关注吧。",A33004:"关注成功！",A33005:"你不能添加自己为关注！",A33008:"取消关注失败",A33009:"移除关注成功，加黑名单失败",A33010:"对不起，您短时间添加关注过多，请多休息，注意身体！感谢您对新浪博客的支持和关注！",A20013:"您已经发送多条相似内容了哦，请先休息一下吧~",A20014:"已经有很多博主发过相似评论了，换个内容会更精彩~"});$registJob("attenBlogerRank",function(){var wrap=$E("attenBloggerWrap");if(!wrap){return}var tpl="",tagsTpl="";var url="http://interface.blog.sina.com.cn/riaapi/profile/tj_uid_tag.php";var j=0,m=0,z=0,h=0,data,attenNum,n=0,x=0,uids="";var _shorten=Core.String.shorten;var flag=0;var type=0;var atenNum=0;var cardWrap,_nameCard,portraits,$lis,attenFunc;loadAttenBloggerInfo();function loadAttenBloggerInfo(){if(m!=0){tpl="";j=0;n=0;tagsTpl="";uids=""}m++;if(type===1){var spans=$T(wrap,"span");var spanLen=spans.length;for(var i=0;i<spanLen;i++){uids=uids+spans[i].getAttribute("attenUid")+","}}Utils.Io.JsLoad.request(url,{GET:{uid:scope.$uid,type:type,uids:uids},onComplete:function(result){atenNum=0;if(result&&result.code==="A00006"){if(!type&&type===0){type=1;data=result.data.tj_user;var len=data&&data.length;if(len){for(var i=0;i<data.length;i++){var veryfy=_shorten(data[i].is_v&&data[i].v_info?data[i].v_info.verified_reason:"",18);var veryfylog=data[i].is_v?data[i].v_info.type>0&&data[i].v_info.type<=7?'<img width="15" height="15" align="absmiddle" title="" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon147">':'<img width="15" height="15" align="absmiddle" title="" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon146">':"";tpl=tpl+"<li>"+'<dl class="pic30">'+'<dt class="pic" num="'+j++ +'"><a href="http://blog.sina.com.cn/u/'+data[i].uid+'" onclick="v7sendLog(\'39_01_01_'+$UID+'\')" target="_blank"><img width="30" height="30" alt="" src="'+data[i].image+'"></a>'+"</dt>"+'<dd class="con">'+'<div class="btn"><a href="javascript:;" onclick="return false;" class="W_btn_b" target="_blank"><span attenUid="'+data[i].uid+'" attenNum="'+n++ +'">加关注</span></a></div>'+'<p class="name"><a href="http://blog.sina.com.cn/u/'+data[i].uid+'" class="S_func1" target="_blank" onclick="v7sendLog(\'39_01_02_'+$UID+"')\">"+_shorten(data[i].uname,10)+veryfylog+"</a></p>"+'<p class="info">'+veryfy+"</p>"+"</dd>"+"</dl>"+"</li>"}tpl=tpl+'<li><p class="ico_hot"><a href="http://blog.sina.com.cn/lm/rank/monthbang/" target="_blank"><img width="48" height="16" src="http://simg.sinajs.cn/blog7style/images/center/newversion/hot.gif" alt=""></a></p></li>';wrap.innerHTML=tpl;initAllEvent(data)}else{wrap.innerHTML=""}}else{var dataSingle=result.data.tj_user;var len=dataSingle&&dataSingle.length;if(len){var veryfy=_shorten(dataSingle[0].is_v?dataSingle[0].v_info.verified_reason:"",18);var veryfylog=dataSingle[0].is_v?dataSingle[0].v_info.type>0&&dataSingle[0].v_info.type<=7?'<img width="15" height="15" align="absmiddle" title="" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon147">':'<img width="15" height="15" align="absmiddle" title="" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon146">':"";var replaceTpl='<dl class="pic30">'+'<dt class="pic" num="'+attenNum+'"><a href="http://blog.sina.com.cn/u/'+dataSingle[0].uid+'" onclick="v7sendLog(\'39_01_01_'+$UID+'\')" target="_blank"><img width="30" height="30" alt="" src="'+dataSingle[0].image+'"></a>'+"</dt>"+'<dd class="con">'+'<div class="btn"><a href="javascript:;" onclick="return false;" class="W_btn_b" target="_blank"><span attenUid="'+dataSingle[0].uid+'" attenNum="'+attenNum+'">加关注</span></a></div>'+'<p class="name"><a href="http://blog.sina.com.cn/u/'+dataSingle[0].uid+'" class="S_func1" target="_blank" onclick="v7sendLog(\'39_01_02_'+$UID+"')\">"+_shorten(dataSingle[0].uname,10)+veryfylog+"</a></p>"+'<p class="info">'+veryfy+"</p>"+"</dd>"+"</dl>";wrap.children[attenNum].style.display="";wrap.children[attenNum].innerHTML=replaceTpl;data[attenNum]=dataSingle[0];Core.Events.removeEvent(wrap,attenEventFunc,"click");initAllEvent(data)}}}},onException:function(){},returnType:"json"})}function initAllEvent(data){if(flag===0){cardWrap='<div id="#{cardWrap}" style="display:none;position: absolute; left:567px; z-index:100; top: 760px;" class="c_layer">'+'<div class="bg">'+'<div class="content" id="#{cardContent}" style="height:160;">'+"</div>"+'<div class="arrow arrow_r" id="#{cardArrow}" style="top: auto; bottom: 50px;"></div>'+"</div>"+"</div>";_nameCard=Utils.insertTemplate($E("sinablogbody"),cardWrap,"BeforeEnd");flag=1}portraits=Core.Dom.getElementsByClass(wrap,"dt","pic");$lis=$T(wrap,"dt");var s,t;Lib.util.hoverJq({elm:$lis,mouseenter:function(evt,el,index){setTimeout(function(){createCard(el,_nameCard,data)},50);s&&clearTimeout(s)},mouseleave:function(evt,el,index){t&&clearTimeout(t);t=setTimeout(function(){hideCard(_nameCard)},50)},delay:50});var cards=[_nameCard.cardWrap];Lib.util.hoverJq({elm:cards,mouseenter:function(evt,el){_nameCard.cardWrap.style.display="";t&&clearTimeout(t)},mouseleave:function(evt,el){s&&clearTimeout(s);s=setTimeout(function(){hideCard(_nameCard)},50)},delay:50});Core.Events.addEvent(wrap,attenEventFunc,"click")}function attenEventFunc(event){var target=event&&event.target||window.event&&window.event.srcElement;if(target&&target.tagName&&target.tagName.toLowerCase()=="span"){if(!atenNum){atenNum=1;addAttenFunc(target)}}else{return}}function createCard(el,wrapper,data){var num=parseInt(el.getAttribute("num"));var pos=Core.Dom.getXY(el);wrapper.cardWrap.style.top=pos[1]-133+"px";wrapper.cardWrap.style.left=pos[0]-344+"px";wrapper.cardWrap.style.display="";var veryfy=_shorten(data[num].is_v?data[num].v_info.verified_reason:"",50);var veryfylog=data[num].is_v?data[num].v_info.type>0&&data[num].v_info.type<=7?'<img width="15" height="15" align="absmiddle" title="" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon147">':'<img width="15" height="15" align="absmiddle" title="" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon146">':"";var cardTpl='<p class="c_layer_close"><a href="javascript:;" onclick="return false;" id="close_card"><img width="13" height="13" alt="" src="http://simg.sinajs.cn/blog7style/images/center/newversion/c_layer_close.gif"></a></p>'+'<dl class="name">'+"<dt>"+'<a href="http://blog.sina.com.cn/u/'+data[num].uid+'" target="_blank" onclick="v7sendLog(\'39_01_01_'+$UID+'\')"><img width="50" height="50" alt="" src="'+data[num].image+'"></a>'+"</dt>"+"<dd>"+'<p><a href="http://blog.sina.com.cn/u/'+data[num].uid+'" target="_blank" onclick="v7sendLog(\'39_01_02_'+$UID+"')\">"+data[num].uname+"</a> "+veryfylog+"</p>"+'<p class="address">博客访问:'+data[num].pv+"</p>"+"<p>博客等级:"+data[num].level+"</p>"+'<p style="height:40px;">'+veryfy+"</p>"+'<p><a href="http://blog.sina.com.cn/u/'+data[num].uid+'" target="_blank">'+data[num].blog_title+"&gt;&gt;</a></p>"+'<div class="btn"><a class="W_btn_b" href="javascript:;" onclick="return false;"><span attenUid="'+data[num].uid+'" attenNum="'+num+'">加关注</span></a></div>'+"</dd>"+"</dl>"+'<div class="clearit"></div>';

wrapper.cardContent.innerHTML=cardTpl;var cardBtns=Core.Dom.getElementsByClass(wrapper.cardWrap,"div","btn");var elCardBtn=cardBtns[0].children[0].children[0];var closeCardBtn=$E("close_card");Core.Events.addEvent(elCardBtn,function(dom){return function(){if(!atenNum){atenNum=1;addAttenFunc(dom)}}}(elCardBtn),"click");Core.Events.addEvent(closeCardBtn,function(dom){return function(){wrapper.cardWrap.style.display="none"}}(closeCardBtn),"click")}function hideCard(wrapper){wrapper.cardWrap.style.display="none";wrapper.cardContent.innerHTML=""}function addAttenFunc(el){var msg;var attenUid=el.getAttribute("attenUid");attenNum=parseInt(el.getAttribute("attenNum"));v7sendLog("39_01_03_"+$UID+"_"+attenUid);new Interface("http://control.blog.sina.com.cn/riaapi/profile/attention_add.php","ijax").request({POST:{uid:scope.$uid,aid:attenUid},onSuccess:function(){},onError:function(oData){var msg="";switch(oData.code){case"A11007":msg=$SYSMSG["A11007"].replace("#{linkNewBlog}","http://login.sina.com.cn/hd/reg_sec.php?entry=blog");winDialog.alert(msg,{funcOk:function(){window.open("http://login.sina.com.cn/hd/reg_sec.php?entry=blog","_blank","")}});break;case"A33003":msg=$SYSMSG.A33003.replace("#{UID}",$UID);winDialog.alert(msg);break;case"A33004":try{var els=el.parentNode.parentNode.parentNode.parentNode}catch(e){}if(els&&els.className==="pic30"){els.style.display="none"}else{_nameCard.cardWrap.style.display="none";var spans=$T(wrap,"span");spans[attenNum].parentNode.parentNode.parentNode.parentNode.style.display="none"}var alertConf={subText:['<div class="CP_w_cnt SG_txtb">以后对方的动态（发博文，图片，投票等），都可以在<span style="color:red">个人中心</span>查看啦！</div>','<ul class="CP_w_part CP_w_aLine">','<li><a href="http://control.blog.sina.com.cn/blogprofile/index.php?type=3&from=attention" onclick="winDialog.getDialog(\'attention\').hidden();" target="_blank">到个人中心查看关注动态&gt;&gt;</a></li>',"</ul>"].join(""),icon:"03",width:300};try{var attentionButton=$E("module_901_attention");attentionButton.className="SG_aBtn SG_aBtn_dis";attentionButton.innerHTML="<cite onclick=\"Lib.Component.isAttentioned('"+$UID+"', '"+scope.$uid+"');\">已关注</cite>"}catch(e){}msg=$SYSMSG["A33004"];alertConf["subText"]=alertConf["subText"].replace(/#{UID}/g,$UID);winDialog.alert(msg,alertConf,"attention");loadAttenBloggerInfo();break;default:showError(oData.code)}}})}});Core.Dom.byClass=function(className,tagName,elem){elem=elem||document;if(elem.getElementsByClassName){return elem.getElementsByClassName(className)}var rcn=new RegExp("\\b"+className+"\\b"),ret=[],els=elem.getElementsByTagName(tagName),i,len=els.length;for(i=0;i<len;i++){elem=els[i];if(elem.nodeType===1&&elem.className&&rcn.test(elem.className)){ret.push(elem)}}return ret};if(typeof SinaEx==="undefined"){SinaEx={}}SinaEx.findNode=function(element,direction,start){for(var node=element[start];node;node=node[direction]){if(node.nodeType==1){return node}}return null};SinaEx.prev=function(element){return SinaEx.findNode(element,"previousSibling","previousSibling")};SinaEx.next=function(element){return SinaEx.findNode(element,"nextSibling","nextSibling")};SinaEx.firstChild=function(element){return SinaEx.findNode(element,"nextSibling","firstChild")};SinaEx.parent=function(node,nodeName){nodeName=nodeName.toLowerCase();while(node){if(node.nodeName.toLowerCase()===nodeName){return node}node=node.parentNode}return null};SinaEx.createNode=function(html){var node=document.createElement("div");node.innerHTML=html;return node.firstChild};SinaEx.addClass=function(node,classname){var cn=node.className;if((" "+cn+" ").indexOf(" "+classname+" ")===-1){node.className=classname+" "+cn}};SinaEx.removeClass=function(node,classname){var cn=(" "+node.className+" ").replace(" "+classname+" "," ");node.className=cn.replace(/^\s+/,"").replace(/\s+$/,"")};if(document.documentElement.contains){SinaEx.contains=function(a,b){return a.contains?a.contains(b):true}}else if(document.documentElement.compareDocumentPosition){SinaEx.contains=function(a,b){return a===b||!!(a.compareDocumentPosition(b)&16)}}else{SinaEx.contains=function(a,b){while(b){if(a===b){return true}b=b.parentNode}return false}}SinaEx.enterLeave=function(wrapEle,fnOver,fnOut,delaytime){var __addEvent=Core.Events.addEvent,_lastover=null,_overtimer=0,_outtimer=0;fnOver=fnOver||function(){};fnOut=fnOut||function(){};delaytime=delaytime||0;__addEvent(wrapEle,function(event){clearTimeout(_outtimer);var e=event||window.event,ele=e.target||e.srcElement;_overtimer=setTimeout(function(){if(_lastover&&SinaEx.contains(_lastover,ele))return;var t=SinaEx.parent(ele,"li");if(t){if(_lastover){fnOut(_lastover)}fnOver(t);_lastover=t}else if(_lastover){fnOut(_lastover);_lastover=null}},delaytime)},"mouseover");__addEvent(wrapEle,function(){clearTimeout(_overtimer);_outtimer=setTimeout(function(){if(_lastover){fnOut(_lastover);_lastover=null}},delaytime)},"mouseout")};!function(window){if(window.Evter){return}function toJson(str){try{return new Function("return "+str)()}catch(e){return null}}var _handlers={},_needlock={},_busy={},_eid=1;window.Evter={add:function(ename,handler){if(typeof ename==="string"&&typeof handler==="function"){if(ename.charAt(0)==="-"){ename=ename.substr(1);_needlock[ename]=true}if(_handlers[ename]){traceError('Evter handler "'+ename+'" has been defined!');return}_handlers[ename]=handler}},click:function(elem,ename,handler){var curname=elem.getAttribute("e-name"),cdr=elem.getElementsByTagName("*"),i=cdr.length;while(i--){cdr[i].getAttribute("e-name")||cdr[i].setAttribute("e-name","b")}if(curname){if((" "+curname+" ").indexOf(" "+ename+" ")===-1){elem.setAttribute("e-name",curname+" "+ename)}}else{elem.setAttribute("e-name",ename)}if(handler){this.add(ename,handler)}},remove:function(ename){delete _handlers[ename];delete _needlock[ename]},fire:function(ename,eTarget,event,eSource){if(_needlock[ename]&&eTarget){eTarget.$EID||(eTarget.$EID=" "+_eid++);if(_busy[ename+eTarget.$EID]){return}_busy[ename+eTarget.$EID]=true}var handler=_handlers[ename];handler&&handler(eTarget,event,eSource)},data:function(elem,data){var edata=elem.getAttribute("e-data"),type=typeof data;if(type==="undefined"||data===null){return edata?toJson(edata):null}else if(type==="object"){var k,v;if(edata){edata=toJson(edata);if(typeof edata==="object"){for(k in data){edata[k]=data[k]}}else{edata=data}}else{edata=data}data=[];for(k in edata){v=edata[k];data.push(k+":"+(typeof v==="string"?"'"+v.replace(/'/g,"\\'")+"'":v))}data="{"+data.join(",")+"}"}else if(type==="string"){data="'"+data.replace(/'/g,"\\'")+"'"}elem.setAttribute("e-data",data)},free:function(eTarget,ename){eTarget&&delete _busy[ename+eTarget.$EID]}};Core.Events.addEvent(document.body,function(event){event=event||window.event;var eSource=event.target||event.srcElement,eTarget=eSource,ename=eTarget.getAttribute("e-name");if(ename==="b"){do{eTarget=eTarget.parentNode;ename=eTarget.getAttribute("e-name")}while(ename==="b")}if(ename){if(_needlock[ename]){eTarget.$EID||(eTarget.$EID=" "+_eid++);if(_busy[ename+eTarget.$EID]){return}_busy[ename+eTarget.$EID]=true}var handler=_handlers[ename];if(handler){handler(eTarget,event,eSource)}else{var enames=ename.split(" "),i=0,len=enames.length;for(;i<len;i++){ename=enames[i];if(_needlock[ename]){eTarget.$EID||(eTarget.$EID=" "+_eid++);if(_busy[ename+eTarget.$EID]){continue}_busy[ename+eTarget.$EID]=true}handler=_handlers[ename];handler&&handler(eTarget,event,eSource)}}}},"click")}(window);Mojie.loadImgCallback=function(imgObj){var oriImg=imgObj.oriImg;var w=imgObj.width,h=imgObj.height;if(w>200){h=Math.floor(200*h/w);w=200}if(h>300){oriImg.parentNode.style.height="300px";oriImg.parentNode.style.overflow="hidden"}oriImg.width=w;oriImg.height=h;imgObj=null};Mojie.checkImageSize=function(imgList,callback){var i,len;for(i=0,len=imgList.length;i<len;i++){var imgObj=new Image;imgObj.oriImg=imgList[i];imgObj.onload=function(imgObj){return function(){typeof callback==="function"&&callback(imgObj)}}(imgObj);imgObj.src=imgList[i].src}};Core.Dom.parent=function(node,nodeName){nodeName=nodeName.toLowerCase();while(node){if(node.nodeName.toLowerCase()===nodeName){return node}node=node.parentNode}return null};Core.Dom.createElement=function(html){var node=document.createElement("div");node.innerHTML=html;return node.firstChild};Lib.register("sendSuda",function(lib){var url="http://www.sinaimg.cn/unipro/pub/suda_s_v851c.js";return function(fun){lib.util.loadScript(url,fun)}});Evter.add("openBlog",function(elem,event){Core.Events.stopEvent(event);var _dom=Core.Dom,_byClass=_dom.byClass;var li=_dom.parent(elem,"li");var edata=Evter.data(li);if(edata&&edata.type){var feedTexts=_byClass("feedText","div",li);if(edata.type===5){showMusic(feedTexts[0].children);return}feedTexts[0].style.display="none";feedTexts[1].style.display="";if(edata.type===4){playVideo(feedTexts[1])}return}if(li.opening){return}li.opening=true;var btnHtml='<a class="btn_ico btn_sq" e-name="closeBlog" href="javascript:;">'+'<img e-name="b" width="49" height="20" align="absmiddle" title="收起" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif"></a>'+(edata.dig_id?"":'<a class="btn_ico btn_alltxt" href="'+(edata.bhref||"javascript:;")+'" target="_blank">'+'<img width="64" height="20" align="absmiddle" title="阅读全文" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif"></a>');Lib.sendSuda(function(){try{SUDA.log("","getfeedarticle")}catch(e){}});Utils.Io.JsLoad.request("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/feed/getFeedArticle.php",{GET:{blog_id:edata.blogid},onComplete:function(res){if(res&&res.data){dataCenter(res.data)}li.opening=false},onException:function(){winDialog.alert("展开内容失败，请稍候再试",{icon:"01"});li.opening=false}});edata.bhref.indexOf("/s/")>0&&commonLog("http://comet.blog.sina.com.cn/api?maintype=hits&act=4&ref=http%3A%2F%2Fi.blog.sina.com.cn&aid="+edata.blogid);function dataCenter(data){var type=parseInt(data.type)||-1;if(type<2||type>5)return;Evter.data(li,{type:type});var html="";switch(type){case 3:html=data.body+btnHtml;break;case 2:html=photo(data);break;case 4:html=video(data);break}var small=_byClass("feedText","div",li)[0];if(type===5){openMusic(small.children,data);return}var big=_dom.createElement('<div class="feedText"></div>');big.innerHTML=html;small.style.display="none";small.parentNode.insertBefore(big,small.nextSibling);if(type===3){big.onclick=function(event){event=event||window.event;var t=event.srcElement||event.target;if(t.nodeName.toUpperCase()==="IMG"&&t.className==="imgZoomOut"){Evter.fire("closeBlog",li)}};if($IE6){Mojie.checkImageSize(_byClass("imgZoomOut","img",big),function(el){if(el.width>588){el.oriImg.width=588}el=null})}}else if(type===4){playVideo(big)}}function photo(data){var html="",datai;for(var i=0,len=data.body.length;i<len;i++){datai=data.body[i];html+='<p class="feedPic_b"><img src="'+datai.article_pic+'" e-name="closeBlog" class="imgZoomOut" /></p>'+datai.description}return html+data.descrp+btnHtml}function video(data){var html=""+'<div class="feedPic_video" e-data="\''+data.swf_url.replace(/[<>'"]/g,"")+"'\">正在打开视频...</div>"+'<div class="feedPic_text"><p>'+data.body.replace(/<p>/gi,"").replace(/<\/p>/gi,"")+btnHtml+"</p></div>"+'<div class="clearit"></div>';return html}function openMusic(feedTextCdr,data){feedTextCdr[1].innerHTML='<img class="imgZoomOut" width="420" src="'+(feedTextCdr[0].children[0].src||"").replace("_150150","_420420")+'" alt="" e-name="closeBlog" />';feedTextCdr[3].innerHTML="<p>"+data.body.replace(/<p.*?>/gi,"").replace(/<\/p>/gi,"")+btnHtml+"</p>";showMusic(feedTextCdr)}function showMusic(feedTextCdr){feedTextCdr[0].style.display="none";feedTextCdr[4].style.display="none";feedTextCdr[1].style.display="";feedTextCdr[3].style.display=""}function playVideo(big){var videobox=_byClass("feedPic_video","div",big)[0];var url=Evter.data(videobox);var player=new Utils.Flash.swfObject(url,"video",500,365,"9","#00ff00");player.addParam("quality","high");player.addParam("wmode","transparent");player.addParam("allowScriptAccess","never");player.addParam("flashvars","isAutoPlay=true&auto=1&autoPlay="+(url.indexOf("sina.com.cn")>-1?"1":"true"));player.write(videobox)}});Evter.add("closeBlog",function(elem){var _dom=Core.Dom;var li=_dom.parent(elem,"li");var edata=Evter.data(li);var feedTexts=_dom.byClass("feedText","div",li);if(edata&&edata.type===5){var feedTextCdr=feedTexts[0].children;feedTextCdr[0].style.display="";feedTextCdr[4].style.display="";feedTextCdr[1].style.display="none";feedTextCdr[3].style.display="none"}else{feedTexts[0].style.display="";feedTexts[1].style.display="none";if(edata&&edata.type===4){var videobox=_dom.byClass("feedPic_video","div",feedTexts[1]);videobox[0].innerHTML=""}}var pos=_dom.getXY(li),currentScrollTop=document.body.scrollTop||document.documentElement.scrollTop;if(pos[1]<currentScrollTop){document.body.scrollTop=document.documentElement.scrollTop=pos[1]}});Utils.Io.TimeoutJsLoad=function(url,opts){this._opts={url:"",charset:"utf-8",noreturn:false,noencode:false,timeout:-1,GET:{},onComplete:null,onException:null,type:"blogScript",jsonpParamName:"callback"};if(!url||typeof url!=="string"){throw new Error("url参数不能为空!")}this._opts.url=url;this.isAborted=false;this.scriptIdentifier="";this.varname="";this.loadComplete=false;this.timeObj;Core.System.parseParam(this._opts,opts);this.loadScript()};Utils.Io.TimeoutJsLoad.prototype={constructor:Utils.Io.TimeoutJsLoad,__jsonpCounter:(new Date).getTime(),loadScript:function(){var opts=this._opts,scriptObj=$C("script"),head=$T(document,"head")[0],_this=this,jsonp=this._processUrl();scriptObj.async=true;scriptObj.src=opts.url;scriptObj.charset=opts.charset;scriptObj.id="script"+this.scriptIdentifier;if(opts.type==="jsonp"){window[jsonp]=originalCallback}else if(opts.type==="blogScript"){scriptObj.onload=scriptObj.onerror=scriptObj.onreadystatechange=originalCallback}function originalCallback(result){var type=opts.type;if(type==="blogScript"&&scriptObj&&scriptObj.readyState&&scriptObj.readyState!="loaded"&&scriptObj.readyState!="complete"){return}_this.loadComplete=true;if(type==="jsonp"){window[jsonp]=undefined;try{delete window[jsonp]}catch(jsonpError){}}else if(type==="blogScript"){scriptObj.onload=scriptObj.onreadystatechange=scriptObj.onerror=null}head.removeChild(scriptObj);if(!_this.isAborted&&typeof opts.onComplete==="function"){_this.timeObj&&clearTimeout(_this.timeObj);opts.onComplete(type==="blogScript"?window[_this.varname]:result)}}head.insertBefore(scriptObj,head.firstChild);if(opts.timeout>0){this.timeObj=setTimeout(function(){_this.abortRequest()},opts.timeout)}},abortRequest:function(){if(this.loadComplete){return}this.isAborted=true;if(/opera/i.test(navigator.userAgent)&&$E("script"+this.scriptIdentifier)){$E("script"+this.scriptIdentifier).src=""}typeof this._opts.onException==="function"&&this._opts.onException()},_processUrl:function(){var opts=this._opts,url=opts.url,queryString=opts.GET,key,rnd=window.parseInt(Math.random()*1e8),url_cls=new Utils.Url(url);for(key in queryString){url_cls.setParam(key,opts.noencode===true?queryString[key]:Core.String.encodeDoubleByte(queryString[key]))}this.scriptIdentifier=rnd;if(opts.type==="blogScript"){this.varname=url_cls.getParam("varname")||"requestId_"+rnd;opts.noreturn!==true&&url_cls.setParam("varname",this.varname)}else if(opts.type==="jsonp"){var jsonp="jsonp"+this.constructor.prototype.__jsonpCounter++;url_cls.setParam(opts.jsonpParamName,jsonp)}opts.url=url_cls.toString();return jsonp}};Evter.add("playMusic",function(elem,event){Core.Events.stopEvent(event);var edata=Evter.data(elem);if(edata.shorturl){var playbox=elem.parentNode.parentNode;var oldhtml=playbox.innerHTML;playbox.innerHTML="正在打开音乐...";var err=function(){playbox.innerHTML=oldhtml;winDialog.alert("打开失败，请稍候再试",{icon:"01"})};new Utils.Io.TimeoutJsLoad("http://api.t.sina.com.cn/widget/show.jsonp?source=1617465124",{GET:{short_url:edata.shorturl,lang:"zh_cn",template_name:$IE?"qingobj":"qingebd",vers:3},type:"jsonp",jsonpParamName:"jsonp",onComplete:function(res){if(res&&res.result){playbox.innerHTML=res.result}else{err()}},onException:err})}});Utils.template=function(tpl,arrData,mix){if(!arrData||!arrData.length){return""}tpl=tpl.replace(/[\r\n\t]/g,"").replace(/\'/g,"\\'").split("{");var ret="",hasMix=mix!==undefined,i,len=tpl.length,evaluate,sous,source="return '"+tpl[0]+"'",datai,mixdata,p;for(i=1;i<len;i++){sous=tpl[i].split("}");source=source+(sous[0].indexOf("$")===-1?"+$."+sous[0]:"+("+sous[0].replace(/\[|\]/g,"'")+")")+"+'"+sous[1]+"'"}evaluate=new Function("$",source);for(i=0,len=arrData.length;i<len;i++){datai=arrData[i];if(hasMix){mixdata=mix(datai,i);for(p in mixdata){datai[p]=mixdata[p]}}ret+=evaluate(datai)}return ret};Evter.add("like",function(elem,event){Core.Events.stopEvent(event);elem.blur();var _dom=Core.Dom;var li=_dom.parent(elem,"li");var edata=Evter.data(li);var txtlist=_dom.byClass("blog_txtlist","div",li);var txtlist0=txtlist[0];if(Evter.data(txtlist0)===3){Mojie.slideShow(txtlist0,80,0,.4);Evter.data(txtlist0,"");if(txtlist.length>1){txtlist[1].style.display=""}return}if(elem.className.indexOf("loveon")>-1){getLikeList()}else{if(li.liking){return}li.liking=true;Utils.Io.JsLoad.request("http://control.blog.sina.com.cn/admin/digg/post_digg.php",{GET:{action:"0",res_type:1,res_id:edata.blogid},onComplete:function(res){if(res&&res.code==="A00006"){elem.className="love loveon";var em=$T(elem,"em")[0];var m=em.innerHTML.match(/(\d+)/);var num=m?parseInt(m[1]):0;em.innerHTML="("+(num+1)+")"}else if("A00800"===res.code){var msg="对不起，您短时间点击喜欢过多，请多休息，注意身体！感谢您对新浪博客的支持和关注！";winDialog.alert(msg,{icon:"01",width:400})}getLikeList();li.liking=false},onException:function(){getLikeList();li.liking=false}})}function getLikeList(){Utils.Io.JsLoad.request("http://control.blog.sina.com.cn/riaapi/digg/get_digg.php",{GET:{res_id:edata.blogid},onComplete:function(res){if(res&&res.data){renderList(res.data)}},onException:function(){}})}function renderList(data){if(!data.length)return;var html=""+'<div class="arrow"></div>'+"<h6>他们喜欢此内容</h6>"+'<div class="piclist">'+Utils.template('<a href="http://blog.sina.com.cn/u/{action_uid}" title="{action_uname}" target="_blank">'+'<img src="{action_img}" alt="" height="40" width="40" /></a>',data)+"</div>"+'<div class="clearit"></div>';txtlist0.innerHTML=html;Evter.data(txtlist0,3);if(txtlist.length>1){txtlist[1].style.display="none"}Mojie.slideShow(txtlist0,0,80,.4)}});App.getArticlesSort=function(fCallBack){var js=$C("script");Lib.checkAuthor();js.src="http://comet.blog.sina.com.cn/api?maintype=acate&varname=x&uid="+$UID;js.charset="utf-8";js.onload=js.onerror=js.onreadystatechange=Core.Function.bind2(function(){if(js&&js.readyState&&js.readyState!="loaded"&&js.readyState!="complete"){return}App.ArticlesSort=x;if(fCallBack!=null){fCallBack(App.ArticlesSort)}js.onload=js.onreadystatechange=js.onerror=null;js.src="";js.parentNode.removeChild(js);js=null},this);document.getElementsByTagName("head")[0].appendChild(js)};Core.Dom.addHTML=function(oParentNode,sHTML){oParentNode.insertAdjacentHTML("beforeend",sHTML)};if(!$C("div").insertAdjacentHTML){Core.Dom.addHTML=function(oParentNode,sHTML){var oRange=oParentNode.ownerDocument.createRange();oRange.setStartBefore(oParentNode);var oFrag=oRange.createContextualFragment(sHTML);oParentNode.appendChild(oFrag)}}var cateDialog=Core.Class.create();cateDialog.prototype={initialize:function(action){this.action=action||false},show:function(){if(typeof editor!="undefined"){editor.blur()}this.initDialog();this.dialog.show();this.dialog.setFixed(true);this.dialog.setAreaLocked(true);this.dialog.setMiddle()},initDialog:function(){var me=this;var data={width:492,height:0,url:"http://control.blog.sina.com.cn/admin/article/article_class_list.php?"+(this.action?"action=editor":"")};Lib.checkAuthor();this.url="http://control.blog.sina.com.cn/admin/article/article_class_save2.php?uid="+$UID+(this.action?"&action=editor":"");this.id=Core.Math.getUniqueId();this.manage=null;this.manage=new cateMng(this.id,this.itemTpl);this.manage.onSuccess=function(list){me.onSuccess(list)};var temp=new Ui.Template("<div style='width: #{width}px; height: #{height}px;' id='category_"+this.id+"'></div>");var obj={ad:false,drag:true,title:"分类管理",content:temp.evaluate(data),shadow:1,width:data.width,height:data.height};var func={};var dialog=winDialog.createCustomsDialog(obj,func);dialog.addEventListener("hidden",function(){this.destroy()});this.dialog=dialog;$E("category_"+this.id).innerHTML=this.tpl.join("");var _this=this;this.dialog.nodes["btnClose"].href="javascript:;";this.dialog.nodes["btnClose"].onclick=function(){if(_this.manage.getEdit()){winDialog.confirm("是否保存此更改？",{funcOk:function(){_this.manage.saveHandler(_this.url)},funcCancel:function(){_this.close()},funcClose:function(){_this.dialog.show()},textOk:"是",textCancel:"否"})}else{_this.close()}};this.initEvent()},initEvent:function(){this.manage.nameEvent();this.manage.createEvent();this.manage.dataProvider();this.manage.saveEvent(this.url)},hidden:function(){this.dialog.hidden()},close:function(){this.dialog.hidden()},showOld:function(){this.dialog.show()},reset:function(){window.CateDialog.dialog.setCloseEvent(true);window.CateDialog.dialog.hidden();window.CateDialog.dialog=null;window.CateDialog.init=false},setSize:function(nWidth,nHeight){var ele=this.dialog.nodes.content.firstChild;this.dialog.setSize(nWidth,nHeight);ele.style.width=nWidth+"px";ele.style.height=nHeight+"px"},setCloseEvent:function(bClose){trace("123123123")},getDialog:function(){return this.dialog},getId:function(){return this.id},getDataList:function(){return this.manage.list},onSuccess:function(res){},init:false,dialog:null,tpl:['<div id="categoryBody">','<div id="categoryTitle">',"</div>",'<div id="categoryHead">',"<table>","<tr>",'<td><input type="text" maxlength="28" value="最多可输入14个中文字符" id="categoryName"/></td>','<td width="80"><a id="categoryCreate" href="javascript:void(0);" class="SG_aBtn SG_aBtnB SG_aBtn_sub"><cite>创建分类</cite></a></td>','<td><span class="SG_txtc">请用中文、英文或数字。</span></td>',"</tr>","</table>",'<div id="errTips"></div>',"</div>",'<form method="post" id="categoryForm" name="form">','<div id="categoryList">','<ul class="clearfix" id="datalist">&nbsp;</ul>','<div class="SG_j_linedot"></div>',"</div>",'<div id="categoryBottom" style="text-align:center">','<a id="categorySave" href="javascript:void(0);" class="SG_aBtn SG_aBtnB SG_aBtn_sub"><cite>保存设置<input type="button" value="保存设置"/></cite></a>',"</div>","</form>","</div>"],itemTpl:['<li class="{class}">','<span class="htit" style="color:#000000" id="cate_{index}">{cate}</span>','<input type="hidden" value="{cate}" name="typename[]" class="catName"/>','<input type="hidden" value="{id}" name="number[]"/>','<span id="ctrl_{index}" class="control">','<div class="manage">','<a class="CP_a_fuc" id="edit_{index}" href="javascript:;" onclick="javascript:window.CateDialog.manage.editCate(this);">[<cite>编辑</cite>]</a>','<a class="CP_a_fuc" id="del_{index}" index="{index}" href="javascript:;" onclick="javascript:window.CateDialog.manage.delCate(this);">[<cite>删除</cite>]</a>',"</div>",'<div class="arrow">','<a id="up_{index}" class="{up_class}" href="javascript:;" onclick="javascript:window.CateDialog.manage.upHandler(this);"/>','<a id="down_{index}" class="{down_class}" href="javascript:;" onclick="javascript:window.CateDialog.manage.downHandler(this);"/>',"</div>","</span>",'<div id="editctrl_{index}" class="writeinfo" style="display:none">','<input id="new_{index}" type="text" value="" /><a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;"><cite>确定</cite></a><a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;"><cite>取消</cite></a></div>',"<div/>","</li>"]};var cateMng=Core.Class.create();cateMng.prototype={list:null,edit:false,initialize:function(id,itemTpl){this.id=id;this.itemTpl=itemTpl;Array.prototype.remove=function(dx){if(isNaN(dx)||dx>this.length){return false}this.splice(dx,1)}},nameEvent:function(){var _this=this;$E("categoryName").onfocus=function(){if(this.value=="最多可输入14个中文字符"){this.value=""}};$E("categoryName").onblur=function(){var re=/[ ><\\\'\;\"`\|\t\r\n|\u3000]/gi;this.value=this.value.replace(re,"");if(Core.String.trim($E("categoryName").value)==""){this.value="最多可输入14个中文字符";this.edit=false}else{this.edit=true}_this.showTips("")};$E("categoryName").onkeyup=function(){var value=Core.String.trim(this.value);if(Core.String.byteLength(value)>28){this.value=Core.String.leftB(value,28)}else if(value!=this.value){this.value=value}};_this.showTips("")},createEvent:function(){var _this=this;var code="";$E("categoryCreate").onclick=function(){if(checkCate()&&$E("categoryName").edit){var obj={id:-1,name:$E("categoryName").value};$E("categoryName").value="最多可输入14个中文字符";$E("categoryName").edit=false;_this.list.push(obj);_this.update()}_this.showTips(code)};function checkCate(){var value=Core.String.trim($E("categoryName").value);code="";if(value==""||value=="最多可输入14个中文字符"){code="分类名称不能为空"}else if(value.indexOf("&")!=-1||value.indexOf("＆")!=-1){code="分类名称不能包含&符号"}else if(_this.list.length>=15){code="抱歉！最多可创建15条分类"}else if(Core.String.byteLength(value)>28){code="最多可输入14个中文字符"}for(var i=0;i<_this.list.length;i++){if(_this.list[i].name==value){code="您已经添加过此分类";break}}if(code!=""){return false}else{return true}}},saveEvent:function(url){Core.Events.stopEvent();var _this=this;$E("categorySave").onclick=function(){_this.saveHandler(url)}},saveHandler:function(url){var _this=this;var length=_this.list.length;var cateName=[];var cateId=[];for(var i=0;i<length;i++){var item=_this.list[i];cateName.push(item.name);cateId.push(item.id)}Utils.Io.Ijax.request(url+"&r="+Math.random(),{POST:{typename:cateName.join("|"),number:cateId.join("|")},onComplete:function(res){eval("var result = "+res);try{try{if($E("module_3")){Lib.Component.refresh(3,{width:scope.catedialogwidth||210})}if($E("module_7")){location.reload()}}catch(error){trace(error)}try{window.ArticleCateFuncs.reloadCate(result.msg)}catch(error){}window.CateDialog.hidden()}catch(e){}var r;eval("r="+res);_this.onSuccess(r.msg)},onException:function(res){}})},editCate:function(dom){var _this=this;var index=dom.id.split("_")[1];var old=$E("cate_"+index).innerHTML;var li=$E("cate_"+index).parentNode;$E("ctrl_"+index).className="control hide";li.className=index%2==0?"editName":"cline editName";var tpl='<div id="editctrl_'+index+'" class="writeinfo"><input id="new_'+index+'" type="text" value="'+old+'"><a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;"><cite>确定</cite></a><a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;"><cite>取消</cite></a></div>';li.innerHTML=tpl;$E("new_"+index).onkeyup=function(){var re=/[ >&<\\\'\,\;\"`\|\t\r\n|\u3000]/gi;var value=Core.String.trim(this.value.replace(re,""));if(value!=this.value){this.value=value}if(value==""){$E("editctrl_"+index).childNodes[1].disabled=true}else{$E("editctrl_"+index).childNodes[1].disabled=false}};$E("new_"+index).onblur=function(){if(Core.String.byteLength(this.value)>=28){this.value=Core.String.leftB(this.value,28)}};$E("editctrl_"+index).childNodes[1].onclick=function(){if($E("new_"+index).value==old){setName(old,2)}else{setName($E("new_"+index).value,1)}};$E("editctrl_"+index).childNodes[2].onclick=function(){setName(old,2)};function setName(nvl,type){var value=nvl;var code="";if(Core.String.byteLength(value)>28){value=Core.String.leftB(value,28)}if(type==1){for(var i=0;i<_this.list.length;i++){if(_this.list[i].name==value){code="您已经添加过此分类";break}}}if(code!=""){if(!$E("err_"+index)){Core.Dom.addHTML($E("editctrl_"+index),'<div id="err_'+index+'" class="errTips">'+code+"</div>");li.style.height="60px"}else{$E("err_"+index).value=code}}else{_this.list[index].name=value;var tpl=_this.itemTpl.join("");tpl=tpl.replace('<li class="{class}">',"");tpl=tpl.replace("</li>");var item=_this.list[index];tpl=tpl.replace(/\{cate\}/gi,item.name);tpl=tpl.replace(/\{id\}/gi,item.id);tpl=tpl.replace(/\{index\}/gi,index);tpl=tpl.replace(/\{up_class\}/,index==0?"up_disabled":"up");tpl=tpl.replace(/\{down_class\}/,index==_this.list.length-1?"down_disabled":"down");li.innerHTML=tpl;li.className=index%2==0?"":"cline";li.style.height="30px";if(type==1){_this.edit=true}}code=""}},delCate:function(dom){var _this=this;var index=dom.id.split("_")[1];winDialog.confirm("确实要删除此分类吗？删除后不可恢复。",{textOk:"删除",funcOk:function(){_this.list.remove(index);_this.update()}})},upHandler:function(dom){var index=dom.id.split("_")[1];if(index>0){var temp=this.list[index];this.list[index]=this.list[index-1];this.list[index-1]=temp;this.update()}},downHandler:function(dom){var index=dom.id.split("_")[1];if(index<this.list.length-1){var next=index*1+1;var temp=this.list[next];this.list[next]=this.list[index];this.list[index]=temp;this.update()}},showTips:function(code){$E("errTips").innerHTML=code},dataProvider:function(){var _this=this;App.getArticlesSort(function(data){_this.list=data.data;$E("datalist").innerHTML="";for(var i=0;i<_this.list.length;i++){var tpl=_this.itemTpl.join("");var item=_this.list[i];tpl=tpl.replace(/\{cate\}/gi,item.name);tpl=tpl.replace(/\{class\}/gi,i%2==0?"":"cline");tpl=tpl.replace(/\{id\}/gi,item.id);tpl=tpl.replace(/\{index\}/gi,i);tpl=tpl.replace(/\{up_class\}/,i==0?"up_disabled":"up");tpl=tpl.replace(/\{down_class\}/,i==_this.list.length-1?"down_disabled":"down");Core.Dom.addHTML($E("datalist"),tpl)}})},update:function(){$E("datalist").innerHTML="";for(var i=0;i<this.list.length;i++){var tpl=this.itemTpl.join("");var item=this.list[i];tpl=tpl.replace(/\{cate\}/gi,item.name);tpl=tpl.replace(/\{class\}/gi,i%2==0?"":"cline");tpl=tpl.replace(/\{id\}/gi,item.id);tpl=tpl.replace(/\{index\}/gi,i);tpl=tpl.replace(/\{up_class\}/,i==0?"up_disabled":"up");tpl=tpl.replace(/\{down_class\}/,i==this.list.length-1?"down_disabled":"down");Core.Dom.addHTML($E("datalist"),tpl)}if(!this.edit){this.edit=true}},getEdit:function(){return this.edit},onSuccess:function(res){}};var ReblogSuccess=Core.Class.create();ReblogSuccess.prototype={interfaceSave:null,box:null,nodes:null,onClose:null,memoNullText:"说点什么...",articleID:"",initialize:function(){Lib.checkAuthor();this.interfaceSave=new Interface("http://control.blog.sina.com.cn/riaapi/article/quto_onetime.php","ijax");!window.CateDialog&&(window.CateDialog=new cateDialog)},show:function(articleID,wrapBox,onClose){this.box=wrapBox;this.onClose=onClose;this._initDialog();this.articleID=articleID||""},save:function(){var me=this,nodes=this.nodes;this.interfaceSave.request({POST:{version:7,new_cat:nodes.selCate.value,blog_id:me.articleID,reship:nodes.txtMemo.value===me.memoNullText?"":nodes.txtMemo.value},onSuccess:function(data){me.close();me._initLayer()},onError:function(cep){winDialog.alert(cep.data)},onFail:function(){}})},close:function(){this.onClose&&this.onClose()},_initDialog:function(){var me=this;var template=""+'<div class="arrow"></div>'+'<p class="reproduced"><span class="b"></span>你还可以写评论...</p>'+'<div class="commentbox"><textarea id="#{txtMemo}" style="color:#c8c8c8;" name="" cols="" rows="">'+this.memoNullText+"</textarea></div>"+'<div class="ct_float ct_float_no">'+'<div class="ct_floatL">分类'+'<select id="#{selCate}">'+'<option value="00">默认文章分类</option>'+"</select>"+'<a id="#{btnShowCate}" href="javascript:;">创建分类</a>'+"</div>"+'<div class="ct_floatR">'+'<a id="#{btnSave}" href="javascript:;" class="SG_aBtn SG_aBtn_ico"><cite>转载</cite></a>'+"</div>"+"</div>"+'<div class="clearit"></div>';this.box[0].innerHTML="";this.nodes=Utils.insertTemplate(this.box[0],template,"AfterBegin");Core.Events.addEvent(this.nodes.btnSave,function(){me.verified()&&me.save()});Core.Events.addEvent(this.nodes.btnShowCate,function(){window.CateDialog.onSuccess=function(res,event){Core.Events.stopEvent(event);me.nodes.selCate.length=1;var list=res||[],i,len=list.length;for(i=0;i<len;i++){me.addCate(list[i].value,list[i].label)}me.addCate("0","私密博文")};window.CateDialog.show()});this.nodes.txtMemo.onblur=function(){if(this.value.replace(/\s/g,"")===""){
this.style.color="#c8c8c8";this.value=me.memoNullText}};this.nodes.txtMemo.onfocus=function(){if(this.value===me.memoNullText){this.style.color="#000000";this.value=""}};this._initCateList()},_initLayer:function(){var layerHtml='<div class="pop_reserved" id="layerWrap" style="display:none;">'+'<img src="http://simg.sinajs.cn/blog7style/images/center/newversion/ico_reserved.jpg" width="20" height="17" alt="" />转载成功！'+"</div>";var option={css:{"z-index":"5002",position:$IE6?"absolute":"fixed",top:"50%",left:"50%"}};var mask=new BackShadow(.4);mask.show();if(!$E("layerWrap")){Utils.insertTemplate(document.body,layerHtml,"BeforeEnd");var layerWrap=$E("layerWrap");layerWrap.style.display="";if($IE6){Core.Events.addEvent(window,function(){setPos(layerWrap)},"scroll")}setPos(layerWrap)}else{$E("layerWrap").style.display=""}setTimeout(function(){mask.destroy();$E("layerWrap").style.display="none";s},1e3);function setPos(obj){var w=190,h=110;obj.style.marginLeft=w/2*-1+"px";if($IE6){obj.style.top=document.documentElement.scrollTop+parseInt(Math.abs((document.documentElement.offsetHeight-h)/2),10);delete option.css.top}else{obj.style.marginTop=h/2*-1+"px"}Core.Dom.setStyle2(obj,option.css)}},verified:function(){var nodes=this.nodes;if(Core.String.byteLength(nodes.txtMemo.value)>2e3){winDialog.alert("评论内容必须是1000中文或2000字符以内，请重新输入。");return false}return true},_initCateList:function(event){Core.Events.stopEvent(event);var nodes=this.nodes,me=this;nodes.selCate.length=1;App.getArticlesSort(function(){var list=x.data,i,len=list.length;for(i=0;i<len;i++){me.addCate(list[i].id,list[i].name)}me.addCate("0","私密博文")})},addCate:function(id,name,event){var sel=this.nodes.selCate;var op=$C("option");op.value=id;op.innerHTML=name;sel.appendChild(op)}};Evter.add("reblog",function(elem){var _dom=Core.Dom;var li=_dom.parent(elem,"li");var edata=Evter.data(li);var txtlist=_dom.byClass("blog_txtlist","div",li);var txtlist0=txtlist[0];if(Evter.data(txtlist0)===1){Mojie.slideShow(txtlist0,150,0);Evter.data(txtlist0,"");if(txtlist.length>1){txtlist[1].style.display=""}return}var w=Core.Dom.getXY(li);var w1=Core.Dom.getXY(elem);showCmsInput();function showCmsInput(){var rs=new ReblogSuccess;rs.show(elem.getAttribute("sblogid")||edata.blogid,txtlist,function(){var em=$T(elem,"em")[0];var m=em.innerHTML.match(/(\d+)/);var num=m?parseInt(m[1]):0;em.innerHTML="("+(num+1)+")";txtlist0.style.display="none";Evter.data(txtlist0,"");if(txtlist.length>1){txtlist[1].style.display=""}$E("feedWrap").style.zoom=1});var arrow=_dom.byClass("arrow","div",li);arrow[0].style.right=600-(w1[0]-w[0])+"px";Evter.data(txtlist0,1);if(txtlist.length>1){txtlist[1].style.display="none"}Mojie.slideShow(txtlist0,0,150)}$E("feedWrap").style.zoom=1});Core.String.encodeHTML=function(str){var div=document.createElement("div");div.appendChild(document.createTextNode(str));return div.innerHTML.replace(/\s/g,"&nbsp;")};var Tabs=Core.Class.create();Tabs.prototype={initialize:function(container,option){option=option||{};var className=option.className||"";this.tabsArr=[];this.htmlEle=$C("ul");this.htmlEle.className=className;container.appendChild(this.htmlEle)},add:function(tab){this.tabsArr.push(tab);this.htmlEle.appendChild(tab.element);Core.Events.addEvent(tab.element,Core.Function.bind3(this.swapTags,this,[tab]))},swapTags:function(tab){if(tab.isFocus==false){for(var i=0;i<this.tabsArr.length;i++){this.tabsArr[i].setAbort()}tab.setFocus()}else{return}}};var Tab=Core.Class.create();Tab.prototype={isShow:true,initialize:function(title,option){this.id=Core.Math.getUniqueId();this.option=option||{};var isFocus=option.isFocus||false;this.className=option.className||"";this.focus=option.onfocus?[option.onfocus]:[];this.abotrts=option.onabort?[option.onabort]:[];this.element=$C("li");if(option.cls){this.element.className=option.cls}isFocus?this.setFocus():this.setAbort();this.element.innerHTML=title},setAbort:function(){if(this.isFocus==false){return}if(this.option.cls){this.element.className=this.option.cls}else{this.element.className=""}this.isFocus=false;this.onabort()},setFocus:function(){this.element.className=this.className;this.isFocus=true;this.onfocus()},onabort:function(){for(var i=0;i<this.abotrts.length;i++){this.abotrts[i]()}},onfocus:function(){for(var i=0;i<this.focus.length;i++){this.focus[i]()}},addOnAbort:function(abortFunc){this.abotrts.push(abortFunc)},addOnFocus:function(focusFunc){this.focus.push(focusFunc)},hidden:function(){this.element.style.display="none"},hidden:function(){this.element.style.display="none";this.isShow=false},show:function(){this.element.style.display="block";this.isShow=true}};scope.faceTemplate=['<table id="#{entity}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}">插入表情</strong>','<cite><a id="#{btnClose}" href="javascript:;" class="CP_w_shut" title="关闭">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">','<div class="faceItemContent">','<div class="bigface">','<div id="#{faceTab}" class="faceSidebar">',"</div>",'<div id="#{faceContent}" class="faceShowAll">',"</div>","</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join("");Lib.Face=Core.Class.create();Lib.Face.prototype={dialog:null,dialogNodes:null,tabs:null,faceConfig:null,template:null,txtContentArea:null,x:0,y:0,isShowed:false,_isInitDialog:false,insertImageFile:"",initialize:function(txtContentArea,tpl){var _this=this;this.txtContentArea=txtContentArea;this.template=tpl;window.$insertFace=function(code,name){_this.insertFace(code,name)}},load:function(){var _this=this;this.dialog=new Dialog(this.template||scope.faceTemplate);this.dialogNodes=this.dialog.getNodes();this.tabs=new Tabs(this.dialogNodes["faceTab"]);Core.Events.addEvent(this.dialog.entity,function(){Core.Events.stopEvent()},"mousedown");Core.Events.addEvent(document.body,function(){_this.hidden()},"mousedown");this.initFaceConfig(function(){if(_this.tabs.tabsArr[0]){_this.tabs.tabsArr[0].setFocus()}Core.Events.addEvent(_this.dialogNodes["btnClose"],function(){_this.hidden()},"mousedown");_this.onInitialized()});this._isInitDialog=true},initFaceConfig:function(callBack){var _this=this;Utils.Io.JsLoad.request("http://www.sinaimg.cn/uc/myshow/blog/misc/gif/smileConfig.js?varname=smileConfig&"+(new Date).getTime(),{onComplete:function(data){_this.faceConfig=data;_this.initFaceData();if(callBack){callBack()}},charset:"gb2312"})},initFaceData:function(){var k,_this=this;for(k in this.faceConfig){this.addTab(k,this.faceConfig[k]["name"],this.faceConfig[k]["data"])}},onInitialized:function(){},textWatchOn:function(){var _oTextNode=this.txtContentArea;var getPos=function(){if(_oTextNode.createTextRange){_oTextNode.caretPos=document.selection.createRange().duplicate()}};Core.Events.addEvent(_oTextNode,getPos,"keyup");Core.Events.addEvent(_oTextNode,getPos,"focus");Core.Events.addEvent(_oTextNode,getPos,"select");Core.Events.addEvent(_oTextNode,getPos,"click")},addTab:function(key,tabName,contentData){var _this=this;var tab=new Tab('<img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+key+'.gif" height="20" width="20" align="absmiddle"><span><a href="#" onclick="return false;">'+tabName+"</a></span><em>("+contentData.length+")</em>",{isFocus:false,className:"cur"});tab.addOnAbort(function(){tab.content.style.display="none"});tab.addOnFocus(function(){if(!tab.isShowed){tab.isShowed=true;tab.content=$C("ul");tab.content.innerHTML=_this._getTabContent(key,contentData);_this.dialogNodes["faceContent"].appendChild(tab.content)}tab.content.style.display=""});this.tabs.add(tab)},_getTabContent:function(key,contentData){var str=[],faceName;var i,len=contentData.length;for(i=0;i<len;i++){faceName=contentData[i]["name"];faceName=Core.String.byteLength(faceName)>8?Core.String.leftB(faceName,6)+"...":faceName;str.push("<li><a onclick=\"$insertFace('"+contentData[i]["code"]+"','"+contentData[i]["name"]+'\');return false;" href="#"><img style="width:50px;height:50px;" title="'+contentData[i]["name"]+'" src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+contentData[i]["code"]+'T.gif"/></a><span>'+faceName+"</span></li>")}return str.join("")},insertFace:function(code,name){this.insertImageFile=code+"T.gif";this.onInsert();if(!this.txtContentArea){return}var faceValue="[emoticons="+code+"]"+name+"[/emoticons]";if($IE){if(this.txtContentArea.createTextRange&&this.txtContentArea.caretPos){var caretPos=this.txtContentArea.caretPos;caretPos.text=caretPos.text.charAt(caretPos.text.length-1)==" "?faceValue+" ":faceValue;this.txtContentArea.focus()}else{this.txtContentArea.value+=faceValue;this.txtContentArea.focus()}}else{if(this.txtContentArea.setSelectionRange){var rangeStart=this.txtContentArea.selectionStart;var rangeEnd=this.txtContentArea.selectionEnd;var tempStr1=this.txtContentArea.value.substring(0,rangeStart);var tempStr2=this.txtContentArea.value.substring(rangeEnd);this.txtContentArea.value=tempStr1+faceValue+tempStr2}else{this.txtContentArea.value+=faceValue}}this.hidden();return false},onInsert:function(){},setPosition:function(x,y){this.x=x;this.y=y;this.dialog.setPosition({x:x,y:y})},show:function(){!this._isInitDialog&&this.load();this.dialog.show();this.isShowed=true},hidden:function(){this.isShowed=false;this.dialog.hidden()}};App.insertSmile=Core.Class.create();App.insertSmile.prototype={initialize:function(sTextarea,sInsertButton,callback){this.btnShowFaceEditor=$E(sInsertButton);this.txtComment=$E(sTextarea);this.callback=callback;this.faceEditor=new Lib.Face(this.txtComment)},set:function(sTextarea,sInsertButton){this.btnShowFaceEditor=$E(sInsertButton);this.txtComment=$E(sTextarea);var _this=this;_this.faceEditor.txtContentArea=this.txtComment;if(_this.faceEditor.isShowed){_this.faceEditor.hidden()}else{if(!_this.faceEditor.isLoad){_this.faceEditor.load();_this.initFace();_this.faceEditor.isLoad=true}var contid="cmscnt_"+_this.txtComment.id.split("_")[2];var x=Core.Dom.getLeft($E(contid));var y=Core.Dom.getTop(_this.btnShowFaceEditor)+_this.btnShowFaceEditor.offsetHeight+10;_this.faceEditor.setPosition(x,y);_this.faceEditor.show()}if(_this.faceEditor.txtContentArea.isWatched==null){_this.faceEditor.textWatchOn();_this.faceEditor.txtContentArea.isWatched=true}},initFace:function(){var _this=this;Core.Events.addEvent(this.faceEditor.dialogNodes.btnClose,function(){_this.faceEditor.hidden()},"mousedown");Core.Events.addEvent(document.body,function(){_this.faceEditor.hidden()},"mousedown");Core.Events.addEvent(this.faceEditor.dialog.entity,function(){Core.Events.stopEvent()},"mousedown")}};Core.Math.getRandomNumber=function(_start,_end){if(isNaN(_start)||isNaN(_end)||_start<0&&_end<0){return null}var _s=Math.ceil(Math.min(_start,_end));var _e=Math.floor(Math.max(_start,_end));_s=_s>0?_s:0;return Math.round(_s+Math.random()*(_e-_s))};App.textareaAutoHeight=function(sTextareaId,sClassName){$E(sTextareaId).setAttribute("fakeClass",sClassName);var fakeTextarea;if($E("fakeTextarea")==null){fakeTextarea=$C("textarea");fakeTextarea.id="fakeTextarea";fakeTextarea.className=sClassName;document.body.appendChild(fakeTextarea)}var change=function(e){var _evt=Core.Events.getEvent();var __target=_evt.target||_evt.srcElement;var _fakeClass=__target.getAttribute("fakeClass");var _fakeTextarea=$E("fakeTextarea");if(_fakeTextarea.className!=_fakeClass){_fakeTextarea.className=_fakeClass}setTimeout(function(){_fakeTextarea.value=__target.value;!isNaN(_fakeTextarea.scrollHeight)&&(__target.style.height=Math.max(_fakeTextarea.scrollHeight,39)+"px")},10)};Core.Events.addEvent(sTextareaId,change,"keyup");Core.Events.addEvent(sTextareaId,change,"propertychange");Core.Events.addEvent(sTextareaId,change,"input")};$SYSMSG.extend({B36001:"操作失败，此博文不存在或被删除。",B36002:"验证码错误，请重新输入。",B36003:"请输入昵称。",B36004:"登录名或密码错误。",B36005:"呢称不能使用此类特殊词汇，请重新输入。",B36006:"昵称必须是8个中文或16个字符以内，且不能为纯数字，请重新输入。",B36007:"呢称不能使用此类特殊词汇，请重新输入。",B36008:"不能3秒内连续发评论，请梢后再试。",B36009:"不能发内容重复的评论。",B36020:"暂无评论。",B36021:"暂无评论。",B36022:"评论内容必须是1000中文或2000字符以内，请重新输入。",B36023:"对不起，黑名单已达到上限",B36024:"对方拒绝了你的评论。",B36031:"操作失败，此评论不存在或被删除。",B36032:"操作失败，此评论不存在或被删除。",B36033:"操作失败，此评论不存在或被删除。",B36041:"请输入回复内容。",B36042:"回复内容必须是1000中文或2000字符以内，请重新输入。",B36043:"操作失败，自己不能回复自己的评论。",B36101:"操作失败，此博文不存在或被删除。",B36102:"评论发布失败，此博文设置不允许评论。",B36103:"操作失败，此评论不存在或被删除。",B36104:"评论已发布，需要审核后才能显示，请稍候…",B36113:"博主已关闭匿名评论，请登录后再评论",B36105:"请输入评论内容。",B36106:"请输入验证码。",B36107:"请输入登录名。",B36108:"请输入密码。",B36109:"读取中，请稍候…",B36110:"读取失败，请刷新。",B36111:"确定要删除此评论吗？删除后不可恢复。",B36112:"确定要删除此回复吗？删除后不可恢复。",B36115:"请拖动滑块儿开始验证",B36201:"确定要删除此评论吗？删除后不可恢复。",B36202:"确定要删除此回复吗？删除后不可恢复。",B36203:"请选择要删除的内容。",B36204:"已回复该评论，请勿重复提交。",B36998:"系统维护中，服务暂不可用。",B36999:"对不起，您短时间发表的留言过多，请多休息会，注意身体！感谢您对新浪博客的支持和关注！",36999:"对不起，您短时间发表的留言过多，请多休息会，注意身体！感谢您对新浪博客的支持和关注！",B90001:"抱歉，该文章不允许评论。",A20013:"您已经发送多条相似内容了哦，请先休息一下吧~",A20014:"已经有很多博主发过相似评论了，换个内容会更精彩~",B36205:"请登录后在回复评论",B36206:"对不起，您已被对方列入黑名单，无法发评论。",B36207:"请登录后在删除评论",B36208:"评论内容必须是140中文或280字符以内，请重新输入",B36209:"此条评论已被原博主删除",B36210:"博主已关闭评论功能",B36211:"此博文已被博主设为私密",A00004:"此评论不存在或已被博主删除"});Comment2TSina=Core.Class.create();Comment2TSina.prototype={aid:0,data:null,initialize:function(aid,data){this.aid=aid||0;this.data=data||{};scope.$temp_commCtt=this.data.weibo_content;scope.$temp_commId=this.data.blog_id},writeCommTips:function(){if(!$E("bb_share_"+this.aid)){return}var html="";var tips=$E("writeComm_tips_"+this.aid);if(!tips){var tips_box=$C("div");tips_box.className="writeComm_tips_box";tips_box.style.display="none";tips_box.innerHTML='<span class="writeComm_tips" id="writeComm_tips_'+this.aid+'"><strong></strong><cite><a href="javascript:;">关闭</a></cite></span>';var cmt_write=$E("cms_input_"+this.aid);if(cmt_write){cmt_write.parentNode.insertBefore(tips_box,cmt_write)}else{return}tips=tips_box.firstChild;Core.Events.addEvent(tips.lastChild,function(){tips_box.style.display="none"},"click");this.bindTipsEvents(tips)}var tbox=tips.parentNode,content=tips.firstChild;tbox.style.display="none";if(this.data.re_weibo==="success"){content.innerHTML='评论成功同步到微博，<a href="http://weibo.com/'+this.data.t_sina+'/profile" target="_blank">点此查看</a>';tbox.style.display="block"}else if(this.data.re_weibo==="no_bind"){content.innerHTML='评论分享失败，您需要先<a href="javascript:void(0);">绑定微博</a>';tbox.style.display="block"}},bindTipsEvents:function(tips){Core.Events.addEvent(tips.firstChild,function(event){Core.Events.stopBubble(event);if(Core.Events.getEventTarget(event).tagName.toLowerCase()!="a"){return}var txt=tips.firstChild.lastChild.innerHTML;if(txt==="点此查看"){tips.parentNode.style.display="none"}else if(txt==="绑定微博"){tips.parentNode.style.display="none";this.bindToTSina()}}.bind2(this),"click")},openStep:function(){var me=this;Utils.Io.Ijax.request("http://control.blog.sina.com.cn/riaapi/tshow/send_cms_weibo.php",{POST:{uid:$UID,blog_id:scope.$temp_commId,content:scope.$temp_commCtt,isphoto:0},onComplete:function(data){data=eval("("+data+")")||{};if(data.code==="A00006"){var tips=$E("writeComm_tips_"+me.aid);tips.parentNode.style.display="block";tips.firstChild.innerHTML='评论成功同步到微博，<a href="http://weibo.com/'+data.data+'/profile" target="_blank">点此查看</a>'}else if(data.code==="B00001"){winDialog.alert("您的博客还未绑定新浪微博，现在绑定？",{icon:"04",funcOk:function(){me.bindToTSina()}})}else if(data.code==="A00004"||data.code==="A11007"){me.shareToT()}else{trace("data.code="+data.code);winDialog.alert("网络繁忙，请稍后再试。",{icon:"01"})}},onException:function(msg,url){trace("msg="+msg+", url="+url);winDialog.alert("网络繁忙，请稍后再试。",{icon:"01"})}})},bindToTSina:function(){var me=this;var url="http://control.blog.sina.com.cn/t_sina_blog/bind_weibo_form.php?from=js&domain="+document.domain;window.open(url,"mb","toolbar=0,status=0,resizable=1,width=440,height=430,left="+(screen.width-440)/2+",top="+(screen.height-430)/2);window.tOkBack=function(){trace("微博绑定回调ok函数！");winDialog.alert("绑定微博成功",{icon:"03",funcOk:function(){me.openStep()},funcClose:function(){me.openStep()}})};window.tFailBack=function(){trace("微博绑定 fail");winDialog.alert("网络繁忙，请稍后再试。",{icon:"01"})}},shareToT:function(){var shareWord=scope.$temp_commCtt;if(shareWord){var title=encodeURIComponent(shareWord);var f="http://v.t.sina.com.cn/share/share.php?",r="新浪-博客",l="http://blog.sina.com.cn",u="http://v.t.sina.com.cn/share/share.php?searchPic=false&title="+title+"&url="+encodeURIComponent(document.location)+"&source="+r+"&sourceUrl="+encodeURIComponent(l)+"&content=utf-8&appkey=1617465124";window.open(u,"selectionshare","toolbar=0,status=0,resizable=1,width=440,height=430,left="+(screen.width-440)/2+",top="+(screen.height-430)/2)}else{winDialog.alert("分享的内容不能为空",{icon:"01"})}$E("writeComm_tips_"+this.aid).parentNode.style.display="none"}};var showUpTips=function(){winDialog.alert('您可以在<a href="http://get.adobe.com/flashplayer/" target="_blank">此处下载免费的Adobe flash player installer</a>。成功安装程序后，可返回此处查看。',{icon:"01"})};scope.magicCfg={};window.$magicFacePlay=function(swfName){var ver;if(!scope.flashVersion){scope.flashVersion=deconcept.SWFObjectUtil.getPlayerVersion()}ver=scope.flashVersion;if(ver.major<9){showUpTips();return}Core.Events.stopEvent();var cfg={alphaNodeId:"alphaNode",containerDiv:"magicFaceCon"};var layer=['<div id="magicFaceCon" title="" alt="" style="height:360px; width:360px;">',"</div>"].join("");scope.magicCfg.layer=new Lib.Panel;scope.magicCfg.layer.setTemplate('<div style="position:absolute;z-index:2000;" id="#{panel}" title="" alt="">'+layer+"</div>");scope.magicCfg.layer.show();var swfId="magicFace";var addSwf=function(){scope.magicCfg.shadow=new BackShadow(.4);scope.magicCfg.shadow.entity.setAttribute("title","点击关闭动画");scope.magicCfg.shadow.entity.setAttribute("alt","点击关闭动画");scope.magicCfg.shadow.entity.style.zIndex=4e3;scope.magicCfg.shadow.entity.onclick=removeSwf;Core.Events.addEvent(document,escDown,"keydown");scope.magicCfg.shadow.show();var win=Core.System.winSize();var scroll=Core.System.getScrollPos(document);var _x=win.width/2-360/2+scroll[1];var _y=win.height/2-360/2+scroll[0];scope.magicCfg.layer.setPosition(_x,_y);var overlayDiv=document.createElement("div");overlayDiv.id="___flashOverlay";overlayDiv.style.cssText="cursor:pointer;visibility:hidden;background:white;;z-index:3000;position:absolute;width:360px;height:360px;top:"+_y+"px;left:"+_x+"px";document.body.appendChild(overlayDiv);if(document.all){overlayDiv.style.filter="Alpha(Opacity=0)"}else{overlayDiv.style.opacity=0}overlayDiv.style.visibility="visible";Core.Events.addEvent(overlayDiv,function(){window.open("http://blog.sina.com.cn/myshow2010")});overlayDiv=null;var FlashPlayer=new Utils.Flash.swfObject("http://www.sinaimg.cn/uc/myshow/blog/misc/gif/"+swfName+"?t="+Core.Math.getUniqueId(),swfId,360,360,9,"#FFFFFF");FlashPlayer.addParam("quality","high");FlashPlayer.addParam("wmode","transparent");FlashPlayer.addParam("allowScriptAccess","always");FlashPlayer.write(cfg.containerDiv)};var removeSwf=function(){trace("swf remove!!!");var con=$E(cfg.containerDiv);if(con){con.innerHTML=""}window.clearInterval(timer);Core.Events.removeEvent(document,escDown,"keydown");try{scope.magicCfg.shadow.close();scope.magicCfg.layer.close();Core.Events.stopEvent()}catch(e){}if($E("___flashOverlay")){document.body.removeChild($E("___flashOverlay"))}};var escDown=function(e){var curKey=e.keyCode||e.which||e.charCode;if(curKey===27){removeSwf();Core.Events.removeEvent(document,escDown,"keydown");Core.Events.stopEvent();return false}};addSwf();var timer=window.setInterval(function(){trace("……追踪 进度……");var swf=$E(swfId);var snap=0;if(swf&&swf.PercentLoaded()==100){swf.onclick=function(){Core.Events.stopEvent()};trace("swf 加载完毕了………………");var con=swf.parentNode;var scroll=Core.System.getScrollPos(document);var win=Core.System.winSize();var _x=win.width/2-con.offsetWidth/2+scroll[1];var _y=win.height/2-con.offsetHeight/2+scroll[0];scope.magicCfg.layer.setPosition(_x,_y);scope.magicCfg.layer.show();trace("flash size x="+con.offsetWidth+"  y="+con.offsetHeight);window.clearInterval(timer);timer=window.setInterval(function(){var curr=swf.CurrentFrame();var total;try{total=swf.TotalFrames()}catch(e){total=swf.TotalFrames}if(curr<0){return}if(curr<total&&snap<=curr){snap=curr}else{removeSwf()}},80)}},100)};App.smilesTemplate=['<table id="#{entity}" class="CP_w faceItemContent" style="visibility: visible;">','<thead id="#{titleBar}"><tr><th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">插入表情</strong><cite><a id="#{btnClose}"',' href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th></tr></thead>','<tfoot><tr><td class="tLeft"><span></span></td><td class="tMid"><span></span></td>','<td class="tRight"><span></span></td></tr></tfoot>',"<tbody><tr>",'<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">','<div class="insertface">','<div class="insertface_top">','<h3>热门动漫表情</h3><div class="insertface_search">','<input id="#{searchText}" type="text" class="SG_input" value="输入关键字、动漫形象"',' style="color:#9b9b9a;" maxlength="20" /><a id="#{searchBtn}" href="#" onclick="return false;" ','hidefocue="true" class="SG_aBtn SG_aBtnB"><cite>查找表情</cite></a></div>','<div class="clearit"></div>',"</div>",'<div class="insertface_hot">','<span class="insertface_keyword">热门关键字：<span id="#{hotKeyword}"></span></span>','<span class="insertface_hotslider"></span>',"</div>",'<div class="bigface">','<div class="faceSidebar">','<div id="#{keyCtrl}" class="facekeyword" style="display:none;">','<p><< <a id="#{keyCtrlBack}" href="#" onclick="return false;">返回全部关键字</a></p>','<p>关键字：<span id="#{keyWord}"></span></p></div>','<h3 id="#{allSort}" class="facetitle" style="font-weight:600;"><a href="#"',' onclick="return false;">全部</a></h3>','<div id="#{sortList}" class="facelist"></div>','<div id="#{sortCtrl}" class="facearrow"></div>',"</div>",'<div class="faceShowAll">','<div id="#{smileEmpty}" class="faceShownone" style="display:none;"><p>找不到和关键字相符的表情。','<br /><br /><a id="#{smileEmptyBack}" href="#" onclick="return false;">&lt;&lt;返回首页</a></p></div>','<ul class="faceShowAll_list" id="#{smileList}"></ul>','<div class="SG_page"><ul class="SG_pages">','<li id="#{smilePagePrev}" class="SG_s_pgprev"></li>','<li id="#{smilePageShow}" class="SG_s_pgnum"></li>','<li id="#{smilePageNext}" class="SG_s_pgnext"></li>','<li class="play" id="#{magicTip}">点击<img align="absmiddle" src="http://simg.sinajs.cn/blog7style/images/common/img_arrow_r.gif">预览动画效果</li>',"</ul></div>","</div>","</div>","</div>",'</td><td class="tRight"><span></span></td>',"</tr></tbody></table>"].join("");App.smilesDialog2=Core.Class.create();App.smilesDialog2.prototype={pageSize:24,defaultConfig:{sortId:"0",htmlTpl:App.smilesTemplate,callback:function(){}},initialize:function(oOption){this.option=oOption||{};for(var key in this.defaultConfig){if(this.option[key]==null){this.option[key]=this.defaultConfig[key]}}this.dialog=new Dialog(this.option.htmlTpl);this.dialog.setAreaLocked(true);this.dialogNodes=this.dialog.getNodes();this.getKeyWord();if(scope.smilesData!=null){this.data=scope.smilesData;this.dataSettle();this.eventListen()}else{var __this=this;var smileData=Utils.Io.JsLoad.request([{url:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/smileConfig8.js?varname=smileConfig"}],{onComplete:function(oData){scope.smilesData=oData;__this.data=oData;__this.dataSettle();__this.eventListen()},onException:function(){}})}return this},dataSettle:function(oData,nCount){oData=oData||this.data;nCount=nCount||9;this.tabsData=[];this.allData=[];for(var key in oData){var _item=oData[key];_item.sortId=key;this.tabsData.push(_item);for(var i=0,len=_item.data.length;i<len;i++){_item.data[i].sid=key;_item.data[i].sname=_item.name}this.allData=this.allData.concat(_item.data)}if(this.allDataBack==null&&this.allData.length>0){this.allDataBack=this.allData.slice(0)}this.showTab(1,nCount);if(this.dialogNodes.smileList.childNodes.length==0){this.showAll()}},children:function(chs){var cArr=[];for(var i=0;chs[i];i++){if(chs[i].nodeType==1){cArr.push(chs[i])}}return cArr},showTab:function(nPage,nCount){nPage=nPage||1;nCount=nCount||9;this.dialogNodes.sortList.innerHTML="";this.dialogNodes.smileList.innerHTML="";Core.Dom.setStyle(this.dialogNodes.sortList,"height",nCount==9?"279px":"217px");this.tabs=new Tabs(this.dialogNodes.sortList);this.tabsObject={};var _this=this;for(var i=0;i<nCount;i++){var _indexBase=(nPage-1)*nCount;if(this.tabsData[_indexBase+i]==null){break}var _sortId=this.tabsData[_indexBase+i].sortId;var _name=this.tabsData[_indexBase+i].name;var _data=this.tabsData[_indexBase+i].data;var tab=new Tab('<img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+_sortId+'.gif" height="20" width="20" align="absmiddle"><div><span><a href="#" onclick="return false;" title="'+_name+'">'+_name+"</a></span><em>("+_data.length+")</em></div>",{isFocus:false,className:"cur"});tab.addOnAbort(Core.Function.bind3(function(tab){},null,[tab]));tab.addOnFocus(Core.Function.bind3(function(tab,key,data,sid){_this.showSmile(data,1,_this.pageSize);_this.currentTab=tab;_this.dialogNodes.allSort.style.fontWeight=400;if(!_this.isFromUp){var pId=scope.$pageid;if(pId){var isComm=scope.isFromtheCommonhzh;if(isComm){v7sendLog($_GLOBAL.faceChooseTable[pId][isComm]+"_16_020_"+sid,pId,"")}}}_this.isFromUp=null},null,[tab,_indexBase+i,_data,_sortId]));this.tabsObject[_sortId]=tab;this.tabs.add(tab)}var _tabPageCount=Math.ceil(this.tabsData.length/nCount);if(_tabPageCount>0){this.showTabPage(nPage||1,_tabPageCount,nCount)}else{this.dialogNodes.sortCtrl.innerHTML=""}},showSmile:function(oData,nPage,nCount){var me=this;nCount=nCount||this.pageSize;var __this=this;var _smiles=oData;var _count=_smiles.length;var _totalPages=Math.ceil(_count/nCount);var _smilesDom=document.createDocumentFragment();var _pageLink;this.dialogNodes.smileList.innerHTML="";this.dialogNodes.magicTip.style.cssText="display:none;";for(var i=0;i<nCount;i++){var _smile=_smiles[(nPage-1)*nCount+i];if(_smile==null){break}var _li=$C("li");var _a=$C("a");_a.href="#";_a.onclick=function(){return false};_a.onmousedown=Core.Function.bind3(function(nCode,sName,swfName){__this.hide();__this.option.callback(nCode,sName,swfName)},null,[_smile.code,_smile.name,_smile.swf||null]);_a.innerHTML='<img style="width:50px;height:50px;" src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+_smile.code+'T.gif" alt="'+_smile.name+'" title="'+_smile.name+'" />';_li.appendChild(_a);_a.setAttribute("key",_smile.code);var _span=$C("span");_span.title=_smile.name;_span.innerHTML=Core.String.byteLength(_smile.name)>8?Core.String.leftB(_smile.name,6)+"…":_smile.name;_li.appendChild(_span);if(_smile.swf){var _div=$C("div");_div.innerHTML='<a href="#"   onclick="window.$magicFacePlay(\''+_smile.swf+'\');return false;"><img height="13" title="播放表情" align="absmiddle" width="14" alt="" src="http://simg.sinajs.cn/blog7style/images/common/img_arrow_r.gif"></a>';_div.className="arr_r";_li.appendChild(_div);this.dialogNodes.magicTip.style.cssText="display:block;"}_smilesDom.appendChild(_li);Core.Events.addEvent(_a,function(ele){return function(){var pId=scope.$pageid;if(pId){var isComm=scope.isFromtheCommonhzh;if(isComm){v7sendLog($_GLOBAL.faceChooseTable[pId][isComm]+"_16_010_"+ele.getAttribute("key"),pId,"")}}}}(_a),"mousedown")}this.dialogNodes.smileList.appendChild(_smilesDom);if(_count>nCount){if(nPage==1){this.dialogNodes.smilePagePrev.innerHTML="上一页"}else{this.dialogNodes.smilePagePrev.innerHTML="";_pageLink=$C("a");_pageLink.href="#";_pageLink.onclick=function(){return false};_pageLink.onmousedown=function(){__this.showSmile(_smiles,nPage-1,nCount)};_pageLink.innerHTML="上一页";this.dialogNodes.smilePagePrev.appendChild(_pageLink)}this.dialogNodes.smilePageShow.innerHTML=nPage+"/"+_totalPages;if(nPage>=_totalPages){this.dialogNodes.smilePageNext.innerHTML="下一页"}else{this.dialogNodes.smilePageNext.innerHTML="";_pageLink=$C("a");_pageLink.href="#";_pageLink.onclick=function(){return false};_pageLink.onmouseup=function(){__this.showSmile(_smiles,nPage+1,nCount)};_pageLink.innerHTML="下一页";this.dialogNodes.smilePageNext.appendChild(_pageLink)}}else{this.dialogNodes.smilePagePrev.innerHTML="";this.dialogNodes.smilePageShow.innerHTML="";this.dialogNodes.smilePageNext.innerHTML=""}},showTabPage:function(nPageNum,nPageCount,nTabsPerPage){this.dialogNodes.sortCtrl.innerHTML="";this.dialogNodes.smilePagePrev.innerHTML="";this.dialogNodes.smilePageShow.innerHTML="";this.dialogNodes.smilePageNext.innerHTML="";var __this=this;var _arrow;if(nPageNum==1){if(nPageNum!=nPageCount){this.dialogNodes.sortCtrl.innerHTML='<a href="#" onclick="return false;" title="向上" class="up_off"></a>';_arrow=$C("a");_arrow.href="#";_arrow.onclick=function(){return false};_arrow.title="向下";_arrow.className="down";_arrow.onmousedown=function(){__this.showTab(nPageNum+1,nTabsPerPage);__this.showAll()};this.dialogNodes.sortCtrl.appendChild(_arrow)}else{}}else if(nPageNum<nPageCount){_arrow=$C("a");_arrow.href="#";_arrow.onclick=function(){return false};_arrow.title="向上";_arrow.className="up";_arrow.onmousedown=function(){__this.showTab(nPageNum-1,nTabsPerPage);__this.showAll()};this.dialogNodes.sortCtrl.appendChild(_arrow);_arrow=$C("a");_arrow.href="#";_arrow.onclick=function(){return false};_arrow.title="向下";_arrow.className="down";_arrow.onmousedown=function(){__this.showTab(nPageNum+1,nTabsPerPage);__this.showAll()};this.dialogNodes.sortCtrl.appendChild(_arrow)}else{_arrow=$C("a");_arrow.href="#";_arrow.onclick=function(){return false};_arrow.title="向上";_arrow.className="up";_arrow.onmousedown=function(){__this.showTab(nPageNum-1,nTabsPerPage);__this.showAll()};this.dialogNodes.sortCtrl.appendChild(_arrow);Core.Dom.addHTML(this.dialogNodes.sortCtrl,'<a href="#" onclick="return false;" title="向下" class="down_off"></a>')}},eventListen:function(){var __this=this;var _searchText=__this.dialogNodes.searchText;var _searchBtn=__this.dialogNodes.searchBtn;var _keywordBack=__this.dialogNodes.keyCtrlBack;var _allSort=__this.dialogNodes.allSort;var _smileEmptyBack=__this.dialogNodes.smileEmptyBack;Core.Events.addEvent(document.body,function(cls){var _event=Core.Events.getEvent(),_eventTarget=$IE?_event.srcElement:_event.target;if(__this.dialogNodes.entity!=null&&(Core.Dom.contains(__this.dialogNodes.entity,_eventTarget)==false||cls==true)){__this.hide()}});Core.Events.addEvent(this.dialogNodes.btnClose,function(){__this.hide()});Core.Events.addEvent(_searchText,function(){if(Core.String.trim(_searchText.value)=="输入关键字、动漫形象"){_searchText.value="";_searchText.style.color="#000"}_searchText.select()},"focus");Core.Events.addEvent(_searchText,function(){if(Core.String.trim(_searchText.value)==""){_searchText.value="输入关键字、动漫形象";_searchText.style.color="#9b9b9a"}},"blur");Core.Events.addEvent(_searchText,function(e){var _evt=Core.Events.getEvent();var _key=_evt.which||_evt.keyCode;var _keyword=Core.String.trim(_searchText.value);if(_key==13&&_keyword!=""){__this.searchKey(_keyword)}},"keydown");Utils.Form.limitMaxLen(_searchText,20);Core.Events.addEvent(_searchBtn,function(){if(_searchText.value=="输入关键字、动漫形象"||_searchText.value==""){}else{__this.searchKey(_searchText.value);_searchText.focus()}});var _backHome=function(){__this.dataSettle(__this.data,9);__this.dialogNodes.keyCtrl.style.display="none";__this.dialogNodes.smileEmpty.style.display="none";__this.dialogNodes.smileList.style.display="";__this.dialogNodes.searchText.value="输入关键字、动漫形象";__this.dialogNodes.searchText.style.color="#9b9b9a"};Core.Events.addEvent(_keywordBack,_backHome);Core.Events.addEvent(_smileEmptyBack,_backHome);Core.Events.addEvent(_allSort,function(){__this.showAll()})},showAll:function(){this.showSmile(this.allData,1,this.pageSize);

this.dialogNodes.allSort.style.fontWeight=600;if(this.currentTab!=null){this.currentTab.setAbort()}},setSort:function(sId,fCallback){this.isFromUp=sId;this.option.sortId=sId;this.option.callback=fCallback;if(sId==0){this.dialogNodes.allSort.style.fontWeight=600;this.dataSettle()}else{this.dataSettle();this.tabs.swapTags(this.tabsObject[sId])}},getKeyWord:function(){if(this.keywordData!=null){return}var __this=this;var smileData=Utils.Io.JsLoad.request("http://www.sinaimg.cn/uc/myshow/blog/misc/gif/smileKeywordConfig.js?varname=smileKeywordConfig",{onComplete:function(oData){__this.keywordData=oData;var _hotkey=oData.E___00000000000||"顶|路过|哭|啦啦|美女";var _hotDom=document.createDocumentFragment();_hotkey=_hotkey.split("|");for(var i=0,len=_hotkey.length;i<len;i++){var _link=$C("a");_link.href="#";_link.onclick=function(){return false};_link.onmousedown=Core.Function.bind3(function(sHotkey){__this.searchKey(sHotkey)},null,[_hotkey[i]]);_link.innerHTML=_hotkey[i];if(_hotkey[i]=="魔法表情"){var img=$C("img");img.style.cssText="height:15px; width:15px;";img.setAttribute("align","absmiddle");img.src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif";img.className="SG_icon SG_icon68 img_m";_hotDom.appendChild(img)}_hotDom.appendChild(_link)}if(__this.dialogNodes.hotKeyword.innerHTML==""){__this.dialogNodes.hotKeyword.appendChild(_hotDom)}var _hotKeyAll="";for(var key in oData){if(key!="E___00000000000"){_hotKeyAll+="∑"+key+"§"+oData[key]}}__this.keywordStr=_hotKeyAll},onException:function(){}})},searchKey:function(sHotkey){var _regSearchKey=sHotkey.replace(/([\\^$*+?{}.|])/gi,"\\$1");var searchReg=new RegExp("∑([^§]+)§[^∑]*"+_regSearchKey+"[^∑]*","gi");var _resultArray=[];this.keywordStr.replace(searchReg,function(a,b){_resultArray.push(b)});_resultArray=_resultArray.join(",");var _result={};var _allData=this.allDataBack;var _len=_allData.length;var _count=0;for(var i=0;i<_len;i++){if(_resultArray.indexOf(_allData[i].code)!=-1||_allData[i].sname.indexOf(sHotkey)!=-1||_allData[i].name.indexOf(sHotkey)!=-1){if(_result[_allData[i].sid]==null){_result[_allData[i].sid]={name:_allData[i].sname,data:[]}}_result[_allData[i].sid].data.push(_allData[i]);_count++}}var pid=scope.$pageid;if(_count==0){this.dialogNodes.smileEmpty.style.display="";this.dialogNodes.smileList.style.display="none";if(pid){var isComm=scope.isFromtheCommonhzh;if(isComm){v7sendLog($_GLOBAL.faceChooseTable[pid][isComm]+"_16_030_"+encodeURIComponent(sHotkey),pid,"")}}}else{this.dialogNodes.smileList.style.display="";this.dialogNodes.smileEmpty.style.display="none";if(pid){var isComm=scope.isFromtheCommonhzh;if(isComm){v7sendLog($_GLOBAL.faceChooseTable[pid][isComm]+"_16_031_"+encodeURIComponent(sHotkey),pid,"")}}}this.dataSettle(_result,7);this.dialogNodes.keyCtrl.style.display="";this.dialogNodes.keyWord.innerHTML=sHotkey.split("").join("<wbr/>");Core.Dom.setStyle(this.dialogNodes.sortList,"height","217px")},setPosition:function(x,y){this.x=x;this.y=y;this.dialog.setPosition({x:x,y:y})},show:function(){this.dialogNodes.searchText.value="输入关键字、动漫形象";this.dialogNodes.searchText.style.color="#9b9b9a";this.dialog.show()},hide:function(){this.dialog.hidden();this.dialogNodes.keyCtrl.style.display="none"}};App.insertSmilesForm2=Core.Class.create();App.insertSmilesForm2.prototype={defalutConfig:{sortCount:6,clickCallback:function(){},recommCount:8},initialize:function(oOption){this.option=oOption||{};if(this.option.sortNode==null){return}for(var key in this.defalutConfig){if(this.option[key]==null){this.option[key]=this.defalutConfig[key]}}if(scope.smilesData==null){this.getSmilesData()}else{this.data=scope.smilesData;this.renderUI()}},getSmilesData:function(){var __this=this;var smileData=Utils.Io.JsLoad.request([{url:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/smileConfig8.js?varname=smileConfig"}],{onComplete:function(oData){scope.smilesData=oData;__this.data=oData;__this.renderUI()},onException:function(){}})},renderUI:function(){var __this=this;var count=1;var first6sort=[];var first6hot=[];var firstSort;var _fragement=document.createDocumentFragment();var _sorts=$C("div");var _more=$C("span");var _clearit=$C("div");_sorts.className="facestyle";for(var key in this.data){if(count==1){firstSort=this.data[key]||{data:{}};firstSort=firstSort.data}if(count<=this.option.sortCount){var _title=this.data[key].name;var node=$C("a");node.href="#";node.setAttribute("key",key);node.onclick=function(){Core.Events.stopEvent();return false};node.onmousedown=Core.Function.bind3(function(key){App.insertSmilesDialog2(key,__this.option.clickCallback,__this.option.positionNode,__this.option.arrPosPix)},null,[key]);node.hideFocus=true;node.innerHTML='<img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+key+'-25.gif" alt="'+_title+'" title="'+_title+'" />';_sorts.appendChild(node);count++}else{break}}var timpStamp=(new Date).getTime();_sorts.id="recomm_"+timpStamp;_fragement.appendChild(_sorts);_more.className="SG_more";var _morelink=$C("a");_morelink.href="#";_morelink.onclick=function(){Core.Events.stopEvent();return false};_morelink.onmousedown=function(ele){return function(){App.insertSmilesDialog2(0,__this.option.clickCallback,__this.option.positionNode,__this.option.arrPosPix);var pid=scope.$pageid;if(pid){var ppId=ele.parentNode.parentNode.id.split("_")[0];if(ppId){scope.isFromtheCommonhzh=$_GLOBAL.faceCountMoreLinkTable[pid][ppId][1];v7sendLog($_GLOBAL.faceCountMoreLinkTable[pid][ppId][0]+"_07_000_000",pid,"")}}}}(_morelink);_morelink.innerHTML="更多>>";_more.appendChild(_morelink);_fragement.appendChild(_more);_clearit.className="clearit";_fragement.appendChild(_clearit);$E(this.option.sortNode).appendChild(_fragement);if($E(this.option.recommNode)!=null){_fragement=document.createDocumentFragment();for(var i=0;i<this.option.recommCount;i++){_title=firstSort[i].name;var _code=firstSort[i].code;var _swfName=firstSort[i].swf;node=$C("li");(function(val){node.onclick=Core.Function.bind3(function(key,title,swfName){__this.option.clickCallback(key,title,swfName);var pid=scope.$pageid;if(pid){val+="";val=val.length==1?"0"+val:val;v7sendLog($_GLOBAL.faceCountRecommLinkTable[pid]+"_"+val+"_010_"+key,pid,"")}Core.Events.stopEvent();return false},null,[_code,_title,_swfName])})(i+8);node.hideFocus=true;var tempHTML='<a href="#"><img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+_code+'T.gif" alt="'+_title+'" title="'+_title+'" height="50" width="50"/></a>';if(_swfName){tempHTML=tempHTML+'<div class="arr"><a href="#" onclick="window.$magicFacePlay(\''+_swfName+'\');return false;" ><img src="http://simg.sinajs.cn/blog7style/images/common/img_arrow_r.gif" width="14" height="13" title="播放表情" alt="" align="absmiddle" /></a></div>'}node.innerHTML=tempHTML;_fragement.appendChild(node)}$E(this.option.recommNode).appendChild(_fragement)}var _sChildren=Lib.children($E("recomm_"+timpStamp).childNodes);for(var i=0;_sChildren[i];i++){Core.Events.addEvent(_sChildren[i],function(ele,val){return function(){var pid=scope.$pageid;if(pid){var ppId=ele.parentNode.parentNode.id.split("_")[0];if(ppId){scope.isFromtheCommonhzh=$_GLOBAL.faceCountMoreLinkTable[pid][ppId][1];v7sendLog($_GLOBAL.faceCountMoreLinkTable[pid][ppId][0]+"_0"+val+"_020_"+ele.getAttribute("key"),pid,"")}}}}(_sChildren[i],i+1),"mousedown")}count=first6sort=first6hot=firstSort=_fragement=_sorts=_more=_morelink=_clearit=_code=key=_title=node=null}};Lib.children=function(chs){var cArr=[];for(var i=0;chs[i];i++){if(chs[i].nodeType==1){cArr.push(chs[i])}}return cArr};App.insertSmilesDialog2=function(sSortId,fCallback,sPositionNode,arrPosiPix){App.insertSmilesDialog2.callback=fCallback;if(scope.smileDialog==null){scope.smileDialog=new App.smilesDialog2}scope.smileDialog.setSort(sSortId,fCallback);var xy=Core.Dom.getXY($E(sPositionNode));var x=xy[0]+arrPosiPix[0];var y=xy[1]+arrPosiPix[1];scope.smileDialog.setPosition(x,y);scope.smileDialog.show()};App.insertSmilesDialog3=function(sTextarea,sSortNode,sRecommNode,fCallBack,sPositionNode,arrPix,sFrame,opt_evnets){fCall=function(nCode,sName,swfname){setTimeout(function(){var tempHTML='<img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+nCode+'T.gif" alt="'+sName+'" title="'+sName+'"width="50" height="50" />';if(swfname){tempHTML='<img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+nCode+'T.gif" alt="'+sName+'" title="'+sName+'" swfname="'+swfname+'"  width="50" height="50" />'}scope.commEditor.insertHTML(sFrame,tempHTML)},20)};App.insertSmilesDialog2.callback=fCall;if(scope.smileDialog==null){scope.smileDialog=new App.smilesDialog2}scope.smileDialog.setSort(0,fCall);var xy=Core.Dom.getXY($E(sPositionNode));var x=xy[0]+arrPix[0];var y=xy[1]+arrPix[1];scope.smileDialog.setPosition(x,y);scope.smileDialog.show()};App.formInsertSmile2=function(sTextarea,sSortNode,sRecommNode,fCallBack,sPositionNode,arrPix,sFrame,opt_evnets){var _oTextNode=$E(sTextarea);var getPos=function(){if(_oTextNode.createTextRange){_oTextNode.caretPos=document.selection.createRange().duplicate()}};if(!scope.commEditor){scope.commEditor=new commEditor}scope.commEditor.append(sFrame,sTextarea,opt_evnets);Core.Events.addEvent(_oTextNode,getPos,"keyup");Core.Events.addEvent(_oTextNode,getPos,"focus");Core.Events.addEvent(_oTextNode,getPos,"select");Core.Events.addEvent(_oTextNode,getPos,"click");new App.insertSmilesForm2({sortNode:sSortNode,clickCallback:function(nCode,sName,swfname){setTimeout(function(){var tempHTML='<img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+nCode+'T.gif" alt="'+sName+'" title="'+sName+'"width="50" height="50" />';if(swfname){tempHTML='<img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+nCode+'T.gif" alt="'+sName+'" title="'+sName+'" swfname="'+swfname+'"  width="50" height="50" />'}scope.commEditor.insertHTML(sFrame,tempHTML)},20);if(fCallBack){fCallBack()}},recommNode:sRecommNode,positionNode:sPositionNode||sSortNode,arrPosPix:arrPix||[0,0]})};var commEditor=function(frame,area){this.fids=[];this.areas={};this.wins={};this.docs={};this.intervals={};this.actions={}};commEditor.prototype={init:function(sFrame,cssStr){var doc=this.docs[sFrame];try{doc.body.designMode="on"}catch(e){}doc.body.style.cssText=cssStr;doc.body.contentEditable=true},lazyInit:function(fId,cssStr){var me=this;return function(){var cDoc=me.docs[fId];if(cDoc.body.getAttribute("inited")){return}trace("执行一次:"+fId);me.init(fId,cssStr);me.bindListener(fId);cDoc.body.setAttribute("inited","yes")}},append:function(sFrame,sTextarea,actions){actions=actions||{};actions.cssStr=actions.cssStr||"";if(!actions.interval){actions.interval={}}if(!actions.interval.before){actions.interval.before=function(){}}if(!actions.interval.after){actions.interval.after=function(){}}var frame=$E(sFrame);this.wins[sFrame]=frame.contentWindow;this.actions[sFrame]=actions;var me=this;function getDoc(){try{me.docs[sFrame]=frame.contentWindow.document;me.areas[sFrame]=$E(sTextarea);me.lazyInit(sFrame,actions.cssStr)()}catch(e){setTimeout(getDoc,150)}}getDoc()},frameFilter:function(body){var d=false;var val=body.innerHTML;val=val.replace(/<script[\s\S]*<\/script>/gi,"");val=val.replace(/<style[\s\S]*<\/style>/gi,"");val=val.replace(/<!-{2,}[\s\S]*?-{2,}>/g,"");val=val.replace(/<([^>]+).*?>/gi,function(all,str){var tagName=str.split(" ")[0].toLowerCase();switch(tagName){case"/p":return"<br>";case"br":return all;case"img":if(all.toLowerCase().indexOf("http://www.sinaimg.cn/uc/myshow/blog")>0||all.toLowerCase().indexOf("http://simg.sinajs.cn/blog7style/images/common")>0){if(all.toLowerCase().indexOf("t.gif")==-1&&all.toLowerCase().indexOf("img_arrow_r.gif")==-1){return""}return all}else{return""}default:return""}});val=val.replace(/\n/g,"");body.innerHTML=val},bindListener:function(sFrame){var doc=this.docs[sFrame];var area=this.areas[sFrame];var win=this.wins[sFrame];var actions=this.actions[sFrame];var me=this;if($IE){doc.onkeydown=function(){var event=win.event;if(event.keyCode==8){var ele=me.getFocusElement(sFrame);if(ele&&ele.tagName.toUpperCase()=="IMG"){ele.parentNode.removeChild(ele);event.keyCode=0;event.returnValue=false}}}}Core.Events.addEvent(doc.body,function(frameBody){return function(e){me.intervals[sFrame]=setInterval(function(){actions.interval.before(sFrame,area);me.clearFrameHTML(frameBody);var imgs=frameBody.getElementsByTagName("img");for(var i=0;imgs[i];i++){imgs[i].removeAttribute("style");imgs[i].removeAttribute("height");imgs[i].removeAttribute("width")}actions.interval.after(sFrame,area)},400)}}(doc.body),"focus");Core.Events.addEvent(doc.body,function(frameBody){return function(e){clearInterval(me.intervals[sFrame])}}(doc.body),"blur");if(actions.normal){for(var event in actions.normal){Core.Events.addEvent(doc.body,actions.normal[event],event)}}},clearFrameHTML:function(frameBody){var me=this;var arr=["a","input"];var needIt=false;for(var i=0;arr[i];i++){if(frameBody.getElementsByTagName(arr[i]).length>0){needIt=true;break}}if(needIt){me.frameFilter(frameBody)}else{var imgs=frameBody.getElementsByTagName("img");for(var i=0;imgs[i];i++){var srcInd=imgs[i].src.indexOf("http://www.sinaimg.cn/uc/myshow/blog");var tInd=imgs[i].src.toLowerCase().indexOf("t.g");var playButton=imgs[i].src.indexOf("http://simg.sinajs.cn/blog7style/images/common/img_arrow_r.gif");if((srcInd==-1||tInd==-1)&&playButton==-1){me.frameFilter(frameBody);break}}}},getFocusElement:function(fid){if($MOZ){var select=this.win.getSelection();var range=select.getRangeAt(0);var elm=range.commonAncestorContainer;if(elm.tagName){if(elm.tagName.toLowerCase()=="body"){return elm}}if(!range.collapsed){if(range.startContainer==range.endContainer||1&&range.startContainer==range.endContainer.parentNode){if(range.startOffset-range.endOffset<2||1){if(range.startContainer.hasChildNodes()){return range.startContainer.childNodes[range.startOffset]}}}return elm.parentNode}else{return elm.parentNode}}else{var range=this.docs[fid].selection.createRange();return range.item?range.item(0):range.parentElement()}},clearHTML:function(fId){var doc=this.docs[fId];doc.body.innerHTML="";doc.body.setAttribute("contenteditable",false);doc.body.setAttribute("contenteditable",true)},insertHTML:function(fId,s_html){if($IE){this.lazyInit(fId)()}var win=this.wins[fId];var doc=this.docs[fId];if($IE){try{win.focus();var oRang=doc.selection.createRange();if(doc.selection.type.toLowerCase()=="control"){var tempRange=doc.body.createTextRange();tempRange.moveToElementText(oRang.item(0));oRang=tempRange}oRang.pasteHTML(s_html);oRang.collapse(false);oRang.select()}catch(e){}}else{if(($CHROME||$SAFARI)&&(encodeURIComponent(doc.body.innerHTML)=="%0A"||doc.body.innerHTML=="")){doc.body.focus()}this.execCommand("insertHTML",s_html,fId);if(!$CHROME&&!$SAFARI){doc.body.focus()}}},execCommand:function(cmd,value,fId){var win=this.wins[fId];var doc=this.docs[fId];win.focus();doc.execCommand(cmd,"",value);win.focus()},handleChange:function(fId){var body=this.docs[fId].body;this.areas[fId].value=this.getHandledStr(body)},getHandledStr:function(body){var strArr=[];if(body.hasChildNodes()){body=body.childNodes;for(var i=0;body[i];i++){strArr.push(this.handleDom(body[i]))}}else{strArr.push(this.handleDom(body))}return strArr.join("").replace(/\u00A0/gi," ")},handleDom:function(ele){if(ele.nodeType==3){var val=ele.nodeValue;if(!Core.String.trim(val)){return""}return this.reEscapeHTML(val)}else if(ele.nodeType==1){if(ele.hasChildNodes()&&(ele.childNodes.length!=1||ele.childNodes.length==1&&ele.childNodes[0].tagName)){var strArr=[];if(ele.tagName){var tN=ele.tagName.toUpperCase();if(tN=="DIV"||tN=="P"){strArr.push("\n")}}ele=ele.childNodes;for(var i=0;ele[i];i++){strArr.push(this.handleDom(ele[i]))}return strArr.join("")}else{var tN=ele.tagName.toUpperCase();if(tN=="IMG"){if(ele.src.indexOf("http://www.sinaimg.cn/uc/myshow/blog")!=-1){if(ele.src.indexOf("T.g")==-1){return""}var nCode=ele.src.split("T.g")[0];nCode=nCode.substring(nCode.lastIndexOf("/")+1,nCode.length);var sName=ele.getAttribute("title");var swfname=ele.getAttribute("swfname");if(!swfname&&nCode[0]=="W"){swfname=nCode+"S.swf"}if(sName){if(swfname){return"[magicemoticons="+nCode+" swfname="+swfname+"]"+sName+"[/magicemoticons]"}else{return"[emoticons="+nCode+"]"+sName+"[/emoticons]"}}}else{return""}}else if(tN=="BR"){return"\n"}else if(tN=="DIV"||tN=="P"){var val=ele.innerHTML||"";return"\n"+this.reEscapeHTML(val)}else if(tN=="SCRIPT"||tN=="STYLE"){return""}else{val=ele.innerHTML||ele.value||"";return this.reEscapeHTML(val)}}}return""},reEscapeHTML:function(str){str=str.replace(/\n/g,"");str=str.replace(/&nbsp;/g," ");str=str.replace(/&quot;/g,'"');str=str.replace(/&lt;/g,"<");str=str.replace(/&gt;/g,">");str=str.replace(/&amp;/g,"&");return str},getEditorHTML:function(sContent,cssString){var html="";html+="<html>";html+="<head>";html+='<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />';html+="<style>		p {			*margin:0.2em auto;		}		body {			margin: 0;			scrollbar-face-color: #ffffff;			scrollbar-highlight-color: #ffffff;			scrollbar-shadow-color: #c0c1bb;			scrollbar-3dlight-color: #c0c1bb;			scrollbar-arrow-color: #c9cbb6;			scrollbar-track-color: #f4f5f0;			scrollbar-darkshadow-color: #ffffff;			scrollbar-base-color: #ffffff;			padding: 10px;			word-wrap: break-word;			overflow: scroll;			overflow-x: auto;			height: 90%;			font-size: 14px;		}		body, td, textarea, input, br, div, span{			font-family:Verdana,'宋体',sans-serif;			line-height:1.5;		}		img{			border: 0;		}		html{			height: 100%;			cursor: text;		}		pre{			white-space:normal;		}		form{margin: 0;}		body table{font-size: 14px;}		.border{ border:1px dashed #cfcfcf;}		</style>		<script>document.domain='sina.com.cn';</script>		";html+="</head>";html+="<body style='"+cssString+"'>";html+=sContent;html+="</body>";html+="</html>";return html}};var CommentV2={};CommentV2.Geetest=Core.Class.create();CommentV2.Geetest.prototype={geetestObj:null,node:"",options:{type:"float"},initialize:function(node,options){if(options){this.options=options}this.node=node||"";this.load()},reqGeetestAuth:function(){var _this=this;var url="http://control.blog.sina.com.cn/riaapi/StartCaptchaServlet.php";Utils.Io.JsLoad.request(url,{GET:{rand:Math.round(Math.random()*100)},returnType:"json",onComplete:function(res){if(res.code==="A00006"&&res.data.success===1){_this.loadGeetest(res.data)}else if(res.data.success===2){if(!window.scope){window.scope={}}window.scope.check_code_type="old"}}})},loadGeetest:function(config){var _this=this;_this.geetestObj=new window.Geetest({product:_this.options.type||"float",gt:config.gt,challenge:config.challenge,offline:!config.success,sandbox:true});_this.geetestObj.appendTo(_this.node)},load:function(){var _this=this;if(!window.Geetest){s=document.createElement("script");s.src="http://api.geetest.com/get.php?callback=gtcallback";document.body.appendChild(s);window.gtcallback=function(){_this.reqGeetestAuth()}}else{_this.reqGeetestAuth()}}};var FeedComment=Core.Class.create();FeedComment.prototype={contentLength:2e3,Interface:new Interface("http://control.blog.sina.com.cn/riaapi/profile/comment_new.php","jsload"),initialize:function(sArticleID,sCount,box){Lib.checkAuthor();if(!$isAdmin){(new Lib.Login.Ui).login(function(){location.reload()});return}this.aid=sArticleID;this.count=+sCount;this.box=box;this.geetest=null;this.initHTML()},initHTML:function(){var html=""+'<div class="arrow"></div>'+'<h6 class="noline">'+'<a href="javascript:;"><img id="cms_smile_#{aid}" title="插入表情" src="http://simg.sinajs.cn/blog7style/images/center/newversion/ico_small.jpg"'+' class="img_yzm" align="absmiddle" height="16" width="17"></a>发评论'+"</h6>"+'<div class="commentbox">'+'<textarea style="display:none;" id="cms_content_#{aid}" fakeClass="fake_textarea"></textarea>'+'<iframe id="cms_frame_#{aid}" onclick="this.contentWindow.focus();" frameBorder="0" scrolling="no" style="height:60px; background-color: #FFFFFF; border: 1px solid #C7C7C7; width:542px;*width:544px;" src="http://blog.sina.com.cn/main_v5/ria/blank.html"></iframe>'+"</div>"+'<div class="ct_float">'+'<div class="ct_floatL" style="width:auto;">分享<a href="javascript:;"><img id="cms_share_#{aid}" title="点击将取消评论分享至微博" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon51" align="absmiddle" height="17" width="17"></a></div>'+'<input type="hidden" id="bb_share_#{aid}" value="1" />'+'<div class="ct_floatR" style="width:auto;">'+'<a id="cms_pub_#{aid}" href="javascript:;" onclick="return false;" class="SG_aBtn SG_aBtn_ico"><cite>发布</cite></a>'+'<span id="geetest-box-#{aid}" style="padding-right: 40px;"></span>'+"</div>"+"</div>"+'<div class="clearit"></div>'+'<p class="commentnum" id="tip_#{aid}">还没有评论，快抢沙发吧！</p>'+'<ul class="revertlist" id="list_#{aid}" onmouseover="Core.Events.stopEvent(event);" onmouseout="Core.Events.stopEvent(event);"></ul>'+'<div class="more_r" id="more_#{aid}"></div>';this.box[0].innerHTML=html.replace(/#\{aid\}/g,this.aid);if(this.count>0){$E("tip_"+this.aid).innerHTML='评论<a href="http://blog.sina.com.cn/s/blog_'+this.aid+'.html#comment" target="_blank">共'+this.count+"条</a>";if(this.count>4){$E("more_"+this.aid).innerHTML='<a href="http://blog.sina.com.cn/s/blog_'+this.aid+'.html#comment" target="_blank">查看更多&gt;&gt;</a></div>'}}this.getComment();this.initGeetest();this.initUserEvent();return false},getComment:function(){var __this=this;this.Interface.request({GET:{cms_id:this.aid},onSuccess:function(oData){var tpl="<li>"+'<div class="ct_revert_cont">'+"<p>"+'<span class="revert_tit"><a href="http://blog.sina.com.cn/u/{uid}" target="_blank">{uname}:</a></span>'+'<span class="revert_time">{cms_pubdate}</span>'+"</p>"+'<div class="revert_inner">{cms_body}</div>'+"</div>"+"</li>";$E("list_"+__this.aid).innerHTML=Utils.template(tpl,oData)},onError:function(oData){showError(oData.code)},onFail:function(){}})},initGeetest:function(){var __this=this;__this.geetest=new CommentV2.Geetest("#geetest-box-"+__this.aid)},initUserEvent:function(){var __this=this;var __addEvent=Core.Events.addEvent;var bb_share=$E("bb_share_"+this.aid),cms_share=$E("cms_share_"+this.aid);if(Utils.Cookie.getCookie("acp_bb")=="1"){bb_share.value=0;cms_share.className="SG_icon SG_icon86";cms_share.title="点击将评论分享至微博"}__addEvent($E("cms_share_"+this.aid),function(event){Core.Events.stopEvent(event);if(bb_share.value=="1"){bb_share.value=0;cms_share.className="SG_icon SG_icon86";cms_share.title="点击将评论分享至微博"}else{bb_share.value=1;cms_share.className="SG_icon SG_icon51";cms_share.title="点击将取消评论分享至微博"}});__addEvent($E("cms_pub_"+this.aid),function(event){Core.Events.stopEvent(event);__this.postComment();v7sendLog("94_01_03_"+scope.$uid,scope.$pageid,"")});if(scope.smile==null){scope.smile=new App.insertSmile("cms_content_"+this.aid,"cms_smile_"+this.aid,function(){})}var me=this;var events={interval:{after:function(frameId,area){scope.commEditor.handleChange(frameId);var doc=$E(frameId).contentWindow.document;if(doc.body.scrollHeight>doc.body.offsetHeight){if(doc.body.scrollHeight>410){return}$E(frameId).style.height=doc.body.scrollHeight+"px"}}},cssStr:"padding:0px;overflow-y:auto;font-size: 12px;"};setTimeout(function(){if(!scope.commEditor){scope.commEditor=new commEditor}scope.commEditor.append("cms_frame_"+me.aid,"cms_content_"+me.aid,events);__addEvent("cms_smile_"+me.aid,function(){Core.Events.stopEvent();var arrPix=[-325,14+($IE?-2:0)];App.insertSmilesDialog3("cms_content_"+me.aid,null,null,null,"cms_smile_"+me.aid,arrPix,"cms_frame_"+me.aid,events)})},800)},postComment:function(){Core.Events.stopEvent();var __this=this;var _cms_content=Core.String.trim($E("cms_content_"+__this.aid).value);var geetestValidate=__this.geetest.geetestObj.getValidate();if(_cms_content==""){showError($SYSMSG.B36105);return}if(!geetestValidate){showError("请拖动滑块完成验证。");return}var post=new Interface("http://control.blog.sina.com.cn/admin/comment_new/cms_post.php?domain=1","ijax");var data={geetest_challenge:geetestValidate.geetest_challenge,geetest_validate:geetestValidate.geetest_validate,geetest_seccode:geetestValidate.geetest_seccode,article_id:this.aid,comment:_cms_content,uid:scope.$uid,login_name:$nick,is_photo:"0",t:1,is_t:0,fromicp:1};if($E("bb_share_"+this.aid)){if($E("bb_share_"+this.aid).value=="1"){data.is_t=1;if(Utils.Cookie.getCookie("acp_bb")=="1"){Utils.Cookie.setCookie("acp_bb","",-1,"/",".blog.sina.com.cn")}}else{if(Utils.Cookie.getCookie("acp_bb")!="1"){Utils.Cookie.setCookie("acp_bb","1",2400,"/",".blog.sina.com.cn")}}}if($E(this.aid+"_v2")){data.v2=$E(this.aid+"_v2").value}if($E(this.aid+"_v1")){data.v1=$E(this.aid+"_v1").value}data.v3=2;post.request({POST:data,onSuccess:function(result){__this.fakeRender($E("cms_content_"+__this.aid).value);scope.commEditor.clearHTML("cms_frame_"+__this.aid);$E("cms_content_"+__this.aid).value="";$E("cms_frame_"+__this.aid).style.height="60px";__this.count=__this.count+1;$E("tip_"+__this.aid).innerHTML='评论<a href="http://blog.sina.com.cn/s/blog_'+__this.aid+'.html#comment" target="_blank">共'+__this.count+"条</a>";Evter.fire("updataCmsNum"+__this.aid,__this.count);var c2s=new Comment2TSina(__this.aid,result);c2s.writeCommTips();__this.geetest.geetestObj.refresh()},onError:function(oData){showError($SYSMSG[oData.code]);__this.geetest.geetestObj.refresh()},onFail:function(){showError($SYSMSG.A00001);__this.geetest.geetestObj.refresh()}})},fakeRender:function(sData){if(sData==null||sData==""){return}var re=/\[emoticons=(E___\w*)\]([^\[]*)\[\/emoticons\]/gi;sData=Core.String.encodeHTML(sData);sData=sData.replace(re,function(a,b,c){return'<img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+b+'T.gif" style="margin:1px;cursor:pointer;"'+" onclick=\"window.open('http://control.blog.sina.com.cn/admin/myshow/myshow.php?code="+b+"')\" "+'border="0" title="'+c+'" />'});var _magicReg=/\[magicemoticons=([E|W]___\w*)\&nbsp\;swfname=(\w+\.swf)\]([^[]*)\[\/magicemoticons\]/gi;var _magichtml=['<img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/$1T.gif" style="margin:1px;','cursor:pointer;" onclick="window.$magicFacePlay(\'$2\');return false;"',' border="0" title="$3" width="50" height="50"/>'].join("");sData=sData.replace(_magicReg,_magichtml);if(sData.length>0){var li="<li>"+'<div class="ct_revert_cont">'+"<p>"+'<span class="revert_tit"><a href="http://blog.sina.com.cn/u/'+scope.$uid+'" target="_blank">'+$nick+":</a></span>"+'<span class="revert_time">1分钟前</span>'+"</p>"+'<div class="revert_inner">'+sData+"</div>"+"</div>"+"</li>";Core.Dom.insertHTML($E("list_"+this.aid),li,"AfterBegin")}}};Evter.add("comment",function(elem,event){Core.Events.stopEvent(event);var _dom=Core.Dom;var li=_dom.parent(elem,"li");var edata=Evter.data(li);var txtlist=_dom.byClass("blog_txtlist","div",li);var txtlist0=txtlist[0];if(Evter.data(txtlist0)===2){Mojie.slideShow(txtlist0,150,0);Evter.data(txtlist0,"");if(txtlist.length>1){txtlist[1].style.display=""}Evter.remove("updataCmsNum"+edata.blogid);return}var num_em=$T(elem,"em")[0];var nmatch=num_em.innerHTML.match(/(\d+)/);var w=Core.Dom.getXY(li);var w1=Core.Dom.getXY(elem);new FeedComment(edata.blogid,nmatch?nmatch[1]:0,txtlist);var arrowPos=_dom.byClass("arrow","div",li);arrowPos[0].style.right=600-(w1[0]-w[0])+"px";Evter.data(txtlist0,2);if(txtlist.length>1){txtlist[1].style.display="none"}Mojie.slideShow(txtlist0,0,150);Evter.add("updataCmsNum"+edata.blogid,function(num){num_em.innerHTML="("+num+")"})});Evter.add("delete",function(elem){var _dom=Core.Dom;var li=_dom.parent(elem,"li");var edata=Evter.data(li);winDialog.confirm("确定要删除此篇博文吗?",{subText:"",funcOk:function(){var interfaceDelete=new Interface("http://control.blog.sina.com.cn/admin/article/article_del_recycle.php","ijax");interfaceDelete.request({POST:{"blog_id[]":edata.blogid,uid:scope.$uid},onSuccess:function(data){var h=li.offsetHeight;li.style.overflow="hidden";var tween=new Ui.TweenStrategy(h,0,.7,Ui.Transition.regularEaseOut);tween.onTween=function(val){li.style.height=parseInt(val,10)+"px"};tween.onEnd=function(){Core.Dom.removeNode(li)};$IE?tween.onEnd():tween.start()},onError:function(cep){winDialog.alert(cep.data)},onFail:function(){}})}})});$registJob("feed",function(){var _byClass=Core.Dom.byClass;SinaEx.enterLeave($E("feedWrap"),function(li){var fdate=_byClass("feeddate","span",li);if(!fdate){return}fdate[0].style.display="";fdate.length>1&&(fdate[1].style.display="")},function(li){var fdate=_byClass("feeddate","span",li);if(!fdate){return}fdate[0].style.display="none";fdate.length>1&&(fdate[1].style.display="none")},200);Mojie.checkImageSize(_byClass("for_check_size","img",$E("feedWrap")),Mojie.loadImgCallback);Evter.add("videoIconHeight",function(){var videoWrap=_byClass("videoMicro","div",$E("feedWrap"));var arr=[],h;for(var i=0;i<videoWrap.length;i++){var img=videoWrap[i].children[1];arr.push(img)}Mojie.checkImageSize(arr,function(el){h=parseInt(el.height);el.oriImg.style.height=h+"px";el.oriImg.previousSibling.style.top=Math.floor(h/2-8)+"px"})});Evter.fire("videoIconHeight")});$registJob("checkNewFeed",function(){var guanboWrap=$E("guanbofeedout"),feedTips=$E("newFeedTips");setInterval(function(){Utils.Io.JsLoad.request("http://i.blog.sina.com.cn/blog_rebuild/riaapi/profile/feed/getNewFeedNum.php",{GET:{time:$E("lastTime").value},onComplete:function(res){if(res&&res.code==="A00006"){if(res.data&&res.data.count){var el=$E("newFeedTips");el.innerHTML="有"+res.data.count+"条新内容，请点击查看";el.style.display="";guanboWrap.style.marginBottom="6px"}}}})},18e4);var timer=setInterval(pos,5e3);function pos(){if(feedTips.style.display!="none"){Mojie.feedTypeList(24,23,21)}else{return}}var select=$E("select"),allfeed=$E("allfeed");var text=select.children[1],textstyle=select.children[0];Evter.add("-getNewFeed",function(elem){scope.feedView(0,0,1);elem.innerHTML="正在加载数据...";setTimeout(function(){Mojie.feedTypeList(24,23,21)},1e3);text.innerHTML="全部";textstyle.className="ct_icon ct_icon17";allfeed.innerHTML="全部"})});$registJob("pages",function(){scope.feedView=function(_class,_type,_page,isPageNumber){Lib.sendSuda(function(){try{SUDA.log("","blog_iblogfeed_page")}catch(e){}});Lib.checkAuthor();if(!$isAdmin){(new Lib.Login.Ui).login(function(){location.reload()});return}new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/feed/getFeedByPage.php","jsload").request({GET:{tj:$E("tj").value,"class":_class||"0",type:_type||"0",page:_page},onSuccess:function(data){var feedwrap=$E("feedWrap");feedwrap.innerHTML=data.html;feedwrap.style.zoom=1;if(isPageNumber){feedwrap.parentNode.parentNode.scrollIntoView(true)}$E("pagerWrap").innerHTML=data.pager||"";$E("tj").value=data.tj||"";if(_page===1){$E("lastTime").value=data.lastTime;Evter.free($E("newFeedTips"),"getNewFeed");$E("newFeedTips").style.display="none";$E("guanbofeedout").style.marginBottom="21px"}Mojie.checkImageSize(Core.Dom.byClass("for_check_size","img",feedwrap),Mojie.loadImgCallback);Evter.fire("videoIconHeight")},onError:function(res){showError(res.code)}})}});$registJob("dragTag",function(){var _addEvent=Core.Events.addEvent,_removeEvent=Core.Events.removeEvent,_stopEvent=Core.Events.stopEvent;var MAX_WIDTH=145;var lastLeft,startX,thisW,el,elA,bindA=true,ontween=false;var mouseMove=function(evt){evt=evt||window.event;_stopEvent(evt);if(bindA){bindA=false;if(elA){elA.onclick=function(){return false};elA.style.cursor="col-resize"}}el.style.left=lastLeft+(evt.clientX||evt.pageX||evt.x||0)-startX+"px"};var mouseUp=function(evt){evt=evt||window.event;_stopEvent(evt);if(!bindA){bindA=true;if(elA){setTimeout(function(){elA.onclick=null;elA.style.cursor="pointer";elA=null},10)}}var left=parseInt(el.style.left)||0;if(left>2){tweenBack(left,0)}else if(left<thisW){tweenBack(left,thisW)}else{el=null}_removeEvent(document,mouseMove,"mousemove");_removeEvent(document,mouseUp,"mouseup")};_addEvent($E("feedWrap"),function(evt){if(ontween){return}evt=evt||window.event;el=evt.target||evt.srcElement;var dragable=false;if(el.parentNode.className==="tagList"){dragable=true;elA=el;el=el.parentNode}if(dragable||el.className==="tagList"){_stopEvent(evt);thisW=getWidth(el).w;if(thisW<MAX_WIDTH){
return}thisW=MAX_WIDTH-thisW;startX=evt.clientX||evt.pageX||evt.x||0;lastLeft=parseInt(el.style.left)||0;_addEvent(document,mouseMove,"mousemove");_addEvent(document,mouseUp,"mouseup")}},"mousedown");function getWidth(el){var rect,_size;if(el.getBoundingClientRect){rect=el.getBoundingClientRect();_size={w:rect.right-rect.left}}return _size||{w:el.offsetWidth}}function tweenBack(startv,endv){var tween=new Ui.TweenStrategy(startv,endv,.8);tween.onTween=function(v){el.style.left=v+"px"};tween.onEnd=function(){el=null;ontween=false};ontween=true;tween.start()}});$registJob("goToTop",function(){var __addEvent=Core.Events.addEvent,__opacity=Core.Dom.opacity;var myPanel=new Ui.Panel,template='<div class="arr_top"><a id="#{goToTop}" title="返回顶部" href="javascript:;"><img width="59" height="59" src="http://simg.sinajs.cn/blog7style/images/center/newversion/arr_top.gif" alt="" /></a></div>';myPanel.setTemplate('<div id="#{panel}">'+template+"</div>").setFixed(true);myPanel.entity.style.zIndex=500;var pos;var showing=false;if($E("module_980")){pos=Core.Dom.getXY($E("module_980"));pos[0]+=280}updateLayerPos();if((document.documentElement.scrollTop||document.body.scrollTop)>0){showEffect()}__addEvent(window,function(){var sTop=document.documentElement.scrollTop||document.body.scrollTop;if(!showing&&sTop>380){showEffect()}if(showing&&sTop<380){hideEffect()}},"scroll");__addEvent(myPanel.nodes.goToTop,function(){var tween=new Ui.TweenStrategy(document.documentElement.scrollTop||document.body.scrollTop,0,.8,function(t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b});tween.onTween=function(v){document.documentElement.scrollTop=document.body.scrollTop=v};tween.start()});__addEvent(window,updateLayerPos,"resize");function showEffect(){showing=true;if($IE){myPanel.show();return}__opacity(myPanel.entity,0);myPanel.show();var tween=new Ui.TweenStrategy(0,100,.5);tween.onTween=function(v){__opacity(myPanel.entity,v)};tween.start()}function hideEffect(){showing=false;if($IE){myPanel.hidden();return}var tween=new Ui.TweenStrategy(100,0,.5);tween.onTween=function(v){__opacity(myPanel.entity,v)};tween.onEnd=function(){myPanel.hidden()};tween.start()}function updateLayerPos(){var winWidth=document.documentElement.clientWidth,winHeight=document.documentElement.clientHeight;if(!pos){pos=[];pos[0]=winWidth-80}if(parseInt(winWidth)<930){myPanel.setPosition({x:parseInt(winWidth)-100,y:winHeight-80})}else{myPanel.setPosition({x:pos[0],y:winHeight-80})}}});Core.System.parseURL=function(urlStr){var regex=/^(?:([A-Za-z]+):(\/{0,3}))?([0-9.\-A-Za-z]+\.[0-9A-Za-z]+)?(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/;var param=["url","scheme","slash","host","port","path","query","hash"];var matches=regex.exec(urlStr);var url={};for(var i=0,len=param.length;i<len;i+=1){url[param[i]]=matches[i]||""}return url};Core.System.queryToJson=function(queryStr,isEncode){queryStr=Core.String.trim(queryStr);if(!queryStr){return{}}var params=queryStr.split("&"),json={},getString=function(str){return isEncode?decodeURIComponent(str):str};for(var i=0,len=params.length;i<len;i++){var param=params[i];if(param){var tmp=param.split("="),key=tmp[0],value=tmp[1];if(tmp.length<2){value=key;key="$nullName"}if(!json[key]){json[key]=getString(value)}else{json[key]instanceof Array!=!0&&(json[key]=[json[key]]);json[key].push(getString(value))}}}return json};Core.System.jsonToQuery=function(json,isEncode){var strArr=[],getString=function(str){return isEncode?encodeURIComponent(str):str};if(typeof json=="object"){for(var p in json){if(p==="$nullName"){strArr=strArr.concat(json[p]);continue}if(json[p]instanceof Array){for(var i=0,len=json[p].length;i<len;i++)strArr.push(p+"="+getString(json[p][i]))}else{typeof json[p]!="function"&&strArr.push(p+"="+getString(json[p]))}}}return strArr.length?strArr.join("&"):""};Lib.register("util.hideContainer",function(){var container=$C("div");container.style.display="none";document.body.appendChild(container);return container});Lib.register("historyM",function($){var eventObject={};var $hideContainer=$.util.hideContainer;var popstateFns=[];var _addEvent=Core.Events.addEvent;var _parseURL=Core.System.parseURL;var _queryToJson=Core.System.queryToJson;var _jsonToQuery=Core.System.jsonToQuery;var _custEvent=new Core.Events.EventDispatcher(eventObject);var _foreach=Core.Array.foreach;var lastState,callChangeFlag=true,isHtml5State=!!history.pushState,haveHashchangeEvt="onhashchange"in window&&(typeof document.documentMode==="undefined"||document.documentMode==8);var hashFrame,hashFrameStr,writeHashFrame,hashFrameChangeHash,rnd=parseInt(Math.random()*1e3),iframeId="_history$"+rnd;if(!haveHashchangeEvt&&($IE6||$IE7)){try{hashFrame=$C("iframe");hashFrame.id=iframeId;$hideContainer.appendChild(hashFrame)}catch(e){}writeHashFrame=function(URLHash){URLHash=encodeURIComponent(URLHash);var htmlStr='<html><head></head><body><script>document.domain="'+document.domain+'";document.body.onload = function(){parent.Lib&&parent.Lib.historyM&&parent.Lib.historyM.hashFrameChangeHash&&parent.Lib.historyM.hashFrameChangeHash("'+URLHash+'");};</script><body></html>';hashFrame.src="javascript:void((function(){var d=document;d.open('text/html');d.domain='"+document.domain+"';d.write('"+htmlStr+"');d.close()})())"};hashFrameChangeHash=function(hash){hash=decodeURIComponent(hash);if(!hashFrameChangeHash.first){hashFrameChangeHash.first=1;return}window.location.hash=hash;if(hash!="#!"+lastState){stateChange(lastState=hash.substr(2),true)}else{trace(hash)}}}var stateChange=function(URL,flag){writeHashFrame&&!flag&&writeHashFrame("#!"+URL);_custEvent.dispatchEvent("popstate",[URL,callChangeFlag]);callChangeFlag=true};var getLocation=function(){return decodeURIComponent(window.location.toString())};var getURL=function(oldURL){var URL=_parseURL(oldURL||getLocation());return{host:URL.host,path:"/"+URL.path,query:URL.query&&"?"+URL.query,hash:URL.hash&&"#"+URL.hash}};var parseURL=function(){var URL=_parseURL(getLocation());if(/^!/.test(URL.hash)){return _parseURL("http://"+URL.host+URL.hash.substr(1))}return URL};var pushState=function(URL,opts){if(!/^\//.test(URL)){trace("地址:("+URL+") 不为正确的路径,请使用绝对路径; 例：/directory/page.php?params#hash");return}opts=Lib.apply({callChange:true,callChangeOnSame:true},opts);callChangeFlag=opts.callChange;if(isHtml5State){URL=URL.replace(/#.*$/,"");if(lastState==URL){if(!opts.callChangeOnSame){return}}else{history.pushState(null,null,lastState=URL)}stateChange(URL);return}var newHash="#!"+URL;URL=URL.replace(/#.*$/,"");if(lastState==URL){if(opts.callChangeOnSame){stateChange(URL)}}else{window.location.hash=newHash}};var setQuery=function(query,callChange){if(!query)return;callChange=callChange||false;var URL=parseURL();var queryParam=_queryToJson(URL.query);for(var key in query){if(query[key]===null){delete queryParam[key]}else{queryParam[key]=query[key]}}URL.query=_jsonToQuery(queryParam);var result=["/",URL.path,URL.query==""?"":"?",URL.query,URL.hash==""?"":"#",URL.hash].join("");pushState(result,{callChange:callChange})};var setPlainHash=function(plainHash,leaveHistory){if(typeof plainHash=="string"&&!/^!/.test(plainHash)){var oldHash=_parseURL(window.location.toString()).hash,newHash,baseUrl=window.location.toString().replace(/#.*$/,"");if(/^!/.test(oldHash)){oldHash=oldHash.replace(/#.*$/,"");newHash="#"+oldHash+"#"+plainHash}else{newHash="#"+plainHash}if(leaveHistory){window.location.hash=newHash}else{window.location.replace(baseUrl+newHash)}}return that};var onpopstate=function(fn){fn&&popstateFns.push(fn);return that};lastState=getLocation().replace(/^http:\/\/.*?\//,"/").replace(/#.*$/,"");if(isHtml5State){_addEvent(window,function(){setTimeout(function(){var nowURL=getURL(),newState=nowURL.path+nowURL.query;if(lastState!=newState){stateChange(lastState=newState)}})},"popstate")}else{var onHashchange=function(){var newState,nowURL=getURL();if(/^#!/.test(nowURL.hash)){newState=nowURL.hash.substr(2).replace(/#.*$/,"")}else{newState=nowURL.path+nowURL.query}if(lastState!=newState){stateChange(lastState=newState)}};if(haveHashchangeEvt){_addEvent(window,function(){onHashchange()},"hashchange")}else{setInterval(function(){onHashchange()},200)}}writeHashFrame&&writeHashFrame("#!"+lastState);var that={parseURL:parseURL,getURL:getURL,pushState:pushState,setQuery:setQuery,setPlainHash:setPlainHash,onpopstate:onpopstate,removePopstate:function(fn){var index=Core.Array.findit(fn,popstateFns);if(index>-1){popstateFns.splice(index,1)}},hashFrameChangeHash:hashFrameChangeHash};_custEvent.addEventListener("popstate",function(evt,URL,callChange){_foreach(popstateFns,function(fn){try{fn(URL,callChange)}catch(e){trace("popstate error: ",e,fn)}})});return that});Mojie.renderFeedTypeModule=function(_type,_page){var feedwrap=$E("feedWrap"),select=$E("select"),allfeed=$E("allfeed");feedwrap.innerHTML=['<div id="loading" style="text-align:center;padding-top:100px; height:200px">','<img src="http://simg.sinajs.cn/blog7style/images/common/loading.gif">加载中…',"</div>"].join("");var pageTpl='<div class="SG_page">'+'<ul id="pagerWrap" class="SG_pages">'+'<li class="SG_pgnext"><a href="javascript:scope.feedView(0,\''+_type+'\',2,1);" title="跳转至第2页">下一页&nbsp;&gt;</a></li>'+"</ul>"+"</div>";var icon=select.children[0],iconText=select.children[1];switch(_type){case"all":icon.className="ct_icon ct_icon17";iconText.innerHTML="全部";allfeed.innerHTML="全部";break;case"article":icon.className="ct_icon ct_icon21";iconText.innerHTML="博文";allfeed.innerHTML="博文";break;case"photo":icon.className="ct_icon ct_icon19";iconText.innerHTML="图片";allfeed.innerHTML="图片";break;case"tag":icon.className="ct_icon ct_icon22";iconText.innerHTML="标签";allfeed.innerHTML="标签";break;case"like":icon.className="ct_icon ct_icon20";iconText.innerHTML="喜欢";allfeed.innerHTML="喜欢";break;case"other":icon.className="ct_icon ct_icon18";iconText.innerHTML="其它";allfeed.innerHTML="其它";break}new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/feed/getFeedByPage.php","jsload").request({GET:{tj:$E("tj").value,type:_type||"0",page:_page},onSuccess:function(data){if(!data.pager&&$E("pagerWrap")){$E("pagerWrap").innerHTML=""}else if(data.pager&&!$E("pagerWrap")){Utils.insertTemplate(feedwrap,pageTpl,"AfterEnd")}else{if($E("pagerWrap")){$E("pagerWrap").innerHTML='<li class="SG_pgnext"><a href="javascript:scope.feedView(0,\''+_type+'\',2,1);" title="跳转至第2页">下一页&nbsp;&gt;</a></li>'}}feedwrap.innerHTML=data.html;if($E("loading")){var load=$E("loading");Core.Dom.removeNode(load)}feedwrap.style.zoom=1},onError:function(res){showError(res.code)}})};$registJob("feedType",function(){var allfeed=$E("allfeed");var $historyM=Lib.historyM;var lasthash,hashIdx;var subtype=$E("subtype");subtype.onclick=tabClick;if($IE){window.location.hash=""}function tabClick(event,dataType){var target=event&&event.target||window.event&&window.event.srcElement;if(target&&target.tagName&&target.tagName.toLowerCase()=="a"){var mT=target.getAttribute("tabItemType")}else{return}if(!mT){return}noRequest();if(hashIdx!=mT){switch(mT){case"all":$historyM.setQuery({type:"all"});break;case"article":$historyM.setQuery({type:"article"});break;case"photo":$historyM.setQuery({type:"photo"});break;case"like":$historyM.setQuery({type:"like"});break;case"other":$historyM.setQuery({type:"other"});break}}else{return}}$historyM.onpopstate(function(){var q=$historyM.parseURL();var type=Core.System.queryToJson(q.query).type;stateChange(type)});function stateChange(hash){switch(hash){case"all":Mojie.renderFeedTypeModule("all",1);break;case"article":Mojie.renderFeedTypeModule("article",1);break;case"photo":Mojie.renderFeedTypeModule("photo",1);break;case"like":Mojie.renderFeedTypeModule("like",1);break;case"other":Mojie.renderFeedTypeModule("other",1);break}}function noRequest(){lasthash=window.location.href;if(lasthash){lasthash=lasthash.match(/(type=).*/g);if(lasthash){var idx=lasthash.toString().indexOf("=");hashIdx=lasthash.toString().substr(idx+1)}}}});$registJob("loginStatus",function(){Lib.checkAuthor();var _getCookie=Utils.Cookie.getCookie;var _setCookie=Utils.Cookie.setCookie;var statusUid=_getCookie("_s_loginStatus");var loginUid=_getCookie("_s_loginuid");if($isLogin){if(loginUid===$UID){return}}else{if(!statusUid||statusUid===loginUid){return}}_setCookie("_s_loginuid",$UID||statusUid,24-(new Date).getHours(),"","blog.sina.com.cn");var url="http://control.blog.sina.com.cn/blog_rebuild/riaapi/padblog/padInfo.php?rnd="+Math.random();Utils.Io.JsLoad.request(url,{onComplete:function(){},onException:function(){}})});Lib.Uic={_interfaceMultiquery:"http://uic.sso.sina.com.cn/uic/Mutiquery.php",cacheNickName:{},getNickName:function(arrUidLists,fCallBack,requestNo){arrUidLists=Core.Array.uniq(arrUidLists)||[];requestNo=requestNo||10;var _trim=Core.String.trim;var _cache=this.cacheNickName,_uidWithNoCache=[],nickType=[];var _data={};for(var i=0,len=arrUidLists.length;i<len;i++){if(typeof _cache[arrUidLists[i]]=="undefined"&&_cache[arrUidLists[i]]==null){var nickEl=$E("ownernick");var pageid=_trim(scope.$pageid);if(arrUidLists[i]==$UID&&scope.nickname!=null){_data[arrUidLists[i]]=_trim(scope.nickname);continue}_uidWithNoCache.push(arrUidLists[i])}else{_data[arrUidLists[i]]=_cache[arrUidLists[i]]||arrUidLists[i]}}if(_uidWithNoCache.length==0){fCallBack(_data);_data=null}else{var urls=[];for(var i=0;i<_uidWithNoCache.length;i++){nickType[i]=1}if(_uidWithNoCache.length>0){if(nickType.length>0){nickType="["+nickType.toString().replace(/,$/g,"")+"]"}_uidWithNoCache="["+_uidWithNoCache.toString().replace(/,$/g,"")+"]";urls.push({url:this._interfaceMultiquery+"?UID=0&Check=null&UIDS="+_uidWithNoCache+"&UserInfoTypes="+nickType+"&ProductType=2"})}var jsRequest=function(aUrl){Utils.Io.JsLoad.request(aUrl[0].url,{onComplete:function(data){if(data){var uids=data.UserInfos;for(var i=0;i<uids.length;i++){_data[uids[i][0]]=uids[i][2][1];Lib.Uic.cacheNickName[uids[i][0]]=uids[i][2][1]}fCallBack(_data)}}});if(urls.length>0){setTimeout(function(){jsRequest(urls.splice(0,1))},10)}};if(urls.length>0){setTimeout(function(){jsRequest(urls.splice(0,1))},10)}}}};$registJob("suda",function(){var suda_flag=scope&&scope.$pageid&&scope.$pageid==="profile_index";if(typeof _S_pSt=="function"){if(suda_flag){v7sendLog("42_01_11")}return}if(suda_flag){v7sendLog("42_01_11")}Lib.sendSuda(function(){try{_S_pSt("")}catch(e){}if(suda_flag){v7sendLog("42_01_12")}});var ele=$E("blognamespan");if(!ele){return}Lib.checkAuthor();Lib.Uic.getNickName([scope.$uid],function(oResult){var nickName=oResult[scope.$uid];nickName=nickName.replace(/\u7684\u535a\u5ba2$/,"");nickName=Core.String.leftB(nickName,30);nickName=nickName+"的博客";ele.innerHTML=nickName})});$registJob("uatrack",function(){var pageid=scope.$pageid;var _byClass=Core.Dom.byClass;switch(pageid){case"editor":var el=_byClass("msnTips_lx","div");if(el){v7sendLog("41_01_05");SUDA.uaTrack("blog_post","v_post1")}break;case"article":case"articleM":var el=$E("module_911");if(el){v7sendLog("41_01_03");SUDA.uaTrack("blog_blogpage","v_qingmodulebj")}break;case"profile_index":var el=_byClass("ad_top","div");if(el){v7sendLog("41_01_01");SUDA.uaTrack("blog_iblog","v_iblog")}}});Core.Dom.getElementsByAttr=function(node,attname,attvalue){var nodes=[];for(var i=0,l=node.childNodes.length;i<l;i++){if(node.childNodes[i].nodeType==1){if(node.childNodes[i].getAttribute(attname)==attvalue){nodes.push(node.childNodes[i])}if(node.childNodes[i].childNodes.length>0){nodes=nodes.concat(arguments.callee.call(null,node.childNodes[i],attname,attvalue))}}}return nodes};Lib.register("blogAppAd",function(lib){function scrollAdLeft(){Core.Dom.insertHTML(document.body,'<div id="sinaads_pdps54771"></div>',"beforeend");var cookieKeyName="sinaads_blogAppAd_"+scope.$PRODUCT_NAME+scope.$pageid;if(document.cookie.indexOf(cookieKeyName)===-1){var insdiv=document.getElementById("sinaads_pdps54771");insdiv.innerHTML=' <ins class="sinaads" data-ad-pdps="PDPS000000054771"></ins>  ';(sinaads=window.sinaads||[]).push({params:{sinaads_ls_root:"sinablogbody",sinaads_ls_cookieKey:cookieKeyName}});var expires=new Date;expires.setTime(expires.getTime()+24*60*60*1e3);document.cookie="blogAppAd_"+scope.$PRODUCT_NAME+scope.$pageid+"=1; expires="+expires.toGMTString()}}lib.execZhitou(function(){scrollAdLeft()});var Panel=lib.Panel;var ad=new Panel;ad.init=function(root){var cookieName="blogAppAd_"+scope.$PRODUCT_NAME+scope.$pageid;var blogappCookie=Utils.Cookie.getCookie(cookieName);if(blogappCookie=="1"){return}var self=this;var baseUrl="http://comet.blog.sina.com.cn/qr?";var urlmap={blog7indexM:"http://blog.sina.com.cn/main_v5/ria/app_515_7.html",blog7index:"http://blog.sina.com.cn/main_v5/ria/app_515_7.html",blog7articleM:"http://blog.sina.com.cn/main_v5/ria/app_515_8.html",blog7article:"http://blog.sina.com.cn/main_v5/ria/app_515_8.html",blog7articletj:"http://blog.sina.com.cn/main_v5/ria/app_515_8.html",blog7articletjTech:"http://blog.sina.com.cn/main_v5/ria/app_515_8.html",blog7icpprofile_index:"http://blog.sina.com.cn/main_v5/ria/app_515_9.html",blog7articlelistM:"http://blog.sina.com.cn/main_v5/ria/app_515_10.html",blog7articlelist:"http://blog.sina.com.cn/main_v5/ria/app_515_10.html",blog7photoindex:"http://blog.sina.com.cn/main_v5/ria/app_515_11.html",blog7photophoto:"http://blog.sina.com.cn/main_v5/ria/app_515_12.html"};root=Core.Dom.getElementsByClass(null,"div",root)[0];var realurl=urlmap[scope.$PRODUCT_NAME+scope.$pageid];if(!root||!realurl)return;var url=baseUrl+realurl;var template='<div style="position:absolute;width:140px;height:330px; text-align:center;z-index:999;" id="#{panel}">\r\n                                <a href="http://blog.sina.com.cn/s/blog_86f95d450102uzt1.html" target="_blank" ><img src="http://simg.sinajs.cn/blog7style/images/activity/app_tuiguang/activity.png" style="display:block;border:0 none;"></a>\r\n                                <a href="http://blog.sina.com.cn/s/blog_86f95d450102uzt1.html" target="_blank" style="background:#fff;border:1px solid #dbdbdb; border-top:0 none; height:117px; padding-top:5px; display:block; text-decoration:none;">\r\n                                    <img src="http://comet.blog.sina.com.cn/qr?http://blog.sina.com.cn/lm/z/xytx22/index.html" width="70" height="70" style="display:block; border:0 none; margin:0 auto 3px;">\r\n                                    <span style=" display:block;line-height:1;font-size:12px;margin-bottom:5px;color:#6e6e6e;text-align:center; font-family:Helvetica,\'Microsoft YaHei\'">新阅天下客户端</span>\r\n                                    <span style=" display:block;line-height:1;font-size:18px;color:#5f5f5f;text-align:center;font-family:Helvetica,\'Microsoft YaHei\';"> 扫一扫下载</span>\r\n                                    <span node-action="close" style="position:absolute;z-index:99;right:0px;bottom:0px;width:15px;height:15px;text-align:center;line-height:17px; overflow:hidden;border:1px solid #cbcbcb;cursor:pointer;font-size:15px;color:#5f5f5f; font-family:SimSun;font-weight:700;" title="关闭">×</span>\r\n                                </a>\r\n                            </div>';self.setTemplate(template);var templateWidth=parseInt(Core.Dom.getStyle(self.entity,"width"),10);var paddingTop=parseInt(Core.Dom.getStyle(root,"paddingTop"),10);var panelHeight=parseInt(Core.Dom.getStyle(self.entity,"height"),10);var marginLeft=10;self.setFixed(true);resize();var closeBtn=Core.Dom.getElementsByAttr(self.entity,"node-action","close")[0];function close(){Core.Events.stopDefaultEvent();ad.close();Core.Events.removeEvent(closeBtn,close);Core.Events.removeEvent(window,resize,"resize");Utils.Cookie.setCookie(cookieName,"1",24)}function winSize(){var e=window,a="inner";if(!("innerWidth"in window)){a="client";e=document.documentElement||document.body}return{width:e[a+"Width"],height:e[a+"Height"]}}var resizeT;function resize(){if(resizeT)clearTimeout(resizeT);resizeT=setTimeout(function(){var maxHeight=winSize().height;var rootOffset=Core.Dom.getXY(root);var left=rootOffset[0]-templateWidth-marginLeft;var top=rootOffset[1]+paddingTop;left=left>0?left:0;top=top+panelHeight>maxHeight?maxHeight-panelHeight-20:top;self.setPosition(left,top)},300)}Core.Events.addEvent(closeBtn,close);Core.Events.addEvent(window,resize,"resize");Core.Events.addEvent(window,resize,"scroll");self.show()};return ad});$registJob("blogAppAd",function(){Lib.blogAppAd.init("sinablogbody")});$registJob("pointsAdInsert",function(){var template='\r\n        <div class="jf_ad">\r\n            <a href="[url]" title="[title]">\r\n                <img src="[imgUrl]" title="[title]" alt="[title]" />\r\n            </a>\r\n        </div>';var url="http://control.blog.sina.com.cn/admin/article/article_add.php";var imgUrl="http://simg.sinajs.cn/blog7style/images/center/newversion/temp/fbq.jpg";var title="超简洁新版发布器，你用了吗";var getElementsByClass=Core.Dom.getElementsByClass;var sites={profile_index:{el:getElementsByClass($E("module_956"),"div","feedList")[0],where:"afterbegin"}};if(scope&&scope.$pageid&&sites[scope.$pageid]){var htmlStr=template.replace(/\[url\]/g,url).replace(/\[title\]/g,title).replace(/\[imgUrl\]/g,imgUrl);var site=sites[scope.$pageid];if(site.el&&site.where){Core.Dom.insertHTML(site.el,htmlStr,site.where)}}});if(window!=parent){parent.location.href=window.location.href}function main(){v7sendLog("42_01_13");var job=new Jobs;job.add("checkAccount");job.add("tray");job.add("suda");job.add("trayTipsAd");job.add("loginStatus");job.add("pointsAdInsert");job.add("feed");job.add("checkNewFeed");job.add("pages");job.add("dragTag");job.add("goToTop");job.add("feedType");job.add("index");job.add("dynaRecomm");job.add("write");job.add("render_push");job.add("insertDynaMoban");job.add("profileUserGuide");job.add("delAttentionTags");job.add("attenBlogerRank");job.add("templateClone",3);job.add("modify_tip");job.add("moduleBind");job.add("errorTips");job.add("baby_headPhoto");job.add("uatrack");job.add("blogAppAd");job.start()}