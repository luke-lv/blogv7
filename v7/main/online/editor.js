if(typeof Sina=="undefined"){Sina={}}Sina.pkg=function(ns){if(!ns||!ns.length){return null}var levels=ns.split(".");var nsobj=Sina;for(var i=levels[0]=="Sina"?1:0;i<levels.length;++i){nsobj[levels[i]]=nsobj[levels[i]]||{};nsobj=nsobj[levels[i]]}return nsobj};function $E(oID){var node=typeof oID=="string"?document.getElementById(oID):oID;if(node!=null){return node}return null}function $C(tagName){return document.createElement(tagName)}function $N(name){return document.getElementsByName(name)}function $T(obj,tagName){return obj.getElementsByTagName(tagName)}try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}(function(){var bind=function(fFunction,object){var __method=fFunction;return function(){return __method.apply(object,arguments)}};var debug_namespace="Debug";if(window[debug_namespace]==null||typeof window[debug_namespace].log=="undefined"){window[debug_namespace]={cacheData:[],base_url:"http://sjs.sinajs.cn/bind2/",product:scope.$PRODUCT_NAME,baseColor:{1:{color:"#FFF",bgcolor:"#E00"},2:{color:"#F00"},3:{color:"#FFF000"},4:{color:"#0F0"},5:{color:"#FFF"}},fatal:function(sInfo){this.addData(sInfo,1)},error:function(sInfo){this.addData(sInfo,2)},warning:function(sInfo){this.addData(sInfo,3)},info:function(sInfo){this.addData(sInfo,4)},log:function(sInfo){this.addData(sInfo,5)},dir:function(oInfo){this.addData(oInfo,5)},addData:function(sInfo,nType,sColor,sBgColor){if(sInfo==null){return}if(typeof sInfo!="object"){sInfo=sInfo.toString()}var oOption={type:nType||"5",color:sColor||this.baseColor[nType].color,bgcolor:sBgColor||this.baseColor[nType].bgcolor};this.cacheData.push([sInfo,oOption]);if(this.initFinished==true){this.showCurrentData([sInfo,oOption])}}};window.trace=bind(window[debug_namespace].log,window[debug_namespace]);window.traceError=bind(window[debug_namespace].error,window[debug_namespace])}})();Sina.pkg("Core");if(typeof Core=="undefined"){Core=Sina.Core}Sina.pkg("Core.Array");Core.Array.foreach=function(ar,insp){if(ar==null&&ar.constructor!=Array){return[]}var i=0,len=ar.length,r=[];while(i<len){var x=insp(ar[i],i);if(x!==null){r[r.length]=x}i++}return r};Sina.pkg("Core.Events");(function(_s){var _ua=navigator.userAgent.toLowerCase();var system={$winXP:/windows nt 5.1/.test(_ua),$winVista:/windows nt 6.0/.test(_ua),$win7:/windows nt 6.1/.test(_ua),$macOS:/mac/.test(_ua)};var browser={$OPERA:false,$IE6:false,$IE7:false,$IE8:false,$IE9:false,$SAFARI:false,$FF2:false,$FF3:false,$FF4:false,$FF:false,$CHROME:false,$TT:false,$360:false,$SOGO:false,$Maxthon:false};var engine={$IE:0,$MOZ:false,$WEBKIT:false,$KHTML:false};if(/opera/.test(_ua)||_s.opera){browser.$OPERA=true}else if(/chrome\/(\S+)/.test(_ua)){browser.$CHROME=true}else if(/safari\/(\S+)/.test(_ua)){browser.$SAFARI=true}else if(/msie/.test(_ua)){engine.$IE=true;if(/360se/.test(_ua)){browser.$360=true}else if(/tencenttraveler/.test(_ua)){browser.$TT=true}else if(/se\s\S+\smetasr\s\d+\.\d+/.test(_ua)){browser.$SOGO=true}var uaVersionArray=_ua.match(/msie (\d+)/);var version=parseInt(uaVersionArray[1]);engine.$IE=version;if(version===8){browser.$IE8=true}else if(version===6){browser.$IE6=true}else if(version===9){browser.$IE9=true}else if(version===7){browser.$IE7=true}else if(version===10){browser.$IE10=true}}else if(/firefox/.test(_ua)){var uaVersionArray=_ua.match(/firefox\/(\d+)/);browser.$FF=parseInt(uaVersionArray[1]);if(/firefox\/3/.test(_ua)){browser.$FF3=true}else if(/firefox\/4/.test(_ua)){browser.$FF4=true}else if(/firefox\/2/.test(_ua)){browser.$FF2=true}}else if(/trident\/7.0/.test(_ua)&&/rv:11.0/.test(_ua)){engine.$IE=11;browser.$IE11=true}try{var t=window.external;browser.$Maxthon=t.max_version?true:false}catch(e){}if(/applewebkit\/(\S+)/.test(_ua)){engine.$WEBKIT=true}else if(/khtml\/(\S+)/.test(_ua)){engine.$KHTML=true}else if(/rv:([^\)]+)\) gecko\/\d{8}/.test(_ua)){engine.$MOZ=true}browser.$MOBILE=/mobile/i.test(_ua);if(!browser.$MOBILE){browser.$MOBILE=/HTC/.test(_ua)}function apply(thisObj,cfg){var p;for(p in cfg){thisObj[p]=cfg[p]}}apply(_s,browser);apply(_s,engine);apply(_s,system)})(window);Core.Events.addEvent=function(elm,func,evType,useCapture){var _el=typeof elm=="string"?$E(elm):elm;if(_el==null){trace("addEvent 找不到对象："+elm);return}if(typeof useCapture=="undefined"){useCapture=false}if(typeof evType=="undefined"){evType="click"}if(_el.addEventListener){if(evType=="mousewheel"&&$FF){evType="DOMMouseScroll"}_el.addEventListener(evType,func,useCapture);return true}else if(_el.attachEvent){var r=_el.attachEvent("on"+evType,func);return true}else{_el["on"+evType]=func}};Core.Events.removeEvent=function(oElement,fHandler,sName){var _el=$E(oElement);if(_el==null){trace("removeEvent 找不到对象："+oElement);return}if(typeof fHandler!="function"){return}if(typeof sName=="undefined"){sName="click"}if(_el.addEventListener){_el.removeEventListener(sName,fHandler,false)}else if(_el.attachEvent){_el.detachEvent("on"+sName,fHandler)}fHandler[sName]=null};Sina.pkg("Core.Function");Core.Function.bind3=function(fFunc,object,args){args=args==null?[]:args;var __method=fFunc;return function(){return __method.apply(object,args)}};Core.Array.findit=function(arr,v){var k=-1;Core.Array.foreach(arr,function(value,index){if(v==value){k=index}});return k};window.onerror=function(err,file,line){trace("Error occured:"+err+"<br/>file:"+file+"<br/>line:"+line+"<br/>");return true};function Jobs(oOption){this.option=oOption||{};this._jobTable=[[],[],[],[]]}Jobs.prototype={_registedJobTable:{},errorMsg:[],_registJob:function(jobName,rel){this._registedJobTable[jobName]=rel},error:function(sMsg){Debug.error(sMsg);this.errorMsg.push(sMsg)},add:function(jobName,type){type=type||1;if(Core.Array.findit(this._jobTable[type],jobName)==-1){this._jobTable[type].push(jobName)}else{this.error("Error: Job <b>"+jobName+"</b> is existed now.")}},start:function(){if(this.option.onStart!=null){this.option.onStart()}var regJobs=this._registedJobTable;var jobs=this._jobTable[1].concat(this._jobTable[2]);var _this=this;this.fe=Core.Function.bind3(_this.focus,_this,[]);var addFocus=function(){if(_this._jobTable[3].length==0){if(_this.option.onEnd!=null){_this.option.onEnd()}return}Core.Events.addEvent(document.body,_this.fe,"focus");Core.Events.addEvent(window,_this.fe,"scroll");Core.Events.addEvent(document.body,_this.fe,"mousemove");Core.Events.addEvent(document.body,_this.fe,"mouseover")};this.queue(jobs,addFocus)},focus:function(){var _this=this;if(this.focusdown){Core.Events.removeEvent(document.body,_this.fe,"focus");Core.Events.removeEvent(window,_this.fe,"scroll");Core.Events.removeEvent(document.body,_this.fe,"mousemove");Core.Events.removeEvent(document.body,_this.fe,"mouseover");_this.fe=null;return}this.focusdown=true;var jobs=this._jobTable[3];this.queue(jobs,this.option.onEnd)},queue:function(jobs,callback){var _this=this;var getTime=function(){return(new Date).valueOf()};var regJobs=this._registedJobTable;var joblen=jobs.length;var i=0;var interNum=window.setInterval(function(){if(i>=joblen){clearInterval(interNum);interNum=null;if(callback!=null){callback()}return}var jobName=jobs[i];var job=regJobs[jobName];i++;if(typeof job=="undefined"){_this.error("<b>Job["+jobName+"] is undefiend!!!</b>");return}var _try=true;var _start=getTime();try{job.call()}catch(e){_this.error("<b>Job["+jobName+"] failed!!!</b>"+e.message+"");if(callback!=null){callback()}_try=false;throw e}finally{if(_try){var _end=getTime();Debug.info("<b>Job["+jobName+"] done in "+(_end-_start)+"ms.</b>")}}},10)},call:function(jobName,args){if(typeof this._registedJobTable[jobName]!="undefined"){this._registedJobTable[jobName].apply(this,args)}else{trace("<b>Job["+jobName+"] is undefined!!!</b>",{color:"#900",bgColor:"#FFF;"})}}};$registJob=function(name,rel){Jobs.prototype._registJob(name,rel)};$callJob=function(name){var args=[];if(arguments.length>1){Core.Array.foreach(arguments,function(v,i){args[i]=v});args.shift()}Jobs.prototype.call(name,args)};Sina.pkg("Utils");if(typeof Utils=="undefined"){Utils=Sina.Utils}Sina.pkg("Utils.Io");Utils.Io.loadCss=function(oCss,oTarget){if(oCss==null){return false}oTarget=oTarget||window;var _target=oTarget.document;oCss.id=oCss.id||"";var _css;if(oCss.url){_css=_target.createElement("link");_css.setAttribute("rel","stylesheet");_css.setAttribute("type","text/css");_css.setAttribute("href",oCss.url)}else if(oCss.text){_css=_target.createElement("style");_css.setAttribute("type","text/css");if($IE){_css.styleSheet.cssText=oCss.text}else{_css.innerHTML=oCss.text}}_css.setAttribute("id",oCss.id);_target.getElementsByTagName("head")[0].appendChild(_css)};Sina.pkg("Core.System");(function(){var parseParam=function(oSource,oParams){var key;try{if(typeof oParams!="undefined"){for(key in oSource){if(oParams[key]!=null){oSource[key]=oParams[key]}}}}finally{key=null;return oSource}};Core.System.parseParam=parseParam})();Sina.pkg("Core.String");Utils.Url=function(url){url=url||"";this.url=url;this.query={};this.parse()};Utils.Url.prototype={parse:function(url){if(url){this.url=url}this.parseAnchor();this.parseParam()},parseAnchor:function(){var anchor=this.url.match(/\#(.*)/);anchor=anchor?anchor[1]:null;this._anchor=anchor;if(anchor!=null){this.anchor=this.getNameValuePair(anchor);this.url=this.url.replace(/\#.*/,"")}},parseParam:function(){var query=this.url.match(/\?([^\?]*)/);query=query?query[1]:null;if(query!=null){this.url=this.url.replace(/\?([^\?]*)/,"");this.query=this.getNameValuePair(query)}},getNameValuePair:function(str){var o={};str.replace(/([^&=]*)(?:\=([^&]*))?/gim,function(w,n,v){if(n==""){return}o[n]=v||""});return o},getParam:function(sPara){return this.query[sPara]||""},clearParam:function(){this.query={}},setParam:function(name,value){if(name==null||name==""||typeof name!="string"){throw new Error("no param name set")}this.query=this.query||{};this.query[name]=value},setParams:function(o){this.query=o},serialize:function(o){var ar=[];for(var i in o){if(o[i]==null||o[i]==""){ar.push(i+"=")}else{ar.push(i+"="+o[i])}}return ar.join("&")},toString:function(){var queryStr=this.serialize(this.query);return this.url+(queryStr.length>0?"?"+queryStr:"")+(this.anchor?"#"+this.serialize(this.anchor):"")},getHashStr:function(forceSharp){return this.anchor?"#"+this.serialize(this.anchor):forceSharp?"#":""}};Core.String.encodeDoubleByte=function(str){if(typeof str!="string"){return str}return encodeURIComponent(str)};Utils.Io.JsLoad={};(function(){function createScripts(oOpts,oCFG){processUrl(oOpts,oCFG);var urls=oOpts.urls;var i,len=urls.length;for(i=0;i<len;i++){var js=$C("script");js.src=urls[i].url;js.charset=urls[i].charset;js.onload=js.onerror=js.onreadystatechange=function(){if(js&&js.readyState&&js.readyState!="loaded"&&js.readyState!="complete"){return}oCFG.script_loaded_num++;js.onload=js.onreadystatechange=js.onerror=null;if(!1!==oOpts.isRemove){js.src="";js.parentNode.removeChild(js)}js=null};document.getElementsByTagName("head")[0].appendChild(js)}}function processUrl(oOpts,oCFG){var urls=oOpts.urls;var get_hash=oOpts.GET;var i,len=urls.length;var key,url_cls,varname,rnd;for(i=0;i<len;i++){rnd=window.parseInt(Math.random()*1e8);url_cls=new Utils.Url(urls[i].url);for(key in get_hash){if(oOpts.noencode==true){url_cls.setParam(key,get_hash[key])}else{url_cls.setParam(key,Core.String.encodeDoubleByte(get_hash[key]))}}varname=url_cls.getParam("varname")||"requestId_"+rnd;if(oOpts.noreturn!=true){url_cls.setParam("varname",varname)}if(oOpts.returnType=="jsonp"){var name=url_cls.getParam("callback")||"callback_"+rnd;var callback="script_callbackes."+name;url_cls.setParam("callback",callback);if(!window.script_callbackes){window.script_callbackes=[]}window.script_callbackes[name]=function(res){oCFG.is_loadcomplete=true;delete window.script_callbackes[name];if(oCFG.timeout_flag!=null){clearTimeout(oCFG.timeout_flag)}if(oCFG.is_timeout){return}if(oOpts.onComplete!=null){oOpts.onComplete(res)}}}oCFG.script_var_arr.push(varname);urls[i].url=url_cls.toString();urls[i].charset=urls[i].charset||oOpts.charset}}function ancestor(aUrls,oOpts){var _opts={isRemove:!0,urls:[],charset:"utf-8",noreturn:false,noencode:false,returnType:"",timeout:-1,POST:{},GET:{},onComplete:null,onException:null};var _cfg={script_loaded_num:0,is_timeout:false,is_loadcomplete:false,script_var_arr:[],timeout_flag:null};_opts.urls=typeof aUrls=="string"?[{url:aUrls}]:aUrls;Core.System.parseParam(_opts,oOpts);createScripts(_opts,_cfg);if(_opts.returnType!="jsonp"){(function(){if(_opts.noreturn==true&&_opts.onComplete==null){return}var i,data=[];if(_cfg.script_loaded_num==_opts.urls.length){_cfg.is_loadcomplete=true;if(_opts.onComplete!=null){for(i=0;i<_cfg.script_var_arr.length;i++){data.push(window[_cfg.script_var_arr[i]])}if(_cfg.script_var_arr.length<2){_opts.onComplete(data[0])}else{_opts.onComplete(data)}}return}if(_cfg.is_timeout==true){return}setTimeout(arguments.callee,50)})()}if(_opts.timeout>0){_cfg.timeout_flag=setTimeout(function(){if(_cfg.is_loadcomplete!=true){if(_opts.onException!=null){_opts.onException()}_cfg.is_timeout=true}},_opts.timeout)}}Utils.Io.JsLoad.request=function(aUrls,oOpts){new ancestor(aUrls,oOpts)}})();if(typeof Lib=="undefined"){Lib={}}Lib.pkg=function(ns){if(!ns||!ns.length){return null}var levels=ns.split(".");var nsobj=Lib;for(var i=levels[0]=="Lib"?1:0;i<levels.length;++i){nsobj[levels[i]]=nsobj[levels[i]]||{};nsobj=nsobj[levels[i]]}return nsobj};Sina.pkg("Utils.Cookie");Utils.Cookie.getCookie=function(name){name=name.replace(/([\.\[\]\$])/g,"\\$1");var rep=new RegExp(name+"=([^;]*)?;","i");var co=document.cookie+";";var res=co.match(rep);if(res){return res[1]||""}else{return""}};Core.System.keyValue=function(string,key){var arr=string.match(new RegExp("(\\?|&)"+key+"=([^&]*)(&|$)"));if(arr!=null)return arr[2];return null};Lib.checkAuthor=function(){var AuthorInfo=unescape(Utils.Cookie.getCookie("SUP"));if(AuthorInfo&&AuthorInfo!=""){$UID=Core.System.keyValue(AuthorInfo,"uid");$nick=decodeURIComponent(Core.System.keyValue(AuthorInfo,"nick"));$isLogin=!!$UID;if(typeof scope.$uid=="undefined"){$isAdmin=false}else{$isAdmin=scope.$uid==$UID}}else{AuthorInfo=Utils.Cookie.getCookie("SU");if(AuthorInfo&&AuthorInfo!=""){var match=AuthorInfo.match(/^([^:]*:){2}(\d{5,11})/);$UID=match&&match[2]||null;window.$isLogin=!!$UID;if(typeof scope.$uid=="undefined"){window.$isAdmin=false}else{window.$isAdmin=scope.$uid==$UID}}else{$UID=null;$isLogin=false;$isAdmin=false}}};Lib.register=function(name,fn){var ns=name.split(".");var obj={},tmp,nsobj=Lib;while(tmp=ns.shift()){if(ns.length){if(nsobj[tmp]===undefined){nsobj[tmp]={}}nsobj=nsobj[tmp]}else{if(nsobj[tmp]===undefined){nsobj[tmp]=fn(Lib)}}}};Lib.register("util.loadScript",function(){var TRUE=!0,FALSE=!1,cache={};var loadScript=function(url,item){Utils.Io.JsLoad.request(url,{isRemove:FALSE,noreturn:TRUE,onComplete:function(data){cache[url].isLoading=FALSE;var cb=cache[url].cb;for(var i=0,len=cb.length;i<len;i++){cb[i](data)}cache[url].cb=null}})};return function(url,fun){var item=cache[url];var cb=item&&item["cb"];if(!item){cb=[fun];item={isLoading:TRUE,cb:cb};cache[url]=item;loadScript(url,item)}else if(item.isLoading){cb.push(fun)}else{fun()}}});Lib.register("sendSuda",function(lib){var url="http://www.sinaimg.cn/unipro/pub/suda_s_v851c.js";return function(fun){lib.util.loadScript(url,fun)}});function v6SendLog(type,label){}function v7sendLog(type,pageid,msg){if(!type){return false}if(type.split("_").length==3){Lib.checkAuthor();if($isLogin){type+="_"+$UID}}if(typeof scope=="undefined"){window.scope={};scope.$pageid=""}pageid=pageid||scope.$pageid;msg=msg||"";Utils.Io.JsLoad.request("http://hits.sinajs.cn/A2/b.html?type="+type+"&pageid="+pageid+"&msg="+msg,{onComplete:function(){}})}Core.Array.uniq=function(ar){var result=[],x;for(var i=0;i<ar.length;i++){x=ar[i];if(Core.Array.findit(result,x)==-1){result.push(x)}}return result};Core.String.trimHead=function(str){return str.replace(/^(\u3000|\s|\t)*/gi,"")};Core.String.trimTail=function(str){return str.replace(/(\u3000|\s|\t)*$/gi,"")};Core.String.trim=function(str){return Core.String.trimHead(Core.String.trimTail(str))};Lib.Uic={_interfaceMultiquery:"http://uic.sso.sina.com.cn/uic/Mutiquery.php",cacheNickName:{},getNickName:function(arrUidLists,fCallBack,requestNo){arrUidLists=Core.Array.uniq(arrUidLists)||[];requestNo=requestNo||10;var _trim=Core.String.trim;var _cache=this.cacheNickName,_uidWithNoCache=[],nickType=[];var _data={};for(var i=0,len=arrUidLists.length;i<len;i++){if(typeof _cache[arrUidLists[i]]=="undefined"&&_cache[arrUidLists[i]]==null){var nickEl=$E("ownernick");var pageid=_trim(scope.$pageid);if(arrUidLists[i]==$UID&&scope.nickname!=null){_data[arrUidLists[i]]=_trim(scope.nickname);continue}_uidWithNoCache.push(arrUidLists[i])}else{_data[arrUidLists[i]]=_cache[arrUidLists[i]]||arrUidLists[i]}}if(_uidWithNoCache.length==0){fCallBack(_data);_data=null}else{var urls=[];for(var i=0;i<_uidWithNoCache.length;i++){nickType[i]=1}if(_uidWithNoCache.length>0){if(nickType.length>0){nickType="["+nickType.toString().replace(/,$/g,"")+"]"}_uidWithNoCache="["+_uidWithNoCache.toString().replace(/,$/g,"")+"]";urls.push({url:this._interfaceMultiquery+"?UID=0&Check=null&UIDS="+_uidWithNoCache+"&UserInfoTypes="+nickType+"&ProductType=2"})}var jsRequest=function(aUrl){Utils.Io.JsLoad.request(aUrl[0].url,{onComplete:function(data){if(data){var uids=data.UserInfos;for(var i=0;i<uids.length;i++){_data[uids[i][0]]=uids[i][2][1];Lib.Uic.cacheNickName[uids[i][0]]=uids[i][2][1]}fCallBack(_data)}}});if(urls.length>0){setTimeout(function(){jsRequest(urls.splice(0,1))},10)}};if(urls.length>0){setTimeout(function(){jsRequest(urls.splice(0,1))},10)}}}};Core.String.byteLength=function(str){if(typeof str=="undefined"){return 0}var aMatch=str.match(/[^\x00-\x80]/g);return str.length+(!aMatch?0:aMatch.length)};Core.String.leftB=function(str,len){var s=str.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**");str=str.slice(0,s.slice(0,len).replace(/\*\*/g," ").replace(/\*/g,"").length);if(Core.String.byteLength(str)>len)str=str.slice(0,str.length-1);return str};$registJob("suda",function(){var pageId=scope&&scope.$pageid;var wlh=window.location.href;var isTj=wlh.indexOf("tj=1")>-1;var suda_flag=pageId&&(pageId==="articletj"||pageId==="index"||pageId==="indexM"||pageId==="editor"||isTj);function addSudaPage(pageId,parm1,parm2,parm3,parm4){if(isTj){v7sendLog(parm4)}switch(pageId){case"index":case"indexM":v7sendLog(parm1);break;case"editor":v7sendLog(parm2);break;case"articletj":v7sendLog(parm3);break}}if(suda_flag){var url=encodeURIComponent(wlh);var refer=encodeURIComponent(document.referrer)}if(typeof _S_pSt=="function"){if(suda_flag){v7sendLog("42_01_03_"+(new Date).getTime()+"_"+url+"_"+refer)}return}if(suda_flag){if(!$isLogin){var tj="42_01_01_"+(new Date).getTime()+"_"+url+"_"+refer}else{var tj="42_01_01_"+$UID+"_"+(new Date).getTime()+"_"+url+"_"+refer}addSudaPage(pageId,"42_01_08","42_01_14",tj,"42_01_05")}Lib.sendSuda(function(){try{_S_pSt("")}catch(e){}if(suda_flag){if(!$isLogin){var succTj="42_01_02_"+(new Date).getTime()+"_"+url+"_"+refer}else{var succTj="42_01_02_"+$UID+"_"+(new Date).getTime()+"_"+url+"_"+refer}addSudaPage(pageId,"42_01_09","42_01_15",succTj,"42_01_06")}});var ele=$E("blognamespan");if(!ele){return}Lib.checkAuthor();Lib.Uic.getNickName([scope.$uid],function(oResult){var nickName=oResult[scope.$uid];nickName=nickName.replace(/\u7684\u535a\u5ba2$/,"");nickName=Core.String.leftB(nickName,30);nickName=nickName+"的博客";ele.innerHTML=nickName});(function(d,s,id){var n=d.getElementsByTagName(s)[0];if(d.getElementById(id))return;s=d.createElement(s);s.id=id;s.setAttribute("charset","utf-8");s.src="//d"+Math.floor(0+Math.random()*(8-0+1))+".sina.com.cn/litong/zhitou/sinaads/src/spec/sinaads_ck.js";n.parentNode.insertBefore(s,n)})(document,"script","sinaads-ck-script")});Lib.register("Listener",function(){var _this={};_this.listeners={};return{add:function(name){if(_this.listeners[name]){throw new Error("listener '"+name+"' has registed!")}_this.listeners[name]=[]},remove:function(name){if(_this.listeners[name]){_this.listeners[name]=null;return true}return false},notify:function(name,data){var listeners=_this.listeners[name],handle=null;if(!listeners){return}for(var i=0,len=listeners.length;i<len;i++){handle=listeners[i];handle.callBack.call(handle.scope,data)}},on:function(o){var args=arguments,handle=null;for(var i=0,len=args.length;i<len;i++){handle=args[i];if(!this.isListen(handle)){if(!_this.listeners[handle.name]){_this.listeners[handle.name]=[]}_this.listeners[handle.name].push(handle)}}},off:function(o){var handlers=_this.listeners[o.name];if(!handlers){return true}var handle=null;for(var i=0,len=handlers.length;i<len;i++){handle=handlers[i];if(handle.callBack==o.callBack&&handle.scope==o.scope){handlers.splice(i,1)}}},isListen:function(listener){var handlers=_this.listeners[listener.name];var handle=null;if(!handlers){return false}for(var i=0,len=handlers.length;i<len;i++){handle=handlers[i];if(handle.callBack==listener.callBack&&handle.scope==listener.scope){return true}}return false}}});(function(){function object(o){function F(){}F.prototype=o;return new F}Function.prototype.$define=function(def){var k;for(k in def){this.prototype[k]=def[k]}if(this.__interface__){for(k in this.prototype){if(this.prototype[k]==="NI"){throw new Error("类定义错误，接口方法["+k+"]未实现")}}}this.prototype.constructor=this;this.$extends=this.$define=this.$implements=function(){throw new Error("$define语句定义后面不能再作其它定义")};return this};Function.prototype.$extends=function(){var me=this,i=arguments.length,sup,fn;if(i===0){throw new Error("$extends语句错误：未指定父类")}sup=arguments[0];fn=function(){sup.apply(this,arguments);me.apply(this,arguments)};fn.prototype=object(sup.prototype);fn.prototype.constructor=fn;fn.$super=sup.prototype;return fn};Function.prototype.$implements=function(){var arg=Array.prototype.slice.call(arguments,0),fn,i=arg.length,k;while(i--){if(typeof arg[i]!=="object"){throw new Error("$implements语句错误：参数必须为object类型")}for(k in arg[i]){typeof this.prototype[k]==="undefined"&&(this.prototype[k]="NI")}}this.__interface__=true;this.$extends=function(){throw new Error("$extends语句错误:$extends语句不能出现在$implements定义之后")};return this}})();Core.Events.getEvent=function(){return window.event};if(!$IE||$IE>8){Core.Events.getEvent=function(){if(!$IE&&window.event){return window.event}var o=arguments.callee.caller;var e;var n=0;while(o!=null&&n<40){e=o.arguments[0];if(e&&(e.constructor==Event||e.constructor==MouseEvent)){return e}n++;o=o.caller}return e}}Core.Events.stopEvent=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.cancelBubble=true;ev.returnValue=false}};if(!$IE||$IE>8){Core.Events.stopEvent=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.preventDefault();ev.stopPropagation()}}}Sina.pkg("Ui");if(typeof Ui=="undefined"){Ui=Sina.Ui}Core.Function.bind2=function(fFunc,object){var __method=fFunc;return function(){return __method.apply(object,arguments)}};Function.prototype.bind2=function(object){var __method=this;return function(){return __method.apply(object,arguments)}};Ui.Template=function(tmpl){this.tmpl=tmpl;this.pattern=/(#\{(.*?)\})/g};Ui.Template.prototype={evaluate:function(data){return this.tmpl.replace(this.pattern,function(){return data[arguments[2]]||""})},evaluateMulti:function(data,reverse){var _buffer=[];Core.Array.foreach(data,Core.Function.bind2(function(v,i){i=reverse?data.length-i:i;_buffer[i]=this.evaluate(v)},this));return _buffer.join("")}};Sina.pkg("Core.Dom");Core.Dom.setStyle=function(el,property,val){switch(property){case"opacity":el.style.filter="alpha(opacity="+val*100+")";if(!el.currentStyle||!el.currentStyle.hasLayout){el.style.zoom=1}break;case"float":property="styleFloat";default:el.style[property]=val}};if(!$IE||!($IE<9)){Core.Dom.setStyle=function(el,property,val){if(property=="float"){property="cssFloat"}el.style[property]=val}}(function(){Core.Function.defineGetter=function(obj,p,fn){if(p instanceof Array&&fn instanceof Array){var i=Math.min(p.length,fn.length);while(i--){if(typeof p[i]==="string"&&__checkFunction(fn[i])){obj[p[i]]={valueOf:function(j){return function(){return __getValue(obj,fn[j])}}(i),toString:this.valueOf}}}}else if(typeof p==="string"&&__checkFunction(fn)){obj[p]={valueOf:function(){return __getValue(obj,fn)},toString:this.valueOf}}};function __checkFunction(fn){return typeof fn!=="string"&&String.prototype.slice.call(fn,0,8)=="function"}function __getValue(obj,fn){var ret=fn.call(obj);return typeof ret==="string"||typeof ret==="number"?ret:null}})();Ui.IE6FixedController=function(){var me=this;this.node=null;this.iframeNode=null;this.__orgX=0;this.__orgY=0;this.__isBindScroll=false;this.__fixedHandle=function(){if(me.node){me.node.style.left=document.documentElement.scrollLeft+me.__orgX+"px";me.node.style.top=document.documentElement.scrollTop+me.__orgY+"px"}if(me.iframeNode){me.iframeNode.style.left=me.node.style.left;me.iframeNode.style.top=me.node.style.top}}}.$define({setFixed:function(node,state){this.updateOrgPosition();if(state&&!this.__isBindScroll){Core.Events.addEvent(window,this.__fixedHandle,"scroll");this.__isBindScroll=true}if(!state&&this.__isBindScroll){Core.Events.removeEvent(window,this.__fixedHandle,"scroll");this.__isBindScroll=false}},setPosition:function(node,fixedState,p){if(typeof p.x!=="undefined"){if(fixedState){node.style.left=p.x+document.documentElement.scrollLeft+"px";this.__orgX=parseInt(this.node.style.left)-document.documentElement.scrollLeft}else{node.style.left=p.x+"px"}}if(typeof p.y!=="undefined"){if(fixedState){node.style.top=p.y+document.documentElement.scrollTop+"px";this.__orgY=parseInt(this.node.style.top)-document.documentElement.scrollTop}else{node.style.top=p.y+"px"}}typeof p.z!=="undefined"&&(node.style.zIndex=p.z)},getX:function(node,fixedState){if(fixedState){return parseInt(node.style.left)-document.documentElement.scrollLeft}else{return parseInt(node.style.left)}},getY:function(node,fixedState){if(fixedState){return parseInt(node.style.top)-document.documentElement.scrollTop}else{return parseInt(node.style.top)}},updateIframe:function(isFixed){this.setFixed(this.iframeNode,isFixed);isFixed&&this.__fixedHandle()},updateOrgPosition:function(){if(!this.node){return}this.__orgX=parseInt(this.node.style.left)-document.documentElement.scrollLeft;this.__orgY=parseInt(this.node.style.top)-document.documentElement.scrollTop},destroy:function(){Core.Events.removeEvent(window,this.__fixedHandle,"scroll");this.__isBindScroll=false;this.node=null;this.iframeNode=null}});Core.Events.EventDispatcher=function(target){this.__target=target;this.__events={}}.$define({addEventListener:function(type,handle){if(!this.__checkFunction(handle)){return}var evts=this.__events;type=type.toLowerCase();!evts[type]&&(evts[type]=[]);evts[type].push(handle)},removeEventListener:function(type,handle){var evts=this.__events[type];type=type.toLowerCase();if(!this.__checkFunction(handle)||!evts||!evts.length){return}for(var i=evts.length-1;i>=0;i--){evts[i]==handle&&evts.splice(i,1)}},dispatchEvent:function(type){type=type.toLowerCase();var evts=this.__events[type];if(!evts||!evts.length){return}var args=Array.prototype.slice.call(arguments,0);args.shift();for(var i=0,l=evts.length;i<l;i++){evts[i].apply(this.__target,args)}},__checkFunction:function(func){return typeof func!=="string"&&String.prototype.slice.call(func,0,8)=="function"}});Ui.IRenderer={setCanShow:function(state){},setCanHidden:function(state){},show:function(node){},hidden:function(node){},addEventListener:function(type,handle){},removeEventListener:function(type,handle){}};Ui.SimpleRenderer=function(){this.__canShow=true;this.__canHidden=true;this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$implements(Ui.IRenderer).$define({setCanShow:function(state){this.__canShow=!!state},setCanHidden:function(state){this.__canHidden=!!state},show:function(node){this.__eventDispatcher.dispatchEvent("beforeShow");if(this.__canShow){node.style.display="";this.__eventDispatcher.dispatchEvent("show")}return this},hidden:function(node){this.__eventDispatcher.dispatchEvent("beforeHidden");if(this.__canHidden){node.style.display="none";this.__eventDispatcher.dispatchEvent("hidden")}return this},addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this}});Ui.DisplayObject=function(parent,node){Core.Function.defineGetter(this,["x","y","z","width","height"],[this.__getX,this.__getY,this.__getZ,this.__getWidth,this.__getHeight]);this.__renderer=null;this.__entity=node;this.__isInited=false;this.__parent=parent||document.body;this.__eventDispatcher=new Core.Events.EventDispatcher(this);var ed=this.__eventDispatcher;this.__onBeforeShow=function(){ed.dispatchEvent("beforeShow")};this.__onShow=function(){ed.dispatchEvent("show")};this.__onBeforeHidden=function(){ed.dispatchEvent("beforeHidden")};this.__onHidden=function(){ed.dispatchEvent("hidden")};this.__updateRenderer(Ui.SimpleRenderer)}.$define({isShow:!1,isHidden:!0,setPosition:function(p){!this.__isInited&&this.__initEntity();typeof p.x!=="undefined"&&(this.__entity.style.left=p.x+"px");typeof p.y!=="undefined"&&(this.__entity.style.top=p.y+"px");typeof p.z!=="undefined"&&(this.__entity.style.zIndex=p.z);return this},setSize:function(p){!this.__isInited&&this.__initEntity();typeof p.width!=="undefined"&&(this.__entity.style.width=p.width+"px");typeof p.height!=="undefined"&&(this.__entity.style.height=p.height+"px");return this},setRenderer:function(rendererConstructor){!this.__isInited&&this.__initEntity();this.__updateRenderer(rendererConstructor);return this},show:function(rendererConstructor){this.isHidden=!1;this.isShow=!0;!this.__isInited&&this.__initEntity();this.__updateRenderer(rendererConstructor);this.__renderer.show(this.__entity);return this},hidden:function(rendererConstructor){return this.hide(rendererConstructor)},hide:function(rendererConstructor){this.isHidden=!0;this.isShow=!1;!this.__isInited&&this.__initEntity();this.__updateRenderer(rendererConstructor);this.__renderer.hidden(this.__entity);return this},setCanShow:function(state){this.__renderer.setCanShow(state);return this},setCanHidden:function(state){this.__renderer.setCanHidden(state);return this},addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},destroy:function(){if(!this.__entity){return}!this.__isInited&&this.__initEntity();this.__entity.parentNode&&this.__entity.parentNode.removeChild(this.__entity);this.__entity=null},__initEntity:function(){var st;!this.__entity&&(this.__entity=$C("div"));st=this.__entity.style;st.position="absolute";st.left=0;st.top=0;!this.__entity.parentNode&&this.__parent.appendChild(this.__entity);this.__isInited=true},__updateRenderer:function(rendererConstructor){if(!rendererConstructor){return}var addEvent=function(){this.__renderer.addEventListener("beforeShow",this.__onBeforeShow).addEventListener("show",this.__onShow).addEventListener("beforeHidden",this.__onBeforeHidden).addEventListener("hidden",this.__onHidden)};if(!this.__renderer){this.__renderer=new rendererConstructor;addEvent.call(this)}else if(this.__renderer.constructor!==rendererConstructor){this.__renderer.removeEventListener("beforeShow",this.__onBeforeShow).removeEventListener("show",this.__onShow).removeEventListener("beforeHidden",this.__onBeforeHidden).removeEventListener("hidden",this.__onHidden);this.__renderer=new rendererConstructor;addEvent.call(this)}},__getX:function(){!this.__isInited&&this.__initEntity();return parseInt(this.__entity.style.left)},__getY:function(){!this.__isInited&&this.__initEntity();return parseInt(this.__entity.style.top)},__getZ:function(){!this.__isInited&&this.__initEntity();return parseInt(this.__entity.style.zIndex);

},__getWidth:function(){!this.__isInited&&this.__initEntity();return this.__getSize(this.__entity,"offsetWidth")},__getHeight:function(){!this.__isInited&&this.__initEntity();return this.__getSize(this.__entity,"offsetHeight")},__getSize:function(node,p){var et=node,v,ov=et.style.visibility;if(et.style.display=="none"){et.style.visibility="hidden";et.style.display="";v=et[p];et.style.display="none";et.style.visibility=ov}else{v=et[p]}return v}});Ui.Panel=function(parent,node){this.nodes={};this.uniqueID=this.__getUniqueID();this.entity=null;this.__iframe=null;this.__isSetAdamant=false;this.__templateNodesIDs=[];this.__isFixed=false;$IE6&&(this.__ie6FixedController=new Ui.IE6FixedController)}.$extends(Ui.DisplayObject).$define({setTemplate:function(tpl){var nd=$C("div");nd.innerHTML=new Ui.Template(tpl).evaluate(this.__getNodes(tpl,"i"));nd.style.display="none";this.__parent.appendChild(nd);this.__updateTemplate(nd);this.nodes=this.__getNodes(tpl);this.entity=this.__entity;this.nodes.panel=this.entity;return this},setFixed:function(state){!this.__isInited&&this.__initEntity();var x=parseInt(this.__entity.style.left),y=parseInt(this.__entity.style.top);if($IE6){this.__ie6FixedController.setFixed(this.__entity,state);this.__isSetAdamant&&this.__ie6FixedController.setFixed(this.__iframe,state)}else{if(state&&!this.__isFixed){this.setPosition({x:x-Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),y:y-Math.max(document.documentElement.scrollTop,document.body.scrollTop)});this.__entity.style.position="fixed"}if(!state&&this.__isFixed){this.setPosition({x:x+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),y:y+Math.max(document.documentElement.scrollTop,document.body.scrollTop)});this.__entity.style.position="absolute"}}this.__isFixed=!!state;this.__updateIframe();return this},setAdamant:function(state){this.__isSetAdamant=!!state;this.__isSetAdamant&&!this.__iframe&&this.__createIframe();this.__updateIframe();return this},destroy:function(){if(!this.__entity){return}Ui.Panel.$super.destroy.call(this);this.__ie6FixedController&&this.__ie6FixedController.destroy();this.__iframe&&this.__iframe.parentNode.removeChild(this.__iframe)},setPosition:function(p){!this.__isInited&&this.__initEntity();if($IE6){this.__ie6FixedController.setPosition(this.__entity,this.__isFixed,p)}else{Ui.Panel.$super.setPosition.call(this,p)}this.__updateIframe();return this},setSize:function(p){Ui.Panel.$super.setSize.call(this,p).__updateIframe();return this},show:function(renderer){Ui.Panel.$super.show.call(this,renderer).__updateIframe();return this},hidden:function(renderer){Ui.Panel.$super.hidden.call(this,renderer).__updateIframe();return this},__getX:function(){!this.__isInited&&this.__initEntity();if($IE6){return this.__ie6FixedController.getX(this.__entity,this.__isFixed)}else{return parseInt(this.__entity.style.left)}},__getY:function(){!this.__isInited&&this.__initEntity();if($IE6){return this.__ie6FixedController.getY(this.__entity,this.__isFixed)}else{return parseInt(this.__entity.style.top)}},__createIframe:function(){this.__iframe=$C("iframe");this.__iframe.frameBorder="none";this.__parent.insertBefore(this.__iframe,this.__entity);Core.Dom.setStyle(this.__iframe,"opacity",0);this.__ie6FixedController&&(this.__ie6FixedController.iframeNode=this.__iframe);this.__updateIframe()},__updateIframe:function(){if(this.__iframe){var st=this.__iframe.style;st.backgroundColor="#ffffff";st.left=this.x+"px";st.top=this.y+"px";st.width=this.width+"px";st.height=this.height+"px";st.position=this.__entity.style.position;st.display=this.__entity.style.display;st.zIndex=this.__entity.style.zIndex;$IE6&&this.__ie6FixedController.updateIframe(this.__isFixed)}},__updateIE6FCOrgPosition:function(){this.__ie6FixedController&&this.__ie6FixedController.updateOrgPosition()},__updateTemplate:function(nd){var l,t,z,p,d,et=this.__entity;if(et){et.parentNode&&et.parentNode.removeChild(et);l=et.style.left;t=et.style.top;z=et.style.zIndex;p=et.style.position;d=et.style.display}else{d="none"}et=this.__entity=$E("_"+this.uniqueID+"_panel");if(!et){et=this.__entity=$E("_"+this.uniqueID+"_entity")}if(!et){throw new Error("[Panel Error]there missing identifier #{panel} in panel template")}et.style.left=l||0;et.style.top=t||0;et.style.zIndex=z||0;et.style.position=p||"absolute";et.style.display=d;this.__parent.replaceChild(et,nd);this.__ie6FixedController&&(this.__ie6FixedController.node=this.__entity)},__getNodes:function(template,mode){var m=mode||"o",p=/\{[^\}]+(?=\})/g,i,nodes={},rets,r;this.__templateNodesIDs=template.match(p);rets=this.__templateNodesIDs;if(rets){i=rets.length;while(i--){r=rets[i].replace("{","");switch(m){case"o":nodes[r]=$E("_"+this.uniqueID+"_"+r);break;case"i":nodes[r]="_"+this.uniqueID+"_"+r;break}}}return nodes},__getUniqueID:function(){return parseInt(Math.random()*1e3).toString()+(new Date).getTime().toString()},setContent:function(str){this.nodes.content&&(this.nodes.content.innerHTML=str)},getNodes:function(){return this.nodes}});Ui.Drag=function(captureNode,attachNodes,isDragCapureNode){var me=this;this.canDrag=true;this.isLock=false;this.lockArea={left:0,right:0,top:0,bottom:0};this.__captureNode=captureNode;this.__dragNodes=[];this.__deltaX=[];this.__deltaY=[];this.__eventDispatcher=new Core.Events.EventDispatcher(this);this.__isDraging=false;this.__canDragX=true;this.__canDragY=true;this.__dragHandle=function(){me.__drag()};this.__mouseDownHandle=function(){me.__isDraging=true;me.__eventDispatcher.dispatchEvent("beforeDrag");me.__setCapture(true)};this.__mouseUpHandle=function(){me.__isDraging&&me.__eventDispatcher.dispatchEvent("afterDrag");me.__isDraging=false;me.__setCapture(false)};this.__initNodes(captureNode,attachNodes,isDragCapureNode);this.__initCaputerNode()}.$define({addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},destroy:function(){Core.Events.removeEvent(this.__captureNode,this.__mouseDownHandle,"mousedown");Core.Events.removeEvent(document,this.__mouseUpHandle,"mouseup");this.__captureNode=null;this.__dragNodes=null},__initNodes:function(captureNode,attachNodes,isDragCapureNode){if(attachNodes){attachNodes instanceof Array?this.__dragNodes=attachNodes:this.__dragNodes.push(attachNodes);(typeof isDragCapureNode==="undefined"||isDragCapureNode)&&this.__dragNodes.push(this.__captureNode)}else{this.__dragNodes.push(this.__captureNode)}var dns=this.__dragNodes,i=dns.length;while(i--){!dns[i].style.position&&(dns[i].style.position="absolute");!dns[i].style.left&&(dns[i].style.left=0);!dns[i].style.top&&(dns[i].style.top=0)}},__initCaputerNode:function(){var cn=this.__captureNode,me=this;Core.Events.addEvent(cn,this.__mouseDownHandle,"mousedown");Core.Events.addEvent(document,this.__mouseUpHandle,"mouseup")},__setCapture:function(isCapture){var cn=this.__captureNode,dns=this.__dragNodes,evt=Core.Events.getEvent(),i=dns.length;while(i--){this.__deltaX[i]=evt.clientX-parseInt(dns[i].style.left);this.__deltaY[i]=evt.clientY-parseInt(dns[i].style.top)}if(isCapture){if($IE){cn.setCapture();Core.Events.addEvent(cn,this.__dragHandle,"mousemove")}else{Core.Events.addEvent(document,this.__dragHandle,"mousemove")}}else{if($IE){cn.releaseCapture();Core.Events.removeEvent(cn,this.__dragHandle,"mousemove")}else{Core.Events.removeEvent(document,this.__dragHandle,"mousemove")}}},__drag:function(){if(!this.canDrag){return}var dns=this.__dragNodes,evt=Core.Events.getEvent(),i=dns.length,la=this.lockArea,dX=0,dY=0;this.__eventDispatcher.dispatchEvent("drag");while(i--){dX=evt.clientX-this.__deltaX[i];dY=evt.clientY-this.__deltaY[i];if(this.isLock){dX=Math.min(Math.max(dX,la.left),la.right);dY=Math.min(Math.max(dY,la.top),la.bottom)}dns[i].style.left=dX+"px";dns[i].style.top=dY+"px"}}});Ui.IDragger={addEventListener:function(type,handle){},removeEventListener:function(type,handle){},setDrag:function(node,attachNodes,isDragCapureNode){},setLock:function(state){},setArea:function(area){},destroy:function(){}};Ui.SimpleDragger=function(){this.__drag=null;this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$implements(Ui.IDragger).$define({addEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.addEventListener(type,handle)}else{this.__drag.addEventListener(type,handle)}return this},removeEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.removeEventListener(type,handle)}else{this.__drag.removeEventListener(type,handle)}return this},setDrag:function(node,attachNode,isDragCapureNode){var me=this;this.__drag=new Ui.Drag(node,attachNode,isDragCapureNode);this.__drag.addEventListener("afterDrag",function(){me.__eventDispatcher.dispatchEvent("afterDrag")});return this},setLock:function(state){this.__drag.isLock=!!state;return this},setArea:function(area){this.__drag.lockArea=area;return this},destroy:function(){this.__drag.destroy()}});Ui.Dialog=function(parent,node){var me=this;this.__dragger=null;this.__isBindUpadateAreaEvent=false;this.__isBindUpdateIE6AreaEvent=false;this.__beforeDragHandle=function(){me.__updateDraggerArea();me.__eventDispatcher.dispatchEvent("beforedrag")};this.__dragHandle=function(){me.__isSetAdamant&&me.__updateIframe();me.__eventDispatcher.dispatchEvent("drag")};this.__afterDragHandle=function(){me.__isFixed&&$IE6&&me.__updateIE6FCOrgPosition();me.__eventDispatcher.dispatchEvent("afterdrag")};this.__updateDraggerAreaHandle=function(){setTimeout(function(){me.__updateDraggerArea()},1)};this.__setMiddleHandle=function(){me.setMiddle()}}.$extends(Ui.Panel).$define({setTemplate:function(tpl){Ui.Dialog.$super.setTemplate.call(this,tpl);this.__initTitleBar();this.setDragger(Ui.SimpleDragger);return this},setContent:function(content){if(!this.nodes.content){return this}this.nodes.content.innerHTML=new Ui.Template(content).evaluate(this.__getNodes(content,"i"));this.__addContentNodes(this.__getNodes(content));return this},setFixed:function(state){Ui.Dialog.$super.setFixed.call(this,state);if(state){Core.Events.addEvent(window,this.__setMiddleHandle,"resize")}else{Core.Events.removeEvent(window,this.__setMiddleHandle,"resize")}this.__updateDraggerArea();return this},setMiddle:function(){var areaHeight=this.__getDocumentSize().height-this.height,goldenSection=(Math.sqrt(5)-1)/2,totalSection=1,goldenSectionY=areaHeight*goldenSection/(goldenSection+totalSection),middleX=this.__getDocumentSize().width/2-this.width/2;if(!this.__isFixed){goldenSectionY+=Math.max(document.documentElement.scrollTop,document.body.scrollTop);middleX+=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft)}this.setPosition({x:Math.max(middleX,0),y:Math.max(goldenSectionY,0)});return this},setAreaLocked:function(state){if(!this.__dragger){return this}this.__dragger.setLock(state);return this},setSize:function(p){!this.__isInited&&this.__initEntity();if(this.nodes.content){typeof p.width!=="undefined"&&(this.nodes.content.style.width=p.width+"px");typeof p.height!=="undefined"&&(this.nodes.content.style.height=p.height+"px")}else{typeof p.width!=="undefined"&&(this.__entity.style.width=p.width+"px");typeof p.height!=="undefined"&&(this.__entity.style.height=p.height+"px")}return this},setDragger:function(draggerConstructor){if(!this.nodes.titleBar||!draggerConstructor){return this}if(!this.__dragger){this.__dragger=new draggerConstructor}else if(this.__dragger.constructor===draggerConstructor){return this}this.__updateDragger(draggerConstructor);return this},destroy:function(){if(!this.__entity){return}Ui.Dialog.$super.destroy.call(this);Core.Events.removeEvent(window,this.__updateDraggerAreaHandle,"resize");Core.Events.removeEvent(window,this.__setMiddleHandle,"resize")},__addContentNodes:function(nodes){var nds=this.nodes,k;for(k in nodes){nds[k]=nodes[k]}},__updateDragger:function(draggerConstructor){if(this.__dragger.constructor!==draggerConstructor){this.__dragger.removeEventListener("beforedrag",this.__beforeDragHandle).removeEventListener("drag",this.__dragHandle).removeEventListener("afterdrag",this.__afterDragHandle);this.__dragger.destroy();this.__dragger=new draggerConstructor}this.__dragger.setDrag(this.nodes.titleBar,this.__entity,false);this.__dragger.addEventListener("beforedrag",this.__beforeDragHandle).addEventListener("drag",this.__dragHandle).addEventListener("afterdrag",this.__afterDragHandle)},__updateDraggerArea:function(){var l,t,r,b;if(this.__isFixed){l=$IE6?document.documentElement.scrollLeft:0;t=$IE6?document.documentElement.scrollTop:0;r=$IE6?document.documentElement.scrollLeft+this.__getDocumentSize().width-this.width:this.__getDocumentSize().width-this.width;b=$IE6?document.documentElement.scrollTop+this.__getDocumentSize().height-this.height:this.__getDocumentSize().height-this.height}else{l=0;t=0;r=document.documentElement.scrollWidth-this.width;b=document.documentElement.scrollHeight-this.height}this.__dragger.setArea({left:l,top:t,right:r,bottom:b})},__initTitleBar:function(){if(!this.nodes.titleBar){return}var tb=this.nodes.titleBar;tb.style.cursor="move";if($IE){Core.Events.addEvent(tb,function(){return false},"selectstart")}else{tb.style.MozUserSelect="none"}},__getDocumentSize:function(){var w=document.documentElement.clientWidth||document.body.clientWidth,h=document.documentElement.clientHeight||document.body.clientHeight;return{width:w,height:h}}});Ui.ModuleDialog=function(tplConfig,iconSet,cfg){this.__bgShadow=null;this.__dialog=null;this.__isInitBgShadow=false;this.__tplConfig=tplConfig;this.__iconSet=iconSet;this.__dialogQueue=[];this.__zIndex=cfg&&cfg.zIndex||5e3;this.__cfg=cfg||{};this.__initDialogEvent()}.$define({alert:function(text,cfg){cfg=cfg||{};var dlg=this.__createMessageDialog(cfg.tplConfig||this.__tplConfig.alert,cfg);dlg.nodes.text&&(dlg.nodes.text.innerHTML=text||"");dlg.show(cfg.renderer||this.__cfg.renderer).addEventListener("hidden",function(){this.destroy()});dlg.nodes.linkOk&&dlg.nodes.linkOk.style.display!=="none"&&dlg.nodes.linkOk.focus();return dlg},newAlert:function(text,cfg,name){cfg.tplConfig=this.__tplConfig.newAlert;this.alert(text,cfg,name)},confirm:function(text,cfg){cfg=cfg||{};var dlg=this.__createMessageDialog(cfg.tplConfig||this.__tplConfig.confirm,cfg),me=this;dlg.nodes.text&&(dlg.nodes.text.innerHTML=text||"");if(dlg.nodes.btnCancel){dlg.nodes.btnCancel.innerHTML=cfg.textCancel||"取消";Core.Events.addEvent(dlg.nodes.btnCancel,function(){cfg.funcCancel&&cfg.funcCancel.call(dlg);dlg.hidden(cfg.renderer||me.__cfg.renderer);Core.Events.stopEvent()},"click");dlg.nodes.linkCancel&&Core.Events.addEvent(dlg.nodes.linkCancel,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){cfg.funcCancel&&cfg.funcCancel.call(dlg);dlg.hidden(cfg.renderer||me.__cfg.renderer)}},"keydown")}dlg.show(cfg.renderer||me.__cfg.renderer).addEventListener("hidden",function(){this.destroy()});if(cfg.defaultButton==0){dlg.nodes.linkCancel&&dlg.nodes.linkCancel.style.display!=="none"&&dlg.nodes.linkCancel.focus()}else{dlg.nodes.linkOk&&dlg.nodes.linkOk.style.display!=="none"&&dlg.nodes.linkOk.focus()}return dlg},newConfirm:function(text,cfg,name){cfg.tplConfig=this.__tplConfig.newConfirm;this.confirm(text,cfg,name)},create:function(cfg){var me=this;cfg=cfg||{};var dlg=new Ui.Dialog;dlg.setTemplate(cfg.tpl||this.__tplConfig.customs);cfg.content&&dlg.setContent(cfg.content);cfg.width&&!isNaN(cfg.width)&&dlg.setSize({width:cfg.width});cfg.height&&!isNaN(cfg.height)&&dlg.setSize({height:cfg.height});return this.__initDialog(dlg,cfg)},__initDialogEvent:function(){var queue=this.__dialogQueue;Core.Events.addEvent(document,function(){var e=Core.Events.getEvent();if(queue.length&&e.keyCode=="27"){queue[queue.length-1].hidden()}},"keydown")},__createMessageDialog:function(tpl,cfg){var dlg=new Ui.Dialog,me=this,i;dlg.setTemplate(tpl);cfg.width&&!isNaN(cfg.width)&&dlg.setSize({width:cfg.width});cfg.height&&!isNaN(cfg.height)&&dlg.setSize({height:cfg.height});dlg.nodes.subText&&(dlg.nodes.subText.innerHTML=cfg.subText||"");if(dlg.nodes.icon){dlg.nodes.icon.className=this.__iconSet[cfg.icon||"01"]["class"];dlg.nodes.icon.alt=this.__iconSet[cfg.icon||"01"]["alt"]}if(dlg.nodes.btnOk){dlg.nodes.btnOk.innerHTML=cfg.textOk||"确定";Core.Events.addEvent(dlg.nodes.btnOk,function(){dlg.hidden(cfg.renderer||me.__cfg.renderer);cfg.funcOk&&cfg.funcOk.call(dlg);Core.Events.stopEvent()},"click")}dlg.nodes.linkOk&&Core.Events.addEvent(dlg.nodes.linkOk,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){dlg.hidden(cfg.renderer||me.__cfg.renderer);cfg.funcOk&&cfg.funcOk.call(dlg)}},"keydown");dlg.setDragger(cfg.dragger||me.__cfg.dragger).setFixed(true).setAreaLocked(true);return this.__initDialog(dlg,cfg)},__initDialog:function(dlg,cfg){var me=this;cfg.zIndex&&(me.__zIndex=cfg.zIndex);dlg.nodes.titleName&&(dlg.nodes.titleName.innerHTML=cfg.title||"提示");if(dlg.nodes.btnClose){Core.Events.addEvent(dlg.nodes.btnClose,function(){var isCanHidden=true;cfg.funcBeforeClose&&(isCanHidden=cfg.funcBeforeClose.call(dlg)!==false);cfg.funcClose&&cfg.funcClose.call(dlg);isCanHidden&&dlg.hidden()},"click");Core.Events.addEvent(dlg.nodes.btnClose,function(){Core.Events.stopEvent()},"mousedown")}dlg.setPosition({z:cfg.zIndex||me.__zIndex});dlg.setRenderer(cfg.renderer||this.__cfg.renderer);dlg.setDragger(cfg.dragger||this.__cfg.dragger);dlg.setMiddle();dlg.addEventListener("beforeHidden",function(){me.__updateDialogQueue(this,"remove")});dlg.addEventListener("beforeShow",function(){this.nodes.panel.parentNode.appendChild(this.nodes.panel);var that=this;if(!me.__isInitBgShadow){me.__initBGShadow(this,cfg.isAdamant||me.__cfg.isAdamant)}me.__setBGShadowOpacity(cfg.bgShadowOpacity!==0?cfg.bgShadowOpacity||.4:cfg.bgShadowOpacity);window.setTimeout(function(){me.__bgShadow.show();me.__updateDialogQueue(that,"add")},1)});dlg.setTitle=function(title){this.nodes.titleName&&(this.nodes.titleName.innerHTML=title)};dlg.setHelp=function(url){this.nodes.btnHelp&&(this.nodes.btnHelp.href=url)};dlg.close=function(){this.hidden()};dlg.getNodes=function(){return this.nodes};dlg.getX=function(){return this.x};dlg.getY=function(){return this.y};dlg.getWidth=function(){return this.width};dlg.getHeight=function(){return this.height};return dlg},__initBGShadow:function(dlg,isAdamant){var w=this.__getDocumentSize().width,h=this.__getDocumentSize().height,me=this;this.__bgShadow=new Ui.Panel;this.__bgShadow.setTemplate('<div id="#{panel}" style="background-color:black"></div>').setSize({width:w,height:h}).setAdamant(isAdamant).setFixed(true).setPosition({x:0,y:0,z:me.__zIndex});Core.Events.addEvent(window,function(){me.__bgShadow.setPosition({x:0,y:0}).setSize({width:me.__getDocumentSize().width,height:me.__getDocumentSize().height})},"resize");this.__isInitBgShadow=true},__updateDialogQueue:function(dialog,op){var i,dlg;if(op==="add"){this.__dialogQueue.push(dialog)}else if(op==="remove"){i=this.__dialogQueue.length;while(i--){this.__dialogQueue[i]===dialog&&this.__dialogQueue.splice(i,1)}}if(this.__dialogQueue.length===0){this.__bgShadow.hidden()}else{dlg=this.__dialogQueue[this.__dialogQueue.length-1];this.__bgShadow.nodes.panel.parentNode.insertBefore(this.__bgShadow.nodes.panel,dlg.nodes.panel);this.__bgShadow.__iframe&&this.__bgShadow.__iframe.parentNode.insertBefore(this.__bgShadow.__iframe,this.__bgShadow.nodes.panel);dlg.nodes.linkOk&&dlg.nodes.linkOk.style.display!=="none"&&dlg.nodes.linkOk.focus()}},__setBGShadowOpacity:function(v){v=isNaN(v)?0:Math.max(Math.min(v,1),0);Core.Dom.setStyle(this.__bgShadow.nodes.panel,"opacity",v)},__getDocumentSize:function(){var w=document.documentElement.clientWidth||document.body.clientWidth,h=document.documentElement.clientHeight||document.body.clientHeight;return{width:w,height:h}}});Ui.Transition={simple:function(t,b,c,d){return c*t/d+b},backEaseIn:function(t,b,c,d){var s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b},backEaseOut:function(t,b,c,d){var s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},backEaseInOut:function(t,b,c,d){var s=1.70158;if((t/=d/2)<1){return c/2*(t*t*(((s*=1.525)+1)*t-s))+b}return c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b},bounceEaseOut:function(t,b,c,d){if((t/=d)<1/2.75){return c*(7.5625*t*t)+b}else if(t<2/2.75){return c*(7.5625*(t-=1.5/2.75)*t+.75)+b}else if(t<2.5/2.75){return c*(7.5625*(t-=2.25/2.75)*t+.9375)+b}else{return c*(7.5625*(t-=2.625/2.75)*t+.984375)+b}},bounceEaseIn:function(t,b,c,d){return c-Transition.bounceEaseOut(d-t,0,c,d)+b},bounceEaseInOut:function(t,b,c,d){if(t<d/2){return Transition.bounceEaseIn(t*2,0,c,d)*.5+b}else{return Transition.bounceEaseOut(t*2-d,0,c,d)*.5+c*.5+b}},regularEaseIn:function(t,b,c,d){return c*(t/=d)*t+b},regularEaseOut:function(t,b,c,d){return-c*(t/=d)*(t-2)+b},regularEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b}return-c/2*(--t*(t-2)-1)+b},strongEaseIn:function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},strongEaseOut:function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},strongEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t*t+b}return c/2*((t-=2)*t*t*t*t+2)+b},elasticEaseIn:function(t,b,c,d){var a,p;if(t==0){return b}if((t/=d)==1){return b+c}p=d*.3;if(!a||a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b},elasticEaseOut:function(t,b,c,d){var a,p;if(t==0){return b}if((t/=d)==1){return b+c}if(!p){p=d*.3}if(!a||a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b},elasticEaseInOut:function(t,b,c,d){var a,p;if(t==0){return b}if((t/=d/2)==2){return b+c}if(!p){var p=d*(.3*1.5)}if(!a||a<Math.abs(c)){var a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}if(t<1){return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b}return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b}};Ui.TweenStrategy=function(startValue,endValue,duration,motion){this.startValue=startValue||0;this.endValue=endValue||0;this.duration=duration||0;this.motion=motion||Ui.Transition.simple;this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$define({motion:null,duration:0,startValue:0,endValue:0,_itvID:0,_isTweenning:false,addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},start:function(){if(this._isTweenning){return}this._isTweenning=true;var me=this,t,sv=this.startValue,ev=this.endValue,d=this.duration,value,startTime=(new Date).getTime();this._itvID=window.setInterval(function(){t=((new Date).getTime()-startTime)/1e3;t>me.duration&&(t=me.duration);value=me.motion(t,sv,ev-sv,d);me.onTween&&me.onTween(value);me.__eventDispatcher.dispatchEvent("tween",value);t==me.duration&&me.stop()},25);return this},stop:function(){window.clearInterval(this._itvID);this._isTweenning=false;this.onEnd&&this.onEnd();this.__eventDispatcher.dispatchEvent("end");return this},onTween:function(value){},onEnd:function(){}});Ui.OpacityRenderer=function(){this.__canShow=true;this.__canHidden=true;this.__node=null;this.__tween=new Ui.TweenStrategy(0,0,.6,Ui.Transition.strongEaseOut);this.__state="";this.__lastState="";this.__value=0;this.__node=null;this.__eventDispatcher=new Core.Events.EventDispatcher(this);this.__initTweenEvent()}.$implements(Ui.IRenderer).$define({setCanShow:function(state){this.__canShow=!!state},setCanHidden:function(state){this.__canHidden=!!state},show:function(node){var tn=this.__tween;tn.stop();Core.Dom.setStyle(node,"opacity",this.__value);node.style.display="";this.__node=node;this.__state="show";this.__eventDispatcher.dispatchEvent("beforeShow");if(this.__canShow){tn.startValue=this.__value;tn.endValue=1;tn.start()}return this},hidden:function(node){var tn=this.__tween;tn.stop();this.__node=node;this.__state="hidden";this.__eventDispatcher.dispatchEvent("beforeHidden");if(this.__canHidden){tn.startValue=this.__value;tn.endValue=0;tn.start()}return this},addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},__initTweenEvent:function(){var me=this;this.__tween.addEventListener("tween",function(v){me.__value=v;Core.Dom.setStyle(me.__node,"opacity",v)});this.__tween.addEventListener("end",function(){me.__node&&me.__node.style.filter&&(me.__node.style.filter="");if(me.__state!==""&&me.__state!==me.__lastState){me.__lastState=me.__state;me.__eventDispatcher.dispatchEvent(me.__state)}me.__state==="hidden"&&(me.__node.style.display="none")})}});Ui.BorderDragger=function(){this.__drag=null;this.__isBindEvent=false;this.__border=null;this.__dragNode=null;this.__isCreated=false;this.__tweenX=new Ui.TweenStrategy(0,0,.5,Ui.Transition.strongEaseOut);this.__tweenY=new Ui.TweenStrategy(0,0,.5,Ui.Transition.strongEaseOut);this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$implements(Ui.IDragger).$define({addEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.addEventListener(type,handle)}else{this.__drag.addEventListener(type,handle)}return this},removeEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.removeEventListener(type,handle)}else{this.__drag.removeEventListener(type,handle)}return this},setDrag:function(node,attachNode,isDragCapureNode){if(!this.__isCreated){this.__createBorder(attachNode);this.__initTweenEvent(attachNode)}this.__drag=new Ui.Drag(node,this.__border,isDragCapureNode);this.__dragNode=attachNode;this.__initDragEvent();return this},setLock:function(state){this.__drag.isLock=!!state;return this},setArea:function(area){this.__drag.lockArea=area;return this},destroy:function(){this.__drag.destroy()},__createBorder:function(node){this.__border=$C("div");var st=this.__border.style;st.border="2px dashed #BCC4D0";st.position="absolute";st.display="none";st.backgroundColor="transparent";st.MozUserSelect="none";document.body.appendChild(this.__border);this.__isCreated=true},__initDragEvent:function(){if(this.__isBindEvent){return}var me=this,bst=this.__border.style,nst=this.__dragNode.style,twX=this.__tweenX,twY=this.__tweenY;this.__drag.addEventListener("beforeDrag",function(){bst.zIndex=nst.zIndex+1;bst.position=nst.position;bst.width=me.__dragNode.offsetWidth-4+"px";bst.height=me.__dragNode.offsetHeight-4+"px";bst.left=parseInt(nst.left)+"px";bst.top=parseInt(nst.top)+"px";bst.display=""});this.__drag.addEventListener("afterDrag",function(){if($IE6){nst.left=parseInt(bst.left)+"px";nst.top=parseInt(bst.top)+"px";bst.display="none";me.__eventDispatcher.dispatchEvent("afterDrag")}else{twX.startValue=parseInt(nst.left);twX.endValue=parseInt(bst.left);twY.startValue=parseInt(nst.top);twY.endValue=parseInt(bst.top);twX.start();twY.start()}});this.__isBindEvent=true},__initTweenEvent:function(node){var nst=node.style,bst=this.__border.style,me=this;this.__tweenX.addEventListener("tween",function(v){nst.left=v+"px"});this.__tweenY.addEventListener("tween",function(v){nst.top=v+"px"});this.__tweenX.addEventListener("end",function(){bst.display="none";me.__eventDispatcher.dispatchEvent("afterDrag")})}});var winDialog={};var DialogTemplate={};(function(){var dialogTemplates={alert:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示标题</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}" class="CP_layercon1">','<div class="CP_prompt">','<img id="#{icon}" class="SG_icon SG_icon201" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="50" height="50" align="absmiddle"/>','<table class="CP_w_ttl"><tr><td id="#{text}"></td></tr></table>','<div id="#{subText}" class="CP_w_cnt SG_txtb"></div>','<p class="CP_w_btns_Mid"><a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnOk}"> </cite></a></p>',"</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),newAlert:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div class="CP_layercon2 pop_v">','<div class="v_prompt">','<img id="#{icon}" class="SG_icon SG_icon148" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="20" height="20" align="absmiddle" />','<div id="#{text}" class="v_cnt SG_txtb"></div>','<div id="#{subText}"></div>','<p class="v_btns">','<a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#"><cite id="#{btnOk}">确定</cite></a>',"</p>","</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),confirm:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示标题</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}" class="CP_layercon1">','<div class="CP_prompt">','<img id="#{icon}" class="SG_icon SG_icon201" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="50" height="50" align="absmiddle"/>','<table class="CP_w_ttl"><tr><td id="#{text}"></td></tr></table>','<div id="#{subText}" class="CP_w_cnt SG_txtb"></div>','<p class="CP_w_btns">','<a  id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnOk}"></cite></a>','<a style="margin-left:5px;" id="#{linkCancel}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnCancel}"> <span id="#{cancel}"></span> </cite></a></p>',"</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),newConfirm:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div class="CP_layercon2 pop_v">','<div class="v_prompt">','<img id="#{icon}" class="SG_icon SG_icon148" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="20" height="20" align="absmiddle" />','<div id="#{text}" class="v_cnt SG_txtb"></div>','<div id="#{subText}"></div>','<p class="v_btns">','<a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#"><cite id="#{btnOk}">确定</cite></a>&nbsp;&nbsp;','<a id="#{linkCancel}" class="SG_aBtn SG_aBtnB SG_aBtn_g" href="#"><cite id="#{btnCancel}">取消</cite></a>',"</p>","</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),
customs:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}">提示标题</strong>','<cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">',"</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join("")};var iconSet={"01":{"class":"SG_icon SG_icon201",alt:"警告"},"02":{"class":"SG_icon SG_icon202",alt:"失败"},"03":{"class":"SG_icon SG_icon203",alt:"成功"},"04":{"class":"SG_icon SG_icon204",alt:"询问"},"05":{"class":"SG_icon SG_bigLoading",alt:"正在加载"},"06":{"class":"SG_icon SG_icon148",alt:"警告"}};var dialogs={};var moduleDialog=new Ui.ModuleDialog(dialogTemplates,iconSet,{renderer:Ui.OpacityRenderer,dragger:Ui.BorderDragger,isAdamant:$IE6});winDialog.create=winDialog.createCustomsDialog=function(args,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.create(args);return dialogs[name]}else{return moduleDialog.create(args)}};winDialog.alert=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.alert(text,cfg);return dialogs[name]}else{return moduleDialog.alert(text,cfg)}};winDialog.newAlert=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.newAlert(text,cfg);return dialogs[name]}else{return moduleDialog.newAlert(text,cfg)}};winDialog.confirm=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.confirm(text,cfg);return dialogs[name]}else{return moduleDialog.confirm(text,cfg)}};winDialog.newConfirm=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.newConfirm(text,cfg);return dialogs[name]}else{return moduleDialog.newConfirm(text,cfg)}};winDialog.getDialog=function(name){if(name&&typeof name==="string"){return dialogs[name]}};DialogTemplate=dialogTemplates})();Sina.pkg("Core.Class");Core.Class.AsPrototype={};Core.Class.create=function(){return function(t){if(t!=Core.Class.AsPrototype){this.initialize.apply(this,arguments)}}};Sina.pkg("Core.Math");Core.Math.getUniqueId=function(_start,_end){return parseInt(Math.random()*1e4).toString()+(new Date).getTime().toString()};Lib.IframeDialog=Core.Class.create();Lib.IframeDialog.prototype={dialog:null,initialize:function(option){this.id=Core.Math.getUniqueId();this.option=option},initDialog:function(){var _this=this,this_option=this.option;var obj={ad:false,drag:true,tpl:this_option.tpl||_this.tpl,title:this_option.title,content:'<iframe frameborder="0" id="ifrDialog_'+_this.id+'" scrolling="no"></iframe>',renderer:Ui.SimpleRenderer,width:this_option.width,height:this_option.height};this.dialog=winDialog.createCustomsDialog(obj);this.dialog.setAreaLocked(true);var iframe=$E("ifrDialog_"+this.id);iframe.src=this_option.url;iframe.style.width=this_option.width+"px";iframe.style.height=this_option.height+"px";this_option.funcClose&&this.bindColseFunc()},tpl:'<table id="#{entity}" class="CP_w">'+'<thead id="#{titleBar}">'+"<tr>"+'<th class="tLeft"><span></span></th>'+'<th class="tMid">'+'<div class="bLyTop">'+'<strong id="#{titleName}">提示</strong>'+'<cite><a id="#{btnClose}" href="javascript:;" class="CP_w_shut" title="关闭">关闭</a></cite>'+"</div>"+"</th>"+'<th class="tRight"><span></span></th>'+"</tr>"+"</thead>"+"<tfoot>"+"<tr>"+'<td class="tLeft"><span></span></td>'+'<td class="tMid"><span></span></td>'+'<td class="tRight"><span></span></td>'+"</tr>"+"</tfoot>"+"<tbody>"+"<tr>"+'<td class="tLeft"><span></span></td>'+'<td class="tMid" id="#{content}">'+"</td>"+'<td class="tRight"><span></span></td>'+"</tr>"+"</tbody>"+"</table>",reset:function(){if(this.dialog){this.hidden();var dialogParentNode=this.dialog.nodes.panel||this.dialog.nodes.entity;dialogParentNode.parentNode.removeChild(dialogParentNode);this.dialog=null}},bindColseFunc:function(){Core.Events.addEvent(this.dialog.nodes.btnClose,this.option.funcClose)},setSize:function(nWidth,nHeight){var ele=this.dialog.nodes.content.firstChild;this.dialog.setSize(nWidth,nHeight);ele.style.width=nWidth+"px";ele.style.height=nHeight+"px"},show:function(){this.reset();this.initDialog();this.dialog.show();this.dialog.setMiddle()},close:function(){this.dialog.hidden()}};Core.Events.fireEvent=function(oElement,sEvent){var evt;oElement=$E(oElement);if(oElement.fireEvent){oElement.fireEvent("on"+sEvent)}else{if($MOBILE){evt=document.createEvent("HTMLEvents")}else{evt=document.createEvent("MouseEvents")}evt.initEvent(sEvent,true,true);oElement.dispatchEvent(evt)}};Lib.AccountChecker=Core.Class.create();Lib.AccountChecker.prototype={initialize:function(ssoUrl){if(ssoUrl.indexOf("vt=1")>0||ssoUrl.indexOf("vt=2")>0){this.showDialog(ssoUrl)}else{window.location.href=ssoUrl}},showDialog:function(ssoUrl){document.domain="sina.com.cn";if(!window.accDialog){window.accDialog=new Lib.IframeDialog({url:ssoUrl,title:"账号安全",width:300,height:165});scope.accCallback=function(){window.accDialog.close()}}window.accDialog.show();var nodes=window.accDialog.dialog.nodes;var content=nodes.content;content.firstChild.style.marginLeft="25px";nodes.btnClose.style.display="none";var p=document.createElement("p");p.style.lineHeight="70px";p.innerHTML="　　为了您的账号安全，请输入验证码后再进行操作";content.insertBefore(p,content.firstChild)},hideDialog:function(){window.accDialog&&window.accDialog.hidden()}};$registJob("checkAccount",function(){var url=scope.$ssoUseUrl;if(url&&url!=="0"){new Lib.AccountChecker(url)}});Utils.Cookie.setCookie=function(name,value,expire,path,domain,secure){var cstr=[];cstr.push(name+"="+escape(value));if(expire){var dd=new Date;var expires=dd.getTime()+expire*36e5;dd.setTime(expires);cstr.push("expires="+dd.toGMTString())}if(path){cstr.push("path="+path)}if(domain){cstr.push("domain="+domain)}if(secure){cstr.push(secure)}document.cookie=cstr.join(";")};Core.Dom.addHTML=function(oParentNode,sHTML){oParentNode.insertAdjacentHTML("beforeend",sHTML)};if(!$C("div").insertAdjacentHTML){Core.Dom.addHTML=function(oParentNode,sHTML){var oRange=oParentNode.ownerDocument.createRange();oRange.setStartBefore(oParentNode);var oFrag=oRange.createContextualFragment(sHTML);oParentNode.appendChild(oFrag)}}Utils.UserData=Core.Class.create();Utils.UserData.prototype={initialize:function(id){if(!$IE)return;trace("UserData");this.id=id||"sina_user_data";Core.Dom.addHTML(document.body,'<img style="width: 1px; display: none;" id="'+this.id+'" />');this.setDefaultProperty()},setDefaultProperty:function(){if(!$IE)return;$E(this.id).addBehavior("#default#userData")},save:function(key,data){if(!$IE)return;try{if(this[key]==false)return;if(data.length>2e4)return;var ud_ele=$E(this.id);for(var name in data){ud_ele.setAttribute(name,data[name])}ud_ele.save(key)}catch(e){traceError(e)}},load:function(key,attributes){if(!$IE)return{};try{var ud_ele=$E(this.id);var data={};$E(this.id).load(key);var len=attributes.length;for(var i=0;i<len;i++){data[attributes[i]]=ud_ele.getAttribute(attributes[i]||"")}this[key]=true;return data;trace("暂存的内容长度: "+editorStr.length);trace("暂存内容的UID: "+editorUID)}catch(e){traceError(e)}},clear:function(key,attributes){if(!$IE)return;try{trace("userData.clear");this[key]=false;var ud_ele=$E(this.id);var len=attributes.length;for(var i=0;i<len;i++){ud_ele.setAttribute(attributes[i],"")}ud_ele.save(key)}catch(e){traceError(e)}}};Core.Events.stopBubble=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.cancelBubble=true}};if(!$IE||$IE>8){Core.Events.stopBubble=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.stopPropagation()}}}Core.Events.stopDefaultEvent=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){if(ev.preventDefault){ev.preventDefault()}else{ev.returnValue=false}}};Utils.excBeforeCloseWin=function(tips1,tips2,func,args){closeVar={};closeVar.func=func;closeVar.tips1=tips1;closeVar.tips2=tips2;closeVar.args=args;closeVar.length=arguments.length;window.beforeunloadfunc=function(){if(closeVar.length==1){return closeVar.tips1;Core.Events.stopEvent()}else{if($IE){var e=Core.Events.fixEvent(Core.Events.getEvent());if(e.clientY<0||e.altKey){if(confirm(closeVar.tips2)){if(closeVar.args)Core.Function.bind3(closeVar.func,closeVar.func,[closeVar.args])();else closeVar.func()}else{}}}else{function func(value){if(value==true){if(closeVar.args)Core.Function.bind3(closeVar.func,closeVar.func,[closeVar.args])();else closeVar.func()}else{}}return func.call(this,confirm(closeVar.tips2))}}};Core.Events.addEvent(window,beforeunloadfunc,"beforeunload")};Core.Class.extend=function(destination,supClass,bForce){for(var property in supClass){if(bForce!=null){if(!destination[property]){destination[property]=supClass[property]}}else{destination[property]=supClass[property]}}return destination};Core.Events.fixEvent=function(e){if(typeof e=="undefined")e=window.event;if(!e.target){e.target=e.srcElement;e.pageX=e.x;e.pageY=e.y}if(typeof e.layerX=="undefined")e.layerX=e.offsetX;if(typeof e.layerY=="undefined")e.layerY=e.offsetY;return e};Core.Events.getEventTarget=function(ev){ev=ev||Core.Events.getEvent();Core.Events.fixEvent(ev);return ev.target};var Editor={};Editor.AbstractBase=Core.Class.create();Editor.AbstractBase.prototype={_id:null,_focusElementId:"",_iframeUrl:"",iframe:null,iframeWindow:null,iframeDocument:null,rangeCache:null,initialize:function(){throw new Error("Editor.AbstractBase为抽象类不能被实例化")},blur:function(){$E(this._focusElementId).focus()},execCommand:function(cmd,value){this.iframeWindow.focus();this.iframeDocument.execCommand(cmd,"",value);this.iframeWindow.focus()},getContentHtml:function(){return this.iframeDocument.body.innerHTML},getContentText:function(){if($IE){return this.iframeDocument.body.innerText}else{return this.iframeDocument.body.textContent}},selectRange:function(){this.rangeCache.select()},getFocusElement:function(){if(!$IE){var select=this.iframeWindow.getSelection();var range=select.getRangeAt(0);var elm=range.commonAncestorContainer;if(elm.tagName){if(elm.tagName.toLowerCase()=="body"){return elm}}if(!range.collapsed){if(range.startContainer==range.endContainer||1&&range.startContainer==range.endContainer.parentNode){if(range.startOffset-range.endOffset<2||1){if(range.startContainer.hasChildNodes()){return range.startContainer.childNodes[range.startOffset]}}}return elm.parentNode}else{return elm.parentNode}}else{var range=this.iframeDocument.selection.createRange();return range.item?range.item(0):range.parentElement()}},getRangTxt:function(select){if($IE){if(select){this.selectRange()}var rang=this.iframeDocument.selection.createRange();if(rang.item){return rang.item(0).outerHTML}return rang.htmlText}else{var rang=this.iframeWindow.getSelection().getRangeAt(0);var dFragment=rang.cloneContents();var div=document.createElement("div");div.appendChild(dFragment);return div.innerHTML}},insertHTML:function(s_html,s_obj){if($IE&&this.history){this.history.add()}if($IE){try{this.selectRange();this.iframeWindow.focus();var oRang=this.iframeDocument.selection.createRange();if(this.iframeDocument.selection.type.toLowerCase()=="control"){var tempRange=this.iframeDocument.body.createTextRange();tempRange.moveToElementText(oRang.item(0));oRang=tempRange}oRang.pasteHTML(s_html);oRang.collapse(false);oRang.select();this.rangeCache.save()}catch(e){}}else{this.execCommand("insertHTML",s_html);if(s_obj){var ele=this.iframeDocument.getElementById(s_obj.id);if(ele){for(var key in s_obj.properites){ele.setAttribute(key,s_obj.properites[key])}ele.removeAttribute("id")}}}},_onLoadOperates:function(){if(this.loadOpartes){var len=this.loadOpartes.length;for(var i=0;i<len;i++){try{this.loadOpartes[i]()}catch(e){}}}},_addOperateToOnload:function(func){if(!this.loadOpartes){this.loadOpartes=[]}this.loadOpartes.push(func)},_initIframe:function(container,className){this._id=Core.Math.getUniqueId();var iframeParent=container;iframeParent.innerHTML="";this.iframe=$C("iframe");this.iframe.className=className;if(this._iframeUrl!=""){this.iframe.src=this._iframeUrl+"?"+Math.random()}this.iframe.setAttribute("frameborder","0",0);iframeParent.appendChild(this.iframe);this.iframeWindow=this.iframe.contentWindow;Core.Events.addEvent(this.iframe,function(){this.onload=true;if(arguments.callee.down){return}this.iframeDocument=this.iframeWindow.document;if($IE){this.iframeDocument.body.contentEditable=true}else{this.iframeDocument.designMode="on"}arguments.callee.down=true;this._onLoadOperates()}.bind2(this),"load");if(this._iframeUrl==""){this.iframeWindow.document.open();this.iframeWindow.document.write(this._setEditorHTML(""));this.iframeWindow.document.close()}},_setEditorHTML:function(sContent){var html="<html></head><body>"+sContent+"</body></html>";return html}};Editor.AbstractStandard=Core.Class.create();Editor.AbstractStandard.prototype={textarea:null,history:null,tools:null,operate:null,formatDoc:null,imageOperate:null,modeType:"edit",initialize:function(){throw new Error("Editor.AbstractStandard为抽象类不能被实例化")},initTextArea:function(textarea){this.textarea=textarea},swapMode:function(){this.swapShutOut(this.modeType);if(this.modeType=="edit"){if(this.iframeDocument){this.frameToArea()}this.iframe.parentNode.style.display="none";this.textarea.parentNode.style.display="block";this.textarea.style.display="block";this.modeType="code"}else{if(this.iframeDocument){this.areaToFrame()}this.textarea.parentNode.style.display="none";this.iframe.parentNode.style.display="block";this.textarea.style.display="none";this.modeType="edit"}},getContentHtml:function(){this.frameToArea();return this.textarea.value},swapShutOut:function(type){},frameToArea:function(){this.textarea.parentNode.style.display="none";this.textarea.value=this.formatCode(this.iframeDocument.body.innerHTML)},areaToFrame:function(){if(!this.iframeDocument){setTimeout(function(){this.areaToFrame()}.bind2(this),500);return}this.iframeDocument.body.innerHTML=this.textarea.value},formatCode:function(sCodeString){sCodeString=sCodeString.replace(/<(\/?)(ul|hr|table|meta|link|tbody|tr|object|body|head|html)(|[^>]+)>\s*/g,"\n<$1$2$3>\n");sCodeString=sCodeString.replace(/\s*<(p|h[1-6]|div|title|style|pre|script|td|li)(|[^>]+)>/g,"\n<$1$2>");sCodeString=sCodeString.replace(/<\/(p|h[1-6]|div|title|style|pre|script|td|li)>\s*/g,"</$1>\n");sCodeString=sCodeString.replace(/(<font)(>)/gi,"$1 size=#$2");return sCodeString}};Core.Class.extend(Editor.AbstractStandard.prototype,Editor.AbstractBase.prototype,true);if(typeof Editor.Tools=="undefined"){Editor.Tools={}}if(typeof Editor.Utils=="undefined"){Editor.Utils={}}Core.Dom.getLeft=function(element){var left=0;var el=$E(element);if(typeof el.offsetParent!="unknown"){while(el.offsetParent){left+=el.offsetLeft;el=el.offsetParent}}else if(el.x){left+=el.x}return left};Core.Dom.getTop=function(element){var top=0;var el=$E(element);if(typeof el.offsetParent!="unknown"){while(el.offsetParent){top+=el.offsetTop;el=el.offsetParent}}else if(el.y){top+=el.y}return top};Editor.Utils.ShutOut=Core.Class.create();Editor.Utils.ShutOut.prototype={initialize:function(){this.id=Core.Math.getUniqueId();Core.Dom.addHTML(document.body,'<div id="shut_out'+this.id+'" style="display:none;background:#F1F1F1;position: absolute; z-index: 1025;"></div>')},setProperty:function(ele){var left=Core.Dom.getLeft(ele);var top=Core.Dom.getTop(ele);var width=ele.offsetWidth;var height=ele.offsetHeight;this.setPosition(left,top);this.setSize(width,height);this.setOpacity()},setOpacity:function(num){Core.Dom.setStyle($E("shut_out"+this.id),"opacity",num||.8)},setPosition:function(x,y){$E("shut_out"+this.id).style.top=y+"px";$E("shut_out"+this.id).style.left=x+"px"},setSize:function(width,height){$E("shut_out"+this.id).style.width=width+"px";$E("shut_out"+this.id).style.height=height+"px"},show:function(){$E("shut_out"+this.id).style.display="block"},hidden:function(){$E("shut_out"+this.id).style.display="none"}};Editor.Tools.Tool=Core.Class.create();Editor.Tools.Tool.prototype={id:null,operate:null,container:null,shutOut:null,config:{},initialize:function(container,config){this.id=Core.Math.getUniqueId();this.container=$E(container);this.config=config;this.shutOut=new Editor.Utils.ShutOut},setOperate:function(operate){this.operate=operate},setShutOutProperty:function(contaienr){this.shutOut.setProperty(contaienr||this.container.parentNode)},initElements:function(){this.temp=new Ui.Template(this.config.classTemplate);var operates=this.config.tools;this.buildNods(operates,this.container)},buildNods:function(obj,container){for(var name in obj){if(/group_/.test(name)){var b=$C("div");b.className=obj[name].cls;this.buildNods(obj[name].items,b);container.appendChild(b)}else{var b1=this.createButton(this.temp.evaluate({operate:name,num:1}),this.operate[name]||function(){});b1.id=name+"_"+this.id;b1.title=obj[name].title;if(obj[name].style){b1.style.cssText=obj[name].style}if(obj[name].inner){b1.innerHTML=obj[name].inner}container.appendChild(b1)}}},createButton:function(className,handle){var b=$C("div");b.className=className;b.unselectable="on";Core.Events.addEvent(b,handle.bind2(this.operate),"click");Core.Events.addEvent(b,Core.Function.bind3(this.swapButtonState,this,["in"]),"mouseover");Core.Events.addEvent(b,Core.Function.bind3(this.swapButtonState,this,["out"]),"mouseout");return b},swapButtonState:function(type){var ele=Core.Events.getEventTarget();if(ele._disabled){return}var cn=ele.className;var cnArray=cn.split("_");var num=cnArray.pop();if(type=="in"&&num=="1"){ele.className=cnArray.join("_")+"_2"}if(type=="out"&&num=="2"){ele.className=cnArray.join("_")+"_1"}},setButtonState:function(item,type){var ele=$E(item+"_"+this.id);var cn=ele.className;var cnArray=cn.split("_");cnArray.pop();ele.className=cnArray.join("_")+"_"+type;ele._disabled=true},show:function(){this.container.parentNode.style.display=""},hidden:function(){this.container.parentNode.style.display="none"}};Editor.Utils.EditorHistory=Core.Class.create();Editor.Utils.EditorHistory.prototype={levels:[],current:0,editor:null,initialize:function(editor,max){this.editor=editor;this.max=max||100},add:function(){if(!$IE){return}var contentWindow=this.editor.iframeWindow;this.levels[this.current++]=addTolevels();if(this.current>=this.max){this.levels.shift()}this.current=this.levels.length;function addTolevels(){var obj={};var html=contentWindow.document.body.innerHTML;obj.htmlcode=html;if(contentWindow.document.selection.type=="Text"){obj.selrange=contentWindow.document.selection.createRange().getBookmark()}return obj}},gotoLevel:function(step){if(!$IE){return}var obj=this.levels[step];this.editor.iframeWindow.document.body.innerHTML=obj.htmlcode;if(obj.selrange){var range=this.editor.iframeDocument.selection.createRange();range.moveToBookmark(obj.selrange);range.select()}},redo:function(){var step=this.current+1;if(this.levels[step]){this.gotoLevel(step);this.current++}},undo:function(){var step=this.current-1;if(this.levels[step]){this.gotoLevel(step);this.current--}}};Editor.Utils.RangeCache=Core.Class.create();Editor.Utils.RangeCache.prototype={range:null,selection:null,initialize:function(editor){this.editor=editor},save:function(){if($IE){this.selection=this.editor.iframeDocument.selection;this.range=this.selection.createRange()}},select:function(){if($IE){if(this.range){try{this.editor.iframeDocument.focus();this.range.select()}catch(e){this.editor.iframeDocument.focus()}}else{this.editor.iframeDocument.focus()}}},setRange:function(range){this.range=range}};Core.Dom.getStyle=function(el,property){switch(property){case"opacity":var val=100;try{val=el.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(e){try{val=el.filters("alpha").opacity}catch(e){}}return val/100;case"float":property="styleFloat";default:var value=el.currentStyle?el.currentStyle[property]:null;return el.style[property]||value}};if(!$IE||$IE>8){Core.Dom.getStyle=function(el,property){if(property=="float"){property="cssFloat"}try{var computed=document.defaultView.getComputedStyle(el,"")}catch(e){traceError(e)}return el.style[property]||computed?computed[property]:null}}Core.System.getScrollPos=function(oDocument){oDocument=oDocument||document;var dd=oDocument.documentElement;var db=oDocument.body;return[Math.max(dd.scrollTop,db.scrollTop),Math.max(dd.scrollLeft,db.scrollLeft),Math.max(dd.scrollWidth,db.scrollWidth),Math.max(dd.scrollHeight,db.scrollHeight)]};Core.Dom.getXY=function(el){if((el.parentNode==null||el.offsetParent==null||Core.Dom.getStyle(el,"display")=="none")&&el!=document.body){return false}var parentNode=null;var pos=[];var box;var doc=el.ownerDocument;box=el.getBoundingClientRect();var scrollPos=Core.System.getScrollPos(el.ownerDocument);return[box.left+scrollPos[1],box.top+scrollPos[0]];parentNode=el.parentNode;while(parentNode.tagName&&!/^body|html$/i.test(parentNode.tagName)){if(Core.Dom.getStyle(parentNode,"display").search(/^inline|table-row.*$/i)){pos[0]-=parentNode.scrollLeft;pos[1]-=parentNode.scrollTop}parentNode=parentNode.parentNode}return pos};if(!$IE){Core.Dom.getXY=function(el){if((el.parentNode==null||el.offsetParent==null||Core.Dom.getStyle(el,"display")=="none")&&el!=document.body){return false}var parentNode=null;var pos=[];var box;var doc=el.ownerDocument;pos=[el.offsetLeft,el.offsetTop];parentNode=el.offsetParent;var hasAbs=Core.Dom.getStyle(el,"position")=="absolute";if(parentNode!=el){while(parentNode){pos[0]+=parentNode.offsetLeft;pos[1]+=parentNode.offsetTop;if($SAFARI&&!hasAbs&&Core.Dom.getStyle(parentNode,"position")=="absolute"){hasAbs=true}parentNode=parentNode.offsetParent}}if($SAFARI&&hasAbs){pos[0]-=el.ownerDocument.body.offsetLeft;pos[1]-=el.ownerDocument.body.offsetTop}parentNode=el.parentNode;while(parentNode.tagName&&!/^body|html$/i.test(parentNode.tagName)){if(Core.Dom.getStyle(parentNode,"display").search(/^inline|table-row.*$/i)){pos[0]-=parentNode.scrollLeft;pos[1]-=parentNode.scrollTop}parentNode=parentNode.parentNode}return pos}}Editor.Utils.ImageDrag=Core.Class.create();Editor.Utils.ImageDrag.prototype={initialize:function(editor){this.editor=editor},drag:function(el){if(!$IE){return}var _target=el.target||el.srcElement;var _img2=null;var _span2=null;var _tempPos=[];var _imgPos={};var _imgReSzie="";var _mousePos={};var _posAffer={};var _scrollTop=Core.System.getScrollPos(this.editor.iframeDocument)[0];if(_target.s==null){_target.s={};_target.s.w=_target.offsetWidth;_target.s.h=_target.offsetHeight}_target.onresizestart=function(){this.editor.imageOperate.hidden();_imgPos.l=this.utils.getLeft(_target);_imgPos.t=this.utils.getTop(_target);_imgPos.w=_target.offsetWidth;_imgPos.h=_target.offsetHeight;_imgPos.nl=_imgPos.l;_imgPos.nt=_imgPos.t;_imgPos.nw=_imgPos.w;_imgPos.nh=_imgPos.h;_mousePos.x=el.x;_mousePos.y=el.y;_img2=$C("img");_img2.src=_target.src;Core.Dom.setStyle(_img2,"position","absolute");Core.Dom.setStyle(_img2,"border","dashed black 1px");Core.Dom.setStyle(_img2,"opacity","0.4");Core.Dom.setStyle(_img2,"left",_imgPos.l-1);Core.Dom.setStyle(_img2,"top",_imgPos.t-1);Core.Dom.setStyle(_img2,"width",_imgPos.w+"px");Core.Dom.setStyle(_img2,"height",_imgPos.h+"px");_target.insertAdjacentElement("afterEnd",_img2);_span2=$C("div");_span2.innerText=_imgPos.w+" x "+_imgPos.h+" (0, 0)";Core.Dom.setStyle(_span2,"position","absolute");Core.Dom.setStyle(_span2,"border","solid black 1px");Core.Dom.setStyle(_span2,"left",el.x);Core.Dom.setStyle(_span2,"top",el.y);Core.Dom.setStyle(_span2,"width","130px");Core.Dom.setStyle(_span2,"height","20px");Core.Dom.setStyle(_span2,"backgroundColor","#ffffff");Core.Dom.setStyle(_span2,"lineHeight","20px");Core.Dom.setStyle(_span2,"textAlign","center");Core.Dom.setStyle(_span2,"fontSize","12px");_img2.insertAdjacentElement("afterEnd",_span2);if(el.x>_imgPos.l+_target.offsetWidth-4){if(el.y+_scrollTop>_imgPos.t+_target.offsetHeight-4){_imgReSzie="rb"}else if(el.y+_scrollTop<_imgPos.t+4){_imgReSzie="rt"}else{_imgReSzie="rm"}}else if(el.x<_imgPos.l+4){if(el.y+_scrollTop>_imgPos.t+_target.offsetHeight-4){_imgReSzie="lb"}else if(el.y+_scrollTop<_imgPos.t+4){_imgReSzie="lt"}else{_imgReSzie="lm"}}else{if(el.y+_scrollTop<_imgPos.t+4){_imgReSzie="ct"}else{_imgReSzie="cb"}}}.bind2(this);_target.onresizeend=function(){_img2.removeNode(true);_span2.removeNode(true);_target.s.w=_imgPos.nw;_target.s.h=_imgPos.nh;Core.Dom.setStyle(_target,"width",_imgPos.nw+"px");Core.Dom.setStyle(_target,"height",_imgPos.nh+"px");this.editor.history.add()}.bind2(this);_target.onresize=function(){if(_imgReSzie=="rb"){_imgPos.nw=el.x-_imgPos.l;_imgPos.nh=Math.floor(_imgPos.nw*(_target.s.h/_target.s.w))}else if(_imgReSzie=="cb"){_imgPos.nh=el.y-_mousePos.y+_imgPos.h}else if(_imgReSzie=="ct"){_imgPos.nh=_mousePos.y-el.y+_imgPos.h;_imgPos.nt=_imgPos.t+Math.floor(_imgPos.h-_imgPos.nh)}else if(_imgReSzie=="rm"){_imgPos.nw=el.x-_mousePos.x+_imgPos.w}else if(_imgReSzie=="lm"){_imgPos.nw=_mousePos.x-el.x+_imgPos.w;_imgPos.nl=_imgPos.l+Math.floor(_imgPos.w-_imgPos.nw)}else if(_imgReSzie=="rt"){_imgPos.nw=el.x-_imgPos.l;_imgPos.nh=Math.floor(_imgPos.nw*(_target.s.h/_target.s.w));_imgPos.nt=_imgPos.t+Math.floor(_imgPos.h-_imgPos.nh)}else if(_imgReSzie=="lt"){_imgPos.nw=_mousePos.x-el.x+_imgPos.w;_imgPos.nh=Math.floor(_imgPos.nw*(_target.s.h/_target.s.w));_imgPos.nl=_imgPos.l+Math.floor(_imgPos.w-_imgPos.nw);_imgPos.nt=_imgPos.t+Math.floor(_imgPos.h-_imgPos.nh)}else if(_imgReSzie=="lb"){_imgPos.nw=_mousePos.x-el.x+_imgPos.w;_imgPos.nh=Math.floor(_imgPos.nw*(_target.s.h/_target.s.w));_imgPos.nl=_imgPos.l+Math.floor(_imgPos.w-_imgPos.nw)}_imgPos.nw=Math.max(_imgPos.nw,2);_imgPos.nh=Math.max(_imgPos.nh,2);if(isNaN(_imgPos.nw)||isNaN(_imgPos.nh)){return}Core.Dom.setStyle(_img2,"width",_imgPos.nw+"px");Core.Dom.setStyle(_img2,"height",_imgPos.nh+"px");Core.Dom.setStyle(_img2,"top",_imgPos.nt-1+"px");Core.Dom.setStyle(_img2,"left",_imgPos.nl-1+"px");Core.Dom.setStyle(_span2,"top",el.y+"px");Core.Dom.setStyle(_span2,"left",el.x+"px");_posAffer.x=_imgPos.nw-_target.s.w;_posAffer.y=_imgPos.nh-_target.s.h;_span2.innerText=_imgPos.nw+" x "+_imgPos.nh+" ("+(_posAffer.x>0?"+":"-")+Math.abs(_posAffer.x)+","+(_posAffer.y>0?"+":"-")+Math.abs(_posAffer.y)+")"}},utils:{getTop:function(element){var top=0;var el=$E(element);if(el.offsetParent){while(el.offsetParent&&el.offsetParent.style.position!="relative"){top+=el.offsetTop;el=el.offsetParent}}else if(el.y){top+=el.y}return top},getLeft:function(element){var left=0;var el=$E(element);if(el.offsetParent){while(el.offsetParent&&el.offsetParent.style.position!="relative"){left+=el.offsetLeft;el=el.offsetParent}}else if(el.x){left+=el.x}return left}}};Editor.Tools.Status=Core.Class.create();Editor.Tools.Status.prototype={config:[],initialize:function(id,editor,conf){this.id=id;this.editor=editor;this.config=conf||["bold","italic","underline","forecolor","hilitecolor","fontsize","family"]},checkAllStatus:function(){for(var i=0;i<this.config.length;i++){this.setToolItemStatus(this.config[i])}},setToolItemStatus:function(actionType){switch(actionType){case"bold":case"italic":case"underline":var isSelect=this.editor.iframeDocument.queryCommandState(actionType);this.swapStatus(actionType,isSelect);break;case"forecolor":var elm=this.editor.getFocusElement();var forecolor=Core.Dom.getStyle(elm,"color");if(!forecolor){break}try{Core.Dom.setStyle($E("forecolor_"+this.id),"backgroundColor",forecolor)}catch(e){}break;case"hilitecolor":var elm=this.editor.getFocusElement();var hilitecolor=Core.Dom.getStyle(elm,"backgroundColor");if(!hilitecolor){break}if(hilitecolor=="transparent"){hilitecolor="#ccc"}try{Core.Dom.setStyle($E("hilitecolor_"+this.id),"backgroundColor",hilitecolor)}catch(e){}break;case"fontsize":var elm=this.editor.getFocusElement();var fontsize=Core.Dom.getStyle(elm,"fontSize");if(!fontsize){break}if(fontsize.indexOf(".")!=-1||fontsize.indexOf("px")==-1){fontsize="";return}if(fontsize==1)fontsize="10px";else if(fontsize==2)fontsize="13px";else if(fontsize==3)fontsize="16px";else if(fontsize==4)fontsize="18px";else if(fontsize==5)fontsize="24px";else if(fontsize==6)fontsize="32px";else if(fontsize>=7)fontsize="48px";if(!$IE){fontsize=window.parseInt(fontsize)+"px"}$E("fontsize_"+this.id).innerHTML="<div>"+fontsize+"</div>";break;case"family":var elm=this.editor.getFocusElement();var family=Core.Dom.getStyle(elm,"fontFamily");if(!family){break}family=family.split(",");family=family[0].replace(/'|"/g,"");var tmp_fm=family.split("_");if(tmp_fm.length>0){family=tmp_fm[0]}$E("family_"+this.id).innerHTML="<div>"+this.__getFontName(family)+"</div>";break;case"redo":break;case"undo":break}},swapStatus:function(type,isHot){var target=$E(type+"_"+this.id);var idArr=target.className.split("_");idArr.pop();if(isHot){target.className=idArr.join("_")+"_3"}else{target.className=idArr.join("_")+"_1"}},__getFontName:function(font){var name="";switch(font.toLowerCase()){case"simsun":name="宋体";break;case"microsoft yahei":name="微软雅黑";break;default:name=font}return name}};Lib.Ticket={requestTickets:[],_interface:"http://login.sina.com.cn/sso/getst.php",_setParam:function(param){var urlArray=[];urlArray.push(this._interface);var i=0;for(var name in param){if(i==0){urlArray.push("?")}else{urlArray.push("&")}urlArray.push(name);urlArray.push("=");urlArray.push(param[name]);i++}return urlArray.join("")},get:function(callbackFunc,count,entry,service){if(!callbackFunc){return}var options={success:function(){},fail:function(){}};if(typeof callbackFunc=="function"){options.success=callbackFunc}else{if(typeof callbackFunc.success=="function"){options.success=callbackFunc.success}if(typeof callbackFunc.fail=="function"){options.fail=callbackFunc.fail}}var param={};param.entry=entry||"blog";param.service=service||"tupian";param.cnt=count||20;var url=this._setParam(param);Utils.Io.JsLoad.request(url,{onComplete:function(result){var oldTickets=Lib.Ticket.requestTickets;if(result){Lib.Ticket.requestTickets=oldTickets.concat(result.ticket)}options.success(result)},onException:function(){options.fail()},timeout:3e4,charset:"UTF-8"})}};Editor.Utils.staticClass={flash_id:"image_modify_emb",userData:null,getArgs:function(key,pid){trace(key);switch(key){case"ClientName":return"sinaBowen";case"PicUrl":return scope.editImage.src;case"Ticket":Lib.Ticket.get(function(ticket){this.setArgs(ticket)}.bind2(this),1);break;case"Domain":return scope.modify_flash_domain;case"UploadUrl":return"http://upload.photo.sina.com.cn/interface/pic_upload.php?app=blog&data=1&mime=image/jpeg&ticket=";case"Close":this.closeEditLayer();break;case"ReturnPicId":this.changeImg(pid)}},refresh:function(){if(!this.userData){this.userData=new Utils.UserData}this.userData.save("image_edit_data_"+scope.$uid,{content:editor.iframeDocument.body.innerHTML});window.location.href=this.setParam(window.location.href,"imgEdit=1");return false},setParam:function(url,param){return"http://control.blog.sina.com.cn/admin/article/article_add.php?imgedit=1"},changeImg:function(){},closeEditLayer:function(){},setArgs:function(ticket){var swf=$E(this.flash_id);try{swf.setArgs("SINA_BLOG_TICKET",ticket.ticket[0])}catch(e){}}};Sina.pkg("Utils.Flash");if(typeof deconcept=="undefined")var deconcept=new Object;if(typeof deconcept.util=="undefined")deconcept.util=new Object;if(typeof deconcept.SWFObjectUtil=="undefined")deconcept.SWFObjectUtil=new Object;deconcept.SWFObject=function(swf,id,w,h,ver,c,quality,xiRedirectUrl,redirectUrl,detectKey){if(!document.getElementById){return}this.DETECT_KEY=detectKey?detectKey:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object;this.variables=new Object;this.attributes=new Array;if(swf){this.setAttribute("swf",swf)}if(id){this.setAttribute("id",id)}if(w){this.setAttribute("width",w)}if(h){this.setAttribute("height",h)}if(ver){
this.setAttribute("version",new deconcept.PlayerVersion(ver.toString().split(".")))}this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){deconcept.SWFObject.doPrepUnload=true}if(c){this.addParam("bgcolor",c)}var q=quality?quality:"high";this.addParam("quality",q);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var xir=xiRedirectUrl?xiRedirectUrl:window.location;this.setAttribute("xiRedirectUrl",xir);this.setAttribute("redirectUrl","");if(redirectUrl){this.setAttribute("redirectUrl",redirectUrl)}};deconcept.SWFObject.prototype={useExpressInstall:function(path){this.xiSWFPath=!path?"expressinstall.swf":path;this.setAttribute("useExpressInstall",true)},setAttribute:function(name,value){this.attributes[name]=value},getAttribute:function(name){return this.attributes[name]},addParam:function(name,value){this.params[name]=value},getParams:function(){return this.params},addVariable:function(name,value){this.variables[name]=value},getVariable:function(name){return this.variables[name]},getVariables:function(){return this.variables},getVariablePairs:function(){var variablePairs=new Array;var key;var variables=this.getVariables();for(key in variables){variablePairs[variablePairs.length]=key+"="+variables[key]}return variablePairs},getSWFHTML:function(){var swfNode="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath)}swfNode='<embed pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" src="'+this.getAttribute("swf")+'" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'"';swfNode+=' id="'+this.getAttribute("id")+'" name="'+this.getAttribute("id")+'" ';var params=this.getParams();for(var key in params){swfNode+=[key]+'="'+params[key]+'" '}var pairs=this.getVariablePairs().join("&");if(pairs.length>0){swfNode+="flashvars="+pairs+'&realfull=1&moz=1"'}swfNode+="/>"}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath)}swfNode='<object id="'+this.getAttribute("id")+'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'">';swfNode+='<param name="movie" value="'+this.getAttribute("swf")+'" />';var params=this.getParams();for(var key in params){swfNode+='<param name="'+key+'" value="'+params[key]+'" />'}var pairs=this.getVariablePairs().join("&");if(pairs.length>0){swfNode+='<param name="flashvars" value="'+pairs+'" />'}swfNode+="</object>"}return swfNode},write:function(elementId){if(this.getAttribute("useExpressInstall")){var expressInstallReqVer=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(expressInstallReqVer)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title)}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){}else{if(this.getAttribute("redirectUrl")!=""){document.location.replace(this.getAttribute("redirectUrl"))}}var n=typeof elementId=="string"?document.getElementById(elementId):elementId;var oldTitle=document.title;n.innerHTML=this.getSWFHTML();if(oldTitle!==document.title){document.title=oldTitle}return true}};deconcept.SWFObjectUtil.getPlayerVersion=function(){var PlayerVersion=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description){PlayerVersion=new deconcept.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."))}}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;var counter=3;while(axo){try{counter++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+counter);PlayerVersion=new deconcept.PlayerVersion([counter,0,0])}catch(e){axo=null}}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");PlayerVersion=new deconcept.PlayerVersion([6,0,21]);axo.AllowScriptAccess="always"}catch(e){if(PlayerVersion.major==6){return PlayerVersion}}try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){}}if(axo!=null){PlayerVersion=new deconcept.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","))}}return PlayerVersion};deconcept.PlayerVersion=function(arrVersion){this.major=arrVersion[0]!=null?parseInt(arrVersion[0]):0;this.minor=arrVersion[1]!=null?parseInt(arrVersion[1]):0;this.rev=arrVersion[2]!=null?parseInt(arrVersion[2]):0};deconcept.PlayerVersion.prototype.versionIsValid=function(fv){if(this.major<fv.major)return false;if(this.major>fv.major)return true;if(this.minor<fv.minor)return false;if(this.minor>fv.minor)return true;if(this.rev<fv.rev)return false;return true};deconcept.util={getRequestParameter:function(param){var q=document.location.search||document.location.hash;if(param==null){return q}if(q){var pairs=q.substring(1).split("&");for(var i=0;i<pairs.length;i++){if(pairs[i].substring(0,pairs[i].indexOf("="))==param){return pairs[i].substring(pairs[i].indexOf("=")+1)}}}return""}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var objects=document.getElementsByTagName("OBJECT");for(var i=objects.length-1;i>=0;i--){objects[i].style.display="none";for(var x in objects[i]){if(typeof objects[i][x]=="function"){objects[i][x]=function(){}}}}};if(deconcept.SWFObject.doPrepUnload){if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs)};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true}}if(!document.getElementById&&document.all){document.getElementById=function(id){return document.all[id]}}var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;Utils.Flash.swfObject=deconcept.SWFObject;Editor.Utils.Modify=Core.Class.create();Editor.Utils.Modify.prototype={_getFlashUrl:"http://www.picself.cn/GetPicselfUrl.php",_flashUrl:"",_dFlashUrl:"http://www.picself.cn/flash/picself.swf",container_id:"image_modify_con",isInit:false,isClosed:true,showNum:0,initialize:function(target){this.target=target;if(this.checkFlashVersion()){this.init()}else{this.installTip()}},init:function(){if(this.isInit){return}this.getFlash();this.initDialog();this.bindFuncToStatic();this.isInit=true},checkFlashVersion:function(){var obj=deconcept.SWFObjectUtil.getPlayerVersion();if(obj.major<10){return false}return true},installTip:function(){winDialog.alert('我们的产品需要安装flashplayer 10或更高版本，请<a href="http://get.adobe.com/flashplayer">点击此处</a>免费下载')},refreshTip:function(){winDialog.alert('<a href="#" onclick="Editor.Utils.staticClass.refresh()">点击刷新</a>，我们帮您检测是否已成功安装flashplayer 10',{textOk:"刷新",funcOk:function(){Editor.Utils.staticClass.refresh()}})},initDialog:function(){var me=this;var tpl=['<table id="#{entity}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}"></strong>','<cite><a title="关闭" class="CP_w_shut" id="#{btnClose}" href="javascript:;" onclick="return false">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span/></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}">',"</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join("");this.dialog=winDialog.createCustomsDialog({tpl:tpl,title:"编辑图片",content:"<div id="+this.container_id+'><div style="width:920px;height:500px;"></div></div>',renderer:Ui.SimpleRenderer,width:920},"imageModify");this.dialog.addEventListener("hidden",function(){me.isClosed=true;$E(me.container_id).innerHTML=""});this.dialog.setMiddle();this.dialog.setAreaLocked(true);var count=20;setTimeout(function(){var s=me.setContent();if(!s&&count-->0){arguments.callee()}},100)},bindFuncToStatic:function(){Editor.Utils.staticClass.closeEditLayer=this.hide.bind2(this);Editor.Utils.staticClass.changeImg=this.changeImg.bind2(this)},getFlash:function(){var getInterface=new Interface(this._getFlashUrl,"jsload");getInterface.request({GET:{},onSuccess:function(_data){this._flashUrl=_data;scope.modify_flash_domain=_data.replace(/\w*\.swf.*$/,"")}.bind2(this),onError:function(_data){this._flashUrl=this._dFlashUrl;scope.modify_flash_domain=this._dFlashUrl.replace(/\w*\.swf.*$/,"")}.bind2(this),onFail:function(_data){this._flashUrl=this._dFlashUrl;scope.modify_flash_domain=this._dFlashUrl.replace(/\w*\.swf.*$/,"")}.bind2(this)})},changeImg:function(pid){if(this.isClosed){return}rssSendLog("11_31_pic_tupianbaocun");var url=scope.editImage.src;scope.editImage.src=url.replace(/\/\w*&/,"/"+pid+"&");scope.editImage.style.height="";scope.editImage.style.width="";scope.editImage.removeAttribute("width");scope.editImage.removeAttribute("height");this.hide()},hide:function(){this.dialog.hidden();$E(this.container_id).innerHTML=""},show:function(){var me=this;this.isClosed=false;if(this.isInit){this.dialog.show();window.setTimeout(function(){me.setContent()},1)}else{if(this.checkFlashVersion()){this.init()}else{if(this.showNum>0){this.refreshTip()}}}this.showNum++},setContent:function(){if(this._flashUrl==""){return false}Utils.Flash.swfView.Add(this._flashUrl,this.container_id,Editor.Utils.staticClass.flash_id,"920","500","9.0.0.0","#000",{getArgs:"Editor.Utils.staticClass.getArgs"},{scale:"showall",pluginspage:"http://www.macromedia.com/go/getflashplayer",allowScriptAccess:"always",allowFullScreen:"false",wmode:"opaque"});return true}};Editor.Utils.ImageOperate=Core.Class.create();Editor.Utils.ImageOperate.prototype={sizeStatus:["mw690","bmiddle","small"],size:"big",isShow:false,regStr:"",sizeOperate:true,initialize:function(reg){var template='<div id="#{panel}" class="img_ediLayer" style="position:absolute;"><div id="#{content}"></div></div>';this.regStr=reg||"sinaimg.cn";this.layer=new Ui.Panel;this.layer.setTemplate(template);this.initElement();var ifameEle=$E("SinaEditor_Iframe");this.editorTop=Core.Dom.getTop(ifameEle);this.editorLeft=Core.Dom.getLeft(ifameEle);this.editorBottom=this.editorTop+ifameEle.offsetHeight;this.editorRight=this.editorLeft+ifameEle.offsetWidth;this.setOpacity()},setOpacity:function(num){num=num||.8;Core.Dom.setStyle(this.layer.entity,"opacity","0.8")},show:function(ele){var size;this.target=ele;if(this.target.src.indexOf("sinajs.cn")!=-1||this.target.src.indexOf("/myshow/")!=-1){return}if(ele.src.indexOf(this.regStr)!=-1){if(!this.sizeOperate){this.showSizeOperate()}ele.src.replace(/(\/)(small|bmiddle|mw690|middle)(\/)/g,function(a,b,c){size=c});this.setSize(size);this.setSizeColor();this.setAllCacheImage();if(this.checkFlashVersion()){this.showEdit()}else{this.hiddenEdit()}}else{this.hiddenEdit();if(this.sizeOperate){this.hiddenSizeOperate()}}this.setPosition();this.layer.show();this.isShow=true},checkFlashVersion:function(){var obj=deconcept.SWFObjectUtil.getPlayerVersion();if(obj.major<10){return false}return true},setCacheImage:function(size){var data={size:size};data.url=this.target.src.replace(/(\/)(small|bmiddle|bmiddle)(\/)/g,"$1"+size+"$3");var html='<img style="display:none" src="#{url}" id="image_operate_cache_#{size}"/>';var template=new Ui.Template(html);Core.Dom.addHTML(document.body,template.evaluate(data))},setAllCacheImage:function(){var len=this.sizeStatus.length;for(var i=0;i<len;i++){this.setCacheImage(this.sizeStatus[i])}},removeAllCache:function(){var len=this.sizeStatus.length;for(var i=0;i<len;i++){var ele=$E("image_operate_cache_"+this.sizeStatus[i]);if(ele){ele.parentNode.removeChild(ele)}}},setPosition:function(){var scrollPos=Core.System.getScrollPos(editor.iframeDocument);var top=this.editorTop+Core.Dom.getTop(this.target)-scrollPos[0];if(top<this.editorTop){top=this.editorTop}var left=this.editorLeft+Core.Dom.getLeft(this.target)+19;this.layer.setPosition({x:left,y:top})},getTop:function(element){var top=0;var el=element;if(el.offsetParent){while(el.offsetParent){top+=el.offsetTop;el=el.offsetParent}}else if(el.y){top+=el.y}return top},getLeft:function(element){var left=0;var el=element;if(el.offsetParent){while(el.offsetParent){left+=el.offsetLeft;el=el.offsetParent}}else if(el.x){left+=el.x}return left},hidden:function(){if(this.isShow){this.removeAllCache();this.layer.hidden();this.finalize();this.isShow=false}},finalize:function(){if(this.target){this.target=null}},change:function(){if(!window.templateDialog||!window.templateDialog.entity){window.templateDialog=new Editor.Utils.IframeDialog({url:"http://control.blog.sina.com.cn/admin/ria/article_addM_image.php?type=1",title:"插入图片",width:650,height:500,dialogName:"templateDialog"})}window.templateDialog.show();editor.iframeWindow.focus();this.layer.hidden()},del:function(){this.target.parentNode.removeChild(this.target);this.hidden()},edit:function(){if(!this.modify){this.modify=new Editor.Utils.Modify}rssSendLog("11_31_pic_tupianchuli2");scope.editImage=this.target;this.modify.show();this.hidden();return false},setBig:function(){if(this.size=="big"){return}this.clearWidth();this.target.src=this.target.src.replace(/(\/)(small|bmiddle)(\/)/g,"$1mw690$3");this.size="big";this.setSizeColor();this.hidden()},setMiddle:function(){if(this.size=="middle"){return}this.clearWidth();this.target.src=this.target.src.replace(/(\/)(small|mw690)(\/)/g,"$1bmiddle$3");this.size="middle";this.setSizeColor();this.hidden()},setSmall:function(){if(this.size=="small"){return}this.clearWidth();this.target.src=this.target.src.replace(/(\/)(mw690|bmiddle)(\/)/g,"$1small$3");this.size="small";this.setSizeColor();this.hidden()},clearWidth:function(){this.target.style.height="";this.target.style.width="";this.target.removeAttribute("width");this.target.removeAttribute("height")},setSize:function(type){switch(type){case"mw690":case"middle":this.size="big";break;case"bmiddle":this.size="middle";break;case"small":this.size="small";break}},showSizeOperate:function(){var imgOpSize=$E("image_operate_size");if(imgOpSize)imgOpSize.style.display="";$E("image_operate_big").style.display="";$E("image_operate_middle").style.display="";$E("image_operate_small").style.display="";imgOpSize=null;this.sizeOperate=true},showEdit:function(){},hiddenEdit:function(){},hiddenSizeOperate:function(){var imgOpSize=$E("image_operate_size");var imgOpBig=$E("image_operate_big");var imgOpMiddle=$E("image_operate_big");var imgOpSmall=$E("image_operate_small");if(imgOpSize)imgOpSize.style.display="none";if(imgOpBig)imgOpBig.style.display="none";if(imgOpMiddle)imgOpMiddle.style.display="none";if(imgOpSmall)imgOpSmall.style.display="none";imgOpSize=imgOpBig=imgOpMiddle=imgOpSmall=null;this.sizeOperate=false},setSizeColor:function(){$E("image_operate_big").className="";$E("image_operate_middle").className="";$E("image_operate_small").className="";$E("image_operate_"+this.size).className="size"},initElement:function(){var html='<div class="conn">\r\n						<div class="tit">编辑图片</div>\r\n						<ul>\r\n							<li><a href="javascript:void(0);" onclick="return false" id="image_operate_change">更改图片</a></li>\r\n							<li><a href="javascript:void(0);" onclick="return false" id="image_operate_del">删除图片</a></li>\r\n							<li>\r\n								<a href="javascript:void(0);" onclick="return false" id="image_operate_big" class="size">大</a>\r\n								<a href="javascript:void(0);" onclick="return false" id="image_operate_middle" class="mid">中</a>\r\n								<a href="javascript:void(0);" onclick="return false" id="image_operate_small">小</a>\r\n							</li>\r\n						</ul>\r\n					</div>';var template=new Ui.Template(html);var data={};this.layer.setContent(template.evaluate(data));Core.Events.addEvent($E("image_operate_change"),this.change.bind2(this));Core.Events.addEvent($E("image_operate_del"),this.del.bind2(this));Core.Events.addEvent($E("image_operate_big"),this.setBig.bind2(this));Core.Events.addEvent($E("image_operate_middle"),this.setMiddle.bind2(this));Core.Events.addEvent($E("image_operate_small"),this.setSmall.bind2(this))}};Editor.Tools.OperateLayerList=Core.Class.create();Editor.Tools.OperateLayerList.prototype={names:[],initialize:function(){},add:function(name,obj){this.names.push(name);this[name]=obj},show:function(name){var len=this.names.length;for(var i=0;i<len;i++){if(this.names[i]!=name&&this[this.names[i]].hidden){this[this.names[i]].hidden()}}if(this[name]&&this[name].show){this[name].show()}}};Editor.Tools.Operate=Core.Class.create();Editor.Tools.Operate.prototype={initFunctions:function(){},initialize:function(editor,isDomain){this.editor=editor;this.isDomain=isDomain||false;this.layers=new Editor.Tools.OperateLayerList;this.initFunctions()}};Core.Class.extend(Editor.Tools.Operate.prototype,{undo:function(){if($IE){this.editor.history.undo()}else{this.editor.execCommand("undo")}}});Core.Class.extend(Editor.Tools.Operate.prototype,{bold:function(){this.editor.history.add();this.editor.execCommand("bold");if(this.editor.swapToolStatus){this.editor.swapToolStatus("bold")}}});Core.Class.extend(Editor.Tools.Operate.prototype,{italic:function(){this.editor.history.add();this.editor.execCommand("italic");this.editor.swapToolStatus("italic")}});Core.Class.extend(Editor.Tools.Operate.prototype,{underline:function(){this.editor.history.add();this.editor.execCommand("underline");this.editor.swapToolStatus("underline")}});Editor.Tools.OperateLayer=Core.Class.create();Editor.Tools.OperateLayer.prototype={initialize:function(editor,tamplate){},initElement:function(){},setPosition:function(){var e=Core.Events.getEvent();var et=Core.Events.fixEvent(e);var ele=et.target;var left=Core.Dom.getLeft(ele);var top=Core.Dom.getTop(ele)+ele.offsetHeight+1;this.layer.setPosition({x:left-5,y:top})},stopEvent:function(){Core.Events.stopEvent()},getEventElement:function(){var e=Core.Events.getEvent();var et=Core.Events.fixEvent(e);return et.target},exec:function(){},hidden:function(){this.layer.hidden();this.isShow=false},show:function(){this.isShow=this.isShow||false;if(this.isShow){this.hidden()}else{this.setPosition();this.stopEvent();this.layer.show();this.layer.entity.style.zIndex="1025";this.setColor(this.getEventElement().style.backgroundColor);this.isShow=true}},setColor:function(color){var ele=$E("seteditorcolorswf_"+this.id);if(ele&&ele.setColor){ele.setColor(color)}}};Editor.Tools.FontSize=Core.Class.create();Editor.Tools.FontSize.prototype={initialize:function(editor,tamplate){this.stopEvent();this.editor=editor;this.layer=new Ui.Panel;this.layer.setTemplate(tamplate);this.initElement();this.setPosition()},initElement:function(){var size;if(this.editor.type!="smallEditor"){size={"10px":"10px<i>(六号)</i>","12px":"12px<i>(小五)</i>","14px":"14px<i>(五号)</i>","16px":"16px<i>(小四)</i>","18px":"18px","20px":"20px<i>(小三)</i>","22px":"22px","24px":"24px<i>(小二)</i>","32px":"32px<i>(小一)</i>","56px":"56px<i>(初号)</i>"}}else{size={"10px":"10px<i>(六号)</i>","12px":"12px<i>(小五)</i>","18px":"18px","22px":"22px","32px":"32px<i>(小一)</i>","56px":"56px<i>(初号)</i>"}}for(var name in size){var a=$C("a");a.innerHTML=size[name];if(this.editor.type!="smallEditor"){a.style.cssText="font-size:"+name}a.href="javascript:void(0);";a.onclick=function(){return false};a.className="fontItem";this.layer.entity.appendChild(a);Core.Events.addEvent(a,this.exec.bind2(this),"click")}},replaceSize:function(size){var fonts=this.editor.iframeDocument.body.getElementsByTagName("font");var fontsLen=fonts.length;var fontNode=null;var clear=false;trace(fontsLen);for(var i=0;i<fontsLen;i++){fontNode=fonts[i];if(fontNode.getAttribute("face")=="SinaEditor_Temp_FontName"){Core.Dom.setStyle(fontNode,"fontSize",size);fontNode.removeAttribute("face");clear=true;var childFonts=fontNode.getElementsByTagName("font");var len=childFonts.length;var parentNode=fontNode.parentNode;for(var j=0;j<len;j++){Core.Dom.setStyle(childFonts[j],"fontSize","");if(parentNode.tagName.toLowerCase()=="font"){if(parentNode.innerText==fontNode.innerText){Core.Dom.setStyle(parentNode,"fontSize","")}}}}}},exec:function(){this.hidden();var ele=this.getEventElement();if(ele.nodeName.toLowerCase()!="a"){ele=ele.parentNode}var size=ele.innerHTML.replace(/(\d{1,2}px).*/gi,"$1");this.editor.iframeWindow.focus();if($IE){this.editor.selectRange();this.editor.execCommand("fontname","SinaEditor_Temp_FontName","");this.replaceSize(size)}else{this.editor.execCommand("FontSize",size,false);var fontEles=this.editor.iframeDocument.getElementsByTagName("font"),len=fontEles.length,fontEle,shitBrowse=false;while(len--){if(fontEles[len].getAttribute("size")){fontEle=fontEles[len];fontEle.removeAttribute("size");fontEle.style.fontSize=size;fuckBrw=false}}if(shitBrowse){this.editor.execCommand("CreateLink","#SinaEditor_Temp_FontName",false);var links=this.editor.iframeDocument.getElementsByTagName("a");var lens=links.length,linkEl,fontEl,childEl;for(var i=0;i<lens;i++){linkEl=links[i];if(linkEl.href.indexOf("#SinaEditor_Temp_FontName")!=-1){fontEl=linkEl.parentNode;childEl=linkEl.childNodes[0];fontEl.removeAttribute("size");if("#SinaEditor_Temp_FontName"===childEl.nodeValue){childEl.nodeValue=""}else{fontEl.style.fontSize=size}fontEl.replaceChild(childEl,linkEl)}}}}if(this.editor.swapToolStatus){this.editor.swapToolStatus("fontsize")}this.editor.iframeWindow.focus()}};Core.Class.extend(Editor.Tools.FontSize.prototype,Editor.Tools.OperateLayer.prototype,true);Core.Array.ArrayWithout=function(){if(arguments.length<2){return arguments.length==1?arguments[0]:null}var results=[];var aa=arguments[0];if(aa===null||aa.constructor!=Array){return null}if(arguments[1].constructor==Array){var args=[];args[0]=aa;Core.Array.foreach(arguments[1],function(v,i){args[i+1]=v})}else{args=arguments}for(var i=0;i<aa.length;i++){var isWithout=true;for(var j=1;j<args.length;j++){if(aa[i]==args[j]){isWithout=false;break}}if(isWithout){results.push(aa[i])}}return results};Editor.Utils.EventObserver=Core.Class.create();Editor.Utils.EventObserver.prototype={observers:[],type:"click",initialize:function(element,type){this.type=type;Core.Events.addEvent(element,this.exec.bind2(this),this.type)},attach:function(func){this.observers.push(func);return this.observers.length-1},exec:function(){var len=this.observers.length;for(var i=0;i<len;i++){this.observers[i]()}},detach:function(step){this.observers[step]=function(){}},finalize:function(){this.observers=[]}};Core.Class.extend(Editor.Tools.Operate.prototype,{fontsize:function(){if(this.layers.fs){this.layers.show("fs")}else{if(this.editor.type=="smallEditor"){this.layers.add("fs",new Editor.Tools.FontSize(this.editor,'<div id="#{entity}" class="fontItemContent_small"><div id="#{content}" class="fontItemTitle">字号</div></div>'))}else{this.layers.add("fs",new Editor.Tools.FontSize(this.editor,'<div id="#{entity}" class="fontItemContent"><div id="#{content}" class="fontItemTitle">字号</div></div>'))}if(!this.documentClickObserver){this.documentClickObserver=new Editor.Utils.EventObserver(document,"click");this.documentMousedownObserver=new Editor.Utils.EventObserver(this.editor.iframeDocument,"mousedown");this.bodyClickObserver=new Editor.Utils.EventObserver(this.editor.iframeDocument.body,"click")}this.documentClickObserver.attach(this.layers.fs.hidden.bind2(this.layers.fs));this.documentMousedownObserver.attach(this.layers.fs.hidden.bind2(this.layers.fs));this.bodyClickObserver.attach(this.layers.fs.hidden.bind2(this.layers.fs));this.layers.show("fs")}}});Utils.Flash.swfView={swfList:[],Add:function(sURL,sID,sPID,nWidth,nHeight,nVersion,sBGColor,oVar,oParam){if(sURL&&sPID){this.swfList[this.swfList.length]={sURL:sURL,sID:sID,sPID:sPID,nWidth:nWidth,nHeight:nHeight,nVersion:nVersion,sBGColor:sBGColor,oVar:oVar,oParam:oParam};this.Init();return}},Init:function(){var so;var list=this.swfList;for(var i=0,len=list.length;i<len;i++){var _list=list[i];so=new Utils.Flash.swfObject(_list.sURL,_list.sPID,_list.nWidth,_list.nHeight,_list.nVersion,_list.sBGColor);if(_list.oVar){for(var key in _list.oVar){so.addVariable(key,_list.oVar[key])}}if(_list.oParam){for(var Key in _list.oParam){so.addParam(Key,_list.oParam[Key])}}so.write(_list.sID)}list=[];_list=null;so=null}};Editor.Tools.SetColor=Core.Class.create();Editor.Tools.SetColor.prototype={initialize:function(editor,tamplate,flashCallback){this.stopEvent();this.editor=editor;this.id=Core.Math.getUniqueId();this.layer=new Ui.Panel;this.layer.setTemplate(tamplate);this.initElement(flashCallback);this.setPosition()},initElement:function(flashCallback){var swf_url=$_GLOBAL.flashBasicURL+"ColorPicker.swf?"+Core.Math.getUniqueId();Utils.Flash.swfView.Add(swf_url,this.layer.entity,"seteditorcolorswf_"+this.id,"251","264","8.0.0.0","#000",{callback:flashCallback},{scale:"showall",loop:"true",play:"true",pluginspage:"http://www.macromedia.com/go/getflashplayer",allowScriptAccess:"always",wmode:"window"});Core.Events.addEvent(this.layer.entity,this.stopEvent.bind2(this),"click");Core.Events.addEvent(this.layer.entity,this.hidden.bind2(this),"dblclick")}};Core.Class.extend(Editor.Tools.SetColor.prototype,Editor.Tools.OperateLayer.prototype,true);Core.Class.extend(Editor.Tools.Operate.prototype,{forecolor:function(){if(this.layers.fc){this.layers.show("fc")}else{this.layers.add("fc",new Editor.Tools.SetColor(this.editor,'<div id="#{entity}" class="colorItemContent"><div id="#{content}" class="colorItemTitle">颜色选取</div></div>',"setFontColor"));if(!this.documentClickObserver){this.documentClickObserver=new Editor.Utils.EventObserver(document,"click");this.documentMousedownObserver=new Editor.Utils.EventObserver(this.editor.iframeDocument,"mousedown");this.bodyClickObserver=new Editor.Utils.EventObserver(this.editor.iframeDocument.body,"click")}this.documentClickObserver.attach(this.layers.fc.hidden.bind2(this.layers.fc));this.documentMousedownObserver.attach(this.layers.fc.hidden.bind2(this.layers.fc));this.bodyClickObserver.attach(this.layers.fc.hidden.bind2(this.layers.fc));this.layers.show("fc")}},setFontColor:function(color){this.layers.fc.hidden();this.editor.execCommand("foreColor",color);if(this.editor.swapToolStatus){this.editor.swapToolStatus("forecolor")}}});function setFontColor(color){window.editor.operate.setFontColor(color)}Editor.Utils.IframeDialog=Core.Class.create();Editor.Utils.IframeDialog.prototype={dialog:null,num:0,initialize:function(option){this.id=Core.Math.getUniqueId();this.dialogContent="<iframe frameborder='0' id='iframeDialog_"+this.id+"' scrolling='no' style='width: #{width}px; height: #{height}px;' src=''></iframe>";this.option=option},initDialog:function(){this.num++;var contentHTML=new Ui.Template(this.dialogContent).evaluate(this.option);var obj={ad:false,drag:true,title:this.option.title,content:contentHTML,renderer:Ui.SimpleRenderer,width:this.option.width,height:this.option.height};if(this.option.dialogName&&this.option.dialogName=="imageDialog"){obj.tpl=this.getTpl()}var dialog=winDialog.createCustomsDialog(obj,this.option.dialogName+"_"+this.num||"");this.dialog=dialog;this.dialog.setAreaLocked(true);$E("iframeDialog_"+this.id).src=this.option.url;this.bindColseFunc()},getTpl:function(){var tplarray=['<table id="#{entity}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}">提示标题</strong>','<cite style="width:35px;">','<a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">',"</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"];return tplarray.join("")},reset:function(){if(this.dialog){this.hidden();var dialogParentNode=this.dialog.nodes.panel||this.dialog.nodes.entity;dialogParentNode.parentNode.removeChild(dialogParentNode);this.dialog=null}},bindColseFunc:function(){Core.Events.addEvent(this.dialog.nodes.btnClose,function(){editor.iframeWindow.focus()},"click")},setSize:function(nWidth,nHeight){var ele=this.dialog.nodes.content.firstChild;this.dialog.setSize({width:nWidth,height:nHeight});ele.style.width=nWidth+"px";ele.style.height=nHeight+"px"},show:function(){this.reset();this.initDialog();this.dialog.show();this.dialog.setMiddle()},hidden:function(){this.dialog.hidden()}};Core.Class.extend(Editor.Tools.Operate.prototype,{link:function(){var url="http://control.blog.sina.com.cn/admin/ria/article_addM_link.php";if(this.isDomain){url+="?domain=dom"}if(!window.linkDialog||!window.linkDialog.entity){window.linkDialog=new Editor.Utils.IframeDialog({url:url,title:"插入链接",width:300,height:150})}window.linkDialog.show()}});Core.Class.extend(Editor.Tools.Operate.prototype,{justifyleft:function(){this.editor.history.add();this.editor.execCommand("justifyleft")}});Core.Class.extend(Editor.Tools.Operate.prototype,{justifycenter:function(){this.editor.history.add();this.editor.execCommand("justifycenter")}});Core.Class.extend(Editor.Tools.Operate.prototype,{justifyright:function(){this.editor.history.add();this.editor.execCommand("justifyright")}});Core.Class.extend(Editor.Tools.Operate.prototype,{marklist:function(){this.editor.history.add();this.editor.execCommand("insertunorderedlist")}});Core.Class.extend(Editor.Tools.Operate.prototype,{numberlist:function(){this.editor.history.add();this.editor.execCommand("insertorderedlist")}});Core.Class.extend(Editor.Tools.Operate.prototype,{img:function(){if(!window.imageDialog){var url="http://control.blog.sina.com.cn/admin/ria/article_addM_image.php";if(this.ctg_id){url+="?ctg_id="+this.ctg_id}if(this.isDomain){url+="?domain"}window.imageDialog=new Editor.Utils.IframeDialog({url:url,title:"插入图片",width:660,height:450,dialogName:"imageDialog"});if(this.editor.initImageOpertae){this.editor.initImageOpertae()}}this.editor.blur();window.imageDialog.show()}});Core.Class.extend(Editor.Tools.Operate.prototype,{video:function(){if(!window.VideoDialog||!window.VideoDialog.entity){window.VideoDialog=new Editor.Utils.IframeDialog({url:"http://weibo.com/aj/video/upload?entry=blog",title:"插入视频",width:800,height:517,alpha:1});window.VideoDialog.show();window.insertVideoCallbackXHW=function(vid){var id="tmp_id"+ +new Date;editor.insertHTML("<img src='http://simg.sinajs.cn/blog7style/images/common/editor/insetvideo2.gif' width='482' height='388' id='"+id+"' vid='"+vid+"'/>",{id:id,properites:{vid:vid}});$E("is_media").value="true";VideoDialog.reset()}}}});if(typeof Editor.Plugins=="undefined"){Editor.Plugins={}}scope.faceOperate={container_id:"face_container",show_dia_id:"show_dialog_id",hot_container:"fd_hot_list",hot_in_container:"fd_hot_in_list",high_container:"fd_high_list",in_container:"fd_in_list",high_page_container:"fd_high_page",in_page_container:"fd_in_page",tab_container:"fd_tab",high_content:"fd_tab_high_con",in_content:"fd_tab_in_con",pop:"371",high:"372",iny:"373",morehigh:"374",moreiny:"375",logType:{pop:[17,18,19,20,21,22,23,24,25],
more:"26",tool:"27",dialog:"28"},highpage:55,inypage:8,inyCount:2,highCount:12,popCount:9,itemTemp:'<li><a href="#" onclick="scope.faceOperate.toEditor();return false"><img title="#{name}" src="#{imgSrc}"></a></li>',itemTemp_name:'<li onclick="scope.faceOperate.toEditor()">#{divStart}<span><img onmouseover="scope.faceOperate.onmouseIn()" onmouseout="scope.faceOperate.onmouseOut()" title="#{name}" src="#{imgSrc}"></span><p onmouseover="scope.faceOperate.onmouseIn()" onmouseout="scope.faceOperate.onmouseOut()">#{name}</p>#{divEnd}</li>',toEditor:function(){var ele=Core.Events.getEventTarget();var parent=this.getLiEle(ele);var txt;if($IE){txt=parent.innerText}else{txt=parent.textContent}var type=ele.tagName.toLowerCase();if(type!="img"){ele=parent.getElementsByTagName("img")[0]}this.sendLog(ele);var html="";if(txt==""){html='<img type="face" src="'+ele.src+'">'}else{html='<img type="face" src="'+ele.src+'">'+txt}editor.insertHTML(html);var dialog=winDialog.getDialog("face");if(dialog){dialog.hidden()}},sendLog:function(ele){var type="08_";var liEle=this.getLiEle(ele);var ulEle=liEle.parentNode;var reg=/.*\/(E[^\.]*).gif/gi;if(ulEle.id==this.container_id){var uls=ulEle.childNodes;var len=uls.length;for(var i=0;i<len;i++){if(liEle==uls[i]){type+=this.logType.pop[i];break}}}else{type+=this.logType.dialog}type+="_010_"+ele.src.replace(reg,"$1");v7sendLog(type,scope.$pageid,"editorFace")},renderList:function(container,_type,listType,_page){var it;var type=_type;var page=_page||1;if(listType&&listType=="name"){it=new Ui.Template(this.itemTemp_name)}else{it=new Ui.Template(this.itemTemp)}var html="",pageData;var _data=this.getData(type).data;var _len=_data.length;var max,data,len;switch(type){case"morehigh":var h_at=(page-1)*this.highpage;pageData=_data.slice(h_at,h_at+this.highpage);max=this.highpage;break;case"moreiny":var i_at=(page-1)*this.inypage;pageData=_data.slice(i_at,i_at+this.inypage);max=this.inypage;break;case"iny":pageData=_data.slice(0,this.inyCount);break;case"high":pageData=_data.slice(0,this.highCount);break;case"pop":pageData=_data.slice(0,this.popCount);break}data=pageData;len=data.length;if(!max){max=len}var at=0;for(var i=0;i<len;i++){var d={imgSrc:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/"+data[i].code+"G.gif",name:data[i].name};if(type=="moreiny"){d.divStart='<div class="facein_bg">';d.divEnd="</div>"}else{d.divStart="";d.divEnd=""}html+=it.evaluate(d);if(at>=max){break}at++}container.innerHTML=html},getData:function(type){trace("getData:type:"+type);return this.data[this[type]]},getLiEle:function(ele){while(true){var tagName=ele.tagName.toLowerCase();trace(tagName);if(tagName=="li"){return ele}ele=ele.parentNode}},onmouseIn:function(){var ele=Core.Events.getEventTarget();this.getLiEle(ele).className="hover"},onmouseOut:function(){var ele=Core.Events.getEventTarget();this.getLiEle(ele).className=""}};Core.Class.extend(Editor.Tools.Operate.prototype,{face:function(){v7sendLog("08_"+scope.faceOperate.logType.tool+"_000_000",scope.$pageid,"editorFace");window.editorFace.showDialog()}});Core.Class.extend(Editor.Tools.Operate.prototype,{justifyfull:function(){this.editor.history.add();var eBody=this.editor.iframeDocument.body;var eChilds=eBody.childNodes;for(var i=0;i<eChilds.length;i++){if(eChilds[i].tagName){eChilds[i].innerHTML=eChilds[i].innerHTML.split("&nbsp;").join("");eChilds[i].innerHTML=eChilds[i].innerHTML.replace(/(^[ |　|]*)|([ |　|]*$)/g,"");eChilds[i].innerHTML=eChilds[i].innerHTML.split("").join("&nbsp;");if(!eChilds[i].style.textIndent){eChilds[i].style.textIndent="2em"}else{eChilds[i].style.textIndent=""}}else{eBody.innerHTML='<div style="text-indent:2em;">'+eBody.innerHTML.replace(/(^[ |　]*)|([ |　]*$)/g,"");+"</div>"}if($IE)this.editor.iframeDocument.selection.createRange().collapse(false);this.editor.rangeCache.save()}}});Editor.Utils.EditorLayer=Core.Class.create();Editor.Utils.EditorLayer.prototype={initialize:function(){this.initLayer()},initLayer:function(){var template='<div id="#{entity}" class="editor_tip"><div id="#{content}">dd</div></div>';this.layer=new Ui.Panel;this.layer.setTemplate(template)},setContent:function(tip){var data={};(new Date).toLocaleString().replace(/[(^\s)*](\d*:\d*)/g,function(a,b){data.time=b});data.tip=tip||"";var template=new Ui.Template("<span>#{time}</span>#{tip}");this.layer.setContent(template.evaluate(data))},setPosition:function(){var ele=$E("SinaEditor_Iframe");var left=Core.Dom.getLeft(ele)+ele.offsetWidth-this.layer.entity.offsetWidth-43;var top=Core.Dom.getTop(ele);this.layer.setPosition({x:left,y:top})},hidden:function(){this.layer.hidden();this.isShow=false},show:function(){this.isShow=this.isShow||false;if(this.isShow){this.hidden()}else{this.layer.show();this.setPosition();this.isShow=true}}};Core.Class.extend(Editor.Tools.Operate.prototype,{quickpost:function(){if(this.editor.post){return}this.editor.post=true;this.editor.disabledToolItem("quickpost");if(!this.editor.tipLayer){this.editor.tipLayer=new Editor.Utils.EditorLayer}this.editor.tipLayer.setContent("博文保存中");this.editor.tipLayer.show();articlePostBtnFunc({callback:function(frmJson){this.editor.tipLayer.hidden();this.editor.tipLayer.setContent('<span>博文已经发表<span><a href="http://blog.sina.com.cn/s/blog_'+frmJson.data+'.html" target="_blank">[查看]</a>');this.editor.tipLayer.show();setTimeout(function(){this.editor.tipLayer.hidden()}.bind2(this),5e3)}.bind2(this),hiddenTip:function(){this.editor.tipLayer.hidden();this.editor.disabledToolItem("quickpost",true);this.editor.post=false}.bind2(this)})}});Core.Class.extend(Editor.Tools.Operate.prototype,{quicksave:function(){if(this.editor.isSaveing){return}this.editor.isSaveing=true;this.editor.disabledToolItem("quicksave");if(!this.editor.tipLayer){this.editor.tipLayer=new Editor.Utils.EditorLayer;this.editor.tipLayer.setContent("博文已经成功保存到草稿箱")}articlePosTempBtnFunc({callback:function(){this.editor.tipLayer.show();setTimeout(function(){this.editor.tipLayer.hidden()}.bind2(this),5e3)}.bind2(this),hiddenTip:function(){this.editor.tipLayer.hidden();this.editor.disabledToolItem("quicksave",true);this.editor.isSaveing=false}.bind2(this)})}});Core.Class.extend(Editor.Tools.Operate.prototype,{paste:function(){if($IE){this.editor.history.add();this.editor.execCommand("paste")}else{winDialog.alert("您的浏览器安全设置不允许使用粘贴操作，请使用快捷键(Cmd/Ctrl+V)来完成。",{icon:"01"})}}});Core.Class.extend(Editor.Tools.Operate.prototype,{cut:function(){this.editor.history.add();this.editor.execCommand("cut")}});Core.Class.extend(Editor.Tools.Operate.prototype,{copy:function(){this.editor.history.add();this.editor.execCommand("copy")}});Core.Class.extend(Editor.Tools.Operate.prototype,{redo:function(){if($IE){this.editor.history.redo()}else{this.editor.execCommand("redo")}}});Editor.Tools.FontFamily=Core.Class.create();Editor.Tools.FontFamily.prototype={initialize:function(editor,tamplate){this.stopEvent();this.editor=editor;this.layer=new Ui.Panel;this.layer.setTemplate(tamplate);this.initElement();this.setPosition()},initElement:function(){var fonts=["宋体","黑体","隶书","楷体_GB2312,楷体","幼圆","微软雅黑","Arial","Impact","Georgia","Verdana","Courier New","Times New Roman"];for(var i=0;i<fonts.length;i++){var a=$C("a");var family=fonts[i];var data={font:this.__getFont(fonts[i]),family:fonts[i]};var arr=family.split(",");if(arr.length>1){data.family=arr[1]}a.style.cssText="font-family:'"+data.font+"'";a.innerHTML=data.family;a.href="javascript:void(0);";a.onclick=function(){return false};a.className="fontItem";Core.Events.addEvent(a,this.exec.bind2(this),"click");this.layer.entity.appendChild(a)}},exec:function(){this.hidden();var ele=this.getEventElement();var familyName=this.__getFont(ele.innerHTML);this.editor.iframeWindow.focus();if($IE){this.editor.selectRange();this.editor.execCommand("fontname","SinaEditor_Temp_FontName","");var fonts=this.editor.iframeDocument.body.getElementsByTagName("font");var fontsLen=fonts.length;var fontNode=null;for(var i=0;i<fontsLen;i++){fontNode=fonts[i];if(fontNode.getAttribute("face")=="SinaEditor_Temp_FontName"){Core.Dom.setStyle(fontNode,"fontFamily",familyName);fontNode.removeAttribute("face")}}}else{this.editor.execCommand("fontname",familyName,false)}if(this.editor.swapToolStatus){this.editor.swapToolStatus("family")}this.editor.iframeWindow.focus()},__getFont:function(name){var font="";switch(name){case"宋体":font="SimSun";break;case"微软雅黑":font="Microsoft YaHei";break;case"楷体":font="楷体_GB2312,楷体";break;default:font=name}return font}};Core.Class.extend(Editor.Tools.FontFamily.prototype,Editor.Tools.OperateLayer.prototype,true);Core.Class.extend(Editor.Tools.Operate.prototype,{family:function(){if(this.layers.f){this.layers.show("f")}else{this.layers.add("f",new Editor.Tools.FontFamily(this.editor,'<div id="#{entity}" class="fontItemContent"><div id="#{content}" class="fontItemTitle">字体</div></div>'));if(!this.documentClickObserver){this.documentClickObserver=new Editor.Utils.EventObserver(document,"click");this.documentMousedownObserver=new Editor.Utils.EventObserver(this.editor.iframeDocument,"mousedown");this.bodyClickObserver=new Editor.Utils.EventObserver(this.editor.iframeDocument.body,"click")}this.documentClickObserver.attach(this.layers.f.hidden.bind2(this.layers.f));this.documentMousedownObserver.attach(this.layers.f.hidden.bind2(this.layers.f));this.bodyClickObserver.attach(this.layers.f.hidden.bind2(this.layers.f));this.layers.show("f")}}});Core.Class.extend(Editor.Tools.Operate.prototype,{hilitecolor:function(){if(this.layers.hc){this.layers.show("hc")}else{this.layers.add("hc",new Editor.Tools.SetColor(this.editor,'<div id="#{entity}" class="colorItemContent"><div id="#{content}" class="colorItemTitle">颜色选取</div></div>',"setBackgroundColor"));if(!this.documentClickObserver){this.documentClickObserver=new Editor.Utils.EventObserver(document,"click");this.documentMousedownObserver=new Editor.Utils.EventObserver(this.editor.iframeDocument,"mousedown");this.bodyClickObserver=new Editor.Utils.EventObserver(this.editor.iframeDocument.body,"click")}this.documentClickObserver.attach(this.layers.hc.hidden.bind2(this.layers.hc));this.documentMousedownObserver.attach(this.layers.hc.hidden.bind2(this.layers.hc));this.bodyClickObserver.attach(this.layers.hc.hidden.bind2(this.layers.hc));this.layers.show("hc")}},setBackgroundColor:function(color){this.layers.hc.hidden();if($IE){this.editor.execCommand("backcolor",color)}else{this.editor.execCommand("hiliteColor",color)}this.editor.swapToolStatus("hilitecolor")}});function setBackgroundColor(color){window.editor.operate.setBackgroundColor(color)}Core.Class.extend(Editor.Tools.Operate.prototype,{outdent:function(){this.editor.history.add();this.editor.execCommand("outdent")}});Core.Class.extend(Editor.Tools.Operate.prototype,{indent:function(){this.editor.history.add();this.editor.execCommand("indent")}});Core.Class.extend(Editor.Tools.Operate.prototype,{imgdefault:function(){var elm=this.editor.getFocusElement();if(elm.tagName.toLowerCase()=="img"){elm.removeAttribute("align");Core.Dom.setStyle(elm,"display","");Core.Dom.setStyle(elm,"margin","");Core.Dom.setStyle(elm,"textAlign","")}}});Core.Class.extend(Editor.Tools.Operate.prototype,{imgtop:function(){var elm=this.editor.getFocusElement();if(elm.tagName.toLowerCase()=="img"){elm.removeAttribute("align");Core.Dom.setStyle(elm,"display","block");Core.Dom.setStyle(elm,"margin","0 auto");Core.Dom.setStyle(elm,"textAlign","center")}}});Core.Class.extend(Editor.Tools.Operate.prototype,{imgleft:function(){var elm=this.editor.getFocusElement();if(elm.tagName.toLowerCase()=="img"){elm.setAttribute("align","left");Core.Dom.setStyle(elm,"display","");Core.Dom.setStyle(elm,"margin","");Core.Dom.setStyle(elm,"textAlign","")}}});Core.Class.extend(Editor.Tools.Operate.prototype,{imgright:function(){var elm=this.editor.getFocusElement();if(elm.tagName.toLowerCase()=="img"){elm.setAttribute("align","right");Core.Dom.setStyle(elm,"display","");Core.Dom.setStyle(elm,"margin","");Core.Dom.setStyle(elm,"textAlign","")}}});Core.Class.extend(Editor.Tools.Operate.prototype,{table:function(){if(!window.tableDialog||!window.tableDialog.entity)window.tableDialog=new Editor.Utils.IframeDialog({url:"http://control.blog.sina.com.cn/admin/ria/article_addM_table.html",title:"插入表格",width:311,height:256});window.tableDialog.show()}});Editor.Utils.CacheIframe=Core.Class.create();Editor.Utils.CacheIframe.prototype={initialize:function(iframeUrl){this.id=Core.Math.getUniqueId();this.initHtml();if(iframeUrl&&iframeUrl!=""){this.setUrl(iframeUrl)}},initHtml:function(){var html='<iframe id="cache_iframe_#{id}" style="visibility: hidden; position: absolute; top: -1000px; left: -1000px;"></iframe>';var temp=new Ui.Template(html);Core.Dom.addHTML(document.body,temp.evaluate({id:this.id}))},setUrl:function(iframeUrl){$E("cache_iframe_"+this.id).src=iframeUrl},get:function(){return $E("cache_iframe_"+this.id)}};var $SYSMSG={};$SYSMSG.extend=function(info,override){for(var i in info){$SYSMSG[i]=!!override==false?info[i]:$SYSMSG[i]}};$SYSMSG.extend({B01001:"标题必须是48个中文或96个字符以内，请重新输入。",B02001:"请输入内容。",B02002:"博文内容超过容量限制，请重新编辑。 <br/><span style='font-size: 12px; font-weight: normal;'>博文内容最多允许1万汉字，2万字符。</span>",B02003:"是否要清除格式？粘帖的内容中含有冗余的格式，会影响在博客中的排版。",B02004:"上次撰写的博文未进行保存，要恢复内容继续编辑吗？",B02005:'您提交的内容中含有广告等不适当内容，"确认"后将被清除！',B03001:"标签总字数必须是30个中文或60个字符以内，请重新输入。",B03002:"标签个数必须是5个以内，请重新输入。",B03003:"每个标签字数必须是7个中文或14个字符以内，请重新输入。",B03105:"无法提取到有效标签，请手动输入些标签：如“体育、生活”。",B03106:"博文内容必须大于20个中文或40个字符，才能提取有效标签。",B03107:"博文内容必须大于20个中文或40个字符，才能提取有效标签。",B04001:"发布时间不能超出当前时间，请重新输入。",B04002:"抱歉,请选择“我记录”活动投稿类别。",B04022:"标签总字数必须是30个中文或60个字符以内，请重新输入。",B06001:"博文已发布成功。",B06011:"博文已发布成功。",B06012:"博文已发布成功。",B06002:"博文已发布，稍后显示，请耐心等待一下。",B06003:"博文已成功保存到草稿箱。",B06004:"您的博文已经发表成功，目前已经进入后台审核中。审核时间为12小时，请耐心等候。",B07001:"博文发布失败，请梢后再试。建议先将内容拷贝到本地硬盘备份。",B07003:"博文保存失败，请梢后再试。建议先将内容拷贝到本地硬盘备份。",B07004:"博文保存失败，请梢后再试。建议先将内容拷贝到本地硬盘备份。",B07005:"您短时间发表文章过多，请稍后再试",B08001:"不能一分钟内连续发博文，请稍后再试。",B08002:"发布中，请稍候…",B08003:"保存中，请稍候…",B08004:"由于网络原因上传失败，请稍后再试。或者尝试使用<a href='http://photo.blog.sina.com.cn/upload/upload_html.php'>旧版网页上传</a>。",B08005:"由于网络原因上传失败，请稍后再试。",B36101:"文章不存在",B78001:"选择已达相关博文上限！请删除一些再勾选",B79001:'音乐地址要求是mp3格式，请重新输入！或者直接去<a onclick="scope.musicOperate.showStore();return false;" href="#">新浪乐库</a>中搜索。',B79002:'音乐地址要求以http://开始，请重新输入！或者直接去<a onclick="scope.musicOperate.showStore();return false;" href="#">新浪乐库</a>中搜索。',B79003:"是否要删除背景音乐？",B79004:"是否要删除相关博文？",B79005:"在模板中只能插入一张图片。",B79006:"每次最多只能插入20张图片。<br/>请先完成图片添加，再插入新图片",B79007:"<strong>此分类尚无博文，请选择其他分类</strong>",B79008:"<strong>尚无博文</strong>",B79009:"是否要删除推荐活动？",B89001:"请输入文章内容。",B89002:"正文内空转码失败。",B89003:"服务分析出错。",B89004:"没有找到匹配的歌曲名。",B89005:"为了保证您的博文打开速度，每篇博文最多只能插入3个音乐播放器。",B89006:"每个播放器最多只能添加20首歌",B89007:"歌曲已成功添加！<br/>但添加至上一个播放器，仅在当本博文中已有播放器时适用。",B89008:"歌曲已成功添加！<br/>但插入歌词功能仅在插入单首歌曲时可用。",B89009:"请输入搜索内容",B89011:"抱歉，您还没有选择音乐，请至少选择一首。",B89012:'博文中无可识别的歌曲名。<br/><span style="color:#999">帮助：此功能会根据您输入的博文内容，自动识别出您博文内容中出现的歌曲名，并为此歌曲名匹配相应试听链接，浏览者即可一键轻松试听您博文中的音乐。</span>',B89013:"已成功添加至上一个播放器中！",B79010:"请在图片上传完成后再进行添加。",A00200:"您输入的内容包含非法字符"});Editor.Utils.FormatDoc=Core.Class.create();Editor.Utils.FormatDoc.prototype={reg:/<\w[^>]* class="?(MsoNormal)|(MsoTitle)"?/gi,initialize:function(documentElement,editor){this.editor=editor;this.cache=new Editor.Utils.CacheIframe(this.editor.iframeUrl);documentElement.body.onbeforepaste=function(){this.operate()}.bind2(this)},format:function(html){html=html.replace(/<\/?SPAN[^>]*>/gi,"");html=html.replace(/<(\w[^>]*) class=([^ |>]*)([^>]*)/gi,"<$1$3");html=html.replace(/<(\w[^>]*) style="([^"]*)"([^>]*)/gi,"<$1$3");html=html.replace(/<(\w[^>]*) lang=([^ |>]*)([^>]*)/gi,"<$1$3");html=html.replace(/<\\?\?xml[^>]*>/gi,"");html=html.replace(/<\/?\w+:[^>]*>/gi,"");html=html.replace(/<img+.[^>]*>/gi,"");return html},getPasteData:function(){var tif=this.cache.get();tlf=tif.contentWindow.document;tlf.body.innerHTML="";if(!tlf.body.createTextRange){return""}tlf.body.createTextRange().execCommand("Paste");var html=tlf.body.innerHTML;var len=html.indexOf("&nbsp;");if(len==0){html=html.replace(/\&nbsp;/i,"")}var htmlData=html;tlf.body.innerHTML="";return htmlData},isDoc:function(str){str=str||this.getPasteData();return this.reg.test(str)},operate:function(){var data=this.getPasteData();if(this.isDoc(data)){clipboardData.setData("text","");winDialog.confirm($SYSMSG["B02003"],{funcOk:function(){data=this.format(data);this.editor.insertHTML(data)}.bind2(this),funcCancel:function(){data=data.replace(/<img+.[^>]*>/gi,"");data=data.replace(/<\/?\w+:imagedata[^>]*>/gi,"");data=data.replace(/<\/?\w+:shape[^>]*>/gi,"");this.editor.insertHTML(data)}.bind2(this),textOk:"是",textCancel:"否",defaultButton:1,title:"提示",icon:"03"})}}};$SYSMSG.extend({B88001:"备孕宝贝时间出错",B88002:"宝贝预产期错误",B88003:"宝贝昵称 字符过长",B88004:"宝贝昵称  为空",B88005:"宝宝昵称 非法",B88006:"宝贝性别 有误",B88007:"宝贝生日  有误",B88008:"系统异常"});Editor.BlogEditor=Core.Class.create();Editor.BlogEditor.prototype={baseTools:null,proTools:null,type:"blogEditor",toolType:"base",initialize:function(option){if(!option||!option.iframe_container){return}this._focusElementId=option.focusElementId;this._addOperateToOnload(this.addEventsToBody.bind2(this));this._addOperateToOnload(this.addEventsToDocument.bind2(this));this._addOperateToOnload(this.initToosStatus.bind2(this));this._addOperateToOnload(function(){this.formatDoc=new Editor.Utils.FormatDoc(this.iframeDocument,this)}.bind2(this));this.initTextArea($E(option.textarea));this._initIframe($E(option.iframe_container),option.iframe_cls);this.operate=new Editor.Tools.Operate(this);this.history=new Editor.Utils.EditorHistory(this,50);this.rangeCache=new Editor.Utils.RangeCache(this);this.initTool();this.initModeSwap(option.checkbox);this.initHeightModeSwap(option.heightModeId);if(option.mode!="edit"){this.swapMode()}this.swapTools(option.toolType);this.imageOperate=new Editor.Utils.ImageOperate;this.userData=new Utils.UserData;var _this=this;Core.Events.addEvent(window,function(){_this.baseTools.setShutOutProperty(_this.baseTools.container.parentNode);_this.proTools.setShutOutProperty(_this.proTools.container.parentNode)},"resize");if(option.checkbox){var checkboxObj=$E(option.checkbox);if(checkboxObj){checkboxObj.checked=false}}},redoData:function(){var redo_data=this.userData.load("blog_user_data_"+scope.$uid,["content"]);if(redo_data&&redo_data.content&&redo_data.content!=""){if(scope.$user_channel&&parseInt(scope.$user_channel)===2){this.userData.clear("blog_user_data_"+scope.$uid,["content"]);return}winDialog.confirm($SYSMSG["B02004"],{funcOk:function(){this.iframeDocument.body.innerHTML=redo_data.content;this.userData["blog_user_data_"+scope.$uid]=true;this.userData.clear("blog_user_data_"+scope.$uid,["content"])}.bind2(this),textOk:"是",textCancel:"否",funcCancel:function(){this.userData.clear("blog_user_data_"+scope.$uid,["content"])}.bind2(this),defaultButton:1,title:"提示",icon:"04"})}},initTool:function(){var classTemplate="ico_#{operate}_#{num}";var baseToolConfig={classTemplate:classTemplate,tools:{undo:{title:"撤销（Ctrl+Z）"},bold:{title:"加粗"},italic:{title:"斜体"},underline:{title:"下划线"},fontsize:{title:"字号",inner:"<div>14px</div>"},forecolor:{title:"文字颜色",style:"background-color:#000;"},link:{title:"插入链接"},justifyleft:{title:"左对齐"},justifycenter:{title:"居中对齐"},justifyright:{title:"右对齐"},marklist:{title:"项目符号"},numberlist:{title:"编号"},img:{title:"插入图片"},video:{title:"插入视频"},face:{title:"插入表情"},justifyfull:{title:"自动排版"},quicksave:{title:"快速保存（Ctrl+S）",style:"display:none"},quickpost:{title:"快速发表",style:"display:none"}}};var proToolConfig={classTemplate:classTemplate,tools:{group_1:{cls:"ctl_grp",items:{paste:{title:"粘贴（Ctrl+V）"},cut:{title:"剪切（Ctrl+X）"},copy:{title:"复制（Ctrl+C）"}}},group_2:{cls:"undo_grp",items:{redo:{title:"重做（Ctrl+Y）"},undo:{title:"撤销（Ctrl+Z）"}}},group_3:{cls:"font_grp",items:{family:{title:"字体",inner:" <div>"+(scope.$newFontFamily?"微软雅黑":"宋体")+"</div>"},fontsize:{title:"字号",inner:"<div>14px</div>"},bold:{title:"加粗"},italic:{title:"斜体"},underline:{title:"下划线"},forecolor:{title:"文字颜色",style:"background-color:#000;"},hilitecolor:{title:"背景颜色",style:"background-color:#fff;"},link:{title:"插入链接"}}},group_4:{cls:"format_grp",items:{marklist:{title:"项目符号"},numberlist:{title:"编号"},outdent:{title:"减少缩进"},indent:{title:"增加缩进"},imgdefault:{title:"默认排版"},imgtop:{title:"图片居中排版"},justifyleft:{title:"左对齐"},justifycenter:{title:"居中对齐"},justifyright:{title:"右对齐"},space:{title:""},imgleft:{title:"图片居左混排"},imgright:{title:"图片居右混排"}}},group_5:{cls:"media_grp",items:{img:{title:"插入图片"},video:{title:"插入视频"},face:{title:"插入表情"},table:{title:"插入表格"}}},group_6:{cls:"ext_grp",items:{justifyfull:{title:"自动排版"}}},group_7:{cls:"ext_grp",items:{quickpost:{title:"快速发表",style:"display:none"},quicksave:{title:"快速保存（Ctrl+S）",style:"display:none"}}}}};this.baseTools=new Editor.Tools.Tool("base_tools",baseToolConfig);this.proTools=new Editor.Tools.Tool("pro_tools",proToolConfig);this.baseTools.setOperate(this.operate);this.baseTools.initElements();this.proTools.setOperate(this.operate);this.proTools.initElements();var bind=Core.Function.bind3;Core.Events.addEvent("SinaEditor_Baselink",bind(this.swapTools,this,["base"]));Core.Events.addEvent("SinaEditor_Prolink",bind(this.swapTools,this,["pro"]))},swapShutOut:function(type){if(this.toolType=="base"){if(type=="edit"){this.baseTools.setShutOutProperty();this.baseTools.shutOut.show()}else{this.baseTools.shutOut.hidden()}}else{if(type=="edit"){this.proTools.setShutOutProperty();this.proTools.shutOut.show()}else{this.proTools.shutOut.hidden()}}if(!this.rightMenuShutOut){this.rightMenuShutOut=new Editor.Utils.ShutOut;this.rightMenuShutOut.setProperty($E("editor_box_right"));Core.Events.addEvent(window,function(){this.rightMenuShutOut.setProperty($E("editor_box_right"))}.bind2(this),"resize")}if(type=="edit"){this.rightMenuShutOut.setProperty($E("editor_box_right"));this.rightMenuShutOut.show()}else{this.rightMenuShutOut.hidden()}},getToolElement:function(toolType,operateType){var id;if(toolType=="base"){id=this.baseTools.id}else{id=this.proTools.id}return $E(operateType+"_"+id)},initToosStatus:function(){var i=0;var clearId=setInterval(function(){if(this.baseTools&&this.proTools){this.baseToolStatus=new Editor.Tools.Status(this.baseTools.id,this,["bold","italic","underline","fontsize"]);this.preToolStatus=new Editor.Tools.Status(this.proTools.id,this);Core.Events.addEvent(this.iframeDocument.body,this.baseToolStatus.checkAllStatus.bind2(this.baseToolStatus),"mouseup");Core.Events.addEvent(this.iframeDocument.body,this.preToolStatus.checkAllStatus.bind2(this.preToolStatus),"mouseup");clearInterval(clearId)}}.bind2(this),50)},swapToolStatus:function(type,color){if(this.toolType=="base"){this.baseToolStatus.setToolItemStatus(type,color)}else{this.preToolStatus.setToolItemStatus(type,color)}},initModeSwap:function(checkbox){var ele=$E(checkbox);if(ele.disabled){ele.disabled=false}Core.Events.addEvent(checkbox,this.swapMode.bind2(this),"click")},initHeightModeSwap:function(heightEle){Core.Events.addEvent(heightEle,this.swapHightMode.bind2(this),"click")},addEventsToBody:function(){Core.Events.addEvent(this.iframeDocument.body,this.rangeCache.save.bind2(this.rangeCache),"mouseup")},addEventsToDocument:function(){var saveStatusTimer;Core.Events.addEvent(this.iframeDocument,function(){this.closeConfirm();clearTimeout(saveStatusTimer);saveStatusTimer=setTimeout(function(){this.rangeCache.save()}.bind2(this),500)}.bind2(this),"mouseup");Core.Events.addEvent(this.iframeDocument,function(e){this.closeConfirm();if(e.keyCode==83&&e.ctrlKey){if(!$IE){Core.Events.stopEvent()}if(this.saveType){this.operate[this.saveType]()}return}if(e.ctrlKey&&e.keyCode==90){if($IE){this.operate.undo()}return}if(e.ctrlKey&&e.keyCode==89){if($IE){this.operate.redo()}return}this.imageOperate.hidden()}.bind2(this),"keyup");var saveTimer;Core.Events.addEvent(this.iframeDocument,function(e){if(e.ctrlKey&&e.keyCode==90||e.ctrlKey){return}if(!this.initUserData){this.initUserData=true;setInterval(function(){if(this.iframeDocument.body.innerHTML.length<4e4){this.userData.save("blog_user_data_"+scope.$uid,{content:this.iframeDocument.body.innerHTML})}}.bind2(this),6e4)}clearTimeout(saveTimer);saveTimer=setTimeout(function(){this.history.add();this.rangeCache.save()}.bind2(this),500)}.bind2(this),"keydown");if($IE){Core.Events.addEvent(this.iframeWindow,hiddenOperate.bind2(this),"scroll")}else{Core.Events.addEvent(this.iframeDocument,hiddenOperate.bind2(this),"scroll")}function hiddenOperate(){if(!this.op_hidden&&this.imageOperate.isShow){setTimeout(function(){this.imageOperate.hidden();this.op_hidden=false}.bind2(this),1e3);this.op_hidden=true}}},initImageOpertae:function(){if(!this.isInitImageOpertae){if(!this.iframeDocument){return}Core.Events.addEvent(this.iframeDocument.body,function(el){var _target=el.target||el.srcElement;if(_target.tagName.toLowerCase()=="img"){if(!this.imageDrag){this.imageDrag=new Editor.Utils.ImageDrag(this)}else{this.imageDrag.drag(el)}}}.bind2(this),"mousedown");Core.Events.addEvent(this.iframeDocument.body,function(el){var _target=el.target||el.srcElement;if(_target.tagName.toLowerCase()=="img"){if(_target.name.split("_")[0]!="articleTemplate"){editor.templateImageId=_target.id="image_operate_"+Core.Math.getUniqueId();this.imageOperate.show(_target)}}else{this.imageOperate.hidden()}}.bind2(this),"mousemove");this.isInitImageOpertae=true}},initTemplateImage:function(){this.initImageOpertae();if(!this.isInitTemplateImage){if(!this.iframeDocument){return}Core.Events.addEvent(this.iframeDocument.body,function(el){var _target=el.target||el.srcElement;if(_target.tagName.toLowerCase()=="img"){if(!this.imageDrag){this.imageDrag=new Editor.Utils.ImageDrag(this)}else{this.imageDrag.drag(el)}if(_target.name.split("_")[0]=="articleTemplate"){_target.id=_target.name}if(_target.id.split("_")[0]=="articleTemplate"){editor.templateImageId=_target.id;el.cancelBubble=true;el.returnValue=false;if(!window.templateDialog)window.templateDialog=new Editor.Utils.IframeDialog({url:"http://control.blog.sina.com.cn/admin/ria/article_addM_image.php?type=1",title:"插入图片",width:660,height:450,dialogName:"templateDialog"});window.templateDialog.show()}}}.bind2(this),"dblclick");this.isInitTemplateImage=true}},swapTools:function(type){if(type=="pro"){this.baseTools.hidden();this.proTools.show();Utils.Cookie.setCookie("EditorToolType","pro");this.toolType="pro"}else{this.proTools.hidden();this.baseTools.show();Utils.Cookie.setCookie("EditorToolType","base");this.toolType="base"}},disabledToolItem:function(item,isTrue){if(!isTrue){this.proTools.setButtonState(item,4);this.baseTools.setButtonState(item,4)}else{this.proTools.setButtonState(item,1);this.baseTools.setButtonState(item,1)}},setSourceValue:function(){if(this.modeType=="edit"){this.frameToArea();this.textarea.value=this.iframeDocument.body.innerHTML.replace(/title="?双击图片可进行替换"?/gi,"")}else{}},swapHightMode:function(){var isHeight=false;var right_box=$E("editor_box_right");var iClassName=this.iframe.className;var tClassName=this.textarea.className;var rbClassName=right_box.className;var icn_array=iClassName.split("_");var tcn_array=tClassName.split("_");var rbcn_array=rbClassName.split(" ");var ele=Core.Events.getEventTarget();if(icn_array.length>1&&icn_array[icn_array.length-1]=="h"){isHeight=true}if(isHeight){icn_array.pop();tcn_array.pop();rbcn_array.pop();this.iframe.className=icn_array.join("_");this.textarea.className=tcn_array.join("_");right_box.className=rbcn_array.join(" ");ele.innerHTML="扩大编辑区域 "}else{this.iframe.className=iClassName+"_h";this.textarea.className=tClassName+"_h";right_box.className=rbClassName+" EditorBoxRight_h";ele.innerHTML="缩小编辑区域 "}if(this.rightMenuShutOut){var ele=$E("editor_box_right");this.rightMenuShutOut.setSize(ele.offsetWidth,ele.offsetHeight)}},checkStock:function(){var value=0;if(/stock_image_\d{15,25}/g.test(this.iframeDocument.body.innerHTML)){value=1}return value},getMediaTag:function(){var imgs=this.iframeDocument.getElementsByTagName("img");var lens=imgs.length;var facepath="http://simg.sinajs.cn/blog/images/face/";var d_face="sina.com.cn/myshow/blog/misc/gif/";var worldcup="simg.sinajs.cn/blog7style/images/common/worldcup";var sg_trans="simg.sinajs.cn/blog7style/images/common/sg_trans.gif";var facepathlen=facepath.length;var isIMG=0;var isMedia=0;for(var i=0;i<lens&&isIMG==false;i++){if(imgs[i].src.indexOf(worldcup)==-1&&imgs[i].src.indexOf(d_face)==-1&&imgs[i].src.substr(0,facepathlen)!=facepath&&imgs[i].src!="http://simg.sinajs.cn/blog7style/images/common/editor/insetvideo.gif"&&imgs[i].src.indexOf(sg_trans)==-1){if(!imgs[i].getAttribute("type")&&imgs[i].getAttribute("type")!="face"){isIMG=1}}if(imgs[i].src=="http://simg.sinajs.cn/blog7style/images/common/editor/insetvideo.gif"){isMedia=1}}var objs=this.iframeDocument.getElementsByTagName("object");if(objs.length>0)isMedia=1;var objs=this.iframeDocument.getElementsByTagName("embed");if(objs.length>0)isMedia=1;return[isIMG,isMedia]},closeConfirm:function(){if(!this.isCloseConfirm){this.isCloseConfirm=true}},_setEditorHTML:function(sContent){var html="";html+="<html>";html+="<head>";html+='<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />';html+="<style>";html+="p {*margin:0.2em auto;}";html+="body {\r\n			margin: 0;\r\n			scrollbar-face-color: #ffffff;\r\n			scrollbar-highlight-color: #ffffff;\r\n			scrollbar-shadow-color: #c0c1bb;\r\n			scrollbar-3dlight-color: #c0c1bb;\r\n			scrollbar-arrow-color: #c9cbb6;\r\n			scrollbar-track-color: #f4f5f0;\r\n			scrollbar-darkshadow-color: #ffffff;\r\n			scrollbar-base-color: #ffffff;\r\n			padding: 10px;\r\n			word-wrap: break-word;\r\n			overflow: scroll;\r\n			overflow-x: auto;\r\n			height: 90%;\r\n			font-size: 14px;\r\n		}";html+="body, td, textarea, input, br, div, span{";html+="	font-family: "+(scope.$newFontFamily?"'Microsoft YaHei',":"")+"'SimSun', Verdana,Arial, Helvetica, sans-serif;";html+="	line-height:1.5;";html+="}";html+="img{\r\n			border: 0;\r\n		}\r\n		html{\r\n			height: 100%;\r\n			cursor: text;\r\n		}\r\n		pre{\r\n			white-space:normal;\r\n		}\r\n		ins{\r\n			width:0px;\r\n			height:0px;\r\n			overflow:hidden;\r\n			position:absolute;\r\n		}\r\n		form{margin: 0;}\r\n		body table{font-size: 14px;}\r\n		.border{ border:1px dashed #cfcfcf;}\r\n		</style>";html+="</head>";html+="<body>";html+=sContent;html+="</body>";html+="</html>";return html}};Core.Class.extend(Editor.BlogEditor.prototype,Editor.AbstractStandard.prototype,true);$registJob("editor",function(){var option={iframe_container:"SinaEditor_Iframe",iframe_cls:"iframe",textarea:"SinaEditorTextarea",checkbox:"SinaEditor_59_viewcodecheckbox",heightModeId:"height_mode"};window.editor=new BlogEditor(option)});Core.Dom.insertHTML=function(el,html,where){el=$E(el)||document.body;where=where.toLowerCase()||"beforeend";if(el.insertAdjacentHTML){switch(where){case"beforebegin":el.insertAdjacentHTML("BeforeBegin",html);return el.previousSibling;case"afterbegin":el.insertAdjacentHTML("AfterBegin",html);return el.firstChild;case"beforeend":el.insertAdjacentHTML("BeforeEnd",html);return el.lastChild;case"afterend":el.insertAdjacentHTML("AfterEnd",html);return el.nextSibling}throw'Illegal insertion point -> "'+where+'"'}var range=el.ownerDocument.createRange();var frag;switch(where){case"beforebegin":range.setStartBefore(el);frag=range.createContextualFragment(html);el.parentNode.insertBefore(frag,el);return el.previousSibling;case"afterbegin":if(el.firstChild){range.setStartBefore(el.firstChild);frag=range.createContextualFragment(html);el.insertBefore(frag,el.firstChild);return el.firstChild}else{el.innerHTML=html;return el.firstChild}break;case"beforeend":if(el.lastChild){range.setStartAfter(el.lastChild);frag=range.createContextualFragment(html);el.appendChild(frag);return el.lastChild}else{el.innerHTML=html;return el.lastChild}break;case"afterend":range.setStartAfter(el);frag=range.createContextualFragment(html);el.parentNode.insertBefore(frag,el.nextSibling);return el.nextSibling}throw'Illegal insertion point -> "'+where+'"';

};if(document.documentElement.contains){Core.Dom.contains=function(oParentNode,oNode){return oParentNode.contains?oParentNode.contains(oNode):true}}else if(document.documentElement.compareDocumentPosition){Core.Dom.contains=function(oParentNode,oNode){return oParentNode===oNode||!!(oParentNode.compareDocumentPosition(oNode)&16)}}else{Core.Dom.contains=function(oParentNode,oNode){while(oNode){if(oParentNode===oNode){return true}oNode=oNode.parentNode}return false}}Core.Dom.getElementsByClass=function(el,tg,clz){el=el||document;var rs=[];clz=" "+clz+" ";var cldr=el.getElementsByTagName(tg),len=cldr.length;for(var i=0;i<len;++i){var o=cldr[i];if(o.nodeType==1){var ecl=" "+o.className+" ";if(ecl.indexOf(clz)!=-1){rs[rs.length]=o}}}return rs};Core.Dom.byClz=Core.Dom.getElementsByClass;Core.String.encodeHTML=function(str){var div=document.createElement("div");div.appendChild(document.createTextNode(str));return div.innerHTML.replace(/\s/g,"&nbsp;")};Utils.Io.Ajax={createRequest:function(){var request=null;try{request=new XMLHttpRequest}catch(trymicrosoft){try{request=new ActiveXObject("Msxml2.XMLHTTP")}catch(othermicrosoft){try{request=ActiveXObject("Microsoft.XMLHTTP")}catch(failed){}}}if(request==null){}else{return request}},request:function(url,option){option=option||{};option.onComplete=option.onComplete||function(){};option.onException=option.onException||function(){};option.returnType=option.returnType||"txt";option.method=option.method||"get";option.data=option.data||{};if(typeof option.GET!="undefined"&&typeof option.GET.url_random!="undefined"&&option.GET.url_random==0){this.rand=false;option.GET.url_random=null}return this.loadData(url,option)},loadData:function(url,option){var request=this.createRequest(),tmpArr=[];var _url=new Utils.Url(url);if(option.POST){for(var postkey in option.POST){var postvalue=option.POST[postkey];if(postvalue!=null){tmpArr.push(postkey+"="+Core.String.encodeDoubleByte(postvalue))}}}var sParameter=tmpArr.join("&")||"";if(option.GET){for(var key in option.GET){if(key!="url_random"){_url.setParam(key,Core.String.encodeDoubleByte(option.GET[key]))}}}if(this.rand!=false){}request.onreadystatechange=function(){if(request.readyState==4){var response,type=option.returnType;try{switch(type){case"txt":response=request.responseText;break;case"xml":if($IE){response=request.responseXML}else{var Dparser=new DOMParser;response=Dparser.parseFromString(request.responseText,"text/xml")}break;case"json":response=eval("("+request.responseText+")");break}option.onComplete(response)}catch(e){option.onException(e.message,_url);return false}}};try{if(option.POST){request.open("POST",_url,true);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");request.send(sParameter)}else{request.open("GET",_url,true);request.send(null)}}catch(e){option.onException(e.message,_url);return false}return request}};function TagsAddNew(tInputContiner,tInput,tTags){var __addEvent=Core.Events.addEvent;var returnObject={};var splitChar=[",","，"];var rBLANK=/\s/,rNOTAZ=/[^a-z]$/;function createTag(str,opt){str=str.replace(/[,，\s]/g,"");if(str===""){return}str=Core.String.encodeHTML(str);str=substr(str,20);var spans=tInputContiner.getElementsByTagName("div");if(spans.length>4){tInput.value="";tInput.blur();(!opt||!opt.notip)&&winDialog.alert("最多输入5个标签",{icon:"01"});return}if((","+tTags.value+",").indexOf(","+str+",")>-1){tInput.value="";return}opt=opt||{};opt.deleteAble=typeof opt.deleteAble=="boolean"?opt.deleteAble:true;var sp=document.createElement("div"),deleteBtn="";deleteBtn=opt.deleteAble!=false?'<a onclick="return false" href="javascript:;" title="删除">×</a>':"";if(opt.deleteAble!==false)sp.setAttribute("deleteAble","true");else sp.setAttribute("deleteAble","false");sp.innerHTML=str+deleteBtn;sp.className=opt.className||"tag_tx";var tagsElArray=$T(tInputContiner,"div");if(null!=opt.insertIndex&&tagsElArray.length-1>opt.insertIndex){tInputContiner.insertBefore(sp,tagsElArray[opt.insertIndex])}else{tInputContiner.insertBefore(sp,tInput);var firstChild=tInputContiner.children[0];if(firstChild&&"EM"==firstChild.nodeName.toUpperCase()){tInputContiner.removeChild(firstChild)}}setTagInputValue();return true}function removeTag(tagName,deleteAble){var tagEls=tInputContiner.getElementsByTagName("div");var removeEl,i=0,len=tagEls.length,txt,tag;var reg=/([^×]+)(×)*$/;if(deleteAble){reg=/([^×]+)$/}for(;i<len;i++){txt=tagEls[i].innerText||tagEls[i].textContent;tag=txt.replace(reg,"$1");if(tagName==tag){removeEl=tagEls[i];break}}if(removeEl){removeEl.parentNode.removeChild(removeEl)}setTagInputValue()}function setTagInputValue(){tInput.value="";var spans=tInputContiner.getElementsByTagName("div");var a=[],i=0,len=spans.length,txt;for(;i<len;i++){txt=spans[i].innerText||spans[i].textContent;a.push(txt.replace(/×$/,""))}tTags.value=a.join(splitChar[0]);if(len>5){tInput.style.display="none"}else if(len===0){tInput.style.display=""}}function substr(str,len){if(!str||!len){return""}var a=0;var i=0;var temp="";for(i=0;i<str.length;i++){if(str.charCodeAt(i)>255){a+=2}else{a++}if(a>len){return temp}temp+=str.charAt(i)}return str}function byteLen(str){var aMatch=str.match(/[^\x00-\x80]/g);return str.length+(!aMatch?0:aMatch.length)}__addEvent(tInputContiner,function(e){e=e||window.event;var t=e.target||e.srcElement;if(t.tagName.toUpperCase()==="A"){setTimeout(function(){t.parentNode.parentNode.removeChild(t.parentNode);setTagInputValue()},10)}else{if(tInput.style.display==="none"){tInput.style.display=""}tInput.focus()}tInputContiner.scrollTop=0});__addEvent(tInput,function(){createTag(tInput.value)},"blur");__addEvent(tInput,function(e){e=e||window.event;var c=e.keyCode||e.charCode;if(c===8){var oldVal=tInput.value;setTimeout(function(){var newVal=tInput.value;if(oldVal===""&&newVal===""){var tagEl=tInput.previousSibling;if(tagEl){var deleteAble="false"==tagEl.getAttribute("deleteAble")?false:true;deleteAble&&tInputContiner.removeChild(tInput.previousSibling);deleteAble&&setTagInputValue()}}else{tInput.value=newVal.replace(/^,/,"")}},25)}},"keydown");__addEvent(tInput,function(){var v=tInput.value,vl=v.length,lc=v.substr(vl-1);if($CHROME&&/\w/.test(lc)){return}if(vl===1){if(lc===splitChar[0]||lc===splitChar[1]||rBLANK.test(lc)){tInput.value=""}}else if(vl>1){if(lc===splitChar[0]||lc===splitChar[1]||rBLANK.test(lc)||byteLen(v)>19){createTag(v)}}},"keyup");__addEvent(tInput,function(){setTimeout(function(){var str=tInput.value;if(str){createTag(str)}},25)},"paste");returnObject.addTag=createTag;returnObject.removeTag=removeTag;return returnObject}$registJob("editor_mjtag",function(){var __addEvent=Core.Events.addEvent;var html="",i,len;var userTags=articleEditorCFG.articleAllTagList.user;for(i=0,len=Math.min(userTags.length,5);i<len;i++){html+='<a href="javascript:;" class="ts_tag">'+userTags[i]+"</a>"}$E("hotTagList").innerHTML=html;html="";var hotTags=articleEditorCFG.articleAllTagList.hotTagNick;for(var i=0;i<hotTags.length;i++){html+='<a href="javascript:;" class="ts_tag">'+hotTags[i]+"</a>"}$E("userTagList").innerHTML=html;var hiddenTag=$E("articleTagInput"),tInput=$E("tInput");var tagval=hiddenTag.value;var tagsMng=TagsAddNew($E("tInputContainer"),tInput,hiddenTag);scope._tagsMng=tagsMng;if(tagval){tagval=tagval.split(" ").slice(0,5);hiddenTag.value=tagval.join(",");html="";for(i=0,len=tagval.length;i<len;i++){if(location.href.indexOf("tag365")>0){html+='<div deleteable="false" class="tag_tx">'+tagval[i]+"</div>"}else{html+='<div deleteable="true" class="tag_tx">'+tagval[i]+'<a title="删除" href="javascript:;">×</a></div>'}}var em=tInput.parentNode.children[0];if(em&&em.nodeName.toUpperCase()==="EM"){em.parentNode.removeChild(em)}Core.Dom.insertHTML(tInput,html,"BeforeBegin")}__addEvent($E("articleTagList"),function(event){event=event||window.event;var t=event.srcElement||event.target,tclz=t.className||"";if(tclz.indexOf("ts_tag")>-1){tagsMng.addTag(t.innerHTML)}else if(tclz==="ts_txt"){var data=t.getAttribute("e-data");if(!data)return;var tags=data.split(" "),i=0,len=tags.length,tlen=0,tagsNow=$E("articleTagInput").value;if(tagsNow){tlen=tagsNow.split(",").length}for(;i<len;i++){tagsNow=tagsMng.addTag(tags[i]);tagsNow&&tlen++;if(tlen>4)break}}});var _first=true;__addEvent(tInput,function(){var el=$E("articleTagList");if(el.style.display==="none"||_first){el.style.display="";__addEvent(document.body,checkHide);_first=false}var em=$E("tInput").parentNode.children[0];if(em&&em.nodeName.toUpperCase()==="EM"){setTimeout(function(){em.parentNode.removeChild(em)},10)}},"focus");__addEvent($E("tagListClose"),function(){if($E("articleTagInput").value){$E("tInput").style.display="none"}$E("articleTagList").style.display="none"});function checkHide(event){event=event||window.event;var t=event.srcElement||event.target,el=$E("articleTagList");if(Core.Dom.contains(el,t)||Core.Dom.contains($E("tInputContainer"),t)){return}if($E("articleTagInput").value){$E("tInput").style.display="none"}el.style.display="none";Core.Events.removeEvent(document.body,checkHide)}});$SYSMSG.extend({A00001:"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电4006900000。",A00002:"很抱歉，您的IP出现异常，请稍后再试",A00003:"无权限进行此操作，请重新登录。",A00004:"无权限进行此操作，请重新登录。",A00005:"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电4006900000。",A00006:"操作成功",A00007:"无权限进行此操作，请重新登录。",A00009:"网络繁忙，请稍后再试",A00010:"无升级权限",A11007:"你还未开通新浪博客，请先<a href='http://login.sina.com.cn/hd/reg_sec.php?entry=blog'> 开通博客</a>",A00800:"对不起，您短时间点击喜欢过多，请多休息，注意身体！感谢您对新浪博客的支持和关注！"});function showError(code,ico){var msg=$SYSMSG[code]||code;winDialog.alert(msg,{icon:ico||"01"})}Core.Dom.removeNode=function(node){node=$E(node)||node;try{node.parentNode.removeChild(node)}catch(e){}};Utils.Io.Ijax={arrTaskLists:[],createLoadingIframe:function(){if(this.loadFrames!=null){return false}var rndId1="loadingIframe_thread"+Math.ceil(Math.random()*1e4);var rndId2="loadingIframe_thread"+Math.ceil((Math.random()+1)*1e4);this.loadFrames=[rndId1,rndId2];var html='<iframe id="'+rndId1+'" name="'+rndId1+'" class="invisible"\r\n	              scrolling="no" src=""\r\n	              allowTransparency="true" style="display:none;" frameborder="0"\r\n	              ></iframe>\r\n				  <iframe id="'+rndId2+'" name="'+rndId2+'" class="invisible"\r\n	              scrolling="no" src=""\r\n	              allowTransparency="true" style="display:none;" frameborder="0"\r\n	              ></iframe>';var oIjaxIframeCnt=$C("div");oIjaxIframeCnt.id="ijax_iframes";oIjaxIframeCnt.innerHTML=html;trace("创建 Ijax 需要的 iframe");document.body.appendChild(oIjaxIframeCnt);var loadTimer=setInterval(Core.Function.bind2(function(){if($E(this.loadFrames[0])!=null&&$E(this.loadFrames[1])!=null){clearInterval(loadTimer);loadTimer=null;this.loadingIframe={thread1:{container:$E(this.loadFrames[0]),isBusy:false},thread2:{container:$E(this.loadFrames[1]),isBusy:false}};this.loadByList()}},this),10)},isIjaxReady:function(){if(typeof this.loadingIframe=="undefined"){return false}for(var oLoadCnt in this.loadingIframe){if(this.loadingIframe[oLoadCnt].isBusy==false){this.loadingIframe[oLoadCnt].isBusy=true;return this.loadingIframe[oLoadCnt]}}return false},request:function(url,option){var oTask={};oTask.url=url;oTask.option=option||{};this.arrTaskLists.push(oTask);if(this.loadFrames==null){this.createLoadingIframe()}else{this.loadByList()}},loadByList:function(){if(this.arrTaskLists.length==0){return false}var loadStatus=this.isIjaxReady();if(loadStatus==false){return false}var newData=this.arrTaskLists[0];this.loadData(newData.url,newData.option,loadStatus);this.arrTaskLists.shift()},loadData:function(url,option,loader){var _url=new Utils.Url(url);if(option.GET){for(var key in option.GET){_url.setParam(key,Core.String.encodeDoubleByte(option.GET[key]))}}if(!/\bdomain\b/.test(url)){_url.setParam("domain","1")}_url=_url.toString();var ifm=loader.container;ifm.listener=Core.Function.bind2(function(){try{var iframeObject=ifm.contentWindow.document,sResult;var tArea=Core.Dom.byClz(iframeObject,"textarea","")[0];if(typeof tArea!="undefined"){sResult=tArea.value}else{sResult=iframeObject.body.innerHTML}if(option.onComplete){option.onComplete(sResult)}else{option.onException()}}catch(e){traceError(e);if(option.onException){option.onException(e.message,_url.toString())}}loader.isBusy=false;Core.Events.removeEvent(ifm,ifm.listener,"load");this.loadByList()},this);Core.Events.addEvent(ifm,ifm.listener,"load");if(option.POST){var oIjaxForm=$C("form");oIjaxForm.id="IjaxForm";oIjaxForm.action=_url;oIjaxForm.method="post";oIjaxForm.target=ifm.id;for(var oItem in option.POST){var value;if(option.noEncode){value=Core.String.encodeDoubleByte(option.POST[oItem])}else{value=option.POST[oItem]}var oInput=$C("input");oInput.type="hidden";oInput.name=oItem;oInput.value=value;oIjaxForm.appendChild(oInput)}document.body.appendChild(oIjaxForm);oIjaxForm.submit()}else{try{window.frames(ifm.id).location.href=_url}catch(e){ifm.src=_url}}}};if(typeof App=="undefined"){var App={}}App.getArticlesSort=function(fCallBack,uid){uid=uid||scope.$uid;var js=$C("script");Lib.checkAuthor();js.src="http://comet.blog.sina.com.cn/api?maintype=acate&varname=x&uid="+uid;js.charset="utf-8";js.onload=js.onerror=js.onreadystatechange=Core.Function.bind2(function(){if(js&&js.readyState&&js.readyState!="loaded"&&js.readyState!="complete"){return}App.ArticlesSort=x;if(fCallBack!=null){fCallBack(App.ArticlesSort)}js.onload=js.onreadystatechange=js.onerror=null;js.src="";js.parentNode.removeChild(js);js=null},this);document.getElementsByTagName("head")[0].appendChild(js)};var cateDialog=Core.Class.create();cateDialog.prototype={uid:"",initialize:function(action){this.action=action||false},show:function(uid){this.uid=uid||scope.$uid;this.initDialog();this.dialog.show();this.dialog.setFixed(true);this.dialog.setAreaLocked(true);this.dialog.setMiddle()},initDialog:function(){var me=this;var data={width:492,height:0,url:"http://control.blog.sina.com.cn/admin/article/article_class_list.php?"+(this.action?"action=editor":"")};Lib.checkAuthor();this.url="http://control.blog.sina.com.cn/admin/article/article_class_save2.php?uid="+$UID+(this.action?"&action=editor":"");this.id=Core.Math.getUniqueId();this.manage=null;this.manage=new cateMng(this.id,this.itemTpl,this.uid);this.manage.onSuccess=function(list){me.onSuccess(list)};var temp=new Ui.Template("<div style='width: #{width}px; height: #{height}px;' id='category_"+this.id+"'></div>");var obj={ad:false,drag:true,title:"分类管理",content:temp.evaluate(data),shadow:1,width:data.width,height:data.height};var func={};var dialog=winDialog.createCustomsDialog(obj,func);this.dialog=dialog;$E("category_"+this.id).innerHTML=this.tpl.join("");var _this=this;this.dialog.nodes["btnClose"].href="javascript:;";this.dialog.nodes["btnClose"].onclick=function(){if(_this.manage.getEdit()){winDialog.confirm("是否保存此更改？",{funcOk:function(){_this.manage.saveHandler(_this.url)},funcCancel:function(){_this.close()},funcClose:function(){_this.dialog.show()},textOk:"是",textCancel:"否"})}else{_this.close()}};this.initEvent()},initEvent:function(){this.manage.nameEvent();this.manage.createEvent();this.manage.dataProvider();this.manage.saveEvent(this.url)},hidden:function(){this.dialog.hidden()},close:function(){this.dialog.hidden();this.dialog.destroy()},showOld:function(){this.dialog.show()},reset:function(){window.CateDialog.dialog.setCloseEvent(true);window.CateDialog.dialog.hidden();window.CateDialog.dialog=null;window.CateDialog.init=false},setSize:function(nWidth,nHeight){var ele=this.dialog.nodes.content.firstChild;this.dialog.setSize(nWidth,nHeight);ele.style.width=nWidth+"px";ele.style.height=nHeight+"px"},setCloseEvent:function(bClose){},getDialog:function(){return this.dialog},getId:function(){return this.id},getDataList:function(){return this.manage.list},onSuccess:function(res){},init:false,dialog:null,tpl:['<div id="categoryBody">','<div id="categoryTitle">',"</div>",'<div id="categoryHead">',"<table>","<tr>",'<td><input type="text" maxlength="28" value="最多可输入14个中文字符" id="categoryName"/></td>','<td width="80"><a id="categoryCreate" href="javascript:void(0);" class="SG_aBtn SG_aBtnB SG_aBtn_sub"><cite>创建分类</cite></a></td>','<td><span class="SG_txtc">请用中文、英文或数字。</span></td>',"</tr>","</table>",'<div id="errTips"></div>',"</div>",'<form method="post" id="categoryForm" name="form">','<div id="categoryList">','<ul class="clearfix" id="datalist">&nbsp;</ul>','<div class="SG_j_linedot"></div>',"</div>",'<div id="categoryBottom" style="text-align:center">','<a id="categorySave" href="javascript:void(0);" class="SG_aBtn SG_aBtnB SG_aBtn_sub"><cite>保存设置<input type="button" value="保存设置"/></cite></a>',"</div>","</form>","</div>"],itemTpl:['<li class="{class}">','<span class="htit" style="color:#000000" id="cate_{index}">{cate}</span>','<input type="hidden" value="{cate}" name="typename[]" class="catName"/>','<input type="hidden" value="{id}" name="number[]"/>','<span id="ctrl_{index}" class="control">','<div class="manage">','<a class="CP_a_fuc" id="edit_{index}" href="javascript:;" onclick="javascript:window.CateDialog.manage.editCate(this);">[<cite>编辑</cite>]</a>','<a class="CP_a_fuc" id="del_{index}" index="{index}" href="javascript:;" onclick="javascript:window.CateDialog.manage.delCate(this);">[<cite>删除</cite>]</a>',"</div>",'<div class="arrow">','<a id="up_{index}" class="{up_class}" href="javascript:;" onclick="javascript:window.CateDialog.manage.upHandler(this);"/>','<a id="down_{index}" class="{down_class}" href="javascript:;" onclick="javascript:window.CateDialog.manage.downHandler(this);"/>',"</div>","</span>",'<div id="editctrl_{index}" class="writeinfo" style="display:none">','<input id="new_{index}" type="text" value="" /><a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;"><cite>确定</cite></a><a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;"><cite>取消</cite></a></div>',"<div/>","</li>"]};var cateMng=Core.Class.create();cateMng.prototype={list:null,orilen:0,edit:false,uid:null,initialize:function(id,itemTpl,uid){this.uid=uid||scope.$uid;this.id=id;this.itemTpl=itemTpl;Array.prototype.remove=function(dx){if(isNaN(dx)||dx>this.length){return false}this.splice(dx,1)}},nameEvent:function(){var _this=this;$E("categoryName").onfocus=function(){if(this.value=="最多可输入14个中文字符"){this.value=""}};$E("categoryName").onblur=function(){var re=/[ ><\\\'\;\"`\|\t\r\n|\u3000]/gi;this.value=this.value.replace(re,"");if(Core.String.trim($E("categoryName").value)==""){this.value="最多可输入14个中文字符";this.edit=false}else{this.edit=true}_this.showTips("")};$E("categoryName").onkeyup=function(){var value=Core.String.trim(this.value);if(Core.String.byteLength(value)>28){this.value=Core.String.leftB(value,28)}else if(value!=this.value){this.value=value}};_this.showTips("")},createEvent:function(){var _this=this;var code="";$E("categoryCreate").onclick=function(){if(checkCate()&&$E("categoryName").edit){var obj={id:-1,name:$E("categoryName").value};$E("categoryName").value="最多可输入14个中文字符";$E("categoryName").edit=false;_this.list.push(obj);_this.update()}_this.showTips(code)};function checkCate(){var value=Core.String.trim($E("categoryName").value);code="";if(value==""||value=="最多可输入14个中文字符"){code="分类名称不能为空"}else if(value.indexOf("&")!=-1||value.indexOf("＆")!=-1){code="分类名称不能包含&符号"}else if(_this.list.length>=15){code="抱歉！最多可创建15条分类"}else if(Core.String.byteLength(value)>28){code="最多可输入14个中文字符"}for(var i=0;i<_this.list.length;i++){if(_this.list[i].name==value){code="您已经添加过此分类";break}}if(code!=""){return false}else{return true}}},saveEvent:function(url){Core.Events.stopEvent();var _this=this;$E("categorySave").onclick=function(){_this.saveHandler(url)}},saveHandler:function(url){var _this=this;var length=_this.list.length;if(_this.orilen-length>2){winDialog.confirm("您本次删除的博文分类太多，确定删除？",{funcOk:function(){_this.orilen=length;$E("categorySave").onclick()}});return}var cateName=[];var cateId=[];for(var i=0;i<length;i++){var item=_this.list[i];cateName.push(item.name);cateId.push(item.id)}Utils.Io.Ijax.request(url+"&r="+Math.random(),{POST:{typename:cateName.join("|"),number:cateId.join("|")},onComplete:function(res){eval("var result = "+res);try{try{if($E("module_3")){Lib.Component.refresh(3,{width:scope.catedialogwidth||210})}if($E("module_7")){location.reload()}}catch(error){trace(error)}try{window.ArticleCateFuncs.reloadCate(result.msg)}catch(error){}window.CateDialog.close()}catch(e){}var r;eval("r="+res);_this.onSuccess(r.msg)},onException:function(res){}})},editCate:function(dom){var _this=this;var index=dom.id.split("_")[1];var old=$E("cate_"+index).innerHTML;var li=$E("cate_"+index).parentNode;$E("ctrl_"+index).className="control hide";li.className=index%2==0?"editName":"cline editName";var tpl='<div id="editctrl_'+index+'" class="writeinfo"><input id="new_'+index+'" type="text" value="'+old+'"><a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;"><cite>确定</cite></a><a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;"><cite>取消</cite></a></div>';li.innerHTML=tpl;$E("new_"+index).onkeyup=function(){var re=/[ >&<\\\'\,\;\"`\|\t\r\n|\u3000]/gi;var value=Core.String.trim(this.value.replace(re,""));if(value!=this.value){this.value=value}if(value==""){$E("editctrl_"+index).childNodes[1].disabled=true}else{$E("editctrl_"+index).childNodes[1].disabled=false}};$E("new_"+index).onblur=function(){if(Core.String.byteLength(this.value)>=28){this.value=Core.String.leftB(this.value,28)}};$E("editctrl_"+index).childNodes[1].onclick=function(){if($E("new_"+index).value==old){setName(old,2)}else{setName($E("new_"+index).value,1)}};$E("editctrl_"+index).childNodes[2].onclick=function(){setName(old,2)};function setName(nvl,type){var value=nvl;var code="";if(Core.String.byteLength(value)>28){value=Core.String.leftB(value,28)}if(type==1){for(var i=0;i<_this.list.length;i++){if(_this.list[i].name==value){code="您已经添加过此分类";break}}}if(code!=""){if(!$E("err_"+index)){Core.Dom.addHTML($E("editctrl_"+index),'<div id="err_'+index+'" class="errTips">'+code+"</div>");li.style.height="60px"}else{$E("err_"+index).value=code}}else{_this.list[index].name=value;var tpl=_this.itemTpl.join("");tpl=tpl.replace('<li class="{class}">',"");tpl=tpl.replace("</li>");var item=_this.list[index];tpl=tpl.replace(/\{cate\}/gi,item.name);tpl=tpl.replace(/\{id\}/gi,item.id);tpl=tpl.replace(/\{index\}/gi,index);tpl=tpl.replace(/\{up_class\}/,index==0?"up_disabled":"up");tpl=tpl.replace(/\{down_class\}/,index==_this.list.length-1?"down_disabled":"down");li.innerHTML=tpl;li.className=index%2==0?"":"cline";li.style.height="30px";if(type==1){_this.edit=true}}code=""}},delCate:function(dom){var _this=this;var index=dom.id.split("_")[1];winDialog.confirm("确实要删除此分类吗？删除后不可恢复。",{funcOk:function(){_this.list.remove(index);_this.update()}})},upHandler:function(dom){var index=dom.id.split("_")[1];if(index>0){var temp=this.list[index];this.list[index]=this.list[index-1];this.list[index-1]=temp;this.update()}},downHandler:function(dom){var index=dom.id.split("_")[1];if(index<this.list.length-1){var next=index*1+1;var temp=this.list[next];this.list[next]=this.list[index];this.list[index]=temp;this.update()}},showTips:function(code){$E("errTips").innerHTML=code},dataProvider:function(){var _this=this;App.getArticlesSort(function(data){_this.list=data.data;_this.orilen=_this.list.length;$E("datalist").innerHTML="";for(var i=0;i<_this.list.length;i++){var tpl=_this.itemTpl.join("");var item=_this.list[i];tpl=tpl.replace(/\{cate\}/gi,item.name);tpl=tpl.replace(/\{class\}/gi,i%2==0?"":"cline");tpl=tpl.replace(/\{id\}/gi,item.id);tpl=tpl.replace(/\{index\}/gi,i);tpl=tpl.replace(/\{up_class\}/,i==0?"up_disabled":"up");tpl=tpl.replace(/\{down_class\}/,i==_this.list.length-1?"down_disabled":"down");Core.Dom.addHTML($E("datalist"),tpl)}},this.uid)},update:function(){$E("datalist").innerHTML="";for(var i=0;i<this.list.length;i++){var tpl=this.itemTpl.join("");var item=this.list[i];tpl=tpl.replace(/\{cate\}/gi,item.name);tpl=tpl.replace(/\{class\}/gi,i%2==0?"":"cline");tpl=tpl.replace(/\{id\}/gi,item.id);tpl=tpl.replace(/\{index\}/gi,i);tpl=tpl.replace(/\{up_class\}/,i==0?"up_disabled":"up");tpl=tpl.replace(/\{down_class\}/,i==this.list.length-1?"down_disabled":"down");Core.Dom.addHTML($E("datalist"),tpl)}if(!this.edit){this.edit=true}},getEdit:function(){return this.edit},onSuccess:function(res){}};$registJob("editor_catedialog",function(){window.CateDialog=new cateDialog("editor")});if(typeof Mojie==="undefined"){Mojie={}}Sina.pkg("Core.Date");Core.Date.UTC=function(obj){var now=new Date;var t=new Date(obj.y||now.getFullYear(),typeof obj.M==="number"?obj.M:now.getMonth(),obj.d||now.getDate());typeof obj.h==="number"&&t.setHours(obj.h);typeof obj.m==="number"&&t.setMinutes(obj.m);typeof obj.s==="number"&&t.setSeconds(obj.s);return+t};Mojie.Calendar=function(option){var __addEvent=Core.Events.addEvent;var __byClz=Core.Dom.getElementsByClass;var that=this;this.init=function(option){var today=new Date;if(!option.container){throw new Error("日期的容器必须定义")}this.container=option.container;this.timeInput=option.timeInput;this.lastDate=option.lastDate;this.lastSelectedDay=option.selectedDate||today;this.body=option.body;this.yearInput=option.yearInput;this.monthInput=option.monthInput;this.days=[];this.year=option.year||today.getFullYear();this.month=option.month||today.getMonth();this.date=option.date||today.getDate();this.dateInput=option.dateInput;this.selectDay=option.selectDay?new Date(option.selectDay):null;this.firstShow();__addEvent(this.container,function(e){e=e||window.event;var t=e.target||e.srcElement;if(!(t.tagName.toLowerCase()=="a"||t.tagName.toLowerCase()=="td"))return;if(t.tagName.toLowerCase()=="a"){if(t.className=="disabled"||t.innerHTML=="&nbsp;")return;if(__byClz(this.container,"a","selected")[0])__byClz(this.container,"a","selected")[0].className="";that.date=t.innerHTML;t.className="selected";that.renderTimeInput()}else if(t.tagName.toLowerCase()=="td"){if(t.children[0].innerTHML=="&nbsp;"||t.children[0].className=="disabled")return;if(__byClz(this.container,"a","selected")[0])__byClz(this.container,"a","selected")[0].className="";that.date=t.children[0].innerHTML;t.children[0].className="selected";that.renderTimeInput()}that.toDateString()});__addEvent(this.yearInput,function(){var val=parseInt(that.yearInput.value);var todayYear=(new Date).getFullYear();if(isNaN(val)||val<todayYear){val=todayYear}else if(val>2035){val=2035}that.yearInput.value=val;that.year=val;that.setDraw(new Date(val,that.month-1,that.date))},"change");__addEvent(this.monthInput,function(){var val=parseInt(that.monthInput.value);var todayMonth=(new Date).getMonth()+1;if(isNaN(val)||val<1){val=todayMonth}else if(val>12){val=12}that.month=val;that.setDraw(new Date(that.year,val-1,that.date));that.monthInput.value=val},"change");if(option.preMonthBtn){__addEvent(option.preMonthBtn,function(){var d=new Date;if(that.month==1&&that.year-1<d.getFullYear()||that.month-1===d.getMonth()&&that.year===d.getFullYear()){return}that.goPreMonth()})}if(option.nextMonthBtn){__addEvent(option.nextMonthBtn,function(){if(that.month==12&&that.year+1>2035)return;that.goNextMonth()})}if(option.preYearBtn){__addEvent(option.preYearBtn,function(){if(that.year-1<(new Date).getFullYear())return;that.goPreYear()})}if(option.nextYearBtn){__addEvent(option.nextYearBtn,function(){if(that.year+1>2035)return;that.goNextYear()})}};this.renderTimeInput=function(){this.lastSelectedDay=new Date(this.yearInput.value,this.monthInput.value-1,this.date);this.timeInput.value=this.lastSelectedDay.getTime()};this.toDateString=function(){var xYear=this.year;var xMonth=this.month;if(xMonth<10){xMonth="0"+xMonth}var xDay=this.date;if(xDay<10){xDay="0"+xDay}this.dateInput.value=xYear+"-"+xMonth+"-"+xDay;$E("txt_date").innerHTML=xYear+"年"+xMonth+"月"+xDay+"日"};this.firstShow=function(){var t=new Date(parseInt(this.timeInput.value,10));this.setDraw(t);this.year=t.getFullYear();this.month=t.getMonth()+1;this.date=t.getDate();this.minute=t.getMinutes();this.hour=t.getHours();this.toDateString()};this.goPreMonth=function(){this.setDraw(new Date(this.year,this.month-2,1))};this.goNextMonth=function(){this.setDraw(new Date(this.year,this.month,1))};this.goPreYear=function(){this.setDraw(new Date(this.year-1,this.month-1,1))};this.goNextYear=function(){this.setDraw(new Date(this.year+1,this.month-1,1))};this.setDraw=function(date){this.year=date.getFullYear();this.month=date.getMonth()+1;that.draw()};that.draw=function(){var arr=[];for(var i=1,firstDay=new Date(this.year,this.month-1,1).getDay();i<=firstDay;i++){arr.push(0)}for(var i=1,monthDay=new Date(this.year,this.month,0).getDate();i<=monthDay;i++){arr.push(i)}this.days=[];var frag=document.createDocumentFragment();var thisMonth=false;var today=new Date;var on=new Date(this.year,this.month-1,1,23,59,59);var lastDay=this.lastDate;if(!lastDay){lastDay=new Date;lastDay.setFullYear(today.getFullYear()+5)}while(arr.length){var row=document.createElement("tr");for(var i=1;i<=7;i++){var cell=document.createElement("td");var cSpan=document.createElement("a");cSpan.href="javascript:void(0);";if(i==1||i==7){cSpan.className="weekend"}cSpan.innerHTML="&nbsp;";cSpan.className="disabled";cell.appendChild(cSpan);if(arr.length){var d=arr.shift();if(d){cSpan.innerHTML=d;this.days[d]=cSpan;on.setDate(d);if(on>=today&&on<lastDay){cSpan.className=""}if(this.isSame(on,this.lastSelectedDay)){if(__byClz(this.container,"a","selected")[0]){__byClz(this.container,"a","selected")[0].className=""}cSpan.className="selected"}}}row.appendChild(cell)}frag.appendChild(row)}while(this.container.hasChildNodes()){this.container.removeChild(this.container.firstChild)}this.container.appendChild(frag);this.onFinish()};this.isSame=function(d1,d2){return d1.getDate()==d2.getDate()&&d1.getMonth()==d2.getMonth()&&d1.getFullYear()==d2.getFullYear()};this.onFinish=function(){this.yearInput.value=this.year;this.monthInput.value=this.month}};Mojie.setTimeDialog=function(option){var time=option.time&&new Date(option.time)||new Date;var opt60=getSelectOption(60);var _nodes;var tpl=""+'<div class="CP_layercon2 addFriendItem">'+'<div class="timed">'+'<span>定时发布：</span><em id="txt_date">2012年12月20日</em><input id="#{date}" type="hidden" value="2012-12-20" />'+'<select name="tselect" id="#{hour}">'+getSelectOption(24)+"</select>时"+'<select name="tselect2" id="#{minute}">'+opt60+"</select>分"+'<select name="tselect3" id="#{second}">'+opt60+"</select>秒"+"</div>"+'<input type="hidden" value="" id="#{timeInput}" />'+'<div id="#{calendarBody}" class="calendar" style="width:180px;">'+'<div class="calHd">'+'<div class="inner">'+'<a title="" href="javascript:;" class="btnMod preYear" id="#{preYearBtn}"></a>'+'<a title="" href="javascript:;" class="btnMod NextYear" id="#{nextYearBtn}"></a>'+'<a title="" href="javascript:;" class="btnMod preMon" id="#{preMonthBtn}"></a>'+'<a title="" href="javascript:;" class="btnMod NextMon" id="#{nextMonthBtn}"></a>'+'<div class="title">'+'<input type="text" value="2012" class="inputTxt focus inputYear" id="#{idCalendarYear}" />年'+'<input type="text" value="12" class="inputTxt focus inputMon" id="#{idCalendarMonth}" />月'+"</div>"+"</div>"+"</div>"+'<div class="calBd">'+"<table>"+"<thead>"+"<tr>"+"<td><span>日</span></td>"+"<td><span>一</span></td>"+"<td><span>二</span></td>"+"<td><span>三</span></td>"+"<td><span>四</span></td>"+"<td><span>五</span></td>"+"<td><span>六</span></td>"+"</tr>"+"</thead>"+'<tbody id="#{idCalendar}"><tr><td><a href="javascript:;" class="disabled">&nbsp;</a></td><td><a href="javascript:;" class="disabled">&nbsp;</a></td><td><a href="javascript:;" class="disabled">&nbsp;</a></td><td><a href="javascript:;" class="disabled">1</a></td><td><a href="javascript:;" class="disabled">2</a></td><td><a href="javascript:;" class="disabled">3</a></td><td><a href="javascript:;" class="disabled">4</a></td></tr><tr><td><a href="javascript:;" class="disabled">5</a></td><td><a href="javascript:;" class="disabled">6</a></td><td><a href="javascript:;" class="disabled">7</a></td><td><a href="javascript:;" class="selected">8</a></td><td><a href="javascript:;">9</a></td><td><a href="javascript:;">10</a></td><td><a href="javascript:;">11</a></td></tr><tr><td><a href="javascript:;">12</a></td><td><a href="javascript:;">13</a></td><td><a href="javascript:;">14</a></td><td><a href="javascript:;">15</a></td><td><a href="javascript:;">16</a></td><td><a href="javascript:;">17</a></td><td><a href="javascript:;">18</a></td></tr><tr><td><a href="javascript:;">19</a></td><td><a href="javascript:;">20</a></td><td><a href="javascript:;">21</a></td><td><a href="javascript:;">22</a></td><td><a href="javascript:;">23</a></td><td><a href="javascript:;">24</a></td><td><a href="javascript:;">25</a></td></tr><tr><td><a href="javascript:;">26</a></td><td><a href="javascript:;">27</a></td><td><a href="javascript:;">28</a></td><td><a href="javascript:;">29</a></td><td><a href="javascript:;">30</a></td><td><a href="javascript:;">31</a></td><td><a href="javascript:;" class="disabled">&nbsp;</a></td></tr></tbody>'+"</table>"+"</div>"+"</div>"+'<div class="formTowho">'+'<div class="row1"></div>'+'<div class="btn"><a id="#{ok}" class="SG_aBtn SG_aBtnB" href="javascript:;"><cite>确认</cite></a>&nbsp;&nbsp;<a id="#{cancel}" class="SG_aBtn SG_aBtnB" href="javascript:;"><cite>取消</cite></a></div>'+"</div>"+"</div>";

var dlg;initDialog();initTime(option.time);initEvent();dlg.show();dlg.setFixed(true);dlg.setAreaLocked(true);dlg.setMiddle();function initDialog(){dlg=winDialog.createCustomsDialog({ad:false,drag:true,title:"设置时间",content:tpl,width:360,shadow:1});_nodes=dlg.nodes;_nodes.btnClose.href="javascript:;";setTimeout(function(){_nodes.hour.focus()},1)}function initEvent(){_nodes.btnClose.onclick=function(){var notClose=option.funcClose&&option.funcClose(getTime());!notClose&&closeDlg()};_nodes.ok.onclick=function(){var notClose=option.funcOk&&option.funcOk(getTime());!notClose&&closeDlg()};_nodes.cancel.onclick=function(){var notClose=option.funcCancel&&option.funcCancel(getTime());!notClose&&closeDlg()};var lastDay=new Date;lastDay.setFullYear(lastDay.getFullYear()+1);var opt={timeInput:_nodes.timeInput,preMonthBtn:_nodes.preMonthBtn,nextMonthBtn:_nodes.nextMonthBtn,preYearBtn:_nodes.preYearBtn,nextYearBtn:_nodes.nextYearBtn,container:_nodes.idCalendar,body:_nodes.calendarBody,dateInput:_nodes.date,lastDate:lastDay,selectedDate:new Date(option.time),yearInput:_nodes.idCalendarYear,monthInput:_nodes.idCalendarMonth,onSelectDay:function(o){o.className="selected"},onToday:function(o){o.className="onToday"}};var calendar=new Mojie.Calendar;calendar.init(opt)}function initTime(ts){_nodes.timeInput.value=ts;var t=new Date(ts);var mm=t.getMonth()+1,dd=t.getDate();_nodes.date.value=t.getFullYear()+(mm<10?"-0"+mm:"-"+mm)+(dd<10?"-0"+dd:"-"+dd);_nodes.hour.value=t.getHours();_nodes.minute.value=t.getMinutes();_nodes.second.value=t.getSeconds()}function getTime(){var yyMMdd=_nodes.date.value.split("-");return Core.Date.UTC({y:parseInt(yyMMdd[0],10),M:parseInt(yyMMdd[1],10)-1,d:parseInt(yyMMdd[2],10),h:parseInt(_nodes.hour.value,10),m:parseInt(_nodes.minute.value,10),s:parseInt(_nodes.second.value,10)})}function getSelectOption(max){var s="",i=0;for(;i<max;i++){s+='<option value="'+i+'">'+i+"</option>"}return s}function closeDlg(){dlg.hidden();var entity=dlg.__entity;entity.parentNode&&entity.parentNode.removeChild(entity);dlg=null;_nodes=null}};Core.Date.getTimeObj=function(timestamp){var t=timestamp&&new Date(timestamp)||new Date;var M=t.getMonth()+1,d=t.getDate(),h=t.getHours(),m=t.getMinutes(),s=t.getSeconds();return{yy:t.getFullYear(),MM:M>9?M:"0"+M,dd:d>9?d:"0"+d,hh:h>9?h:"0"+h,mm:m>9?m:"0"+m,ss:s>9?s:"0"+s}};Core.String.j2o=function(str){if(!str||str==""){return null}try{var o=window.eval("("+str+")");return o}catch(e){trace("j2o : 数据分析出错");traceError(e);return null}};$registJob("editor_init",function(){var url=new Utils.Url(location.href);var query=url.query;if(query&&query.tag365){var timeArr=query.tag365.split("-");if(timeArr){var hhmmss=$E("articleTime").value;var yyMMdd=timeArr,hhmmss=hhmmss.split(":");db_time=Core.Date.UTC({y:yyMMdd[0],M:parseInt(yyMMdd[1],10)-1,d:parseInt(yyMMdd[2],10),h:parseInt(hhmmss[0],10),m:parseInt(hhmmss[1],10),s:parseInt(hhmmss[2],10)});var now=new Date;now_time=Core.Date.UTC({y:now.getFullYear(),M:now.getMonth(),d:now.getDate(),h:now.getHours(),m:now.getMinutes(),s:now.getMilliseconds()});if(now_time<db_time){scope.$pub_time=db_time;Mojie.setTimeDialog({time:db_time,funcOk:setTimeOk})}}}function setTimeOk(time){db_time=time;scope.$pub_time=time;var tobj=Core.Date.getTimeObj(time),yMd=tobj.yy+"-"+tobj.MM+"-"+tobj.dd,hms=tobj.hh+":"+tobj.mm+":"+tobj.ss;$E("date_pub").value=yMd;$E("articleTime").value=hms;$E("timeTips").innerHTML="博文将于 "+yMd+" "+hms+' 发布<a href="javascript:;">×</a>';$E("isTimed").value=7;var servertime=parseInt(articleEditorCFG.servertime,10)||0;servertime*=1e3;if(time<servertime){v7sendLog("50_01_20")}}var blogHtml=$E("SinaEditorTextarea").value;if(scope.$private.tbh_status&&blogHtml){var tbhDivIndex=blogHtml.lastIndexOf('<div class="taofair">');if(0<=tbhDivIndex){blogHtml=blogHtml.substring(0,tbhDivIndex);$E("SinaEditorTextarea").value=blogHtml}}var editmenuCookie=Utils.Cookie.getCookie("EditorToolType");var option={iframe_container:"SinaEditor_Iframe",iframe_cls:"iframe",textarea:"SinaEditorTextarea",checkbox:"SinaEditor_59_viewcodecheckbox",heightModeId:"height_mode",toolType:editmenuCookie||"base",focusElementId:"articleTitle",mode:"edit"};window.editor=new Editor.BlogEditor(option);window.editor.iframeWindow.focus();var addEvent=Core.Events.addEvent,removeEvent=Core.Events.removeEvent,trim=Core.String.trim;addEvent(window.editor.iframeWindow,editorWindowBlur,"blur");function editorWindowBlur(e){var contentBody=window.editor.iframeDocument.body;if(Core.String.byteLength(contentBody.innerText||contentBody.textContent||"")<400){return}if(editor.iframe.getAttribute("get-tag")==1||trim($E("articleTagInput").value)!=""){removeEvent(window.editor.iframeWindow,editorWindowBlur,"blur");return}getDefaultTag(contentBody)}function getDefaultTag(contentBody){var title=$E("articleTitle")&&$E("articleTitle").value||"";body=contentBody.innerHTML||"";Utils.Io.Ijax.request("http://interface.blog.sina.com.cn/api/get_blog_classify.php",{POST:{blog_body:body,blog_title:title,utf8:"utf8",action:"classify"},onComplete:function(resultText){editor.iframe.setAttribute("get-tag",1);var resObj=Core.String.j2o(resultText);if(resObj.code&&resObj.code==="A00006"){renderDefalutTag(resObj.data)}},onException:function(){}})}function renderDefalutTag(data){var articleTagInput=$E("articleTagInput"),tInput=$E("tInput");if(!articleTagInput||!tInput){return}if(document.activeElement==tInput){editor.iframe.setAttribute("default-tag",data);addEvent(tInput,tInputBlur,"blur");return}if(trim(articleTagInput.value)==""){scope._tagsMng.addTag(data)}removeEvent(window.editor.iframeWindow,editorWindowBlur,"blur")}function tInputBlur(e){var articleTagInput=$E("articleTagInput"),tInput=$E("tInput"),data;if(!articleTagInput||!tInput){return}if(trim(articleTagInput.value)==""){data=editor.iframe.getAttribute("default-tag");scope._tagsMng.addTag(data)}removeEvent(tInput,tInputBlur,"blur");removeEvent(window.editor.iframeWindow,editorWindowBlur,"blur")}var is_mobile=/Mobile/i.test(navigator.userAgent);if(is_mobile){var meditor=$E("mobileEditor");if(!meditor){winDialog.alert("您所使用的设备暂不能使用完整功能，请在电脑上进行操作",{icon:"01"});return}var encodeHTML=function(str){var div=document.createElement("div");div.appendChild(document.createTextNode(str));return div.innerHTML.replace(/\r?\n/g,"<br/>").replace(/\s/g,"&nbsp;")};$E("SinaEditor").style.display="none";meditor.style.display="";window.editor.setSourceValue=function(){this.textarea.value=encodeHTML($E("mobileTextarea").value)}}});var Tabs=Core.Class.create();Tabs.prototype={initialize:function(container,option){option=option||{};var className=option.className||"";this.tabsArr=[];this.htmlEle=$C("ul");this.htmlEle.className=className;container.appendChild(this.htmlEle)},add:function(tab){this.tabsArr.push(tab);this.htmlEle.appendChild(tab.element);Core.Events.addEvent(tab.element,Core.Function.bind3(this.swapTags,this,[tab]))},swapTags:function(tab){if(tab.isFocus==false){for(var i=0;i<this.tabsArr.length;i++){this.tabsArr[i].setAbort()}tab.setFocus()}else{return}}};var Tab=Core.Class.create();Tab.prototype={isShow:true,initialize:function(title,option){this.id=Core.Math.getUniqueId();this.option=option||{};var isFocus=option.isFocus||false;this.className=option.className||"";this.focus=option.onfocus?[option.onfocus]:[];this.abotrts=option.onabort?[option.onabort]:[];this.element=$C("li");if(option.cls){this.element.className=option.cls}isFocus?this.setFocus():this.setAbort();this.element.innerHTML=title},setAbort:function(){if(this.isFocus==false){return}if(this.option.cls){this.element.className=this.option.cls}else{this.element.className=""}this.isFocus=false;this.onabort()},setFocus:function(){this.element.className=this.className;this.isFocus=true;this.onfocus()},onabort:function(){for(var i=0;i<this.abotrts.length;i++){this.abotrts[i]()}},onfocus:function(){for(var i=0;i<this.focus.length;i++){this.focus[i]()}},addOnAbort:function(abortFunc){this.abotrts.push(abortFunc)},addOnFocus:function(focusFunc){this.focus.push(focusFunc)},hidden:function(){this.element.style.display="none"},hidden:function(){this.element.style.display="none";this.isShow=false},show:function(){this.element.style.display="block";this.isShow=true}};if(typeof Editor.Plugins=="undefined"){Editor.Plugins={}}Editor.Plugins.RightMenu=Core.Class.create();Editor.Plugins.RightMenu.prototype={initialize:function(eleId,content_id){this.eleId=eleId;this.content_id=content_id},addItem:function(imageSrc,title,callback){var ele=$E(this.content_id);var uls=ele.getElementsByTagName("ul");var ul,isNewUl;if(uls.length<1||uls[uls.length-1].getElementsByTagName("li").length>1){ul=$C("ul");isNewUl=true}else{ul=uls[uls.length-1]}var li=$C("li");var a=$C("a");var img=$C("img");img.width=40;img.height=40;var span=$C("span");a.href="javascript:;";a.onclick=function(){return false};img.src=imageSrc;span.innerHTML=title;a.appendChild(img);li.appendChild(a);li.appendChild(span);ul.appendChild(li);if(isNewUl){ele.appendChild(ul)}Core.Events.addEvent(img,callback,"click");Core.Events.addEvent(span,callback,"click")},setOpen:function(itemIds){var ele=$E(this.eleId);var className=ele.className;var arr=className.split(" ");if(arr.length<2){return}ele.className=arr[0];$E(this.content_id).style.display="block";this.setTitleBold(ele);this.closeOther(itemIds)},closeOther:function(itemIds){var len=itemIds.length;for(var i=0;i<len;i++){var eleTitle=$E(itemIds[i].title);var classNames=eleTitle.className.split(" ");eleTitle.className=classNames[0]+" down";this.setTitleBold(eleTitle);$E(itemIds[i].content).style.display="none"}},setTitleBold:function(titleEle){var ele=titleEle.getElementsByTagName("h2")[0];if(ele.className=="hB"){ele.className=""}else{ele.className="hB"}},initSwap:function(itemIds){Core.Events.addEvent($E(this.eleId),Core.Function.bind3(this.setOpen,this,[itemIds]),"click")}};Editor.Plugins.EditorTabs=Core.Class.create();Editor.Plugins.EditorTabs.prototype={tabs:{},initialize:function(containerId){this.containerId=containerId;this.tabManage=new Tabs($E("addTab"),{})},show:function(){$E(this.containerId).style.display="block";this.isShow=true},hidden:function(){$E(this.containerId).style.display="none";this.isShow=false},showTab:function(name){if(this.tabs[name]){if(!this.isShow){this.show()}this.abortAll();this.tabs[name].setFocus();this.tabs[name].show()}},addTab:function(data){this.abortAll();if(!this.tabs[data.name]){data.id=Core.Math.getUniqueId();var template='<span><a href="javascript:;" onclick="return false">#{title}</a><a class="closed" id="close_#{id}" onclick="return false" href="javascript:;"/></span>';var temp=new Ui.Template(template);this.tabs[data.name]=new Tab(temp.evaluate(data),{isFocus:true,className:"cur"});this.tabs[data.name]._id=data.id;this.tabManage.add(this.tabs[data.name]);this.tabs[data.name].addOnAbort(Core.Function.bind3(swapTab,this,[data.contentId,"hidden"]));this.tabs[data.name].addOnFocus(Core.Function.bind3(swapTab,this,[data.contentId]));Core.Events.addEvent($E("close_"+data.id),Core.Function.bind3(this.close,this,[data.id]),"click");if(data.callVote){if(data.callVote["remove"])Core.Events.addEvent($E("close_"+data.id),Core.Function.bind3(data.callVote["remove"],this,[data.id]),"click")}}this.showTab(data.name);if(data.callVote&&data.callVote["show"])data.callVote["show"]();function swapTab(tabContentId,type){if(type&&type=="hidden"){$E(tabContentId).style.display="none"}else{$E(tabContentId).style.display=""}}},addCloseCallbackFunc:function(name,func){this.tabs[name].closeFunc=func},abortAll:function(){for(var name in this.tabs){this.tabs[name].setAbort()}},close:function(id){Core.Events.stopEvent();var len=0;at=0;names=[];for(var name in this.tabs){names.push(name);if(this.tabs[name]._id==id){this.tabs[name].setAbort();if(this.tabs[name].closeFunc){this.tabs[name].closeFunc()}this.tabs[name].hidden();at=len}len++}if(len==1){this.hidden()}else{var isShow=false;for(var i=0;i<names.length;i++){if(this.tabs[names[i]].isShow){isShow=true;this.tabs[names[i]].setFocus();break}}if(!isShow){this.hidden()}}},removeTab:function(){}};if($IE6&&typeof Utils.Io.Ijax!="undefined"){Utils.Io.Ijax.loadData=function(url,option,loader){var _url=new Utils.Url(url);if(option.GET){for(var key in option.GET){_url.setParam(key,Core.String.encodeDoubleByte(option.GET[key]))}}if(!/\bdomain\b/.test(url)){_url.setParam("domain","1")}_url=_url.toString();var ifm=loader.container;ifm.listener=Core.Function.bind2(function(){try{var iframeObject=ifm.contentWindow.document,sResult;var tArea=Core.Dom.byClz(iframeObject,"textarea","")[0];if(typeof tArea!="undefined"){sResult=tArea.value}else{sResult=iframeObject.body.innerHTML}if(option.onComplete){option.onComplete(sResult)}else{option.onException()}}catch(e){traceError(e);if(option.onException){option.onException(e.message,_url.toString())}}loader.isBusy=false;Core.Events.removeEvent(ifm,ifm.listener,"load");this.loadByList()},this);Core.Events.addEvent(ifm,ifm.listener,"load");if(option.POST){var oIjaxForm=$C("form");oIjaxForm.id="IjaxForm";oIjaxForm.action=_url;oIjaxForm.method="post";oIjaxForm.target=ifm.id;for(var oItem in option.POST){var value;if(option.noEncode){value=Core.String.encodeDoubleByte(option.POST[oItem])}else{value=option.POST[oItem]}var oInput=$C("input");oInput.type="hidden";oInput.name=oItem;oInput.value=value;oIjaxForm.appendChild(oInput)}document.body.appendChild(oIjaxForm);var timenum=100;function innerfun(){if(timenum>0){try{oIjaxForm.submit()}catch(e){setTimeout(innerfun,10)}}timenum--}innerfun()}else{try{window.frames(ifm.id).location.href=_url}catch(e){ifm.src=_url}}}}var Interface=function(url,type){this.url=new Utils.Url(url);this.type=type.toLowerCase()};Interface.prototype={url:null,type:"",request:function(option){var err=option.onError;var suc=option.onSuccess;option.onComplete=option.onSuccess=function(result){try{if(typeof result=="string"){result=result.replace(/;$/,"")}result=typeof result=="string"&&/\s*{/.test(result)?Core.String.j2o(result):result;if(result!=null&&typeof result.code=="undefined"){trace("接口数据异常："+this.url,"#F00");return}if(result!=null){if(result.code=="A00006"){suc(result.data)}else{err(result)}}else{err(result)}}catch(e){traceError(e)}}.bind2(this);option.onException=option.onError=option.onFail||function(){trace("接口失败："+this.url,"#F00");if(arguments.length>0){for(var i=0,len=arguments.length;i<len;i++){if(arguments[i]&&typeof arguments[i]!="undefined"){trace("错误信息："+arguments[i].toString())}}}}.bind2(this);var requestURL=this.url.toString();switch(this.type){case"ijax":Utils.Io.Ijax.request(requestURL,option);break;case"ajax":Utils.Io.Ajax.request(requestURL,option);break;case"script":case"jsload":Utils.Io.JsLoad.request(requestURL,option);break;default:throw new Error("未指定有效的数据传输类型")}}};Editor.Plugins.Activity=Core.Class.create();Editor.Plugins.Activity.prototype={state:"init",activitys:[],games:[],initialize:function(containerId){this.initInterface();this.loadData()},initInterface:function(){this._interface=new Interface("http://control.blog.sina.com.cn/riaapi/activity/get_activity.php","ajax")},loadData:function(){var param={};this._interface.request({GET:param,onSuccess:function(_data){this.setDate(_data);this.addToMenu(_data)}.bind2(this),onError:function(_data){},onFail:function(){}})},addToMenu:function(_data){if(_data.activity){this.addMenuFunc(_data.activity_publish_pic,_data.activity_name,this.addTabFunc)}var len=this.games.length;for(var i=0;i<len;i++){this.addMenuFunc(this.games[i].picurl,this.games[i].name,Core.Function.bind3(this.addGameToEditor,this,[i]))}},addGameToEditor:function(num){var ele=$E("articleTitle");if(ele&&ele.value==""&&this.games[num].blogname){ele.value=this.games[num].blogname}editor.insertHTML(this.games[num].htmlcode)},addToMenuFunc:function(func){this.addMenuFunc=func},addTabFunc:function(func){this.addTabFunc=func},setDate:function(_data){for(var name in _data.activity){this.activitys.push(_data.activity[name])}for(var name in _data.game){_data.game[name].htmlcode=_data.game[name].htmlcode.replace(/(\.swf)/,"$1?uid="+scope.$uid);this.games.push(_data.game[name])}},setContentList:function(){var len=this.activitys.length;var html="";var tempHtml='<li>\r\n                  	<input value="#{id}" name="activity[]" type="checkbox" id="sc_check_#{id}"/>\r\n                  	<label for="sc_check_#{id}"><a target="_blank" href="#{url}">#{name}</a></label>\r\n                  </li>';var template=new Ui.Template(tempHtml);for(var i=0;i<len;i++){html+=template.evaluate(this.activitys[i])}Core.Dom.addHTML($E("ac_content"),html)},del:function(){winDialog.confirm($SYSMSG["B79009"],{funcOk:function(){this.unselect()}.bind2(this),funcCancel:function(){editorTabs.showTab("activity")}.bind2(this),textOk:"是",textCancel:"否",defaultButton:1,title:"提示",icon:"03"},"insertActivityTip");var dia=winDialog.getDialog("insertActivityTip");var closeBtn=dia.getNodes().btnClose;Core.Events.addEvent(closeBtn,function(){editorTabs.showTab("activity")},"click")},selectByIds:function(ids){if(ids&&ids.length>0){var len=ids.length;for(var i=0;i<len;i++){var ele=$E("sc_check_"+ids[i]);if(ele){ele.checked=true}}}},unselect:function(){var len=this.activitys.length;for(var i=0;i<len;i++){$E("sc_check_"+this.activitys[i].id).checked=false}},setConHtml:function(containerId){if(this.state!="finish"){var html=' <div class="Actit">\r\n                        <div class="fL">请选择你要参加的活动：</div>\r\n                      </div>\r\n					   <div class="AcInfo">\r\n                        <div class="AcInfoBg">\r\n                          <div class="chooseCurr">\r\n                            <ul id="ac_content"></ul>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <div class="clearit"></div>\r\n                  </div>';Core.Dom.addHTML($E(containerId),html);this.setContentList();this.selectByIds(articleEditorCFG.articleActivity);this.state="finish"}}};Core.Events.click=function(){var isMobile=/mobile/i.test(navigator.userAgent);if($IE&&$IE<9){return function(clickBtn){clickBtn.click()}}else{return function(clickBtn){var evt;if(isMobile){evt=document.createEvent("HTMLEvents")}else{evt=document.createEvent("MouseEvents")}evt.initEvent("click",true,true);clickBtn.dispatchEvent(evt)}}}();Ui.Pagination={config:{pageNode:null,nodeClassNamePrefix:"CP",curPage:1,maxPage:1,minPage:1,pageTpl:"@page@.html",type:1,showPrevNext:true,viewSize:5,dotIsPage:false,dotRate:5,showGoto:false,countTpl:"",language:"zh-cn",theme:1,showLastPage:true,showTotal:false},_list:{},_resource:{"en-us":["Pages (@data@): ","Go to First Page","Go to Previous Page (@data@)","Go to Page @data@","Go to Next Page (@data@)","Go to Last Page","Current Page in View"],"zh-cn":["共 @data@ 页","跳转至第一页","跳转至前 @data@ 页","跳转至第 @data@ 页","跳转至后 @data@ 页","跳转至最后一页","当前所在页"]},_template:'<li class="#{class}" title="#{title}">#{link}</li>',init:function(oOption){var node=$E(oOption.pageNode);if(node==null){trace("分页指定的父容器不存在");return}Ui.Pagination._list[node.id]={};var hash=Ui.Pagination._list[node.id];for(var key in this.config){hash[key]=oOption[key]===undefined?this.config[key]:oOption[key]}if(hash.type==2){hash.viewSize=4}hash.minPage=Math.min(hash.minPage,hash.maxPage)*1;hash.maxPage=Math.max(hash.minPage,hash.maxPage)*1;hash.curPage=hash.curPage>hash.maxPage?hash.minPage:hash.curPage;hash.curPage=hash.curPage*1;if(hash.curPage+hash.viewSize>=100){hash.viewSize=3}this._cache_node=hash;return this},show:function(oNode,nCurPage){nCurPage=nCurPage*1;var hash=this._cache_node;if(oNode!=null){this._cache_node=hash=Ui.Pagination._list[oNode.id];hash.curPage=nCurPage}var ambit=[];if(hash.viewSize*2+1>=hash.maxPage){ambit[1]=hash.minPage;ambit[2]=hash.maxPage}else if(hash.curPage<=hash.minPage+hash.viewSize){ambit[1]=hash.minPage;ambit[2]=hash.minPage+(hash.viewSize*2-1);ambit[3]=hash.maxPage}else if(hash.curPage>=hash.maxPage-hash.viewSize){ambit[0]=hash.minPage;ambit[1]=hash.maxPage-(hash.viewSize*2-1);ambit[2]=hash.maxPage}else{ambit[0]=hash.minPage;ambit[1]=hash.curPage-(hash.viewSize-1);ambit[2]=hash.curPage+(hash.viewSize-1);ambit[3]=hash.maxPage}var result=[];if(hash.countTpl!=null){result.push(this._createPage("","","","",hash.countTpl))}if(hash.type!=2&&hash.curPage!=hash.minPage){if(hash.type==3)result.push(this._createPage(hash.nodeClassNamePrefix+"_s_pgprev",hash.curPage-1,3,hash.curPage-1,"上页"));else result.push(this._createPage(hash.nodeClassNamePrefix+"_pgprev",hash.curPage-1,3,hash.curPage-1,"< 上一页"))}if(hash.type!=3){if(ambit[0]!=null){var str=ambit[0]==hash.curPage?this._createPage(hash.nodeClassNamePrefix+"_pgon",1,6,"",ambit[0]):this._createPage("",1,1,ambit[0],ambit[0]);result.push(str)}if(hash.type==1&&ambit[0]!=null){result.push(this._createPage(hash.nodeClassNamePrefix+"_pgelip","","","","..."))}for(var i=ambit[1];i<=ambit[2];i++){if(i==ambit[1]&&i!=hash.minPage&&hash.type==2){var LS=hash.curPage-hash.dotRate;LS=LS<hash.minPage?hash.minPage:LS;result.push(this._createPage(hash.nodeClassNamePrefix+"_pgelip",hash.viewSize+1,2,hash.curPage-hash.viewSize-1,"..."))}else if(i==ambit[2]&&i!=hash.maxPage&&hash.type==2){var RS=hash.curPage+hash.dotRate;RS=RS>hash.maxPage?hash.maxPage:RS;result.push(this._createPage(hash.nodeClassNamePrefix+"_pgelip",hash.viewSize+1,4,hash.curPage+hash.viewSize+1,"..."))}else{str=i==hash.curPage?this._createPage(hash.nodeClassNamePrefix+"_pgon",1,6,"",i):this._createPage("",i,3,i,i);result.push(str)}}if(hash.type==1&&ambit[3]!=null){result.push(this._createPage(hash.nodeClassNamePrefix+"_pgelip","","","","..."))}if(ambit[3]!=null&&hash.showLastPage){str=ambit[3]==hash.curPage?this._createPage(hash.nodeClassNamePrefix+"_pgon",hash.curPage-1,3,"",ambit[3]):this._createPage("",1,5,ambit[3],ambit[3]);result.push(str)}}else{result.push(this._createPage(hash.nodeClassNamePrefix+"_s_pgnum","","","","<strong>"+hash.curPage+"</strong>/"+hash.maxPage))}if(hash.type!=2&&hash.curPage!=hash.maxPage){if(hash.type==3)result.push(this._createPage(hash.nodeClassNamePrefix+"_s_pgnext",hash.curPage+1,3,hash.curPage+1,"下页"));else result.push(this._createPage(hash.nodeClassNamePrefix+"_pgnext",hash.curPage+1,3,hash.curPage+1,"下一页 >"))}if(hash.showTotal==true){result.push(this._createPage(hash.nodeClassNamePrefix+"_pgttl","","","","共"+hash.maxPage+"页"))}$E(hash.pageNode).innerHTML='<ul class="'+hash.nodeClassNamePrefix+'_pages">'+result.join("")+"</ul>"},_createPage:function(sClass,sTipPage,nTipIndex,nHrefPage,sHrefText){if(sHrefText==""){return""}var sTitle=sTipPage===""||nTipIndex==""?"":this._getTips(sTipPage,nTipIndex);var sLink=nHrefPage!==""?"<a "+this._getUrl(nHrefPage)+">"+sHrefText+"</a>":sHrefText;return this._template.replace(/(#\{\w+\})/g,function(a,b){switch(b){case"#{class}":return sClass;case"#{title}":return sTitle;case"#{link}":return sLink}})},showPage:function(sParentNodeID,nCurPage){this._cache_node=Ui.Pagination._list[sParentNodeID];var _autoShowPage=this._cache_node.pageTpl(nCurPage);if(_autoShowPage!=false){Ui.Pagination.show($E(sParentNodeID),nCurPage)}},_getUrl:function(idx){if(typeof this._cache_node.pageTpl=="string"){return'href="'+this._cache_node.pageTpl.replace(/@page@/,idx)+'"'}else{return"href=\"javascript:Ui.Pagination.showPage('"+this._cache_node.pageNode+"',"+idx+');"'}},_getTips:function(nPage,nIndex){return this._resource[this._cache_node.language][nIndex].replace(/@data@/g,nPage)}};Utils.Json={eval:function(str){return eval("("+str+")")},flatten:function(x){var self=Utils.Json;if(x==null)return null;else if(x.constructor.toString()==String)return self.str2json(x);else if(x.constructor.toString()==Array)return self.arr2json(x);else if(x.constructor.toString()==Object)return self.obj2json(x);else if(x.constructor.toString()==Boolean)return self.bool2json(x);else if(x.constructor.toString()==Number)return self.num2json(x);else if(x.constructor.toString()==Date)return self.date2json(x);else return null},arr2json:function(x){var self=Utils.Json;var p=[];var l=x.length;var t;for(var i=0;i<l;++i){t=self.flatten(x[i]);if(t)p.push(t)}return"["+p.join(",")+"]"},obj2json:function(x){var self=Utils.Json;var p=[];var t;for(var i in x){t=self.flatten(x[i]);if(t)p.push(self.flatten(i)+":"+t)}return"{"+p.join(",")+"}"},date2json:function(x){function f(n){return n<10?"0"+n:n}return'"'+x.getFullYear()+"-"+f(x.getMonth()+1)+"-"+f(x.getDate())+"T"+f(x.getHours())+":"+f(x.getMinutes())+":"+f(x.getSeconds())+'"'},stringify:function(jsonObject){var self=Utils.Json;return self.flatten(jsonObject)},parse:function(jsonStr){return Utils.Json.eval(jsonStr)},num2json:function(x){return x?String(x):"0"},bool2json:function(x){return String(x)},str2json:function(x){var m={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(/["\\\x00-\x1f]/.test(x)){return'"'+x.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];if(c)return c;c=b.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+x+'"'}};(function(){var getImgStaticPath=function(pid,type){if(!pid){return""}var type=type||"orignal";try{var num=eval("0X"+pid.substring(pid.length-2))%16+1;return"http://s"+num+".sinaimg.cn/"+type+"/"+pid}catch(e){trace("图片URL计算出错！PID:"+pid);return""}};window.getImgStaticPath=getImgStaticPath})();Core.Dom.getChildrenByClass=function(el,clz){var rs=[];var cldr=el.childNodes||el.children;var clz=" "+clz+" ";var len=cldr.length;for(var i=0;i<len;++i){var o=cldr[i];var ecl=" "+o.className+" ";if(ecl.indexOf(clz)!=-1){rs[rs.length]=o}}return rs};Editor.Plugins.ChangeCover=Core.Class.create();Editor.Plugins.ChangeCover.prototype={ITEM_ID:"cover_view_",COVER_ID:"img_view_",COVER_IMG_ID:"cover_img_",SAVE_ID:"save_cover_",CHANGE_ID:"change_cover_",initialize:function(){},initInterface:function(){this.list_interface=new Interface("http://control.blog.sina.com.cn/riaapi/photoblog/list_blogpic.php","ajax");this.save_interface=new Interface("http://control.blog.sina.com.cn/riaapi/photoblog/set_cover.php","ajax")},save:function(aid){var param={blog_id:aid};var selected=this.getSelected(aid);if(selected){param.pic_id=selected.id.split("_")[3]}else{showError("请选择一个封片");return false}this.save_interface.request({GET:param,onSuccess:function(_data){articleAssociate.articleList[aid].imagePath=getImgStaticPath(param.pic_id,"small");this.set(aid,param.pic_id);this.swapView(aid)}.bind2(this),onError:function(_data){showError(_data.code)},onFail:function(){}})},swapTipMode:function(aid){$E("img_view_"+aid).style.display="none";$E("cc_tip_"+aid).style.display="";$E("save_cover_"+aid).style.display="none";$E("back_cover_"+aid).style.display="";$E("change_cover_"+aid).style.display="none"},loadData:function(aid){if(!this.list_interface){this.initInterface()}var param={blog_id:aid};this.list_interface.request({GET:param,onSuccess:function(_data){if(_data.length<1){this.swapTipMode(aid)}else{this.buildList(_data,aid);this.swapView(aid)}}.bind2(this),onError:function(_data){showError(_data.code)},onFail:function(){}})},renderList:function(aid){this.loadData(aid)},set:function(aid,pid){var ele=$E(this.COVER_IMG_ID+aid);ele.src=getImgStaticPath(pid,"small")},swapView:function(aid){var changeModeEle=$E(this.ITEM_ID+aid);var showModeEle=$E(this.COVER_ID+aid);var saveBtnEle=$E(this.SAVE_ID+aid);var changeBtnEle=$E(this.CHANGE_ID+aid);if(changeModeEle.style.display=="none"){showModeEle.style.display="none";changeBtnEle.style.display="none";changeModeEle.style.display="";saveBtnEle.style.display=""}else{changeModeEle.style.display="none";saveBtnEle.style.display="none";showModeEle.style.display="";changeBtnEle.style.display=""}},getPicBySrc:function(src){return src.replace(/(.*?)\/(\w{16,21})[\^?&]?/,"$2")},initTemplate:function(){if(this.template){return}tempHtml='<span class="#{cls}" id="cover_item_#{aid}_#{pic_id}">\r\n			<a href="javascript:void(0)">\r\n				<img alt="" src="#{imgPath}" id="cover_#{aid}_#{pic_id}">\r\n			</a>\r\n			<img height="18" align="absmiddle" width="18" title="选中" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon106">\r\n		</span>';this.template=new Ui.Template(tempHtml)},buildList:function(data,aid){var container=$E(this.ITEM_ID+aid);var len=data.length;var select_pid=this.getPicBySrc($E(this.COVER_IMG_ID+aid).src);container.innerHTML="";this.initTemplate();for(var i=0;i<len;i++){if(select_pid==data[i].pic_id){data[i].cls="selected"}else{data[i].cls=""}data[i].imgPath=getImgStaticPath(data[i].pic_id,"small");data[i].aid=aid;Core.Dom.addHTML(container,this.template.evaluate(data[i]));Core.Events.addEvent($E("cover_"+aid+"_"+data[i].pic_id),this.select.bind2(this))}},select:function(){var ele=Core.Events.getEventTarget();var arr=ele.id.split("_");var aid=arr[1];var pid=arr[2];var container=$E(this.ITEM_ID+aid);var selected=this.getSelected(aid);if(selected){selected.className=""}$E("cover_item_"+aid+"_"+pid).className="selected"},getSelected:function(aid){var container=$E(this.ITEM_ID+aid);var list=Core.Dom.getChildrenByClass(container,"selected");if(list[0]){return list[0]}return null}};Editor.Plugins.ArticleAssociate=Core.Class.create();Editor.Plugins.ArticleAssociate.prototype={select:[],articleList:{},tipType:"cate",showType:"txt",state:"",initialize:function(containerId,status){this.containerId=containerId;this.initHtml();if(scope.$is_photo_vip){trace("Vip");$E("showType_container").style.display="";if($E("assoc_style").value==0){this.showType="img"}this.swapShowView()}var isEdit=/article_edit.php/.test(location.pathname);this.tbhStatus=0;this.loadDataCount=0;this.initOption();this.initInterface();this.initEvent();this.setNumTip()},initSelectbyCookie:function(){var selectCookie=decodeURIComponent(Utils.Cookie.getCookie("article_associate_"+scope.$uid));if(selectCookie&&selectCookie!=""){this.select=selectCookie.split(",");this.cookieData=this.getDataFormCookie();this.setNumTip()}},initInterface:function(){this.txt_interface=new Interface("http://control.blog.sina.com.cn/riaapi/associate/get_articles.php","ajax");this.img_interface=new Interface("http://control.blog.sina.com.cn/riaapi/associate/get_articles_xrank.php","ajax")},setState:function(type){if(type=="operate"){if(this.showType=="txt"){$E("operate_list_view").style.display="none";$E("operate_list_o").parentNode.style.display="block"}else{$E("operate_img_list_view").parentNode.style.display="none";$E("operate_img_list").parentNode.style.display="block"}$E("view_operate").style.display="none";$E("operate_info").style.display="block";$E("operate_select").style.display="block";$E("add_container").style.display="block";this.state="operate"}else if(type=="view"){$E("operate_select").style.display="none";$E("operate_info").style.display="none";$E("add_container").style.display="none";if(this.showType=="txt"){$E("operate_list_view").style.display="block";$E("operate_list_o").parentNode.style.display="none"}else{$E("operate_img_list_view").parentNode.style.display="block";$E("operate_img_list").parentNode.style.display="none"}$E("view_operate").style.display="block";this.state="view"}},initEvent:function(){Core.Events.addEvent($E("unselect"),this.unselect.bind2(this),"click");Core.Events.addEvent($E("article_add"),this.add.bind2(this),"click");Core.Events.addEvent($E("modify"),this.modify.bind2(this),"click");Core.Events.addEvent($E("showType_select_options"),this.swapShowType.bind2(this),"change")},modify:function(){this.setState("operate");if(this.showType=="txt"&&!$E("operate_list_content").firstChild||this.showType=="img"&&!$E("operate_img_list").firstChild){this.initList();this.setNumTip()}$E("operate_list_view_ul").innerHTML=""},del:function(){winDialog.confirm($SYSMSG["B79004"],{funcOk:function(){this.remove()}.bind2(this),funcCancel:function(){editorTabs.showTab("article")}.bind2(this),textOk:"是",textCancel:"否",defaultButton:1,title:"提示",icon:"04"},"articleAssociateTip");var dia=winDialog.getDialog("articleAssociateTip");var closeBtn=dia.getNodes().btnClose;Core.Events.addEvent(closeBtn,function(){editorTabs.showTab("article");

},"click")},remove:function(){this.select=[];this.articleList={};this.selectCate=0;this.modify();this.setNumTip();$E("cate_select_options").options[0].selected=true;this.loadDataCount=0;this.loadData()},add:function(){var len=this.select.length;if(len<1){return}var templateHtml,ele;if(this.showType=="txt"){templateHtml='<li><label>#{r}#{w}<a target="_blank" href="http://blog.sina.com.cn/s/blog_#{i}.html">#{t}</a>#{m}#{p}#{v}</label><span>#{d}</span></li>';ele=$E("operate_list_view_ul")}else{templateHtml='<div class="myPhotoblog_cell">\r\n			  <div class="myPhotoblog_view">\r\n			    <div class="myPhotoblog_area">\r\n			      <table border="0" cellspacing="0" cellpadding="0">\r\n			        <tr>\r\n			          <td><img src="#{imagePath}" /></td>\r\n			        </tr>\r\n			      </table>\r\n			    </div>\r\n			  </div>\r\n			  <div class="myPhotoblog_nm">\r\n						#{r}#{w}\r\n						<a target="_blank" href="http://blog.sina.com.cn/s/blog_#{i}.html">#{t}</a>\r\n						#{m}#{v}\r\n			  </div>\r\n			</div>';ele=$E("operate_img_list_view")}var template=new Ui.Template(templateHtml);ele.innerHTML=this.sortSelect(template);this.setState("view")},sortSelect:function(template){var html="";var len=this.select.length;var artArr=new Array(len);for(var i=0;i<len;i++){var data=this.articleList[this.select[i]];artArr[i]=data}for(var m=0;m<len;m++){for(var n=1;n<len;n++){if(comptime(artArr[n-1].d,artArr[n].d)=="bigger"){var temp=artArr[n-1];artArr[n-1]=artArr[n];artArr[n]=temp}}}var at=0;for(var q=len-1;q>=0;q--){artArr[q]=this.formatCover(artArr[q]);if(at!=0&&at%4==0){html+='<div class="clearit"></div>'}at++;html+=template.evaluate(artArr[q])}return html},compare:function(data){var s_len=this.select.length;var d_len=data.length;if(s_len==d_len){for(var i=0;i<s_len;i++){if(this.select[i]!=data[i].i){return false}}}else{return false}return true},page:function(pageNum,cate,count){var pageCount=10;if(this.showType=="img"){pageCount=8}var maxPage=Math.ceil(count/pageCount,pageCount);if(maxPage>1){Ui.Pagination.init({pageNode:"article_page",nodeClassNamePrefix:"SG",curPage:pageNum,maxPage:maxPage,pageTpl:this.loadData.bind2(this),type:1}).show()}else{$E("article_page").innerHTML=""}},unselect:function(){var len=this.select.length;for(var i=0;i<len;i++){var c;if(this.showType=="txt"){c=$E("Chb_"+this.select[i])}else{c=$E("Chb_i_"+this.select[i])}if(c){c.checked=false}}this.select=[];this.setNumTip()},waitStart:function(){$E("operate_list_o").style.display="none";$E("operate_list_loading").style.display="block"},waitEnd:function(){$E("operate_list_loading").style.display="none";$E("operate_list_o").style.display="block"},loadData:function(page){var page=page||1;var cate=this.selectCate||0;var param={uid:scope.$uid,s:10,p:page,c:cate,random:Math.random()};if(this.showType!="txt"){param.x="img";param.s=8;this._interface=this.img_interface}else{this._interface=this.txt_interface}this.waitStart();this._interface.request({GET:param,onSuccess:function(_data){var count,data;if(this.showType!="txt"){count=_data.count;data=_data.result}else{count=this.cates[cate].count;data=_data}if(count){this.setOption(count)}this.loadDataCount++;this.parseData(data);this.waitEnd();this.page(page,cate,count)}.bind2(this),onError:function(_data){showError(_data.code)},onFail:function(){}})},initList:function(){var ele=Core.Events.getEventTarget();if("select"==ele.nodeName.toLowerCase()){this.selectCate=ele.value}this.loadData(1)},setOption:function(count){if(this.showType=="img"){$E("aa_option").innerHTML="图片博文("+count+")"}else{$E("aa_option").innerHTML="全部博文("+count+")"}},initOption:function(){var data=articleEditorCFG.articleAssociate;this.cates=data.cates||{};this.createOption("全部博文",data.total||0,"0","aa_option");for(name in this.cates){var n=this.cates[name].name;var c=this.cates[name].count;var i=this.cates[name].id;if(n&&typeof c!="undefinded"&&typeof i!="undefinded"){this.createOption(n,c,i)}}this.cates["0"]={name:"全部博文",count:data.total||0};Core.Events.addEvent($E("cate_select_options"),this.initList.bind2(this),"change")},createOption:function(name,count,value,id){var option=$C("option");if(id){option.id=id}option.innerHTML=name+"("+count+")";option.value=value;$E("cate_select_options").appendChild(option)},selectArticle:function(){var ele=Core.Events.getEventTarget();var len=10;if(this.showType=="img"){len=8}if(ele.checked){if(this.select.length>=len){Core.Events.stopEvent();showError("B78001");return}if(this.showType=="txt"){this.select.push(ele.id.split("_")[1])}else{this.select.push(ele.id.split("_")[2])}}else{if(this.showType=="txt"){this.select=Core.Array.ArrayWithout(this.select,ele.id.split("_")[1])}else{this.select=Core.Array.ArrayWithout(this.select,ele.id.split("_")[2])}}this.setNumTip()},setNumTip:function(){var countLen=10;if(this.showType=="img"){countLen=8}var len=this.select.length;if(len>0){this.showUnselect();this.disabledAddButton()}else{this.hiddenUnselect();this.disabledAddButton(true)}$E("num_s").innerHTML=this.select.length;$E("num_l").innerHTML=countLen-this.select.length},disabledAddButton:function(isTrue){var isTrue=isTrue||false;var ele=$E("article_add").parentNode;if(isTrue){ele.className="SG_aBtn SG_aBtn_dis"}else{ele.className="SG_aBtn SG_aBtnB"}},showUnselect:function(){$E("unselect_container").style.display=""},hiddenUnselect:function(){$E("unselect_container").style.display="none"},save:function(){var value=this.select.join(",");$E("assoc_article").value=value;if(this.historyData){if(this.compare(this.historyData)){return}}},getDataFormCookie:function(){var data_str=Utils.Cookie.getCookie("article_associate_data_"+scope.$uid);return Core.String.j2o(unescape(data_str))},saveDataToCookie:function(){var data={};var len=this.select.length;for(var i=0;i<len;i++){data[this.select[i]]=this.articleList[this.select[i]]}var data_str=Utils.Json.flatten(data);Utils.Cookie.setCookie("article_associate_data_"+scope.$uid,data_str,999)},saveSeleteData:function(){var len=this.select.length;var array=[];for(var i=0;i<len;i++){array.push(Utils.Json.flatten(this.articleList[this.select[i]]))}$E("assoc_article_data").value=array.join(",")},formatData:function(data){if(data.r){data.r='<img height="18" width="18" align="absmiddle" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon107"/>'}if(data.w){data.w='<a href="http://news.sina.com.cn/437/2008/0703/24.html" target="_blank"><img height="18" width="18" title="手机博文" align="absmiddle" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon105"/></a>'}if(data.p){data.p='<img height="15" width="15" align="absmiddle" title="此博文包含图片" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon18"/>'}if(data.m){data.m='<img height="15" width="15" align="absmiddle" title="此博文包含视频" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon16"/>'}if(data.v){data.v='<img height="15" width="15" align="absmiddle" title="此博文包含投票" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon33"/>'}return data},parseData:function(data){if(this.showType=="txt"){this.parseTxtData(data)}else{this.parseImgData(data)}},changeCover:function(){var ele=Core.Events.getEventTarget();var aid=ele.id.split("_")[2];if(!this.ccObj){this.ccObj=new Editor.Plugins.ChangeCover}this.ccObj.renderList(aid)},saveCover:function(){var ele=Core.Events.getEventTarget();var aid=ele.id.split("_")[2];this.ccObj.save(aid)},backCover:function(){var ele=Core.Events.getEventTarget();var aid=ele.id.split("_")[2];ele.style.display="none";$E("change_cover_"+aid).style.display="";$E("img_view_"+aid).style.display="";$E("cc_tip_"+aid).style.display="none";$E("back_cover_"+aid).style.display="none"},parseImgData:function(data){var ele=$E("operate_img_list");if(data){ele.innerHTML=""}else{ele.innerHTML="<strong>此分类尚无博文，请选择其他分类</strong>";return}var len=data.length;var tempHtml='<div class="myPhotoblog_cell">\r\n		  <div class="myPhotoblog_view">\r\n		    <div class="myPhotoblog_area" id="img_view_#{i}">\r\n		      <table border="0" cellspacing="0" cellpadding="0">\r\n		        <tr>\r\n		          <td><img id="cover_img_#{i}" src="#{imagePath}" /></td>\r\n		        </tr>\r\n		      </table>\r\n		    </div>\r\n			<div id="cc_tip_#{i}" class="myPhotoblog_txt SG_clewtxta" style="display:none">抱歉！<br>该篇博文内的所有图片来自站外，无法更换封面。</div>\r\n			<div class="myPhotoblog_coverlist" id="cover_view_#{i}" style="display:none"></div>\r\n		  </div>\r\n		  <div class="myPhotoblog_cover"><a id="change_cover_#{i}" href="javascript:void(0)">换封面</a><a id="save_cover_#{i}" href="javascript:void(0)" style="display:none">保存封面</a><a id="back_cover_#{i}" href="javascript:void(0)" style="display:none">返回</a></div>\r\n		  <div class="myPhotoblog_nm">\r\n		    <input  #{selected} type="checkbox" id="Chb_i_#{i}" />\r\n		    <label for="Chb_i_#{i}">\r\n					#{r}#{w}\r\n					<a target="_blank" href="http://blog.sina.com.cn/s/blog_#{i}.html">#{t}</a>\r\n					#{m}#{v}\r\n			</label>\r\n		  </div>\r\n		</div>';for(var i=0;i<len;i++){data[i]=this.formatData(data[i]);data[i]=this.formatCover(data[i]);if(Core.Array.findit(this.select,data[i].i)!=-1){data[i].selected="checked"}else{data[i].selected=""}var temp;var at=i+1;if(at%4==0){temp=new Ui.Template(tempHtml+'<div class="clearit"></div>')}else{temp=new Ui.Template(tempHtml)}Core.Dom.addHTML(ele,temp.evaluate(data[i]));if(!this.articleList[data[i].i]){this.articleList[data[i].i]=data[i]}Core.Events.addEvent($E("Chb_i_"+data[i].i),this.selectArticle.bind2(this),"click");Core.Events.addEvent($E("change_cover_"+data[i].i),this.changeCover.bind2(this),"click");Core.Events.addEvent($E("save_cover_"+data[i].i),this.saveCover.bind2(this),"click");Core.Events.addEvent($E("back_cover_"+data[i].i),this.backCover.bind2(this),"click")}},formatCover:function(data){if(data.imagePath){return data}if(data.cover){if(data.cover.length>30){data.imagePath=data.cover}else{data.imagePath=getImgStaticPath(data.cover,"small")}}else{data.imagePath="http://simg.sinajs.cn/blog7style/images/common/photoblog_default.gif"}return data},parseTxtData:function(data){var ele=$E("operate_list_content");var select_value=$E("cate_select_options").value;ele.innerHTML="";if(!data){if(select_value=="0"&&this.tipType!="all"){this.setTip("all")}if(select_value!="0"&&this.tipType!="cate"){this.setTip("cate")}$E("operate_list_none").style.display="block";return}$E("operate_list_none").style.display="none";var len=data.length;var __addEvent=Core.Events.addEvent;var __addHTML=Core.Dom.addHTML;var __click=Core.Events.click;var clickCount=0;for(var i=0;i<len;i++){data[i]=this.formatData(data[i]);if(Core.Array.findit(this.select,data[i].i)!=-1){data[i].selected="checked"}else{data[i].selected=""}var template='<li><input #{selected} type="checkbox" id="Chb_#{i}"/>\r\n	            <label>#{r}#{w}\r\n					<a target="_blank" href="http://blog.sina.com.cn/s/blog_#{i}.html">#{t}</a>\r\n					#{m}#{p}#{v}\r\n				</label>\r\n	            <span>#{d}</span>\r\n			</li>';var temp=new Ui.Template(template);__addHTML(ele,temp.evaluate(data[i]));if(!this.articleList[data[i].i]){this.articleList[data[i].i]=data[i]}__addEvent($E("Chb_"+data[i].i),this.selectArticle.bind2(this),"click");if(clickCount<5&&1===this.loadDataCount){__click($E("Chb_"+data[i].i));clickCount++}}},history:function(data){this.historyData=data||[];this.select=[];var len=this.historyData.length;for(var i=0;i<len;i++){this.select.push(this.historyData[i].i);this.articleList[this.historyData[i].i]=this.formatData(this.historyData[i])}this.swapShowView()},setTip:function(type){var type=type||"cate";var ele=$E("operate_list_none");switch(type){case"cate":ele.innerHTML=$SYSMSG["B79007"];break;case"all":ele.innerHTML=$SYSMSG["B79008"];break}this.tipType=type},swapShowType:function(){var ele=Core.Events.getEventTarget();trace(ele.value);if(ele.value!=this.showType){this.showType=ele.value;this.swapShowView();this.articleList={};this.select=[];this.setNumTip();this.loadData()}},swapShowView:function(){if(this.showType=="txt"){$E("operate_img_list").parentNode.style.display="none";$E("operate_list").style.display="";$E("assoc_style").value=1}else{$E("operate_list").style.display="none";$E("operate_img_list").parentNode.style.display="";$E("assoc_style").value=0}$E("showType_select_options").value=this.showType},initHtml:function(){var html='\r\n			<div class="Actit" id="operate_select">\r\n			  <div class="fL">请选择要添加的文章：</div>\r\n			   <div class="fR">\r\n			   	<span id="showType_container" style="display:none">\r\n					<span>展现方式：</span>\r\n				    <select id="showType_select_options">\r\n						<option value="img" selected="selected">图片</option>\r\n						<option value="txt">文字</option>\r\n				    </select>\r\n				</span>\r\n			 <span>分类：</span>\r\n			    <select id="cate_select_options">\r\n			    </select>\r\n				 <select id="img_cate_select_options" style="display:none">\r\n			    </select>\r\n			  </div>\r\n			</div>\r\n			<div style="display: none;" class="Actit Actit1" id="view_operate">\r\n			  <div class="fL">我的更多文章： <a href="javascript:;" onclick="return false" class="CP_a_fuc">[<cite id="modify">修改</cite>]</a><!-- <a href="javascript:;" onclick="return false"  class="CP_a_fuc">[<cite id="delete">删除</cite>]</a>--></div>\r\n			</div>\r\n			<div class="AcInfo" id="operate_list">\r\n			  <div class="AcInfoBg">\r\n			    <div style="" class="chooseCurr" id="operate_list_o">\r\n			      <ul id="operate_list_content"></ul>\r\n			    </div>\r\n			    <div style="display: none;" class="nodate SG_txtb" id="operate_list_loading">\r\n			      <div class="loading"><img title="加载中" src="http://simg.sinajs.cn/blog7style/images/common/loading.gif"/><br/>\r\n			        读取中…</div>\r\n			    </div>\r\n				<div style="display:none;" class="nodate SG_txtb" id="operate_list_none">\r\n					<strong>此分类尚无博文，请选择其他分类</strong>\r\n			    </div>\r\n			    </div>\r\n			  </div>\r\n			   <div class="myPhotoblog" style="display:none"><div class="myPhotoblog_list" id="operate_img_list"></div>\r\n			   <div class="myPhotoblog_help">\r\n                          	<p><strong>帮助：</strong></p>\r\n                            <p class="SG_dot">以图片方式添加博文，是我们为VIP用户提供的特殊服务。</p>\r\n                            <p class="SG_dot">系统默认您博文中的第一张图片为该博文的“封面”。</p>\r\n                            <p class="SG_dot">点击“换封面”可以为您的封面换一张图。</p>\r\n                            <p class="SG_dot">您只能对新浪域下的图片进行此项设置。</p>\r\n                          </div>\r\n			   </div>\r\n			  <div style="display: none;" id="operate_list_view" class="chooseOk">\r\n			    <ul id="operate_list_view_ul"></ul>\r\n			  </div>\r\n			  <div class="myPhotoblog" style="display:none"><div class="myPhotoblog_list" id="operate_img_list_view"></div></div>\r\n			  <div class="noteInfo" id="operate_info">\r\n			    <div class="fL"><span class="SG_txtc">已选<span id="num_s">0</span>篇，还可以选<span id="num_l">10</span>篇 </span><a style="display:none" id="unselect_container" href="javascript:;" onclick="return false"  class="CP_a_fuc">[<cite id="unselect">重选</cite>]</a></div>\r\n			    <div class="fR" id="article_page"></div>\r\n			  </div>\r\n			</div>\r\n			<div class="AcInfoBtn" id="add_container"><a href="javascript:;"   onclick="return false" class="SG_aBtn SG_aBtn_dis"><cite id="article_add">添加</cite></a></div>';$E(this.containerId).innerHTML=html}};function comptime(beginTime,endTime){var beginTimes=beginTime.substring(0,10).split("-");var endTimes=endTime.substring(0,10).split("-");beginTime=beginTimes[1]+"/"+beginTimes[2]+"/"+beginTimes[0]+" "+beginTime.substring(10,19);endTime=endTimes[1]+"/"+endTimes[2]+"/"+endTimes[0]+" "+endTime.substring(10,19);var a=(Date.parse(endTime)-Date.parse(beginTime))/3600/1e3;if(a<0){return"bigger"}else if(a>0){return"smaller"}else if(a==0){return"equal"}else{return"exception"}}Editor.Plugins.InsertStock=Core.Class.create();Editor.Plugins.InsertStock.prototype={initialize:function(containerId){this.id=Core.Math.getUniqueId();this.f_isReady=true;this.initDialog();this.initData();Core.Events.addEvent($E("stock_save_"+this.id),this.uploadImage.bind2(this));this.initUploadFlash()},initData:function(){var url="http://www.sinaimg.cn/cj/financewidget/js/SuggestServer_3_0_17.js";Utils.Io.JsLoad.request(url,{onComplete:function(){this.initSuggest();Core.Events.addEvent($E("stock_search_"+this.id),function(){$E("stock_submit_"+this.id).click()}.bind2(this),"click")}.bind2(this),onException:function(){},charset:"gb2312",isRemove:false})},initDialog:function(){var tpl=['<table id="#{entity}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}"></strong>','<cite><a title="关闭" class="CP_w_shut" id="#{btnClose}" href="javascript:;" onclick="return false">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span/></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}">',"</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join("");this.dialog=winDialog.createCustomsDialog({tpl:tpl,title:"插入股票走势",content:this.initHtml(),renderer:Ui.SimpleRenderer,width:500},"tips");this.dialog.setAreaLocked(true).show().addEventListener("beforeShow",function(){this.setMiddle()})},setTip:function(type){var ele=$E("stock_tip_"+this.id);switch(type){case"error":ele.innerHTML='<span class="SG_clewtxta">没找到符合结果的股票，请确认其在沪深A股中</span>';break;case"init":ele.innerHTML='<span class="SG_txtc">轻松两步，日K、周k与分时尽呈现。目前支持沪深A股股票。</span>';break}},initSuggest:function(){this.suggestServer=new SuggestServer;this.suggestServer.bind({input:"inputSuggest",value:"@2@",type:"11",max:8,width:267,head:["选项","代码","中文名称"],body:[-1,2,4],callback:this.callback.bind2(this)})},fillCode:function(__objectResult){$E("divGetCodeResult").innerHTML="type:"+typeof __objectResult+"<br />"+(__objectResult==""?"[空串]":__objectResult)},submitCallback:function(data){if(data!=""){insertStock.parseData(data.split(";")[0])}else{insertStock.setTopView();insertStock.setTip("error")}return false},callback:function(param1){insertStock.suggestServer.getCode(param1,this.parseData.bind2(this))},parseData:function(data){var array=data.split(",");this.code=array[3];this.setStockImage();this.setNextView();if(!this.initEvent){this.bindOperateEvent();this.initEvent=true}},bindOperateEvent:function(){Core.Events.addEvent($E("stock_min_"+this.id),Core.Function.bind3(this.setStockImage,this,["min"]));Core.Events.addEvent($E("stock_daily_"+this.id),Core.Function.bind3(this.setStockImage,this,["daily"]));Core.Events.addEvent($E("stock_weekly_"+this.id),Core.Function.bind3(this.setStockImage,this,["weekly"]));Core.Events.addEvent($E("stock_monthly_"+this.id),Core.Function.bind3(this.setStockImage,this,["monthly"]))},setNextView:function(){this.setSize(500,412);$E("stock_h4_"+this.id).style.display="none";$E("stock_tip_"+this.id).style.display="none";$E("stock_type_"+this.id).style.display="block";$E("stock_image_a_"+this.id).parentNode.style.display="block";this.swapButtonState()},setTopView:function(){this.setSize(500,130);$E("stock_type_"+this.id).style.display="none";$E("stock_image_a_"+this.id).parentNode.style.display="none";$E("stock_h4_"+this.id).style.display="block";$E("stock_tip_"+this.id).style.display="block";this.swapButtonState(true)},setStockImage:function(type){var ele=$E("stock_image_a_"+this.id);var html;var type=type||"min";switch(type){case"min":html="<img id='stock_image_"+this.id+"' src='http://image2.sinajs.cn/newchart/min/"+this.code+".gif'/>";$E("stock_min_"+this.id).checked=true;break;case"daily":html="<img id='stock_image_"+this.id+"' src='http://image2.sinajs.cn/newchart/daily/"+this.code+".gif'/>";break;case"weekly":html="<img id='stock_image_"+this.id+"' src='http://image2.sinajs.cn/newchart/weekly/"+this.code+".gif'/>";break;case"monthly":html="<img id='stock_image_"+this.id+"' src='http://image2.sinajs.cn/newchart/monthly/"+this.code+".gif'/>";break}ele.innerHTML=html;ele.href="http://finance.sina.com.cn/realstock/company/"+this.code+"/nc.shtml";ele.parentNode.style.display="block"},setSize:function(width,height){this.dialog.setSize(width,height)},show:function(){this.clearInput();this.dialog.show()},clearInput:function(){var ele=$E("inputSuggest");if(ele.value!=""&&ele.value!="请输入股票代码或股票名称"){ele.value=""}this.setTip("init")},hidden:function(){this.dialog.hidden()},uploadImage:function(){var _this=this;function uploadStcockImg(ticket){var ele=$E("stock_image_"+_this.id);if(_this.buttonState){return}if(ele.src.indexOf("/min/")==-1){editor.insertHTML("<div style='text-align:center;'>"+$E("stock_image_a_"+_this.id).parentNode.innerHTML+"</div><br/>");_this.hidden();return}if(!_this.uploading&&ele.src!=""){var clearId=setInterval(function(){if(this.f_isReady){clearInterval(clearId);var uplaodUrl="http://upload.photo.sina.com.cn/interface/pic_upload.php?data=1&app=blog&s=json&mime=image/jpeg&sess="+encodeURIComponent(__SINAPRO__);this.getMovie("uploadstockflash_"+this.id).intoflash(ele.src,uplaodUrl,ticket);this.uploading=true}}.bind2(_this),50)}}Lib.Ticket.get(function(oData){uploadStcockImg(oData["ticket"][0])},1,"blog","tupian")},insertToEditor:function(data){var url;data.replace(/"pid":"(\w*)"/g,function(a,b){url=b});var num=parseInt("0x"+url.substring(url.length-2))%16+1;var imgUrl="http://s"+num+".sinaimg.cn/orignal/"+url;var innerHTMLTmp=["<div style='text-align:center;'>","<a title='查看股票行情' href='http://finance.sina.com.cn/realstock/company/",this.code,"/nc.shtml' target='_blank'>","<img id='stock_image_",this.id,"' src='",imgUrl,"'/>","</a></div><br/>"].join("");editor.insertHTML(innerHTMLTmp);this.uploading=false;this.hidden()},initUploadFlash:function(){this.buildFlashContainer();var swf_url=$_GLOBAL.flashBasicURL+"uploadv2.swf?callback=insertStock.insertToEditor&isready=insertStockIsReady&flashisready=insertStock.flashIsReady";var x=Utils.Flash.swfView.Add(swf_url,"uploadstock_"+this.id,"uploadstockflash_"+this.id,this.width,this.height,"9.0.0.0","#000",{callback:"insertStock.insertToEditor",isready:"insertStockIsReady",flashisready:"insertStock.flashIsReady"},{scale:"showall",loop:"true",play:"true",pluginspage:"http://www.macromedia.com/go/getflashplayer",allowScriptAccess:"always",wmode:"transparent",allowFullScreen:"false",wmode:"transparent"})},buildFlashContainer:function(){var html='<div id="uploadstock_'+this.id+'" style="width:1px;height:1px;overflow:hidden;position:absolute;top:'+this.dialog.getY()+"px;left:"+this.dialog.getX()+'px"></div>';Core.Dom.addHTML(document.body,html)},flashIsReady:function(){this.f_isReady=true;return true},swapButtonState:function(isOff){var isOff=isOff||false;this.buttonState=isOff;if(isOff){$E("stock_save_"+this.id).parentNode.className="SG_aBtn SG_aBtn_dis SG_aBtn_sub";$E("stock_btn_"+this.id).style.display="none"}else{$E("stock_save_"+this.id).parentNode.className="SG_aBtn SG_aBtnB SG_aBtn_sub";$E("stock_btn_"+this.id).style.display="block"}},getMovie:function(movieName){if(navigator.appName.indexOf("Microsoft")!=-1){return window[movieName]}else{return document[movieName]}},initHtml:function(){var html='\r\n		<div class="insetfinance">\r\n          <h4 id="stock_h4_#{id}">请输入股票代码或股票名称：</h4>\r\n          <div class="searchModule">\r\n		  	<form id="stock_form_#{id}" action="http://biz.finance.sina.com.cn/suggest/lookup_n.php"\r\n			  method="get" \r\n			  style="position:relative; zoom:1; z-index:100;" \r\n			  onreset="return function (__from) {insertStock.suggestServer.getCode(__from.q.value, insertStock.fillCode); return false;}(this);"\r\n          	  onsubmit="return function (__from) {insertStock.suggestServer.getCode(__from.q.value, insertStock.submitCallback); return false;}(this);">\r\n		    <div class="p1">\r\n             <input type="hidden" name="country" value="stock" />\r\n			  <input type="text" id="inputSuggest" name="q" class="txt" value="请输入股票代码或股票名称" />\r\n              <a href="javascript:;" class="SG_aBtn SG_aBtnB SG_aBtn_sub">\r\n			  	<cite id="stock_search_#{id}">搜索\r\n              		<input id="stock_submit_#{id}" type="submit" value="搜索" id="categorySave"/>\r\n              	</cite>\r\n			  </a>\r\n			</div>\r\n			 </form>\r\n            <p class="p2" id="stock_tip_#{id}">\r\n				<span class="SG_txtc">能加进股票的实时变化K线图，更有日K、周K等帮你分析讲解。</span>\r\n			</p>\r\n			<div id="divGetCodeResult" class="finList" style="display:none"></div>\r\n          </div>\r\n          <div class="fPicType" id="stock_type_#{id}" style="display:none">\r\n            <dl>\r\n              <dt>类型选择：</dt>\r\n              <dd>\r\n                <input id="stock_min_#{id}" type="radio" name="rdo"/>\r\n                <label for="stock_min_#{id}">分时图</label>\r\n                <input id="stock_daily_#{id}" type="radio" name="rdo"/>\r\n                <label for="stock_daily_#{id}">日K线</label>\r\n                <input id="stock_weekly_#{id}" type="radio" name="rdo"/>\r\n                <label for="stock_weekly_#{id}">周K线</label>\r\n                <input id="stock_monthly_#{id}" type="radio" name="rdo"/>\r\n                <label for="stock_monthly_#{id}">月K线</label>\r\n              </dd>\r\n            </dl>\r\n          </div>\r\n          <div class="fPic" style="display:none"><a title="查看股票行情" target="_blank" id="stock_image_a_#{id}"></a></div>\r\n          <div class="btn" id="stock_btn_#{id}" style="display:none">\r\n		  	<a href="javascript:;" onclick="return false" class="SG_aBtn SG_aBtn_dis SG_aBtn_sub">\r\n		  		<cite id="stock_save_#{id}">添加<input type="button" value="添加" id="categorySave"/></cite>\r\n			</a>\r\n		  </div>';return new Ui.Template(html).evaluate({id:this.id})}};function insertStockIsReady(){return true}Editor.Plugins.InsertOther=Core.Class.create();Editor.Plugins.InsertOther.prototype={initialize:function(html){this.html="<div style='text-align:center;'>"+html+"</div><br/>"||""},insert:function(){editor.insertHTML(this.html)}};Editor.Plugins.TemplateConfig=Core.Class.create();Editor.Plugins.TemplateConfig.prototype={initialize:function(){},get:function(){var data={layout:[{image:"http://simg.sinajs.cn/blog7style/images/blog/editor_format/format1.gif",html:'<table border="0" cellpadding="0" cellspacing="5">\r\n					         <tr>\r\n					            <td class="border" style="margin:0; padding:0; vertical-align:top; width:243px; height:318px;"><br /><br /><br /><br /></td>\r\n					            <td class="border" style="margin:0; padding:0; vertical-align:top; width:243px; height:318px;"><br /><br /><br /><br /></td>\r\n					         </tr>\r\n					     </table>'},{image:"http://simg.sinajs.cn/blog7style/images/blog/editor_format/format2.gif",html:'<table border="0" cellpadding="0" cellspacing="5">\r\n				         <tr>\r\n				            <td class="border" style="margin:0; padding:0; vertical-align:top; width:158px; height:318px;"><br /><br /><br /><br /></td>\r\n				            <td class="border" style="margin:0; padding:0; vertical-align:top; width:158px; height:318px;"><br /><br /><br /><br /></td>\r\n				            <td class="border" style="margin:0; padding:0; vertical-align:top; width:158px; height:318px;"><br /><br /><br /><br /></td>\r\n				         </tr>\r\n				     </table>'},{image:"http://simg.sinajs.cn/blog7style/images/blog/editor_format/format3.gif",html:'<table border="0" cellpadding="0" cellspacing="5">\r\n					         <tr>\r\n					            <td class="border" style="margin:0; padding:0; vertical-align:top; width:493px; height:157px;"><br /><br /><br /><br /></td>\r\n					         </tr>\r\n					         <tr>\r\n					            <td class="border" style="margin:0; padding:0; vertical-align:top; width:493px; height:154px;"><br /><br /><br /><br /></td>\r\n					         </tr>\r\n					     </table>'},{image:"http://simg.sinajs.cn/blog7style/images/blog/editor_format/format4.gif",html:'<table border="0" cellpadding="0" cellspacing="5">\r\n					          <tr>\r\n					             <td class="border" style="margin:0; padding:0; vertical-align:top; width:238px; height:155px;"></td>\r\n					             <td class="border" rowspan="2" style="padding:0; margin:0; vertical-align:top; width:243px; height:318px;"></td>\r\n					          </tr>\r\n					          <tr>\r\n					             <td class="border" style="margin:0; padding:0; vertical-align:top; width:238px; height:156px;"></td>\r\n					          </tr>\r\n					     </table>'},{image:"http://simg.sinajs.cn/blog7style/images/blog/editor_format/format5.gif",html:'<table border="0" cellpadding="0" cellspacing="5">\r\n				          <tr>\r\n				             <td class="border" rowspan="2" style="padding:0; margin:0; vertical-align:top; width:243px; height:318px;"><br /><br /><br /><br /></td>\r\n				             <td class="border" style="margin:0; padding:0; vertical-align:top; width:238px; height:155px;"><br /><br /><br /><br /></td>\r\n				          </tr>\r\n				          <tr>\r\n				             <td class="border" style="margin:0; padding:0; vertical-align:top; width:238px; height:156px;"><br /><br /><br /><br /></td>\r\n				          </tr>\r\n				     </table>'},{image:"http://simg.sinajs.cn/blog7style/images/blog/editor_format/format6.gif",html:'<table border="0" cellpadding="0" cellspacing="5">\r\n					          <tr>\r\n					             <td class="border" style="margin:0; padding:0; vertical-align:top; width:243px; height:155px;"><br /><br /><br /><br /></td>\r\n					             <td class="border" style="padding:0; margin:0; vertical-align:top; width:238px; height:155px;"><br /><br /><br /><br /></td>\r\n					          </tr>\r\n					          <tr>\r\n					             <td class="border" style="margin:0; padding:0; vertical-align:top; width:243px; height:156px;"><br /><br /><br /><br /></td>\r\n					             <td class="border" style="padding:0; margin:0; vertical-align:top; width:238px; height:156px;"><br /><br /><br /><br /></td>\r\n					          </tr>\r\n					     </table>'},{image:"http://simg.sinajs.cn/blog7style/images/blog/editor_format/format7.gif",html:'<table border="0" cellpadding="0" cellspacing="5">\r\n				          <tr>\r\n				             <td class="border" rowspan="3" style="padding:0; margin:0; vertical-align:top; width:243px; height:318px;"><br /><br /><br /><br /></td>\r\n				             <td class="border" style="margin:0; padding:0; vertical-align:top; width:238px; height:98px;"><br /><br /><br /><br /></td>\r\n				          </tr>\r\n				          <tr>\r\n				             <td class="border" style="margin:0; padding:0; vertical-align:top; width:238px; height:98px;"><br /><br /><br /><br /></td>\r\n				          </tr>\r\n				          <tr>\r\n				             <td class="border" style="margin:0; padding:0; vertical-align:top; width:238px; height:108px;"><br /><br /><br /><br /></td>\r\n				          </tr>\r\n				     </table>'},{image:"http://simg.sinajs.cn/blog7style/images/blog/editor_format/format8.gif",html:'<table border="0" cellpadding="0" cellspacing="5">\r\n					          <tr>\r\n					             <td class="border" style="margin:0; padding:0; vertical-align:top; width:238px; height:98px;"><br /><br /><br /><br /></td>\r\n					             <td class="border" rowspan="3" style="padding:0; margin:0; vertical-align:top; width:243px; height:318px;"><br /><br /><br /><br /></td>\r\n					          </tr>\r\n					          <tr>\r\n					             <td class="border" style="margin:0; padding:0; vertical-align:top; width:238px; height:98px;"><br /><br /><br /><br /></td>\r\n					          </tr>\r\n					          <tr>\r\n					             <td class="border" style="margin:0; padding:0; vertical-align:top; width:238px; height:108px;"><br /><br /><br /><br /></td>\r\n					          </tr>\r\n					     </table>'},{image:"http://simg.sinajs.cn/blog7style/images/blog/editor_format/format9.gif",
html:'<table border="0" cellpadding="0" cellspacing="5">\r\n				          <tr>\r\n				             <td class="border" style="padding:0; margin:0; vertical-align:top; width:238px; height:98px;"><br /><br /><br /><br /></td>\r\n				             <td class="border" style="margin:0; padding:0; vertical-align:top; width:243px; height:98px;"><br /><br /><br /><br /></td>\r\n				          </tr>\r\n				          <tr>\r\n				             <td class="border" style="padding:0; margin:0; vertical-align:top; width:238px; height:98px;"><br /><br /><br /><br /></td>\r\n				             <td class="border" style="margin:0; padding:0; vertical-align:top; width:243px; height:98px;"><br /><br /><br /><br /></td>\r\n				          </tr>\r\n				          <tr>\r\n				             <td class="border" style="padding:0; margin:0; vertical-align:top; width:238px; height:108px;"><br /><br /><br /><br /></td>\r\n				             <td class="border" style="margin:0; padding:0; vertical-align:top; width:243px; height:108px;"><br /><br /><br /><br /></td>\r\n				          </tr>\r\n				     </table>'}],graphical:[{image:"http://simg.sinajs.cn/blog7style/images/blog/editor_format/formexp1.gif",html:'\r\n					<table border="0" cellpadding="0" cellspacing="0">\r\n				      <tr style="margin:0; padding:0;">\r\n				          <td style="margin:0; padding:0">\r\n				              <div style="width:165px; height:160px; overflow:hidden; margin:0; padding:0;">\r\n				              <p style="font-family:\'宋体\';color:#ff0f75; font-size:12px; font-weight:bold; white-space:nowrap; line-height:250%; margin:0px; padding:0 0 0 5px; overflow:hidden;">01_遇到真爱</p>\r\n				              <p style="line-height:150%; color:#888888; margin:0; padding:0 0 0 5px; font-size:12px; word-wrap:break-word; word-break:break-all;">遇到你真的爱的人时 要努力争取和他相伴一生的机会。</p>\r\n				              </div>\r\n				          </td>\r\n				          <td style="margin:0; padding:0">\r\n				              <div style="position:relative; margin:0; padding:0; width:161px; height:160px; overflow:hidden;">\r\n				              <p style="margin:0px; padding:0px; position:absolute; left:0px; top:0px; width:25px; height:15px; text-align:center; line-height:15px; background-color:#ff0f75; font-size:10px; color:#fff; font-family:Verdana; overflow:hidden;">01</p>\r\n				              <p style="margin:0; padding:0; width:160px; height:160px; overflow:hidden; border-left:1px solid #ff0f75;"><img style="margin:0px; padding:0px;" src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/160160.gif" name="articleTemplate_01" title="双击图片可进行替换"/></p>\r\n				              </div>\r\n				          </td>\r\n				          <td style="margin:0; padding:0">\r\n				              <div style="width:164px; height:160px; margin:0; padding:0; overflow:hidden;">\r\n				              <p style="font-family:\'宋体\';color:#ff0f75; font-size:12px; font-weight:bold; white-space:nowrap; line-height:250%; margin:0px; padding:54px 0 0 9px; overflow:hidden;">03_遇到良友</p>\r\n				              <p style="line-height:150%; color:#888888; margin:0; padding:0 0 0 9px; font-size:12px; word-wrap:break-word; word-break:break-all;">遇到可相信的朋友时 要好好和他相处下去。</p>\r\n				              </div>\r\n				          </td>\r\n				      </tr>\r\n				      <tr style="margin:0; padding:0;">\r\n				          <td style="margin:0; padding:0">\r\n				              <div style="width:165px; height:161px; overflow:hidden; margin:0; padding:0; position:relative;">\r\n				              <p style="margin:0px; padding:0px; position:absolute; left:0px; top:0px; width:25px; height:15px; text-align:center; line-height:15px; background-color:#ff0f75; font-size:10px; color:#fff; font-family:Verdana; overflow:hidden;">02</p>\r\n				              <p style="margin:0; padding:0; width:160px; height:160px; overflow:hidden; border-bottom:1px solid #ff0f75;"><img style="margin:0px; padding:0px;" src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/1601602.gif" name="articleTemplate_02" title="双击图片可进行替换"/></p>\r\n				              </div>\r\n				          </td>\r\n				          <td style="margin:0; padding:0">\r\n				              <div style="position:relative; margin:0; padding:0; width:161px; height:161px; overflow:hidden;">\r\n				              <p style="margin:0px; padding:0px; width:161px; height:161px; overflow:hidden;"><img style="margin:0px; padding:0px;" src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/161161.gif" alt="" /></p>\r\n				              </div>\r\n				          </td>\r\n				          <td style="margin:0; padding:0">\r\n				              <div style="width:164px; height:161px; overflow:hidden; margin:0; padding:0; position:relative;">\r\n				              <p style="margin:0px; padding:0px; position:absolute; left:2px; top:0px; width:25px; height:15px; text-align:center; line-height:15px; background-color:#ff0f75; font-size:10px; color:#fff; font-family:Verdana; overflow:hidden;">03</p>\r\n				              <p style="margin:0; padding:0; border-top:1px solid #ff0f75; width:160px; height:160px;"><img style="margin:0 0 0 2px; padding:0px;" src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/1601604.gif" name="articleTemplate_03" title="双击图片可进行替换"/></p>\r\n				              </div>\r\n				          </td>\r\n				      </tr>\r\n				      <tr style="margin:0; padding:0;">\r\n				          <td style="margin:0; padding:0">\r\n				              <div style="width:165px; height:160px; overflow:hidden; margin:0; padding:0;">\r\n				              <p style="font-family:\'宋体\';color:#ff0f75; font-size:12px; font-weight:bold; white-space:nowrap; line-height:250%; margin:0px; padding:21px 0 0 5px; overflow:hidden;">02_遇到贵人</p>\r\n				              <p style="line-height:150%; color:#888888; margin:0; padding:0 0 0 5px; font-size:12px; word-wrap:break-word; word-break:break-all;">遇到认生中的贵人时 要记得好好感激。</p>\r\n				              </div>\r\n				          </td>\r\n				          <td style="margin:0;padding:0">\r\n				              <div style="position:relative;margin:0;padding:0;width:161px;height:160px;overflow:hidden;">\r\n				              <p style="margin:0px;padding:0px;position:absolute;right:0px;top:0px;width:25px;height:15px;text-align:center;line-height:15px;background-color:#ff0f75;font-size:10px;color:#fff;font-family:Verdana;overflow:hidden;">04</p>\r\n				              <p style="margin:0;padding:0;border-right:1px solid #ff0f75;width:160px;height:160px;overflow:hidden;"><img style="margin:0px;padding:0px;" src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/1601603.gif" name="articleTemplate_04" title="双击图片可进行替换"/></p>\r\n				              </div>\r\n				          </td>\r\n				          <td style="margin:0;padding:0">\r\n				              <div style="width:164px;height:160px;margin:0;padding:0;overflow:hidden;">\r\n				              <p style="font-family:\'宋体\';color:#ff0f75;font-size:12px;font-weight:bold;white-space:nowrap;line-height:250%;margin:0px;padding:74px 0 0 9px;overflow:hidden;">04_遇到曾经爱的人</p>\r\n				              <p style="line-height:150%;color:#888888;margin:0;padding:0 0 0 9px;font-size:12px;word-wrap:break-word;word-break:break-all;">遇到曾经爱过的人，记得微笑向他感激。</p>\r\n				              </div>\r\n				          </td>\r\n				      </tr>\r\n				      <tr style="margin:0;padding:0;">\r\n				          <td style="margin:0;padding:8px 0 28px 0;" colspan="2">\r\n				              <div style="position:relative;margin:0;padding:0;width:326px;height:210px;overflow:hidden;">\r\n				              <p style="margin:0px;padding:0px;position:absolute;left:0px;top:0px;width:25px;height:15px;text-align:center;line-height:15px;background-color:#ff0f75;font-size:10px;color:#fff;font-family:Verdana;overflow:hidden;">05</p>\r\n				              <p style="margin:0;padding:0;border-left:1px solid #ff0f75;width:320px;height:210px;overflow:hidden;"><img style="margin:0px;padding:0px;" src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/320210.gif" name="articleTemplate_05" title="双击图片可进行替换"/></p>\r\n				              </div>\r\n				          </td>\r\n				          <td style="margin:0;padding:8px 0 28px 0;">\r\n				              <div style="width:164px;height:160px;margin:0;padding:0;overflow:hidden;">\r\n				              <p style="font-family:\'宋体\';color:#ff0f75;font-size:12px;font-weight:bold;white-space:nowrap;line-height:250%;margin:0px;padding:34px 0 0 9px;overflow:hidden;">05_遇到曾经有误会的人</p>\r\n				              <p style="line-height:150%;height:18px;color:#888888;margin:0;padding:0 0 0 9px;font-size:12px;word-wrap:break-word;word-break:break-all;">遇到曾经爱过的人，记得微笑向他感激。<br />遇到曾经爱过的人，记得微笑向他感激。</p>\r\n				              </div>\r\n				          </td>\r\n				      </tr>\r\n				      <tr style="margin:0;padding:0;">\r\n				         <td style="margin:0;padding:0;background:url(http://simg.sinajs.cn/blog7style/images/blog/editor_format/49097.gif) no-repeat left top;width:490px;height:97px;overflow:hidden;" colspan="3">\r\n				             <div style="margin:0;padding:20px 0 0 0;float:left;width:140px;height:77px;text-align:center;"><p style=" margin:0px;padding:0px;height:28px;line-height:28px;height:28px;overflow:hidden;font-size:24px;color:#fff;font-family:Arial;font-weight:bold;">Lovely</p><p style=" margin:0px;padding:0px;height:28px;line-height:28px;font-size:24px;color:#fff;font-family:Arial;font-weight:bold;overflow:hidden;">Royee</p></div>\r\n				             <div style="margin:0px;padding:30px 0 30px;overflow:hidden;width:350px;*width:349px;text-align:center;float:right;font-size:12px;color:#fff;"><p style="margin:0;padding:0;line-height:150%;word-wrap:break-word;word-break:break-all;">遇到现在和相伴一生的人，要百分百感谢他爱你</p><p style="margin:0;padding:0;line-height:150%;word-wrap:break-word;word-break:break-all;">因为你们现在都得到幸福和真爱</p></div>\r\n				         </td>\r\n				      </tr>\r\n				</table>'},{image:"http://simg.sinajs.cn/blog7style/images/blog/editor_format/formexp2.gif",html:'\r\n						<table border="0" cellpadding="0" cellspacing="0" style="margin:0; padding:0;">\r\n						  <tr style="margin:0; padding:0">\r\n						    <td style="vertical-align:top; margin:0; padding:0;">\r\n						      <div style=" height:392px; overflow:hidden; padding:0 0 0 30px; margin:0; width:170px;">\r\n						        <h1 style="font-size:24px; font-family:黑体; color:#00a7fd; font-weight:normal; line-height:130%; margin:0; padding:93px 0 15px 0;word-wrap:break-word; word-break:break-all;">[女人一生<br />\r\n						          必去的<br />\r\n						          十个户外地]</h1>\r\n						        <p style="margin:0; padding:0; font-size:12px; font-weight:bold; color:#b2b3b3; line-height:150%; word-wrap:break-word; word-break:break-all; font-family:\'宋体\';">十个国家的十处户外地，</p>\r\n						        <p style="margin:0; padding:0; font-size:12px; font-weight:bold; color:#b2b3b3; line-height:150%; word-wrap:break-word; word-break:break-all;">风格各有不同，</p>\r\n						        <p style="margin:0; padding:0;font-size:12px; font-weight:bold; color:#b2b3b3; line-height:150%; word-wrap:break-word; word-break:break-all;">总有一款适合如水般的女人。</p>\r\n						      </div>\r\n						      <div style="width:186px; padding:0 0 0 14px; margin:0; overflow:hidden;">\r\n						        <div style="border-bottom:3px solid #e7e7e7; width:167px; height:42px; overflow:hidden; margin:0; padding:0;">\r\n						          <div style="float:left; width:128px; padding:0 9px 0 0; height:42px; overflow:hidden; margin:0;">\r\n						            <p style="line-height:150%; white-space:nowrap; font-size:14px; color:#010101; font-weight:bold; overflow:hidden; text-align:right;  margin:0;padding:0;">伯利兹城普拉森舍</p>\r\n						            <p style=" line-height:130%; font-size:12px; color:#6e6b6b; font-weight:bold; overflow:hidden; text-align:right; margin:0;padding:0; white-space:nowrap;">洪都拉斯首都</p>\r\n						          </div>\r\n						          <div style="float:right; margin:0; padding:0;">\r\n						            <p style="background-color:#189ce0; width:30px; height:30px; line-height:30px; text-align:center; margin:3px 0 0 0; padding:0; font-weight:bold; color:#fff; font-size:16px; overflow:hidden;">2</p>\r\n						          </div>\r\n						          <div style="clear:both; height:0px; font-size:1px; overflow:hidden; margin:0; padding:0;"></div>\r\n						        </div>\r\n						        <div style="width:168px; margin:0; padding:0; line-height:150%;">\r\n						          <p style="color:#02a6f9; line-height:150%; padding:7px 0 0 0;font-size:12px; margin:0;word-wrap:break-word; word-break:break-all;">这个沙漠半岛位于伯利兹城的南边，是一块未被大多数旅游者发现的“璞玉”。除了少数迷路的背包客和头昏眼花的嬉皮士外，和当地的村民们一起放松是一次少见的愉悦之旅。离海岸线不远处，还有更多未被发现的小岛，在当地旅游团的带领下，你可以轻易地去拜访它们。</p>\r\n						          <p style="color:#376e7c; line-height:150%; padding:18px 0 0 0;font-size:12px; margin:0;word-wrap:break-word; word-break:break-all;">在非洲，最终极的体验莫过于在人类鲜少踏足的地方，和那些野生动物们进行面对面的接触。在这片浓密的非洲雨林里，其中一个挑战就是发现自己成为异类，身处一群闲逛的猩猩中间。</p>\r\n						        </div>\r\n						      </div></td>\r\n						    <td style="vertical-align:top;margin:0; padding:0;"><div style="width:274px; padding:23px 16px 0 0; margin:0;">\r\n						        <div style="border-bottom:3px solid #e1ebee; width:205px; height:39px; overflow:hidden; float:right; margin:0; padding:0;">\r\n						          <div style="float:left; margin:0; padding:0;">\r\n						            <p style="background-color:#189ce0; width:30px; height:30px; line-height:30px; text-align:center; margin:3px 0 0 0; font-weight:bold; color:#fff; font-size:16px; padding:0; overflow:hidden;">1</p>\r\n						          </div>\r\n						          <div style="float:right; width:166px; padding:0 0 0 9px; margin:0;">\r\n						            <p style=" margin:0; padding:0; line-height:150%; white-space:nowrap; font-size:14px; color:#010101; font-weight:bold; overflow:hidden; text-align:left;">阿尔及利亚哈啦大沙漠</p>\r\n						            <p style=" margin:0; padding:0; line-height:130%; white-space:nowrap; font-size:12px; color:#6e6b6b; font-weight:bold; overflow:hidden; text-align:left;">远足的艰辛</p>\r\n						          </div>\r\n						          <div style="clear:both; height:0px; font-size:1px; overflow:hidden; margin:0; padding:0;"></div>\r\n						        </div>\r\n						        <div style="width:205px;line-height:150%; float:right; overflow:hidden; margin:0; padding:0; font-family:\'宋体\';">\r\n						          <p style="color:#02a6f9;line-height:150%; padding:9px 0 0 0;font-size:12px; margin:0;word-wrap:break-word; word-break:break-all;">非洲北部，西起大西洋东岸，东至红海之滨，横亘着一片浩瀚的沙漠。后来通指大荒漠。</p>\r\n						          <p style="color:#376e7c;line-height:150%; padding:18px 0 0 0;font-size:12px; margin:0;word-wrap:break-word; word-break:break-all;font-family:\'宋体\'">曾经，撒哈拉是男性伟岸的代名词，深入无人区深处探险消耗了欧洲人半世纪的梦想。，毕竟，花费差不多3000美元就可以完成一次对体力和智力双重挑战的冒险，况且还是如此奇异而刺激——实在不算昂贵。</p>\r\n						        </div>\r\n						        <div style="float:right; width:150px; height:225px; text-align:center; margin:6px 0 23px 0; background-color:#dee7e6; padding:18px 27px 14px 28px; position:relative;"><img title="双击图片可进行替换" name="articleTemplate_11" src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/150225.gif"/>\r\n						          <p style="margin:0px; padding:0px; position:absolute; left:28px; top:18px; width:25px; height:15px; text-align:center; line-height:15px; background-color:#0a0e06; font-weight:bold; font-size:10px; color:#fff; font-family:Arial; overflow:hidden;">01</p>\r\n						        </div>\r\n						        <div style="clear:both; height:0px; font-size:1px; overflow:hidden; margin:0; padding:0;"></div>\r\n						        <div style="width:225px; height:160px; text-align:center; background-color:#dee7e6; padding:18px 25px; margin:0; position:relative;"><img  title="双击图片可进行替换" name="articleTemplate_12" src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/225160.gif"/>\r\n						          <p style="margin:0px; padding:0px; position:absolute; right:25px;_right:24px; top:18px; width:25px; height:15px; text-align:center; line-height:15px; background-color:#0a0e06; font-weight:bold; font-size:10px; color:#fff; font-family:Arial;overflow:hidden;">02</p>\r\n						        </div>\r\n						      </div></td>\r\n						  </tr>\r\n						</table>'},{image:"http://simg.sinajs.cn/blog7style/images/blog/editor_format/formexp3.gif",html:'\r\n					<table border="0" cellpadding="0" cellspacing="0">\r\n					    <tr style="margin:0; padding:0;">\r\n					        <td style="margin:0; padding:0;">\r\n					            <div style="width:490px; overflow:hidden; margin:0; padding:0;">\r\n					                 <div style="margin:46px auto 0px; padding:0; width:410px; height:270px; overflow:hidden;">\r\n					                     <img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/410270.jpg" name="articleTemplate_21"  title="双击图片可进行替换"/>\r\n					                 </div>\r\n					                 <div style="background:url(http://simg.sinajs.cn/blog7style/images/blog/editor_format/linedot_green.gif) repeat-x left bottom; width:410px; height:22px; overflow:hidden; margin:0 auto; padding:9px 0 0 0; *padding:5px 0 0 0; text-align:right;"><span style="color:#023497; font-size:14px; padding-right:17px;">小BOBI</span><span style="color:#999999; font-size:12px;">2010.01.03</span>\r\n					                 </div>\r\n					                 <div style="width:410px; margin:13px auto 44px; padding:0; text-align:center; font-family:宋体; color:#999; font-size:12px; line-height:150%;">\r\n					                     <h3 style="margin:0px; padding:0px; color:#023497; font-weight:bold; font-size:14px; line-height:340%; overflow:hidden; white-space:nowrap;">2010年新年快乐</h3>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">BOBI是个乖孩子~</p>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">每次你认真跟他讲话的时候，</p>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">仿佛都能听懂……~</p>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">新年来了！</p>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">希望内心的小小心愿可以实现……</p>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">BOBI是个乖孩子~</p>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">每次你认真跟他讲话的时候，</p>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">仿佛都能听懂……~</p>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">新年来了！</p>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">希望内心的小小心愿可以实现……</p>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">BOBI是个乖孩子~</p>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">每次你认真跟他讲话的时候，</p>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">仿佛都能听懂……~</p>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">新年来了！</p>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">希望内心的小小心愿可以实现……</p>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">希望内心的小小心愿可以实现……</p>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">仿佛都能听懂……~</p>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">新年来了！</p>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">希望内心的小小心愿可以实现……</p>\r\n					                     <p style="margin:0px; padding:0px;word-wrap:break-word; word-break:break-all;">希望内心的小小心愿可以实现……</p>\r\n					                 </div>\r\n					                 <div style="margin:0 0 32px 0; padding:0; height:17px; width:410px; background:url(http://simg.sinajs.cn/blog7style/images/blog/editor_format/bg_letterbot.gif) left top;"></div>\r\n					            </div>\r\n					        </td>\r\n					    </tr>\r\n					</table>'},{image:"http://simg.sinajs.cn/blog7style/images/blog/editor_format/formexp4.gif",html:'<table border="0" cellpadding="0" cellspacing="0" style=" margin:0; padding:0;">\r\n					        <tr style="margin:0; padding:0;">\r\n					            <td style="vertical-align:top; margin:0; padding:0;">\r\n					                <div style="margin:0; padding:39px 10px 0 10px; width:230px; overflow:hidden; height:281px; overflow:hidden;">\r\n					                    <h3 style="margin:0; padding:0; color:#ff0000; font-size:22px; line-height:200%; font-family:黑体; width:211px; overflow:hidden; text-align:center; font-weight:normal; white-space:nowrap;">健康快递</h3>\r\n					                    <h1 style="margin:0; padding:0; color:#6a6969; font-weight:normal; line-height:100%; font-family:Arial; font-size:48px; width:228px; text-align:center;word-wrap:break-word; word-break:break-all;">HEALTH<br />TITPS</h1>\r\n					                    <p style="margin:0; padding:6px 0 0 26px; width:180px; overflow:hidden; font-size:12px; line-height:150%; height:126px; color:#6a6969; text-align:center; font-family:宋体;word-wrap:break-word; word-break:break-all;">随着居民生活水平的提高，“吃”的学问越来越被人民关注。上哪儿吃最好吃，怎么吃最划算算成了人们的兴趣点。</p>\r\n					                </div>\r\n					                <div style="margin:0; padding:0 10px 14px 20px; height:94px; width:220px;">\r\n					                    <div style="margin:0; padding:0 0 0 20px; width:192px; line-height:180%; font-weight:bold; color:#222222; font-size:14px;word-wrap:break-word; word-break:break-all;">“江户川”日本料理</div>\r\n					                    <div style="margin:0; line-height:150%; height:55px; overflow:hidden; color:#222; font-size:12px;word-wrap:break-word; word-break:break-all;">“江户川”日本料理店的主人，对于自家的拿手好菜烤鳗鱼颇有心得。欢迎品尝鳗鱼的客人。</div>\r\n					                 </div>\r\n					                 <div style="margin:0; padding:0; position:relative; width:250px; height:225px;"><img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/250225.gif" name="articleTemplate_31" title="双击图片可进行替换"/><p style="margin:0; padding:0; position:absolute; left:0px; bottom:0px; _bottom:-1px; background-color:#fff705; text-align:center; line-height:17px; height:17px; width:23px; color:#11050b; font-size:12px; font-family:Arial; overflow:hidden;">02</p></div>\r\n					                 <div style="margin:0; padding:14px 10px 0 0; background-color:#fff705; width:240px; height:113px;">\r\n					                    <div style="margin:0; padding:0 0 0 20px; line-height:180%; font-weight:bold; color:#222222; font-size:14px;word-wrap:break-word; word-break:break-all;">罗马花园餐厅</div>\r\n					                    <div style="margin:0; padding:0 0 14px 20px; line-height:150%; height:55px; overflow:hidden; color:#c90808; font-size:12px;word-wrap:break-word; word-break:break-all;">“江户川”日本料理店的主人，对于自家的拿好搜好菜烤鳗鱼颇有心得。新鲜的鳗鱼，经过厨师恰到好处的烘烤，呈现给客人一份不可多得的风味。</div>\r\n					                 </div>\r\n					            </td>\r\n					            <td style="vertical-align:top; margin:0; padding:0;">\r\n					                 <div style="margin:0; padding:0; position:relative; width:240px; height:330px;"><img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/240330.gif" name="articleTemplate_32" title="双击图片可进行替换"/><p style="margin:0; padding:0; position:absolute; left:0px; bottom:0; background-color:#c90808; text-align:center; line-height:17px; height:17px; width:23px; color:#fff; font-size:12px; font-family:Arial; overflow:hidden;">01</p></div>\r\n					                 <div style="margin:0; padding:14px 10px 0 20px; background-color:#c90808; width:210px; height:100px; overflow:hidden;">\r\n					                    <div style="margin:0; line-height:180%; font-weight:bold; color:#fff; font-size:14px;word-wrap:break-word; word-break:break-all;">金钱豹自助餐厅</div>\r\n					                    <div style="margin:0; padding:0 0 14px 0x; line-height:150%; height:55px; overflow:hidden; color:#fff; font-size:12px;word-wrap:break-word; word-break:break-all;">金钱豹自助餐厅以其风靡全球的国际复合式自助餐厅模式，汇集国际美食于一家，堪称的理念。</div>\r\n					                 </div>\r\n					                 <div style="margin:0; padding:14px 10px 0 20px; width:210px; height:98px; overflow:hidden;">\r\n					                    <div style="margin:0; line-height:180%; font-weight:bold; color:#94902e; font-size:14px;word-wrap:break-word; word-break:break-all;">好伦哥餐饮有限公司</div>\r\n					                    <div style="margin:0; line-height:150%; height:73px; overflow:hidden; color:#94902e; font-size:12px;word-wrap:break-word; word-break:break-all;">北京好伦哥餐饮有限公司于1998年登陆中国，并于同年在北京开设第一家美式比萨自助餐厅，是中国比萨自助市场的首创者和开拓者。</div>\r\n					                 </div>\r\n					                 <div style="margin:0; padding:18px 10px 0 20px; width:210px; height:83px; overflow:hidden;">\r\n					                    <div style="margin:0; line-height:180%; font-weight:bold; color:#222222; font-size:14px;word-wrap:break-word; word-break:break-all;">金汉斯烤肉自助</div>\r\n					                    <div style="margin:0; padding:0 0 14px 0; line-height:150%; height:55px; overflow:hidden; color:#222222; font-size:12px;word-wrap:break-word; word-break:break-all;">金汉斯上肉速度很快肉被穿在大铁钎上，服务生操刀现割。每桌一张小纸条</div>\r\n					                 </div>\r\n					                 <div style="margin:0; padding:13px 10px 0 20px; width:210px; height:100px; overflow:hidden;">\r\n					                    <div style="margin:0; line-height:180%; font-weight:bold; color:#3e834a; font-size:14px;word-wrap:break-word; word-break:break-all;">西苑饭店：旋转餐厅</div>\r\n					                    <div style="margin:0; padding:0 0 14px 0; line-height:150%; height:55px; overflow:hidden; color:#3e834a; font-size:12px;word-wrap:break-word; word-break:break-all;">北京好伦哥餐饮有限公司与1998年登陆中国，并于同年在北京开设第一家美式比萨自助餐厅。</div>\r\n					                 </div>\r\n					            </td>\r\n					        </tr>\r\n					    </table>'},{image:"http://simg.sinajs.cn/blog7style/images/blog/editor_format/formexp7.gif",html:'<table cellpadding="0" cellspacing="0" border="0" style="margin:0; padding:0;">\r\n					      <tr style="margin:0; padding:0;">\r\n					          <td style="margin:0; padding:0;">\r\n					               <div style="margin:0; padding:0; color:#b7b8b8; background-color:#7a7a7a; width:470px; height:32px; line-height:32px; text-align:right; padding-right:20px; font-size:12px;">http://blog.sina.com.cn/apple</div>\r\n					               <div style="margin:0; padding:12px 0 0 0; width:490px; height:262px; text-align:center; position:relative;"><img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/460260.gif" name="articleTemplate_41"  title="双击图片可进行替换"/><p style="margin:0; padding:0; position:absolute; left:15px; top:12px; text-align:center; line-height:17px; height:17px; width:23px; color:#72b743; font-size:10px; font-family:Arial;">01</p></div>\r\n					               <div style="margin:0 auto; padding:17px 0 0 0px; line-height:200%; width:470px; text-align:center; font-size:24px; overflow:hidden;">\r\n					                    <span style="margin:0; padding:0 10px 0 0; font-family:黑体; color:#000; font-size:24px;word-wrap:break-word; word-break:break-all;">更多的幸福更多的希望</span>\r\n					                    <span style="margin:0; padding:0; font-family:黑体; color:#72b743; font-size:24px;word-wrap:break-word; word-break:break-all;">掌握在你自己手中</span>\r\n					               </div>\r\n					               <div style="margin:0; padding:0;">\r\n					                    <p style="margin:0 auto; text-align:center; padding:0; line-height:150%; color:#72b743; font-size:12px; width:460px;word-wrap:break-word; word-break:break-all;">享受幸福是需要学习的，当幸福即将来临的时刻需要提醒。</p>\r\n					                    <p style="margin:0 auto; text-align:center; padding:0; line-height:150%; color:#72b743; font-size:12px; width:460px;word-wrap:break-word; word-break:break-all;">人可以自然而然地学会感官的享乐，人却无法天生地掌握幸福的韵律。</p>\r\n					               </div>\r\n					               <div style="margin:19px auto 1px; padding:0; width:420px; overflow:hidden;">\r\n					                   <div style="margin:0 38px 20px 0; padding:0; float:left; width:190px; height:110px; overflow:hidden; position:relative;"><img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/190110.gif" name="articleTemplate_42"  title="双击图片可进行替换"/><p style="margin:0; padding:0; position:absolute; left:0px; top:0px; text-align:center; line-height:17px; height:17px; width:23px; color:#72b743; font-size:10px; font-family:Arial;">02</p></div>\r\n					                   <div style="margin:0 0 20px 0; padding:0; float:left; width:190px; height:110px; overflow:hidden;position:relative;"><img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/190110.gif" name="articleTemplate_43"  title="双击图片可进行替换"/><p style="margin:0; padding:0; position:absolute; left:0px; top:0px; text-align:center; line-height:17px; height:17px; width:23px; color:#72b743; font-size:10px; font-family:Arial;">03</p></div>\r\n					                   <div style="margin:0 38px 20px 0; padding:0; float:left; width:190px; height:110px; overflow:hidden;position:relative;"><img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/190110.gif" name="articleTemplate_44"  title="双击图片可进行替换"/><p style="margin:0; padding:0; position:absolute; left:0px; top:0px; text-align:center; line-height:17px; height:17px; width:23px; color:#72b743; font-size:10px; font-family:Arial;">04</p></div>\r\n					                   <div style="margin:0 0 20px 0; padding:17px 0 0 20px; float:left; width:170px; height:93px; overflow:hidden; background-color:#72b743;">\r\n					                       <p style="margin:0; padding:0 10px 0 0; font-size:12px; color:#fff; line-height:150%; overflow:hidden;word-wrap:break-word; word-break:break-all;"><span style="padding-right:8px;">01</span>那景那光</p>\r\n					                       <p style="margin:0; padding:0 10px 0 0; font-size:12px; color:#fff; line-height:150%; overflow:hidden;word-wrap:break-word; word-break:break-all;"><span style="padding-right:8px;">02</span>像花一样微笑</p>\r\n					                       <p style="margin:0; padding:0 10px 0 0; font-size:12px; color:#fff; line-height:150%; overflow:hidden;word-wrap:break-word; word-break:break-all;"><span style="padding-right:8px;">03</span>窗光</p>\r\n					                       <p style="margin:0; padding:0 10px 0 0; font-size:12px; color:#fff; line-height:150%; overflow:hidden;word-wrap:break-word; word-break:break-all;"><span style="padding-right:8px;">04</span>美好生活</p>\r\n					                   </div>\r\n					                   <div style="clear:both; height:0px; font-size:1px; overflow:hidden;"></div>\r\n					               </div>\r\n					               <div style="margin:0 auto; padding:0; width:374px;overflow:hidden;">\r\n					                    <p style="margin:0; padding:0; line-height:150%; color:#444; font-size:12px; text-align:center;word-wrap:break-word; word-break:break-all;">幸福是水，哪怕只有一滴，也将留下一瞬。</p>\r\n					                    <p style="margin:0; padding:0; line-height:150%; color:#444; font-size:12px; text-align:center;word-wrap:break-word; word-break:break-all;">幸福是水，是那滴轻滑过脸庞的泪水，微笑或苦涩中带着满足与欣慰。</p>\r\n					                    <p style="margin:0; padding:0; line-height:150%; color:#444; font-size:12px; text-align:center;word-wrap:break-word; word-break:break-all;">幸福是水，是老农握着锄头，望着可惜的庄稼暂歇的那一刻，渗出额头的那滴汗水。</p>\r\n					               </div>\r\n					          </td>\r\n					      </tr>\r\n					</table>'},{image:"http://simg.sinajs.cn/blog7style/images/blog/editor_format/formexp9.gif",html:'<table cellpadding="0" cellspacing="0" border="0" style="margin:0; padding:0;">\r\n					      <tr style="margin:0; padding:0;">\r\n					          <td style="margin:0; padding:0;">\r\n					              <div style="margin:0; padding:30px 0 0 28px; background-color:#000; width:462px; height:73px; overflow:hidden;">\r\n					                  <div style="margin:0; padding:0; line-height:36px; height:36px; overflow:hidden; font-size:24px; font-family:黑体;"><span style="color:#ff0099;">北欧行-</span><span style="color:#ffb369;">瑞典</span></div>\r\n					                  <div style="color:#b7b8b8; font-size:12px; line-height:20px;">http://www.sina.com.cn/apple</div>\r\n					              </div>\r\n					              <div style="margin:0; padding:20px 0 0 0; height:587px; width:490px; overflow:hidden;">\r\n					                   <div style="margin:0 9px 0 0; padding:0; float:left; width:240px; display:inline; overflow:hidden;">\r\n					                       <div style="margin:0; padding:0; width:240px; height:160px; overflow:hidden; position:relative;"><img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/240160.gif" name="articleTemplate_51" title="双击图片可进行替换"/><p style="margin:0; padding:0; position:absolute; left:0px; top:0px; text-align:center; line-height:17px; height:15px; width:25px; color:#fff; font-size:10px; background-color:#253648; font-family:Arial;">01</p></div>\r\n					                       <div style="margin:10px 0 0 0; padding:0 0 0 10px; color:#ff0005; border-left:2px solid #ff0005; line-height:23px; height:23px; overflow:hidden; width:204px; font-size:14px;word-wrap:break-word; word-break:break-all;">斯德哥尔摩</div>\r\n					                       <div style="margin:0; padding:5px 0 0 10px; height:88px; width:204px; overflow:hidden; border-left:2px solid #3c3c3c; color:#888; line-height:18px; font-size:12px;word-wrap:break-word; word-break:break-all;">斯德哥尔摩地处波罗的海和梅拉伦湖交汇处，因此被称为“北方威尼斯”。1463年，斯德哥尔摩被定为瑞典的都城并逐渐发展成为瑞典的第一大城市。</div>\r\n					                   </div>\r\n					                   <div style="margin:0; padding:0; float:left; width:240px; display:inline; overflow:hidden;">\r\n					                       <div style="margin:0; padding:0; width:240px; height:160px; overflow:hidden; position:relative;"><img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/2401602.gif" name="articleTemplate_52" title="双击图片可进行替换"/><p style="margin:0; padding:0; position:absolute; left:0px; top:0px; text-align:center; line-height:17px; height:15px; width:25px; color:#fff; font-size:10px; background-color:#253648; font-family:Arial;">02</p></div>\r\n					                       <div style="margin:10px 0 0 0; padding:0 0 0 10px; color:#ff0005; border-left:2px solid #ff0005; line-height:23px; height:23px; overflow:hidden; width:204px; font-size:14px;word-wrap:break-word; word-break:break-all;">马尔默</div>\r\n					                       <div style="margin:0; padding:5px 0 0 10px; height:88px; width:204px; overflow:hidden; border-left:2px solid #3c3c3c; color:#888; line-height:18px; font-size:12px;word-wrap:break-word; word-break:break-all;">是瑞典第三大城、海军基地交通枢纽。该城坐落在瑞典最南端。隔厄勒海峡同丹麦首都哥本哈根相望。两城相距仅26公里。马尔默市区分为两部分。</div>\r\n					                   </div>\r\n					                   <div style="margin:15px 9px 0 0; padding:0; float:left; width:240px; display:inline; overflow:hidden;">\r\n					                       <div style="margin:0; padding:0; width:240px; height:160px; overflow:hidden; position:relative;"><img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/2401603.gif" name="articleTemplate_53" title="双击图片可进行替换"/><p style="margin:0; padding:0; position:absolute; left:0px; top:0px; text-align:center; line-height:17px; height:15px; width:25px; color:#fff; font-size:10px; background-color:#253648; font-family:Arial;">03</p></div>\r\n					                       <div style="margin:10px 0 0 0; padding:0 0 0 10px; color:#ff0005; border-left:2px solid #ff0005; line-height:23px; height:23px; overflow:hidden; width:204px; font-size:14px;word-wrap:break-word; word-break:break-all;">乌普拉萨</div>\r\n					                       <div style="margin:0; padding:5px 0 0 10px; height:88px; width:204px; overflow:hidden; border-left:2px solid #3c3c3c; color:#888; line-height:18px; font-size:12px;word-wrap:break-word; word-break:break-all;">瑞典东部城市。地处瑞典东部、斯德哥尔摩的正北方，濒临费利斯河和梅拉伦湖。城市四周有肥沃的田野、茂密的森林，景致优雅清新。</div>\r\n					                   </div>\r\n					                   <div style="margin:15px 0 0 0; padding:0; float:left; width:240px; display:inline; overflow:hidden;">\r\n					                       <div style="margin:0; padding:0; width:240px; height:160px; overflow:hidden; position:relative;"><img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/2401604.gif" name="articleTemplate_54" title="双击图片可进行替换"/><p style="margin:0; padding:0; position:absolute; left:0px; top:0px; text-align:center; line-height:17px; height:15px; width:25px; color:#fff; font-size:10px; background-color:#253648; font-family:Arial;">04</p></div>\r\n					                       <div style="margin:10px 0 0 0; padding:0 0 0 10px; color:#ff0005; border-left:2px solid #ff0005; line-height:23px; height:23px; overflow:hidden; width:204px; font-size:14px;word-wrap:break-word; word-break:break-all;">哥德堡</div>\r\n					                       <div style="margin:0; padding:5px 0 0 10px; height:88px; width:204px; overflow:hidden; border-left:2px solid #3c3c3c; color:#888; line-height:18px; font-size:12px;word-wrap:break-word; word-break:break-all;">哥德堡是瑞典第一大港口和第二工业大城市。位于西海岸卡特加特海峡，与丹麦北端相望。哥德堡港口终年不冻，是瑞典和西欧通商的主要港埠。</div>\r\n					                   </div>\r\n					                   <div style="clear:both; height:0px; font-size:1px; overflow:hidden;"></div>\r\n					              </div>\r\n					          </td>\r\n					      </tr>\r\n					</table>'
},{image:"http://simg.sinajs.cn/blog7style/images/blog/editor_format/formexp11.gif",html:'<table style="margin:0; padding:0;" border="0" cellpadding="0" cellspacing="0">\r\n				          <tr style="margin:0; padding:0;">\r\n				              <td style="margin:0; padding:0; vertical-align:top;">\r\n				                  <div style="margin:0; padding:15px 0 0 18px; width:136px; overflow:hidden;">\r\n				                      <div style="margin:0 0 10px 0; padding:0; position:relative; width:125px; height:84px; overflow:hidden;"><img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/125084.gif" name="articleTemplate_61" title="双击图片可进行替换"/><p style="margin:0; padding:0; position:absolute; right:0px; top:0px; text-align:center; line-height:14px; height:14px; width:18px; color:#fff; background-color:#28b0d8; font-size:10px; font-family:Verdana;">02</p></div>\r\n				                      <div style="margin:0 0 4px 0; padding:0; position:relative; width:125px; height:171px; overflow:hidden;"><img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/125171.gif" name="articleTemplate_62" title="双击图片可进行替换"/><p style="margin:0; padding:0; position:absolute; right:0px; top:0px; text-align:center; line-height:14px; height:14px; width:18px; color:#fff; background-color:#28b0d8; font-size:10px; font-family:Verdana;">03</p></div>\r\n				                      <div style="margin:0; padding:0; line-height:150%; width:125px; font-size:12px; overflow:hidden;"><span style="color:#27b0dc; font-weight:bold; padding-right:8px;">01</span><span style="color:#797979;word-wrap:break-word; word-break:break-all;">寂静的村庄</span></div>\r\n				                      <div style="margin:0; padding:0; line-height:150%; width:125px; font-size:12px; overflow:hidden;"><span style="color:#27b0dc; font-weight:bold; padding-right:8px;">02</span><span style="color:#797979;word-wrap:break-word; word-break:break-all;">起飞</span></div>\r\n				                      <div style="margin:0; padding:0; line-height:150%; width:125px; font-size:12px; overflow:hidden;"><span style="color:#27b0dc; font-weight:bold; padding-right:8px;">03</span><span style="color:#797979;word-wrap:break-word; word-break:break-all;">像花一样茁壮成长</span></div>\r\n				                  </div>\r\n				              </td>\r\n				              <td style="margin:0; padding:0; vertical-align:top;">\r\n				                  <div style="margin:0; padding:15px 19px 0 0; width:317px; overflow:hidden;">\r\n				                       <div style="margin:0 0 10px 0; padding:0; position:relative; width:317px; height:214px; overflow:hidden;"><img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/317214.gif" name="articleTemplate_63" title="双击图片可进行替换"/><p style="margin:0; padding:0; position:absolute; left:0px; top:0px; text-align:center; line-height:14px; height:14px; width:18px; color:#fff; background-color:#28b0d8; font-size:10px; font-family:Verdana;">01</p></div>\r\n				                       <div style="margin:0; padding:0;">\r\n				                          <div style="margin:0 10px 0 0; padding:3px 0 0 0; float:left; background-color:#27afd5; width:121px; height:112px; overflow:hidden;">\r\n				                            <div style="margin:0 auto; padding:4px 0 0 5px; background-color:#fff; width:110px; height:75px;line-height:110%;color:#27afd5;font-size:22px;font-weight:bold;word-wrap:break-word;word-break:break-all;">后知后觉小村庄</div>\r\n				                            <div style="margin:0;padding:9px 0 0 10px;width:105px;color:#fff;height:18px;line-height:150%;overflow:hidden;font-size:12px;">2010</div>\r\n				                       </div>\r\n				                          <div style="margin:0;padding:0 0 17px 0;line-height:150%;font-size:12px;word-wrap:break-word;word-break:break-all;"><span style="color:#26d578;background:url(http://simg.sinajs.cn/blog7style/images/blog/editor_format/icon_1212.gif) no-repeat left top;padding-left:14px;word-wrap:break-word;word-break:break-all;">后知后觉的胶片时光，持续了几乎有大半年时间。<br />冲出来7卷胶片，有很多不同的旅行片段……不过这次冲扫的感觉不算特别满意，</span><span style="color:#666;word-wrap:break-word;word-break:break-all;">好作品不是很多……这也是胶片的遗憾吧。微弱轰鸣声带着思绪不经意的飞过晾晒的衣服编制出美妙的生活节奏之曲……如果时间多一点的话，可以拍大半天吧！</span></div>\r\n				                          <div style="clear:both;height:0px;font-size:1px;overflow:hidden;"></div>\r\n				                          <div style="margin:0 0 10px 0;padding:0 10px;width:288px;height:27px;line-height:27px;overflow:hidden;color:#26afd9;font-size:14px;font-weight:bold;border:5px solid #ebebeb;">人面不知何处去，桃花依旧笑春风</div>\r\n				                          <div style="margin:0;padding:0;">\r\n				                            <div style="margin:0 0 6px 2px;padding:0 0 0 11px;font-size:12px;font-weight:bold;color:#707070;line-height:130%;border-left:2px solid #717171;width:303px;word-wrap:break-word;word-break:break-all;">像花一样努力的活着</div>\r\n				                            <div style="margin:0;padding:0 0 16px 0;line-height:150%;font-size:12px;"><span style="color:#666666;word-wrap:break-word;word-break:break-all;">俗称农历五月是榴月，五月盛开的石榴花，艳红似火，有着火一般的光辉，</span><span style="color:#26d673;word-wrap:break-word;word-break:break-all;">因此许多女子都喜欢榴花带在云鬓上，增添娇艳。</span><span style="color:#666666;">石榴花的花神传说是钟馗，五月是疾病最容易流行的季节。</span></div>\r\n				                       </div>\r\n				                          <div style="margin:0 0 10px 0;padding:0 10px;width:288px;height:27px;line-height:27px;overflow:hidden;color:#27b1d6;font-size:14px;font-weight:bold;border:5px solid #ebebeb;word-wrap:break-word;word-break:break-all;">一枝红艳露凝香，云雨巫山枉断肠</div>\r\n				                          <div style="margin:0;padding:0;">\r\n				                            <div style="margin:0 0 6px 2px;padding:0 0 0 11px;font-size:12px;font-weight:bold;color:#707070;line-height:130%;border-left:2px solid #717171;width:303px;word-wrap:break-word;word-break:break-all;">六月的荷花</div>\r\n				                            <div style="margin:0;padding:0 0 16px 0;line-height:150%;font-size:12px;"><span style="color:#666666;word-wrap:break-word;word-break:break-all;">农历六月俗称荷月，荷花既莲花。莲花生于碧波之中，以“出淤泥而不染”</span><span style="color:#26d673;word-wrap:break-word;word-break:break-all;">著称且花大叶丽，清香远益，因此自古即深受人们喜爱。</span><span style="color:#666666;word-wrap:break-word;word-break:break-all;">据说荷花花神为西施，她曾在苏州锦帆留下采莲的故迹。</span></div>\r\n				                       </div>\r\n				                       </div>\r\n				                       <div style="margin:0 0 33px 0;padding:0 5px 0 0;background-color:#00bdff;width:308px;height:16px;line-height:16px;overflow:hidden;font-size:12px;color:#fff;text-align:right;border-right:2px solid #000;">2010 Copyright season2.</div>\r\n				                  </div>\r\n				              </td>\r\n				          </tr>\r\n				    </table>'},{image:"http://simg.sinajs.cn/blog7style/images/blog/editor_format/formexp12.gif",html:'<table border="0" cellpadding="0" cellspacing="0" style="margin:0; padding:0;">\r\n				            <tr style="margin:0; padding:0;">\r\n				                <td style="margin:0; padding:0; vertical-align:top;" colspan="2">\r\n				                    <div style="margin:0; padding:10px 10px 9px 10px; width:490px; height:4px; overflow:hidden;"><img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/bg_color1.gif" alt="" /></div>\r\n				                </td>\r\n				            </tr>\r\n				            <tr style="margin:0; padding:0;">\r\n				                <td style="margin:0; padding:0; vertical-align:top; width:257px;">\r\n				                    <div style="margin:0; padding:0 0 0 10px; width:257px; overflow:hidden;">\r\n				                        <div style="margin:0; padding:0; width:257px; height:270px; overflow:hidden; position:relative;"><img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/257270.gif" name="articleTemplate_71" title="双击图片可进行替换"/><p style="margin:0; padding:0; position:absolute; right:0px; top:0px; text-align:center; line-height:17px; height:17px; width:23px; color:#fff; font-size:10px; font-family:Verdana;">01</p></div>\r\n				                        <div style="margin:0; padding:0; width:257px; height:195px; overflow:hidden; position:relative;"><img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/257195.gif" name="articleTemplate_72" title="双击图片可进行替换"/><p style="margin:0; padding:0; position:absolute; right:0px; top:0px; text-align:center; line-height:17px; height:17px; width:23px; color:#fff; font-size:10px; font-family:Verdana;">02</p></div>\r\n				                        <div style="margin:0; padding:0; width:257px; height:200px; overflow:hidden;">\r\n				                             <div style="margin:0; padding:0; float:left; width:133px; height:200px; overflow:hidden; position:relative;"><img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/133200.gif" name="articleTemplate_73" title="双击图片可进行替换"/><p style="margin:0; padding:0; position:absolute; right:0px; bottom:0px; text-align:center; line-height:17px; height:17px; width:23px; color:#fff; font-size:10px; font-family:Verdana;">03</p></div>\r\n				                             <div style="margin:0; padding:0; float:left; width:124px; height:200px; overflow:hidden; position:relative;"><img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/124200.gif" name="articleTemplate_74" title="双击图片可进行替换"/><p style="margin:0; padding:0; position:absolute; right:0px; bottom:0px; text-align:center; line-height:17px; height:17px; width:23px; color:#fff; font-size:10px; font-family:Verdana;">04</p></div>\r\n				                             <div style="margin:0; padding:0;clear:both; height:0px; font-size:1px; overflow:hidden;"></div>\r\n				                        </div>\r\n				                    </div>\r\n				                </td>\r\n				                <td style="margin:0; padding:0; vertical-align:top;">\r\n				                    <div style="margin:0 10px 27px 0; padding:17px 10px 0 17px; width:186px; height:159px; background-color:#ccc; overflow:hidden;">\r\n				                         <p style="margin:0; padding:0; font-size:36px; font-family:黑体; height:36px; line-height:36px; color:#fdfe03; overflow:hidden;">BOBI</p>\r\n				                         <p style="margin:0 0 33px 0; padding:0; font-size:36px; font-family:黑体; line-height:44px; color:#fdfe03; height:44px; overflow:hidden;">十六个月啦</p>\r\n				                         <p style="margin:0; padding:0; width:177px; font-size:12px; color:#0497ff; line-height:14px; height:14px; overflow:hidden;">2010.07</p>\r\n				                         <p style="margin:0; padding:0; width:177px; font-size:12px; line-height:14px; height:14px; overflow:hidden;"><a style="color:#676767;" href="#" title="">http://www.sina.com.cn/</a></p>\r\n				                    </div>\r\n				                    <div style="margin:0 0 26px 0; padding:0;">\r\n				                         <div style="margin:0; padding:0; float:left; width:14px; height:13px; border-bottom:1px solid #cccccc;"></div><div style="margin:0; padding:0 0 0 8px; float:left; width:172px; line-height:170%; font-size:12px; font-weight:bold; color:#010101; font-family:Arial;">01</div>\r\n				                         <div style="margin:0; padding:0; clear:both; height:0px; font-size:1px; overflow:hidden;"></div>\r\n				                         <div style="margin:0; padding:0 0 0 22px; color:#838383; font-size:12px; line-height:150%; width:174px;"><p style="margin:0; padding:0;word-wrap:break-word; word-break:break-all;">奶奶你在吃什么好吃的</p><p style="margin:0; padding:0;word-wrap:break-word; word-break:break-all;">看看这无辜好吃的眼神……实在是没办法啊~</p></div>\r\n				                    </div>\r\n				                    <div style="margin:0 0 47px 0; padding:0;">\r\n				                         <div style="margin:0; padding:0; float:left; width:14px; height:13px; border-bottom:1px solid #cccccc;"></div><div style="margin:0; padding:0 0 0 8px; float:left; width:172px; line-height:170%; font-size:12px; font-weight:bold; color:#010101; font-family:Arial;">02</div>\r\n				                         <div style="margin:0; padding:0; clear:both; height:0px; font-size:1px; overflow:hidden;"></div>\r\n				                         <div style="margin:0; padding:0 0 0 22px; color:#838383; font-size:12px; line-height:150%; width:174px;"><p style="margin:0; padding:0;word-wrap:break-word; word-break:break-all;">邻居小姐姐是个漂亮的玩具泰迪哦～哈哈！偶今天遇到真正的美女了……Teddy Bear，中文翻译为泰迪熊，不过按照美国当地的说法应该称为罗斯福熊。泰迪熊以美国总统西奥多·</p></div>\r\n				                    </div>\r\n				                    <div style="margin:0 0 19px 0; padding:0;">\r\n				                         <div style="margin:0; padding:0; float:left; width:14px; height:13px; border-bottom:1px solid #cccccc;"></div><div style="margin:0; padding:0 0 0 8px; float:left; width:172px; line-height:170%; font-size:12px; font-weight:bold; color:#010101; font-family:Arial;">03</div>\r\n				                         <div style="margin:0; padding:0; clear:both; height:0px; font-size:1px; overflow:hidden;"></div>\r\n				                         <div style="margin:0; padding:0 0 0 22px; color:#838383; font-size:12px; line-height:150%; width:174px;"><p style="margin:0; padding:0;word-wrap:break-word; word-break:break-all;">大眼睛的饽饽小姐</p><p style="margin:0; padding:0;word-wrap:break-word; word-break:break-all;">BOBI很羡慕饽饽小姐的大眼睛……</p></div>\r\n				                    </div>\r\n				                    <div style="margin:0; padding:0;">\r\n				                         <div style="margin:0; padding:0; float:left; width:14px; height:13px; border-bottom:1px solid #cccccc;"></div><div style="margin:0; padding:0 0 0 8px; float:left; width:172px; line-height:170%; font-size:12px; font-weight:bold; color:#010101; font-family:Arial;">04</div>\r\n				                         <div style="margin:0; padding:0; clear:both; height:0px; font-size:1px; overflow:hidden;"></div>\r\n				                         <div style="margin:0; padding:0 0 0 22px; color:#838383; font-size:12px; line-height:150%; width:174px;"><p style="margin:0; padding:0;word-wrap:break-word; word-break:break-all;">偶是一只熊猫 </p><p style="margin:0; padding:0;word-wrap:break-word; word-break:break-all;">嘿嘿，变熊猫是国宝！人见人爱～尤其是偶麻麻……</p></div>\r\n				                    </div>\r\n				                </td>\r\n				            </tr>\r\n				            <tr style="margin:0; padding:0;">\r\n				                <td style="margin:0; padding:0; vertical-align:top;" colspan="2">\r\n				                    <div style="margin:0; padding:12px 10px 0 10px; width:490px; height:4px; overflow:hidden;"><img src="http://simg.sinajs.cn/blog7style/images/blog/editor_format/bg_color2.gif" alt="" /></div>\r\n				                    <div style="margin:0 10px 13px 10px; padding:0 0 0 21px; width:449px; height:22px; line-height:22px; background:url(http://simg.sinajs.cn/blog7style/images/blog/editor_format/bg_editor.gif) no-repeat left center; font-size:12px;"><span style="color:#29b1d7;">作者：</span><span style="color:#ff01af;">APPLE</span></div>\r\n				                </td>\r\n				            </tr>\r\n				      </table>'}]};return data}};Editor.Plugins.InsertTemplate=Core.Class.create();Editor.Plugins.InsertTemplate.prototype={countEle:"is_tpl",initialize:function(){},show:function(){editor.blur();if(!this.dialog){this.initDialog();this.initList();this.initEvent()}editor.blur();this.dialog.show()},hidden:function(){this.dialog.hidden()},initEvent:function(){Core.Events.addEvent($E("it_cancel"),this.hidden.bind2(this));Core.Events.addEvent($E("it_insert"),Core.Function.bind3(this.insert,this,[]))},initDialog:function(){var tpl=['<table id="#{entity}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}"></strong>','<cite><a title="关闭" class="CP_w_shut" id="#{btnClose}" href="javascript:;" onclick="return false">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span/></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}">',"</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join("");this.dialog=winDialog.createCustomsDialog({tpl:tpl,title:"插入模板",content:this.initHtml(),width:500},"tips");this.dialog.setAreaLocked(true).show().addEventListener("beforeShow",function(){this.setMiddle()})},initData:function(){this.template_data=(new Editor.Plugins.TemplateConfig).get()},insert:function(type,id){var type=type||this.selectData.type;var id=id||this.selectData.id;if(this.isInsert){Core.Dom.addHTML(editor.iframeDocument.body,this.template_data[type][id].html+"<br/>")}else{editor.insertHTML(this.template_data[type][id].html+"<br/>");var tplEle=$E(this.countEle);if(tplEle){tplEle.value="1"}this.isInsert=true}editor.initTemplateImage();this.hidden()},initList:function(){if(!this.template_data){this.initData()}$E("it_template_content").innerHTML=buildList("layout",this.template_data.layout);$E("it_graphical_content").innerHTML=buildList("graphical",this.template_data.graphical);function buildList(type,data){var html="",len=data.length;for(i=0;i<len;i++){if(i<len-1){html+='<li><a href="#" ondblclick="insertTemplate.insert(\''+type+"','"+i+"')\" onclick=\"insertTemplate.select('"+type+"','"+i+'\');return false;" title=""><img src="'+data[i].image+'" alt="" /></a></li>'}else{html+='<li class="last"><a href="#" ondblclick="insertTemplate.insert(\''+type+"','"+i+"')\" onclick=\"insertTemplate.select('"+type+"','"+i+'\');return false;" title=""><img src="'+data[i].image+'" alt="" /></a></li>'}}return html+'<div class="clear"></div>'}},select:function(type,id){this.selectData={id:id,type:type};var ele=Core.Events.getEventTarget().parentNode.parentNode;clearSelectClass("it_template_content");clearSelectClass("it_graphical_content");ele.className=ele.className+" formA_act";function clearSelectClass(parentId){var eles=Core.Dom.getElementsByClass($E(parentId),"li","formA_act");var len=eles.length;for(var i=0;i<len;i++){if(eles[i].className.indexOf("last"!=-1)){eles[i].className="last"}else{eles[i].className=""}}}},initHtml:function(){var html='<div class="CP_layercon6 blogManageItem">\r\n			<div class="editFom_table">\r\n               <ul id="it_template_content">\r\n               </ul>\r\n            </div>\r\n            <div class="editFom_exp">\r\n                 <div class="top"></div>\r\n                 <div class="mid">\r\n                     <ul id="it_graphical_content">\r\n                     </ul>\r\n                 </div>\r\n                 <div class="bot"></div>\r\n            </div>\r\n			<div class="btn"><a class="SG_aBtn SG_aBtnB" onclick="return false" href="#"><cite id="it_insert">插入模板</cite></a>&nbsp;<a class="SG_aBtn SG_aBtnB" href="#" onclick="return false"><cite id="it_cancel">取消</cite></a></div>\r\n		</div>';return html}};(function(){var transitions={simple:function(time,startValue,changeValue,duration){return changeValue*time/duration+startValue},backEaseIn:function(t,b,c,d){var s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b},backEaseOut:function(t,b,c,d,a,p){var s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},backEaseInOut:function(t,b,c,d,a,p){var s=1.70158;if((t/=d/2)<1){return c/2*(t*t*(((s*=1.525)+1)*t-s))+b}return c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b},bounceEaseOut:function(t,b,c,d){if((t/=d)<1/2.75){return c*(7.5625*t*t)+b}else if(t<2/2.75){return c*(7.5625*(t-=1.5/2.75)*t+.75)+b}else if(t<2.5/2.75){return c*(7.5625*(t-=2.25/2.75)*t+.9375)+b}else{return c*(7.5625*(t-=2.625/2.75)*t+.984375)+b}},bounceEaseIn:function(t,b,c,d){return c-transitions.bounceEaseOut(d-t,0,c,d)+b},bounceEaseInOut:function(t,b,c,d){if(t<d/2){return transitions.bounceEaseIn(t*2,0,c,d)*.5+b}else{return transitions.bounceEaseOut(t*2-d,0,c,d)*.5+c*.5+b}},strongEaseInOut:function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},regularEaseIn:function(t,b,c,d){return c*(t/=d)*t+b},regularEaseOut:function(t,b,c,d){return-c*(t/=d)*(t-2)+b},regularEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b}return-c/2*(--t*(t-2)-1)+b},strongEaseIn:function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},strongEaseOut:function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},strongEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t*t+b}return c/2*((t-=2)*t*t*t*t+2)+b},elasticEaseIn:function(t,b,c,d,a,p){if(t==0){return b}if((t/=d)==1){return b+c}if(!p){p=d*.3}if(!a||a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b},elasticEaseOut:function(t,b,c,d,a,p){if(t==0){return b}if((t/=d)==1){return b+c}if(!p){p=d*.3}if(!a||a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b},elasticEaseInOut:function(t,b,c,d,a,p){if(t==0){return b}if((t/=d/2)==2){return b+c}if(!p){var p=d*(.3*1.5)}if(!a||a<Math.abs(c)){var a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}if(t<1){return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b}return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b}};var getUniqueID=function(oNode){return oNode.uniqueID};if(!$IE){getUniqueID=function(oNode){try{var rnd_ID;if(oNode.getAttribute("uniqueID")==null){rnd_ID="moz__id"+parseInt(Math.random()*100)+"_"+(new Date).getTime();oNode.setAttribute("uniqueID",rnd_ID);return rnd_ID}return oNode.getAttribute("uniqueID")}finally{rnd_ID=null}}}function getType(oObject){try{var s=oObject.constructor.toString().toLowerCase();return s.slice(s.indexOf("function")+9,s.indexOf("()"))}finally{s=null}}function getStartValue(oNode,aProperty){var i,_len,_arr=[];_len=aProperty.length;for(i=0;i<_len;i++){_arr[_arr.length]=parseFloat(Core.Dom.getStyle(oNode,aProperty[i]))}return _arr}function formatProperty(oProperty){return getType(oProperty)!="array"?[oProperty]:oProperty}function formatValue(oEndingValue,aProperty){try{var _type=getType(oEndingValue);var _valuearray=[],_suffixarray=[],i,_len,_suffix;if(_type!="array"){_suffix=getSuffix(oEndingValue);_suffix[1]=aProperty=="opacity"?"":_suffix[1];_valuearray=[_suffix[0]];_suffixarray=[_suffix[1]]}else{_len=oEndingValue.length;for(i=0;i<_len;i++){_suffix=getSuffix(oEndingValue[i]);_suffix[1]=aProperty[i]=="opacity"?"":_suffix[1];_valuearray[_valuearray.length]=_suffix[0];_suffixarray[_suffixarray.length]=_suffix[1]}}return[_valuearray,_suffixarray]}finally{_type=_valuearray=_suffixarray=i=_len=_suffix=null}}function getSuffix(sValue){try{var charCase=/(-?\d.?\d*)([a-z%]*)/i.exec(sValue);return[charCase[1],charCase[2]?charCase[2]:"px"]}finally{charCase=null}}var runList={};var saveList={};function getInstance(oNode){try{var uID=getUniqueID(oNode);var runFunc;if(runList[uID]!=true){runFunc=new ancestor;saveList[uID]={node:oNode,func:runFunc};runList[uID]=true;return runFunc}else{return saveList[uID].func}}finally{uID=runFunc=null}}function ancestor(){this._timer=null}ancestor.prototype.start=function(oNode,oProperty,oEndingValue,nSeconds,sAnimation,oFunc){this.reset();oFunc=oFunc||{};if(oFunc.before){this._func.before=oFunc.before}if(oFunc.end){this._func.end=oFunc.end}if(oFunc.tween){this._func.tween=oFunc.tween}var _propertyArr=formatProperty(oProperty);var _startValueArr=getStartValue(oNode,_propertyArr);var _endValueArr=formatValue(oEndingValue,_propertyArr);this._node=oNode;this._property=_propertyArr;this._endingvalue=_endValueArr[0];this._suffixvalue=_endValueArr[1];this._startvalue=_startValueArr;this._end=false;this._fps=0;if(nSeconds!=null){this._seconds=nSeconds}if(transitions[sAnimation]!=null){this._animation=transitions[sAnimation]}this._starttime=(new Date).getTime();this._func.before();this._timer=setInterval(Core.Function.bind3(this.play,this),10)};ancestor.prototype.play=function(){var nTime=((new Date).getTime()-this._starttime)/1e3;var i,ani,_len=this._property.length;if(nTime>this._seconds){nTime=this._seconds}for(i=0;i<_len;i++){ani=this._animation(nTime,this._startvalue[i],this._endingvalue[i]-this._startvalue[i],this._seconds);Core.Dom.setStyle(this._node,this._property[i],ani+this._suffixvalue[i])}this._fps++;this._func.tween();if(nTime==this._seconds){this.stop()}};ancestor.prototype.stop=function(){clearInterval(this._timer);this._end=true;this._func.end()};ancestor.prototype.reset=function(){clearInterval(this._timer);this._end=false;this._node=null;this._property=[];this._startvalue=[];this._endingvalue=[];this._suffixvalue=[];this._fps=0;this._seconds=.5;this._animation=transitions.simple;this._func={end:function(){},tween:function(){},before:function(){}}};function tween(oNode,oProperty,oEndingValue,nSeconds,sAnimation,oFunc){var instance=getInstance(oNode);instance.start.apply(instance,arguments)}tween.stop=function(oNode){getInstance(oNode).stop()};tween.isTween=function(oNode){return!getInstance(oNode)._end};Ui.tween=tween})();(function(){var cont='<div class="CP_layercon2 baby_infoLayer"><div class="baby_stateTab">\r\n	<table cellspacing="0" cellpadding="0" border="0">\r\n		<tbody><tr>\r\n			<th scope="row">宝宝昵称：</th>\r\n			<td><input type="text" maxlength="16" class="SG_input nickname" name="babynick" id="babynick" gtbfieldid="21">\r\n				<p class="tip">最多8个汉字</p>\r\n				<p style="display: none;" class="err">错误提示</p></td>\r\n		</tr>\r\n		<tr>\r\n			<th scope="row">宝宝性别：</th>\r\n			<td><span>\r\n				<input type="radio" value="male" name="babysex" id="babyboy">\r\n				<label for="">男宝宝</label>\r\n				&nbsp;&nbsp;\r\n				<input type="radio" value="female" name="babysex" id="babygirl">\r\n				<label for="">女宝宝</label>\r\n				</span>\r\n				<p style="display: none;" class="err">请选择性别</p>\r\n				</td>\r\n		</tr>\r\n		<tr>\r\n			<th scope="row">宝宝生日：</th>\r\n			<td><select id="birthyear" name="birthyear" gtbfieldid="22">\r\n				</select>\r\n				&nbsp;年&nbsp;&nbsp;\r\n				<select id="birthmonth" name="birthmonth" gtbfieldid="23">\r\n				</select>\r\n				&nbsp;月&nbsp;&nbsp;\r\n				<select id="birthday">\r\n					<option value="0">请选择</option>\r\n				</select>\r\n				&nbsp;日&nbsp;&nbsp;\r\n				<p style="display: none;" class="err">请填写完整生日（年、月、日）</p></td>\r\n		</tr>\r\n		<tr>\r\n			<th scope="row">宝宝身高：</th>\r\n			<td><input type="text" maxlength="5" name="bodyheight" id="bodyheight" class="SG_input height" gtbfieldid="24">\r\n				cm\r\n				<p style="display: none;" class="err">请填写宝宝身高</p>\r\n				</td>\r\n		</tr>\r\n		<tr>\r\n			<th scope="row">宝宝体重：</th>\r\n			<td><input type="text" maxlength="5" name="bodyweight" id="bodyweight" class="SG_input weight" gtbfieldid="25">\r\n				kg<p style="display: none;" class="err">请填写宝宝体重</p></td>\r\n		</tr>\r\n	</tbody></table>\r\n	<p id="addbaby">\r\n		<a class="underline" href="#">填写第二个宝宝资料</a>\r\n	</p>\r\n</div><div class="btn"><a class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="baby_data_save">保存</cite></a>&nbsp;&nbsp;<a class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="baby_data_cancel">取消</cite></a></div></div>';scope.babyDataOnOk=function(opt){var dialog=winDialog.createCustomsDialog({title:"请填写宝宝信息",content:cont,width:350},"tips_baby_data");dialog.setMiddle();dialog.addEventListener("hidden",function(){this.destroy()});dialog.setAreaLocked(true);dialog.show();$E("baby_data_cancel").onclick=function(){dialog.close()};var SelectAppender=function(step){this.step=step||1};SelectAppender.prototype={initialize:function(selObj,startValue,endValue){var i,m;if(this.step>=0){i=Math.min(startValue,endValue);m=Math.max(startValue,endValue);for(i;i<=m;i+=this.step){var op=$C("option");op.innerHTML=i;op.value=i;selObj.appendChild(op)}}else{i=Math.max(startValue,endValue);m=Math.min(startValue,endValue);for(i;i>=m;i+=this.step){var op=$C("option");op.innerHTML=i;op.value=i;selObj.appendChild(op)}}}};var dateNum=function(y,m){var isLeap=function(y){return y%400?y%100?y%4?0:1:0:1};if(!(y*m)){return 0}var d=31;switch(m){case 4:case 6:case 9:case 11:d=30;break;case 2:d=isLeap(y)?29:28;break}return d};var operItem=function(dom,n){var ov=parseInt(dom.value)||0;if(/msie/.test(navigator.userAgent.toLowerCase())){setTimeout(operDom,200)}else{operDom()}function operDom(){while(dom.options.length>1){dom.remove(1)}for(var i=1;i<=n;i++){dom.options[dom.options.length]=new Option(i,i)}dom.value=Math.min(ov,n)}};var selecter=function(oYear,oMonth,oDate,value){var sel=function(){operItem(oDate,dateNum(parseInt(oYear.value),parseInt(oMonth.value)))};Core.Events.addEvent(oYear,sel,"change");Core.Events.addEvent(oMonth,sel,"change");sel();oDate.value=value||"0"};var selectAppender=new SelectAppender;var addBaby=$E("addbaby"),temdiv=$C("div");temdiv.appendChild($T(addBaby.parentNode,"TABLE")[0].cloneNode(true));var addBabyHtml=temdiv.innerHTML;var babyArr=[];var number=function(evt){evt=evt||event;var elem=evt.srcElement||evt.target,value=elem.value;elem.value=value.replace(/^0+/,"");if(parseFloat(value)!=value||/\.\d{2,}/.test(value)||parseFloat(value)>=1e3){elem.value=value.slice(0,-1);elem.value=elem.value.replace(/[^\d.]/g,"")}};var submitBtn=$E("baby_data_save");function init(babyArr){var n=babyArr.length-1||"";var now=new Date;var nowYear=now.getFullYear();var nowMonth=now.getMonth();var birthYear=$E("birthyear"+n),birthMonth=$E("birthmonth"+n),birthDay=$E("birthday"+n),babyNick=$E("babynick"+n),babyBoy=$E("babyboy"+n),babyGirl=$E("babygirl"+n),babyHeight=$E("bodyheight"+n),babyWeight=$E("bodyweight"+n),babyNickErr=Core.Dom.byClz(babyNick.parentNode,"p","err")[0],babyGenderErr=Core.Dom.byClz(babyBoy.parentNode.parentNode,"p","err")[0],bybyBirthErr=Core.Dom.byClz(birthYear.parentNode,"p","err")[0],babyHeightErr=Core.Dom.byClz(babyHeight.parentNode,"p","err")[0],babyWeightErr=Core.Dom.byClz(babyWeight.parentNode,"p","err")[0];selectAppender.initialize(birthYear,nowYear,nowYear-6);selectAppender.initialize(birthMonth,1,12);selectAppender.initialize(birthDay,1,31);selecter(birthYear,birthMonth,birthDay);scope.baby={};babyNick.onblur=function(){if(babyNick.value==""){scope.baby.incomplete=true;babyNickErr.style.display="";babyNickErr.innerHTML="请填写宝宝昵称"}else if(Core.String.byteLength(babyNick.value)<4&&babyNick.value!=""){babyNickErr.style.display="";babyNickErr.innerHTML="宝宝昵称长度为2-10个汉字（4-20个字符）";scope.baby.incomplete=true}else if(babyNick.value.match(/[^\w\u4E00-\u9FA5]/)){babyNickErr.style.display="";babyNickErr.innerHTML="宝宝昵称只允许使用中文、英文、数字、下划线。 ";scope.baby.incomplete=true}};babyNick.onfocus=function(){babyNickErr.innerHTML=""};Core.Events.addEvent("bodyweight"+n,number,"input");Core.Events.addEvent("bodyheight"+n,number,"input");if($IE){Core.Events.addEvent("bodyweight"+n,number,"keyup");Core.Events.addEvent("bodyweight"+n,number,"keypress");Core.Events.addEvent("bodyheight"+n,number,"keyup");Core.Events.addEvent("bodyheight"+n,number,"keypress")}function tip(err){scope.baby.incomplete=true;err.style.display="";Core.Array.foreach([].slice.call(arguments,1),function(elem){elem.onfocus=function(){err.style.display="none"}})}Core.Events.addEvent($E("baby_data_save"),function(){if(babyNick.value==""){scope.baby.incomplete=true;babyNickErr.style.display="";babyNickErr.innerHTML="请填写宝宝昵称"}if(birthMonth.value==0||birthDay.value==0){tip(bybyBirthErr,birthYear,birthMonth,birthDay)}if(!babyBoy.checked&&!babyGirl.checked){tip(babyGenderErr,babyGirl,babyBoy)}if(babyHeight.value==""){tip(babyHeightErr,babyHeight)}if(babyWeight.value==""){tip(babyWeightErr,babyWeight)}if(n==babyArr.length-1&&!scope.baby.response){scope.baby.response=true;if(scope.baby.incomplete){winDialog.alert("您填写的信息有误，请根据页面红字更改。",{funcOk:function(){scope.baby.response=scope.baby.incomplete=null}})}else{postValue()}}},"click")}function postValue(getParam){var info={babystates:2};Core.Array.foreach(babyArr,function(obj,i){i=i||"";info["babynick"+i]=$E(obj.babynick).value;info["babysex"+i]=$E(obj.babyboy).checked?"male":"female";info["birthyear"+i]=$E(obj.birthyear).value;info["birthmonth"+i]=$E(obj.birthmonth).value;info["birthday"+i]=$E(obj.birthday).value;

info["bodyheight"+i]=$E(obj.bodyheight).value;info["bodyweight"+i]=$E(obj.bodyweight).value});getParam=getParam||info;new Interface("http://control.blog.sina.com.cn/riaapi/reg/init_blog_userinfo.php","ajax").request({POST:getParam,onSuccess:function(res){if(opt.okCall(info)){dialog.close()}delete scope.baby},onError:function(res){winDialog.alert($SYSMSG[res.code],{funcOk:function(){}})}})}babyArr.push({birthyear:"birthyear",birthday:"birthday",birthmonth:"birthmonth",babyboy:"babyboy",babynick:"babynick",bodyweight:"bodyweight",bodyheight:"bodyheight"});init(babyArr);addBaby.onclick=function(){var div=$C("div"),obj={},len=babyArr.length;babyArr.push(obj);var html=addBabyHtml.replace(/((?:id|name)="?)(.+?)\b("?)/g,function(a,b,c,d){obj[c]=c+len;return b+c+len+d});div.innerHTML="<br/><br/>"+html;div.style.height=0;div.style.overflow="hidden";this.parentNode.insertBefore(div,this);Ui.tween(div,"height",211,.4,"simple",{end:function(){div.style.overflow="visible";div.style.height=""}});obj.elem=div;init(babyArr);this.style.display="none";return false}}})();if(!scope.flashComponent){scope.flashComponent={}}scope.flashComponent.BabyBarConfig={type1:{bgURL:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/babyBar/bg1.png",cursorURL:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/babyBar/cursor1.png",cursorX:47,cursorY:0,dltX:30,tX:60,tY:40,tOffsetY:-4,font:"黑体",color:"0x0066FF",size:"16"},type2:{bgURL:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/babyBar/bg2.png",cursorURL:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/babyBar/cursor2.png",cursorX:120,cursorY:38,dltX:30,tX:80,tY:10,tOffsetY:-5,font:"黑体",color:"0xFFFF00",size:"18"},type3:{bgURL:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/babyBar/bg3.png",cursorURL:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/babyBar/cursor3.png",cursorX:64,cursorY:20,dltX:30,tX:75,tY:43,tOffsetY:-6,font:"黑体",color:"0x006600",size:"18"},type4:{bgURL:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/babyBar/bg4.png",cursorURL:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/babyBar/cursor4.png",cursorX:152,cursorY:58,dltX:30,tX:155,tY:18,tOffsetY:-6,font:"幼圆",color:"0xCD00AB",size:"16"}};scope.flashComponent.getFinalData=function(textTypes){var listCfg=[],bc=scope.flashComponent.BabyBarConfig,i,l=textTypes.length,k;for(i=0;i<l;i++){for(k in textTypes[i]){listCfg.push([k,"=",textTypes[i][k],";"].join(""))}var tpCfg=bc[textTypes[i].textType];for(k in tpCfg){listCfg.push([k,"=",tpCfg[k],";"].join(""))}listCfg.push("|")}listCfg.pop();return listCfg.join("")};Editor.Plugins.InsertYuerProgressbar=Core.Class.create();Editor.Plugins.InsertYuerProgressbar.prototype={countEle:"is_tpl",initialize:function(){},validateHasOne:function(){var imgs=editor.iframeDocument.body.getElementsByTagName("img");for(var i=0;imgs[i];i++){var type=imgs[i].getAttribute("imgType");if(type&&type=="yuer"){return true}}return false},show:function(){if(this.validateHasOne()){winDialog.alert("每篇博文只能添加一个宝宝生日",{icon:"01"});return}var me=this;new Interface("http://control.blog.sina.com.cn/admin/article/babybar.php","jsload").request({onSuccess:function(_data){scope.babyNewsMsg=_data;me.callShow()},onError:function(_data){if(_data.code=="B88040"||_data.code=="A00005"||_data.code=="A00004"){winDialog.alert("非法操作!",{icon:"02",funcOk:function(){window.location.reload()}});return}else if(_data.code=="B88041"){winDialog.alert("等您的小宝宝降生后才能使用此功能。加油！",{icon:"02"})}else{showError(_data.code)}},onFail:function(){winDialog.alert("请求发送失败！请重试。",{icon:"02"})}})},callShow:function(){editor.blur();if(!this.dialog){this.initDialog();this.initEvent()}this.getData();editor.blur();this.dialog.show()},getData:function(){$E("yuerTopicContainer").innerHTML='<li style="text-align:center;"><img src="http://simg.sinajs.cn/blog7style/images/common/loading.gif" />加载中…</li>';setTimeout(function(){$E("yuerTopicContainer").innerHTML="";var strs=[];for(var i=0;i<4;i++){strs.push('<li style="border:1px solid #FFFFFF;" ondblclick="insertYuerProgressbar.insert(');strs.push(i+1);strs.push(')" onclick="insertYuerProgressbar.select(this)" onmouseover="this.style.cssText=\'border:1px solid #65B954;\'" onmouseout="this.style.cssText=\'border:1px solid #FFFFFF;\'"><input type="radio" name="inputYuerProcess" id="inputYuerProcess_');strs.push(i);strs.push('" /> <label for="inputYuerProcess_');strs.push(i);strs.push('"><img class="baby_bn baby_bn');strs.push(i+1);strs.push('" type="');strs.push(i+1);strs.push('" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif"/></label></li>')}$E("yuerTopicContainer").innerHTML=strs.join("")},1e3)},hidden:function(){if(this.dialog){this.dialog.hidden()}},initEvent:function(){Core.Events.addEvent($E("inertYuer"),Core.Function.bind3(this.insert,this,[]))},initDialog:function(){var tpl=['<table id="#{entity}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}"></strong>','<cite><a title="关闭" class="CP_w_shut" id="#{btnClose}" href="javascript:;" onclick="return false">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span/></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}">',"</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join("");this.dialog=winDialog.createCustomsDialog({tpl:tpl,title:"插入成长进度条",content:this.initHtml(),width:500},"tips_yuer");this.dialog.setAreaLocked(true).show().addEventListener("beforeShow",function(){this.setMiddle()})},initData:function(){this.template_data=(new Editor.Plugins.TemplateConfig).get()},insertNow:function(id){if(this.validateHasOne()){winDialog.alert("每篇博文只能添加一个宝宝生日",{icon:"01"});return}if(!id){winDialog.alert("参数传递错误!",{icon:"01"});return}if(!scope.babyNewsMsg){winDialog.alert("非法调用",{icon:"01"});return}this.insert(id)},insert:function(id){if(!id){var lis=$E("yuerTopicContainer").getElementsByTagName("li");for(var i=0;lis[i];i++){var li=lis[i];if(li.className&&li.className=="ABC"){id=li.getElementsByTagName("img")[0].getAttribute("type")}}if(!id){id=-1}}if(id<0){winDialog.alert("您还没有选择成长进度条",{icon:"01"});return}var img=editor.iframeDocument.createElement("img");img.setAttribute("imgType","yuer");img.src="http://simg.sinajs.cn/blog7style/images/common/baby/banner"+id+".png";var msg=scope.babyNewsMsg;var total=[];for(var i=0;msg[i];i++){var babyData=[];babyData.push('"textType":"type'+id+'"');babyData.push('"name":"'+msg[i].name+'"');babyData.push('"y":"'+msg[i].y+'"');babyData.push('"m":"'+msg[i].m+'"');babyData.push('"d":"'+msg[i].d+'"');total.push("{"+babyData.join(",")+"}")}img.setAttribute("yuermsg","listCfg="+scope.flashComponent.getFinalData(eval("(["+total.join(",")+"])")));img.setAttribute("type","face");if($IE){var body=editor.iframeDocument.body;if(body.firstChild){var first=body.firstChild;body.insertBefore(img,first)}else{body.appendChild(img)}}else{var range=editor.iframeDocument.createRange();var body=editor.iframeDocument.body;range.selectNode(body.firstChild);range.insertNode(img);range.collapse(false)}this.hidden()},select:function(li){var inputs=li.parentNode.getElementsByTagName("input");for(var i=0;inputs[i];i++){inputs[i].checked=false;inputs[i].parentNode.className=""}li.getElementsByTagName("input")[0].checked=true;li.className="ABC"},initHtml:function(){var html=['<div class="CP_layercon2 baby_bannerLayer">','<ul id="yuerTopicContainer">',"</ul>",'<div class="btn"><a href="###" onclick="return false;" class="SG_aBtn SG_aBtnB"><cite id="inertYuer">插入成长进度条</cite></a></div> ',"</div>"].join("");return html}};Editor.Plugins.InsertMB=Core.Class.create();Editor.Plugins.InsertMB.prototype={select:[],selectData:[],childData:[],btnState:"dis",tipType:"loading",initialize:function(containerId){this.initDialog();this.initInterface();this.bindEvent()},initInterface:function(){this._interface=new Interface("http://control.blog.sina.com.cn/admin/article/admin_mblog.php","ajax")},initDialog:function(){this.dialog=winDialog.createCustomsDialog({title:"插入微博条目",content:this.initHtml(),width:500,height:200},"tips");this.dialog.setAreaLocked(true).addEventListener("beforeShow",function(){this.setMiddle()})},bindEvent:function(){Core.Events.addEvent($E("mb_ok"),this.toEditor.bind2(this));Core.Events.addEvent($E("mb_cancel"),this.cancel.bind2(this))},cancel:function(){this.hidden()},loadData:function(page){this.setTip("loading");var page=page||1;var param={uid:scope.$uid,version:7,pagesize:10,page:page,random:Math.random()};this._interface.request({GET:param,onSuccess:function(_data){this.setTip("hidden");if(_data.count==0&&page<2){this.hidden();showError("还没有发表微博<br/><a target='_blank' href='http://weibo.com/"+$UID+"'>现在发一条>></a>")}else{this.currentData=_data.result;this.pics=[];this.buildLink(_data);this.buildList(_data.result);this.initSelect();this.page(page,_data.count)}}.bind2(this),onError:function(_data){this.hidden();if(_data.code=="B120001"){showError("还没有发表微博<br/><a target='_blank' href='http://weibo.com/"+$UID+"'>现在发一条>></a>")}else{showError(_data.code)}}.bind2(this),onFail:function(){}})},getTime:function(newtime){var d,y,m,day;d=new Date;d.setTime(newtime*1e3);y=d.getFullYear();m=(d.getMonth()+1).toString();if(m.length<2){m="0"+m}day=d.getDate().toString();if(day.length<2){day="0"+day}return y+"-"+m+"-"+day},show:function(){this.dialog.show();this.setData()},setData:function(){this.select=[];this.selectData=[];this.childData=[];this.loadData()},hidden:function(){this.dialog.hidden()},buildLink:function buildLink(data){var that=this;if(typeof data.t_sina_uid==undefined){setTimeout(function(){trace("buildLink");buildLink.call(that,data)},100);return}if(data.t_sina_uid){$E("mb_link").innerHTML='<div class="tEdit_tips" style="text-align:right;margin-bottom:10px">已绑定微博：weibo.com/'+data.result[0].uid+' <span class="SG_more"><a href="http://control.blog.sina.com.cn/blogprofile/bind_t_sina_blog.php" target="_blank">修改&gt;&gt;</a></span></div>'}else{$E("mb_link").innerHTML='<div class="tEdit_tips" style="text-align:right;margin-bottom:10px">还未绑定新浪微博...  <span class="SG_more"><a href="http://control.blog.sina.com.cn/blogprofile/bind_t_sina_blog.php" target="_blank">设置&gt;&gt;</a></span></div>'}},buildList:function(data){var html="",len=data.length;this.childData=[];for(var i=0;i<len;i++){html+=this.buildListItem(data[i])}$E("mb_content").innerHTML=html;this.initListEvent(data);this.buildPics();this.buildchild()},initListEvent:function(data){var len=data.length;for(var i=0;i<len;i++){var ele=$E("mblog_int_"+data[i].mblogid);Core.Events.addEvent(ele,this.selectItem.bind2(this))}},initSelect:function(){var len=this.select.length;for(var i=0;i<len;i++){if($E("mblog_list_"+this.select[i])){$E("mblog_int_"+this.select[i]).click()}}},selectItem:function(){var ele=Core.Events.getEventTarget();var id=ele.id.split("_")[2];if(ele.checked){ele.parentNode.parentNode.className="current";if(Core.Array.findit(this.select,id)==-1){this.select.push(id)}if(!this.selectData[id]){for(var name in this.currentData){if(id==this.currentData[name].mblogid){this.selectData[id]=this.currentData[name]}}}this.setBtnState()}else{ele.parentNode.parentNode.className="";this.select=Core.Array.ArrayWithout(this.select,id)}this.setBtnState()},buildPics:function(){for(var name in this.pics){var ele=$E("mblog_pic_"+name);if(ele){Core.Dom.addHTML(ele,'<img align="absmiddle" alt="" src="'+this.pics[name]+'"/>');ele.style.display="block"}}},replaceUrl:function(content){var reg=/(http:\/\/[^\s]*)/gi;if(reg.test(content)){trace(content);return content.replace(reg,"<a target='_blank' href='$1'>$1</a>")}else{return content}},page:function(pageNum,count){var maxPage=Math.ceil(count/10,10);if(maxPage>1){Ui.Pagination.init({pageNode:"mb_page",nodeClassNamePrefix:"SG",curPage:pageNum,maxPage:maxPage,pageTpl:this.loadData.bind2(this),type:1}).show()}else{$E("mb_page").innerHTML=""}},selectSort:function(s_array,s_compare){var len=s_array.length;for(var i=0;i<len;i++){var minIndex=i;for(j=i+1;j<len;j++){if(s_compare(s_array[minIndex],s_array[j])){minIndex=j}}swap(i,minIndex)}function swap(x,y){var x_bak=s_array[x];s_array[x]=s_array[y];s_array[y]=x_bak}return s_array},compare:function(x,y){if(this.selectData[x].time<this.selectData[y].time){return true}else{return false}},buildListItem:function(data){var d={};d.mblogid=data.mblogid;d.time=this.getTime(data.time);if(data.rt&&data.rt.rtreason){d.text=this.replaceUrl(data.rt.rtreason);this.childData.push(data)}else{d.text=this.replaceUrl(data.content.text)}if(data.content.pic){for(name in data.content.pic){this.pics[data.mblogid]=data.content.pic[name]}}var html='\r\n		<li id="mblog_list_#{mblogid}">\r\n		  <div class="tEditSInp">\r\n		    <input id="mblog_int_#{mblogid}" type="checkbox"/>\r\n		  </div>\r\n		  <div class="tEditSTxt" >\r\n		    <label id="mblog_txt_#{mblogid}" for="mblog_int_#{mblogid}">#{text}</label>\r\n			<div class="tCiteBox" id="mblog_child_#{mblogid}" style="display:none"></div>\r\n			<p class="tcontentPic" id="mblog_pic_#{mblogid}" style="display:none"></p>\r\n		    <p class="time" id="mblog_time_#{mblogid}">#{time}</p>\r\n		  </div>\r\n		  <div class="clearit"/>\r\n		</li>';return new Ui.Template(html).evaluate(d)},setBtnState:function(state){var ele=$E("mb_ok");if(this.select.length>0){ele.parentNode.className="SG_aBtn SG_aBtnB";this.btnState="ok"}else{ele.parentNode.className="SG_aBtn SG_aBtn_dis";this.btnState="dis"}},setTip:function(type){var ele=$E("mb_tip");switch(type){case"hidden":if(this.tipType!="hidden"){ele.style.display="none";this.tipType="hidden"}break;case"loading":if(this.tipType=="hidden"){ele.style.display="block"}ele.innerHTML="加载中";this.tipType="loading";break}},buildchild:function(){var len=this.childData.length;for(var i=0;i<len;i++){var d={};for(var name in this.childData[i].content.atUsers){d.user=name;break}if(d.user){d.uid=this.childData[i].rt.fromuid}else{if(this.childData[i].rt.fromuserinfo){d.user=this.childData[i].rt.fromuserinfo.nick;d.uid=this.childData[i].rt.fromuserinfo.uid}}d.text=this.replaceUrl(this.childData[i].content.text);var html='<div class="tCiteBox_top"></div>\r\n						  <div class="tCiteBox_cen">\r\n							<span class="name"><a target="_blank" href="http://weibo.com/#{uid}">#{user}</a>：</span>\r\n							<span class="txt">#{text}</span>\r\n						  </div>\r\n						  <div class="tCiteBox_bottom"></div>';var ele=$E("mblog_child_"+this.childData[i].mblogid);Core.Dom.addHTML(ele,new Ui.Template(html).evaluate(d));ele.style.display="block"}},initHtml:function(){var html='<div class="CP_layercon3">\r\n		<div id="mb_link"></div>\r\n		<div class="tEditBoxS">\r\n			<div class="tEditS">\r\n			  <ul id="mb_content">\r\n			  </ul>\r\n			  <div id="mb_tip">加载中。。。</div>\r\n			</div>\r\n			<div class="fenyeCon">\r\n				<div class="SG_page" id="mb_page"></div>\r\n			</div>\r\n			<div class="btn"><a class="SG_aBtn SG_aBtn_dis" href="#" onclick="return false"><cite id="mb_ok">确定</cite></a>&nbsp;&nbsp;\r\n			<a class="SG_aBtn SG_aBtnB" href="#" onclick="return false"><cite id="mb_cancel">取消</cite></a></div>\r\n		</div>\r\n		</div>';return html},toEditor:function(){if(this.btnState!="ok"){return}var itemHtml='<div>\r\n		   <p>#{text}</p>\r\n		    <BLOCKQUOTE style="FONT-SIZE: 12px">#{child}</BLOCKQUOTE>\r\n			 #{pics}\r\n		   <P style="COLOR: rgb(153,153,153); FONT-SIZE: 12px">#{time}</P>\r\n			</div>\r\n			<br/>';var childHtml='<p>\r\n				<SPAN>\r\n					<A href="http://weibo.com/#{uid}" target=_blank>#{name}</A>：\r\n				</SPAN>\r\n				<SPAN style="COLOR: rgb(153,153,153)">\r\n					#{text}\r\n				</SPAN>\r\n			</p>';var picHtml='<p><A target="_blank" href="http://weibo.com/#{uid}/#{mblogid}"><IMG src="#{pic}" title="查看原图" ></A> </p>';var len=this.select.length;var html="";this.select=this.selectSort(this.select,this.compare.bind2(this));for(var i=0;i<len;i++){var data=this.selectData[this.select[i]];var d={};d.time=this.getTime(data.time);if(data.rt&&data.rt.rtreason){d.text=this.replaceUrl(data.rt.rtreason);var dc={};dc.uid=data.rt.rootuid;for(var name in data.content.atUsers){dc.name=name;break}if(!dc.name){if(data.rt.fromuserinfo){dc.name=data.rt.fromuserinfo.nick;dc.uid=data.rt.fromuserinfo.uid}}dc.text=this.replaceUrl(data.content.text);d.child=new Ui.Template(childHtml).evaluate(dc)}else{d.text=this.replaceUrl(data.content.text);d.child=""}if(data.content.pic){var dp={};dp.uid=data.uid;dp.mblogid=data.mblogid;for(name in data.content.pic){dp.pic=data.content.pic[name].replace("thumbnail","bmiddle");break}d.pics=new Ui.Template(picHtml).evaluate(dp)}else{d.pics=""}html+=new Ui.Template(itemHtml).evaluate(d)}editor.insertHTML(html);this.hidden()}};scope.musicHash={tab_container:"mm_ta_con",store_container:"mm_st_con",favorite_container:"mm_fa_con",web_container:"mm_we_con",match_container:"mm_ma_con",insert_container:"mm_in_con",list_container:"mm_list_con",searchItem:"sm_se_item",hotItem:"sm_ho_item",searchInput:"sm_input",searchSelect:"sm_select",searchSuggest:"sm_suggest",insertButton:"btnInsertMusic",song_checkbox:"sp_so_input_",fav_song_checkbox:"cb_fav_",album_checkbox:"sp_al_input_",music_play:"sm_play_",appendToLast:"cb_appendToLast",insertText:"cb_insertLyric",autoButton:"cb_autoPlay"};Editor.Plugins.Suggest=Core.Class.create();Editor.Plugins.Suggest.prototype={url:" http://music.sina.com.cn/shequ/port/sinablog/blog_ajax_associatewords.php",tempHtml:"<li><a href='#' onclick='scope.musicOperate.sm.search(event,\"select\");return false'>#{name}</a></li>",s_data:{},isShow:false,template:null,initialize:function(){this.initInterface();this.initEvents()},initEvents:function(){var oNode=$E(scope.musicHash.searchInput);Core.Events.addEvent(document,this.hide.bind2(this),"click");Core.Events.addEvent(oNode,this.clearTip,"click");Core.Events.addEvent(oNode,this.loadData.bind2(this),"keyup");Core.Events.addEvent(oNode,function(e){},"keydown")},clearTip:function(){var oNode=$E(scope.musicHash.searchInput);if(oNode.value==scope.musicOperate.searchTip){oNode.value=""}},setTip:function(){var oNode=$E(scope.musicHash.searchInput);if(oNode.value==""){oNode.value=scope.musicOperate.searchTip}},hide:function(){if(this.isShow){trace("hide");var ulNode=$E(scope.musicHash.searchSuggest);ulNode.style.display="none";this.isShow=false}},show:function(){var seNode=$E(scope.musicHash.searchSuggest);if(!this.isShow){seNode.style.display=""}trace("show");this.isShow=true},initInterface:function(){this._interface=new Interface(this.url,"jsload")},renderList:function(){var lData=this.s_data.info;var type=this.s_data.type;var sNode=$E(scope.musicHash.searchSuggest);var ul=sNode.getElementsByTagName("ul")[0];var len=lData.length;if(len<1){this.hide();return false}var html="";if(!this.template){this.template=new Ui.Template(this.tempHtml)}for(var i=0;i<len;i++){var cData={};if(type=="wpp_song"){cData.name=lData[i].SONGNAME}else{cData.name=lData[i].ALBUMNAME}html+=this.template.evaluate(cData)}ul.innerHTML=html},loadData:function(){var iNode=$E(scope.musicHash.searchInput);var keyCodeNum=Core.Events.getEvent().keyCode;if(keyCodeNum==38||keyCodeNum==40){return false}var txt=iNode.value;var type="wpp_song";var param={query:txt,charset:"utf-8",limit:10,type:type};this._interface.request({GET:param,onSuccess:function(_data){this.s_data=_data;this.renderList();if(_data.info.length>0){this.show()}else{this.hide()}}.bind2(this),onError:function(_data){traceError("接口异常");this.hide()}.bind2(this),onFail:function(){traceError("请求失败");this.hide()}.bind2(this)})}};Editor.Plugins.StoreMusic=Core.Class.create();Editor.Plugins.StoreMusic.prototype={hot_url:"http://music.sina.com.cn/shequ/port/sinablog/blog_ajax_recommendsingers.php",search_url:"http://music.sina.com.cn/shequ/port/sinablog/blog_ajax_search.php",hot_html:"<li><a href=\"#\" onclick=\"scope.musicOperate.search('#{name}','song');return false\">#{name}</a></li>",searchList:"sm_sh_list",listPageId:"sm_li_page",searchButton:"sm_sh_but",errorTipId:"sm_er_tip",initialize:function(){this.renderHtml();this.loadHot();this.initSuggest();Core.Events.addEvent($E(this.searchButton),this.search.bind2(this))},loadSearch:function(_page){var page=_page||1;var param={start:(page-1)*10,limit:10,type:"wpp_song",charset:"utf-8",query:this.searchTxt};if(!this.search_interface){this.search_interface=new Interface(this.search_url,"jsload")}this.search_interface.request({GET:param,onSuccess:function(_data){if(_data.info.length>0){this.setErrorTip()}else{this.setErrorTip(true);return}scope.musicOperate.saveData(_data.info);this.renderSList(_data.type,_data.info);this.selectByCache(_data.type);this.listPage(page,_data.total)}.bind2(this),onError:function(_data){this.setErrorTip(true)}.bind2(this),onFail:function(){}})},setErrorTip:function(isError){var tipEle=$E(this.errorTipId);var listEle=$E(this.searchList);var pageEle=$E(this.listPageId);if(isError){tipEle.style.display="";listEle.style.display="none";pageEle.style.display="none"}else{tipEle.style.display="none";listEle.style.display="";pageEle.style.display=""}},reset:function(){$E(this.searchList).innerHTML="";$E(this.listPageId).innerHTML="";$E(scope.musicHash.searchInput).value=scope.musicOperate.searchTip;$E(scope.musicHash.hotItem).style.display="";scope.musicOperate.selectAlbumKey=false;this.setErrorTip()},search:function(e,type){var ele=Core.Events.getEventTarget();var _type=type||"input";var txt;if(_type=="select"){txt=ele.innerHTML;$E(scope.musicHash.searchInput).value=txt}else{txt=$E(scope.musicHash.searchInput).value;if(txt==scope.musicOperate.searchTip||txt==""){showError("B89009");return false}}this.searchTxt=txt;this.loadSearch()},serchByType:function(value,type){$E(scope.musicHash.searchInput).value=value;this.searchTxt=value;this.loadSearch()},selectByCache:function(type){if(type=="song"){var lst=scope.musicOperate.list.list;for(name in lst){if(lst[name]){var ele=$E(scope.musicHash.song_checkbox+name);if(ele){ele.checked=true}}}}else{var ele=$E(scope.musicHash.album_checkbox+scope.musicOperate.selectAlbumKey);if(ele){ele.checked=true}}},renderSList:function(type,rData){if(!this.song_temp){this.initListTemp()}var len=rData.length,html;if(type=="wpp_song"){html='<li class="title"><div class="muOpt">&nbsp;</div><div class="muPlay">&nbsp;</div> <div class="muName">歌曲名</div><div class="muStarName">歌手名</div> </li>'}else{html='<li class="title"><div class="muOpt">&nbsp;</div><div class="muName">专辑名</div><div class="muStarName">歌手名</div></li>'}var pauseFlag=false;for(var i=0;i<len;i++){var sName=this.replaceName(rData[i].SONGNAME);var aName=this.replaceName(rData[i].ALBUMNAME);if(scope.musicOperate.playNow==rData[i].SONGID){var playIcon="SG_icon SG_icon29";pauseFlag=rData[i].SONGID}else{var playIcon="SG_icon SG_icon27"}var lDate={sId:rData[i].SONGID,at:i+1,sName:sName,rsName:this.replaceHotTxt(scope.musicOperate.shorten(sName)),aId:rData[i].ALBUMID,aName:aName,raName:this.replaceHotTxt(scope.musicOperate.shorten(aName)),sgId:rData[i].SINGERID,sgName:this.replaceName(rData[i].SINGERNAME),playIcon:playIcon};if(type=="wpp_song"){lDate.aId=rData[i].ALBUMID;lDate.aName=this.replaceName(rData[i].ALBUMNAME);html+=this.song_temp.evaluate(lDate)}else{html+=this.album_temp.evaluate(lDate)}}$E(this.searchList).innerHTML=html;if(pauseFlag){$E("sm_play_"+pauseFlag).playing=true}$E(scope.musicHash.hotItem).style.display="none";scope.musicOperate.im.show()},replaceHotTxt:function(name){if(name){return name.replace(new RegExp(this.searchTxt,"i"),'<span class="spe">'+this.searchTxt+"</span>")}},replaceName:function(name){if(name){return name.replace(/['"]?/gi,"")}},listPage:function(pageNum,count){var pageCount=10;var maxPage=Math.ceil(count/pageCount,pageCount);if(maxPage>1){Ui.Pagination.init({pageNode:this.listPageId,nodeClassNamePrefix:"SG",curPage:pageNum,maxPage:maxPage,pageTpl:this.loadSearch.bind2(this),type:1}).show()}else{$E(this.listPageId).innerHTML=""}},loadHot:function(){var param={start:0,limit:16};if(!this.hot_interface){this.hot_interface=new Interface(this.hot_url,"jsload")}this.hot_interface.request({GET:param,onSuccess:function(_data){this.renderHot(_data)}.bind2(this),onError:function(_data){},onFail:function(){}})},renderHot:function(hData){if(!this.hot_template){this.hot_template=new Ui.Template(this.hot_html)}var html="";for(var i=0;i<hData.length;i++){var lData={hId:hData[i].SINGERID,name:hData[i].SINGERNAME};html+=this.hot_template.evaluate(lData)}var hotEle=$E(scope.musicHash.hotItem);var hotUl=hotEle.getElementsByTagName("ul")[0];hotUl.innerHTML=html},initSuggest:function(){new Editor.Plugins.Suggest},renderHtml:function(){var html='<div class="searchCondi" id="'+scope.musicHash.searchItem+'">\r\n					<input id="'+scope.musicHash.searchInput+'" type="text" class="inputMusic" value="'+scope.musicOperate.searchTip+'" maxlength="50">\r\n					<div id="'+scope.musicHash.searchSuggest+'" class="sclist" style="display:none"><ul></ul></div>\r\n					<select style="display:none;" class="select" id="'+scope.musicHash.searchSelect+'"><option selected="selected" value="song">歌曲</option><option value="album">专辑</option></select>\r\n					<a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="#" onclick="return false" id="'+this.searchButton+'"><cite>搜索</cite></a>\r\n				 </div>\r\n				 <ul class="musicList" id="'+this.searchList+'"></ul>\r\n				 <div class="searchNote" id="'+this.errorTipId+'" style="display:none">\r\n				    <ul>\r\n					  <li class="title">抱歉！没有搜索到相关结果</li>\r\n					  <li>您可以尝试以下方式重新搜索：</li>\r\n					  <li>1、检查输入的关键字是否有误</li>\r\n					  <li>2、简化关键字或用其他意思相近的关键字</li>\r\n					</ul>\r\n				</div>\r\n				 <div  id="'+this.listPageId+'" class="SG_page"></div>\r\n				 <div class="searchBottom"  id="'+scope.musicHash.hotItem+'">\r\n				    <p class="title">最热歌手：</p>\r\n					<ul></ul>\r\n				</div>';Core.Dom.addHTML($E(scope.musicHash.store_container),html)},initListTemp:function(){var song_html='<li>\r\n		  <div class="muOpt">\r\n		    <input onclick="scope.musicOperate.select(\'store\',\'#{sId}\',\'#{sName}\',\'song\');" type="checkbox" value="" class="checkbox" id="'+scope.musicHash.song_checkbox+'#{sId}">\r\n		    <em>#{at}.</em>\r\n		  </div>\r\n		  <div class="muPlay">\r\n		  	<img height="15" align="absmiddle" width="15" id="'+scope.musicHash.music_play+'#{sId}" onclick="scope.musicOperate.play(this)" title="音乐播放操作状态" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="#{playIcon}">\r\n		  </div>\r\n		  <div class="muName"><a target="_blank" href="http://music.sina.com.cn/yueku/m.php?id=#{sId}"></a><label for="'+scope.musicHash.song_checkbox+'#{sId}" title="#{sName}">#{rsName}</label></div>\r\n		  <div class="muStarName"><a  href="#" onclick="scope.musicOperate.search(\'#{sgName}\',\'song\');return false">#{sgName}</a></div>\r\n		  <div class="muSpe"><a href="#" onclick="scope.musicOperate.search(\'#{aName}\',\'album\');return false">#{aName}</a></div>\r\n		</li>';var album_html='<li> <div class="muOpt">\r\n		    <input onclick="scope.musicOperate.select(\'store\',\'#{aId}\',\'#{aName}\',\'album\');" type="radio" value="#{aId}" name="album_radio" class="checkbox" id="'+scope.musicHash.album_checkbox+'#{aId}">\r\n		  </div><div class="muSpe"><label for="'+scope.musicHash.album_checkbox+'#{aId}" title="#{aName}">#{raName}</label></div><div class="muStarName"><a  href="#" onclick="scope.musicOperate.search(\'#{sgName}\',\'song\');return false">#{sgName}</a></div></li>';this.song_temp=new Ui.Template(song_html);this.album_temp=new Ui.Template(album_html)}};String.prototype.format=function(){var r=!arguments[0]||typeof arguments[0]=="undefined"?"":arguments[0].toString();var re=/(.*?)({(\d+)(:([0-9a-z]+))?})/gi;var t=this.match(re);if(t){for(var i=0,l=t.length;i<l;i++){t[i]=t[i].replace(re,function(){return RegExp.$1});t[i]=RegExp.$1;switch(typeof arguments[parseInt(RegExp.$3)]){case"undefined":t[i]+=RegExp.$2;break;case"number":t[i]+=isNaN(RegExp.$5)||RegExp.$5==""?arguments[parseInt(RegExp.$3)]:arguments[parseInt(RegExp.$3)].toString(Math.max(Math.min(Math.round(RegExp.$5),36),2));break;default:t[i]+=arguments[parseInt(RegExp.$3)]}}t.push(this.replace(re,""));return t.join("")}return this};Editor.Plugins.InsertToEditor=Core.Class.create();Editor.Plugins.InsertToEditor.prototype={album_url:"http://music.sina.com.cn/shequ/port/sinablog/blog_ajax_getalbuminfo.php",players:[],initialize:function(){this.renderHtml();this.bindEvent();scope.musicOperate.select=this.select.bind2(this)},setPlayers:function(){this.players=[];var imgEles=editor.iframeDocument.getElementsByTagName("img");var len=imgEles.length;for(var i=0;i<len;i++){var songList=imgEles[i].getAttribute("songlist");if(songList){this.players.push(Core.Array.ArrayWithout(songList.split("|"),""))}}},checkPlayers:function(){this.setPlayers();var len=this.players.length;if(len>2){showError("B89005");return false}return true},clearEmpty:function(){this.players=Core.Array.ArrayWithout(this.players,"")},show:function(){$E(scope.musicHash.insert_container).style.display=""},hidden:function(){$E(scope.musicHash.insert_container).style.display="none"},bindEvent:function(){Core.Events.addEvent(scope.musicHash.insertButton,function(){this.insert()}.bind2(this))},select:function(tabType,key,name,type,checkEle){var _type=type||"song";if(tabType=="store"){checkEle=$E(scope.musicHash.song_checkbox+key)}switch(tabType){case"fav":case"store":if(_type=="song"){this.selectSong(key,name,checkEle)}else{this.selectAlbum(key,name)}break;case"web":this.addWebMusic(key);break}},addWebMusic:function(key){scope.musicOperate.list.add(key,key,"web")},selectSong:function(key,name,checkEle){if(checkEle.checked){scope.musicOperate.list.add(key,name,"store")}else{scope.musicOperate.list.del(key)}scope.musicOperate.insertType="song"},selectAlbum:function(key,name){this.setAlbumInfo(key);scope.musicOperate.insertType="album"},setAlbumInfo:function(key){var param={albumid:key};if(!this.albumInterface){this.albumInterface=new Interface(this.album_url,"jsload")}scope.musicOperate.list.clearAlbum();this.albumInterface.request({GET:param,onSuccess:function(_data){scope.musicOperate.albumData[key]=_data;var songList=_data.SONGLIST;var len=songList.length;for(var i=0;i<len;i++){songList[i].SINGERID=_data.SINGERID;songList[i].SINGERNAME=_data.SINGERNAME;scope.musicOperate.songData[songList[i].SONGID]=songList[i];scope.musicOperate.list.add(songList[i].SONGID,songList[i].SONGNAME,"store",true)}scope.musicOperate.selectAlbumKey=key}.bind2(this),onError:function(_data){},onFail:function(){}})},insert:function(){var insertState=$E(scope.musicHash.insertButton).getAttribute("available");if(insertState&&insertState==0){return}scope.musicOperate.noHide=false;scope.musicOperate.matchInsert(function(){});var isToLast=$E(scope.musicHash.appendToLast).checked;if(this.check(isToLast)){if(isToLast&&this.players.length>0){this.insertToLast()}else{this.insertMusic()}if(scope.musicOperate.insertType!="song"){this.insertAlbum()}}if(!scope.musicOperate.selectAlbumKey&&scope.musicOperate.list.len<1&&scope.musicOperate.matchWrap.select.length<1){winDialog.alert($SYSMSG["B89011"])}else{if(!scope.musicOperate.noHide){window.inserMusic.hide()}}},check:function(isToLast){this.setPlayers();var allLen,len=this.players.length;if(isToLast){var songs;if(len>0){songs=this.players[len-1]}else{winDialog.alert($SYSMSG["B89007"],{width:380,icon:"03"});return true}if(!scope.musicOperate.selectAlbumKey&&scope.musicOperate.list.len<1){return false}if(scope.musicOperate.insertType=="song"||!scope.musicOperate.selectAlbumKey){allLen=songs.length+scope.musicOperate.list.len}else{allLen=songs.length+scope.musicOperate.albumData[scope.musicOperate.selectAlbumKey].SONGLIST.length}}else{if(scope.musicOperate.insertType=="song"||!scope.musicOperate.selectAlbumKey){
allLen=scope.musicOperate.list.len}else{allLen=scope.musicOperate.albumData[scope.musicOperate.selectAlbumKey].length}}if(allLen>20){winDialog.alert("抱歉！每个播放器最多可插入 20 首歌曲。<br/>请从已选歌曲中删除 "+(allLen-20)+" 首。",{width:350});scope.musicOperate.noHide=true;return false}if(len>2){showError("B89005");return false}return true},insertAlbum:function(){if(!this.album_temp){this.setAlbumHtml()}if(!scope.musicOperate.selectAlbumKey){return}var albumData=scope.musicOperate.albumData[scope.musicOperate.selectAlbumKey];var html=this.album_temp.evaluate(albumData);var songData=albumData.SONGLIST;var len=songData.length;html+="<ul>";for(var i=0;i<len;i++){if(i>19){break}var s_data={a:i+1,name:songData[i].SONGNAME};html+=this.albumSong_temp.evaluate(s_data)}html+="</ul>";editor.insertHTML(html)},insertToLast:function(){var imgEles=editor.iframeDocument.getElementsByTagName("img");var playerEle,songList;var len=imgEles.length;for(var i=0;i<len;i++){var lst=imgEles[i].getAttribute("songlist");if(lst){songList=lst;playerEle=imgEles[i]}}if($E(scope.musicHash.insertText).checked){winDialog.alert($SYSMSG["B89008"],{width:380,icon:"03"});window.inserMusic.hide()}else{winDialog.alert($SYSMSG["B89013"],{width:380,icon:"03"})}playerEle.setAttribute("songlist",(songList+"|"+scope.musicOperate.list.getAllKey().join("|")).toString())},insertMusic:function(){var html="";var count=scope.musicOperate.list.len;var mid=scope.musicOperate.list.getOneKey();if(count<=0){return}var cis=this.createImageString();html=cis.html;if($E(scope.musicHash.insertText).checked){if(count>1||$E(scope.musicHash.appendToLast).checked){winDialog.alert($SYSMSG["B89008"],{width:380,icon:"03"});window.inserMusic.hide();editor.insertHTML(html,cis.obj)}else{this.createLyricString(mid,function(slyric){if(slyric||slyric==""){editor.insertHTML(html+slyric+"<br/>",cis.obj)}})}}else{editor.insertHTML(html,cis.obj)}},createImageString:function(){var id="tmp_"+ +new Date;var sTpl='<img id="'+id+'" src="http://simg.sinajs.cn/blog7style/images/common/editor/musicplayer.png" playerid="{0}" type="face" songlist="{1}" albums="{2}" autoplay="{3}"/><br/><br/>';var aData=[];var oSel=scope.musicOperate.list.list;var playerid="musicplayer_"+Core.Math.getUniqueId();var autoplay=$E(scope.musicHash.autoButton).checked?1:0;this.setAuto(autoplay);var i=0;for(key in oSel){if(i>19){break}if(oSel[key]){aData.push(oSel[key].key)}i++}return{html:sTpl.format(playerid,aData.join("|"),"",autoplay),obj:{id:id,properites:{playerid:playerid,songlist:aData.join("|"),albums:"",autoplay:autoplay}}}},setAuto:function(auto){var imgEles=editor.iframeDocument.getElementsByTagName("img");var len=imgEles.length;for(var i=0;i<len;i++){var autoPlay=imgEles[i].getAttribute("autoplay");if(autoPlay){imgEles[i].setAttribute("autoplay",auto)}}},createLyricString:function(songid,cbFunc){var Ilyric=new Interface("http://music.sina.com.cn/shequ/port/sinablog/blog_ajax_lyric.php?varname=lyric","jsload");Ilyric.request({GET:{songid:songid},onSuccess:function(oData){cbFunc(oData.replace(/(\[.*\]|)/g,"").replace(/(\r\n|\n|\r)+/g,"<br/>").replace(/^<br\/>/,""))},onError:function(){winDialog.alert("抱歉，获取歌词失败了！");cbFunc()}})},renderHtml:function(){var html='<ul class="musicOptList" id="musicOptList">\r\n			  <li style="display:none;"><input type="checkbox" id="'+scope.musicHash.insertText+'" value="" name=""> <label for="'+scope.musicHash.insertText+'">同时插入歌词</label></li>\r\n			  <li><input type="checkbox" id="'+scope.musicHash.autoButton+'" value="" name="" checked="checked"> <label for="'+scope.musicHash.autoButton+'">本博文音乐自动播放</label></li>\r\n			  <li style="display:none;"><input type="checkbox" id="'+scope.musicHash.appendToLast+'" value="" name=""> <label for="'+scope.musicHash.appendToLast+'">添加至上一个播放器</label></li>\r\n			</ul>\r\n			<p class="CP_w_btns_Mid"><a class="SG_aBtn SG_aBtnB" href="#" id="'+scope.musicHash.insertButton+'" onclick="return false"><cite>插入音乐</cite></a> </p>';Core.Dom.addHTML($E(scope.musicHash.insert_container),html)},setAlbumHtml:function(){var album_html='<table cellspacing="0" cellpadding="0" border="0">\r\n		  <tbody><tr>\r\n		    <td width="100"><a href="#"><img height="80" width="80" src="#{PHOTO}" class="" title="专辑"></a></td>\r\n		    <td valign="top">\r\n			    <p style="padding: 3px 0pt; font-weight: bold; font-size: 14px;">#{ALBUMNAME}</p>\r\n		        <p style="padding: 3px 0pt;">歌手：#{SINGERNAME}</p>\r\n		        <p style="padding: 3px 0pt;">唱片：雷鬼</p>\r\n			</td>\r\n		  </tr>\r\n		  </tbody>\r\n		</table>';var albumSong_html='<li style="padding: 5px 0pt;"><em>#{at}</em>#{name}</li>';this.album_temp=new Ui.Template(album_html);this.albumSong_temp=new Ui.Template(albumSong_html)}};Editor.Plugins.WebMusic=Core.Class.create();Editor.Plugins.WebMusic.prototype={int_id:"m_web_int",tip_id:"m_web_tip",addBnt_id:"m_web_add",int_tip:"请输入音乐地址(http://)，支持MP3格式",initialize:function(){this.renderHtml();this.addEvents();var me=this;scope.musicOperate.resetTip=function(){me.setInputTip.call(me,true);me.setTip.call(me,"A00006")}},addEvents:function(){Core.Events.addEvent($E(this.int_id),this.clearInputTip.bind2(this),"focus");Core.Events.addEvent($E(this.int_id),this.setInputTip.bind2(this),"blur");Core.Events.addEvent($E(this.addBnt_id),this.add.bind2(this))},add:function(){var ele=$E(this.int_id);var value=ele.value;if(this.checkUrl(value)){scope.musicOperate.select("web",value);scope.musicOperate.resetTip()}},clearInputTip:function(){var ele=$E(this.int_id);if(ele.value==this.int_tip){ele.value=""}},setInputTip:function(force){var ele=$E(this.int_id);if(ele.value==""||force==true){ele.value=this.int_tip}},checkUrl:function(value){if(value==this.int_tip){scope.musicOperate.resetTip();return}var value=value.toLowerCase();if(value==this.addBnt_id||value.indexOf("http://")!=0){this.setTip("B79002");editorTabs.showTab("music");return false}if(value.indexOf(".mp3")==-1){this.setTip("B79001");editorTabs.showTab("music");return false}this.setTip("A00006");return true},setTip:function(code){var ele=$E(this.id=this.tip_id);if(code=="A00006"){ele.style.display="none"}else{var liEle=ele.getElementsByTagName("li")[0];ele.style.display="";liEle.style.color="red";liEle.innerHTML=$SYSMSG[code]}},renderHtml:function(){var html='<div class="searchCondi">\r\n				音乐地址：<input type="text"  class="" id="'+this.int_id+'" value="'+this.int_tip+'" size="36" maxlength="255">\r\n				<a class="SG_aBtn SG_aBtnB inputbtn" href="#"><cite id="'+this.addBnt_id+'" onclick="return false">确定</cite></a>\r\n			</div>\r\n			<div class="searchNote"  id="'+this.tip_id+'" style="display:none">\r\n			    <ul>\r\n				  <li class="fb" id="">抱歉！是无效地址，请重新输入，或去<a href="#">新浪乐库</a>中直接搜索。</li>\r\n				</ul>\r\n			</div>';Core.Dom.addHTML($E(scope.musicHash.web_container),html)}};Core.String.shorten=function(str,len,suffix){if(Core.String.byteLength(str)<=len){return str}if(suffix!=""){suffix=suffix||"..."}else{suffix=""}return Core.String.leftB(str,len)+suffix};Editor.Plugins.FavoriteMusic=Core.Class.create();Editor.Plugins.FavoriteMusic.prototype={initialize:function(){this.renderHtml()},IfavMusic:new Interface("http://music.sina.com.cn/shequ/port/sinablog/blog_ajax_useralbums.php?varname=albumlist","jsload"),IfavMusicCache:null,IfavList:new Interface("http://music.sina.com.cn/shequ/port/sinablog/blog_ajax_useralbumsongs.php?varname=songlist","jsload"),IfavListAll:new Interface("http://music.sina.com.cn/shequ/port/sinablog/blog_ajax_userallsongs.php?varname=songlist","jsload"),IfavListCache:{allSong:{}},clearCache:function(){this.IfavMusicCache=null;this.IfavListCache={allSong:{}}},resetFav:function(){if($E(scope.musicHash.insertText)){scope.musicOperate.favSelected={};$E(scope.musicHash.insertText).checked="";$E(scope.musicHash.appendToLast).checked="";$E("favMusic_songList").innerHTML='<li><img src="http://simg.sinajs.cn/blog7style/images/common/loading.gif"> 加载中…</li>'}},favGetList:function(pierceCache){var _this=this;if(this.IfavMusicCache&&!pierceCache){_successFunc(this.IfavMusicCache)}else{this.IfavMusic.request({GET:{uid:scope.$uid},onSuccess:function(oData){_this.IfavMusicCache=oData;_successFunc(oData)},onError:function(){winDialog.alert("抱歉，数据加载异常，请刷新再试。")}})}function _successFunc(oData){if(oData.total==0){$E("favMusic_favList").innerHTML="<li>暂无收藏分类</li>";$E("favMusic_songList").innerHTML="<li>暂无歌曲</li>";return}var str='<li class="current" id="favMusic_list_all"><a href="#" onclick="scope.musicOperate.favShowList();return false">全部音乐</a></li>';for(var n=0,m=oData.albumlist.length;n<m;n++){str+='<li id="favMusic_list_'+oData.albumlist[n].USERALBUMID+'">'+'<a href="#" onclick="scope.musicOperate.favShowList('+oData.albumlist[n].USERALBUMID+');return false" title="'+oData.albumlist[n].NAME+'">'+_fmt(oData.albumlist[n].NAME,10)+"</a></li>"}$E("favMusic_favList").innerHTML=str;scope.musicOperate.favShowList()}function _fmt(str,length){return Core.String.shorten(str,length||20)}},favShowList:function(uaid,page,pierceCache){$E("favMusic_songList").innerHTML='<li class="title">\r\n					<div class="muOpt">&nbsp;</div>\r\n					<div class="muName">歌曲名</div>\r\n					<div class="muStarName">歌手名</div>\r\n				</li>\r\n			    <li>\r\n        			<img src="http://simg.sinajs.cn/blog7style/images/common/loading.gif"> 加载中…\r\n       			</li>';var _this=this;if(uaid){if(this.IfavListCache["c_"+uaid]&&!pierceCache){_interfaceSuccess(_this.IfavListCache["c_"+uaid])}else{this.IfavList.request({GET:{uid:scope.$uid,uaid:uaid},onSuccess:function(oData){_this.IfavListCache["c_"+uaid]=oData;_interfaceSuccess(oData)},onError:function(){winDialog.alert("抱歉，数据加载异常，请刷新再试。")}})}}else{page=page||1;if(this.IfavListCache["allSong_"+page]&&!pierceCache){_interfaceSuccess(_this.IfavListCache["allSong_"+page])}else{this.IfavListAll.request({GET:{uid:scope.$uid,start:page?(page-1)*scope.musicOperate.favPagesize:0},onSuccess:function(oData){_this.IfavListCache["allSong_"+page]=oData;_interfaceSuccess(oData)},onError:function(){winDialog.alert("抱歉，数据加载异常，请刷新再试。")}})}}function _interfaceSuccess(oData){_updateHash(oData.songlist);scope.musicOperate.favCount=oData.total;_renderList(oData,page);scope.musicOperate.saveData(oData.songlist)}function _renderList(oData,page){if(!oData.songlist||!oData.songlist.length){$E("favMusic_songList").innerHTML="<li>该分类暂无歌曲</li>";$E("favMusic_pagination").innerHTML="";_refreshFavList(uaid,page);return}var page=scope.musicOperate.favPage=page||1;var pagesize=scope.musicOperate.favPagesize||10;var str='<li class="title">\r\n			   <div class="muOpt">&nbsp;</div>\r\n			   <div class="muName">歌曲名</div>\r\n			   <div class="muStarName">歌手名</div>\r\n			</li>';var count=0;var mark="";var nstart=(page-1)*pagesize;var nend=oData.songlist.length;var bias=0;if(!uaid){nstart=0;bias=(page-1)*scope.musicOperate.favPagesize}for(var n=nstart,m=nend;n<m&&count<pagesize;n++){count++;if(scope.musicOperate.list.list[oData.songlist[n].SONGID]){mark='checked = "checked"'}else{mark=""}str+='<li>\r\n					<div class="muOpt">\r\n					<input id="cb_fav_'+oData.songlist[n].SONGID+'" '+mark+" onclick=\"scope.musicOperate.select('fav','"+oData.songlist[n].SONGID+"','"+_replace(oData.songlist[n].SONGNAME)+'\',\'song\',this)" name="" type="checkbox" class="checkbox" value="" /><em>'+(n+1+bias)+'.</em></div>\r\n					<div class="muName" title="'+(oData.songlist[n].SONGNAME||"未知")+'"><label for="cb_fav_'+oData.songlist[n].SONGID+'">'+_fmt(oData.songlist[n].SONGNAME||"未知")+'</label></div>\r\n					<div class="muStarName"><label for="cb_fav_'+oData.songlist[n].SONGID+'" title="'+oData.songlist[n].SINGERNAME+'">'+_fmt(oData.songlist[n].SINGERNAME||"未知",20)+"</label></div>\r\n				</li>"}$E("favMusic_songList").innerHTML=str;_refreshFavList(uaid,page);_renderPagination()}function _replace(str){str=str.replace(/\'/g,"\\'").replace(/\"/g,'\\"');return str}function _refreshFavList(uaid,page){var pNode=$E("favMusic_favList");var list=$T(pNode,"li");for(var n=0,m=list.length;n<m;n++){list[n].className=""}if(uaid){$E("favMusic_list_"+uaid).className="current"}else{$E("favMusic_list_all").className="current"}}function _renderPagination(){var maxPage=Math.ceil(scope.musicOperate.favCount/scope.musicOperate.favPagesize);var curPage=scope.musicOperate.favPage=scope.musicOperate.favPage||1;if(maxPage<=1){$E("favMusic_pagination").innerHTML=""}else{Ui.Pagination.init({pageNode:"favMusic_pagination",nodeClassNamePrefix:"SG",curPage:curPage,maxPage:maxPage,showTotal:true,pageTpl:function(page){scope.musicOperate.favShowList(uaid,page)}}).show()}}function _fmt(str,length){return Core.String.shorten(str,length||20)}function _updateHash(arrData){var hash=scope.musicOperate.favHash;for(var n=0,m=arrData.length;n<m;n++){hash[arrData[n].SONGID]={id:arrData[n].SONGID,name:arrData[n].SONGNAME}}}},favMarkSong:function(songid,node){if(node.checked){if(_getCount()>=scope.musicOperate.favMaxCount){winDialog.alert("抱歉！每个播放器最多可插入"+scope.musicOperate.favMaxCount+"首歌曲。",{width:350});node.checked="";return}scope.musicOperate.favSelected["s_"+songid]={id:scope.musicOperate.favHash[songid].id,name:scope.musicOperate.favHash[songid].name};scope.musicOperate.insertType="song"}else{delete scope.musicOperate.favSelected["s_"+songid]}function _getCount(){var oSel=scope.musicOperate.favSelected;var count=0;for(key in oSel){count++}return count}},renderHtml:function(){var html='<div class="MusMenuList">\r\n			  <ul id="favMusic_favList">\r\n				<li>\r\n        			<img src="http://simg.sinajs.cn/blog7style/images/common/loading.gif"> 加载中…\r\n       			</li>\r\n			  </ul>\r\n			</div>\r\n			<ul id="favMusic_songList" class="musicList musicList390">\r\n			    <li class="title">\r\n				   <div class="muOpt">&nbsp;</div>\r\n				   <div class="muName">歌曲名</div>\r\n				   <div class="muStarName">歌手名</div>\r\n				</li>\r\n			    <li>\r\n        			<img src="http://simg.sinajs.cn/blog7style/images/common/loading.gif"> 加载中…\r\n       			</li>\r\n			</ul>\r\n		    <div id="favMusic_pagination" class="SG_page">\r\n		    </div>';Core.Dom.addHTML($E(scope.musicHash.favorite_container),html)}};Editor.Plugins.MatchMusic=Core.Class.create();Editor.Plugins.MatchMusic.prototype={initialize:function(){this.renderHtml();this.id=Core.Math.getUniqueId();this.initEvent();this.initInterface()},all_data:[],select:[],initInterface:function(){this._interface=new Interface("http://control.blog.sina.com.cn/admin/article/musicmatchtag.php","ajax")},initEvent:function(){scope.musicOperate.matchInsert=this.replace.bind2(this);scope.musicOperate.matchSelectAll=this.selectAll.bind2(this)},replace:function(func){var select_data=[];var len=this.all_data.length;var content=editor.getContentHtml();var matchFlag=false;for(var i=0;i<len;i++){for(var n=0,m=this.all_data[i]["list"].length;n<m;n++){if(Core.Array.findit(this.select,this.all_data[i]["list"][n].id)!=-1){matchFlag=true;var reg=new RegExp("<a.*?>(.*?)</a>","gi");var me=this;content=content.replace(reg,function(matched){var reg2=new RegExp("<img.*?>(.*)</a>","gi");var result=reg2.exec(matched);if(result){if(result[1]==me.all_data[i].name){return me.all_data[i].name}}return matched});replaceContent(this.all_data[i]["list"][n])}}}editor.iframeDocument.body.innerHTML="";editor.insertHTML(content);var content="";if(typeof func=="function"&&select_data.length>0){func()}function replaceContent(r_data){var u_str;if(r_data.type=="s"){u_str='<a target="_blank" href="http://music.sina.com.cn/yueku/s/'+r_data.id+'.html">'}else{u_str='<a target="w_yuekuplayer" href="http://music.sina.com.cn/yueku/m/'+r_data.id+'.html"><img align="absmiddle" src="http://simg.sinajs.cn/blog7style/images/common/editor/play.gif" title="点击播放"/>'}var str;if(r_data.name=="*"){str="(<[^>]+>)?(\\"+r_data.name+")"}else{str="(<[^>]+>)?("+r_data.name+")"}var reg=new RegExp(str,"gi");var x=1;try{var arrLen=content.match(reg).length}catch(e){return false}content=content.replace(reg,function(a,b,c){if(arrLen==1||arrLen==x){x++;if(!b){b=""}return b+u_str+c+"</a>"}else{x++;return a}})}},loadData:function(){var param={c:"utf-8"};var text=encodeURIComponent(editor.getContentText()).replace(/%c2%a0/gi,"%20");if(text!=""){param.b=text;param.num=500}this._interface.request({POST:param,onSuccess:function(_data){this.all_data=[];this.initList(this.format(_data));if(this.format(_data).length==0){$E("im_lists").innerHTML="<li>"+$SYSMSG["B89012"]+"</li>";$E("mol1").disabled="disabled"}else{$E("mol1").disabled=""}}.bind2(this),onError:function(_data){if(_data.code=="B89001"||_data.code=="B89004"){_data.code="B89012"}$E("im_lists").innerHTML="<li>"+$SYSMSG[_data.code]+"</li>";$E("mol1").disabled="disabled"}.bind2(this),onFail:function(_data){trace("onFail")}})},format:function(data){for(var n=0;n<data.length;n++){if(data[n].id=="s"||parseInt(data[n].name)<100){data.splice(n,1);n--}}var tmp={};for(var n=0;n<data.length;n++){var name=data[n].name;if(!tmp[name]){tmp[name]={name:name,list:[{singer:data[n].auth,id:data[n].id,name:data[n].name}]}}else{tmp[name]["list"].push({singer:data[n].auth,id:data[n].id,name:data[n].name})}}var arr=[];for(var key in tmp){arr.push(tmp[key])}return arr},initList:function(_data,page){var list_data=[];var allsel=true;var temp='<li>\r\n					   <div class="muOpt"><input class="checkbox" #{checked} onclick="Editor.Plugins.MatchMusic.prototype.selectItem(\'#{id}\')" type="checkbox" id="mb_#{id}" /><em>#{index}.</em></div>\r\n					   <div class="muPlay"><img height="15" width="15" align="absmiddle" class="#{playIcon}" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" title="音乐播放操作状态" onclick="scope.musicOperate.play(this)" id="sm_play_#{id}"></div>\r\n					   <div class="muName"><a href="javascript:void 0"><label for="mb_#{id}">#{name}</label></a></div>\r\n					   <div class="muStarName" style="overflow:visible;"><span style="float:left;color:#666;padding-right:8px">#{auth}</span><a href="javascript:void 0" #{au} #{unique}>#{more}</a>\r\n						<div class="muStarLink">\r\n						   #{singerlist}\r\n						 </div>\r\n					   </div>\r\n					</li>';var len=list_data.length;var html='<li class="title">\r\n						<div class="muOpt">&nbsp;</div>\r\n						<div class="muPlay"><img height="15" width="15" align="absmiddle" class="SG_icon SG_icon27" src="http://simg.sinajs.cn/blog7style/images/common/sg_icon.png" style="visibility:hidden"></div>\r\n						<div class="muName">歌曲名</div>\r\n						<div class="muStarName">歌手名</div>\r\n					</li>';var singerTpl='<ul id="{0}" class="muStarNameL" style="display:none;">{1}</ul>';var singerLiTpl='<li {2}><a musicid="{0}" href="javascript:void 0" onclick="scope.musicOperate.matchChangeSinger(this)">{1}</a></li>';var pagesize=10;var page=page||1;var start=(page-1)*pagesize;var end=Math.min(start+pagesize,_data.length);var sel=scope.musicOperate.matchWrap.select||this.select;var bindArr=[];var pauseFlag=false;for(var i=start;i<end;i++){var index=0;for(var j=0,k=_data[i]["list"].length;j<k;j++){var tmp=_data[i]["list"][j].id;if(Core.Array.findit(sel,tmp)>-1||scope.musicOperate.playNow==tmp){index=j}}var unique=parseInt(Math.random()*1e4)+ +new Date;bindArr.push(unique);list_data[i]={id:_data[i]["list"][index].id,index:i+1};if(_data[i].type=="i"){list_data[i].name='<img class="SG_icon SG_icon28" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="" align="absmiddle" />'+_data[i].name}else{list_data[i].name=_data[i].name;list_data[i].auth=_data[i]["list"][index].singer}if(Core.Array.findit(sel,_data[i]["list"][index].id)>-1){list_data[i].checked='checked="checked"'}else{list_data[i].checked="";allsel=false}if(Core.Array.findit(this.all_data,_data[i])<0){this.all_data.push(_data[i])}if(_data[i]["list"].length>1){var liTpl="";for(var n=0,m=_data[i]["list"].length;n<m;n++){liTpl+=singerLiTpl.format(_data[i]["list"][n].id,_data[i]["list"][n].singer,n==m-1?'style="border-bottom:none"':"")}list_data[i].singerlist=singerTpl.format("mu_"+unique,liTpl);list_data[i].unique='unique="'+unique+'"';list_data[i].au='id="au_'+unique+'"';list_data[i].more=" »"}else{list_data[i].singerlist="";list_data[i].unique="";list_data[i].au="";list_data[i].more=""}if(scope.musicOperate.playNow==_data[i]["list"][index].id){list_data[i].playIcon="SG_icon SG_icon29";pauseFlag=list_data[i].id}else{list_data[i].playIcon="SG_icon SG_icon27"}html+=new Ui.Template(temp).evaluate(list_data[i]);$E("mol1").checked=allsel}$E("im_lists").innerHTML=html;if(pauseFlag){$E("sm_play_"+pauseFlag).playing=true}scope.musicOperate.matchUniqueArr=bindArr;for(var n=0,m=bindArr.length;n<m;n++){try{$E("au_"+bindArr[n]).onclick=function(){var me=this;me.blur();setTimeout(function(){scope.musicOperate.matchListShow.call(me)},0)}}catch(e){}}$E("im_lists").parentNode.parentNode.onclick=function(){scope.musicOperate.matchListHideAll()};var func=arguments.callee;var me=this;Ui.Pagination.init({pageNode:"matchMusic_pagination",nodeClassNamePrefix:"SG",curPage:page,maxPage:Math.ceil(_data.length/pagesize),showTotal:true,pageTpl:function(page){func.call(me,_data,page)}}).show();scope.musicOperate.matchWrap=this},selectItem:function(m_id){var ele=$E("mb_"+m_id);var sel=scope.musicOperate.matchWrap.select;if(ele.checked){sel.push(m_id);if(checkAllSel()){$E("mol1").checked=true}}else{sel=Core.Array.ArrayWithout(sel,m_id);$E("mol1").checked=false}scope.musicOperate.matchWrap.select=sel;function checkAllSel(){var list=$T($E("im_lists"),"input");for(var n=0,m=list.length;n<m;n++){if(!list[n].checked){return false}}return true}},selectAll:function(){var b=$E("mol1").checked;var list=$T($E("im_lists"),"input");for(var n=0,m=list.length;n<m;n++){if(list[n].checked!=b){list[n].click()}}},show:function(){if(scope.musicOperate.matchCache)return;$E("im_lists").innerHTML=this.titleHtml+'<li><img src="http://simg.sinajs.cn/blog7style/images/common/loading.gif"> 加载中…</li>';$E("matchMusic_pagination").innerHTML="";this.all_data=[];this.select=[];this.loadData();scope.musicOperate.matchCache=true},titleHtml:'<li class="title">\r\n					<div class="muOpt">&nbsp;</div>\r\n					<div class="muName">歌曲名</div>\r\n					<div class="muStarName">歌手名</div>\r\n				</li>',renderHtml:function(){var html='<ul id="im_lists" class="musicList">\r\n				</ul>\r\n				<div id="matchMusic_pagination" class="SG_page">\r\n				</div>\r\n				<ul class="musicOptList">\r\n				  <li><input name="" onclick="scope.musicOperate.matchSelectAll();" type="checkbox" value="" id="mol1" /> <label for="mol1">全选/全不选</label></li>\r\n				</ul>';Core.Dom.addHTML($E(scope.musicHash.match_container),html)}};scope.musicOperate={im:null,sm:null,searchTip:"输入歌曲关键字",tabType:"store",storeList:{},insertType:"song",select:function(){},favGetList:null,favShowList:null,favPage:1,favCount:1,favPagesize:10,favSelected:{},favMaxCount:20,favHash:{},resetTip:function(){},matchCache:null,matchShow:null,matchInsert:function(){},matchWrap:{select:[]},matchUniqueArr:[],matchListHide:function(e){var e=window.event||e;var s=e.toElement||e.relatedTarget;if(!s)return;if(window.$IE){if(!this.contains(s)){this.style.display="none"}}else{var res=this.compareDocumentPosition(s);if(!(res==20||res==0)){this.style.display="none"}}},matchListShow:function(){var uni=this.getAttribute("unique");scope.musicOperate.matchListHideAll();$E("mu_"+uni).style.display="block"},matchListHideAll:function(){var arr=scope.musicOperate.matchUniqueArr;for(var n=0,m=arr.length;n<m;n++){try{$E("mu_"+arr[n]).style.display="none"}catch(e){}}},matchChangeSinger:function(me){var musicid=me.getAttribute("musicid");var singerNode=$T(me.parentNode.parentNode.parentNode.parentNode,"span")[0];var labelNode=$T(singerNode.parentNode.parentNode,"label")[0];var playNode=$T(singerNode.parentNode.parentNode,"img")[0];var inputNode=$T(singerNode.parentNode.parentNode,"input")[0];var oldid=inputNode.id.replace("mb_","");singerNode.innerHTML=me.innerHTML;labelNode.setAttribute("for","mb_"+musicid);playNode.setAttribute("id","sm_play_"+musicid);playNode.playing=false;inputNode.setAttribute("id","mb_"+musicid);inputNode.onclick=function(){var id=musicid;return function(){Editor.Plugins.MatchMusic.prototype.selectItem(musicid)}}();var loc=Core.Array.findit(scope.musicOperate.matchWrap.select,oldid);if(loc>-1){scope.musicOperate.matchWrap.select.splice(loc,1,musicid)}},matchClearCache:function(){scope.musicOperate.matchCache=null},songData:{},saveData:function(data){var _data=data;var len=_data.length;for(var i=0;i<len;i++){if(_data[i].SONGID){if(this.songData[_data[i].SONGID]){continue}}this.songData[_data[i].SONGID]=_data[i]}},playList:{},playNow:null,play:function(ele){var _array=ele.id.split("_");var key=_array[_array.length-1];if(ele.playing){scope.musicOperate.stop();return}if(scope.musicOperate.playNow){scope.musicOperate.stop()}Editor.Plugins.flashUtils.insertSong([key]);ele.className="SG_icon SG_icon29";ele.playing="yes";scope.musicOperate.playNow=key},stop:function(ele){Editor.Plugins.flashUtils.stopSong();var wrap=$E("mm_st_con").parentNode;var playIcons=[];var tmp=$T(wrap,"img");for(var n=0,m=tmp.length;n<m;n++){if(tmp[n].id.indexOf("sm_play_")>-1){playIcons.push(tmp[n])}}for(var n=0,m=playIcons.length;n<m;n++){playIcons[n].playing=false;playIcons[n].className="SG_icon SG_icon27"}scope.musicOperate.playNow=null},search:function(value,type){var _type=type||"song";scope.musicOperate.sm.serchByType(value,_type)},albumData:{},shorten:function(name,_len){var len=_len||20;return Core.String.shorten(name,len)}};Editor.Plugins.SelectList=Core.Class.create();Editor.Plugins.SelectList.prototype={container_id:"",item_id:"mslItem_",item_del_id:"mslItemDel_",template:{},isShow:false,list:{},max:20,len:0,initialize:function(container_id){this.container_id=container_id;this.initTemplate()},show:function(){if(this.isShow){return}$E(this.container_id).style.display="";this.isShow=true},hidden:function(){if(this.isShow){$E(this.container_id).style.display="none";this.isShow=false}},reset:function(){var container=$E(this.container_id);this.hidden();container.getElementsByTagName("ul")[0].innerHTML="";this.list={};this.len=0},clearAlbum:function(){for(key in this.list){if(this.list[key].isAlbum){this.del(key)}}},add:function(key,name,type,_isAlbum){var isAlbum=_isAlbum||false;var container=$E(this.container_id);if(this.list[key]){return}this.list[key]={key:key,name:scope.musicOperate.shorten(name),at:this.len+1,type:type,isAlbum:isAlbum};var s_data=scope.musicOperate.songData[key];if(type!="web"&&s_data){this.list[key].sgId=s_data.SINGERID;this.list[key].sgName=s_data.SINGERNAME}var ul=container.getElementsByTagName("ul")[0];Core.Dom.addHTML(ul,this.template.evaluate(this.list[key]));ul.scrollTop=ul.scrollHeight;Core.Events.addEvent($E(this.item_del_id+key),function(){this.del(key)}.bind2(this));this.len++;this.show()},del:function(key,backFunc){scope.musicOperate.insertType="song";this.list[key]=false;Core.Dom.removeNode($E(this.item_id+key));var favBox=$E(scope.musicHash.fav_song_checkbox+key);var storeBox=$E(scope.musicHash.song_checkbox+key);if(favBox){favBox.checked=false}if(storeBox){storeBox.checked=false}this.len--},getAllKey:function(){var array=[];for(key in this.list){array.push(key)}return array},getOneKey:function(){var i=0;for(key in this.list){i++;break}if(i<1){return false}return this.list[key].key},initTemplate:function(){var html='<li id="'+this.item_id+'#{key}"><div class="muOpt"></div><div class="muName">#{name}</div><div class="muStarName">#{sgName}</div><div class="muDel"><a title="删除" class="CP_w_shut" id="'+this.item_del_id+'#{key}" href="#" onclick="return false">删除</a></div></li>';this.template=new Ui.Template(html)}};Editor.Plugins.flashUtils=function(){var tobj;var obj;var mpwindw;var createObj=function(){if(typeof obj!=="undefined"){clearInterval(tobj);return true}else{obj=Editor.Plugins.flashUtils.getFlashObj("musicUtils_blog");return false}};return{writeFlash:function(){var flashArgs="_mpwLc";var musicStr="";musicStr+='<div id="musicPlayer" style="display:block; z-index:1024; padding:0px; margin:0px; width:1px; height:1px;bottom:0px; left:0px;overflow:hidden;position:fixed;*position:absolute;">';musicStr+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0" width="100%" height="100%" id="musicUtils_blog" align="middle">';musicStr+='<param name="allowScriptAccess" value="always" />';musicStr+='<param name="wmode" value="window" />';musicStr+='<param name="movie" value="http://music.sina.com.cn/yueku/js/mwp/musicUtils.swf" />';musicStr+='<param name="quality" value="high" />';musicStr+='<param name="bgcolor" value="#FFFFFF" />';musicStr+='<param name="FlashVars" value="lcClient='+flashArgs+'" />';musicStr+='<embed src="http://music.sina.com.cn/yueku/js/mwp/musicUtils.swf"  FlashVars="lcClient='+flashArgs+'" quality="high" bgcolor="#FFFFFF"  height="100%" width="100%" wmode="window" name="musicUtils_blog" align="middle" allowScriptAccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" />';musicStr+="</object>";musicStr+="</div>";Core.Dom.addHTML(document.body,musicStr)},getFlashObj:function(flash_id){if(navigator.appName.indexOf("Microsoft")!=-1){return window[flash_id]}else{return document[flash_id]}},setPlayMode:function(num){obj.setPlayMode(num)},insertSong:function(ary){obj.insertSong(ary)},playSong:function(){obj.playSong()},pauseSong:function(){obj.pauseSong()},stopSong:function(){obj.stopSong()},setVolume:function(num){obj.setVolume(num)},seekSong:function(num){obj.seekSong(num)},addListChangeListener:function(str){obj.addListChangeListener(str)},delListChangeListener:function(){obj.delListChangeListener()},addStartListener:function(str){obj.addStartListener(str)},delStartListener:function(){obj.delStartListener()},addProgressListener:function(str){obj.addProgressListener(str)},delProgressListener:function(){obj.delProgressListener()},addFinishListener:function(str){obj.addFinishListener(str)},delFinishListener:function(){obj.delFinishListener()},nextSong:function(){obj.nextSong()},preveSong:function(str){obj.preveSong()},getCurrentSong:function(){return obj.getCurrentSong()},getPlayList:function(){return obj.getPlayList()},setCookie:function(name,value,time){obj.setCookie(name,value,time)},getCookie:function(name){return obj.getCookie(name)},playSongsToMpw:function(ary,flag){if(this.checkIpad()){var str="";var url="http://music.sina.com.cn/yueku/ipad.php";var aryLength=ary.length;for(i=0;i<aryLength;i++){str+=ary[i]+","}str=str.substring(0,str.length-1);var tempHtml;tempHtml='<FORM id="tempform" method="get" target="ipad" action="http://music.sina.com.cn/yueku/ipad.php" style="display:none;">';tempHtml+='<input type="hidden" name="songid" value="'+str+'"/>';tempHtml+='<input type="submit" value="提交"/>';tempHtml+="</form>";var oDiv=document.createElement("DIV");document.body.appendChild(oDiv);oDiv.innerHTML=tempHtml;var frm=document.getElementById("tempform");frm.submit();oDiv.removeChild(frm)}else{obj.playSongsToMpw(ary,flag)}if(Editor.Plugins.flashUtils.mpwindw){Editor.Plugins.flashUtils.mpwindw.focus()}},playRecSongToMpw:function(songid,sinaId,recId,flag){obj.playRecSongToMpw(songid,sinaId,recId,flag);if(Editor.Plugins.flashUtils.mpwindw){Editor.Plugins.flashUtils.mpwindw.focus()}},playAlbumToMpw:function(str,flag){obj.playAlbumToMpw(str,flag);if(Editor.Plugins.flashUtils.mpwindw){Editor.Plugins.flashUtils.mpwindw.focus()}},playWeiboSongsToMpw:function(url,sinaid,sinanick,content,flag){obj.playWeiboSongsToMpw(url,sinaid,sinanick,content,flag);if(Editor.Plugins.flashUtils.mpwindw){Editor.Plugins.flashUtils.mpwindw.focus()}},openMpw:function(str){var sw=screen.availWidth;var sh=screen.availHeight;var w=629,h=595;var wleft=sw>w?(sw-w)/2:0;var wtop=sh>h?(sh-h)/2:0;Editor.Plugins.flashUtils.mpwindw=window.open(str,"w_yuekuplayer","width=629,height=595,top="+wtop+",left="+wleft+",toolbar=no,menubar=no,scrollbars=yes,resizable=no,location=no,status=no");if(Editor.Plugins.flashUtils.mpwindw){Editor.Plugins.flashUtils.mpwindw.focus()}},checkIpad:function(){
var isiPad=navigator.userAgent.match(/iPad/i)!=null;return false},init:function(){this.writeFlash();createObj();tobj=setInterval(createObj,10)}}}();Editor.Plugins.MusicMain=Core.Class.create();Editor.Plugins.MusicMain.prototype={initialize:function(){this.initDialog();this.initTab();scope.musicOperate.sm=new Editor.Plugins.StoreMusic;scope.musicOperate.im=new Editor.Plugins.InsertToEditor;scope.musicOperate.list=new Editor.Plugins.SelectList(scope.musicHash.list_container);var webMusic=new Editor.Plugins.WebMusic;var favoriteMusic=new Editor.Plugins.FavoriteMusic;scope.musicOperate.favGetList=function(){favoriteMusic.favGetList.apply(favoriteMusic,arguments)};scope.musicOperate.favShowList=function(){favoriteMusic.favShowList.apply(favoriteMusic,arguments)};scope.musicOperate.favReset=function(){favoriteMusic.resetFav.apply(favoriteMusic,arguments)};scope.musicOperate.favClearCache=function(){favoriteMusic.clearCache.apply(favoriteMusic,arguments)};scope.musicOperate.favMarkSong=favoriteMusic.favMarkSong;scope.musicOperate.favInsert=favoriteMusic.insert;var matchMusic=new Editor.Plugins.MatchMusic;scope.musicOperate.matchShow=function(){matchMusic.show.apply(matchMusic,arguments)};scope.musicOperate.showStore=function(){var me=window.inserMusic;me.tabManage.swapTags(me.storeTab)};Editor.Plugins.flashUtils.init()},initDialog:function(){var tpl=['<table id="#{entity}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}"></strong>','<cite><a title="关闭" class="CP_w_shut" id="#{btnClose}" href="javascript:;" onclick="return false">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span/></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}">',"</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join("");this.dialog=winDialog.createCustomsDialog({tpl:tpl,title:"插入音乐",content:this.getContainerHtml(),renderer:Ui.SimpleRenderer,width:600},"music");this.dialog.setAreaLocked(true).addEventListener("beforeShow",function(){this.setMiddle()});Core.Events.addEvent(this.dialog.nodes.btnClose,function(){if(scope.musicOperate.playNow){scope.musicOperate.stop()}},"click")},show:function(){if(scope.musicOperate.im.checkPlayers()){this.resetAll();this.tabManage.swapTags(this.storeTab);this.dialog.show()}},resetAll:function(){scope.musicOperate.favReset();scope.musicOperate.sm.reset();scope.musicOperate.list.reset();scope.musicOperate.favClearCache();scope.musicOperate.matchClearCache()},hide:function(){this.dialog.hidden();if(scope.musicOperate.playNow){scope.musicOperate.stop()}},initTab:function(){this.tabManage=new Tabs($E(scope.musicHash.tab_container),{});this.storeTab=new Tab("<div><em>微音乐</em></div>",{isFocus:true,className:"cur"});this.favoriteTab=new Tab("<div><em>我的音乐收藏</em></div>",{isFocus:false,className:"cur"});this.webTab=new Tab("<div><em>网络链接</em></div>",{isFocus:false,className:"cur"});this.storeTab.addOnAbort(Core.Function.bind3(this.swapTab,this,[scope.musicHash.store_container,"hidden"]));this.favoriteTab.addOnAbort(Core.Function.bind3(this.swapTab,this,[scope.musicHash.favorite_container,"hidden"]));this.webTab.addOnAbort(Core.Function.bind3(this.swapTab,this,[scope.musicHash.web_container,"hidden"]));this.storeTab.addOnFocus(Core.Function.bind3(this.swapTab,this,[scope.musicHash.store_container]));this.favoriteTab.addOnFocus(Core.Function.bind3(this.swapTab,this,[scope.musicHash.favorite_container]));this.webTab.addOnFocus(Core.Function.bind3(this.swapTab,this,[scope.musicHash.web_container]));this.tabManage.add(this.storeTab);this.tabManage.add(this.favoriteTab);this.tabManage.add(this.webTab)},swapTab:function(tabContentId,type){scope.musicOperate.matchMode=false;if(type&&type=="hidden"){$E(tabContentId).style.display="none"}else{$E(tabContentId).style.display="";if(tabContentId!=scope.musicHash.store_container){scope.musicOperate.im.show()}if(tabContentId==scope.musicHash.favorite_container){scope.musicOperate.favGetList()}if(tabContentId==scope.musicHash.web_container){scope.musicOperate.resetTip()}if(tabContentId==scope.musicHash.match_container){scope.musicOperate.matchMode=true;$E("musicOptList").style.display="none";$E("mm_list_con").style.display="none";scope.musicOperate.matchShow()}else{$E("musicOptList").style.display="";$E("mm_list_con").style.display=""}this.swapInsertType(tabContentId)}},swapInsertType:function(tabContentId){var btn="<cite>插入音乐</cite>";var linkhtml='<p id="updateLink" class="CP_w_btns_Mid" style="margin: 5px;"><a target="_blank" href="http://blog.sina.com.cn/s/blog_4b0f52990102dzu6.html">产品服务更新升级中，暂停使用</a></p>';var disabledBtn='<cite>插入音乐</cite><a style="margin-left:15px;" onclick="window.open(\'http://blog.sina.com.cn/s/blog_4b0f52990102dzu6.html\')" target="_blank" href="javascript:void(0);">产品服务更新升级中，暂停使用</a>';switch(tabContentId){case scope.musicHash.store_container:scope.musicOperate.tabType="store";$E(scope.musicHash.insertButton).className="SG_aBtn SG_aBtnB";$E(scope.musicHash.insertButton).setAttribute("available","1");if($E("updateLink")){Core.Dom.removeNode($E("updateLink"))}break;case scope.musicHash.favorite_container:scope.musicOperate.tabType="favorite";$E(scope.musicHash.insertButton).className="SG_aBtn SG_aBtnH";$E(scope.musicHash.insertButton).setAttribute("available","0");Core.Dom.insertHTML($E(scope.musicHash.insert_container),linkhtml,"BeforeEnd");break;case scope.musicHash.web_container:scope.musicOperate.tabType="web";$E(scope.musicHash.insertButton).className="SG_aBtn SG_aBtnB";$E(scope.musicHash.insertButton).setAttribute("available","1");if($E("updateLink")){Core.Dom.removeNode($E("updateLink"))}break;case scope.musicHash.match_container:scope.musicOperate.tabType="match";break}},getContainerHtml:function(){var html='<div class="CP_layercon7 editMusic">\r\n			  <div class="CP_w_tag">\r\n			    <div class="title">音乐来源：</div>\r\n			    <div id="'+scope.musicHash.tab_container+'">\r\n			    </div>\r\n			  </div>\r\n			  <div id="'+scope.musicHash.store_container+'"></div>\r\n			  <div id="'+scope.musicHash.favorite_container+'" style="display:none"></div>\r\n			  <div id="'+scope.musicHash.web_container+'" style="display:none"></div>\r\n			  <div id="'+scope.musicHash.match_container+'" style="display:none"></div>\r\n			   <div id="'+scope.musicHash.list_container+'" class="alreadyMus"><h3>已选歌曲</h3><ul></ul></div>\r\n			  <div id="'+scope.musicHash.insert_container+'"></div>\r\n			</div>';return html}};Sina.pkg("Utils.Form");Utils.Form.limitMaxLen=function(oTextNode,nMaxLen){var nValue;var keyup=function(){nValue=oTextNode.value;var strLen=Core.String.byteLength(nValue);if(strLen>nMaxLen){oTextNode.value=Core.String.leftB(nValue,nMaxLen)}};Core.Events.addEvent(oTextNode,Core.Function.bind3(keyup,oTextNode),"keyup");Core.Events.addEvent(oTextNode,Core.Function.bind3(keyup,oTextNode),"blur");Core.Events.addEvent(oTextNode,Core.Function.bind3(keyup,oTextNode),"focus")};Core.String.StringBuffer=function(){this.buffer=[]};Core.String.StringBuffer.prototype.append=function(str){this.buffer.push(str);return this};Core.String.StringBuffer.prototype.toString=function(){return this.buffer.join("")};var voteDom={build:"  "+'<div class="state1" id="newStatus">'+'<div class="voteBox1">'+'<table border="0" cellspacing="0" cellpadding="0">'+"<tr>"+"<th><span>投票主题：</span></th>"+'<td><input type="hidden" id="voteId" name="voteId" value="" /><input type="hidden" name="blogVote" value="yes" /> <input type="hidden" name="voteType" id="voteType" value="1" />'+'<input type="text" id="voteTitle" name="voteTitle" class="Fm_input2" style="width:365px;" tabindex="500" /></td>'+"</tr>"+"<tr>"+'<th><span>投票选项：</span><ul id="chooseIndex" class="ul2"></ul></th>'+'<td><span class="SG_txtc note1">每行填写一个选项，最多可填写15个选项。</span>'+'<ul class="ul1" id="voteItems">'+"<li>"+'<input type="text" name="voteData[]" tabindex="501" class="Fm_input2" style="width:345px;" />'+'<a class="del" id="delItem1" href="javascript:void(0);" onclick="return false;"><img width="15" height="15" align="absmiddle" title="删除" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon43"/></a></li>'+"<li>"+'<input type="text" name="voteData[]" tabindex="501" class="Fm_input2" style="width:345px;" />'+'<a class="del" id="delItem2" href="javascript:void(0);" onclick="return false;"><img width="15" height="15" align="absmiddle" title="删除" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon43"/></a></li>'+"<li>"+'<input type="text" name="voteData[]" tabindex="501"  class="Fm_input2" style="width:345px;" />'+'<a class="del" id="delItem3" href="javascript:void(0);" onclick="return false;"><img width="15" height="15" align="absmiddle" title="删除" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon43"/></a></li>'+"</ul>"+'<div class="addbtn"><a href="javascript:void(0)" onclick="return false;" id="newOne" tabindex="502">+ 增加选项</a></div></td>'+"</tr>"+"<tr>"+"<th>&nbsp;</th>"+'<td><a class="SG_aBtn SG_aBtnB" href="#" onclick="return false;" id="saveBtn" tabindex="509"><cite>保存</cite></a></td>'+"</tr>"+"</table>"+"</div>"+'<div class="voteBox2">'+'<table border="0" cellspacing="0" cellpadding="0">'+"<tr>"+"<th><span>投票方式：</span></th>"+'<td><div class="voteMethod"> <span>'+'<input type="radio" name="rad" id="rad1" tabIndex="503" onclick="changeType(false);" checked/>'+'<label for="rad1">单选</label>'+"</span> <span>"+'<input type="radio" name="rad" id="rad2" tabIndex="503" onclick="changeType(true);"/>'+'<label for="rad2">多选</label>'+'<select id="mutiple" style="display:none;" tabIndex="504" onchange="document.getElementById(\'voteType\').value=this.value">'+"<option value='2'>最多选2项</option>"+"<option value='3'>最多选3项</option>"+"<option value='4'>最多选4项</option>"+"<option value='5'>最多选5项</option>"+"<option value='6'>最多选6项</option>"+"<option value='7'>最多选7项</option>"+"</select>"+"</span> </div></td>"+"</tr>"+"<tr>"+"<th><span>投票位置：</span></th>"+'<td><div class="voteMethod">'+'<span><input type="radio" tabIndex="504" id="votePos1" name="votePos" value="1"/><label for="votePos1">在博文开始</label></span>'+'<span><input type="radio" tabIndex="504" id="votePos2" name="votePos" checked="true" value="0"/><label for="votePos2">在博文末尾</label></span>'+"</div></td>"+"</tr>"+"<tr>"+"<th><span>截止日期：</span></th>"+'<td class="td1"><div class="time">'+'<select id="year" name="voteYear" tabIndex="505">'+"</select>"+"<em>年</em>"+'<select id="month" name="voteMonth" tabIndex="506">'+"</select>"+"<em>月</em>"+'<select id="day" name="voteDay" tabIndex="507">'+"</select>"+"<em>日</em>"+'<select id="hh" name="voteHour" tabIndex="508">'+" </select>"+" <em>时</em></div></td>"+"</tr>"+"</table>"+"</div>"+"</div>"+'<div class="state2" id="saveStatus" style="display:none;">'+"</div>"+'<div class="clearit"></div>'+"",newItem:'<input type="text" tabIndex="501" class="Fm_input2" style="width:365px;" name="voteData[]"/><a href="javascript:;" onclick="return false;" class="del" id={0}><img class="SG_icon SG_icon43" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="删除" align="absmiddle" tabIndex="449" /></a>',saveItem:'<dl><dt><span id="vote_expired">{0}</span><a href="javascript:void(0);" onclick="return false;" id="editBtn" class="CP_a_fuc">[<cite>修改</cite>]</a></dt><dd id="voteArea"></dd></dl>'};window.dayArray=[31,28,31,30,31,30,31,31,30,31,30,31];var DateSelector=function(cfg){window.startTime={};window.endTime={};if(typeof cfg.from!="undefined"){window.startTime={year:parseInt(cfg.from.substring(0,4),10),month:parseInt(trimHeadZero(cfg.from.substring(5,7)),10),day:parseInt(trimHeadZero(cfg.from.substring(8,10)),10),hh:parseInt(trimHeadZero(cfg.from.substring(11,13)),10),timeobj:null}}else{var nowTime=new Date;window.startTime={year:parseInt(nowTime.getYear(),10),month:parseInt(nowTime.getMonth(),10),day:parseInt(nowTime.getDate(),10),hh:parseInt(nowTime.getHours(),10),timeobj:null}}var timeobj=new Date;timeobj.setFullYear(window.startTime.year);timeobj.setMonth(window.startTime.month-1);timeobj.setDate(window.startTime.day);timeobj.setHours(window.startTime.hh);window.startTime.timeobj=timeobj;var nextTime=new Date(window.startTime.timeobj);if(articleEditorCFG.articlevData==null){if(typeof cfg.to!="undefined"){var dtype=cfg.to.split("-")[0];if(dtype=="y"){nextTime.setFullYear(nextTime.getYear()+parseInt(cfg.to.split("-")[1]),10)}else if(dtype=="m"){nextTime.getMonth();var tempMonth=nextTime.getMonth()+parseInt(cfg.to.split("-")[1],10);nextTime.setMonth(tempMonth)}else if(dtype=="d"){nextTime.setDate(nextTime.getDate()+parseInt(cfg.to.split("-")[1],10))}else if(dtype=="h"){nextTime.setHours(nextTime.getHours()+parseInt(cfg.to.split("-")[1],10))}}else{nextTime.setMonth(nextTime.getMonth()+2)}}else{var tempExpire=articleEditorCFG.articlevData.expireTime;nextTime.setFullYear(parseInt(tempExpire.substring(0,4),10));nextTime.setMonth(parseInt(trimHeadZero(tempExpire.substring(5,7)),10)-1);nextTime.setDate(parseInt(trimHeadZero(tempExpire.substring(8,10)),10));nextTime.setHours(parseInt(trimHeadZero(tempExpire.substring(11,13)),10),0,0)}window.endTime={year:parseInt(nextTime.getFullYear(),10),month:parseInt(nextTime.getMonth(),10),day:parseInt(nextTime.getDate(),10),hh:parseInt(nextTime.getHours(),10),timeobj:nextTime};$E("year").onchange=function(){valueChange("year")};$E("month").onchange=function(){valueChange("month")};$E("day").onchange=function(){valueChange("day")};$E("hh").onchange=function(){valueChange("hh")};rederDateItems()};var valueChange=function(stype){var d_e_obj=window.endTime;var month=$E("month").value;var days=window.dayArray[month-1];if(month==2&&(stype=="month"||stype=="year")){if(isSpecialYear(parseInt($E("year").value,10))){days=29;$E("day").options.length=0;for(var m=1;m<=days;m++){var opt=new Option(m,m);if(opt.value==d_e_obj.day)opt.selected=true;$E("day").options.add(opt)}}else{$E("day").options.length=0;for(var m=1;m<=days;m++){var opt=new Option(m,m);if(opt.value==d_e_obj.day)opt.selected=true;$E("day").options.add(opt)}}}if(stype=="month"){$E("day").options.length=0;for(var m=1;m<=days;m++){var opt=new Option(m,m);if(opt.value==d_e_obj.day)opt.selected=true;$E("day").options.add(opt)}}var selectDate=new Date(parseInt($E("year").value,10),parseInt($E("month").value,10),parseInt($E("day").value,10),parseInt($E("hh").value,10))};var rederDateItems=function(){var d_s_obj=window.startTime;var d_e_obj=window.endTime;var currentMonth=0;$E("year").options.length=0;for(var y=0;y<=2;y++){var opt=new Option(d_s_obj.year+y,d_s_obj.year+y);$E("year").options.add(opt);if(opt.value==d_e_obj.year)opt.selected=true}$E("month").options.length=0;for(var m=0;m<=11;m++){var opt=new Option(m+1,m+1);$E("month").options.add(opt);if(parseInt(d_e_obj.month,10)+1==parseInt(opt.value+"",10)){currentMonth=m;opt.selected=true}}$E("day").options.length=0;for(var d=1;d<=window.dayArray[currentMonth];d++){var opt=new Option(d,d);$E("day").options.add(opt);if(opt.value==d_e_obj.day)opt.selected=true}$E("hh").options.length=0;for(var h=0;h<=23;h++){var opt=new Option(h,h);$E("hh").options.add(opt);if(opt.value==d_e_obj.hh)opt.selected=true}};function trimHeadZero(str){return str.replace(/^0/,"")}function dateCompare(date1,date2){return date1.getTime()<date2.getTime()}function isSpecialYear(year){return new Date(year,2,0).getDate()==29}Lib.pkg("Login");Lib.Login.info=function(){var info;if(window["sinaSSOController"]&&(info=sinaSSOController.getLoginInfo())){return info}else{return{}}};Lib.Login.LoginPost=Core.Class.create();Lib.Login.LoginPost.prototype={url:"http://i.sso.sina.com.cn/js/ssologin.js",callback:null,initialize:function(callback,clearDomain,from){window.sinaSSOConfig=new function(){if(from){this.from=from}this.pageCharset="utf-8";this.noActiveTime=14400;this.setDomain=true;this.entry="boke";this.customInit=function(){};this.customLoginCallBack=callback;this.customLogoutCallBack=function(result){};this.useIframe=true}},login:function(username,password,time){var _this=this;if(typeof sinaSSOController=="undefined"||!sinaSSOController){trace("no sso");Utils.Io.JsLoad.request(this.url,{onComplete:function(){__login()},onException:function(){},timeout:3e4,isRemove:false})}else{trace("has sso");sinaSSOController.init();if(typeof sinaSSOController.setLoginType=="function"){sinaSSOController.setLoginType(2)}if(typeof sinaSSOController.getServerTime=="function"){}trace("init ok");__login()}function __login(){if(typeof time=="undefined"){sinaSSOController.login(username,password)}else{sinaSSOController.login(username,password,time)}}},parse:function(loginStatus){this.callback.call(loginStatus)}};(function(){var _inputNode;var _rndID=parseInt(Math.random()*100);var _showMenuItems=[];var _selectMenuIndex=-1;var _selectMenuText="";var _css="#userPosition {padding: 0;margin: 0;border: 0;position: absolute;z-index: 999;}\r\n				#sinaNote {position: absolute;z-index: 999999;width: auto;overflow: hidden;padding: 0;margin: 0;\r\n				border: 1px solid #CCCCCC;background: #ffffff;text-align:left;}\r\n				#sinaNote li {font-size: 12px;list-style: none;margin: 0 1px;height: 20px;padding: 0 5px;clear: both;\r\n				line-height: 20px;cursor: pointer;color: #999999;}\r\n				#sinaNote li.note {text-align: left;color: #999999;}";var _viewWindow=window;var passcardOBJ={overfcolor:"#999",overbgcolor:"#e8f4fc",outfcolor:"#000000",outbgcolor:"",menuStatus:{"sina.com":true,"sina.cn":true,"vip.sina.com":true,"qq.com":true,"163.com":true,"126.com":true,"hotmail.com":true,"yahoo.com.cn":true,"gmail.com":true}};passcardOBJ.createNode=function(){var d=_viewWindow.document;var div=d.createElement("div");div.innerHTML='<ul id="sinaNote" style="display:none;"></ul>';var obj=d.createElement("style");obj.setAttribute("type","text/css");try{if($IE){obj.styleSheet.cssText=_css}else{obj.innerHTML=_css}}catch(e){trace(e.message)}var total=d.createElement("div");total.appendChild(div);total.appendChild(obj);d.body.appendChild(total)};passcardOBJ.arrowKey=function(keyCodeNum){if(keyCodeNum==38){if(_selectMenuIndex<=0){_selectMenuIndex=_showMenuItems.length}_selectMenuIndex--;passcardOBJ.selectLi(_selectMenuIndex)}if(keyCodeNum==40){if(_selectMenuIndex>=_showMenuItems.length-1){_selectMenuIndex=-1}_selectMenuIndex++;passcardOBJ.selectLi(_selectMenuIndex)}};passcardOBJ.showList=function(e){_selectMenuText="";var keyCodeNum=Core.Events.getEvent().keyCode;if(keyCodeNum==38||keyCodeNum==40){passcardOBJ.arrowKey(keyCodeNum);return false}if(!$E("sinaNote")){passcardOBJ.createNode()}var username=$E(e).value;var menuList={};var atIndex=username.indexOf("@");var InputCase="";var InputStr="";if(atIndex>-1){InputCase=username.substr(atIndex+1);InputStr=username.substr(0,atIndex)}_showMenuItems=[];_selectMenuIndex=0;_showMenuItems[_showMenuItems.length]="sinaNote_MenuItem_Title_"+_rndID;for(var key in this.menuStatus){this.menuStatus[key]=true;if(InputCase!=""&&InputCase!=key.substr(0,InputCase.length)){this.menuStatus[key]=false}else{_showMenuItems[_showMenuItems.length]="sinaNote_MenuItem_"+key+"_"+_rndID}}var listcontent='<li class="note">请选择登录类型</li>';listcontent+='<li id="sinaNote_MenuItem_Title_'+_rndID+'">'+username+"</li>";var itemLabel;for(var mykey in this.menuStatus){if(this.menuStatus[mykey]==true){if(InputStr==""){itemLabel=username+"@"+mykey}else{itemLabel=InputStr+"@"+mykey}listcontent+='<li id="sinaNote_MenuItem_'+mykey+"_"+_rndID+'" title="'+itemLabel+'">'+itemLabel+"</li>"}}$E("sinaNote").innerHTML=listcontent;for(var i=0;i<username.length;i++){if(username.charCodeAt(i)<160){$E("sinaNote").style.display="";this.selectList(e)}else{this.hideList()}}var el=$E(e);var note=$E("sinaNote");var frameLeft=0;var frameTop=0;var framePos;if(_viewWindow!=window){framePos=Core.Dom.getXY(window.frameElement);frameLeft=framePos[0];frameTop=framePos[1]}var inputWidth=el.offsetWidth;if(inputWidth<200){inputWidth=200}note.style.width=inputWidth-2+"px";var inputXY=Core.Dom.getXY(el);note.style.left=inputXY[0]-($IE?2:-1)+frameLeft+"px";note.style.top=inputXY[1]+el.offsetHeight-($IE?2:-1)+frameTop+"px"};passcardOBJ.selectList=function(e){var unames=$E("sinaNote").getElementsByTagName("li");for(var i=1;i<unames.length;i++){unames[1].style.backgroundColor=passcardOBJ.overbgcolor;unames[1].style.color=passcardOBJ.outfcolor;unames[i].onmousedown=function(){var temp=this.innerHTML;if(temp.indexOf("非新浪邮箱")>-1){var pos=temp.split("@");$E(e).value=pos[0]}else{$E(e).value=this.innerHTML}if(Core.Events.getEvent()!=null){Core.Events.stopEvent()}};unames[i].onmouseover=function(){if(i!=1){unames[1].style.backgroundColor=passcardOBJ.outbgcolor;unames[1].style.color=passcardOBJ.overfcolor}this.style.backgroundColor=passcardOBJ.overbgcolor;this.style.color=passcardOBJ.outfcolor};unames[i].onmouseout=function(){this.style.backgroundColor=passcardOBJ.outbgcolor;this.style.color=passcardOBJ.overfcolor;unames[1].style.backgroundColor=passcardOBJ.overbgcolor;unames[1].style.color=passcardOBJ.outfcolor}}};passcardOBJ.selectLi=function(nIndex){var menuNode;$E("sinaNote_MenuItem_Title_"+_rndID).style.backgroundColor=passcardOBJ.outbgcolor;$E("sinaNote_MenuItem_Title_"+_rndID).style.color=passcardOBJ.overfcolor;for(var i=0;i<_showMenuItems.length;i++){menuNode=$E(_showMenuItems[i]);menuNode.style.backgroundColor=passcardOBJ.outbgcolor;menuNode.style.color=passcardOBJ.overfcolor}$E(_showMenuItems[nIndex]).style.backgroundColor=passcardOBJ.overbgcolor;$E(_showMenuItems[nIndex]).style.color=passcardOBJ.outfcolor;_selectMenuText=$E(_showMenuItems[nIndex]).innerHTML};passcardOBJ.hideList=function(){if(!$E("sinaNote")){passcardOBJ.createNode()}$E("sinaNote").style.display="none"};passcardOBJ.init=function(oNode,oColors,oFocusNode,oWindowTarget){oWindowTarget=oWindowTarget||window;if(oWindowTarget.document.body==null){setTimeout(Core.Function.bind3(function(){this.init(oNode,oColors,oFocusNode,oWindowTarget)},this),100)}for(var key in oColors){this[key]=oColors[key]}Core.Events.addEvent(document,passcardOBJ.hideList,"click");Core.Events.addEvent(oNode,passcardOBJ.hideList,"blur");Core.Events.addEvent(oNode,Core.Function.bind3(passcardOBJ.showList,this,[oNode]),"keyup");Core.Events.addEvent(oNode,function(e){var keyCodeNum=Core.Events.getEvent().keyCode;var isSinaMail;if(keyCodeNum==13||keyCodeNum==9){if(_selectMenuText!=""){var temp=_selectMenuText;if(temp.indexOf("非新浪邮箱")>-1){var pos=temp.split("@");oNode.value=pos[0]+"@";isSinaMail=false}else{oNode.value=_selectMenuText;isSinaMail=true}}if(isSinaMail){if(oFocusNode!=null){setTimeout(function(){oFocusNode.focus()},0)}}else{if(oNode){oNode.focus()}}}},"keydown");if(oWindowTarget){_viewWindow=oWindowTarget}};Lib.passcardOBJ=passcardOBJ})();Lib.Login.Ui=Core.Class.create();var msnRefreshTimer=0;function msnrefreshWindow(){var setCookie=Utils.Cookie.setCookie;var getCookie=Utils.Cookie.getCookie;clearTimeout(msnRefreshTimer);var reg_token=getCookie("reg_token");if(reg_token){trace("token find out...");setCookie("reg_token","","","/",".blog.sina.com.cn")}else{trace("no token...");msnRefreshTimer=setTimeout(msnrefreshWindow,1e3);return}var cookieArr;var cid;var code;var c_cid=getCookie("c_uid");var CBcookie=getCookie("msnLinkCB");var altReg=getCookie("AlT");setCookie("msnLoginComeFrom",window.location.href,1,"/",".blog.sina.com.cn");if(CBcookie){cookieArr=CBcookie.split("_");cid=cookieArr[0];code=cookieArr[1]}if(c_cid!=cid)return;switch(code){case"noCid":break;case"loginError":break;case"unlink":deleteCookie("msnLinkCB");funcNoAccount(reg_token);break;case"done":deleteCookie("msnLinkCB");setCookie("loginFromMsn","msn",24,"/",".blog.sina.com.cn");funcSuccess(altReg,reg_token);break;case"pass":break}function funcSuccess(arg,reg_tk){trace("has Account");if(arg){trace("alt:"+arg);var iframe=$C("iframe");iframe.setAttribute("height",0);iframe.setAttribute("width",0);document.body.appendChild(iframe);iframe.src="https://login.sina.com.cn/sso/login.php?entry=blogmsn&service=blogmsn&alt="+encodeURIComponent(arg)+"&savestate=7&returntype=TEXT";(function(){var me=arguments.callee;if(!me.count)me.count=0;if(me.count++>10){trace("放弃获取SUP");iframe.parentNode.removeChild(iframe);return}trace("尝试获取SUP, count:"+me.count);if(getCookie("SUP")){trace("获取到 SUP"+getCookie("SUP"));window.location.reload();return}setTimeout(me,1e3)})()}else{window.location.reload()}}function funcNoAccount(){trace("noAccount");window.location.href="http://blog.sina.com.cn/blog_rebuild/msn/interface/connect_user_confirm.php"}function deleteCookie(name){var Then=new Date;Then.setTime(Then.getTime()-1);document.cookie=name+"=_pass;path=/;domain=.blog.sina.com.cn;expires="+Then.toGMTString()}function jsonDecode(str){if(!str||str==""){return null}try{return window.eval("("+str+")")}catch(e){return null}}}Lib.Login.Ui.prototype={dialog:null,isInit:false,request:null,callback:null,initialize:function(){},login:function(callback,clearDomain,from){this.callback=callback||null;this.clearDomain=clearDomain||false;this.from=from||null;this.initDom();this.initEvent();this.dialog.show();this.dialog.setAreaLocked(true);this.reloadName();this.onShow();this.focus();if(scope.$pageid==="blogMove"){$E("login_move_tip").style.display=""}if($IE6){this.initAD()}Lib.passcardOBJ.init($E("login_name_d"),{overfcolor:"#999",overbgcolor:"#e8f4fc",outfcolor:"#000000",outbgcolor:""},$E("login_pass_d"))},reloadName:function(){var userInfo=Lib.Login.info();var defaultName=userInfo.ln;if(defaultName){$E("login_name_d").value=defaultName}var alf=Utils.Cookie.getCookie("ALF");if(alf!=""&&$E("login_save")){$E("login_save").checked=true;$E("login_save_tips").style.display="none"}alf=Utils.Cookie.getCookie("LiRe");if(alf!=""&&$E("login_save")){$E("login_save").checked=true;$E("login_save_tips").style.display="none"}},initDom:function(){var me=this;this.dialog=winDialog.createCustomsDialog({tpl:me.tpl});this.dialog.addEventListener("hidden",function(){this.destroy()});this.dialog.setContent(this.struc);this.dialog.setTitle("登录新浪博客");this.dialog.setMiddle()},initEvent:function(){var callback=this.parse.bind2(this);this.request=new Lib.Login.LoginPost(callback,this.clearDomain,this.from);Core.Events.addEvent("login_button",this.doLogin.bind2(this));Core.Events.addEvent("login_name_d",function(e){var code=e.keyCode;if(code==13){this.doLogin()}}.bind2(this),"keydown");Core.Events.addEvent("login_pass_d",function(e){var code=e.keyCode;if(code==13){this.doLogin()}}.bind2(this),"keydown");var cancelStatus=1;Core.Events.addEvent("login_save",function(){if($E("login_save").checked){$E("login_save_tips").style.display=""}else{$E("login_save_tips").style.display="none"}if(cancelStatus){var url="http://control.blog.sina.com.cn/blog_rebuild/riaapi/padblog/padInfo.php?ck_login=A00001&rnd="+Math.random();Utils.Io.JsLoad.request(url,{onComplete:function(){},onException:function(){}});cancelStatus=null}})},doLogin:function(){Core.Events.stopEvent();var username=$E("login_name_d").value;var password=$E("login_pass_d").value;username=Core.String.trim(username);password=password;if(username==""){this.error("请输入登录名");return false}if(password==""){this.error("请输入密码");return false}if(typeof sinaSSOController!="undefined"&&typeof sinaSSOController.loginExtraQuery!="undefined"){if(typeof sinaSSOController.loginExtraQuery.door!="undefined"){var vcode=$E("login_vcode").value;sinaSSOController.loginExtraQuery.door=vcode||1}}if($E("login_save").checked){v7sendLog("48_01_38_1");this.request.login(username,password,60)}else{v7sendLog("48_01_38_0");this.request.login(username,password)}return false},parse:function(loginStatus){if(loginStatus.result){Lib.checkAuthor();if($E("login_save").checked){Utils.Cookie.setCookie("LiRe",true,2400,"/",".blog.sina.com.cn")}else{Utils.Cookie.setCookie("LiRe","",2400,"/",".blog.sina.com.cn")}var date=new Date,y=date.getFullYear(),m=date.getMonth(),d=date.getDate();var time=new Date(y,m,d,24).getTime();Utils.Cookie.setCookie("onceloggedonblog",time,720,"/",".blog.sina.com.cn");var me=this;function cbreload(){if(this.callback){try{$tray.renderLogin()}catch(e){}this.callback.call()}else{window.location=window.location.toString().replace(/#.*/,"")}}var cbed=false;Utils.Io.JsLoad.request("http://login.sina.com.cn/bindmail/checkmailuser.php?entry=blog&name="+encodeURIComponent($E("login_name_d").value)+"&utf82gbk=1&callback=scope.$bindEmailAlert",{noreturn:true,timeout:5e3,onException:function(){if(!cbed){cbreload.call(me)}}});scope.$bindEmailAlert=function(data){cbed=true;if(data.ret!="y"&&data.errcode!="not_verify"||Utils.Cookie.getCookie("sbr_noTBE")==1){cbreload.call(me)}else{var dialog=winDialog.createCustomsDialog({content:['<div id="#{entityID} style="width:358px;height:144px" class="CP_layercon2 unilayer">','<div id="#{contentID}" class="CP_prompt">','<img height="50" align="absmiddle" width="50" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon201">','<table class="CP_w_ttl"><tbody><tr><td>经检测您的帐号存在一定的安全隐患！<br>建议绑定邮箱</td></tr></tbody></table>','<p class="CP_w_btns_Mid"><a href="javascript:;" class="SG_aBtn SG_aBtnB" id="#{bindit}" target="_blank"><cite> 绑定 </cite></a>&nbsp;&nbsp;<a href="javascript:;" class="SG_aBtn SG_aBtnB" id="#{nobind}"><cite> 暂不绑定 </cite></a></p>',"</div>",'<div class="unilayerB SG_j_linedot1">','<p class="SG_txtb"><input type="checkbox" id="#{noalertbind}"><label for="#{noalertbind}">一周内不提醒</label></p>',"</div>","</div>"].join(""),shadow:1},"bindEmail");dialog.setMiddle();dialog.show();dialog.nodes["btnClose"].onclick=function(){cbreload.call(me);dialog.hidden()};dialog.nodes["nobind"].onclick=function(){setTimeout(function(){cbreload.call(me);dialog.hidden()},100)};dialog.nodes["bindit"].href="http://login.sina.com.cn/bindmail/bindmail.php?entry=blog";dialog.nodes["bindit"].onclick=function(){cbreload.call(me)};dialog.nodes["noalertbind"].onclick=function(){if(this.checked){Utils.Cookie.setCookie("sbr_noTBE","1",24*7,"/",".blog.sina.com.cn")}else{Utils.Cookie.setCookie("sbr_noTBE","",0,"/",".blog.sina.com.cn")}}}};this.dialog.hidden()}else{if(loginStatus.errno==="4049"){sinaSSOController.loginExtraQuery={door:0};$E("login_ckimg").style.display="";$E("login_vcode").value="";$E("checkImg").src="http://login.sina.com.cn/cgi/pin.php?r="+Core.Math.getUniqueId()+"&s=0";Core.Events.addEvent($E("reloadCode"),function(){$E("checkImg").src="http://login.sina.com.cn/cgi/pin.php?r="+Core.Math.getUniqueId()+"&s=0";$E("login_vcode").value="";$E("login_div_error").innerHTML=""});this.error("");return}if(loginStatus.errno==="2070"){Core.Events.fireEvent($E("reloadCode"),"click");this.error(loginStatus.reason);return}if(loginStatus.errno=="4047"){this.error(loginStatus.reason);return}else if(loginStatus.errno=="4057"){this.error(loginStatus.reason);return}else if(loginStatus.errno=="4040"){this.error(loginStatus.reason);return}this.error("登录名或密码错误");$E("checkImg").src="http://login.sina.com.cn/cgi/pin.php?r="+Core.Math.getUniqueId()+"&s=0";$E("login_vcode").value=""}},friendlyTip:function(reason){var ret=reason;var node=$E("login_name_d");var name=node.value;var me=this;if(!/[\u0391-\uFFE5]+/.test(name)&&!/^\d+$/.test(name)&&!/^@/.test(name)){var str="你的登录名可能是 ";var linkTpl='<a href="#" class="underline" onclick="$_RENAME(/@.*/, \'{1}\');return false">{0}{1}</a>';var linkArr=["@sina.com","@sina.cn"];var finalLink="";if(/@sina\.cn$/.test(name)){finalLink=linkTpl.format("{0}",linkArr[0])}else if(/@sina\.com$/.test(name)){finalLink=linkTpl.format("{0}",linkArr[1])}else{finalLink=linkTpl.format("{0}",linkArr[0])+" 或 "+linkTpl.format("{0}",linkArr[1])}ret=(str+finalLink).format(name.replace(/@.*/,""))}return ret},rename:function(){window.$_RENAME=function(reg,suf){var node=$E("login_name_d");node.value=node.value.replace(reg,"")+suf;

$E("login_pass_d").focus();$E("login_div_error").innerHTML=""};return window.$_RENAME}(),focus:function(){var nameEl=$E("login_name_d");if(nameEl.value==""){nameEl.focus()}else{$E("login_pass_d").focus()}},initAD:function(){$E("login_ad").src="http://blog.sina.com.cn/lm/iframe/71/2008/0731/21.html"},onShow:function(){},error:function(msg){$E("login_div_error").innerHTML=msg;$E("login_pass_d").value="";this.focus()},tpl:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}">提示标题</strong>','<cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">',"</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),struc:'		<div class="CP_layercon2 passLoginItem">			<div>				<div id="login_move_tip" style="display:none;margin-bottom:12px">可以使用新浪微博、邮箱、通行证的帐号进行登录</div>				<div class="boxA">登录名：					<input tabIndex="201" type="text" class="fm1" style="width:215px;" name="login_name" id="login_name_d" tabIndex=1/>  <a style="font-size: 12px;" href="http://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid='+scope.$uid+'&src=blogicp" target="_blank">立即注册</a>				</div>				<div class="boxA">密　码：					<input tabIndex="202" type="password" class="fm1" style="width:215px;" name="login_pass" maxlength="16" id="login_pass_d" tabIndex=2/>  <a style="font-size: 12px;" href="http://login.sina.com.cn/getpass.html" target="_blank">找回密码</a>				</div>				<div id="login_ckimg" class="boxA" style="display:none"> <p class="p_img">验证码：                  	<input type="text" id="login_vcode" name="login_vcode" class="fm1" size="10" maxlength="5" />                  	<img width="100" align="absmiddle" id="checkImg" src="http://login.sina.com.cn/cgi/pin.php?r='+Core.Math.getUniqueId()+'&s=0" /> <a href="javascript:;" onclick="return false;" style="font-size: 12px;"><span id="reloadCode">换一换</span></a></p> 			    </div>				<div class="ErrTips" id="login_div_error"></div>				<div class="boxB"><p><input tabIndex="203" type="checkbox" value="" id="login_save" checked="checked" /><label for="login_save"> 记住登录状态</label></p><p id="login_save_tips" style="color:#999;display:none;">建议在网吧/公用电脑上取消该选项</p><p style="margin-top: 8px;"><a id="login_button" class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;" tabIndex=204><cite>登录<input type="text"/></cite></a> </p></div>			</div>			<div class="connect_msn" id="connect_msn" style="position:relative;">				<span>使用 MSN 帐号登录博客</span>				<a href="#" onclick="Lib.checkAuthor();v7sendLog(\'48_01_36\'); window.open(\'https://login.live.com/oauth20_authorize.srf?client_id=0000000040046F08&redirect_uri=http%3A%2F%2Fcontrol.blog.sina.com.cn%2Fblog_rebuild%2Fmsn%2FmsnLoginCallBack.php&response_type=code&scope=wl.basic%20wl.signin%20wl.offline_access%20wl.share%20wl.emails\',\'neww\',\'left='+(screen.width-440)/2+",top="+(screen.height-400)/2+',height=400,width=440\');msnrefreshWindow();" style="background:transparent url(http://simg.sinajs.cn/blog7style/images/msn_login01.gif) no-repeat left top; width:70px; height:22px; line-height:22px; display:inline-block; text-align:left; text-indent:2em; text-decoration:none; color:white; font-weight:bold; font-size:14px;">登录</a>			</div>			<a href="http://blog.sina.com.cn/s/blog_4b0f52990100miil.html" target="_blank"style="left:308px;position:relative;top:-24px;">如何登录？</a>			<div class="CP_lg_ad SG_j_linedot1">				<iframe id="login_ad" src="http://blog.sina.com.cn/lm/iframe/71/2008/0731/21.html" frameborder="0" scrolling="no" height="25" width="auto"></iframe>			</div>		</div>'};Lib.register("blogv.getVHTML",function(){return function(wtype,isLinked){var title,className;if(isNaN(wtype)){wtype=-1}else{wtype=parseInt(wtype,10)}if(0==wtype){title="新浪个人认证";className=" SG_icon146"}else if(0<wtype&&8>wtype){title="新浪机构认证";className=" SG_icon147"}var str;if(!1!==isLinked){isLinked=!0}if(title){str='<img class="SG_icon '+className+'" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="'+title+'" alt="'+title+'" align="absmiddle" />'}else{str=""}if(str&&isLinked){str='<a target="_blank" href="http://blog.sina.com.cn/v/verify">'+str+"</a>"}return str}});$SYSMSG.extend({B00901:"投票不存在。",B00902:"投票已截止。",B00903:"超出允许投票个数。",B00904:"你已投过票了!<br/>重复投票是没有意义的。",B00905:"投票主题过短<br/>至少要5个汉字或10个字符！",B00906:"投票选项至少要填写2项",B00907:"投票的截止时间不能小于当前时间，请重新选择 ",B00908:"投票选项最多可填写7项",B00909:"投票主题不能为空"});Core.Dom.getElementsByAttr=function(node,attname,attvalue){var nodes=[];for(var i=0,l=node.childNodes.length;i<l;i++){if(node.childNodes[i].nodeType==1){if(node.childNodes[i].getAttribute(attname)==attvalue){nodes.push(node.childNodes[i])}if(node.childNodes[i].childNodes.length>0){nodes=nodes.concat(arguments.callee.call(null,node.childNodes[i],attname,attvalue))}}}return nodes};Core.Dom.insertAfter=function(newElement,targetElement){var parent=targetElement.parentNode;if(parent.lastChild==targetElement){parent.appendChild(newElement)}else{parent.insertBefore(newElement,targetElement.nextSibling)}return newElement};Core.Dom.removeParentNode=function(node){node=$E(node);var parentNode=node.parentNode;Core.Dom.insertAfter(node,parentNode);parentNode.parentNode.removeChild(parentNode)};if(typeof infosoftglobal=="undefined")var infosoftglobal=new Object;if(typeof infosoftglobal.FusionChartsUtil=="undefined")infosoftglobal.FusionChartsUtil=new Object;infosoftglobal.FusionCharts=function(swf,id,w,h,debugMode,registerWithJS,c,scaleMode,lang,detectFlashVersion,autoInstallRedirect){if(!document.getElementById){return}this.initialDataSet=false;this.params=new Object;this.variables=new Object;this.attributes=new Array;if(swf){this.setAttribute("swf",swf)}if(id){this.setAttribute("id",id)}debugMode=debugMode?debugMode:0;this.addVariable("debugMode",debugMode);w=w.toString().replace(/\%$/,"%25");if(w){this.setAttribute("width",w)}h=h.toString().replace(/\%$/,"%25");if(h){this.setAttribute("height",h)}if(c){this.addParam("bgcolor",c)}this.addParam("quality","high");this.addParam("allowScriptAccess","always");this.addVariable("chartWidth",w);this.addVariable("chartHeight",h);this.addVariable("DOMId",id);registerWithJS=registerWithJS?registerWithJS:0;this.addVariable("registerWithJS",registerWithJS);scaleMode=scaleMode?scaleMode:"noScale";this.addVariable("scaleMode",scaleMode);lang=lang?lang:"EN";this.addVariable("lang",lang);this.detectFlashVersion=detectFlashVersion?detectFlashVersion:1;this.autoInstallRedirect=autoInstallRedirect?autoInstallRedirect:1;this.installedVer=infosoftglobal.FusionChartsUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){infosoftglobal.FusionCharts.doPrepUnload=true}};infosoftglobal.FusionCharts.prototype={setAttribute:function(name,value){this.attributes[name]=value},getAttribute:function(name){return this.attributes[name]},addParam:function(name,value){this.params[name]=value},getParams:function(){return this.params},addVariable:function(name,value){this.variables[name]=value},getVariable:function(name){return this.variables[name]},getVariables:function(){return this.variables},getVariablePairs:function(){var variablePairs=new Array;var key;var variables=this.getVariables();for(key in variables){variablePairs.push(key+"="+variables[key])}return variablePairs},getSWFHTML:function(){var swfNode="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){swfNode='<embed type="application/x-shockwave-flash" src="'+this.getAttribute("swf")+'" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'"  ';swfNode+=' id="'+this.getAttribute("id")+'" name="'+this.getAttribute("id")+'" ';var params=this.getParams();for(var key in params){swfNode+=[key]+'="'+params[key]+'" '}var pairs=this.getVariablePairs().join("&");if(pairs.length>0){swfNode+='flashvars="'+pairs+'"'}swfNode+="/>"}else{swfNode='<object id="'+this.getAttribute("id")+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'">';swfNode+='<param name="movie" value="'+this.getAttribute("swf")+'" />';var params=this.getParams();for(var key in params){swfNode+='<param name="'+key+'" value="'+params[key]+'" />'}var pairs=this.getVariablePairs().join("&");if(pairs.length>0){swfNode+='<param name="flashvars" value="'+pairs+'" />'}swfNode+="</object>"}return swfNode},setDataURL:function(strDataURL){if(this.initialDataSet==false){this.addVariable("dataURL",strDataURL);this.initialDataSet=true}else{var chartObj=infosoftglobal.FusionChartsUtil.getChartObject(this.getAttribute("id"));if(!chartObj.setDataURL){__flash__addCallback(chartObj,"setDataURL")}chartObj.setDataURL(strDataURL)}},encodeDataXML:function(strDataXML){var regExpReservedCharacters=["\\$","\\+"];var arrDQAtt=strDataXML.match(/=\s*\".*?\"/g);if(arrDQAtt){for(var i=0;i<arrDQAtt.length;i++){var repStr=arrDQAtt[i].replace(/^=\s*\"|\"$/g,"");repStr=repStr.replace(/\'/g,"%26apos;");var strTo=strDataXML.indexOf(arrDQAtt[i]);var repStrr="='"+repStr+"'";var strStart=strDataXML.substring(0,strTo);var strEnd=strDataXML.substring(strTo+arrDQAtt[i].length);var strDataXML=strStart+repStrr+strEnd}}strDataXML=strDataXML.replace(/\"/g,"%26quot;");strDataXML=strDataXML.replace(/%(?![\da-f]{2}|[\da-f]{4})/gi,"%25");strDataXML=strDataXML.replace(/\&/g,"%26");return strDataXML},setDataXML:function(strDataXML){if(this.initialDataSet==false){this.addVariable("dataXML",this.encodeDataXML(strDataXML));this.initialDataSet=true}else{var chartObj=infosoftglobal.FusionChartsUtil.getChartObject(this.getAttribute("id"));chartObj.setDataXML(strDataXML)}},setTransparent:function(isTransparent){if(typeof isTransparent=="undefined"){isTransparent=true}if(isTransparent)this.addParam("WMode","transparent");else this.addParam("WMode","Opaque")},render:function(elementId){if(this.detectFlashVersion==1&&this.installedVer.major<8){if(this.autoInstallRedirect==1){var installationConfirm=window.confirm("You need Adobe Flash Player 8 (or above) to view the charts. It is a free and lightweight installation from Adobe.com. Please click on Ok to install the same.");if(installationConfirm){window.location="http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash"}else{return false}}else{return false}}else{var n=typeof elementId=="string"?document.getElementById(elementId):elementId;if(this.getVariable("scaleMode").search(/noscale/i)>=0&&(this.getAttribute("width").search("%")>0||this.getAttribute("height").search("%")>0)){var obj=this;if(window.addEventListener){window.addEventListener("load",function(){n.innerHTML=obj.getSWFHTML()},false)}else if(window.attachEvent){window.attachEvent("onload",function(){n.innerHTML=obj.getSWFHTML()})}else{n.innerHTML=this.getSWFHTML()}}else{n.innerHTML=this.getSWFHTML()}if(!document.embeds[this.getAttribute("id")]&&!window[this.getAttribute("id")])window[this.getAttribute("id")]=document.getElementById(this.getAttribute("id"));return true}}};infosoftglobal.FusionChartsUtil.getPlayerVersion=function(){var PlayerVersion=new infosoftglobal.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description){PlayerVersion=new infosoftglobal.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."))}}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;var counter=3;while(axo){try{counter++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+counter);PlayerVersion=new infosoftglobal.PlayerVersion([counter,0,0])}catch(e){axo=null}}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");PlayerVersion=new infosoftglobal.PlayerVersion([6,0,21]);axo.AllowScriptAccess="always"}catch(e){if(PlayerVersion.major==6){return PlayerVersion}}try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){}}if(axo!=null){PlayerVersion=new infosoftglobal.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","))}}return PlayerVersion};infosoftglobal.PlayerVersion=function(arrVersion){this.major=arrVersion[0]!=null?parseInt(arrVersion[0]):0;this.minor=arrVersion[1]!=null?parseInt(arrVersion[1]):0;this.rev=arrVersion[2]!=null?parseInt(arrVersion[2]):0};infosoftglobal.FusionChartsUtil.cleanupSWFs=function(){var objects=document.getElementsByTagName("OBJECT");for(var i=objects.length-1;i>=0;i--){objects[i].style.display="none";for(var x in objects[i]){if(typeof objects[i][x]=="function"){objects[i][x]=function(){}}}}};if(infosoftglobal.FusionCharts.doPrepUnload){if(!infosoftglobal.unloadSet){infosoftglobal.FusionChartsUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",infosoftglobal.FusionChartsUtil.cleanupSWFs)};window.attachEvent("onbeforeunload",infosoftglobal.FusionChartsUtil.prepUnload);infosoftglobal.unloadSet=true}}if(!document.getElementById&&document.all){document.getElementById=function(id){return document.all[id]}}if(Array.prototype.push==null){Array.prototype.push=function(item){this[this.length]=item;return this.length}}infosoftglobal.FusionChartsUtil.getChartObject=function(id){var chartRef=null;if(navigator.appName.indexOf("Microsoft Internet")==-1){if(document.embeds&&document.embeds[id])chartRef=document.embeds[id];else chartRef=window.document[id]}else{chartRef=window[id]}if(!chartRef)chartRef=document.getElementById(id);return chartRef};var getChartFromId=infosoftglobal.FusionChartsUtil.getChartObject;var FusionCharts=infosoftglobal.FusionCharts;var voteValues=[];RenderFlash=Core.Class.create();RenderFlash.prototype={flashId:null,data:null,current:null,eventDom:null,_labels:null,selected:[],initialize:function(){this.eventDom={tab:$E("tabDiv")?$E("tabDiv"):null,line:$E("lineView")?$E("lineView"):null,pie:$E("pieView")?$E("pieView"):null,column:$E("columnView")?$E("columnView"):null,content:$E("voteViewContent")?$E("voteViewContent"):null};this._refreshFlashId();this._addClickEvent(this.eventDom.line);this._addClickEvent(this.eventDom.pie);this._addClickEvent(this.eventDom.column);this.combineData()},showTab:function(flashType,flashId,parentId){if(this.current==flashType)return;var flashBar=Core.Dom.getElementsByClass($E("voter"),"div","vShape")[0];if(flashBar){flashBar.style.display=""}window.clearAllInterval();if(flashType=="line"){this.current="line";$E("voteViewContent").innerHTML=window.vote_cache_content_html;window.renderVoteNum();var items=document.getElementsByName("chb1");for(var j=0;j<items.length;j++){items[j].disabled="true";try{items[j].parentNode.childNodes[3].style.cursor="default"}catch(error){}}}else if(flashType=="Pie3D.swf"){this.current="Pie3D.swf";var html=this._tabTemplate.chooses.join("");var uls="";for(var i=0;i<this._labels.length;i++){var itemTpl=this._tabTemplate.item.join("");itemTpl=itemTpl.replace("#{type}",window.vote_rc_type+"");itemTpl=itemTpl.replace(/([#][{]index[}])/gi,i+1);itemTpl=itemTpl.replace("#{text}",this._labels[i]);uls+=itemTpl}html=html.replace("#{uls}",uls);html+=this._tabTemplate.flash.join("");this.eventDom["content"].innerHTML=html;var height=this._labels.length*30;if(height<150)height=150;var xml="<chart baseFontSize='12' baseFontColor='888888' numberSuffix='%25' showAboutMenuItem='0' decimals='2' chartTopMargin='0' chartBottomMargin='0' caption='' showValues='0' formatNumberScale='0' bgColor='99CCFF,FFFFFF' bgAlpha='0,0' startingAngle='60'>";for(var i=0;i<this.data.length;i++){var item=this.data[i];if(this.selected[i]!=null){xml+="<set label='"+(i+1)+"' value='"+voteValues[i].replace("%","")+"' displayValue='"+Core.String.shorten(this._labels[i],7,"…")+"' toolText='"+this._labels[i]+"("+voteValues[i]+")' isSliced='1' />"}else{xml+="<set label='"+(i+1)+"' value='"+voteValues[i].replace("%","")+"' displayValue='"+Core.String.shorten(this._labels[i],7,"…")+"' toolText='"+this._labels[i]+"("+voteValues[i]+")' />"}}xml+="</chart>";var chart=new FusionCharts($_GLOBAL.flashBasicURL+"Pie3D.swf",flashId,"360",height,"0","0");chart.setDataXML(xml);chart.setTransparent(true);chart.render(parentId)}else if(flashType=="Column3D.swf"){this.current="Column3D.swf";var html=this._tabTemplate.chooses.join("");var uls="";for(var i=0;i<this._labels.length;i++){var itemTpl=this._tabTemplate.item.join("");itemTpl=itemTpl.replace("#{type}",window.vote_rc_type+"");itemTpl=itemTpl.replace(/([#][{]index[}])/gi,i+1);itemTpl=itemTpl.replace("#{text}",this._labels[i]);uls+=itemTpl}html=html.replace("#{uls}",uls);html+=this._tabTemplate.flash.join("");this.eventDom["content"].innerHTML=html;var height=this._labels.length*30;if(height<150)height=150;var xml="<chart baseFontSize='12' baseFontColor='888888' showValues='1' outCnvBaseFontColor='999999' outCnvBaseFontSize='12' numberSuffix='%25' showAboutMenuItem='0' decimals='2' yAxisMaxValue='100' palette='2' enableRotation='1' canvasBgColor='ffffff' canvasBgAlpha='0' canvasBgDepth='3' canvasBaseColor='ffffff' divLineColor='d8d8d8' numDivLines='4' bgAlpha='0' divLineColor='d8d8d8' canvasPadding='8' chartLeftMargin='0' chartRightMargin='5' chartTopMargin='5' chartBottomMargin='0' maxColWidth='70' showValues='0'><styles><definition><style name='myToolTip' type='font' size='12' color='666666' /></definition><application><apply toObject='ToolTip' styles='myToolTip' /></application></styles>";for(var i=0;i<this.data.length;i++){var item=this.data[i];xml+="<set label='"+(i+1)+"' value='"+voteValues[i].replace("%","")+"' toolText='"+this._labels[i]+"("+voteValues[i]+")' />"}xml+="</chart>";var chart=new FusionCharts($_GLOBAL.flashBasicURL+"Column3D.swf",flashId,"360",height,"0","0");chart.setDataXML(xml);chart.setTransparent(true);chart.render(parentId)}if($E("flashContent"))$E("flashContent").style.padding="13px 0 0 "},_refreshFlashId:function(){this.flashId=Core.Math.getUniqueId()},_addClickEvent:function(dom){var _this=this;if(dom){dom.onclick=function(){_this._onClickHandler(this)}}},_onClickHandler:function(dom){var _this=this;function updateTabStatus(type){_this.eventDom["line"].parentNode.className="";_this.eventDom["pie"].parentNode.className="";_this.eventDom["column"].parentNode.className="";_this.eventDom[type].parentNode.className="cur SG_txtb"}if(dom!=null){var id=dom.id;if(id=="lineView"){this.showTab("line","lineId","voteViewContent");updateTabStatus("line")}else if(id=="pieView"){this.showTab("Pie3D.swf","Pie3D_"+this.flashId,"flashContent");updateTabStatus("pie")}else if(id=="columnView"){this.showTab("Column3D.swf","Column3D_"+this.flashId,"flashContent");updateTabStatus("column")}}},combineData:function(changeData){this.data=[];var labels=this._getLabel();for(var i=0;i<labels.length;i++){this.data[this.data.length]={label:labels[i],num:window.vote_count.detail[i]}}},_getLabel:function(){var labels=[];var spans=Core.Dom.getElementsByClass($E("voteViewContent"),"span","");var length=spans.length;for(var i=0;i<length;i++){labels[labels.length]=spans[i].innerHTML}this._labels=labels;return labels},_tabTemplate:{chooses:['<div class="vContentRe">',"<ul>","#{uls}","</ul>","</div>"],item:['<li class="clearfix">','<div class="choosed">','<input type="#{type}" disabled="disabled" id="chb#{index}"/><label for="chb#{index}" style="cursor:default"><em>#{index}.</em><span>#{text}</span></label>',"</div>","</li>"],flash:['<div id="flashContent" class="vContentPic">',"</div>"]}};(function(_){_.rf=null;_.changeType=function(flag){$E("mutiple").style.display=flag?"":"none";$E("voteType").value=flag?$E("mutiple").value:1};_.checkNum=function(self,mutipleNum){var chks=document.getElementsByName("chb1");var chkedNum=0;for(var i=0;i<chks.length;i++){var chk=chks[i];if(chk.checked){chkedNum++}}if(chkedNum>mutipleNum){winDialog.alert("最多只能选"+mutipleNum+"项！",{icon:"01"});self.checked=false}};_.isExpired=function(sDate){return sDate.replace(/(-)|\s/g,"")<getTimestamp("yyyy-MM-dd hh").replace(/(-)|\s/g,"")};_.getTimestamp=function(format){var currentTime=new Date;var thisYear=currentTime.getFullYear();var thisMonth=currentTime.getMonth()+1;thisMonth=thisMonth>9?thisMonth:"0"+thisMonth;var today=currentTime.getDate()>9?currentTime.getDate():"0"+currentTime.getDate();var hh=currentTime.getHours();var mm=currentTime.getMinutes()>9?currentTime.getMinutes():"0"+currentTime.getMinutes();var ss=currentTime.getSeconds()>9?currentTime.getSeconds():"0"+currentTime.getSeconds();return format.replace(/(y{2,4})/,thisYear).replace("MM",thisMonth).replace("dd",today).replace("hh",hh).replace("mm",mm).replace("ss",ss)};_.readyFun=function(){var uid;var isVoted=false;Lib.checkAuthor();if($isLogin)uid=$UID;else uid="0";var mycookie=swfAPI.getC(uid);if(mycookie){var cookielist=mycookie.split("|");for(var i=0;i<cookielist.length;i++){var onecookie=cookielist[i];if(onecookie==scope.$articleid){isVoted=true;break}}}if(!isVoted){Core.Events.addEvent("voteBtn",function(){var items=$T($E("voteViewContent"),"input");var selectedItems=[];for(var i=0;i<items.length;i++){var item=items[i];if(item.checked&&item.name&&item.name=="chb1"){selectedItems.push(i+1)}}if(selectedItems.length<1){winDialog.alert("请选择要投票的项！",{icon:"01"});return false}Lib.checkAuthor();if($isLogin)uid=$UID;else uid="0";function setFlashCookie(){try{var flashBar=Core.Dom.getElementsByClass($E("voter"),"div","vShape")[0];if(flashBar){flashBar.style.display=""}if(mycookie){if(cookielist.length>99){swfAPI.clearK(uid)}else mycookie=scope.$articleid+"|"+mycookie}else{mycookie=scope.$articleid}swfAPI.setC(uid,mycookie.toString())}catch(e){Debug.error("投票种flash cookie失败！错误原因："+e)}}this.flag=true;var selectedLen=selectedItems.length;new Interface("http://control.blog.sina.com.cn/admin/vote/shot_vote.php?version=7","ijax").request({POST:{blog_id:scope.$articleid,vote_checklist:selectedItems.join(",")},onSuccess:function(res){setFlashCookie();try{var btn=Core.Dom.getElementsByClass(document,"div","vBtn")[0];Core.Dom.removeParentNode($E("voteBtn"));btn.innerHTML='<span class="voteState">已投票</span>';clearAllInterval()}catch(error){}window.vote_count.total+=1;var spans=Core.Dom.getElementsByClass($E("voteViewContent"),"span","");var tempArr=[];for(var m=0;m<selectedLen;m++){var item=selectedItems[m];window.vote_count.detail[item-1]+=1;tempArr.push(spans[item-1].innerHTML)}var newItem={};newItem.uid=$UID;var time=(new Date).getTime();time/=1e3;time=Math.ceil(time);newItem.time=time;newItem.vote=tempArr;var tempResult=window.vote_interface_result;var tempRArr=[];for(var i=0;i<tempResult.length;i++){tempRArr[i+1]=tempResult[i]}tempRArr[0]=newItem;window.vote_interface_result=tempRArr;renderVoteNum();initLoginBar()},onError:function(res){try{winDialog.alert($SYSMSG[res.code]);if(res.code=="B00902"){var btn=Core.Dom.getElementsByClass(document,"div","vBtn")[0];Core.Dom.removeParentNode($E("voteBtn"));btn.innerHTML='<span class="voteState">投票已截止</span>';var voteItems=$N("chb1");for(var i=0;i<voteItems.length;i++){voteItems[i].disabled=true;try{voteItems[i].parentNode.childNodes[3].style.cursor="default"}catch(error){}}var flashBar=Core.Dom.getElementsByClass($E("voter"),"div","vShape")[0];if(flashBar){flashBar.style.display=""}}else if(res.code=="B00904"){if(!isVoted){setFlashCookie()}var btn=Core.Dom.getElementsByClass(document,"div","vBtn")[0];Core.Dom.removeParentNode($E("voteBtn"));btn.innerHTML='<span class="voteState">已投票</span>';var voteItems=$N("chb1");for(var i=0;i<voteItems.length;i++){voteItems[i].disabled=true;try{voteItems[i].parentNode.childNodes[3].style.cursor="default"}catch(error){}}}}catch(error){}}})},"click",false)}else{var btn=Core.Dom.getElementsByClass(document,"div","vBtn")[0];Core.Dom.removeParentNode($E("voteBtn"));btn.innerHTML='<span class="voteState">已投票</span>';var items=document.getElementsByName("chb1");for(var j=0;j<items.length;j++){items[j].disabled="true";try{if($IE){items[j].parentNode.childNodes[2].style.cursor="default"}else{items[j].parentNode.childNodes[3].style.cursor="default"}}catch(error){}}var flashBar=Core.Dom.getElementsByClass($E("voter"),"div","vShape")[0];if(flashBar){flashBar.style.display=""}}};_.swfAPI={setC:function(key,value){$E("swfId").setC(key,value)},getC:function(key){return $E("swfId").getC(key)},clearK:function(key){$E("swfId").clearK(key)},clearC:function(){$E("swfId").clearC()}};_.insertList=function(oResult){function getLocTime(nS){var date=new Date(nS*1e3);return date.getFullYear()+"-"+(date.getMonth()+1<10?"0"+(date.getMonth()+1):date.getMonth()+1)+"-"+date.getDate()+" "+date.getHours()+":"+(date.getMinutes()<10?"0"+date.getMinutes():date.getMinutes())}var tpl='<li><span class="SG_dot"></span><span class="txt"><a target="_blank" href="#{url}">#{nick}</a>#{userV}&nbsp;<span class="SG_txtb">投票给 #{vote}</span><em class="SG_txtc">#{time}</em></span></li>';var list="";var getVHTML=Lib.blogv.getVHTML;if(this.vote_interface_result){for(var i=0;i<vote_interface_result.length;i++){var item=vote_interface_result[i];var html=tpl;html=html.replace("#{url}","http://blog.sina.com.cn/u/"+item["uid"]);html=html.replace("#{nick}",oResult[item["uid"]]);html=html.replace("#{userV}",getVHTML(item["wtype"]));html=html.replace("#{time}",getLocTime(item["time"]));var con="";for(var j=0;j<item["vote"].length;j++){con+='"'+item["vote"][j]+'" '}html=html.replace("#{vote}",con);list+=html;if(i==10){break}}if($E("voterlist")){$E("voterlist").innerHTML=list}}};_.initLoginBar=function(){Lib.checkAuthor();if($E("vote_login_txt")){if($isLogin){$E("vote_login_txt").style.display="none"}else{$E("vote_login_txt").style.display="";$E("vote_login").onclick=function(){var trayLogin=new Lib.Login.Ui;trayLogin.login()}}}};_.initNewVote=function(){Lib.checkAuthor();if($E("voteAD")){$E("voteAD").innerHTML='<a class="SG_linka"><img height="15" align="top" width="15" class="SG_icon SG_icon33" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" title="投票"></a>&nbsp;<a target="_blank" href="http://control.blog.sina.com.cn/admin/article/article_add.php#voteadd">发起新投票</a>&nbsp;&nbsp;&nbsp;<a class="SG_linka"><img height="18" align="top" width="18" title="" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon110"></a>&nbsp;<a href="#" id="shareVote">分享此投票</a>';$E("shareVote").onclick=function(){var title=encodeURIComponent("分享投票："+$T($E("voter"),"span")[0].innerHTML+"——来自"+scope.owenerNickName+"的博文："+Core.Dom.byClz(document.body,"h2","titName")[0].innerHTML||""),r="新浪-博客",l="http://blog.sina.com.cn",u="http://v.t.sina.com.cn/share/share.php?searchPic=false&title="+title+"&url="+encodeURIComponent(document.location)+"&source="+r+"&sourceUrl="+encodeURIComponent(l)+"&content=utf-8&appkey=1617465124";window.open(u,"mb","toolbar=0,status=0,resizable=1,width=440,height=430,left="+(screen.width-440)/2+",top="+(screen.height-430)/2);return false}}var morevotediv=$E("cc_morevote");if(!morevotediv){morevotediv=$C("div");morevotediv.id="cc_morevote";morevotediv.className="voteapp_btnMore";morevotediv.innerHTML='<a href="http://control.blog.sina.com.cn/blogprofile/profilevote.php?type=1" target="blank" title="查看更多投票">查看更多投票&gt;&gt;</a><img class="SG_icon SG_icon11" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="新" align="absmiddle" />';$E("voterlist").parentNode.parentNode.appendChild(morevotediv)}};_.renderVoteNum=function(){var uidList=[];var result=window.vote_interface_result;for(var i=0;i<result.length;i++){var item=result[i];uidList[uidList.length]=item["uid"]}Lib.Uic.getNickName(uidList,insertList);this.initNewVote();var temp=$E("chb1");if(temp!=null&&temp.type=="radio"){window.vote_rc_type="radio"}else{window.vote_rc_type="checkbox"}this.valueContents=Core.Dom.getElementsByClass($E("voter"),"div","num");var total=0;voteValues=[];var k;var counts=window.vote_count.detail;var total=window.vote_count.total;$E("total").innerHTML=total+"人";var totalTickets=0;for(var j=0;j<counts.length;j++){totalTickets+=counts[j]}for(k=0;k<valueContents.length;k++){var itemVote=counts[k];if(totalTickets==0){var percent="0%"}else{if(Math.round(itemVote/totalTickets*100)>100){var percent="100%"}else{var percent=Math.round(itemVote/totalTickets*100)+"%"}}voteValues.push(percent);valueContents[k].innerHTML=itemVote+'<span class="SG_txtc">('+percent+")</span>"}renderProgress(voteValues)};_.renderProgress=function(voteValues){window.itvIds=[];var i;var valueBars=Core.Dom.getElementsByAttr($E("voter"),"name","voteResult");var valueContents=Core.Dom.getElementsByClass($E("voter"),"div","num");var percentW=[];for(i=0;i<valueContents.length;i++){/\((.*)\)/.test(valueContents[i].innerHTML);percentW[i]=RegExp.$1}for(i=0;i<valueBars.length;i++){valueBars[i].className="color c"+(i+1);valueBars[i].style.fontSize="8px";valueBars[i].style.width="0px";window.itvIds[i]=window.setInterval(function(idx){return function(){if(parseInt(valueBars[idx].style.width)<parseInt(percentW[idx])){valueBars[idx].style.width=parseInt(valueBars[idx].style.width,10)+1+"%"}else{window.clearInterval(itvIds[idx])}}}(i),10)}if(!this.rf)_.rf=new RenderFlash};_.clearAllInterval=function(){if(window.itvIds){for(var i=0;i<window.itvIds.length;i++){window.clearInterval(itvIds[i])}}}})(window);var voteNums=15,_CFG_ASTATUS=articleEditorCFG.articleStatus;if(_CFG_ASTATUS=="7"){_CFG_ASTATUS="3"}inputListen=function(el,nLen,oOption){el=$E(el);if(typeof nLen!="undefined"){nLen=isNaN(nLen)?null:nLen*1}if(el==null||nLen==null||el.nodeType!=1){return false}oOption=oOption||{};var limitRe=oOption.limitRe;var doubleByte=oOption.doubleByte;doubleByte=doubleByte==null?true:doubleByte;var userinput=function(){try{var evt=Core.Events.getEvent();if(evt){var keyCode=evt.which||evt.keyCode;if(keyCode==37||keyCode==39){return false}}}catch(e){}var nLength=el.max;while(limitRe!=null&&limitRe.test(el.value)){el.value=el.value.replace(limitRe,"")}if(doubleByte==true){if(Core.String.byteLength(el.value)>nLength){var str=el.value.substr(0,nLength);while(Core.String.byteLength(str)>nLength){str=str.replace(/.$/,"")}el.value=str;el.maxLength=str.length}else{el.maxLength=nLength-el.value.replace(/[\x00-\xff]/g,"").length}}else{el.maxLength=nLength}if(nLength<el.value){el.value=el.value.substr(0,nLength)}};var Blur=function(){if(limitRe!=null&&limitRe.test(el.value)){el.value=el.value.replace(limitRe,"")}};el.max=nLen;el.maxLength=nLen;userinput();if(el.beWatched==null){el.beWatched=true;if(!$IE){Core.Events.addEvent(el,userinput,"input")}else{Core.Events.addEvent(el,userinput,"keyup")}Core.Events.addEvent(el,Blur,"blur")}};var Vote=function(vData){if(typeof window.vote_modify=="undefined")window.vote_modify=false;window.itemNum;this.state="edit";if(typeof vData!="undefined"){window.itemNum=vData.items.length}else window.itemNum=5;$E("addVote").innerHTML=voteDom["build"];if(typeof vData=="undefined"){this._build()}else{this._save(vData)}return this};Vote.prototype._build=function(vData){this.setBlogVote("yes");window.vote_modify=true;var items=$N("voteData[]");var itemLen=items.length;this._panel=$E("voteItems");var _this=this;inputListen($E("voteTitle"),50);Core.Events.addEvent($E("voteTitle"),function(){$E("voteTitle").value=Core.String.trim($E("voteTitle").value.replace(/(<|>|\\|\/|&|'|")/g,""))},"blur");$E("voteItems").innerHTML="";if(typeof vData=="undefined"){window.itemNum=5;for(var i=0;i<5;i++){this._addItem()}$E("newOne").onclick=function(){for(var i=0;i<5;i++){if(window.itemNum>voteNums-1)return false;window.itemNum++;_this._addItem();if(window.itemNum>=voteNums)$E("newOne").style.display="none";_this.updateIndex()}return false;

};window.built=true;_this.initDate()}else{_this.setValue(vData);_this.setItems(vData);if((_CFG_ASTATUS=="2"||_CFG_ASTATUS=="3")&&!window.built){if(window.itemNum>=voteNums)$E("newOne").style.display="none";$E("newOne").onclick=function(){for(var i=0;i<5;i++){if(window.itemNum>voteNums-1)return false;window.itemNum++;_this._addItem();if(window.itemNum>=voteNums)$E("newOne").style.display="none";_this.updateIndex()}return false};window.built=true}}_this.updateIndex();$E("saveBtn").onclick=function(){if(Core.String.byteLength($E("voteTitle").value)==0){winDialog.alert($SYSMSG["B00909"],{icon:"01"});return false}if(Core.String.byteLength($E("voteTitle").value)<10){winDialog.alert($SYSMSG["B00905"],{icon:"01"});return false}var selectedDate=new Date($E("year").value,$E("month").value-1,$E("day").value,$E("hh").value,0,0);if(_this.expired(selectedDate,new Date)){winDialog.alert($SYSMSG["B00907"],{icon:"01"});return false}var _counter=0,_itemlist=[];for(var k=0;k<document.getElementsByName("voteData[]").length;k++){var item=document.getElementsByName("voteData[]")[k];if(item.value!=""){_itemlist.push(item.value);_counter++}}window.itemNum=_counter;if(_counter<2){winDialog.alert($SYSMSG["B00906"],{funcOk:function(){var inputs=$T($E("voteItems"),"input");for(var i=0;i<inputs.length;i++)if(inputs[i].value=="")inputs[i].focus()},icon:"01"});return false}var tempTitle=$E("voteTitle").value;trace(tempTitle+"----REPLACE TITLE TEMP");var et=$E("year").value+"-"+$E("month").value+"-"+$E("day").value+"-"+$E("hh").value;var vData={title:tempTitle,items:_itemlist,expireTime:et,type:$E("rad1").checked?1:$E("mutiple").value};_this.setBlogVote("yes");_this._save(vData);return false}};Vote.prototype.updateIndex=function(){if($E("chooseIndex")){var length=window.itemNum;var list="";for(var i=1;i<=length;i++){list+="<li>选项"+i+"</li>"}$E("chooseIndex").innerHTML=list}};Vote.prototype.initDate=function(){window.date=new DateSelector({dict:["year","month","day","hh"],to:"m-2",from:$E("timestamp").value})};Vote.prototype.setValue=function(vData){if(!window.vote_modify){window.vote_modify=true}$E("voteTitle").value=vData.title;if(_CFG_ASTATUS==2){$E("voteTitle").style.color="#999999"}var _t=vData["type"];if(_t>=2){$E("rad2").checked=true}else{$E("rad1").checked=true;$E("mutiple").style.display="none";$E("voteType").value=1}if(_CFG_ASTATUS=="2"&&articleEditorCFG.articlevData!=null){$E("voteTitle").readOnly="true";$E("voteTitle").readOnly="true";$E("voteTitle").style.backgroundAttachment="scroll";$E("voteTitle").style.backgroundColor="#E7E7E7";$E("voteTitle").style.backgroundImage="none";$E("voteTitle").style.backgroundPosition="0";$E("voteTitle").style.backgroundRepeat="repeat";$E("voteTitle").onkeydown=function(){if(event.keyCode==8)return false};$E("rad2").disabled=true;$E("rad1").disabled=true}if(_t>1){$E("mutiple").style.display="";$E("mutiple").options[_t-2].selected=true;if(_CFG_ASTATUS=="2")$E("mutiple").disabled=true;else if(_CFG_ASTATUS=="3")$E("mutiple").disabled=false;$E("voteType").value=$E("mutiple").value}if(_CFG_ASTATUS=="2"&&articleEditorCFG.articlevData!=null){var value=vData.votePos;if(value==1){$E("votePos1").checked=true;$E("votePos2").checked=false}else{$E("votePos1").checked=false;$E("votePos2").checked=true}}if(typeof date=="undefined"){window.date=new DateSelector({dict:["year","month","day","hh"],from:vData.startTime,to:"m-2"})}};Vote.prototype.setItems=function(vData){window.itemNum=vData.items.length;window.current=window.itemNum-1;if(window.itemNum<=5&&_CFG_ASTATUS==3){window.itemNum=5}for(var j=0;j<window.itemNum;j++){this._addItem(vData.items[j],"edit")}};Vote.prototype.toData=function(){var data={};var title=$E("voteTitle").value;if(!title||title==""){return null}data.title=title;var dateArray=[];dateArray.push($E("year").value);dateArray.push($E("month").value);dateArray.push($E("day").value);data.expireTime=dateArray.join("-")+" "+$E("hh").value;data.items=[];var itemsEle=$E("voteItems");var items=itemsEle.getElementsByTagName("input");var len=items.length;for(var i=0;i<len;i++){if(items[i].type=="text"){data.items.push(items[i].value)}}return data};Vote.prototype.compare=function(odata,eData){var eleData=eData||this.toData();if(window.vote_status!="new"){if(odata.expireTime==eleData.expireTime){if(odata.items.length==eleData.items.length){return true}}}return false};Vote.prototype.setBlogVote=function(value){var value=value||"yes";if($E("editorForm").blogVote){$E("editorForm").blogVote.value=value}};Vote.prototype.getBlogVote=function(){if($E("editorForm").blogVote){return $E("editorForm").blogVote.value}return false};Vote.prototype._addItem=function(itemValue,type){var lis=this._panel.getElementsByTagName("li");var _this=this;var oneItem=$C("li");this._panel.appendChild(oneItem);oneItem.innerHTML=voteDom["newItem"].format("delItem-"+parseInt(Math.random()*899999+1e5));var oneInput=oneItem.getElementsByTagName("input")[0];var oneDel=oneItem.getElementsByTagName("a")[0];inputListen(oneInput,40);if(typeof itemValue!="undefined"){oneInput.value=itemValue}if(type=="edit"){oneInput.style.color="#999999"}oneInput.onblur=function(){this.value=this.value.replace(/(<|>|\\|\/|&|'|")/gi,"")};if(_CFG_ASTATUS=="2"&&articleEditorCFG.articlevData!=null){var oldNum=articleEditorCFG.articlevData?articleEditorCFG.articlevData.items.length:2;trace("window.current "+window.current);if(typeof window.current=="undefined"){window.current=0}if(window.itemNum-window.current>oldNum){Core.Events.addEvent(oneDel,function(){if(window.itemNum<=2){return false}window.itemNum--;if(window.itemNum<voteNums){trace(window.itemNum);$E("newOne").style.display=""}Core.Dom.removeNode(this.parentNode);_this.updateIndex()}.bind2(oneDel),"click")}else{if(articleEditorCFG.articlevData!=null){oneInput.readOnly="true";oneInput.style.backgroundAttachment="scroll";oneInput.style.backgroundColor="#E7E7E7";oneInput.style.backgroundImage="none";oneInput.style.backgroundPosition="0";oneInput.style.backgroundRepeat="repeat";oneInput.onkeydown=function(){if(event.keyCode==8)return false};oneDel.style.display="none"}}window.current--}else{Core.Events.addEvent(oneDel,function(){if(window.itemNum<=2){try{this.parentNode.childNodes[0].value=""}catch(error){}return false}window.itemNum--;if(window.itemNum<voteNums){$E("newOne").style.display=""}Core.Dom.removeNode(this.parentNode);_this.updateIndex()}.bind2(oneDel),"click")}return false};Vote.prototype._save=function(vData){if(!window.vote_modify){trace("----ACCESS IN NOEDIT----");this.setBlogVote("noedit")}trace("393 rows:"+this.getBlogVote());$E("newStatus").style.display="none";$E("saveStatus").style.display="block";$E("saveStatus").innerHTML=voteDom["saveItem"].format("投票："+vData.title);var str=new Core.String.StringBuffer;trace(vData.items.length+"----ITEM SAVE");var tempData=[];for(var index=0;index<vData.items.length;index++){if(vData.items[index]!=""){tempData.push(vData.items[index])}}vData.items=[];vData.items=tempData;trace(vData.items.length+"----OPER LENGTH");if($E("newStatus").style.display!="none"&&$E("rad1").checked||vData.type<2){for(var j=0;j<vData.items.length;j++){if(j<2){str.append("<span><input type='radio' id='rdx_"+j+"' name='rdxs' disabled/>");str.append("<label for='rdx_"+j+"'>"+Core.String.leftB(vData.items[j],20)+(Core.String.byteLength(vData.items[j])>20?"...":"")+"</label>");str.append("</span>")}else{str.append("<span>");str.append("&nbsp;...");str.append("</span>");break}}}else{var mutipleNum=vData.type;for(var j=0;j<vData.items.length;j++){if(j<2){str.append("<span><input type='checkbox' id='rdx_"+j+"' name='rdxs' disabled/>");str.append("<label for='rdx_"+j+"'>"+Core.String.leftB(vData.items[j],20)+(vData.items[j].length>20?"...":"")+"</label>");str.append("</span>")}else{str.append("<span>");str.append("&nbsp;...");str.append("</span>");break}}}$E("voteArea").innerHTML=str.toString();this.state="saved";Core.Events.addEvent("editBtn",function(){this._edit(vData);if(window.itemNum<voteNums){$E("saveBtn").style.display=""}}.bind2(this),"click",false);var isBefore=false;if(articleEditorCFG.articlevData!=null){var tArr=articleEditorCFG.articlevData.expireTime.split(" ");var dateArr=tArr[0].split("-");var expireFlag=new Date(dateArr[0],parseInt(trimHeadZero(dateArr[1]))-1,dateArr[2],tArr[1],0,0);isBefore=this.expired(expireFlag,new Date)}if(_CFG_ASTATUS=="3"&&!window.built){trace("----FIRE EVENT----");Core.Events.fireEvent("editBtn","click")}else if(isBefore&&_CFG_ASTATUS!="3"){$E("editBtn").style.display="none";$E("vote_expired").innerHTML+="(已过期)"}return false};Vote.prototype._edit=function(vData){this.setBlogVote("yes");this.state="edit";$E("newStatus").style.display="";$E("saveStatus").style.display="none";if(articleEditorCFG.articlevData!=null){$E("voteId").value=1}if(typeof vData!="undefined")this._build(vData)};Vote.prototype.show=function(){if($E("addVote").style.display=="none")$E("addVote").style.display=""};Vote.prototype.expired=function(date1,date2){trace(date1+" "+date2);return date1.getTime()-date2.getTime()<0};window.changeType=function(flag){if(flag){$E("voteType").value=2;$E("mutiple").style.display="inline"}else{$E("voteType").value=1;$E("mutiple").style.display="none"}};$registJob("init_right_menu",function(){window.editorTabs=new Editor.Plugins.EditorTabs("addWrap");var shortMenu=new Editor.Plugins.RightMenu("shortcut","shortcut_content");window.activity=new Editor.Plugins.Activity;activity.addToMenuFunc(shortMenu.addItem.bind2(shortMenu));activity.addTabFunc(initActivity);shortMenu.addItem("http://simg.sinajs.cn/blog7style/images/common/editor/element_music.gif","插入音乐",initRM);shortMenu.addItem("http://simg.sinajs.cn/blog7style/images/common/editor/element_vote.gif","插入投票",initVote);shortMenu.addItem("http://simg.sinajs.cn/blog7style/images/common/editor/element_finance.gif","股票走势",initStock);shortMenu.addItem("http://simg.sinajs.cn/blog7style/images/common/editor/element_artical.gif","相关博文",initArticle);shortMenu.addItem("http://simg.sinajs.cn/blog7style/images/common/editor/element_tblog.gif","微博条目",initMb);shortMenu.addItem("http://simg.sinajs.cn/blog7style/images/common/editor/typeset_module.gif","插入模板",initTemplate);if(scope.$user_channel&&scope.$user_channel==2){if(!window.insertYuerProgressbar){window.insertYuerProgressbar=new Editor.Plugins.InsertYuerProgressbar}shortMenu.addItem("http://simg.sinajs.cn/blog7style/images/common/editor/element_baby.gif","宝宝生日",initYuerProgressbar)}shortMenu.initSwap([{title:"insert_template",content:"insert_template_content"}]);function initArticle(){initTabs();editorTabs.addTab({name:"article",title:"相关博文",contentId:"article_associate"});if(!window.articleAssociate){window.articleAssociate=new Editor.Plugins.ArticleAssociate("article_associate",articleEditorCFG.articleStatus);window.articleAssociate.initList();editorTabs.addCloseCallbackFunc("article",articleAssociate.del.bind2(articleAssociate))}}function initVote(){initTabs();editorTabs.addTab({name:"vote",title:"投票",contentId:"addVote",callVote:{remove:removeVote,show:showVote}});if(!window.insertVote){window.insertVote=new Vote;window.vote_status="new"}}function initActivity(){if(!$E("tab_content_activity")){Core.Dom.insertHTML($E("article_associate"),"<div class='myActive' id='tab_content_activity'></div>","AfterEnd")}initTabs();editorTabs.addTab({name:"activity",title:"征文活动",contentId:"tab_content_activity"});if(activity.state!="finish"){editorTabs.addCloseCallbackFunc("activity",activity.del.bind2(activity))}activity.setConHtml("tab_content_activity")}function initStock(){window.editor.blur();if(!window.insertStock){window.isertStockIsReady=function(){if(window.insertStock){return true}else{return false}};window.insertStock=new Editor.Plugins.InsertStock}else{window.insertStock.setTopView();window.insertStock.show()}}function initQuiz(){if(!window.insertQuiz){var html=' <embed width="450" height="258" align="middle" pluginspage="http://www.adobe.com/go/getflashplayer" type="application/x-shockwave-flash" wmode="transparent" allowscriptaccess="samedomain" name="sharepad" bgcolor="#FFFFFF" quality="high" src="http://cache.mars.sina.com.cn/nd/allvic//200903widget/b5/63/20090526143908-1-68711.swf"/>';window.insertQuiz=new Editor.Plugins.InsertOther(html)}window.insertQuiz.insert()}function initMb(){if(!window.insertMb){window.insertMb=new Editor.Plugins.InsertMB}window.insertMb.show()}function initTemplate(){if(!window.insertTemplate){window.insertTemplate=new Editor.Plugins.InsertTemplate}window.insertTemplate.show()}function initYuerProgressbar(){window.insertYuerProgressbar.show()}function initRM(){if(!window.inserMusic){window.inserMusic=new Editor.Plugins.MusicMain}window.inserMusic.show()}function initTabs(){if(!editorTabs.isShow){editorTabs.show()}if(window.location.href.indexOf("#addWra")==-1){window.location.href+="#addWrap"}else{window.location.href=window.location.href}}var location=window.location.toString();if(location.indexOf("#voteadd")>0){initVote();window.location.href=window.location.href.replace("#voteadd","");trace(window.location.href)}});$registJob("editor_articlecate",function(){window.ArticleCateFuncs={reloadCate:function(aCateList){var selectElementNode=$E("componentSelect");selectElementNode.options.length=0;selectElementNode.options.add(new Option("默认分类",1));for(var i=0;i<aCateList.length;i++){selectElementNode.options.add(new Option(aCateList[i].label,aCateList[i].value))}if($E("xRankRadio"))selectElementNode.options.add(new Option("私密博文",0));if($E("xRankRadio")&&!$E("xRankRadio").checked){selectElementNode.selectedIndex=selectElementNode.length-2}else{selectElementNode.selectedIndex=selectElementNode.length-1}CateDialog.setCloseEvent(true);CateDialog.hidden()}}});$SYSMSG.extend({B00007:"跳转到自动开通页",B00008:"自动开通用户(跳转到假页)",B00009:"跳转到自动开通页",B00010:"无权限。 ",B00011:"抱歉，Blog ID 错误，操作无法完成。",B00012:"抱歉，可能因为重复操作而无法执行，请刷新本页再试。",B00013:"用户ID被封杀",B00014:"很抱歉，您输入的验证码不正确。",B04101:"请输入您的昵称！",B04102:"请正确输入您的邮件地址！",B04103:"请选择您举报信息的位置！",B04104:"请选择您举报的不良信息的类型！",B04105:"简单描述最多只能输入500个字符！",B04106:"再次感谢您帮助我们进行不良信息的验证工作，我们将认真仔细地处理您提交的内容。",B07006:"您已发的博文正在审查中，请稍后再发文"});Core.System.winSize=function(_target){var w,h;if(_target){target=_target.document}else{target=document}if(self.innerHeight){if(_target){target=_target.self}else{target=self}w=target.innerWidth;h=target.innerHeight}else if(target.documentElement&&target.documentElement.clientHeight){w=target.documentElement.clientWidth;h=target.documentElement.clientHeight}else if(target.body){w=target.body.clientWidth;h=target.body.clientHeight}return{width:w,height:h}};var Layer=function(template){this.entity=null;this.ifm=null;var _this=this;var Property={width:0,height:0,x:0,y:0,isFixed:false,uniqueID:"",entityID:"",contentID:"",template:template,templateString:"",nodes:{}};this.getProperty=function(){return Property};(function initialize(){var p=_this.getProperty();p.uniqueID="_"+_this.getUniqueID();p.entityID=p.uniqueID+"_entity";p.contentID=p.uniqueID+"_content";_this.setTemplate(p.template);p.width=parseInt(_this.entity.style.width);if($IE6){_this.addIframe()}document.body.appendChild(_this.entity);_this.hidden()})();this._ie6Fixed=function(){_this.entity.style.left=document.documentElement.scrollLeft+_this.getProperty().x+"px";_this.entity.style.top=document.documentElement.scrollTop+_this.getProperty().y+"px";if(_this.ifm){_this.ifm.style.left=document.documentElement.scrollLeft+_this.getProperty().x+"px";_this.ifm.style.top=document.documentElement.scrollTop+_this.getProperty().y+"px"}}};Layer.prototype={setTemplate:function(template){var p=this.getProperty();if(this.entity){this.entity.parentNode.removeChild(this.entity);this.entity=null}if(typeof template=="object"){p.nodes=template;if(this.entity){this.entity.parentNode.removeChild(this.entity);this.entity=null}this.entity=p.nodes.entity;document.body.appendChild(this.entity);if(!p.nodes.entity||!p.nodes.content){throw new Error("[layer.js] missing entity or content in layer nodes")}else{this.entity.style.position="absolute";this.entity.style.zIndex="1024";this.entity.style.left=p.x+"px";this.entity.style.top=p.y+"px"}return}var pattern=/[^\{\}]+(?=\})/g;p.template=template;p.templateString=p.template.match(pattern);this.entity=$C("div");var tempEntity=$C("div");var tmp=new Ui.Template(p.template);tempEntity.innerHTML=tmp.evaluate(this.getNodes("i"));document.body.appendChild(tempEntity);if(!$E(p.entityID)||!$E(p.contentID)){throw new Error("[layer.js] there missing #{entityID} or #{contentID} in layer template")}else{this.entity=$E(p.entityID);this.entity.style.position="absolute";this.entity.style.zIndex="1024";this.entity.style.left=p.x+"px";this.entity.style.top=p.y+"px";document.body.replaceChild(this.entity,tempEntity);tempEntity=null}p.nodes=this.getNodes()},setSize:function(opts){var p=this.getProperty();Core.System.parseParam(p,opts);if(opts.width){p.nodes.content.style.width=p.width+"px"}if(opts.height){p.nodes.content.style.height=p.height+"px"}this.updateIfmSize()},setPosition:function(opts){var p=this.getProperty();Core.System.parseParam(p,opts);this.entity.style.left=p.x+"px";this.entity.style.top=p.y+"px";if($IE6&&p.isFixed){this.entity.style.left=p.x+document.documentElement.scrollLeft+"px";this.entity.style.top=p.y+document.documentElement.scrollTop+"px"}if(this.ifm){this.ifm.style.left=this.entity.style.left;this.ifm.style.top=this.entity.style.top}},getWidth:function(){var ld=this.entity.style.display;var lv=this.entity.style.visibility;this.entity.style.visibility="hidden";this.entity.style.display="";w=this.entity.offsetWidth;this.entity.style.display=ld;this.entity.style.visibility=lv;return w},getHeight:function(){var ld=this.entity.style.display;var lv=this.entity.style.visibility;this.entity.style.visibility="hidden";this.entity.style.display="";h=this.entity.offsetHeight;this.entity.style.display=ld;this.entity.style.visibility=lv;return h},getX:function(){return parseInt(this.entity.style.left)},getY:function(){return parseInt(this.entity.style.top)},updateIfmSize:function(){if(this.ifm){var _this=this;_this.ifm.style.width=_this.entity.offsetWidth+"px";_this.ifm.style.height=_this.entity.offsetHeight+"px"}},setFixed:function(isFixed){var p=this.getProperty();p.isFixed=isFixed;var _this=this;if($IE6){_this.entity.style.position="absolute";if(p.isFixed){_this._ie6Fixed();Core.Events.addEvent(window,_this._ie6Fixed,"scroll")}else{Core.Events.removeEvent(window,_this._ie6Fixed,"scroll")}return}if(p.isFixed&&$FF2){_this.updateFixed();return}this.entity.style.position=p.isFixed?"fixed":"absolute"},updateFixed:function(){var p=this.getProperty();if(p.isFixed&&$FF2){var _this=this;var lastX=p.x,lastY=p.y;_this.entity.style.position="absolute";_this.setPosition({x:p.x+document.documentElement.scrollLeft,y:p.y+document.documentElement.scrollTop});_this.entity.style.position="fixed";_this.setPosition({x:lastX,y:lastY})}},show:function(){this.entity.style.display="";if(this.ifm){this.ifm.style.display="";this.updateIfmSize()}},hidden:function(){this.entity.style.display="none";if(this.ifm){this.ifm.style.display="none"}},addIframe:function(){this.ifm=$C("iframe");this.ifm.style.position="absolute";this.ifm.style.zIndex="1024";this.ifm.style.left=this.entity.style.left;this.ifm.style.top=this.entity.style.top;document.body.appendChild(this.ifm);Core.Dom.setStyle(this.ifm,"opacity",0)},getNodes:function(mode){var p=this.getProperty();var m=mode||"o";var i;var nodes={};var result=p.templateString;if(result){for(i=0;i<result.length;i++){var r=result[i];switch(m){case"o":nodes[r]=$E(p.uniqueID+"_"+r);break;case"i":nodes[r]=p.uniqueID+"_"+r;break}}}return"entity"in nodes?nodes:p.nodes},getUniqueID:function(){return parseInt(Math.random()*1e4).toString()+(new Date).getTime().toString()},setContent:function(sHTML){var p=this.getProperty();if(sHTML){p.nodes.content.innerHTML=sHTML}}};var DialogDisplaySet={alpha1:{show:function(dom,offsetY,callBack){var v=0,deltaY=0,startY=parseInt(dom.style.top)-offsetY;dom.style.top=startY;Core.Dom.setStyle(dom,"opacity",v);dom.style.display="";var itvId=window.setInterval(function(){if(v<=1){Core.Dom.setStyle(dom,"opacity",v)}if(deltaY<=startY+offsetY){dom.style.top=startY+deltaY+"px"}deltaY+=1.5;v+=.05;if(v>.9&&parseInt(dom.style.top)>=startY+offsetY){window.clearInterval(itvId);if(callBack){callBack()}}},10)},hidden:function(dom,offsetY,callBack){var v=1;var startY=parseInt(dom.style.top);var endY=startY-offsetY;var currentY=startY;var itvId=window.setInterval(function(){if(v>=0){Core.Dom.setStyle(dom,"opacity",v)}if(currentY>=endY){dom.style.top=currentY+"px"}currentY-=1.5;v-=.05;if(v<=0&&currentY<endY){window.clearInterval(itvId);if(callBack){callBack()}}},10)}},alpha:{show:function(dom,offsetY,callBack){Core.Dom.setStyle(dom,"opacity",.3);dom.style.display="";dom.style.top=parseInt(dom.style.top)-offsetY+"px";var y1=parseInt(dom.style.top)+offsetY;Ui.tween(dom,["top","opacity"],[y1,.9],.4,"simple",{end:callBack})},hidden:function(dom,offsetY,callBack){var y1=parseInt(dom.style.top)-offsetY;Ui.tween(dom,["top","opacity"],[y1,0],.2,"simple",{end:callBack})}},fallDown:{show:function(dom,y0,y1,callBack){dom.style.display="";dom.style.top=y0+"px";Ui.tween(dom,"top",y1,.6,"bounceEaseOut",{end:callBack})},hidden:function(dom,y0,y1,callBack){dom.style.display="";dom.style.top=y0+"px";Ui.tween(dom,"top",y1,.6,"strongEaseIn",{end:callBack})}}};var Drag3=function(beDragObj,movedObjs,dragMode){var _this=this;this.beDragObj=beDragObj;this.movedObjs=movedObjs||this.beDragObj;this.dragMode=dragMode||"normal";this.canDrag=true;this.isLock=false;this.lockArea={left:0,right:0,top:0,bottom:0};this.dragSet={normal:function(){_this.normalDrag()},border:function(){_this.borderDrag()},opacity:function(){_this.opacityDrag()}};this.dragObjsFunc=function(){_this.onDrag();_this.dragObjs()};(function initialize(){_this.beDragObj.style.MozUserSelect="none";Core.Events.addEvent(_this.beDragObj,function(){return false},"selectstart");Core.Events.addEvent(_this.beDragObj,function(){return false},"drag");for(var i=0;i<_this.movedObjs.length;i++){if(_this.movedObjs[i]!=_this.beDragObj){_this.movedObjs[i].style.position="absolute";if(!_this.movedObjs[i].style.left){_this.movedObjs[i].style.left=_this.movedObjs[i].offsetLeft+"px"}if(!_this.movedObjs[i].style.top){_this.movedObjs[i].style.top=_this.movedObjs[i].offsetTop+"px"}}}Core.Events.addEvent(_this.beDragObj,_this.dragSet[_this.dragMode],"mousedown");if($IE){Core.Events.addEvent(_this.beDragObj,function(){Core.Events.removeEvent(_this.beDragObj,_this.dragObjsFunc,"mousemove");_this.beDragObj.releaseCapture();_this.onDragEnd()},"mouseup")}else{Core.Events.addEvent(document,function(){Core.Events.removeEvent(document,_this.dragObjsFunc,"mousemove");_this.onDragEnd()},"mouseup")}})()};Drag3.prototype={capture:function(){this.canDrag=true},release:function(){this.canDrag=false},onDragStart:function(){},onDrag:function(){},onDragEnd:function(){},dragObjs:function(){e=Core.Events.getEvent();for(var i=0;i<this.movedObjs.length;i++){if(this.isLock){if(e.clientX-this.movedObjs[i].deltaX<this.lockArea.left){this.movedObjs[i].style.left=this.lockArea.left+"px"}else{if(e.clientX-this.movedObjs[i].deltaX>this.lockArea.right-this.movedObjs[i].offsetWidth){this.movedObjs[i].style.left=this.lockArea.right-this.movedObjs[i].offsetWidth+"px"}else{this.movedObjs[i].style.left=e.clientX-this.movedObjs[i].deltaX+"px"}}if(e.clientY-this.movedObjs[i].deltaY<this.lockArea.top){this.movedObjs[i].style.top=this.lockArea.top+"px"}else{if(e.clientY-this.movedObjs[i].deltaY>this.lockArea.bottom-this.movedObjs[i].offsetHeight){this.movedObjs[i].style.top=this.lockArea.bottom-this.movedObjs[i].offsetHeight+"px"}else{this.movedObjs[i].style.top=e.clientY-this.movedObjs[i].deltaY+"px"}}}else{this.movedObjs[i].style.left=e.clientX-this.movedObjs[i].deltaX+"px";this.movedObjs[i].style.top=e.clientY-this.movedObjs[i].deltaY+"px"}}},normalDrag:function(){var _this=this;e=Core.Events.getEvent();for(var i=0;i<_this.movedObjs.length;i++){_this.movedObjs[i].deltaX=e.clientX-parseInt(_this.movedObjs[i].style.left);_this.movedObjs[i].deltaY=e.clientY-parseInt(_this.movedObjs[i].style.top)}if(_this.canDrag){if($IE){_this.beDragObj.setCapture();Core.Events.addEvent(_this.beDragObj,_this.dragObjsFunc,"mousemove")}else{Core.Events.addEvent(document,_this.dragObjsFunc,"mousemove")}}_this.onDragStart()},borderDrag:function(obj,borderWidth){},opacityDrag:function(obj,opacityValue){}};Ui.Drag3=Drag3;var Dialog=function(template){var _this=this;_this.entity=null;_this.ifm=null;var Property={id:"",x:0,y:0,width:0,height:0,isFixed:false,layer:new Layer(template),template:template,canDrag:false,dragEntity:null,name:"",uniqueID:"",isShow:false,nodes:{},focusNode:null,displayMode:"normal",_modeDisplayRuning:false,enabled:true};this.getProperty=function(){return Property};(function initialize(){var p=_this.getProperty();var i;p.uniqueID=p.layer.getProperty().uniqueID;p.id=p.uniqueID+"_dialog";p.nodes=_this.getNodes();_this.entity=p.layer.entity;_this.ifm=p.layer.ifm;p.width=parseInt(_this.entity.style.width);if(p.nodes.titleBar){p.dragEntity=new Ui.Drag3(p.nodes.titleBar,_this.ifm?[_this.ifm,_this.entity]:[_this.entity]);p.nodes.titleBar.style.cursor="move";Core.Events.addEvent(p.nodes.titleBar,function(){return false},"selectstart");p.dragEntity.onDrag=function(){_this.onDrag()}}Core.Events.addEvent(window,function(){if(p.isShow&&p.isFixed){var win=Core.System.winSize();var _x=win.width/2-_this.getWidth()/2;var _y=win.height/2-_this.getHeight()/2;_x=_x<0?0:_x;_y=_y<0?0:_y;_this.setPosition({x:_x,y:_y})}},"resize")})()};Dialog.prototype={setPosition:function(opts){var p=this.getProperty();Core.System.parseParam(p,opts);this.getProperty().layer.setPosition(opts)},setSize:function(opts){var p=this.getProperty();Core.System.parseParam(p,opts);p.layer.setSize(opts)},setFixed:function(isFixed){var p=this.getProperty();p.isFixed=isFixed;this.getProperty().layer.setFixed(p.isFixed)},setContent:function(sHTML){var p=this.getProperty();this.getProperty().layer.setContent(sHTML)},setTemplate:function(template){var p=this.getProperty();p.template=template;p.layer.setTemplate(p.template)},setDrag:function(canDrag){var p=this.getProperty();p.canDrag=canDrag;if(p.canDrag){p.dragEntity.capture()}else{p.dragEntity.release()}},getWidth:function(){return this.getProperty().layer.getWidth()},getHeight:function(){return this.getProperty().layer.getHeight()},getX:function(){return this.getProperty().layer.getX()},getY:function(){return this.getProperty().layer.getY()},show:function(mode){var p=this.getProperty();var _this=this;p.isShow=true;if(this.ifm){this.ifm.style.display=""}this.onShow();if(p.displayMode=="normal"||mode=="normal"){this.entity.style.display=""}else{p._modeDisplayRuning=true;p.enabled=false;this._showWithMode(function(){p._modeDisplayRuning=false;p.enabled=true;if(_this.onDisplaied){_this.onDisplaied()}})}},close:function(mode){var _this=this;var p=this.getProperty();if(p.displayMode=="normal"||mode=="normal"){p.isShow=false;p.layer.hidden();this.destroy();this.onClose();if(_this.onDisplayFinished){_this.onDisplayFinished()}}else if(!p._modeDisplayRuning){p._modeDisplayRuning=true;p.enabled=false;this._hiddenWithMode(function(){p.isShow=false;p.layer.hidden();p._modeDisplayRuning=false;p.enabled=true;_this.destroy();_this.onClose();if(_this.onDisplayFinished){_this.onDisplayFinished()}})}},hidden:function(mode){var _this=this;var p=this.getProperty();if(p.displayMode=="normal"||mode=="normal"){p.isShow=false;p.layer.hidden();this.onHidden();if(_this.onDisplayFinished){_this.onDisplayFinished()}}else if(!p._modeDisplayRuning){p._modeDisplayRuning=true;p.enabled=false;this._hiddenWithMode(function(){p.isShow=false;p.layer.hidden();_this.onHidden();p._modeDisplayRuning=false;p.enabled=true;if(_this.onDisplayFinished){_this.onDisplayFinished()}})}},_showWithMode:function(callBack){var p=this.getProperty();var win=Core.System.winSize();var _this=this;switch(p.displayMode){case"alpha":DialogDisplaySet["alpha"].show(this.entity,20,callBack);break}},_hiddenWithMode:function(callBack){var p=this.getProperty();var _this=this;var win=Core.System.winSize();switch(p.displayMode){case"alpha":DialogDisplaySet["alpha"].hidden(this.entity,20,callBack);break}},destroy:function(){try{if(this.getProperty().nodes.iframe){this.getProperty().nodes.iframe.src=""}}catch(ex){}this.entity&&this.entity.parentNode.removeChild(this.entity);this.entity=null;if(this.ifm){this.ifm.parentNode.removeChild(this.ifm);this.ifm=null}},onShow:function(){},onClose:function(){},onHidden:function(){},onDrag:function(){},onDisplaied:function(){},onDisplayFinished:function(){},setAreaLocked:function(state){var p=this.getProperty();p.dragEntity.isLock=state;var _this=this;if(state){_this._updateLockArea();Core.Events.addEvent(window,function(){_this._updateLockArea()},"resize")}},_updateLockArea:function(){var p=this.getProperty();var win=Core.System.winSize();if(p.isFixed){if($IE6){p.dragEntity.lockArea={left:document.documentElement.scrollLeft,right:document.documentElement.scrollLeft+win.width,top:document.documentElement.scrollTop,bottom:document.documentElement.scrollTop+win.height};Core.Events.addEvent(window,function(){p.dragEntity.lockArea={left:document.documentElement.scrollLeft,right:document.documentElement.scrollLeft+win.width,top:document.documentElement.scrollTop,bottom:document.documentElement.scrollTop+win.height}},"scroll");Core.Events.addEvent(window,function(){p.dragEntity.lockArea={left:document.documentElement.scrollLeft,right:document.documentElement.scrollLeft+win.width,top:document.documentElement.scrollTop,bottom:document.documentElement.scrollTop+win.height}},"resize")}else{p.dragEntity.lockArea={left:0,right:win.width,top:0,bottom:win.height}}}else{p.dragEntity.lockArea={left:0,right:document.documentElement.scrollWidth,top:0,bottom:document.documentElement.scrollHeight}}},updateFixed:function(){this.getProperty().layer.updateFixed()},getNodes:function(mode){return this.getProperty().layer.getNodes(mode)},setFocus:function(){var p=this.getProperty();if(p.focusNode&&p.focusNode.style.display!="none"){try{p.focusNode.focus()}catch(ex){}}else if(this.entity.style.display!="none"){this.entity.focus()}},getUniqueID:function(){return this.getProperty().layer.getUniqueID()}};var DialogManager={dialogs:[],activeDialog:{},backShadow:null,create:function(tpl,name){var _this=this;var dialog=new Dialog(tpl);this.dialogs.push(dialog);this.activeDialog=dialog;dialog.name=name||dialog.getUniqueID();dialog.entity.style.zIndex=1024;dialog.onDrag=function(){if($IE6){if(this.getProperty().isFixed){this.setPosition({x:parseInt(this.entity.style.left)-document.documentElement.scrollLeft,y:parseInt(this.entity.style.top)-document.documentElement.scrollTop})}}else{if(this.getProperty().isFixed){this.setPosition({x:parseInt(this.entity.style.left),y:parseInt(this.entity.style.top)})}}};dialog.onClose=function(){_this.removeDialog(this.name);_this.updateActiveDialog();_this.updateShadow();if(_this.activeDialog){_this.activeDialog.setFocus()}};dialog.onHidden=function(){this.isHidden=true;if(this==_this.activeDialog){_this.activeDialog=null}_this.updateActiveDialog();_this.updateShadow();if(_this.activeDialog){_this.activeDialog.setFocus()}};dialog.onShow=function(){if(this.isHidden){this.isHidden=false;var i,len=_this.dialogs.length;for(i=0;i<len;i++){if(_this.dialogs[i]==this){document.body.appendChild(_this.dialogs[i].entity);_this.dialogs.push(_this.dialogs[i]);_this.dialogs.splice(i,1)}}_this.activeDialog=this;_this.backShadow.show();_this.updateShadow()}};if(this.backShadow.isShow){this.updateShadow()}else{this.backShadow.show()}dialog.hidden();return dialog},getDialog:function(name){var i=0,len=this.dialogs.length;for(i=0;i<len;i++){if(this.dialogs[i].name==name){return this.dialogs[i]}}},removeDialog:function(name){var i=0,len=this.dialogs.length;for(i=len-1;i>=0;i--){if(this.dialogs[i].name==name){this.dialogs.splice(i,1);this.activeDialog=this.dialogs[this.dialogs.length-1];

break}}},updateActiveDialog:function(){var i,len=this.dialogs.length;for(i=len-1;i>=0;i--){if(!this.dialogs[i].isHidden){this.activeDialog=this.dialogs[i];break}}},updateShadow:function(){if(this.activeDialog&&!this.activeDialog.isHidden){this.backShadow.insertBefore(this.activeDialog.entity);this.activeDialog.updateFixed()}else{this.backShadow.hidden()}},close:function(name){if(!name){if(this.activeDialog){this.activeDialog.close()}return}var i,len=this.dialogs.length;for(i=len-1;i>=0;i--){if(this.dialogs[i].name==name){this.dialogs[i].close();break}}}};var BackShadow=function(opacity){this.entity=null;this.isShow=false;this._ie6Fixed=function(){if(_this.entity){_this.entity.style.top=document.documentElement.scrollTop+"px";_this.entity.style.left=document.documentElement.scrollLeft+"px";if(_this.ifm){_this.ifm.style.top=_this.entity.style.top;_this.ifm.style.left=_this.entity.style.left}_this.updateSize()}};var _this=this;(function initialize(){_this.entity=$C("div");_this.entity.style.position="absolute";_this.entity.style.width=_this.getAreaWidth()+"px";_this.entity.style.height=_this.getAreaHeight()+"px";_this.entity.style.left="0px";_this.entity.style.top="0px";_this.entity.style.zIndex=1024;_this.entity.style.backgroundColor="black";document.body.appendChild(_this.entity);_this._setOpacity(_this.entity,isNaN(opacity)?.5:opacity);if($IE6){_this.entity.style.top=document.documentElement.scrollTop+"px";_this.addIframe()}Core.Events.addEvent(window,function(){if(_this.entity){if($IE6&&_this.isShow){document.documentElement.scrollLeft=0;_this._ie6Fixed()}setTimeout(function(){_this.updateSize()},1)}},"resize");_this.setFixed(true);_this.hidden()})()};BackShadow.prototype={show:function(){this.entity.style.display="";if(this.ifm){this.ifm.style.display=""}this.isShow=true;this.onShow()},hidden:function(){this.entity.style.display="none";if(this.ifm){this.ifm.style.display="none"}this.isShow=false;this.onHidden()},close:function(){this.hidden();this.destroy()},destroy:function(){Core.Events.removeEvent(window,this._ie6Fixed,"scroll");this.entity.parentNode.removeChild(this.entity);this.entity=null;if(this.ifm){this.ifm.parentNode.removeChild(this.ifm);this.ifm=null}},addIframe:function(){this.ifm=$C("iframe");this._setOpacity(this.ifm,0);this.ifm.style.position="absolute";this.ifm.style.zIndex=this.entity.style.zIndex;this.ifm.style.left=this.entity.style.left;this.ifm.style.top=this.entity.style.top;this.ifm.style.width=this.entity.style.width;this.ifm.style.height=this.entity.style.height;document.body.insertBefore(this.ifm,this.entity)},insertBefore:function(obj){document.body.insertBefore(this.entity,obj);if(this.ifm){document.body.insertBefore(this.ifm,this.entity)}},updateSize:function(){this.entity.style.width=this.getAreaWidth()+"px";this.entity.style.height=this.getAreaHeight()+"px";if(this.ifm){this.ifm.style.width=this.getAreaWidth()+"px";this.ifm.style.height=this.getAreaHeight()+"px"}},getAreaHeight:function(){return document.documentElement.clientHeight},getAreaWidth:function(){return document.documentElement.clientWidth},setFixed:function(state){if($IE6){var _this=this;if(state){_this._ie6Fixed();Core.Events.addEvent(window,_this._ie6Fixed,"scroll")}else{Core.Events.removeEvent(window,_this._ie6Fixed,"scroll")}}else{this.entity.style.position=state?"fixed":"absolute"}},_setOpacity:function(obj,v){if($IE&&$IE<=9){obj.style.filter="alpha(opacity="+v*100+")"}else{obj.style.opacity=v}},onShow:function(){},onHidden:function(){}};function CustomsDialog(tpl,name){this.nodesPattern=/[^\{\}]+(?=\})/g;this._dialog=DialogManager.create(tpl,name);this.entity=this._dialog.entity;this.templateString="";this.nodes={};var _this=this;(function initialize(){_this._dialog.onDrag=function(){if($IE6){if(this.getProperty().isFixed){this.setPosition({x:parseInt(this.entity.style.left)-document.documentElement.scrollLeft,y:parseInt(this.entity.style.top)-document.documentElement.scrollTop})}}else{if(this.getProperty().isFixed){this.setPosition({x:parseInt(this.entity.style.left),y:parseInt(this.entity.style.top)})}}_this.onDrag()};_this.updateNodes();if(_this.nodes.btnClose){Core.Events.addEvent(_this.nodes.btnClose,function(){var e=Core.Events.getEvent();if(e){e.cancelBubble=true}},"mousedown")}})();this._hiddenDialog=function(){_this.hidden()};this._closeDialog=function(){_this.close()}}CustomsDialog.prototype={isSetMiddle:false,setContent:function(tpl){var _contentTemplate=tpl;this.templateString=_contentTemplate.match(this.nodesPattern);var tmp=new Ui.Template(_contentTemplate);this.nodes.content.innerHTML=tmp.evaluate(this.getContentNodes("i"));this.updateNodes()},setTitle:function(title){if(this.nodes.titleName){this.nodes.titleName.innerHTML=title}},setHelp:function(helpLink){if(this.nodes.btnHelp){if(helpLink){this.nodes.btnHelp.href=helpLink}else{this.nodes.btnHelp.innerHTML=""}}},setClose:function(mode){var _this=this;if(_this.nodes.btnClose){mode=mode||"hidden";switch(mode){case"hidden":Core.Events.addEvent(_this.nodes.btnClose,_this._hiddenDialog,"click");break;case"close":Core.Events.addEvent(_this.nodes.btnClose,_this._closeDialog,"click");break}}},setPosition:function(x,y){this._dialog.setPosition({x:x,y:y})},setMiddle:function(){var win=Core.System.winSize();var _x,_y;var displayState=this._dialog.entity.style.display;this._dialog.setPosition({x:-1e4});this._dialog.entity.style.display="";var titleBarOffsetHeight=this.nodes.titleBar?this.nodes.titleBar.offsetHeight:0;var areaHeight=win.height-this.nodes.content.offsetHeight-titleBarOffsetHeight;var goldenSection=(Math.sqrt(5)-1)/2;var totalSection=1;var goldenSectionY=areaHeight*goldenSection/(goldenSection+totalSection);_x=win.width/2-this.nodes.content.offsetWidth/2;_x=_x<0?0:_x;_y=goldenSectionY<0?0:goldenSectionY;if(!this._dialog.getProperty().isFixed){_x=_x+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft);_y=_y+Math.max(document.documentElement.scrollTop,document.body.scrollTop)}this._dialog.entity.style.display=displayState;this._dialog.setPosition({x:_x,y:_y});this.isSetMiddle=true},setSize:function(width,height){this._dialog.setSize({width:width,height:height})},setFixed:function(state){this._dialog.setFixed(state)},setAreaLocked:function(state){this._dialog.setAreaLocked(state)},setFocusNode:function(focusNode){this._dialog.getProperty().focusNode=focusNode},setDisplayMode:function(mode){this._dialog.getProperty().displayMode=mode||"normal"},getWidth:function(){return this._dialog.getProperty().width},getHeight:function(){return this._dialog.getProperty().height},getX:function(){return this._dialog.getProperty().x},getY:function(){return this._dialog.getProperty().y},show:function(){if(this.isSetMiddle){this.setMiddle()}this._dialog.show();this.onShow()},hidden:function(){this._dialog.hidden();this.onHidden()},close:function(){var _this=this;_this._dialog.close();_this.onClose();if(_this.nodes.btnClose){Core.Events.removeEvent(_this.nodes.btnClose,_this._hiddenDialog,"click");Core.Events.removeEvent(_this.nodes.btnClose,_this._CloseDialog,"click")}},updateNodes:function(){this.nodes=this._dialog.getNodes();var contentNodes=this.getContentNodes();for(k in contentNodes){this.nodes[k]=contentNodes[k]}},getContentNodes:function(mode){var m=mode||"o";var i;var nodes={};var result=this.templateString;if(result){for(i=0;i<result.length;i++){var r=result[i];switch(m){case"o":nodes[r]=$E(this.nodes.content.id+"_"+r);break;case"i":nodes[r]=this.nodes.content.id+"_"+r;break}}}return nodes},setOnDisplaied:function(func){this._dialog.onDisplaied=func},setOnDisplayFinished:function(func){this._dialog.onDisplayFinished=func},onDrag:function(){},onShow:function(){},onHidden:function(){},onClose:function(){}};var LayerTemplate={alert:'<table id="#{entity}"  class="gModLy">'+'<thead id="#{titleBar}">'+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div>'+'<div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</thead>"+"<tfoot>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tfoot>"+"<tbody>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain" id="layer_2">'+'<div id="#{content}" class="gModLyCont">'+"<!-- 内容区域 -->"+'<div class="gDialogDoc">'+'<div class="diaBd">'+'<div class="gDiaC1"><img id="#{icon}" width="50" height="50" class="" src="http://simg.sinajs.cn/tiezi/images/icon/icon.gif" alt=""/></div>'+'<div class="gDiaC2">'+'<h5 id="#{text}"></h5>'+'<div id="#{subText}"></div>'+"<p/>"+"</div>"+"</div>"+'<div class="btnRow"><a class="gBtnb gBtnbClr" id="#{linkOk}" href="javascript:;"><cite id="#{btnOk}"><em id="#{ok}"></em></cite></a></div>'+"</div>"+"<!-- 内容区域 -->"+"</div>"+"</td>"+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tbody>"+"</table>",confirm:'<table id="#{entity}"  class="gModLy">'+'<thead id="#{titleBar}">'+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div>'+'<div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</thead>"+"<tfoot>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tfoot>"+"<tbody>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain" id="layer_2">'+'<div id="#{content}" class="gModLyCont">'+"<!-- 内容开始 -->"+'<div class="gDialogDoc">'+'<div class="diaBd">'+'<div class="gDiaC1"><img id="#{icon}" width="50" height="50" class="" src="http://simg.sinajs.cn/tiezi/images/icon/icon.gif" alt=""/></div>'+'<div class="gDiaC2">'+'<h5 id="#{text}"></h5>'+'<div id="#{subText}"></div>'+"<p/>"+"</div>"+"</div>"+'<div class="btnRow">'+'<a class="gBtnb gBtnbClr" id="#{linkOk}" href="javascript:;"><cite id="#{btnOk}"><em id="#{ok}"></em></cite></a>'+'<a class="gBtnb gBtnbClr" id="#{linkCancel}" href="javascript:;"><cite id="#{btnCancel}"><em id="#{cancel}"></em></cite></a>'+"</div>"+"</div>"+"<!-- 内容结束 -->"+"</div>"+"</td>"+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tbody>"+"</table>",iframe:'<table id="#{entity}"  class="gModLy">'+'<thead id="#{titleBar}">'+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div>'+'<div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</thead>"+"<tfoot>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tfoot>"+"<tbody>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain" id="layer_2">'+'<div id="#{content}" class="gModLyCont">'+'<div id="#{loadState}">Loading...</div>'+'<iframe style="width:100%;height:500px;" id="#{iframe}" src="#{iframeURL}"></iframe>'+"</div>"+"</td>"+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tbody>"+"</table>",customs:'<table id="#{entity}"  class="gModLy">'+'<thead id="#{titleBar}">'+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div>'+'<div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</thead>"+"<tfoot>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tfoot>"+"<tbody>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain" id="layer_2">'+'<div id="#{content}" class="gModLyCont">'+"<!-- 内容区域 -->"+"<!-- 内容区域 -->"+"</div>"+"</td>"+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tbody>"+"</table>"};(function(){var WindowDialog=function(backShadow,objTemplate){this.template=objTemplate||{};DialogManager.backShadow=backShadow};WindowDialog.prototype={iconSet:{"01":{"class":"SG_icon SG_icon201",alt:"警告"},"02":{"class":"SG_icon SG_icon202",alt:"失败"},"03":{"class":"SG_icon SG_icon203",alt:"成功"},"04":{"class":"SG_icon SG_icon204",alt:"询问"},"06":{"class":"SG_icon SG_icon148",alt:"警告"}},alert:function(text,cfg,name){cfg=cfg||{};var dialog=DialogManager.create(cfg.template||this.template.alert||LayerTemplate.alert,name);var win=Core.System.winSize();var nodes=dialog.getNodes();dialog.onDisplaied=cfg["funcDisplaied"];dialog.onDisplayFinished=cfg["funcDisplayFinished"];dialog.setSize({width:cfg["width"],height:cfg["height"]});dialog.setFixed(true);this._setDialogMiddle(dialog);dialog.show();dialog.setAreaLocked(true);nodes.linkOk.focus();nodes.text.innerHTML=text;if(nodes.titleName){nodes.titleName.innerHTML=cfg["title"]||"提示"}if(nodes.icon){nodes.icon.className=cfg["icon"]?this.iconSet[cfg["icon"]]["class"]:this.iconSet["01"]["class"];nodes.icon.alt=cfg["icon"]?this.iconSet[cfg["icon"]]["alt"]:this.iconSet["01"]["alt"]}nodes.ok.innerHTML=cfg["textOk"]||"确定";if(nodes.subText){nodes.subText.innerHTML=cfg["subText"]||""}dialog.getProperty().focusNode=nodes.linkOk;Core.Events.addEvent(nodes.btnOk,function(){if(cfg["funcOk"]&&dialog.getProperty().enabled){cfg["funcOk"]();Core.Events.stopEvent()}dialog.close();return false},"click");Core.Events.addEvent(nodes.linkOk,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){if(cfg["funcOk"]&&dialog.getProperty().enabled){cfg["funcOk"]()}dialog.close()}},"keydown");Core.Events.addEvent(nodes.btnClose,function(){if(cfg["funcClose"]&&dialog.getProperty().enabled){cfg["funcClose"]()}dialog.close()},"click");Core.Events.addEvent(nodes.btnClose,function(){var e=Core.Events.getEvent();e.cancelBubble=true},"mousedown")},newAlert:function(text,cfg,name){cfg.template=this.template.newAlert;this.alert(text,cfg,name)},confirm:function(text,cfg,name){cfg=cfg||{};var dialog=DialogManager.create(cfg.template||this.template.confirm||LayerTemplate.confirm,name);var win=Core.System.winSize();var nodes=dialog.getNodes();dialog.onDisplaied=cfg["funcDisplaied"];dialog.onDisplayFinished=cfg["funcDisplayFinished"];dialog.setSize({width:cfg["width"],height:cfg["height"]});dialog.setFixed(true);this._setDialogMiddle(dialog);dialog.show();dialog.setAreaLocked(true);if(cfg["defaultButton"]==0){nodes.linkCancel.focus();dialog.getProperty().focusNode=nodes.linkCancel}else{nodes.linkOk.focus();dialog.getProperty().focusNode=nodes.linkOk}nodes.text.innerHTML=text;if(nodes.titleName){nodes.titleName.innerHTML=cfg["title"]||"提示"}if(nodes.icon){nodes.icon.className=cfg["icon"]?this.iconSet[cfg["icon"]]["class"]:this.iconSet["04"]["class"];nodes.icon.alt=cfg["icon"]?this.iconSet[cfg["icon"]]["alt"]:this.iconSet["04"]["alt"]}nodes.ok.innerHTML=cfg["textOk"]||"确定";nodes.cancel.innerHTML=cfg["textCancel"]||"取消";if(nodes.subText){nodes.subText.innerHTML=cfg["subText"]||""}Core.Events.addEvent(nodes.btnOk,function(){if(cfg["funcOk"]&&dialog.getProperty().enabled){cfg["funcOk"]();Core.Events.stopEvent()}dialog.close();return false},"click");Core.Events.addEvent(nodes.linkOk,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){if(cfg["funcOk"]&&dialog.getProperty().enabled){cfg["funcOk"]()}dialog.close()}},"keydown");Core.Events.addEvent(nodes.btnCancel,function(){if(cfg["funcCancel"]&&dialog.getProperty().enabled){cfg["funcCancel"]();Core.Events.stopEvent()}dialog.close();return false},"click");Core.Events.addEvent(nodes.linkCancel,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){if(cfg["funcCancel"]&&dialog.getProperty().enabled){cfg["funcCancel"]()}dialog.close()}},"keydown");Core.Events.addEvent(nodes.btnClose,function(){if(cfg["funcClose"]&&dialog.getProperty().enabled){cfg["funcClose"]();Core.Events.stopEvent()}dialog.close();return false},"click");Core.Events.addEvent(nodes.btnClose,function(){var e=Core.Events.getEvent();e.cancelBubble=true},"mousedown")},newConform:function(text,cfg,name){cfg.template=this.template.newConfirm;this.confirm(text,cfg,name)},showIframe:function(cfg,name){cfg=cfg||{};var dialog=DialogManager.create(this.template.iframe||LayerTemplate.iframe,name);var win=Core.System.winSize();var nodes=dialog.getNodes();dialog.setSize({width:cfg["width"]||320,height:cfg["height"]||150});var _x=win.width/2-dialog.getProperty().width/2<0?0:win.width/2-dialog.getProperty().width/2;var _y=win.height/2-dialog.getProperty().height/2<0?0:win.height/2-dialog.getProperty().height/2;if(cfg["fixed"]){dialog.setPosition({x:_x,y:_y})}else{dialog.setPosition({x:_x+document.documentElement.scrollLeft,y:_y+document.documentElement.scrollTop})}if(!$IE6){dialog.getProperty().displayMode="alpha"}dialog.setFixed(!!cfg.fixed);dialog.show();dialog.setAreaLocked(true);nodes.titleName.innerHTML=cfg["title"]||"";nodes.iframe.src=cfg["url"]||"about:blank";Core.Events.addEvent(nodes.iframe,function(){nodes.iframe.style.display="";nodes.loadState.style.display="none"},"load");Core.Events.addEvent(nodes.btnClose,function(){dialog.close()},"click");Core.Events.addEvent(nodes.btnClose,function(){var e=Core.Events.getEvent();e.cancelBubble=true},"mousedown")},createCustomsDialog:function(cfg,name){cfg=cfg||{};var customsDialog=new CustomsDialog(cfg.tpl||this.template.customs||LayerTemplate.customs,name);cfg.content&&customsDialog.setContent(cfg.content);customsDialog.setTitle(cfg.title||"提示");customsDialog.setHelp(cfg.help||"");customsDialog.setClose("hidden");customsDialog.setOnDisplaied(cfg["funcDisplaied"]);customsDialog.setOnDisplayFinished(cfg["funcDisplayFinished"]);return customsDialog},getDialog:function(name){return DialogManager.getDialog(name)},close:function(name){DialogManager.close(name)},_setDialogMiddle:function(dialog){var win=Core.System.winSize();var nodes=dialog.getNodes();var _x,_y;var displayState=dialog.entity.style.display;dialog.setPosition({x:-1e4});dialog.entity.style.display="";var titleBarOffsetHeight=nodes.titleBar?nodes.titleBar.offsetHeight:0;var areaHeight=win.height-nodes.content.offsetHeight-titleBarOffsetHeight;var goldenSection=(Math.sqrt(5)-1)/2;var totalSection=1;var goldenSectionY=areaHeight*goldenSection/(goldenSection+totalSection);_x=win.width/2-nodes.content.offsetWidth/2;_x=_x<0?0:_x;_y=goldenSectionY<0?0:goldenSectionY;if(!dialog.getProperty().isFixed){_x=_x+document.documentElement.scrollLeft;_y=_y+document.documentElement.scrollTop}dialog.entity.style.display=displayState;dialog.setPosition({x:_x,y:_y})}};Sina.Ui.WindowDialog=WindowDialog})();window.removeVote=function(){winDialog.confirm("是否确定删除投票？",{funcOk:function(){if(articleEditorCFG.articleStatus.match(/(2|3)/g)){new Interface("http://control.blog.sina.com.cn/admin/vote/del_vote_from_article.php","ajax").request({POST:{blog_id:$E("blog_id").value},onSuccess:function(res){$E("editorForm").blogVote.value="no";window.vote_status="remove";$E("saveStatus").style.display="none";$E("newStatus").style.display="";articleEditorCFG.articlevData=null;window.insertVote=null},onError:function(res){winDialog.alert($SYSMSG[res.code],{icon:"01"})}})}else{$E("editorForm").blogVote.value="no";window.insertVote=null;window.vote_status="remove"}}.bind2(this),funcCancel:function(){editorTabs.showTab("vote")}.bind2(this),textOk:"是",textCancel:"否",defaultButton:1,title:"提示",icon:"03"},"insertVoteTip");var dia=winDialog.getDialog("insertVoteTip");var closeBtn=dia.getNodes().btnClose;Core.Events.addEvent(closeBtn,function(){editorTabs.showTab("vote")},"click")};window.showVote=function(){if($E("editorForm").blogVote){$E("editorForm").blogVote.value="yes"}};var Comment={};Comment.formatTime=function(time){var s=new Date;if(time){s.setTime(s)}var month=s.getMonth()+1>=10?s.getMonth()+1:"0"+(s.getMonth()+1);var date=s.getDate()>=10?s.getDate():"0"+s.getDate();var time=(new Date).toTimeString().split(" ")[0];var t=s.getFullYear()+"-"+month+"-"+date+" "+time;return t};Core.String.decodeHTML=function(str){var div=document.createElement("div");div.innerHTML=str;return div.innerText==undefined?div.textContent:div.innerText};$registJob("send_article_page_init",function(){var _CFG=articleEditorCFG;function forbiddenArticleTips(){var sucdlg=winDialog.alert("新浪博客正在维护中。对由此给您造成的不便，深表歉意。",{funcOk:function(){},textOk:"确定",title:"提示",width:430,icon:"01"},"sendKillDialog");window.onbeforeunload=function(){}}function auditArticleTips(){var sucdlg=winDialog.alert("文明办网文明上网。请您不要发布淫秽色情等违法信息。<br/>您的博文已发布，稍后显示，请耐心等待。",{funcOk:function(){location.href="http://blog.sina.com.cn/u/"+scope.$uid},textOk:"确定",title:"提示",width:430,icon:"01"},"sendAuditDialog");window.onbeforeunload=function(){}}var isPAP=0;function isPrivacyArticle(){return $E("xRankRadio").checked||$E("componentSelect").value==="0"}function privacyArticleCheck(cb){var itf=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/points/check_vip.php","ajax");itf.request({POST:{type:4},onSuccess:function(data){isPAP=1;cb()},onError:function(result){if(result&&result.code=="A00001"){privacyArticleTips(cb)}},onFail:function(){}})}function privacyArticleTips(cb){var interfacePrivacy=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/points/points_redeem.php","ajax");var sucdlg=winDialog.alert("你尚未开通私密博文功能!",{funcOk:function(){interfacePrivacy.request({POST:{user:scope.$uid||$UID,type:4,auto:1},onSuccess:function(data){isPAP=1;cb()},onError:function(result){if(result&&result.code=="A00003"){winDialog.alert(result.data,{subText:'<a href="http://blog.sina.com.cn/huodong/lottery.html?f=1">马上获得1888积分! </a>'})}else{winDialog.alert(result&&result.data)}},onFail:function(){}})},textOk:"兑换并发表",subText:"私密博文一个月(30天)功能仅需30积分"},"privacyArticleDialog");window.onbeforeunload=function(){}}window.editor_Timer=0;if(_CFG&&(_CFG.articleStatus!=1||_CFG.worldcupPics)){editor.areaToFrame()}var souEle=$E("source");if(souEle&&souEle.value!=""){editor.areaToFrame()}if(_CFG.articleStatus!=1){if(typeof _CFG.articlevData!="undefined"&&_CFG.articlevData!=null){editorTabs.addTab({name:"vote",title:"投票",contentId:"addVote",callVote:{remove:removeVote,show:showVote}});window.editorTabs.show();window.insertVote=new Vote(_CFG.articlevData)}if(_CFG.articleAssociateHistory&&_CFG.articleAssociateHistory.length>0){editorTabs.addTab({name:"article",title:"相关博文",contentId:"article_associate"});window.editorTabs.show();window.articleAssociate=new Editor.Plugins.ArticleAssociate("article_associate",_CFG.articleStatus);editorTabs.addCloseCallbackFunc("article",articleAssociate.del.bind2(articleAssociate));window.articleAssociate.history(_CFG.articleAssociateHistory);window.articleAssociate.add()}if(_CFG.articleActivity){if(!$E("tab_content_activity")){Core.Dom.insertHTML($E("article_associate"),"<div class='myActive' id='tab_content_activity'></div>","AfterEnd")}editorTabs.addTab({name:"activity",title:"推荐活动",contentId:"tab_content_activity"});if(activity.state!="finish"){editorTabs.addCloseCallbackFunc("activity",activity.del.bind2(activity))}activity.setConHtml("tab_content_activity")}editor.initTemplateImage();editor.initUserData=true}else{editor.redoData()}if(_CFG.articleStatus==2){editor.getToolElement("pro","quickpost").style.display="block";editor.getToolElement("base","quickpost").style.display="block";editor.saveType="quickpost"}else{editor.getToolElement("pro","quicksave").style.display="block";editor.getToolElement("base","quicksave").style.display="block";editor.saveType="quicksave"}var getFrameValue=function(FrameNode){return Core.String.j2o(Core.String.trim(FrameNode.contentWindow.document.body.innerHTML))};var cIFM=function(sFrameName){if($E(sFrameName))Core.Dom.removeNode($E(sFrameName));Core.Dom.addHTML(document.body,"<iframe name='"+sFrameName+"' id='"+sFrameName+"' style='display: none;'></iframe>")};function tagFunc(FrameNode,oFunc){try{var frmJosn=getFrameValue(FrameNode);if(frmJosn==null)frmJosn={code:"A00001",data:[]};if(frmJosn.code!=null){if(oFunc){oFunc(frmJosn)}else{showError(frmJosn.code,{close:false})}}}catch(e){$E("articlePostBtn").disabled=false;$E("articlePosTempBtn").disabled=false;$E("articleTagAutoSub").disabled=false;$E("articleSaveBtn").disabled=false}}function checkMedia(){var checkValue=editor.getMediaTag();$E("is_album").value=checkValue[0];if($E("is_media").value!="1"){$E("is_media").value=checkValue[1]}}function checkStock(){var stockValue=editor.checkStock();var ele=$E("is_stock");ele.value=stockValue}function checkVote(){if(window.insertVote){var vote_data=insertVote.toData();if(vote_data){if(!insertVote.compare(_CFG.articlevData,vote_data)){insertVote.setBlogVote()}}else{if(insertVote.getBlogVote()=="yes"){insertVote.setBlogVote("noedit")}}}}function checkCateTag(){var tags=$E("articleTagInput")&&$E("articleTagInput").value,i=0,len,editorForm,hotTagNum;editorForm=$E("editorForm");if(!editorForm){return}tags=tags.split(" ");len=tags.length;var tag,sortitem,defaultFlag=false;hotTagNum=articleEditorCFG.articleAllTagList.hotTagNum;for(i;i<len;i++){tag=tags[i];if(hotTagNum[tag]&&!defaultFlag){sortitem=$C("input");sortitem.type="hidden";sortitem.name="sina_sort_id";sortitem.value=hotTagNum[tag];defaultFlag=true;break}}if(!defaultFlag){sortitem=$C("input");sortitem.type="hidden";sortitem.name="sina_sort_id";sortitem.value="117"}editorForm.appendChild(sortitem);return}function addAutoTags(tags){tags=(tags||"").split(" ");for(var i=0,len=tags.length;i<len;i++){scope._tagsMng.addTag(tags[i],{notip:true})}}$E("articleTagAutoSub").onclick=function(){editor.setSourceValue();var contentBody=window.editor.iframeDocument.body;if(Core.String.byteLength(contentBody.innerText||contentBody.textContent||"")<40){showError("B03106");v7sendLog("48_01_01_B03106","editor");return}$E("articleTagAutoSub").disabled=true;var title=$E("articleTitle")&&$E("articleTitle").value||"";body=contentBody.innerHTML||"";Utils.Io.Ijax.request("http://interface.blog.sina.com.cn/api/get_blog_classify.php",{POST:{blog_body:body,blog_title:title,utf8:"utf8",top:5,action:"tag"},onComplete:function(resultText){var resObj=Core.String.j2o(resultText);$E("articleTagAutoSub").disabled=false;switch(resObj.code){case"B00000":break;case"B00006":addAutoTags(resObj.data);break;case"00001":showError($SYSMSG["A00001"]);break;case"A00006":addAutoTags(resObj.data);break;default:if(resObj.code.charAt(0)=="0"){showError("B"+resObj.code)}else{showError(resObj.code)}break}v7sendLog("48_01_01_"+resObj.code,"editor")},onException:function(){}});return false};$E("articlePreviewBtn").onclick=$E("articlePreviewBtn2").onclick=function(){if($E("articleTagInput").value==_CFG.dftTagValue)$E("articleTagInput").value="";editor.setSourceValue();var contentBody=window.editor.iframeDocument.body;if(Core.String.trim(contentBody.innerHTML).replace(/^<br>/,"")===""){winDialog.alert("博文内容不能为空",{icon:"01"});return}if(window.articleAssociate){window.articleAssociate.saveSeleteData()}if(window.insertMusic){if(!window.insertMusic.save()){$E("articleSaveBtn").disabled=false;return false}}$E("editorForm").target="_blank";$E("editorForm").action=_CFG.articlePreviewURL;$E("editorForm").submit();return false};Core.Events.addEvent($E("articleSaveBtn"),tempArticleSave);function tempArticleSave(){if(window.editor.editSaveing){return}window.editor.editSaveing=true;$E("articleSaveBtn").disabled=true;cIFM("fileFrame");editor.setSourceValue();checkMedia();checkStock();if(window.articleAssociate){window.articleAssociate.save()}if(window.insertMusic){if(!window.insertMusic.save()){window.editor.editSaveing=false;$E("articleSaveBtn").disabled=false;return}}checkVote();$E("editorForm").target="fileFrame";$E("editorForm").action=_CFG.articlePostURL;if($E("articleTagInput").value==_CFG.dftTagValue)$E("articleTagInput").value="";var contentLen=$E("conlen");if(contentLen){contentLen.value=$E("SinaEditorTextarea").value.length}Core.Events.addEvent($E("fileFrame"),Core.Function.bind3(tagFunc,this,[$E("fileFrame"),function(frmJson){if(typeof frmJson.ycon_length!==undefined){var len=$E("SinaEditorTextarea").value.length;new Interface("http://control.blog.sina.com.cn/admin/article/ria_debug.php","jsload").request({GET:{type:"js_err_log",desc:"num_"+len+"_ynum_"+frmJson.ycon_length+"_hnum_"+frmJson.hcon_length+"_uid_"+scope.$uid+"_bid_"+frmJson.data},onSuccess:function(){},onError:function(){},onFail:function(){}})}window.editor.editSaveing=false;$E("articleSaveBtn").disabled=false;switch(frmJson.code){case"B00111":auditArticleTips();break;case"B00110":forbiddenArticleTips();break;case"B66666":var sucdlg=winDialog.alert("服务器临时遇见问题，发博文功能暂时不可用。工程师正在恢复中，请稍后再试。",{funcOk:function(){}.bind2(this),textOk:"确定",title:"提示",icon:"02"},"sendArticleProblemDialog");break;case"B06001":window.editor.editSaveing=true;$E("articleSaveBtn").disabled=true;window.onbeforeunload=function(){};setTimeout(function(){window.editor.editSaveing=false;$E("articleSaveBtn").disabled=false;location.href="http://blog.sina.com.cn/s/blog_"+frmJson.data+".html"},1e3);break;case"B02005":var sucdlg=winDialog.confirm($SYSMSG["B02005"],{funcOk:function(){var inp=$C("input");inp.id="feifa";inp.name="check";inp.value="no";inp.type="hidden";$E("editorForm").appendChild(inp);articlePostBtnFunc()},funcCancel:function(){var inp=$E("feifa");if(inp){$E("editorForm").removeChild(inp)}},textOk:"确定",textCancel:"取消",title:"提示",icon:"02"});break;case"A00004":(new Lib.Login.Ui).login(tempArticleSave,true);break;case"B00905":case"B00907":case"B00908":case"B00909":case"B00906":showError(frmJson.code);window.editorTabs.showTab("vote");break;case"B06013":needSafeCode(frmJson);break;case"B06014":safeCodeErr(frmJson);break;default:showError(frmJson.code)}}]),"load");$E("editorForm").submit()}window.articlePosTempBtnFunc=function(){if(window.editor.tempSaveing){return}window.editor.tempSaveing=true;var tempBtn=$E("articlePosTempBtn");tempBtn.disabled=true;cIFM("fileFrame");editor.setSourceValue();checkMedia();checkStock();checkVote();checkCateTag();if(window.articleAssociate){window.articleAssociate.save()}if(window.insertMusic){if(!window.insertMusic.save()){window.editor.tempSaveing=false;tempBtn.disabled=false;return}}$E("editorForm").target="fileFrame";if(_CFG.articleStatus=="3"){$E("editorForm").action=_CFG.articleEditPostTempURL}else if(_CFG.articleStatus=="7"){$E("isTimed").value=7;$E("editorForm").action=_CFG.articleEditPostURL}else{$E("editorForm").action=_CFG.articlePostTempURL}if($E("articleTagInput").value==_CFG.dftTagValue)$E("articleTagInput").value="";var hiddenTip;if(arguments[0]&&arguments[0].hiddenTip){hiddenTip=arguments[0].hiddenTip}else{hiddenTip=function(){}}var callback;if(arguments[0]&&arguments[0].callback){callback=arguments[0].callback}else{callback=function(){showError("B06003")}}var contentLen=$E("conlen");if(contentLen){contentLen.value=$E("SinaEditorTextarea").value.length}Core.Events.addEvent($E("fileFrame"),Core.Function.bind3(tagFunc,this,[$E("fileFrame"),function(frmJson){if(typeof frmJson.ycon_length!==undefined){var len=$E("SinaEditorTextarea").value.length;new Interface("http://control.blog.sina.com.cn/admin/article/ria_debug.php","jsload").request({GET:{type:"js_err_log",desc:"num_"+len+"_ynum_"+frmJson.ycon_length+"_hnum_"+frmJson.hcon_length+"_uid_"+scope.$uid+"_bid_"+frmJson.data},onSuccess:function(){},onError:function(){},onFail:function(){}})}trace("新发保存草稿,返回状态码:=== "+frmJson.code);window.editor.tempSaveing=false;$E("articlePosTempBtn").disabled=false;hiddenTip();switch(frmJson.code){case"B06003":editor.userData.clear("blog_user_data",["content","uid"]);_CFG.articleStatus="3";$E("blog_id").value=frmJson.data;callback(frmJson.code);break;case"B06006":winDialog.alert("已保存到定时列表",{
subText:"将于"+$E("date_pub").value+" "+$E("articleTime").value+"发布",funcOk:function(){window.onbeforeunload=function(){};window.location.href="http://control.blog.sina.com.cn/blog_rebuild/blog/controllers/articlelist.php?p=1&status=7&uid="+scope.$uid},funcClose:function(){window.onbeforeunload=function(){};window.location.href="http://control.blog.sina.com.cn/blog_rebuild/blog/controllers/articlelist.php?p=1&status=7&uid="+scope.$uid},icon:"03"});break;case"B06001":window.onbeforeunload=function(){};window.location.href="http://blog.sina.com.cn/s/blog_"+frmJson.data+".html";break;case"B40001":winDialog.alert("定时列表中文章数已达上限，请立即发布",{icon:"01"});break;case"B40002":winDialog.alert("此时间已被设置过定时发布，请您修改定时设置后再发布",{icon:"01"});break;case"B07003":winDialog.confirm($SYSMSG["B07003"],{ico:"03",btn:[{label:"是",focus:true,func:function(){articlePosTempBtnFunc()}},{label:"否"}]});break;case"A00004":(new Lib.Login.Ui).login(articlePosTempBtnFunc,true);break;case"B06013":needSafeCode(frmJson);break;case"B06014":safeCodeErr(frmJson);break;case"B00905":case"B00907":case"B00908":case"B00909":case"B00906":showError(frmJson.code);window.editorTabs.showTab("vote");break;default:showError(frmJson.code);break}}]),"load");$E("editorForm").submit()};Core.Events.addEvent($E("articlePosTempBtn"),function(){var st=scope.$server_time,pt=scope.$pub_time;if(_CFG.articleStatus=="7"&&st&&pt&&st>pt){var tobj=Core.Date.getTimeObj(pt);winDialog.confirm("博文将立即发布",{subText:"发布时间："+tobj.yy+"-"+tobj.MM+"-"+tobj.dd+" "+tobj.hh+":"+tobj.mm+":"+tobj.ss,funcOk:function(){articlePosTempBtnFunc()},icon:"04"})}else{articlePosTempBtnFunc()}});window.articlePostBtnFunc=function(){if(isPrivacyArticle()&&!isPAP){privacyArticleCheck(articlePostBtnFunc);return}if(window.editor.articleSaveing){return}window.editor.articleSaveing=true;$E("articlePostBtn").disabled=true;cIFM("fileFrame");editor.setSourceValue();checkMedia();checkStock();checkCateTag();var hiddenTip;if(arguments[0]&&arguments[0].hiddenTip){hiddenTip=arguments[0].hiddenTip}else{hiddenTip=function(){}}checkVote();var callback;if(arguments[0]&&arguments[0].callback){callback=arguments[0].callback}else{callback=function(frmJson){var isPrivateBlog=scope.$private.isprivate=="1";var isPrivateArticle=$E("componentSelect").value==="0";var wl_internalState_cid;try{var wl_internalState=new Function("return "+decodeURIComponent(Utils.Cookie.getCookie("wl_internalState")))();wl_internalState_cid=wl_internalState.wl_cid}catch(e){}if(scope.$private.msnfeed&&parseInt(scope.$private.msnfeed)>=100){wl_internalState_cid=true}else{}if(wl_internalState_cid&&!isPrivateBlog&&!isPrivateArticle){new Interface("http://control.blog.sina.com.cn/riaapi/feed/msn_feed.php","jsload").request({GET:{uid:scope.$uid,title:encodeURIComponent($E("articleTitle").value),link:encodeURIComponent("http://blog.sina.com.cn/s/blog_"+frmJson.data+".html")},onSuccess:function(){}})}else{}editor.userData.clear("blog_user_data_"+scope.$uid,["content"]);var nomarlFuncOk=function(){setTimeout(function(){window.onbeforeunload=function(){};window.location.href="http://blog.sina.com.cn/s/blog_"+frmJson.data+".html"},1)};var blog365FuncOk=function(){winDialog.alert("感谢参加365活动",{funcOk:function(){nomarlFuncOk()},textOk:"确定",title:"提示",subText:'<a href="//control.blog.sina.com.cn/blog_rebuild/blog/controllers/setpage.php?uid='+scope.$uid+'&status=pageset" target="_blank">使用365专属配套博客模板</a>',icon:"03"})};var sucdlg=winDialog.alert("博文已发布成功",{funcOk:function(){if($E("articleTagInput")&&$E("articleTagInput").value.indexOf("365")>=0&&!Utils.Cookie.getCookie("blog365tpltips")){Utils.Cookie.setCookie("blog365tpltips","true",1*24*365);blog365FuncOk()}else{nomarlFuncOk()}},textOk:"确定",title:"提示",subText:'<a href="http://control.blog.sina.com.cn/admin/article/changWeiBo.php?url='+encodeURIComponent("http://blog.sina.com.cn/s/blog_"+frmJson.data+".html")+'" target="_blank">去发一篇长微博</a>',icon:"03"},"sendArticleSucsessDialog");var closeEle=winDialog.getDialog("sendArticleSucsessDialog").getNodes()["btnClose"];Core.Events.addEvent(closeEle,function(){setTimeout(function(){window.onbeforeunload=function(){};window.location.href=window.location.href="http://blog.sina.com.cn/s/blog_"+frmJson.data+".html"},1)},"click")}}if(window.articleAssociate){window.articleAssociate.save()}if(window.insertMusic){if(!window.insertMusic.save()){window.editor.articleSaveing=false;$E("articlePostBtn").disabled=false;hiddenTip();return false}}$E("editorForm").target="fileFrame";if(_CFG.articleStatus=="3"){$E("editorForm").action=_CFG.articleEditPostURL}else if(_CFG.articleStatus=="7"){$E("isTimed").value=0;$E("immediatepub").value=1;$E("editorForm").action=_CFG.articleEditPostURL}else{$E("editorForm").action=_CFG.articlePostURL}if(!scope.$user_channel){if((new Date).valueOf()-editor_Timer<1e3*60){showError("B08001");$E("articlePostBtn").disabled=false;$E("articlePosTempBtn").disabled=false;$E("articleTagAutoSub").disabled=false;$E("articleSaveBtn").disabled=false;window.editor.articleSaveing=false;hiddenTip();return false}}if($E("articleTagInput").value==_CFG.dftTagValue){$E("articleTagInput").value=""}var contentLen=$E("conlen");if(contentLen){contentLen.value=$E("SinaEditorTextarea").value.length}Core.Events.addEvent($E("fileFrame"),Core.Function.bind3(tagFunc,this,[$E("fileFrame"),function(frmJson){if(typeof frmJson.ycon_length!==undefined){var len=$E("SinaEditorTextarea").value.length;new Interface("http://control.blog.sina.com.cn/admin/article/ria_debug.php","jsload").request({GET:{type:"js_err_log",desc:"num_"+len+"_ynum_"+frmJson.ycon_length+"_hnum_"+frmJson.hcon_length+"_uid_"+scope.$uid+"_bid_"+frmJson.data},onSuccess:function(){},onError:function(){},onFail:function(){}})}window.editor.articleSaveing=false;$E("articlePostBtn").disabled=false;hiddenTip();switch(frmJson.code){case"B00111":auditArticleTips();break;case"B00110":forbiddenArticleTips();break;case"B66666":var sucdlg=winDialog.alert("服务器临时遇见问题，发博文功能暂时不可用。工程师正在恢复中，请稍后再试。",{textOk:"确定",title:"提示",icon:"03"},"sendArticleProblemDialog");break;case"B06006":winDialog.alert("博文已加入定时发布列表",{subText:"将于"+$E("date_pub").value+" "+$E("articleTime").value+"发布",funcOk:function(){window.onbeforeunload=function(){};window.location.href="http://control.blog.sina.com.cn/blog_rebuild/blog/controllers/articlelist.php?p=1&status=7&uid="+scope.$uid},funcClose:function(){window.onbeforeunload=function(){};window.location.href="http://control.blog.sina.com.cn/blog_rebuild/blog/controllers/articlelist.php?p=1&status=7&uid="+scope.$uid},icon:"03"});break;case"B40001":winDialog.alert("定时列表中文章数已达上限，请立即发布",{icon:"01"});break;case"B40002":winDialog.alert("此时间已被设置过定时发布，请您修改定时设置后再发布",{icon:"01"});break;case"B07006":var sucdlg=winDialog.alert("您所发表的相似内容过多，请稍后再试~",{textOk:"确定",title:"提示",icon:"03"},"sendArticleSucsessDialog");break;case"B06001":editor_Timer=(new Date).valueOf();editor.userData.clear("blog_user_data",["content","uid"]);succ_code="B06001";callback(frmJson);break;case"B02005":var sucdlg=winDialog.confirm($SYSMSG["B02005"],{funcOk:function(){var inp=$C("input");inp.id="feifa";inp.name="check";inp.value="no";inp.type="hidden";$E("editorForm").appendChild(inp);articlePostBtnFunc()},funcCancel:function(){var inp=$E("feifa");if(inp){$E("editorForm").removeChild(inp)}},textOk:"确定",textCancel:"取消",title:"提示",icon:"02"});break;case"B06002":if((new Date).valueOf()-editor_Timer<1e3*60){showError("B08001");return}editor_Timer=(new Date).valueOf();showError(frmJson.code);break;case"B06004":if((new Date).valueOf()-editor_Timer<1e3*60){showError("B08001");return}editor_Timer=(new Date).valueOf();showError(frmJson.code);break;case"B06011":sendContextToKfc(frmJson);break;case"B06013":needSafeCode(frmJson);break;case"B06014":safeCodeErr(frmJson);break;case"B06015":sendContextToDove(frmJson);break;case"B06012":sendContextToBlog5Year(frmJson);break;case"B07001":winDialog.confirm($SYSMSG["B07001"],{ico:"03",btn:[{label:"是",focus:true,func:function(){articlePostBtnFunc();$E("editorForm").submit()}},{label:"否"}],close:false});break;case"A00004":(new Lib.Login.Ui).login(articlePostBtnFunc,true);break;case"B00905":case"B00907":case"B00908":case"B00909":case"B00906":showError(frmJson.code);window.editorTabs.showTab("vote");break;default:showError(frmJson.code);break}}]),"load");$E("editorForm").submit()};Core.Events.addEvent($E("articlePostBtn"),window.articlePostBtnFunc);if($E("xRankRadio")){Core.Events.addEvent($E("componentSelect"),function(){if($E("componentSelect").value=="0"){$E("xRankRadio").checked=true}else{$E("xRankRadio").checked=false}},"change");Core.Events.addEvent($E("xRankRadio"),function(){if($E("xRankRadio").checked){$E("componentSelect").selectedIndex=$E("componentSelect").length-1}else{$E("componentSelect").selectedIndex="0"}},"click")}function sendContextToKfc(frmJson){winDialog.alert($SYSMSG["B06011"],{icon:"03",width:350,funcOk:function(){if($E("up2kfcAct").checked){Utils.Io.JsLoad.request("http://kfc.sina.com.cn/js/api_to_blog.php?varname=signKFC",{GET:{url:"http://blog.sina.com.cn/s/blog_"+frmJson.data+".html",sinaid:scope.$uid,title:$E("articleTitle").value==""?Comment.formatTime():$E("articleTitle").value,username:scope.nickname},onComplete:function(){switch(signKFC.data.code){case"A00006":default:window.location.href="http://blog.sina.com.cn/s/blog_"+frmJson.data+".html";break}},onError:function(){window.location.href="http://blog.sina.com.cn/s/blog_"+frmJson.data+".html"}})}else{window.location.href="http://blog.sina.com.cn/s/blog_"+frmJson.data+".html"}},subText:"看起来，这是一篇跟生活有关的博文。<br/>\r\n<input id='up2kfcAct' type='checkbox' checked/>是否将此篇博文投稿到<a href='http://kfc.sina.com.cn/' target=\"_blank\">“KFC生活如此多娇”</a>活动？\r\n<br/>投稿后，将有可能获得1000元携程旅游卡。"})}function sendContextToDove(frmJson){winDialog.alert($SYSMSG["B06011"],{icon:"03",width:350,funcOk:function(){if($E("up2doveAct").checked){Utils.Io.JsLoad.request("http://dove.sina.com.cn/save_blog_info.php?varname=signDove",{GET:{blog_url:encodeURIComponent("http://blog.sina.com.cn/s/blog_"+frmJson.data+".html"),user_id:scope.$uid,title:encodeURIComponent($E("articleTitle").value==""?Comment.formatTime():$E("articleTitle").value),username:encodeURIComponent(scope.nickname)},onComplete:function(data){window.location.href="http://blog.sina.com.cn/s/blog_"+frmJson.data+".html"},onError:function(data){window.location.href="http://blog.sina.com.cn/s/blog_"+frmJson.data+".html"}})}else{window.location.href="http://blog.sina.com.cn/s/blog_"+frmJson.data+".html"}},subText:"<input id='up2doveAct' type='checkbox' checked/>参加多芬<a href='http://dove.sina.com.cn/' target=\"_blank\">“美丽故事”</a>征文赢大奖。"})}function sendContextToBlog5Year(frmJson){v7sendLog("48_01_26");var gourl="http://blog.sina.com.cn/s/blog_"+frmJson.data+".html";var colaurl="http://sina.allyes.com/main/adfclick?db=sina&bid=204720,574361,579621&cid=0,0,0&sid=581984&advid=358&camid=37389&show=ignore&url=http://e.weibo.com/1795839430/app_3089170920?key=from_blog";var seeurl="http://sina.allyes.com/main/adfclick?db=sina&bid=204720,574363,579623&cid=0,0,0&sid=581986&advid=358&camid=37389&show=ignore&url=http://e.weibo.com/1795839430/app_3089170920?key=from_blog";winDialog.confirm($SYSMSG["B06012"],{icon:"03",width:300,textOk:"知道了",textCancel:"去看看",defaultButton:0,funcOk:function(){v7sendLog("48_01_41");if($E("upColorSprite").checked){sendBlogToCola("iknow")}else{setTimeout(function(){location.href=gourl},1e3)}},funcClose:function(){if($E("upColorSprite").checked){sendBlogToCola("iknow")}else{window.location.href=gourl}},funcCancel:function(){v7sendLog("48_01_42");if($E("upColorSprite").checked){sendBlogToCola("see")}else{openColaPage()}},subText:'这是一篇跟快乐有关的博文。<br/><input id="upColorSprite" type="checkbox" checked/>投稿到可口可乐圈？<br/><a style="color:red" href="'+colaurl+'" target="_blank">去活动站看看，惊喜奖品等你来拿</a>'});var sendBlogToCola=function(type){var type=type||"iknow";var len=50;var iframe=$E("SinaEditor_Iframe").children[0].contentWindow.document;var img=iframe.getElementsByTagName("img")[0];var imgSrc=img?img.src:"";var abs=Core.String.decodeHTML(iframe.body.innerHTML);if(Core.String.byteLength(abs)>len){abs=Core.String.leftB(abs,len)}Utils.Io.Ijax.request("http://happiness.sinaapp.com/services/blogsync",{POST:{url:encodeURIComponent("http://blog.sina.com.cn/s/blog_"+frmJson.data+".html"),uid:scope.$uid,title:encodeURIComponent($E("articleTitle").value==""?Comment.formatTime():$E("articleTitle").value),nick:encodeURIComponent(scope.nickname),"abstract":abs?encodeURIComponent(abs):"",img:encodeURIComponent(imgSrc)},onComplete:function(data){},onError:function(data){}});if(type==="iknow"){setTimeout(function(){location.href=gourl},1e3)}else if(type==="see"){openColaPage()}};var openColaPage=function(){window.open(seeurl);setTimeout(function(){location.href=gourl},1e3)}}$E("cateManageLink").onclick=function(){window.CateDialog.show();return false};function safeCodeErr(frmJson){if(typeof scope.xssSafeCodeDiag=="undefined"){needSafeCode(frmJson);return}scope.xssSafeCodeDiag.hidden();winDialog.alert("验证码错误，请重新输入。",{textOk:"确定",icon:"01",funcOk:function(){needSafeCode()},funcClose:function(){needSafeCode()}})}function needSafeCode(frmJson){var safeimgsrc="http://interface.blog.sina.com.cn/riaapi/checkwd_image.php";var tpl=['<table id="#{entity}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}"></strong>','<cite><a title="关闭" class="CP_w_shut"  id="#{btnClose}" href="javascript:;">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div class="" style="width:auto;" id="#{content}">',"</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join("");var content='<div class="CP_layercon2">\r\n						<div class="CP_prompt">\r\n						<img class="SG_icon SG_icon201" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="50" height="50" align="absmiddle" />\r\n						<table class="CP_w_ttl CP_m"><tr>\r\n						  <td >请输入验证码......</td>\r\n						</tr></table>\r\n						<ul class="CP_w_part SG_txtb">\r\n							<li class="mb">填写验证码后可继续操作</li>\r\n			                <li><span class="a">验证码：</span><span class="b"><input name="checkword" id="xssSafeCodeDiag_checkword" type="text" class="SG_input" style="width:75px;" />  <a href="javascript:scope.xssSafeCodeDiag.changeSafeCode();void(0);"><img id="xssSafeCodeDiag_safeimg"  src="http://simg.sinajs.cn/blog7style/images/common/yzm1.gif" width="58" height="20" align="absmiddle" /></a> <a href="javascript:scope.xssSafeCodeDiag.changeSafeCode();void(0);">换一个</a></span></li>\r\n						</ul>\r\n						<p class="CP_w_btns_Mid"><a class="SG_aBtn SG_aBtnB" id="xssSafeCodeDiag_okbtn" href="javascript:scope.xssSafeCodeDiag.ok();void(0);"><cite> 确定 </cite></a>&nbsp;&nbsp;<a class="SG_aBtn SG_aBtnB" id="xssSafeCodeDiag_cancelbtn"  href="javascript:scope.xssSafeCodeDiag.cancel();void(0);"><cite> 取消 </cite></a></p>\r\n						</div>\r\n					</div>';if(typeof scope.xssSafeCodeDiag=="undefined"){scope.xssSafeCodeDiag=winDialog.createCustomsDialog({tpl:tpl,title:"提示",content:content,width:400,height:210,funcDisplayFinished:function(){}},"note");scope.xssSafeCodeDiag.changeSafeCode=function(){$E("xssSafeCodeDiag_checkword").value="";$E("xssSafeCodeDiag_safeimg").src=safeimgsrc+"?r="+Math.random()};scope.xssSafeCodeDiag.ok=function(){var v=$E("xssSafeCodeDiag_checkword").value;if(v===""){scope.xssSafeCodeDiag.hidden();winDialog.alert("请输入验证码。",{textOk:"确定",icon:"01",funcOk:function(){needSafeCode()}});return}if(typeof $E("editorForm").checkword=="undefined"||$E("editorForm").checkword==null){var input=$IE?document.createElement('<input value="'+v+'" type="hidden" name="checkword" />'):document.createElement("input");$E("editorForm").appendChild(input);input.name="checkword";input.type="hidden";input.value=v}$E("editorForm").submit();scope.xssSafeCodeDiag.hidden();$E("editorForm").removeChild($E("editorForm").checkword);$E("editorForm").checkword=null};scope.xssSafeCodeDiag.cancel=function(){scope.xssSafeCodeDiag.hidden()};Core.Events.addEvent($E("xssSafeCodeDiag_checkword"),function(){if(typeof scope.xssSafeCodeDiag.keydownFn=="undefined"){scope.xssSafeCodeDiag.keydownFn=function(e){e=e||window.event;var kc=e.keyCode||e.charCode;if(kc=="13"){scope.xssSafeCodeDiag.ok()}};Core.Events.addEvent($E("xssSafeCodeDiag_checkword"),scope.xssSafeCodeDiag.keydownFn,"keydown")}},"focus");Core.Events.addEvent($E("xssSafeCodeDiag_checkword"),function(){if(typeof scope.xssSafeCodeDiag.keydownFn!="undefined"){Core.Events.removeEvent($E("xssSafeCodeDiag_checkword"),scope.xssSafeCodeDiag.keydownFn,"keydown");scope.xssSafeCodeDiag.keydownFn=null}},"blur")}scope.xssSafeCodeDiag.show();scope.xssSafeCodeDiag.setMiddle();scope.xssSafeCodeDiag.changeSafeCode()}});$registJob("editor_video",function(){window.ArticleVIDEOFuncs={addVIDEOList:function(sVideoURL,sVideoID){var id="tmp_id"+ +new Date;editor.insertHTML("<img src='http://simg.sinajs.cn/blog7style/images/common/editor/insetvideo.gif' width='482' height='388' id='"+id+"' vid='"+sVideoID+"'/>",{id:id,properites:{vid:sVideoID}});$E("is_media").value="true";VideoDialog.reset()}}});$registJob("editor_img",function(){window.ArticleIMGFuncs={addIMGList:function(aIMGList,sinaIMGList,dialogName,imgParam,selectImgList){var dialogName=dialogName||"imageDialog";var imginput=$E("SinaPhotoAlbumList");var s_img_input=$E("SinaPhotoAlbumCiteList");editor.insertHTML(this.buildHtml(aIMGList,sinaIMGList,imgParam));if(imginput){imginput.value+=!imginput.value?sinaIMGList:","+sinaIMGList}if(s_img_input){s_img_input.value+=!s_img_input.value?selectImgList:","+selectImgList}window[dialogName].hidden()},picSizeObj:{},buildHtml:function(aIMGList,sinaIMGList,imgPrarm){var imgstr="";var linkUrl="http://album.sina.com.cn/pic/";for(var i=0;i<aIMGList.length;i++){var curPic=aIMGList[i];var pId=curPic.substring(curPic.lastIndexOf("/")+1);var linkPic=linkUrl+pId;var picUrl=aIMGList[i];var w="",h="";if(top.isPicFlaReady){var picId=pId;picId=picId.replace(/&\d{3}$/,"");if(top.ArticleIMGFuncs.picSizeObj[picId]&&top.window.ArticleIMGFuncs.picSizeObj[picId].succ==true){w=top.window.ArticleIMGFuncs.picSizeObj[picId].w;h=top.window.ArticleIMGFuncs.picSizeObj[picId].h;var wh=this.checkPicSize(w,h,imgPrarm.size);w="width='"+wh.w+"'";h="height='"+wh.h+"'"}else{if(top.ArticleIMGFuncs.picSizeObj[picUrl]&&top.ArticleIMGFuncs.picSizeObj[picUrl].succ==true){w=top.window.ArticleIMGFuncs.picSizeObj[picUrl].w;h=top.window.ArticleIMGFuncs.picSizeObj[picUrl].h;if(w>690){h=Math.round(h/w*690);w=690}var wh=this.checkPicSize(w,h,imgPrarm.size);w="width='"+wh.w+"'";h="height='"+wh.h+"'"}}}if(picUrl.indexOf("photo.sina")!=-1||picUrl.indexOf("sinaimg.cn")!=-1){picUrl=this.replaceParam(picUrl);picUrl=this.replaceSize(picUrl);linkPic=this.replaceParam(linkPic);linkPic=this.replaceSize(linkPic);if(imgPrarm.position){switch(imgPrarm.position){case"left":imgstr+="<a href='"+linkPic+"' target='_blank'><img src='"+picUrl+"' "+w+" "+h+"/></a><br/><br/>";break;case"center":if($IE){imgstr+="<a href='"+linkPic+"' target='_blank'><img src='"+picUrl+"' style='text-align:center;display:block' "+w+" "+h+" /></a><br/><br/>"}else{imgstr+="<a href='"+linkPic+"' target='_blank'><img src='"+picUrl+"' style='margin: 0pt auto;display:block' "+w+" "+h+"/></a><br/><br/>"}break;case"right":imgstr+="<a href='"+linkPic+"' target='_blank'><img src='"+picUrl+"' align='right' "+w+" "+h+"/></a><br style='clear:both'/><br/>";break}}else{imgstr+="<a href='"+linkPic+"' target='_blank'><img src='"+picUrl+"' "+w+" "+h+" /></a><br/><br/>"}}else{if(imgPrarm.position){switch(imgPrarm.position){case"left":if($IE){imgstr+="<img src='"+picUrl+"' onload=\"if(this.clientWidth>690)this.style.width='690px';\" "+w+" "+h+"/><br/><br/>"}else{imgstr+="<img src='"+picUrl+"' style='max-width:690px;' "+w+" "+h+"/><br/>"}break;case"center":if($IE){imgstr+="<img src='"+picUrl+"' style='text-align:center;display:block' onload=\"if(this.clientWidth>690)this.style.width='690px';\" "+w+" "+h+"/><br/><br/>"}else{imgstr+="<img src='"+picUrl+"' style='max-width:690px;margin:0pt auto;display:block' "+w+" "+h+"/><br/>"}break;case"right":if($IE){imgstr+="<img src='"+picUrl+"' onload=\"if(this.clientWidth>690)this.style.width='690px';\" align='right' "+w+" "+h+"/><br style='clear:both'/><br/>"}else{imgstr+="<img src='"+picUrl+"' style='max-width:690px;' align='right' "+w+" "+h+"/><br style='clear:both'/>"}break}}else{if($IE){imgstr+="<img src='"+picUrl+"' onload=\"if(this.clientWidth>690)this.style.width='690px';\" "+w+" "+h+"/><br/><br/>"}else{imgstr+="<img src='"+picUrl+"' style='max-width:690px;' "+w+" "+h+"/><br/>"}}}}if(imgPrarm.size){imgstr=this.replaceSize(imgstr,imgPrarm.size)}return imgstr},replaceSize:function(url,size){var size=size||"mw690";return url.replace(/(\/)((square)|(middle)|(bmiddle)|(small))(\/)/gi,"/"+size+"/")},replaceParam:function(url){if(/&690$/.test(url)){return url}else if(url.indexOf("photo.sina")!=-1||url.indexOf("sinaimg.cn")!=-1){url=url.replace(/&00[0-9]|$/,"&690")}return url},checkPicSize:function(w,h,size){var size=size||"mw690";var t={w:w,h:h};if(w<=490&&w>=200){if(size=="small"){t.w=200;t.h=Math.round(h/w*200)}}else if(w>490){if(size=="small"){t.w=200;t.h=Math.round(h/w*200)}if(size=="bmiddle"){t.w=490;t.h=Math.round(h/w*490)}}return t},replaceTemplateImage:function(aIMGList,sinaIMGList,dialogName){var dialogName=dialogName||"templateDialog";var url=this.replaceParam(aIMGList[0]);trace(editor.templateImageId);var ele=editor.iframeDocument.getElementById(editor.templateImageId);url=this.replaceSize(url,"bmiddle");ele.src=url;ele.id="";ele.title="";ele.removeAttribute("name");editor.iframeWindow.focus();ele.removeAttribute("width");ele.removeAttribute("height");ele.style.width="";ele.style.height="";var parentNode=ele.parentNode;if(parentNode.nodeName.toLowerCase()=="a"){var pidReg=/(\/)([a-f0-9]{8})[a-z0-9]{13}/gi;var pid=url.match(pidReg)[0].substr(1);parentNode.href=parentNode.href.replace(pidReg,"$1"+pid)}window[dialogName].hidden()}}});Utils.Form.functionlimit=function(oNode,func,noKeyUP){var keyup=function(){var ov=oNode.value;oNode.value=func(ov)};if(!noKeyUP){Core.Events.addEvent(oNode,Core.Function.bind3(keyup,oNode),"keyup")}Core.Events.addEvent(oNode,Core.Function.bind3(keyup,oNode),"blur")};$registJob("format_title",function(){var titleEle=$E("articleTitle");Utils.Form.limitMaxLen(titleEle,96);Utils.Form.functionlimit(titleEle,Core.String.trim,true)});Core.System.getParam=function(name){var arr=window.location.search.match(new RegExp("(\\?|&)"+name+"=([^&]*)(&|$)"));if(arr!=null)return unescape(arr[2]);return null};$registJob("insert_to_editor",function(){var ctg_id=Core.System.getParam("ctg_id");if(ctg_id){editor.operate.ctg_id=ctg_id;editor.operate.img()}var vid=Core.System.getParam("videoId");var vtitle=getParam("videoTitle");var vURL=Core.System.getParam("videoUrl");var html;if(vid&&!vURL){html='<div><object width="480" height="370" >\r\n		<param name="allowScriptAccess" value="always" />\r\n		<embed pluginspage="http://www.macromedia.com/go/getflashplayer"\r\n			   src="http://you.video.sina.com.cn/api/sinawebApi/outplayrefer.php/vid='+vid+'/s.swf"\r\n			   type="application/x-shockwave-flash"\r\n				name="ssss"\r\n				 wmode="transparent"\r\n				allowFullScreen="true" \r\n				allowScriptAccess="always" \r\n				width="480"\r\n				height="370">\r\n		</embed></object></div>';editor.insertHTML(html)}else if(vURL){Utils.Io.JsLoad.request("http://video.sina.com.cn/api/sinaVideoApi.php",{GET:{pid:60,data:"json",url:vURL},onComplete:function(data){if(data&&data.result===1){html='<div><object width="480" height="370" >\r\n					<param name="allowScriptAccess" value="always" />\r\n					<embed pluginspage="http://www.macromedia.com/go/getflashplayer"\r\n						   src="'+data.playswf+'"\r\n						   type="application/x-shockwave-flash"\r\n							name="ssss"\r\n							 wmode="transparent"\r\n							allowFullScreen="true" \r\n							allowScriptAccess="always" \r\n							width="480"\r\n							height="370">\r\n					</embed></object></div>';editor.insertHTML(html)}}})}if(vtitle){$E("articleTitle").value="分享视频："+vtitle}var isImgEdit=Core.System.getParam("imgedit");if(isImgEdit){this.userData=new Utils.UserData;var imgData=this.userData.load("image_edit_data_"+scope.$uid,["content"]);if(imgData.content){editor.insertHTML(imgData.content);this.userData.clear("image_edit_data_"+scope.$uid,["content"]);editor.initImageOpertae()}}function getParam(name){var arr=window.location.search.match(new RegExp("(\\?|&)"+name+"=([^&]*)(&|$)"));if(arr!=null)return decodeURI(arr[2]);return null}});scope.faceOperate={container_id:"face_container",show_dia_id:"show_dialog_id",hot_container:"fd_hot_list",hot_in_container:"fd_hot_in_list",high_container:"fd_high_list",in_container:"fd_in_list",high_page_container:"fd_high_page",in_page_container:"fd_in_page",tab_container:"fd_tab",high_content:"fd_tab_high_con",in_content:"fd_tab_in_con",pop:"371",high:"372",iny:"373",morehigh:"374",moreiny:"375",logType:{pop:[17,18,19,20,21,22,23,24,25],more:"26",tool:"27",dialog:"28"},highpage:55,inypage:8,inyCount:2,highCount:12,popCount:9,itemTemp:'<li><a href="#" onclick="scope.faceOperate.toEditor();return false"><img title="#{name}" src="#{imgSrc}"></a></li>',itemTemp_name:'<li onclick="scope.faceOperate.toEditor()">#{divStart}<span><img onmouseover="scope.faceOperate.onmouseIn()" onmouseout="scope.faceOperate.onmouseOut()" title="#{name}" src="#{imgSrc}"></span><p onmouseover="scope.faceOperate.onmouseIn()" onmouseout="scope.faceOperate.onmouseOut()">#{name}</p>#{divEnd}</li>',toEditor:function(){var ele=Core.Events.getEventTarget();var parent=this.getLiEle(ele);var txt;if($IE){txt=parent.innerText}else{txt=parent.textContent}var type=ele.tagName.toLowerCase();if(type!="img"){ele=parent.getElementsByTagName("img")[0]}this.sendLog(ele);var html="";if(txt==""){html='<img type="face" src="'+ele.src+'">'}else{html='<img type="face" src="'+ele.src+'">'+txt}editor.insertHTML(html);var dialog=winDialog.getDialog("face");if(dialog){dialog.hidden()}},sendLog:function(ele){var type="08_";var liEle=this.getLiEle(ele);var ulEle=liEle.parentNode;var reg=/.*\/(E[^\.]*).gif/gi;if(ulEle.id==this.container_id){var uls=ulEle.childNodes;var len=uls.length;for(var i=0;i<len;i++){if(liEle==uls[i]){type+=this.logType.pop[i];break}}}else{type+=this.logType.dialog}type+="_010_"+ele.src.replace(reg,"$1");v7sendLog(type,scope.$pageid,"editorFace")},renderList:function(container,_type,listType,_page){var it;var type=_type;var page=_page||1;if(listType&&listType=="name"){it=new Ui.Template(this.itemTemp_name)}else{it=new Ui.Template(this.itemTemp)}var html="",pageData;var _data=this.getData(type).data;var _len=_data.length;var max,data,len;switch(type){case"morehigh":var h_at=(page-1)*this.highpage;pageData=_data.slice(h_at,h_at+this.highpage);max=this.highpage;break;case"moreiny":var i_at=(page-1)*this.inypage;pageData=_data.slice(i_at,i_at+this.inypage);max=this.inypage;break;case"iny":pageData=_data.slice(0,this.inyCount);break;case"high":pageData=_data.slice(0,this.highCount);break;case"pop":pageData=_data.slice(0,this.popCount);break}data=pageData;len=data.length;if(!max){max=len}var at=0;for(var i=0;i<len;i++){var d={imgSrc:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/"+data[i].code+"G.gif",name:data[i].name};if(type=="moreiny"){d.divStart='<div class="facein_bg">';d.divEnd="</div>"}else{d.divStart="";d.divEnd=""}html+=it.evaluate(d);if(at>=max){break}at++}container.innerHTML=html},getData:function(type){trace("getData:type:"+type);return this.data[this[type]]},getLiEle:function(ele){while(true){var tagName=ele.tagName.toLowerCase();trace(tagName);if(tagName=="li"){return ele}ele=ele.parentNode}},onmouseIn:function(){var ele=Core.Events.getEventTarget();this.getLiEle(ele).className="hover"},onmouseOut:function(){var ele=Core.Events.getEventTarget();this.getLiEle(ele).className=""}};Editor.Plugins.FacePage=Core.Class.create();Editor.Plugins.FacePage.prototype={count:0,pageSize:0,total_id:"ep_t_",next_id:"ep_n_",back_id:"ep_b_",initialize:function(parentNode,count,pageSize,callbackFunc){this.id=Core.Math.getUniqueId();this.parentNode=parentNode;this.count=count;this.pageSize=pageSize;this.callbackFunc=callbackFunc;this.initTemplate();this.page(1)},initTemplate:function(){this.con_temp='<ul class="SG_pages">#{back}<li class="SG_s_pgnum">#{at}/#{total}</li>#{next}</ul>';this.back_temp='<li class="SG_s_pgprev"><a href="#" onclick="return false" id="'+this.back_id+this.id+'">上一页</a></li>';this.next_temp='<li class="SG_s_pgnext"><a href="#" onclick="return false" id="'+this.next_id+this.id+'">下一页</a></li>'},page:function(_at){var data={};data.at=_at||1;if(this.count%this.pageSize==0){data.total=this.count/this.pageSize}else{data.total=parseInt(this.count/this.pageSize)+1}if(data.total<=1){this.callbackFunc(data.at);return}data.id=this.id;if(data.at==1){data.back=""}else{data.back=this.back_temp}if(data.at==data.total){data.next=""}else{data.next=this.next_temp}var temp=new Ui.Template(this.con_temp);this.parentNode.innerHTML=temp.evaluate(data);this.callbackFunc(data.at);if(data.next!=""){Core.Events.addEvent($E(this.next_id+this.id),Core.Function.bind3(this.page,this,[data.at+1]))}if(data.back!=""){Core.Events.addEvent($E(this.back_id+this.id),Core.Function.bind3(this.page,this,[data.at-1]))}}};Editor.Plugins.FaceDialog=Core.Class.create();Editor.Plugins.FaceDialog.prototype={initialize:function(){this.initDialog();this.initTab();this.renderAllList()},renderAllList:function(){scope.faceOperate.renderList($E(scope.faceOperate.hot_container),"high");scope.faceOperate.renderList($E(scope.faceOperate.hot_in_container),"iny","name");var mh_page=new Editor.Plugins.FacePage($E(scope.faceOperate.high_page_container),scope.faceOperate.getData("morehigh").data.length,scope.faceOperate.highpage,this.randerMoreHighList.bind2(this));var mhi_page=new Editor.Plugins.FacePage($E(scope.faceOperate.in_page_container),scope.faceOperate.getData("moreiny").data.length,scope.faceOperate.inypage,this.randerMoreInList.bind2(this))},randerMoreHighList:function(_page){var page=_page||1;scope.faceOperate.renderList($E(scope.faceOperate.high_container),"morehigh","",page)},randerMoreInList:function(_page){var page=_page||1;scope.faceOperate.renderList($E(scope.faceOperate.in_container),"moreiny","name",page)},initDialog:function(){var _this=this;var tpl=['<table id="#{entity}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}"></strong>','<cite><a title="关闭" class="CP_w_shut" id="#{btnClose}" href="javascript:;" onclick="return false">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span/></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}">',"</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join("");this.dialog=winDialog.createCustomsDialog({tpl:tpl,title:"博文表情",content:_this.initBaseHtml(),width:500},"face");this.dialog.setMiddle().setAreaLocked(true).addEventListener("beforeShow",function(){this.setMiddle()}).show()},show:function(){this.dialog.show()},initTab:function(){this.tab=new Tabs($E(scope.faceOperate.tab_container),{});highTab=new Tab("<div><em>更多精彩表情</em></div>",{isFocus:true,className:"cur"});inTab=new Tab("<div><em>更多精彩IN语</em></div>",{isFocus:false,className:"cur"});highTab.addOnAbort(Core.Function.bind3(swapTab,this,[scope.faceOperate.high_content,"hidden"]));inTab.addOnAbort(Core.Function.bind3(swapTab,this,[scope.faceOperate.in_content,"hidden"]));

highTab.addOnFocus(Core.Function.bind3(swapTab,this,[scope.faceOperate.high_content]));inTab.addOnFocus(Core.Function.bind3(swapTab,this,[scope.faceOperate.in_content]));this.tab.add(highTab);this.tab.add(inTab);function swapTab(tabContentId,type){if(type&&type=="hidden"){$E(tabContentId).style.display="none"}else{$E(tabContentId).style.display=""}}},initBaseHtml:function(){var html='<div style="width: 440px;" class="CP_layercon2">\r\n			<div class="facein">\r\n            	<div class="facein_line1">\r\n                	<div class="facein_hot">\r\n                    	<div class="facein_tit">最热门表情</div>\r\n                        <div class="facein_hotlist">\r\n                        	<ul id="'+scope.faceOperate.hot_container+'">\r\n                            </ul>\r\n                        </div>\r\n                    </div>\r\n                    <div class="facein_in">\r\n                    	<div class="facein_tit">最潮IN语</div>\r\n                        <div class="facein_inlist">\r\n                        	<ul id="'+scope.faceOperate.hot_in_container+'">\r\n                            </ul>\r\n                        </div>\r\n                    </div>\r\n                    <div class="clearit"></div>\r\n                </div>\r\n                <div class="facein_line2">\r\n                <div class="CP_w_tag" id="'+scope.faceOperate.tab_container+'">\r\n                </div>\r\n                    <div class="insertface_hot">\r\n                    </div>\r\n                    <div class="faceinContent" id="'+scope.faceOperate.high_content+'">\r\n                        <div class="facein_hotlist">\r\n                        	<ul id="'+scope.faceOperate.high_container+'">\r\n                            </ul>\r\n                        </div>\r\n                        <div class="SG_page" id="'+scope.faceOperate.high_page_container+'">\r\n                        </div>\r\n                    </div>\r\n                    <div style="display: none;" class="faceinContent" id="'+scope.faceOperate.in_content+'">\r\n                        <div class="facein_inlist">\r\n                        	<ul id="'+scope.faceOperate.in_container+'">\r\n                            </ul>\r\n                        </div>\r\n                    	<div class="SG_page" id="'+scope.faceOperate.in_page_container+'">\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n		</div>';return html}};Editor.Plugins.FaceMain=Core.Class.create();Editor.Plugins.FaceMain.prototype={url:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/smileContentConfig.js",varname:"smileContentConfig",initialize:function(parentNode){this.initContainer(parentNode);this.initFace()},initFace:function(){this.loadData()},renderList:function(){var html="";scope.faceOperate.renderList($E(scope.faceOperate.container_id),"pop");html='<li class="moreface"><a href="#" onclick="return false" id="'+scope.faceOperate.show_dia_id+'"><img alt="" src="http://simg.sinajs.cn/blog7style/images/common/editor/facemore.gif"></a></li>';Core.Dom.addHTML($E(scope.faceOperate.container_id),html);Core.Events.addEvent($E(scope.faceOperate.show_dia_id),function(){v7sendLog("08_"+scope.faceOperate.logType.more+"_000_000",scope.$pageid,"editorFace");this.showDialog()}.bind2(this))},showDialog:function(){if(!this.dialog){this.dialog=new Editor.Plugins.FaceDialog}this.dialog.show()},loadData:function(){Utils.Io.JsLoad.request([{url:this.url+"?"+Math.random(),charset:"gbk"}],{onComplete:function(data){scope.faceOperate.data=window[this.varname];this.renderList()}.bind2(this)})},initContainer:function(parentNode){var c_html='<div class="module_face"><div class="module_facelist"><ul id="'+scope.faceOperate.container_id+'"></ul></div></div>';Core.Dom.insertHTML(parentNode,c_html,"beforebegin")}};$registJob("editor_face",function(){window.editorFace=new Editor.Plugins.FaceMain($E("shortcut"))});Lib.applyIf=function(o,s,defaults){if(defaults){Lib.applyIf(o,defaults)}if(o&&s&&Lib.isObject(s)){for(var p in s){if(s.hasOwnProperty(p)&&!o[p]){o[p]=s[p]}}}return o};Lib.isObject=function(o){return Object.prototype.toString.call(o)==="[object Object]"};Lib.apply=function(o,ref,defaults,deep,original){if(defaults){Lib.applyIf(o,defaults)}for(var p in ref){if(original&&o[p]&&!Lib.isObject(o[p])){continue}if(ref.hasOwnProperty(p)){if(deep&&Lib.isObject(ref[p])){o[p]=Lib.apply(o[p]||{},ref[p],deep,original)}else{o[p]=ref[p]}}}return o};Lib.HtmlTemplate=function(tmpl,uniqueID){this.uniqueID=uniqueID}.$extends(Ui.Template).$define({getHtmlString:function(){if(!this._htmlStr){this._htmlStr=this.evaluate(this.getNodeIds())}return this._htmlStr},getNodeIds:function(){if(!this._nodes){var p=/\{[^\}]+(?=\})/g,i,nodes={},rets,r,uniqueID=this._getUniqueID();this.__templateNodesIDs=this.tmpl.match(p);rets=this.__templateNodesIDs;if(rets){i=rets.length;while(i--){r=rets[i].replace("{","");nodes[r]="_"+uniqueID+"_"+r}}this._nodes=nodes}return this._nodes},getNodeId:function(name){if(!this._nodes){this.getNodeIds()}return this._nodes[name]},getNode:function(name){var id=this.getNodeId(name);return!id?null:$E(id)},_getUniqueID:function(){if(!this.uniqueID){this.uniqueID=parseInt(Math.random()*1e3).toString()+(new Date).getTime().toString()}return this.uniqueID}});Lib.Panel=Core.Class.create();Lib.Panel.prototype={noIframe:!1,isPostion:!0,appendTo:null,entity:null,backIframe:null,uniqueID:null,isFixed:false,isShow:!1,isHidden:!0,x:0,y:0,template:"",initialize:function(cfg){Lib.apply(this,cfg);var _this=this;this.uniqueID=this._getUniqueID();this._ie6Fixed=function(){if(_this.entity){_this.entity.style.left=document.documentElement.scrollLeft+_this.x+"px";_this.entity.style.top=document.documentElement.scrollTop+_this.y+"px"}if(_this.backIframe){_this.backIframe.style.left=_this.entity.style.left;_this.backIframe.style.top=_this.entity.style.top}}},getNode:function(name){return this.tpl.getNode(name)},setTemplate:function(template){this.template=template;if(this.entity&&this.entity.parentNode){this.entity.parentNode.removeChild(this.entity);this.backIframe&&this.backIframe.parentNode.removeChild(this.backIframe)}this.entity=$C("div");var tempEntity=$C("div");var tmp=new Lib.HtmlTemplate(this.template,this.uniqueID);this.tpl=tmp;tempEntity.innerHTML=tmp.getHtmlString();tempEntity.style.display="none";if(this.appendTo){$E(this.appendTo).appendChild(tempEntity)}else{document.body.appendChild(tempEntity)}this.entity=$E("_"+this.uniqueID+"_panel");if(this.isPostion){this.entity.style.position="absolute"}this.entity.style.display="none";if(this.appendTo){$E(this.appendTo).replaceChild(this.entity,tempEntity)}else{document.body.replaceChild(this.entity,tempEntity)}tempEntity=null;if(!this.noIframe){this.backIframe=$C("iframe");this.backIframe.style.display="none";this.backIframe.style.border="none";this.backIframe.style.zIndex=this.entity.style.zIndex-1;document.body.appendChild(this.backIframe);this._updateBackIframe()}},setPosition:function(x,y){this.x=x;this.y=y;this.entity.style.left=x+"px";this.entity.style.top=y+"px";if($IE6&&this.isFixed){this.entity.style.left=x+document.documentElement.scrollLeft+"px";this.entity.style.top=y+document.documentElement.scrollTop+"px"}if(this.backIframe){this.backIframe.style.left=this.entity.style.left;this.backIframe.style.top=this.entity.style.top}},setFixed:function(state){this.isFixed=state;if($IE6){var _this=this;this.entity.style.position="absolute";if(this.isFixed){_this._ie6Fixed();Core.Events.addEvent(window,_this._ie6Fixed,"scroll")}else{Core.Events.removeEvent(window,_this._ie6Fixed,"scroll")}return}this.entity.style.position=this.isFixed?"fixed":"absolute";if(this.backIframe){this.backIframe.style.position=this.entity.style.position}},show:function(){this.entity.style.display="";this.isHidden=!1;this.isShow=!0;if(this.backIframe){this._updateBackIframe();this.backIframe.style.display=""}},hidden:function(){this.hide()},hide:function(){this.entity.style.display="none";this.isHidden=!0;this.isShow=!1;if(this.backIframe){this.backIframe.style.display="none"}},close:function(){this.hidden();this.destroy()},destroy:function(){Core.Events.removeEvent(window,this._ie6Fixed,"scroll");this.entity.parentNode.removeChild(this.entity);this.entity=null;if(this.backIframe){this.backIframe.parentNode.removeChild(this.backIframe);this.backIframe=null}},showWithDom:function(dom,offsetLeft,offsetTop){var x=Core.Dom.getLeft(dom)+dom.offsetWidth+offsetLeft;var y=Core.Dom.getTop(dom)+dom.offsetHeight+offsetTop;if($IE6&&this.isFixed){x=x-document.documentElement.scrollLeft;y=y-document.documentElement.scrollTop}this.setPosition(x,y);this.show()},getWidth:function(){var ld=this.entity.style.display;var lv=this.entity.style.visibility;this.entity.style.visibility="hidden";this.entity.style.display="";w=this.entity.offsetWidth;this.entity.style.display=ld;this.entity.style.visibility=lv;return w},getHeight:function(){var ld=this.entity.style.display;var lv=this.entity.style.visibility;this.entity.style.visibility="hidden";this.entity.style.display="";h=this.entity.offsetHeight;this.entity.style.display=ld;this.entity.style.visibility=lv;return h},getX:function(){return parseInt(this.entity.style.left)},getY:function(){return parseInt(this.entity.style.top)},getNodes:function(mode){var m=mode||"o";var pattern=/[^\{\}]+(?=\})/g;var i;var nodes={};var result=this.template.match(pattern);if(result){for(i=0;i<result.length;i++){var r=result[i];switch(m){case"o":nodes[r]=$E("_"+this.uniqueID+"_"+r);break;case"i":nodes[r]="_"+this.uniqueID+"_"+r;break}}}return nodes},_updateBackIframe:function(){Core.Dom.setStyle(this.backIframe,"opacity",0);this.backIframe.style.display="";this.backIframe.style.position=this.entity.style.position;this.backIframe.style.width=this.entity.offsetWidth+"px";this.backIframe.style.height=this.entity.offsetHeight+"px";this.backIframe.style.left=this.entity.style.left;this.backIframe.style.top=this.entity.style.top},_getUniqueID:function(){return parseInt(Math.random()*1e3).toString()+(new Date).getTime().toString()}};Lib.register("util.JSON",function(lib){var json=function(wnd,undefined){if(wnd.JSON)return wnd.JSON;var json={parse:function(sJSON){return new Function("return "+sJSON)()},stringify:function(vContent){if(vContent instanceof Object){var sOutput="";if(vContent.constructor===Array){for(var nId=0;nId<vContent.length;sOutput+=this.stringify(vContent[nId])+",",nId++);return"["+sOutput.substr(0,sOutput.length-1)+"]"}if(vContent.toString!==Object.prototype.toString){return'"'+vContent.toString().replace(/"/g,"\\$&")+'"'}for(var sProp in vContent){sOutput+='"'+sProp.replace(/"/g,"\\$&")+'":'+this.stringify(vContent[sProp])+","}return"{"+sOutput.substr(0,sOutput.length-1)+"}"}return typeof vContent==="string"?'"'+vContent.replace(/"/g,"\\$&")+'"':String(vContent)}};return json}(window);return json});Lib.pkg("util");Lib.util.hoverJq=function(conf){var _default={elm:document.body,mouseenter:function(evt,el,index){},mouseleave:function(evt,el,index){},delay:0};conf=Lib.apply(_default,conf);var enterType=$IE?"mouseenter":"mouseover",leaveType=$IE?"mouseleave":"mouseout";if(!("length"in conf.elm)){conf.elm=[conf.elm]}else{try{conf.elm=Array.prototype.slice.call(conf.elm,0)}catch(e){var tmpArr=[];for(var i=0,len=conf.elm.length;i<len;i++){tmpArr.push(conf.elm[i])}conf.elm=tmpArr}}Core.Array.foreach(conf.elm,function(one,index){Core.Events.removeEvent(one,enterType);Core.Events.removeEvent(one,leaveType);Core.Events.addEvent(one,function(el,func,i){return function(evt){evt=evt||window.event;if($IE){func.apply(el,[evt,el,i])}else{withinElement(evt,"mouseenter",el,i)}}}(one,conf[enterType],index),enterType);Core.Events.addEvent(one,function(el,func,i){return function(event){if($IE){func.apply(el,[event,el,i])}else{withinElement(event,"mouseleave",el,i)}}}(one,conf[leaveType],index),leaveType)});var withinElement=function(event,mouseType,elm,i){var parent=event.relatedTarget;try{if(parent&&parent!==document&&!parent.parentNode){return}while(parent&&parent!==elm){parent=parent.parentNode}if(parent!==elm){conf[mouseType].apply(elm,[event,elm,i])}}catch(e){}return false}};Lib.register("tray.tpl.loginMemu",function(){var tpl=['<div class="ntopbar_menu" id="#{panel}">','<div id="#{openBlog}" style="display:none;">','<span class="link" id="#{userMenu}"><a id="#{userNick}" onclick="v7sendLog(\'40_01_21\');return false;" href="###">读取中...</a><a href="javascript:;" class="link_arrow" title=""></a></span>','<span id="#{msnHolder}" class="ico_msn" style="display:none"><a id="#{msnLink}" href="http://control.blog.sina.com.cn/blogprofile/msnbind.php?c=" target="_blank"><img height="18" width="18" align="absmiddle" class="SG_icon SG_icon136" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif"></a></span>','<span class="line_s"></span>','<span class="link"><a onclick="v7sendLog(\'40_01_27\')" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1">个人中心</a></span>','<span class="line_s"></span>','<em id="#{newFeed}" class="mtip" style="left:341px;display:none;cursor:pointer;"></em>','<span class="link" id="#{blogMenu}"><a target="_blank" onclick="v7sendLog(\'40_01_24\')" href="http://control.blog.sina.com.cn/admin/article/article_add.php">发博文</a><a id="#{addArticle}" onclick="v7sendLog(\'40_01_25\');return false;" href="###" class="link_arrow"></a></span>','<span class="line_s"></span>','<span class="link" id="#{trayMsg}" msg-panel-show-state="0"><a onclick="v7sendLog(\'40_01_30\');return false;" href="###">消息</a><a href="javascript:return false;" class="link_arrow" title=""></a></span>','<em id="#{newTips}" onclick="v7sendLog(\'40_01_29\')" class="mtip" style="left:341px;display:none;cursor:pointer;"></em>',"</div>",'<div id="#{noOpenBlog}" style="display:none;">','<span class="link"><a id="#{ssoNick}" onclick="v7sendLog(\'40_01_40\');return false;" href="###">读取中...</a></span>','<span class="line_s"></span>','<span class="link"><a id="#{ssoLoginOut}" onclick="v7sendLog(\'40_01_41\');return false;" href="###">退出</a></span>','<div class="ntopbar_login" style="float:left;"><a id="#{openBlogBtn}" onclick="v7sendLog(\'40_01_42\')" class="login" href="###"><span>立即拥有一个新博客</span></a></div>',"</div>","</div>"].join("");return tpl});Lib.register("tray.tpl.loginOutMemu",function(){var uid=scope.$uid||"";var regLink="http://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid="+uid+"&src=";if(scope.$channel==2){regLink+="baby"}else{regLink+="blogicp"}var tpl=['<div id="#{panel}" class="ntopbar_login">','<a class="login" onclick="v7sendLog(\'40_01_38\');return false;" href="###" action-type="tray-login-btn"><span>登录</span></a>','<a class="register" onclick="v7sendLog(\'40_01_39\')" target="_blank" href="',regLink,'">注册</a></div>'].join("");return tpl});Core.Class.define=function(init,superClz,methods){if(init&&init.__isClass&&init.__isClass()){throw new Error("class cnt be used as another class' constructor : "+init)}superClz=superClz||Object;methods=methods||{};methods.initialize=init||methods.initialize||superClz.prototype.initialize||function(){};if(typeof methods.initialize!="function"){throw new Error("only function can be used as constructor")}methods.__isClass=function(){return true};var clz=Core.Class.create();clz.__isClass=methods.__isClass;var proto=superClz==Object?{}:new superClz(Core.Class.AsPrototype);clz.prototype=Core.Class.extend(proto,methods);return clz};Lib.register("tray.tpl.userMenu",function(){var tpl=['<div id="#{panel}" class="mUserMenu">',"<ul>","<li>",'<span class="tb_ps_nm"><a id="#{linkBlog}" onclick="v7sendLog(\'40_01_22\')" href="###"><img class="SG_icon SG_icon15" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="博客" align="absmiddle">博客</a></span>','<span class="rlink"><a target="_blank" onclick="v7sendLog(\'40_01_22\')" id="#{linkPostBlog}" href="http://control.blog.sina.com.cn/admin/article/article_add.php">发博文</a></span>',"</li>",'<li> <span class="tb_ps_nm"><a id="#{linkPhoto}" onclick="v7sendLog(\'40_01_22\')" href="###"><img class="SG_icon SG_icon18" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="相册" align="absmiddle">相册</a></span> <span class="rlink"><a target="_blank" id="#{linkPostPhoto}" onclick="v7sendLog(\'40_01_22\')" href="http://photo.blog.sina.com.cn/upload/upload.php">发图片</a></span> </li>','<li> <span class="tb_ps_nm"><a id="#{miniblog}" onclick="v7sendLog(\'40_01_22\')" href="###" target="_blank"><img class="SG_icon SG_icon110" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="17" title="微博" align="absmiddle">微博</a></span> </li>','<li style="display:none;" id="#{mail}"> <span class="tb_ps_nm"><a id="#{bindEmail}" target="_blank" href="http://mail.sina.com.cn/?s=2" onclick="v7sendLog(\'40_01_22\')"><img class="SG_icon SG_icon212" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="13" title="邮件" align="absmiddle">邮件</a></span> </li>','<li> <span class="tb_ps_nm"><a id="#{mySpace}" onclick="v7sendLog(\'40_01_22\')" href="###"><img class="SG_icon SG_icon41" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="关于我" align="absmiddle">关于我</a></span> </li>',"</ul>",'<div class="links">','<p><a target="_blank" id="#{linkChangeFace}" onclick="v7sendLog(\'40_01_22\')" href="###">修改头像昵称&gt;&gt;</a></p>','<p><a target="_blank" id="#{linkChangePassword}" onclick="v7sendLog(\'40_01_22\')" href="###">修改登录密码&gt;&gt;</a></p>','<p><a target="_blank" id="#{linkAccountSetup}" onclick="v7sendLog(\'40_01_22\')" href="###">帐号安全设置&gt;&gt;</a></p>','<p><a id="#{loginOut}" onclick="v7sendLog(\'40_01_23\');return false;" href="#">退出&gt;&gt;</a></p>',"</div>","</div>"].join("");return tpl});Lib.register("tray.loginOut",function(lib){var ls=lib.Listener;return function(cb,reload){var _curHref=encodeURIComponent(window.location.href);new Interface("http://control.blog.sina.com.cn/blog_rebuild/msn/api/msnLoginOut.php","jsload").request({onSuccess:function(res){ls.notify("global-login-out",res);cb&&cb(res);if(reload){window.location.href="http://login.sina.com.cn/cgi/login/logout.php?r="+_curHref}},onError:function(res){ls.notify("global-login-out",res);if(reload){window.location.href="http://login.sina.com.cn/cgi/login/logout.php?r="+_curHref}},onFail:function(res){ls.notify("global-login-out",res);if(reload){window.location.href="http://login.sina.com.cn/cgi/login/logout.php?r="+_curHref}}})}});Lib.register("tray.UserMenuPanel",function(lib){var userMenu=Core.Class.define(function(){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.userMenu)},lib.Panel,{initUserInfo:function(uid){var nodes=this.getNodes();nodes["linkBlog"].href="http://blog.sina.com.cn/u/"+uid;nodes["linkPhoto"].href="http://photo.blog.sina.com.cn/u/"+uid;nodes["miniblog"].href="http://control.blog.sina.com.cn/t_sina_blog/tb.php?uname="+uid;nodes["mySpace"].href="http://blog.sina.com.cn/s/profile_"+uid+".html";nodes["linkChangeFace"].href="http://control.blog.sina.com.cn/blogprofile/nick.php";nodes["linkChangePassword"].href="http://login.sina.com.cn/member/security/password.php";nodes["linkAccountSetup"].href="http://login.sina.com.cn/member/security.php";this.initLoginOut(nodes["loginOut"])},initLoginOut:function(outBtn){outBtn.onclick=function(){return false};Core.Events.addEvent(outBtn,function(){lib.tray.loginOut(null,!0)})}});return userMenu});Lib.register("tray.tpl.blogMenu",function(){var tpl=['<div id="#{panel}" class="wrtBlog_sub">','<div class="wrtBlog_sub3">','<p><a target="_blank" onclick="v7sendLog(\'40_01_26\')" href="http://control.blog.sina.com.cn/admin/article/article_add.php?tag365">写365</a></p>','<p><a target="_blank" onclick="v7sendLog(\'40_01_26\')" href="http://control.blog.sina.com.cn/admin/article/changWeiBo.php">长微博</a></p>','<p><a target="_blank" onclick="v7sendLog(\'40_01_26\')" href="http://photo.blog.sina.com.cn/upload/upload.php">发照片</a></p>',"</div>","</div>"].join("");return tpl});Lib.register("tray.BlogMenuPanel",function(lib){var blogMenu=Core.Class.define(function(){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.blogMenu)},lib.Panel,{});return blogMenu});Lib.register("tray.tpl.searchForm",function(){var tpl=['<div class="ntopbar_input" id="#{panel}">','<form id="#{searchForm}" method="get" target="_blank" action="http://search.sina.com.cn">','<input id="#{queryTxt}" class="ntopbar_txt" type="text" name="q" autocomplete="off"/>','<input id="#{submit}" type="submit" onclick="v7sendLog(\'40_01_44\')" class="ntopbar_searchBtn" value=""/>','<input type="hidden" name="ie" value="utf-8"/>','<input type="hidden" name="e" value="utf-8"/>','<input id="#{range}" type="hidden" name="range" value="article"/>','<input id="#{t}" type="hidden" name="t" value=""/>','<input id="#{s}" type="hidden" name="s" value="sup"/>','<input id="#{by}" type="hidden" name="by" value="all"/>','<input id="#{type}" type="hidden" name="type" value=""/>','<input id="#{stype}" type="hidden" name="stype" value="1"/>','<input id="#{c}" type="hidden" name="c" value="blog"/>',"</form>","</div>"].join("");return tpl});Core.Dom.addClass=function(obj,className){var _trim=Core.String.trim;className=_trim(className);if(!className){return obj}obj=$E(obj);var oldClz=_trim(obj.className||"");var tmpOldClz=" "+oldClz+" ";if(!oldClz){obj.className=_trim(className);return obj}var uClzs=className.split(" ");var uClz,newClzs=[];for(var i=0;i<uClzs.length;i++){uClz=uClzs[i];if(uClz&&-1===tmpOldClz.indexOf(" "+uClz+" ")){newClzs.push(uClz)}}obj.className=oldClz+" "+newClzs.join(" ");return obj};Core.Dom.removeClass=function(obj,className){obj=$E(obj);obj.className=obj.className.replace(new RegExp("\\s*\\b"+className+"\\b"),"")};Lib.util.getActionData=function(evt,actionType,typeAttrName,dataAttrName){if(!actionType){throw"[Lib.util.getActionData] param actionType is undefined!"}evt=evt||window.event;var _getTarget=Core.Events.getEventTarget,tEl,delegateEl,typeStr,types,type,data,typeAttrName=typeAttrName||"action-type",dataAttrName=dataAttrName||"action-data";tEl=_getTarget(evt);delegateEl=evt.currentTarget||(document.documentElement||document.body);while(tEl&&tEl!=delegateEl){typeStr=tEl.getAttribute(typeAttrName)||"";types=typeStr.split(",");for(var i=0,len=types.length;i<len;i++){type=types[i];if(actionType===type){data=tEl.getAttribute(dataAttrName);return{actionType:actionType,targetEl:tEl,data:data}}}tEl=tEl.parentNode}return null};Lib.register("tray.tpl.cateSearch",function(){var tpl=['<div id="#{panel}" class="mCatSearch">',"<ul>",'<li action-type="tray-search" onclick="v7sendLog(\'40_01_43\')" action-data="article" class="current">含“<span id="#{article}"></span>”的博文</li>','<li action-type="tray-search" onclick="v7sendLog(\'40_01_43\')" action-data="bloger">含“<span id="#{bloger}"></span>”的博主</li>','<li action-type="tray-search" onclick="v7sendLog(\'40_01_43\')" action-data="music">含“<span id="#{music}"></span>”的音乐</li>','<li action-type="tray-search" onclick="v7sendLog(\'40_01_43\')" action-data="video">含“<span id="#{video}"></span>”的视频</li>',"</ul>","</div>"].join("");return tpl});Lib.register("tray.CateSearchPanel",function(lib){var _addEvt=Core.Events.addEvent;var leftB=Core.String.leftB;var byteLength=Core.String.byteLength;var catePanel=Core.Class.define(function(){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.cateSearch);this.initEvt()},lib.Panel,{initEvt:function(){var nodes=this.getNodes();var $lis=$T(nodes["panel"],"li");lib.util.hoverJq({elm:$lis,mouseenter:function(evt,el,index){Core.Dom.addClass(el,"current")},mouseleave:function(evt,el,index){Core.Dom.removeClass(el,"current")},delay:50});_addEvt(nodes["panel"],function(evt){evt=evt||window.event;var searchData=lib.util.getActionData(evt,"tray-search");if(searchData){lib.Listener.notify("tray-categroy-search",searchData.data)}})},updateSearch:function(v){if(5<byteLength(v)){v=leftB(v,4)+"..."}var value=v.replace(/(<|>)/g,function($1){if("<"===$1){return"&lt;"}else{return"&gt;"}});var nodes=this.getNodes();nodes["article"].innerHTML=value;nodes["bloger"].innerHTML=value;nodes["music"].innerHTML=value;nodes["video"].innerHTML=value}});return catePanel});Lib.register("tray.SearchFormPanel",function(lib){var _addEvt=Core.Events.addEvent;var _trim=Core.String.trim;var searchForm=Core.Class.define(function(cfg){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.searchForm);this.initEvt();this.catePanel=new lib.tray.CateSearchPanel;this.catePanel.entity.style.zIndex=512;lib.Listener.on({name:"tray-categroy-search",callBack:this.search,scope:this})},lib.Panel,{initEvt:function(){var me=this;var $queryTxt=this.getNode("queryTxt");_addEvt($queryTxt,function(evt){evt=evt||window.event;var target=evt.target||evt.srcElement;var offset=target.offsetWidth;me.showCateSearch(target,offset,target.value)},"input");_addEvt($queryTxt,function(evt){console.log(evt);evt=evt||window.event;if("value"!==evt.propertyName){return}var target=evt.target||evt.srcElement;var offset=target.offsetWidth;me.showCateSearch(target,offset,target.value)},"propertychange");_addEvt($queryTxt,function(evt){evt=evt||window.event;var target=evt.target||evt.srcElement;var offset=target.offsetWidth;me.showCateSearch(target,offset,target.value)},"focus");_addEvt(this.getNode("searchForm"),function(evt){evt=evt||window.event;var form=evt.target||evt.srcElement;if(!me.checkValidate(form)){Core.Events.stopEvent(evt)}else{setTimeout(function(){me.hideCateSearch();me.resetForm()},100)}},"submit");_addEvt(window,function(){if(me.catePanel.isShow){var offset=$queryTxt.offsetWidth;me.catePanel.showWithDom($queryTxt,-offset,4)}},"resize")},checkValidate:function(form){if("q"in form&&!_trim(form["q"].value))return false;else if("k"in form&&!_trim(form["k"].value))return false;else return true},setForm:function(url,cfg){var defaultValue={queryTxt:"q",ie:"utf-8",range:"",t:"",s:"",by:"",type:"",stype:"",e:"utf-8",c:""};var $searchForm=this.getNode("searchForm");$searchForm.action=url;lib.apply(defaultValue,cfg);var $queryTxt=this.getNode("queryTxt");$queryTxt.name=defaultValue["queryTxt"];delete defaultValue["queryTxt"];var attr,$query;for(var p in defaultValue){attr=defaultValue[p];if(typeof attr==="string"&&($query=this.getNode(p))){$query.value=attr}}},resetForm:function(){this.setForm("http://search.sina.com.cn",{queryTxt:"q",range:"article",s:"sup",by:"all",stype:"1",c:"blog"})},search:function(type){var $searchForm=this.getNode("searchForm");var blogSearchUrl="http://search.sina.com.cn";var videoSearchUrl="http://video.sina.com.cn/search/index.php";var musicSearchUrl="http://music.sina.com.cn/yueku/search/s.php";switch(type){case"video":this.setForm(videoSearchUrl,{queryTxt:"k",s:"sup",type:"boke",stype:"1"});break;case"bloger":this.setForm(blogSearchUrl,{queryTxt:"q",range:"author",s:"sup",by:"all",stype:"1",c:"blog"});break;case"music":this.setForm(musicSearchUrl,{queryTxt:"k",t:"song"});break;default:this.setForm(blogSearchUrl,{queryTxt:"q",range:"article",s:"sup",by:"all",stype:"1",c:"blog"})}if($IE){this.getNode("submit").click()}else{Core.Events.fireEvent(this.getNode("submit"),"click")}},showCateSearch:function($withEl,offset,v){var catePanel=this.catePanel;if(v&&catePanel.isHidden){catePanel.showWithDom($withEl,-offset,4)}else if(!v){this.hideCateSearch()}catePanel.updateSearch(v)},hideCateSearch:function(){var catePanel=this.catePanel;catePanel.hide();catePanel.updateSearch("")}});return searchForm});Lib.register("util.LS",function(lib){var ls;var Storage=function(wnd,undefined){var localStorageName="data-sina-blog-storage",localStorageKeys="data-sina-blog-storage-keys",doc=wnd.document,storageContainer=doc.createElement("input"),length,keys,removeArray=Core.Array.ArrayWithout,mark=function(key,isRemove,temp,reg){storageContainer.load(localStorageName);temp=storageContainer.getAttribute(localStorageKeys)||"";reg=RegExp("\\b"+key+"\\b,?","i");var hasKey=reg.test(temp)?1:0;temp=isRemove?temp.replace(reg,""):hasKey?temp:temp===""?key:temp.split(",").concat(key).join(",");storageContainer.setAttribute(localStorageKeys,temp);storageContainer.save(localStorageName)};var box=document.body||document.getElementsByTagName("head")[0]||document.documentElement;storageContainer.id="____storage_container_box";storageContainer.type="hidden";box.appendChild(storageContainer);storageContainer.addBehavior("#default#userData");storageContainer.load(localStorageName);var keyStr=storageContainer.getAttribute(localStorageKeys);keys=keyStr?keyStr.split(","):[];length=keys.length;return{key:function(index){if(isNaN(index)){index=0}return keys[parseInt(index,10)]},getItem:function(key){storageContainer.load(localStorageName);return storageContainer.getAttribute(key)},setItem:function(key,value){storageContainer.setAttribute(key,value);storageContainer.save(localStorageName);this.length++;keys.push(key);mark(key)},removeItem:function(key){storageContainer.removeAttribute(key);storageContainer.save(localStorageName);this.length--;removeArray(keys,key);mark(key,1)},clear:function(){storageContainer.load(localStorageName);var attrs=storageContainer.getAttribute(localStorageKeys).split(","),len=attrs.length;if(attrs[0]==="")return;for(var i=0;i<len;i++){storageContainer.removeAttribute(attrs[i]);storageContainer.save(localStorageName)}storageContainer.setAttribute(localStorageKeys,"");storageContainer.save(localStorageName);this.length=0},length:length}};var getStorage=function(wnd){if(wnd.localStorage){return wnd.localStorage}else if(wnd.sessionStorage){return wnd.sessionStorage}else if(wnd.globalStorage){return wnd.globalStorage}else{return Storage(wnd)}};var getLS=function(){if(!ls){ls=getStorage(window)}return ls};return{key:function(index){return getLS().key(index)},getItem:function(key){return getLS().getItem(key)},setItem:function(key,value){try{getLS().setItem(key,value);return true}catch(e){return false}},removeItem:function(key){return getLS().removeItem(key)},clear:function(){return getLS().clear()}}});Lib.register("tray.loadUserInfo",function(lib){var LS=lib.util.LS;var JSON=lib.util.JSON;var sendSever=function(uid,cb){var url="http://interface.blog.sina.com.cn/riaapi/profile/getNickName.php";Utils.Io.JsLoad.request(url,{GET:{uid:uid},onComplete:function(r){if(r&&"A00006"===r.code){var n=r.data.nickname;var saveObj={time:(new Date).getTime()/1e3};lib.apply(saveObj,r.data);LS.setItem("uid"+uid,JSON.stringify(saveObj));cb(saveObj)}},onException:function(){},timeout:1e4})};return function(uid,cb,froceSever){var nickInfo=LS.getItem("uid"+uid);if(!froceSever&&nickInfo){nickInfo=JSON.parse(nickInfo);var currentTime=(new Date).getTime()/1e3;var waitTime=currentTime-nickInfo.time;if(waitTime<4*60&&nickInfo.nickname){cb(nickInfo);return}}sendSever(uid,cb)}});Lib.register("tray.MsgLoader",function(lib){var addFlash=function($flash){var $wrapper=$C("div");$wrapper.style.cssText="position:absolute;top:-1000px;left:-1000px;";document.body.appendChild($wrapper);$flash.write($wrapper)};var random="",FlaDom;if(window.$Maxthon||window.$360||window.$TT){random="?t="+Core.Math.getUniqueId()}var msgLoader=function(cfg){lib.apply(this,cfg);if(!FlaDom){try{var FlashPlayer=new Utils.Flash.swfObject($_GLOBAL.flashBasicURL+"blogMessageReminding.swf"+random,"__msgTipsPlayer","1px","1px","9","#00ff00");FlashPlayer.addParam("quality","high");FlashPlayer.addParam("wmode","transparent");FlashPlayer.addParam("allowScriptAccess","always");FlashPlayer.addParam("freeTime",27*1e3);if("complete"===document.readyState){addFlash(FlashPlayer);FlaDom=$E("__msgTipsPlayer")}else{_addEvt(window,function(){addFlash(FlashPlayer);FlaDom=$E("__msgTipsPlayer")},"load")}}catch(e){}}}.$define({time:30,url:"http://comet.blog.sina.com.cn/api?maintype=notice",getFlaDom:function(){return FlaDom},play:function(){if($_GLOBAL.msgPlaySound&&FlaDom&&FlaDom.PlaySound){
try{FlaDom.PlaySound()}catch(e){}}},load:function(uid,cb){var $this=this;var blogid=scope.$articleid||"";if(!uid){return}Utils.Io.JsLoad.request(this.url,{GET:{uid:uid||"",blogid:blogid},onComplete:function(r){if(r&&"A00006"==r.code){var d,articleMsg;if(uid&&(d=r.data[uid])){var userMsg={};userMsg.sum=0;for(var k in d){userMsg[k]=d[k];userMsg.sum+=d[k]}userMsg.blogrecomment=userMsg.blogrecomment?userMsg.blogrecomment:0;lib.Listener.notify("tray-newmsg-loaded",userMsg)}if(blogid&&(articleMsg=r.data[blogid])){lib.Listener.notify("article-msg-loaded",articleMsg)}}},onException:function(){},timeout:1e4})}});return msgLoader});Lib.register("tray.tpl.notice",function(){var tpl=['<div id="#{panel}" class="horn">','<div id="#{tj}" class="horn_con" style="display:none;">推荐：<a id="#{noticeAd1}" target="_blank" href="#"></a><a id="#{noticeAd2}" target="_blank" href="#"></a></div>','<div id="#{announce}" class="horn_con" style="display:none;"><p id="#{announceCon}">公告：<em>请您及时更换请请请您正在使用的模版将于2周后被下线，请您及时更换</em></p></div>','<a class="close" title="关闭" id="#{close}" style="float:none;">×</a>',"</div>"].join("");return tpl});Lib.register("tray.BlogNotice",function(lib){var _addEvt=Core.Events.addEvent,setCookie=Utils.Cookie.setCookie,pageId=scope.$pageid;var notice=Core.Class.define(function(){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.notice);this.initEvt()},lib.Panel,{initEvt:function(){var $this=this;_addEvt(this.getNode("close"),function(evt){evt=evt||window.event;setCookie("closeNotice_fzp",$UID,24,"/",".blog.sina.com.cn");lib.Listener.notify("tray-announce-close",{});$this.destroy()})},update:function(json){var $tj=this.getNode("tj"),$announce=this.getNode("announce");var slotres="";var sourceArr=["SLOT_58","SLOT_59","SLOT_98","SLOT_99","SLOT_100","SLOT_101","SLOT_102"];var sloturl="http://comet.blog.sina.com.cn/api?maintype=pageslot";var reqdata={id:sourceArr};if(typeof scope!="undefined"){reqdata.blogeruid=scope.$uid}if($UID){reqdata.loginuid=$UID}if($isLogin&&json.announce.result&&(pageId==="indexM"||pageId==="articleM"||pageId==="articlelistM")){$announce.innerHTML=json.announce.announce_con;$announce.style.display=""}else{var noticeAd1=this.getNode("noticeAd1");var noticeAd2=this.getNode("noticeAd2");var complete=function(res){var randomIndex=0;var adcon1=res[sourceArr[0]].res;var adcon2=res[sourceArr[1]].res;if(adcon1||adcon2){if(adcon1){randomIndex=0;if(adcon1.length>1){randomIndex=Math.floor((adcon1.length+1)*Math.random())}noticeAd1.innerHTML=adcon1[randomIndex].words;noticeAd1.href=adcon1[randomIndex].a_href;noticeAd1.title=adcon1[randomIndex].a_title;noticeAd1.setAttribute("suda-uatrack",adcon1[randomIndex].a_c_suda.replace("suda-uatrack=","").replace('"',"").replace('"',""));if(typeof SUDA!=="undefined"){SUDA.uaTrack(adcon1[randomIndex].a_v_suda_key,adcon1[randomIndex].a_v_suda_value)}}if(adcon2){randomIndex=0;if(adcon2.length>1){randomIndex=Math.floor((adcon2.length+1)*Math.random())}noticeAd2.innerHTML=adcon2[randomIndex].words;noticeAd2.href=adcon2[randomIndex].a_href;noticeAd2.title=adcon2[randomIndex].a_title;noticeAd2.setAttribute("suda-uatrack",adcon2[randomIndex].a_c_suda.replace("suda-uatrack=","").replace('"',"").replace('"',""));if(typeof SUDA!=="undefined"){SUDA.uaTrack(adcon2[randomIndex].a_v_suda_key,adcon2[randomIndex].a_v_suda_value)}}$tj.style.display=""}};if(scope.__subscribeSlot==="waitting"){scope.__subscribeSlotFunc=complete}else if(typeof scope.__subscribeSlot==="object"){complete(scope.__subscribeSlot)}else{scope.__subscribeSlot="waitting";Utils.Io.JsLoad.request(sloturl,{GET:reqdata,onComplete:function(res){complete(res);scope.__subscribeSlot=res;if("function"==typeof scope.__subscribeSlotFunc){scope.__subscribeSlotFunc(res)}},onException:function(){}})}}},setTemplate:function(template){this.template=template;var tmp=new Lib.HtmlTemplate(this.template,this.uniqueID);this.tpl=tmp;Core.Dom.insertHTML($E(this.appendTo),tmp.getHtmlString(),"afterbegin");this.entity=$E("_"+this.uniqueID+"_panel");this.entity.style.display="none";tempEntity=null}});return notice});Lib.register("tray.unReadMsgPanel",function(lib){var unReadMsgPanel=Core.Class.define(function(ele){lib.Panel.prototype.initialize();if(scope.$pageid=="editor"){return}this._lockstate=0;this._scrolling=0;this._srcPot=ele;var template=['<div class="cor"></div>','<div class="bd">','<a href="#" id="j-unread-msg-close" class="close" title="关闭">×</a>','<ul id="j-unre-list">',"</ul>","</div>"].join("");this.setTemplate('<div class="messageTips" id="#{panel}" style="left:850px; top:10px;">'+template+"</div>");this.entity.style.zIndex=500;this._bindEvent()},lib.Panel,{show:function(){if(this.isShow){return}v7sendLog("40_02_01");this.entity.style.display="";this._srcPot&&this._srcPot.setAttribute("unread-show-state",1);this.isHidden=!1;this.isShow=!0;if(this.backIframe){this._updateBackIframe();this.backIframe.style.display=""}lib.Listener.notify("tray-unread-panel-show",{})},hide:function(){lib.Panel.prototype.hide.call(this);this._srcPot&&this._srcPot.setAttribute("unread-show-state",0);lib.Listener.notify("tray-unread-panel-hide",{})},_updatePanelIframe:function(){if(this.backIframe){this._updateBackIframe()}},_updateCont:function(data){var _list=[];if(data.comment+data.message+data.notice+data.gbook==0){this.hide();return}if(data.comment>0){_list.push("<li>"+data.comment+'条新评论，<a onclick="v7sendLog(\'40_02_02\')" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1">查看评论</a></li>')}if(data.message>0){_list.push("<li>"+data.message+'条新纸条，<a onclick="v7sendLog(\'40_02_03\')" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1">查看纸条</a></li>')}if(data.gbook>0){_list.push("<li>"+data.gbook+'条新留言，<a onclick="v7sendLog(\'40_02_04\')" href="http://i.blog.sina.com.cn/blogprofile/wall.php">查看留言</a></li>')}if(data.notice>0){var sysurl={notice:"http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote",like:"http://i.blog.sina.com.cn/profilelist/profilelikelist.php",notice_favourite:"http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice",notice_quote:"http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice",invite:"http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php",unreadnotices:"http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice",point:"http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/points_note.php"};var url=sysurl.notice;for(var key in data.notices){if(data.notices[key]>0){url=sysurl[key]||url;break}}_list.push("<li>"+data.notice+'条新通知，<a onclick="v7sendLog(\'40_02_05\')" href="'+url+'">查看通知</a></li>')}$E("j-unre-list").innerHTML=_list.join("");this.show();this._setThePos()},_setThePos:function(){var pop=Core.Dom.getXY(this._srcPot);var sv=this._srcPot.className=="link"?-2:0;var width=$IE7||$IE6?this.entity.offsetWidth:this.entity.clientWidth;if(pop[0]){var x=pop[0]+this._srcPot.clientWidth-width+sv;var _y=0;if(this._srcPot.getAttribute("adshow")==1&&this._scrolling==0){_y=pop[1]}var y=this._srcPot.clientHeight+_y+10;this.setPosition(x,y)}},_bindEvent:function(){var _this=this;Lib.Listener.on({name:"tray-newmsg-loaded",callBack:function(data){if(_this._lockstate){return}_this._eventHandle(data);_this._setThePos()}});Lib.Listener.on({name:"tray-scrolling-fix",callBack:function(data){_this._scrolling=1;if(_this._lockstate){return}_this.setFixed(1);_this._setThePos()}});Lib.Listener.on({name:"tray-scrolling-nofix",callBack:function(data){_this._scrolling=0;if(_this._lockstate){return}_this.setFixed(0);_this._setThePos()}});Lib.Listener.on({name:"topad680-show-end",callBack:function(data){_this._srcPot.setAttribute("adshow",1);if(_this.isShow){_this._setThePos()}}});Core.Events.addEvent($E("j-unread-msg-close"),function(e){var evt=e||window.event;if(evt.preventDefault){evt.preventDefault()}else{evt.returnValue=false}_this.hide();_this._lockstate=1},"click");Core.Events.addEvent(window,function(){if(_this.isShow){_this._setThePos()}},"resize")},_eventHandle:function(data){var _data={};_data.comment=data.blogcomment-0+(data.photocomment-0)+data.blogrecomment;_data.notice=data.notice+data.like+data.notice_favourite+data.notice_quote+data.invite+data.unreadnotices+data.point;_data.notices={notice:data.notice,like:data.like,notice_favourite:data.notice_favourite,notice_quote:data.notice_quote,invite:data.invite,unreadnotices:data.unreadnotices,point:data.point};_data.message=data.message;_data.gbook=data.gbook;this._updateCont(_data)}});return unReadMsgPanel});Lib.register("tray.msgSummaryPanel",function(lib){var JSON=lib.util.JSON;var nolist=['<li><a onclick="v7sendLog(\'40_02_12\')" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1"><span class="icoms_comment"></span>查看评论</a></li>','<li><a onclick="v7sendLog(\'40_02_13\')" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1"><span class="icoms_tips"></span>查看纸条</a></li>','<li><a onclick="v7sendLog(\'40_02_14\')" href="http://i.blog.sina.com.cn/blogprofile/wall.php"><span class="icoms_message"></span>查看留言</a></li>','<li><a onclick="v7sendLog(\'40_02_15\')" href="http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice"><span class="icoms_notice"></span>查看通知</a></li>'];var msgSummaryPanel=Core.Class.define(function(ele){lib.Panel.prototype.initialize();this._srcPot=ele;this._lock=1;this._scrolling=0;this._requirestate=1;this._nums={};var template=['<div class="bd">','<ul id="j-summary-list">',nolist.join(""),"</ul>","</div>"].join("");this.setTemplate('<div class="messageBox" id="#{panel}">'+template+"</div>");this.entity.style.zIndex=500;this._bindEvent();this._initNums()},lib.Panel,{show:function(){var _this=this;if(this._checkNumChange()){this._updateCont()}else{this._showAction()}},_showAction:function(){if(this.isHidden){this._srcPot&&this._srcPot.setAttribute("msg-panel-show-state",1);this.entity.style.display="";this.isHidden=!1;this.isShow=!0;if(this.backIframe){this._updateBackIframe();this.backIframe.style.display=""}this._setThePos()}else{this._setThePos()}},_checkNumChange:function(){var oldnum=this._srcPot.getAttribute("msg-count");var newnum=this._srcPot.getAttribute("old-msg-count");if(oldnum==newnum){return false}else{return true}},hide:function(){lib.Panel.prototype.hide.call(this);this._srcPot&&this._srcPot.setAttribute("msg-panel-show-state",0);lib.Listener.notify("tray-msg-panel-hide",{})},_initNums:function(){var data=JSON.parse(this._srcPot.getAttribute("msg-count"));this._formatData(data)},_setThePos:function(){if($IE6||$IE7||$IE8){this.entity.style.width="auto"}var pop=Core.Dom.getXY(this._srcPot);var sv=this._srcPot.className=="link"?-2:0;var width=$IE7||$IE6?this.entity.offsetWidth:this.entity.clientWidth;var x=pop[0]+this._srcPot.clientWidth-width+sv;var _y=0;if(this._srcPot.getAttribute("adshow")==1&&this._scrolling==0){if($IE6||$IE7||$IE8){_y=pop[1]-2}else{_y=pop[1]}}var y=this._srcPot.clientHeight+_y+1;if($IE6||$IE7||$IE8){this.entity.style.width=this.entity.clientWidth+1+"px";this.entity.style.width=this.entity.clientWidth-1+"px"}this.setPosition(x,y)},_updatePanelIframe:function(){if(this.backIframe){this._updateBackIframe()}},_updateCont:function(fun){var _list=[];var _this=this;this._lock=0;if(this._requirestate){this._getDate({},function(_data){_list.push(_this._getComment(_data));_list.push(_this._getMessage(_data));_list.push(_this._getGbook(_data));_list.push(_this._getNotice(_data));$E("j-summary-list").innerHTML=_list.join("");_this._srcPot.setAttribute("old-msg-count",_this._srcPot.getAttribute("msg-count"));if($IE6){$E("j-summary-list").style.width="270px"}_this._showAction()},function(_data){});this._requirestate=0}},_getDate:function(opt,funsuc,funerr){funsuc=funsuc||function(){};funerr=funerr||function(){};var _this=this;Lib.checkAuthor();var inter=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/note/notelist.php","jsload");inter.request({GET:{uid:$UID},onSuccess:function(result){funsuc(result)}.bind2(this),onError:function(result){funerr({num:0})}.bind2(this),onFail:function(){funerr({num:0})}.bind2(this)})},_getUserPicUrl:function(uid,size){var size=size||50;var n=parseInt(uid)%8+1;return"http://portrait"+n+".sinaimg.cn/"+uid+"/blog/"+size},getLen:function(a){if(!a){return 0}var b=a.match(/[^\x00-\xff]/g);return a.length+(b?b.length:0)},strTruncate:function(str,len,suffix){str=str||"";if(typeof suffix=="undefined"){suffix="..."}return this.getLen(str)>len?this.truncete(str,len)+suffix:str},truncete:function(b,c){var d=b.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**");b=b.slice(0,d.slice(0,c).replace(/\*\*/g," ").replace(/\*/g,"").length);this.getLen(b)>c&&c>0&&(b=b.slice(0,b.length-1));return b},getVipIcon:function(index){if(!index){return""}var vipicon={1:{icon:"SG_icon146",info:"新浪个人认证"},2:{icon:"SG_icon147",info:"新浪机构认证"}};var index=index||1;var pic='<img class="SG_icon '+vipicon[index].icon+'" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="13" title="'+vipicon[index].info+'" alt="'+vipicon[index].info+'" align="absmiddle" />';return pic},_setNameforIE6:function(name){if($IE6){return this.strTruncate(name,4)}else{return name}},_getComment:function(_data){var str="";if(this._nums._comment>0){var data=_data.msg.cms;if(data.length>0){var typemsg={1:"评论了你的博文",2:"评论了你的图片",6:"回复了你的评论"};var typeurl={1:"http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1",2:"http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=2",6:"http://i.blog.sina.com.cn/blogprofile/profilereplylist.php"};var types=[];for(var i=0,len=data.length;i<len;i++){var item=data[i];var name=item.nick_name||item.name;name=this._setNameforIE6(name);var img=this._getUserPicUrl(item.uid,30);var type=item.msg_type;types.push(type);var index=item.user_type||0;var time=item.time;str+='<li><a onclick="v7sendLog(\'40_02_06\')" href="'+typeurl[type]+'"><img src="'+img+'"><em class="nl">'+name+"</em>"+this.getVipIcon(index)+'<em class="tm">'+time+"</em>"+typemsg[type]+"</a></li>"}types.sort();if(this._nums._comment>3){str+='<li class="lcount"><a onclick="v7sendLog(\'40_02_07\')" href="'+typeurl[types[0]]+'">总共'+this._nums._comment+"条新评论</a></li>"}else{}}else{str=nolist[0]}}else{str=nolist[0]}return str},_getMessage:function(_data){var str="";if(this._nums._message>0){var data=_data.msg.note[0];var name=data.name||data.nick_name;name=this._setNameforIE6(name);var numstr=this._nums._message>1?"等"+this._nums._message+"人":"";var index=data.user_type||0;str+='<li class="bgc"><a onclick="v7sendLog(\'40_02_08\')" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1"><span class="icoms_tips"></span><em class="nl">'+name+"</em>"+this.getVipIcon(index)+numstr+'发来纸条<em class="nr">查看纸条</em></a></li>'}else{str=nolist[1]}return str},_getGbook:function(_data){var str="";if(this._nums._gbook>0){var data=_data.msg.note[1];var name=data.name||data.nick_name;if(name){name=this._setNameforIE6(name);var numstr=this._nums._gbook>1?"等"+this._nums._gbook+"人":"给你";var index=data.user_type||0;str+='<li class="bgc"><a onclick="v7sendLog(\'40_02_09\')" href="http://i.blog.sina.com.cn/blogprofile/wall.php"><span class="icoms_message"></span><em class="nl">'+name+"</em>"+this.getVipIcon(index)+numstr+'留言<em class="nr">查看留言</em></a></li>'}}else{str=nolist[2]}return str},_getNotice:function(_data){var str="";var _pronotice="http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice";var _sysnotice="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote";var typeurl={3:"http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php",7:_pronotice,8:_pronotice,9:_pronotice,23:_pronotice,55:"http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/points_note.php",13:"http://i.blog.sina.com.cn/profilelist/profilelikelist.php",100:_sysnotice,101:_sysnotice,102:_sysnotice,103:_sysnotice,104:_sysnotice,105:_sysnotice,106:_sysnotice,107:_sysnotice,108:_sysnotice,109:_sysnotice,110:_sysnotice,111:_sysnotice,112:_sysnotice};if(this._nums._notice>0){var data=_data.msg.note[2];var type=data.msg_type||23;str+='<li class="bgc last"><a onclick="v7sendLog(\'40_02_10\')" href="'+typeurl[type]+'"><span class="icoms_notice"></span>'+this._nums._notice+'条新通知<em class="nr">查看通知</em></a></li>'}else{str=nolist[3]}return str},_bindEvent:function(){var _this=this;Lib.Listener.on({name:"tray-newmsg-loaded",callBack:function(data){_this._requirestate=1;_this._eventHandle(data)}});Lib.Listener.on({name:"tray-scrolling-nofix",callBack:function(data){_this._scrolling=0;if(_this._lockstate){return}_this.setFixed(0);_this._setThePos()}});Lib.Listener.on({name:"tray-scrolling-fix",callBack:function(data){_this._scrolling=1;if(_this._lockstate){return}_this.setFixed(1);_this._setThePos()}});Lib.Listener.on({name:"topad680-show-end",callBack:function(data){if(_this.isShow){_this._setThePos()}}})},_eventHandle:function(data){this._formatData(data);if(this.isShow){this._updateCont()}},_formatData:function(data){var _data={};_data._comment=data.blogcomment-0+(data.photocomment-0)+data.blogrecomment;_data._notice=data.notice+data.like+data.notice_favourite+data.notice_quote+data.invite+data.unreadnotices+data.point;_data._message=data.message;_data._gbook=data.gbook;this._cacheNums(data,_data)},_cacheNums:function(data,_data){for(var k in data){this._nums[k]=data[k]}for(var key in _data){this._nums[key]=_data[key]}}});return msgSummaryPanel});Core.System.pageSize=function(_target){if(_target){target=_target.document}else{target=document}var _rootEl=target.compatMode=="CSS1Compat"?target.documentElement:target.body;var xScroll,yScroll;if(window.innerHeight&&window.scrollMaxY){xScroll=_rootEl.scrollWidth;yScroll=window.innerHeight+window.scrollMaxY}else if(_rootEl.scrollHeight>_rootEl.offsetHeight){xScroll=_rootEl.scrollWidth;yScroll=_rootEl.scrollHeight}else{xScroll=_rootEl.offsetWidth;yScroll=_rootEl.offsetHeight}var win_s=Core.System.winSize(_target);if(yScroll<win_s.height){pageHeight=win_s.height}else{pageHeight=yScroll}if(xScroll<win_s.width){pageWidth=win_s.width}else{pageWidth=xScroll}return[pageWidth,pageHeight,win_s.width,win_s.height]};(function(){function LazyLoad(oObjects,oOptions){this.node=oObjects;this.config=oOptions;for(var key in this.defaultConfig){this.config[key]=this.defaultConfig[key]}this.initialize();return this}LazyLoad.prototype={defaultConfig:{preloadPixel:500},initialize:function(){this.viewableHeight=LazyLoadListener.getViewableHeight();LazyLoadListener.enrol(this)},callback:function(nHeight){if(this.node.length==0){return}this.viewableHeight=nHeight||this.viewableHeight;var remanent=[];for(var i=0,len=this.node.length;i<len;i++){if(this.node[i]&&this.node[i].dom==null&&Core.Dom.getXY(this.node[i])[1]<this.viewableHeight+this.config.preloadPixel){this.config.callback(this.node[i]);this.node[i]=null}else if(this.node[i]&&this.node[i].dom&&Core.Dom.getXY(this.node[i].dom)[1]<this.viewableHeight+this.config.preloadPixel){this.node[i].callback(this.node[i].dom);this.node[i]=null}else{remanent.push(this.node[i])}}this.node=remanent}};var LazyLoadListener={_isInit:null,_binder:null,_isWindow:null,_member:[],initialize:function(){var container=window,isWindow=container==window||container==document||!container.tagName||/^(?:body|html)$/i.test(container.tagName);if(isWindow){var doc=container.document;container=doc.compatMode=="CSS1Compat"&&($IE||$FF||$OPERA)?doc.documentElement:doc.body}this._container=container;this._binder=isWindow?window:container;this._isWindow=isWindow;this._isInit=true;this.delayResize();this.bindEvent()},getViewableHeight:function(){var eyeableHeight=LazyLoadListener._container.scrollTop+Core.System.winSize().height;this.eyeableHeight=eyeableHeight;return eyeableHeight},bindEvent:function(){if(!this._isInit){this.initialize();return}Core.Events.addEvent(this._binder,LazyLoadListener.delayLoad,"scroll");if(this._isWindow){Core.Events.addEvent(this._binder,LazyLoadListener.delayResize,"resize")}this.binded=true},unbindEvent:function(){Core.Events.removeEvent(LazyLoadListener._binder,LazyLoadListener.delayLoad,"scroll");if(this._isWindow){Core.Events.removeEvent(LazyLoadListener._binder,LazyLoadListener.delayResize,"resize")}this.binded=false},delayLoad:function(){if(LazyLoadListener.scrollWatch){clearTimeout(LazyLoadListener.scrollWatch)}LazyLoadListener.scrollWatch=setTimeout(function(){LazyLoadListener.callback();clearTimeout(LazyLoadListener.scrollWatch);LazyLoadListener.scrollWatch=null},100)},delayResize:function(){if(LazyLoadListener.resizeWatch){clearTimeout(LazyLoadListener.resizeWatch)}LazyLoadListener.resizeWatch=setTimeout(function(){LazyLoadListener.callback();clearTimeout(LazyLoadListener.resizeWatch);LazyLoadListener.resizeWatch=null},100)},enrol:function(oLazy){LazyLoadListener._member.push(oLazy)},callback:function(){LazyLoadListener.getViewableHeight();if(LazyLoadListener._member.length>0){for(var i=0,len=LazyLoadListener._member.length;i<len;i++){LazyLoadListener._member[i].callback(LazyLoadListener.eyeableHeight)}}if(LazyLoadListener.eyeableHeight==Core.System.pageSize()[1]){LazyLoadListener.unbindEvent()}}};Lib.LazyLoad=function(oObjects,oOptions){if(LazyLoadListener.binded!=true){LazyLoadListener.bindEvent(oObjects,oOptions)}new LazyLoad(oObjects,oOptions)}})();$SYSMSG.extend({A00001:"系统繁忙，请稍候再试。",A00007:"未登录。",A00004:"系统繁忙，请稍候再试。",A00112:"博客名称超长。",A00113:"您已开通博客，请点击<a href='http://control.blog.sina.com.cn/blogprofile/index.php'>个人中心</a>进入。",A00116:"不能包含 sina 等有特殊含义的字符。",A11003:"此账户已完成博客快速设置，点击确定，直接进入博客。",A44001:"博客个性地址不能为空。",A44002:"地址格式不对。",A44003:"抱歉，此地址已被占用。",A44005:"抱歉，请按照正确格式填写博客地址。"});(function(){if(scope.blogOpener){scope.addBlogOpenerEvent=function(){};return}var openURL="http://control.blog.sina.com.cn/riaapi/reg/open_blog.php";var openBlog=function(){this._hasInit=false};openBlog.prototype={getCon:function(){var checkcodeHTML=['<div class="boxA" style="margin: 20px 0; overflow: hidden; zoom: 1;">','<div id="checkCodeBox_open_msg" class="check-code-box clearfix" > </div>',"</div>"].join("");return['<div class="CP_layercon8">'+'<div class="nowOpenBlog">'+"<strong>您的博客尚未开通,仅一步操作就能开通您的个人博客</strong>"+'<div class="boxA">'+"<label>博客名称：</label>"+'<input id="blogNameInput_t" type="text" class="ipt" />'+'<img style="display:none" id="blogNameIcon_t" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" class="SG_icon SG_icon49 tips">'+'<p id="blogNameError_t" class="tip">名称不能为空</p>'+"</div>"+'<div  class="boxA"> '+"<p>隐私设置："+'<input type="radio" name="isPrivate_t" checked id="openAll1_t" class="rd" /><label for="openAll1_t">对所有人开放</label>'+'<input type="radio" name="isPrivate_t" id="openMe1_t" class="rd" /><label for="openMe1_t">仅对自己开放，私密博客</label>'+"</p>"+"</div>"+checkcodeHTML+'<div id="ErrTips_t" class="ErrTips">系统繁忙，请稍后再试</div>'+'<div class="boxB">'+'<p><a id="openBlogOkBtn_t" class="btn" href="javascript:void(0)">完成开通</a><a id="openBlogCancel" href="javascript:void(0)">取消</a></p>'+"</div>"+"</div>"+"</div>"].join("")},_initDialog:function(){Lib.checkAuthor();this.key=getKeyName();this._dialog=winDialog.createCustomsDialog({content:this.getCon()},"openblog");var checkCodeBox_open_msg={id:"#checkCodeBox_open_msg"};checkManager_open_msg=new Lib.checkManager(checkCodeBox_open_msg);this.bindEvent();blogNameEvent($E("blogNameInput_t"),$E("blogNameError_t"),[],$E("blogNameIcon_t"))},showDialog:function(callBack,needToOpen,forceOpen){needToOpen=needToOpen||false;if(!this._hasInit){this._initDialog();this._hasInit=true}var me=this;scope.whenOpenBlogCallback=callBack;if(!scope.hasOpenBlog){trace("这是一位后登陆的用户");var t=0;var timmer=setInterval(function(){trace("呀，怎么还没有出结果啊--"+t);if(scope.hasOpenBlog){clearInterval(timmer);if(scope.hasOpenBlog=="open"){trace("并且他开通的博客");if(scope.whenOpenBlogCallback){scope.whenOpenBlogCallback()}}else{trace("他们没有开通博客");me._showDialog(needToOpen)}}t++;if(t==10){Lib.checkAuthor();trace("等不及了，自己发吧。。。");clearInterval(timmer);new Interface("http://control.blog.sina.com.cn/riaapi/profile/unread.php","jsload").request({GET:{uid:$UID,product:"blog"},onSuccess:function(data){scope.hasOpenBlog=data.isbloguser==1?"open":"no";trace("~~~~~~~~~~~~~~~~~~~"+scope.hasOpenBlog);if(scope.hasOpenBlog=="open"){trace("并且他开通的博客");if(scope.whenOpenBlogCallback){scope.whenOpenBlogCallback()}}else{if(!$E("openblogcss")){Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"})}trace("他们没有开通博客");me._showDialog(needToOpen)}}})}},10)}else{trace("这是已登陆的用户");if(scope.hasOpenBlog=="open"){trace("并且他开通的博客");if(scope.whenOpenBlogCallback){scope.whenOpenBlogCallback()}}else{if(!$E("openblogcss")){Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"})}trace("他们没有开通博客");this._showDialog(needToOpen)}}if(forceOpen){$E("openBlogCancel").style.display="none";this._dialog.getNodes().btnClose.style.display="none"}},_showDialog:function(needToOpen){$E("blogNameInput_t").value=getShotName();hiddenError($E("blogNameError_t"),$E("blogNameIcon_t"));$E("ErrTips_t").style.visibility="hidden";$E("blogNameIcon_t").style.display="none";this._dialog.show();this._dialog.setAreaLocked(true);this._dialog.setMiddle()},bindEvent:function(){var me=this;Core.Events.addEvent($E("openBlogCancel"),function(){me.closeDialog();return false});Core.Events.addEvent($E("openBlogOkBtn_t"),function(){if(!checkManager_open_msg.validate()){if(!$E("comment_check_img")){winDialog.alert("请拖动滑块儿开始验证")}else{winDialog("验证码不能为空")}return}whenOpenBlog({nameErrorEle:$E("blogNameError_t"),nameOkIcon:$E("blogNameIcon_t"),openName:$E("blogNameInput_t").value||getShotName(),isprivate:$E("openAll1_t").checked?0:1,errorEle:$E("ErrTips_t"),from:"floatingLayer",okCallback:function(res,blogInfo){if(scope.whenOpenBlogCallback){scope.whenOpenBlogCallback(res,blogInfo)}if($E("openedBlogTray")&&$E("openedBlogTray").style.display=="none"){$E("outOfOpenBlogTray").style.display="none";$E("noOpenedBlogTray").style.display="none";$E("openedBlogTray").style.display=""}if($E("noOpendBlogSearchTip")&&$E("noOpendBlogSearchTip").style.display=="block"){$E("noOpendBlogSearchTip").style.display="none";$E("opendBlogSearchTip").style.display="block"}scope.hasOpenBlog="open";me.closeDialog();scope.whenOpenBlogCallback=function(){}}});return false})},closeDialog:function(){var me=this;this._dialog.hidden()}};function getShotName(){var val=$nick;var nameLen=Core.String.byteLength(val);while(nameLen>18){val=val.substring(0,val.length-1);nameLen=Core.String.byteLength(val)}return val+"的博客"}scope.openBlogGetShotName=getShotName;function blogNameEvent(inputEle,errEle,optArr,icon){inputEle.onfocus=function(){inputEle.className="ipt focus";styleThey(optArr,"");icon.style.display=""};inputEle.onblur=function(){inputEle.className="ipt";checkBlogName(inputEle,errEle,icon);styleThey(optArr,"none")};inputEle.onkeyup=function(){checkBlogName(inputEle,errEle,icon)}}scope.openBlogNameEvent=blogNameEvent;function whenOpenBlog(opt){if(whenOpenBlog.requestComplete===false){return}if(opt.nameErrorEle.innerHTML){changeTextBgC(opt.nameErrorEle.parentNode);setTimeout(function(){changeTextBgC(opt.nameErrorEle.parentNode)},442);return}var targetButtonId=opt.from==="floatingLayer"?"openBlogOkBtn_t":"openBlogOkBtn";$E(targetButtonId).className="loading";var blogInfo={loginName:getKeyName(),blogName:opt.openName};var my_data={uid:$UID,loginname:blogInfo.loginName,blogname:blogInfo.blogName,version:7,src:"layer",isprivate:opt.isprivate};var data_my=checkManager_open_msg.getPostData(my_data);new Interface(openURL,"jsload").request({GET:data_my,onSuccess:function(res){whenOpenBlog.requestComplete=true;$E(targetButtonId).className="btn";opt.okCallback(res,blogInfo);blogInfo=null},onError:function(res){var nameErr=$E("blogNameError"),nameIcon=$E("blogNameIcon"),layerNameErr=$E("blogNameError_t"),layerNameIcon=$E("blogNameIcon_t");switch(res.code){case"A11008":if(nameErr&&nameIcon){showError(nameErr,"输入内容有误，请修改",nameIcon)};if(layerNameErr&&layerNameIcon){showError(layerNameErr,"输入内容有误，请修改",layerNameIcon)};break;case"A11010":if(nameErr&&nameIcon){showError(nameErr,"输入内容有误，请修改",nameIcon)};if(layerNameErr&&layerNameIcon){showError(layerNameErr,"输入内容有误，请修改",layerNameIcon)};break;case"B36002":winDialog.alert("验证码错误，请修改。");break;default:showError(opt.errorEle,"系统繁忙，请稍后再试。");break}whenOpenBlog.requestComplete=true;$E(targetButtonId).className="btn"}})}scope.openBlogWhenOpenBlog=whenOpenBlog;function changeTextBgC(ele){for(var i=1;i<=55;i++){(function(val){setTimeout(function(){ele.style.backgroundColor="rgb(255, "+ +(200+val)+", "+(200+val)+")"},val*8)})(i)}}function getKeyName(){var key=decodeURIComponent(Utils.Cookie.getCookie("SUP"));key=key.split("&name=")[1];key=decodeURIComponent(key.split("&")[0]);return key}function styleThey(eleArr,str){for(var i=0;eleArr[i];i++){eleArr[i].style.display=str}}function checkBlogName(inputEle,errEle,icon){var val=inputEle.value;if(/^(?:\s|[　])+|(?:\s|[　])+$/.test(val)){inputEle.value=Core.String.trim(val);val=inputEle.value}if(val){var nameLen=Core.String.byteLength(val);if(nameLen>24){showError(errEle,"博客名称超长",icon)}else{hiddenError(errEle,icon)}}else{showError(errEle,"博客名称不能为空",icon)}}function showError(ele,str,icon){ele.innerHTML=str;ele.style.display="block";if(ele.id.indexOf("ErrTips")>=0){ele.style.visibility="visible"}if(icon){icon.className="SG_icon SG_icon48 tips"}}function hiddenError(ele,icon){ele.innerHTML="";ele.style.display="none";if(icon){icon.className="SG_icon SG_icon49 tips"}}scope.blogOpener=new openBlog;scope.addBlogOpenerEvent=function(el){Core.Events.addEvent(el,function(e){scope.blogOpener.showDialog(function(res,blogInfo){Lib.LocalDB.clearCache(1,"uid_"+$UID+"unread");Lib.util.LS.removeItem("uid"+$UID);if(scope.$pageid=="fakeIndex"){window.location.href="http://i.blog.sina.com.cn/blogprofile/index.php?atten=1";return}if($E("openedBlogTray")){$E("openedBlogTray").style.display="";$E("noOpenedBlogTray").style.display="none";$E("outOfOpenBlogTray").style.display="none";if(blogInfo){$E("loginBarAppMenuLabel").innerHTML=blogInfo.loginNick}}else{var wnd=window;wnd.$tray&&wnd.$tray.renderLogin()}var successOpenFun=function(){if(scope.___importV){scope.___importV();scope.___openBlogFlag=1}};var alertConf={subText:!scope.___importV?['<div class="CP_w_cnt SG_txtb">欢迎您在新浪博客安家！除了写博客，看博客外，您还可以进入个人中心完善您的个人资料，更有很多有趣的应用等着您哦。</div>','<ul class="CP_w_part CP_w_aLine">','<li><a href="http://control.blog.sina.com.cn/blogprofile/index.php" onclick="winDialog.getDialog(\'unregister\').hidden();" target="_blank">到博客个人中心&gt;&gt;</a></li>',"</ul>"].join(""):"",icon:"03",funcOk:successOpenFun,funcClose:successOpenFun,width:300};winDialog.alert("开通博客成功",alertConf,"unregister");var commentNickEl=$E("commentNick");if(commentNickEl){var child=commentNickEl.firstChild;while(child){commentNickEl.removeChild(child);child=commentNickEl.firstChild}commentNickEl.innerHTML=blogInfo.loginNick+":"}},true)},"click")}})();Lib.register("TrayPanel",function(lib){var _addEvt=Core.Events.addEvent;var _removeEvt=Core.Events.removeEvent;var _getCookie=Utils.Cookie.getCookie;var _contains=Core.Dom.contains;var JSON=lib.util.JSON;var byClass=Core.Dom.getChildrenByClass;var logoId="login_bar_logo_link_350";var _trayHolder="______noticeTrayHolder";var loadCount=0;var tray=null;var renderLogin=!1;var attr=function(el,attr,v){if(typeof v!=="string"){return el.getAttribute(attr)}else{el.setAttribute(attr,v)}};var TrayPanel=Core.Class.define(function(){var $topBaner=byClass(document.body,"nsinatopbar")[0];var $main=this.$main=byClass($topBaner,"ntopbar_main")[0];this.newTipsLog=0;lib.Panel.prototype.initialize.call(this,{appendTo:$main,isPostion:!1,noIframe:!0});lib.Listener.on({name:"tray-data-loaded",callBack:this.showPublishWare,scope:this},{
name:"tray-newmsg-loaded",callBack:this.showNewMsgTips,scope:this},{name:"global-login-out",callBack:function(){clearInterval(this._msgTimer)},scope:this},{name:"tray-announce-loaed",callBack:function(json){var args=arguments;var $this=this;if(this.notice){this.notice.update(json);return}setTimeout(function(){args.callee.call($this,json)},200)},scope:this},{name:"tray-unread-panel-hide",callBack:function(){var $trayMsg=this.getNode("trayMsg");var data=JSON.parse($trayMsg.getAttribute("msg-count"));this.showNewMsgTips(data,1)},scope:this},{name:"tray-unread-panel-show",callBack:function(){var $tips=this.getNode("newTips");$tips.style.display="none"},scope:this},{name:"tray-msg-panel-hide",callBack:function(){var $trayMsg=this.getNode("trayMsg");var data=JSON.parse($trayMsg.getAttribute("msg-count"));this.showNewMsgTips(data,1)},scope:this},{name:"tray-announce-close",callBack:function(json){this.setTrayPosition()},scope:this},{name:"topad680-show-start",callBack:function(data){this._hideActiveSub()},scope:this});if(loadCount){loadCount++}},lib.Panel,{subPanels:[],hoverTimeout:"",hoverTime:400,load:function(loginState){if(!loadCount){var $logo=$E(logoId);if($logo&&$_GLOBAL&&$_GLOBAL.platformTrayLogo){if(!$IE6&&$_GLOBAL.platformTrayLogo.imgForOtherBrs){$logo.children[0].src=$_GLOBAL.platformTrayLogo.imgForOtherBrs}else if($_GLOBAL.platformTrayLogo.imgForIE6){$logo.children[0].src=$_GLOBAL.platformTrayLogo.imgForIE6}}this.initSearch()}switch(loginState){case"login":if(/ipad/i.test(navigator.userAgent)){v7sendLog("48_01_02")}var start_time=new Date;var $this=this;lib.tray.loadUserInfo($UID,function(info){scope.unreadMsg=info;scope.nickname=info["full_nickname"];scope.loginUserWtype=info["login_wtype"];if(!$this._isRenderUser){$this.renderRight(lib.tray.tpl.loginMemu);$this._isRenderUser=!0}var $nick,$userInfo,$msnHolder;if(info.isbloguser){var $noOpenBlog=$this.getNode("noOpenBlog");$noOpenBlog.style.display="none";$this.initUserMenu();$this.initBlogMenu(info);$this.initNewMsgEvt();$this.initMsg();$this.initMsgLoder();$this.initHideSub();$this.initunReadMsgPanel();$nick=$this.getNode("userNick");$userInfo=$this.getNode("openBlog")}else{$nick=$this.getNode("ssoNick");$nick.href="http://control.blog.sina.com.cn/myblog/htmlsource/blog_notopen.php?uid="+$UID+"&version=7";$this.initOpenBlog();$this.initLogout();$userInfo=$this.getNode("noOpenBlog")}$nick.innerHTML="";var $nickTxt=document.createTextNode(info.nickname);$nick.appendChild($nickTxt);$userInfo.style.display="block";var isMsnLogin=Utils.Cookie.getCookie("loginFromMsn");if(isMsnLogin&&$nick){$msnHolder=$this.getNode("msnHolder");$msnHolder.style.display="block";var $msnLink=$this.getNode("msnLink");$msnLink.href+=$UID}if($msnHolder){Core.Dom.insertAfter($msnHolder,$nick.parentNode)}$this.initNotice()});break;case"logout":if(!this.trayLogin){this.trayLogin=new lib.Login.Ui;this.renderRight(lib.tray.tpl.loginOutMemu)}this.initLogin();this.initNotice();break;case"oncelogedon":break}loadCount++},initMsgLoder:function(){if(!this.msgLoader){this.msgLoader=new lib.tray.MsgLoader;this.msgLoader.load($UID);var $this=this;this._msgTimer=setInterval(function(){$this.msgLoader.load($UID)},30*1e3)}},initLogin:function(){var $this=this;var isInit=attr(this._el,"login");if(!isInit){attr(this._el,"login","1");_addEvt(this._el,function(evt){var data=lib.util.getActionData(evt,"tray-login-btn");if(!data){return}if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};$this.trayLogin.login(function(){Lib.checkAuthor();var str=$UID==scope.$uid?"02":"01";v7sendLog("87_01_"+str+"_"+$UID,scope.$pageid);setTimeout(function(){window.location=window.location.toString().replace(/#.*/,"")},100)},false,"referer:"+location.hostname+location.pathname+",func:0007")},"click")}},initLogout:function(){var $loginOut=this.getNode("ssoLoginOut");var isInit=attr($loginOut,"loginout");if(!isInit){attr(this._el,"login","1");_addEvt($loginOut,function(){lib.tray.loginOut(null,!0)})}$loginOut=null},initHideSub:function(){var $this=this;_addEvt(document.body,function(evt){if(!$this._activeTab){return}var target=evt.target||evt.srcElement;var panels=$this.subPanels;var item;for(var i=panels.length-1;i>=0;i--){item=panels[i];if(item.tab===target||_contains(item.tab,target)){return}if(item.panel.entity===target||_contains(item.panel.entity,target)){return}}$this._hideActiveSub()},"click");_addEvt(window,function(){var activeTab=$this._activeTab;if(!activeTab){return}var $tabEl=activeTab.tab;var panel=activeTab.panel;var offsetLeft=activeTab.left;var offsetTop=activeTab.top;var x=Core.Dom.getLeft($tabEl)+$tabEl.offsetWidth+offsetLeft;var y=Core.Dom.getTop($tabEl)+$tabEl.offsetHeight+offsetTop;if($IE6&&this.isFixed){x=x-document.documentElement.scrollLeft;y=y-document.documentElement.scrollTop}panel.setPosition(x,y)},"resize")},_hideActiveSub:function(){var $this=this;if($this._activeTab){var tabEl=$this._activeTab.tab;var panel=$this._activeTab.panel;$this._activeTab=null;panel.hidden();tabEl.className=tabEl.className.replace(/(?:[ ]*)\bcurrent\b/g,"")}},initUserMenu:function(){var $bindEl=this.getNode("userMenu");var isInit=attr($bindEl,"init");if(!isInit){attr($bindEl,"init","1");var $this=this;var hasEmail;var $tabEl=$this.getNode("userMenu");var userMenu=$this._findSub("userMenu");var flag=0;Lib.util.hoverJq({elm:$bindEl,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);if(!flag){flag=1;var panel;if(!userMenu){panel=new lib.tray.UserMenuPanel;$this.addSubPanel("userMenu",panel,$bindEl,$tabEl)}else{panel=userMenu.panel}var $userPanelNode=panel.getNode("panel");panel.initUserInfo($UID);Lib.util.hoverJq({elm:$userPanelNode,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);$this._showPanel("userMenu",-160,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}});getEmail(function(hasEmail){if(hasEmail){panel.getNode("mail").style.display=""}})}$this._showPanel("userMenu",-160,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}});var getEmail=function(cb){if(typeof hasEmail==="boolean"){cb(hasEmail)}else{Utils.Io.JsLoad.request("http://service.mail.sina.com.cn/mailproxy/mail.php",{onComplete:function(){var email=sinamailinfo.email;if(email!=""){hasEmail=!0}else{hasEmail=!1}cb(hasEmail)},onException:function(){}})}}}},initBlogMenu:function(info){var $bindEl=this.getNode("addArticle");var isInit=attr($bindEl,"init");if(!isInit){attr($bindEl,"init","1");var $this=this;var $tabEl=$this.getNode("blogMenu");var flag=0;Lib.util.hoverJq({elm:$tabEl,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);if(!flag){flag=1;var blogMenu=$this._findSub("blogMenu");var panel;if(!blogMenu){panel=new lib.tray.BlogMenuPanel;$this.addSubPanel("blogMenu",panel,$bindEl,$tabEl);if(info["tbh_status"]===1){panel.getNode("tbh_status").style.display=""}}var $blogMenuPanel=panel.getNode("panel");Lib.util.hoverJq({elm:$blogMenuPanel,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);$this._showPanel("blogMenu",-74,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}})}$this._showPanel("blogMenu",-74,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}})}},initNotice:function(){var productName=scope.$PRODUCT_NAME;var pageId=scope.$pageid;if("blog7"!==productName){this.noNotice=!0;return}if(-1===pageId.indexOf("article")&&-1===pageId.indexOf("index")){this.noNotice=!0;return}var flagUid=_getCookie("closeNotice_fzp");var $blogBody=$E("sinablogHead");Lib.checkAuthor();if(flagUid&&flagUid===$UID||!$blogBody){this.noNotice=!0;return}if(!this.notice){var notice=new lib.tray.BlogNotice({appendTo:$E(logoId).parentNode,isPostion:!1,noIframe:!0});this.notice=notice;var $this=this;var height=$blogBody.offsetHeight+30;var logFlag;var onshow=function(){var doc=document;var scrolltop=doc.body.scrollTop+doc.documentElement.scrollTop;if(scrolltop>height){$this.hideActive();$this.setTrayFixed();if(!logFlag){logFlag=1;v7sendLog("48_01_11_"+scope.$pageid)}}else{setTimeout(function(){$this.setTrayPosition();notice.hide()})}};_addEvt(window,onshow,"scroll");lib.Listener.on({name:"tray-announce-close",callBack:function(){_removeEvt(window,onshow,"scroll")}})}},initNewMsgEvt:function(){var tpl=this.tpl;var $newTips=this.getNode("newTips");var isInit=attr($newTips,"init");if(!isInit){attr($newTips,"init","1");var $this=this;_addEvt($newTips,function(evt){evt=evt||window.event;var $target=evt.target||evt.srcElement;Core.Events.stopEvent(evt);$target.style.display="none";$target.innerHTML="";var $msgTab=$this.getNode("trayMsg");Core.Events.fireEvent($msgTab,"click")},"click");$newTips=null}},initMsg:function(){var $bindEl=this.getNode("trayMsg");var isInit=attr($bindEl,"init");if(!isInit){attr($bindEl,"init","1");var $this=this;var flag=0;Lib.util.hoverJq({elm:$bindEl,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);if(!flag){flag=1;var ev=window.event||e;if(ev.preventDefault){ev.preventDefault()}else{ev.returnValue=false}var $bindEl=$this.getNode("trayMsg");var msgPanel=$this._findSub("msgPanel");var panel;if(!msgPanel){panel=new Lib.tray.msgSummaryPanel($bindEl);$this.addSubPanel("msgPanel",panel,$bindEl,$bindEl)}var $msgPanel=panel.getNode("panel");Lib.util.hoverJq({elm:$msgPanel,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);$this._showPanel("msgPanel",-400,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}})}$this._showPanel("msgPanel",-400,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}})}},initunReadMsgPanel:function(){var $bindEl=this.getNode("trayMsg");var isInit=attr($bindEl,"init-unre");if(!isInit){attr($bindEl,"init-unre","1");new lib.tray.unReadMsgPanel($bindEl)}},initSearch:function(){if(!loadCount){var panel=new lib.tray.SearchFormPanel({isPostion:!1,appendTo:"traySearchBar",noIframe:!0});panel.show();_addEvt(document.body,function(evt){evt=evt||window.event;var target=evt.target||evt.srcElement;var $query=panel.getNode("queryTxt");if($query!==target&&panel.entity!==target&&!_contains(target,panel.entity)){panel.catePanel.hide()}},"click")}},initOpenBlog:function(){var $openblogcss=$E("openblogcss");if(!$openblogcss){Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"});var $openBlog=this.getNode("openBlogBtn");scope.addBlogOpenerEvent($openBlog)}},notifyMsgPanel:function($msgTab){var newMsg=$msgTab.getAttribute("msg-count");if(newMsg){try{newMsg=JSON.parse(newMsg)}catch(e){newMsg={}}}else{newMsg=-1}},renderRight:function(tpl){this.setTemplate(tpl);this._el=this.entity;var $loading=byClass(this.$main,"ntopbar_loading")[0];$loading.style.display="none";this.show()},addSubPanel:function(name,panel,bindEl,tabEl){var $this=this;this.subPanels.push({name:name,tab:tabEl,bind:bindEl,panel:panel})},_showPanel:function(name,offsetLeft,offsetTop){var subBar=this._findSub(name);if(!subBar){return}var panel=subBar.panel;var $tabEl=subBar.tab;panel.entity.style.zIndex=512;if("msgPanel"===name){var $newTips=this.getNode("newTips");this.notifyMsgPanel($tabEl);$newTips.style.display="none"}var i,item,$tab;item=this._activeTab;if(item){$tab=item["tab"];if($tab===$tabEl){return}item["panel"].hide();$tab.className=$tab.className.replace(/(?:[ ]*)\bcurrent\b/g,"")}var className=$tabEl.className;if(!/\bcurrent\b/.test(className)){$tabEl.className+=" current"}this._activeTab={name:name,tab:$tabEl,panel:panel,left:offsetLeft,top:offsetTop};var $entity=panel.entity;if(this.isFixed&&(!$IE||$IE>6)){$entity.style.position="fixed"}else{$entity.style.position="absolute"}panel.showWithDom($tabEl,offsetLeft,offsetTop)},_findSub:function(name){var item;for(var i=this.subPanels.length-1;i>=0;i--){item=this.subPanels[i];if(name===item.name){return item}}return null},showNewMsgTips:function(data,sign){var sum=data.sum-data.feed;var $tips=this.getNode("newTips");var $trayMsg=this.getNode("trayMsg");if(sum){if($trayMsg.getAttribute("unread-show-state")==0&&$trayMsg.getAttribute("msg-panel-show-state")==0){$tips.style.display="block"}if(scope.$pageid=="editor"){$tips.style.display="block"}var offsetWidth=this.entity.offsetWidth;$tips.style.left=offsetWidth-$tips.offsetWidth-10+"px";if(sum<10){$tips.innerHTML=sum}else{$tips.innerHTML="•••"}if(!this.newTipsLog){v7sendLog("40_01_49_"+$UID);this.newTipsLog=1}$trayMsg.setAttribute("msg-count",JSON.stringify(data));this.startTitleTips(sum)}else{$trayMsg.setAttribute("msg-count",JSON.stringify(data));this.stopTitleTips()}var feed=data.feed;if(feed){var $feed=this.getNode("newFeed");$feed.style.display="block";var offsetWidth=this.entity.offsetWidth;$feed.style.left=offsetWidth-$feed.offsetWidth-197+"px";feed=feed<10?feed:"•••";$feed.innerHTML=feed;if(!$feed.addEvt){$feed.addEvt=1;_addEvt($feed,function(){location.href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1";$feed.style.display="none";$feed.innerHTML=""})}}},stopTitleTips:function(){if(scope.$pageid=="editor"){return}var title=document.title.replace(/\(\d+\+*\)/,"");document.title=title},startTitleTips:function(sum){if(scope.$pageid=="editor"){return}var title;if(sum){sum=sum>=1e5?"99999+":sum;if(/\(\d+\+*\)/.test(document.title)){title=document.title.replace(/\(\d+\+*\)/,"("+sum+")")}else{title="("+sum+")"+document.title}}document.title=title},hideActive:function(){var item,$tab;if(item=this._activeTab){item["panel"].hide();$tab=item["tab"];$tab.className=$tab.className.replace(/(?:[ ]*)\bcurrent\b/g,"");this._activeTab=null}},setTrayFixed:function(){var $logo=$E(logoId);this.notice.show();var $this=this;setTimeout(function(){$E("traySearchBar").parentNode.style.display="none";$logo.style.display="none";var $tray=$logo.parentNode.parentNode;if(!$IE||$IE>6){lib.Listener.notify("tray-scrolling-fix",{});$tray.style.position="fixed";$tray.style.top="0px"}else if($IE===6){if(!$this.__isFixie6){_addEvt(window,function(evt){if(!$this.isFixed){return}var oldScrollTop=document.documentElement.scrollTop;setTimeout(function(){var current=document.documentElement.scrollTop;if(oldScrollTop===current){$tray.style.display="block";$this._ie6fix(evt)}else if($this.isFixed){$tray.style.display="none"}},50)},"scroll");$this.__isFixie6=!0}}$tray.style.width="100%";if(!$E(_trayHolder)){var height=$tray.offsetHeight;var $holder=$C("div");$holder.style.height=height+"px";$holder.id=_trayHolder;Core.Dom.insertAfter($holder,$tray)}$this.isFixed=!0})},_ie6fix:function(evt){if(this.isFixed){var $logo=$E(logoId);var $tray=$logo.parentNode.parentNode;$tray.style.position="absolute";$tray.style.top=document.documentElement.scrollTop+"px";var trayMsg=this.getNode("trayMsg");if(trayMsg){trayMsg.style.display="none";trayMsg.style.display=""}lib.Listener.notify("tray-scrolling-fix",{})}},setTrayPosition:function(){if($IE6){var trayMsg=this.getNode("trayMsg");if(trayMsg){trayMsg.style.display="none";trayMsg.style.display=""}}lib.Listener.notify("tray-scrolling-nofix",{});var $logo=$E(logoId);var $tray=$logo.parentNode.parentNode;if($E(_trayHolder)){$tray.parentNode.removeChild($E(_trayHolder))}$tray.style.position="";var $search=$E("traySearchBar");$search.style.position="";$search.style.top="";this.notice.hide();$tray.style.display="block";$logo.style.display="block";$E("traySearchBar").parentNode.style.display="block";this.isFixed=!1}});Lib.tray.TrayPanel=TrayPanel;return function(){if(!tray){tray=new TrayPanel}return tray}});Core.System.htmlFilter=function(content){var codeHash={"&":"&#038;","<":"&#060;",">":"&#062;"};var k;for(k in codeHash){content=content.replace(new RegExp(k,"g"),codeHash[k])}return content};Utils.Io.loadExternalCSS=function(url,callback){if(typeof url!=="string"){return}var linkObj,styleObj,head=document.getElementsByTagName("head")[0];if($FF){styleObj=$C("style");styleObj.type="text/css";styleObj.innerHTML="@import url("+url+")";head.appendChild(styleObj);(function(){try{styleObj.sheet.cssRules;typeof callback==="function"&&callback()}catch(e){setTimeout(arguments.callee,50)}})()}else{linkObj=$C("link");linkObj.href=url;linkObj.type="text/css";linkObj.rel="stylesheet";linkObj.media="all";head.appendChild(linkObj);if($SAFARI||$CHROME){(function(){try{linkObj.sheet.cssRules;typeof callback==="function"&&callback()}catch(e){setTimeout(arguments.callee,50)}})()}else{linkObj.onload=function(){linkObj.onload=null;typeof callback==="function"&&callback()}}}};Core.Dom.removeClassName=Core.Dom.removeClass;scope.trayPlusTemplayLogout=['<div class="topbar_menu">','<span class="link"><a target="_blank" href="http://blog.sina.com.cn">博客首页</a></span>','<span class="line_s"></span>',"</div>",'<div class="topbar_login"><a id="linkTrayLogin" class="login" href="javascript:;">登录</a><a id="linkReg" target="_blank" class="register" href="">注册</a></div>','<div id="divPopularize" class="topbar_ad"></div>','<div id="loginBarActivity" class="topbar_activity"></div>'].join("");scope.trayPlusTemplayLogin=['<div class="topbar_menu" id="openedBlogTray">','<span id="loginBarOptApp" class="link"><a id="loginBarAppMenuLabel" href="javascript:;">读取中...</a><a href="javascript:;" class="link_arrow" title=""></a></span>','<span class="line_s"></span>','<span style="display:none;" id="loginBarMail" class="link imfor blog_to_mail"><a target="_blank" href="http://mail.sina.com.cn/?s=2">邮件</a><div id="mailpiaohong" style="display:none;" class="imforbox"></div></span>','<span class="line_s" style="display:none;" id="line"></span>','<span id="loginBarCenter" class="link"><a target="_self" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1">个人中心</a></span>','<span class="line_s"></span>','<span id="loginBarFriend" class="link"><a target="_blank" href="http://control.blog.sina.com.cn/blogprofile/profilefriendlist.php">好友</a></span>','<span class="line_s"></span>','<span id="loginBarInbox" class="link imfor"><img id="imgNewMessage" style="display:none;" class="topbar_msg" src="http://simg.sinajs.cn/blog7style/images/common/topbar/topbar_msg.gif"/><a href="#" onclick="return false;">消息</a><a href="#" onclick="return false;" class="link_arrow" title=""></a><div id="ccnotepiaohong" style="display:none;" class="imforbox"></div></span>','<span class="line_s"></span>','<span class="link" id="logOut"><a href="#">退出</a></span>',"</div>",'<div style="display:none" class="topbar_menu" id="noOpenedBlogTray">','<span class="link" style="cursor:default;"><a id="noOpenBlogName">读取中...</a></span>','<span class="line_s"></span>','<span class="link"><a href="#">退出</a></span>',"</div>",'<div class="topbar_noopen" style="display:none" id="outOfOpenBlogTray">','<a id="openBlogBtnTray" title="立即开通博客" class="nowopen" href="javascript:void(0)" onclick="return false;"></a>',"</div>",'<div id="loginBarActivity" class="topbar_activity"></div>'].join("");scope.trayPlusTemplayOnceLoged=['<div class="topbar_menu" id="openedBlogTray">','<span id="loginBarOptApp" class="link"><a id="loginBarAppMenuLabel" href="javascript:;">读取中...</a></span>','<span class="line_s"></span>','<span id="loginBarMail" class="link imfor blog_to_mail"><a target="_blank" href="http://mail.sina.com.cn/?s=2">邮件</a><div id="mailpiaohong" style="display:none;" class="imforbox"></div></span>','<span class="line_s" id="line"></span>','<span id="loginBarCenter" class="link"><a target="_self" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1">个人中心</a></span>','<span class="line_s"></span>','<span id="loginBarFriend" class="link"><a target="_blank" href="http://control.blog.sina.com.cn/blogprofile/profilefriendlist.php">好友</a></span>','<span class="line_s"></span>','<span id="loginBarInbox" class="link imfor"><img id="imgNewMessage" style="display:none;" class="topbar_msg" src="http://simg.sinajs.cn/blog7style/images/common/topbar/topbar_msg.gif"/><a href="#" onclick="return false;">消息</a><div id="ccnotepiaohong" style="display:none;" class="imforbox"></div></span>',"</div>",'<div style="display:none" class="topbar_menu" id="noOpenedBlogTray">','<span class="link" style="cursor:default;"><a id="noOpenBlogName">读取中...</a></span>','<span class="line_s"></span>','<span class="link"><a href="#">退出</a></span>',"</div>",'<div class="topbar_noopen" style="display:none" id="outOfOpenBlogTray">','<a id="openBlogBtnTray" title="立即开通博客" class="nowopen" href="javascript:void(0)" onclick="return false;"></a>',"</div>",'<div id="divPopularize" class="topbar_ad"></div>','<div id="loginBarActivity" class="topbar_activity"></div>'].join("");scope.newStatusTipTemplay=['<div class="tb_layer_arrow"></div>','<div class="tb_layer_Y_main tip_ps" style="width:130px;text-align:left;padding:5px 0 2px 5px;color:#000000">','<a onclick="$E(\'newStatusTip\').style.display=\'none\';return false" href="#" class="tb_friend_inputDel" title="关闭" style="margin-top: 5px;"></a>','<a href="http://i.blog.sina.com.cn/blogprofile/index.php?type=3&from=newstatus&com=2"><span id="nstFeed" style="padding:2px 2px;display:none;">你有<span style="color:red">新动态</span>可查看</span></a>','<a href="http://control.blog.sina.com.cn/blogprofile/profileremind.php?com=2"><span id="nstFavorite" style="padding:3px 2px;display:none;">你有博文被<span style="color:red">转载/收藏</span></span></a>','<img id="gbimg" class="SG_icon SG_icon83" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="17" height="15" align="absmiddle" style="display:none"/><a style="display:none" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=g" id="gbmsg">官博<em>新动态</em></a>',"</div>"].join("");scope.onceLogedStatusTipTemplay=['<div class="tb_layer_arrow"></div>','<div class="tb_layer_Y_main tip_ps" style="width:130px;text-align:left;padding:5px 0 2px 5px;color:#000000">','<a onclick="$E(\'newStatusTip\').style.display=\'none\';return false" href="#" class="tb_friend_inputDel" title="关闭" style="margin-top: 5px;"></a>','<a href="javascript:void(0);return false;"><span id="nstUnread" style="padding:3px 2px;display:none;">你有<span style="color:red">未读消息</span>可查看</span></a>','<a href="javascript:void(0);return false;"><span id="nstFeed" style="padding:2px 2px;display:none;">你有<span style="color:red">新动态</span>可查看</span></a>','<a href="javascript:void(0);return false;"><span id="nstUpdate" style="padding:3px 2px;display:none;">你最近浏览的博主<span style="color:red">有更新</span></span></a>','<a href="javascript:void(0);return false;"><span id="nstUnpub" style="padding:2px 2px;display:none;">你有<span style="color:red">尚未发表</span>的博文</span></a>',"</div>"].join("");scope.nicknamePanelTemplate=['<div id="#{panel}" class="tb_layer_Y tb_layer_w2" style="z-index:512;">','<div class="tb_layer_arrow"></div>','<div class="tb_layer_Y_main">','<div class="tb_ps">','<div class="tb_ps_list">',"<ul>","<li>",'<span class="tb_ps_nm"><a id="#{linkBlog}" href="javascript:;"><img class="SG_icon SG_icon15" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="博客" align="absmiddle" /><strong>博客</strong></a></span>','<span class="tb_ps_set">[<a target="_blank" id="#{linkPostBlog}" href="http://control.blog.sina.com.cn/admin/article/article_add.php">发博文</a>]</span>',"</li>","<li>",'<span class="tb_ps_nm"><a id="#{linkPhoto}" href="javascript:;"><img class="SG_icon SG_icon18" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="相册" align="absmiddle" /><strong>相册</strong></a></span>','<span class="tb_ps_set">[<a target="_blank" id="#{linkPostPhoto}" href="http://photo.blog.sina.com.cn/upload/upload.php">发图片</a>]</span>',"</li>","<li>",'<span class="tb_ps_nm"><a target="_blank" id="#{linkVBlog}" href="javascript:;"><img class="SG_icon SG_icon16" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="播客" align="absmiddle" /><strong>播客</strong></a></span>','<span class="tb_ps_set">[<a target="_blank" id="#{linkUpload}" href="http://vupload.you.video.sina.com.cn/u.php?m=1">发视频</a>][<a id="#{linkRecord}" href="http://vupload.you.video.sina.com.cn/r.php" target="_blank">录视频</a>]</span>',"</li>","<li>",'<span class="tb_ps_nm"><a id="#{miniblog}" href="javascript:;" target="_blank"><img class="SG_icon SG_icon51" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="微博" align="absmiddle" /><strong>微博</strong></a></span>',"</li>","<li>",'<span class="tb_ps_nm"><a id="#{mySpace}" href="javascript:;"><img class="SG_icon SG_icon41" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="关于我" align="absmiddle" /><strong>关于我</strong></a></span>',"</li>","</ul>",'<div class="clearit"></div>',"</div>",'<div class="tb_ps_manage">','<p><a target="_blank" id="#{linkChangeFace}" href="javascript:;">修改头像昵称</a></p>','<p><a target="_blank" id="#{linkChangePassword}" href="javascript:;">修改登录密码</a></p>','<p><a target="_blank" id="#{linkAccountSetup}" href="javascript:;">账号安全设置</a></p>','<p><a target="_blank" id="#{bindEmail}" href="javascript:;">绑定邮箱</a></p>',"</div>","</div>","</div>","</div>"].join("");scope.NicknamePanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.nicknamePanelTemplate)},Lib.Panel,{initUserInfo:function(uid){var nodes=this.getNodes();scope.$bindEmail=function(data){var node=nodes["bindEmail"];if(data.ret!="y"&&data.errcode!="not_verify"){node.parentNode.removeChild(node)}else{node.href="http://login.sina.com.cn/bindmail/bindmail.php?entry=blog"}};try{var username=/user=([^&]+)&/g.exec(decodeURIComponent(Utils.Cookie.getCookie("SUP")))[1];Utils.Io.JsLoad.request("http://login.sina.com.cn/bindmail/checkmailuser.php?entry=blog&name="+encodeURIComponent(username)+"&utf82bgk=1&callback=scope.$bindEmail",{noreturn:true})}catch(e){}nodes["linkBlog"].href="http://blog.sina.com.cn/u/"+uid;nodes["linkPhoto"].href="http://photo.blog.sina.com.cn/u/"+uid;nodes["linkVBlog"].href="http://you.video.sina.com.cn/m/"+uid;nodes["miniblog"].href="http://control.blog.sina.com.cn/t_sina_blog/tb.php?uname="+uid;nodes["mySpace"].href="http://blog.sina.com.cn/s/profile_"+uid+".html";nodes["linkChangeFace"].href="http://control.blog.sina.com.cn/blogprofile/nick.php";nodes["linkChangePassword"].href="http://login.sina.com.cn/member/security/password.php";nodes["linkAccountSetup"].href="http://login.sina.com.cn/member/security.php";var node=["linkBlog","linkPhoto","linkVBlog","miniblog","mySpace","linkChangeFace","linkChangePassword","linkAccountSetup"];for(var i=0;i<node.length;i++){nodes[node[i]].onclick=function(){v7sendLog("40_01_02_"+$UID)}}}});var st=['<div id="#{panel}" style="z-index:512;" class="tb_layerBox">',"<ul>",'<li id="#{blog}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">博文</a></li>','<li id="#{bauthor}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">博主</a></li>','<li id="#{song}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">音乐</a></li>','<li id="#{video}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">视频</a></li>','<li id="#{vauthor}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">播主 </a></li>',"</ul>","</div>"];scope.searchPanelTemplate=st.join("");scope.SearchPanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.searchPanelTemplate)},Lib.Panel,{config:{blog:{text:"博文",url:"http://search.sina.com.cn/?c=blog",keyName:"q",range:"article",by:"all"},bauthor:{text:"博主",url:"http://search.sina.com.cn/?c=blog",keyName:"q",range:"author",by:"all"},song:{text:"音乐",url:"http://music.sina.com.cn/yueku/search/s.php",keyName:"k",t:"song",s:"",ts:"",type:"",stype:""},video:{text:"视频",url:"http://search.video.sina.com.cn/search.php",keyName:"k",t:"",s:"sup",ts:"",type:"boke",stype:"1"},vauthor:{text:"播主",url:"http://search.video.sina.com.cn/search.php",keyName:"k",t:"",s:"sup",ts:"",type:"boke",stype:"3"}}});Core.Dom.opacity=function(elm,value){elm=typeof elm=="string"?$E(elm):elm;elm.style.filter="alpha(opacity="+value+")";elm.style.opacity=value/100};var st=['<div id="#{panel}" style="z-index:512;" class="tb_layer_Y tb_layer_w6" style="left:400px; top:700px;">','<div class="tb_layer_arrow"></div>','<div class="tb_layer_Y_main">','<div class="tb_mas" id="#{newInboxList}" style="">','<div class="tb_mas_list">','<ul id="#{changebgli1}"  style="display:none" >','<li  style="display:none" >','<span id="#{ccsysgonggao}" class="tb_friend_nm">[<strong>公告</strong>] <a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">新浪邀你一起共度中秋活动</a></span>','<span class="tb_friend_set"><a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">&gt;&gt;</a></span>',"</li>",'<li style="display:none">','<span id="#{ccsystongzhi}" class="tb_friend_nm">[<strong>通知</strong>] <a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">新浪2010邀你一起共度中秋活动...</a></span>','<span class="tb_friend_set"><a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">&gt;&gt;</a></span>',"</li>","</ul>",'<ul class="bd" id="#{changebgli2}">','<li  id="#{newInboxLoding}" style="cursor:default" ><div style="margin: 0pt; padding: 10px;text-align:center;"><img src="http://simg.sinajs.cn/blog7style/images/common/loading.gif"><div></li>','<li  id="#{nomsgli}" style="cursor:default;" >还没有消息</li>','<li style="float:none;"><span class="mas_more"><a id="#{mas_moremsg}" href="http://i.blog.sina.com.cn/blogprofile/profilelatestnote.php">全部消息</a></span></li>',"</ul>",'<div class="clearit"></div>',"</div>",'<ul class="commentslist" id="commentdata">','<li><a class="conn" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1">评论</a><a class="num" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1" id="#{commentRelapseCount}" ></a></li>','<li><a class="conn" href="http://i.blog.sina.com.cn/blogprofile/wall.php">留言</a><a class="num" href="http://i.blog.sina.com.cn/blogprofile/wall.php" id="#{guestBookCount}">1</a></li>','<li class="lst"><a class="conn" href="http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php">好友邀请</a><a class="num" href="http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php" id="#{inviteCount}" ></a></li>','<li><a class="conn" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1">纸条</a><a class="num" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1" id="#{messageCount}" ></a></li>','<li><a class="conn" target="_blank" href="http://mail.sina.com.cn" reject="1">邮箱</a><a class="num" href="http://mail.sina.com.cn" id="#{mailCount}" target="_blank" reject="1"></a></li>','<li><a class="conn" href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">系统消息</a><a class="num" href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote" id="#{sysnoticeCount}" ></a></li>',"</ul>","</div>","</div>","</div>"];scope.newInboxPanelTemplate=st.join("");Lib.LocalDB={_this:null,isFlashReady:false,FlaDom:null,updataFun:null,loadedFun:null,regiFun:[],regiFunArgs:[],scacheReady:function(){var me=Lib.LocalDB;me.isFlashReady=true;if(me.loadedFun){me.loadedFun(me._this)}var f=me.regiFun;var a=me.regiFunArgs;for(var i=0;i<f.length;i++){f[i].apply(null,a[i])}},registerFun:function(fun,args){this.regiFun.push(fun);var a=args||[];this.regiFunArgs.push(a)},set:function(key,data){if(this.isFlashReady){try{this.FlaDom.setLazyInterface(key,data);return true}catch(e){trace("set函数出错")}}return false},get:function(key,escapeMsecond,ignore){if(this.isFlashReady){try{return this.FlaDom.getLazyInterface(key,escapeMsecond,ignore)}catch(e){trace("get函数出错")}}return false},clearCache:function(escapeMsecond,key){
if(this.isFlashReady){try{$E("scache").clearCache(escapeMsecond,key)}catch(e){trace("gclearCache函数出错")}}return false},loadFlash:function(containerDiv){var random="";if(window.$Maxthon||window.$360||window.$TT){random="?t="+Core.Math.getUniqueId()}if(!this.FlaDom){var FlashPlayer=new Utils.Flash.swfObject($_GLOBAL.flashBasicURL+"scache.swf"+random,"scache","1","1","9","#00ff00");FlashPlayer.addParam("quality","high");FlashPlayer.addParam("wmode","transparent");FlashPlayer.addParam("allowScriptAccess","always");FlashPlayer.write(containerDiv);this.FlaDom=$E("scache")}},getServer:function(){try{return this.FlaDom.isServer()}catch(e){trace("判断是否是通信主机发生错误");return false}},login:function(uid){try{this.FlaDom.login(uid)}catch(e){trace("login函数出错");trace(uid)}},sendToClient:function(data){try{if(this.getServer()){this.FlaDom.sendToClient(data)}else{}}catch(e){trace("sendToClient函数出错")}},setClientJsFun:function(jsFun){try{if(this.getServer()){this.FlaDom.setClientJsFun(jsFun)}else{trace("非主机不可以设置接收函数")}}catch(e){trace("setClientJsFun函数出错")}},receive:function(data){this.updataFun(data)}};scope.msnTipsTemplate=['<div id="#{panel}" style="position: absolute; width: 369px; padding-top: 7px; font-size: 12px; z-index:511">',"<div  style=\"top: 0pt; left: 65px; position: absolute; width: 16px; height: 8px; background: url('http://simg.sinajs.cn/blog7style/images/special/move/bg_boxtop_01.png') no-repeat scroll 0pt 0pt transparent; z-index: 100;\"></div>","<div style=\"padding: 5px 6px 9px 14px; border: 1px solid rgb(181, 202, 214); background: url('http://simg.sinajs.cn/blog7style/images/special/move/bg_asiangames.jpg') no-repeat scroll left bottom rgb(255, 255, 255); z-index: 1;\">",'<p id="#{close}" class="close" style="float: right; margin: 0pt; cursor: pointer; width: 8px; height: 8px; font-size: 0pt;background:url(\'http://simg.sinajs.cn/blog7style/images/special/move/btn_close.gif\') no-repeat 0 0;"></p>','<div style="width: 342px; margin: 10px 0pt 0pt; padding: 0pt 0pt 3px;">','<a style="float: left; margin: 0pt 10px 0pt 0pt;" href="#"><img height="91" width="122" style="border: 0pt none;" alt="MSN" src="http://simg.sinajs.cn/blog7style/images/special/move/img_msnphoto.png"></a>','<h3 style="padding: 2px 0pt 5px; color: rgb(0, 0, 0); margin: 0pt; font-size: 12px;">各位拥有MSN帐号的同学注意啦!</h3>','<p style="width: 268px; display: inline; text-indent: 0pt; padding: 0pt; color: rgb(51, 51, 51); line-height: 19px;">新浪博客帐号与MSN帐号已经实现关联。您可以使用MSN帐号来登录博客，绑定后发博文、发图片可同步到Live，第一时间让您的MSN好友知晓。</p>',"</div>",'<p style="clear: both; height: 30px; margin: 12px 10px 4px 0pt; padding: 12px 0pt 0pt; border-top: 1px solid rgb(220, 213, 211); text-align: right;"><a style="float: right; color: rgb(176, 173, 172); margin-top: 10px; text-decoration: none;" href="javascript:void(0);" id="#{noMoreShow}">不再显示</a><a style="float: right; text-decoration: none; margin: 10px 14px 0pt 16px;color:#2d3186;" href="http://blog.sina.com.cn/s/blog_4b0f52990100lt3i.html">帮助</a><a id="#{setNow}"style="float: right;" href="http://control.blog.sina.com.cn/blogprofile/msnbind.php"><img height="32" width="105" style="border: medium none;" alt="立即设置" src="http://simg.sinajs.cn/blog7style/images/special/move/btn_receive01.jpg"></a></p>',"</div>","</div>"].join("");scope.msnTips=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.msnTipsTemplate)},Lib.Panel,{initUserInfo:function(nick,uid){var nodes=this.getNodes();this.setFixed($E("loginBarActivity"),-230,-2);var _this=this;nodes["close"].onclick=function(){_this.hidden()};nodes["noMoreShow"].onclick=function(){_this.hidden();Utils.Cookie.setCookie("noMoreMsnTips"+$UID,1,24*100,"/",".blog.sina.com.cn")};nodes["setNow"].onclick=function(){v7sendLog("95_02_01",scope.$pageid,"")}},setFixed:function(dom,offsetLeft,offsetTop){var _this=this;setTimeout(function(){_this.showWithDom(dom,offsetLeft,offsetTop);_this.fadeIn()},2e3);Core.Events.addEvent(window,function(){var x=Core.Dom.getLeft(dom)+dom.offsetWidth+offsetLeft;var y=Core.Dom.getTop(dom)+dom.offsetHeight+offsetTop;if($IE6&&_this.isFixed){x=x-document.documentElement.scrollLeft;y=y-document.documentElement.scrollTop}_this.setPosition(x,y)},"resize")},fadeIn:function(){var entity=this.entity;Core.Dom.opacity(entity,0);var i=0;(function fn(){Core.Dom.opacity(entity,i+=5);if(Core.Dom.getStyle(entity,"opacity")<1){setTimeout(fn,20)}})()}});scope.NewInboxPanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.newInboxPanelTemplate);this.nodes=this.getNodes();var me=this;var t=Lib.LocalDB;if(/Mobile/i.test(navigator.userAgent)){setTimeout(function(){me.requestDataInterface()},100)}else{if(!t.FlaDom){t._this=me;t.loadedFun=me.FlashLoaded;t.loadFlash("trayFlashConnetion")}else{me.FlashLoaded(me)}}Core.Events.addEvent($E("loginBarInbox"),function(event){v7sendLog("40_01_09_"+$UID);var target=event&&event.target||window.event&&window.event.srcElement;if(target&&target.tagName&&target.tagName.toLowerCase()=="a"){v7sendLog("45_01_10_"+$UID)}me._hasOverview=true;$E("ccnotepiaohong").style.display="none";me.requestMsgDate()},"click");this.interfaceMessages=new Interface("http://interface.blog.sina.com.cn/riaapi/profile/unread.php","jsload")},Lib.Panel,{nodes:null,_connectSWF:null,_SWFChannelName:"inboxConnection",interfaceMessges:null,isMessageLoaded:false,isUICServiceLoaded:true,isHaveNewMessage:false,_listData:null,_productIDs:{blog:1,vblog:2,group:4,photo:8,cube:16},_msgIsLoad:false,_newnote:0,_hasOverview:false,interfaceUICServiceURL:"http://uic.sinajs.cn/uic?type=service&uids=#{uids}&varname=service",FlashLoaded:function(me){var t=Lib.LocalDB;var _this=me;window.$updateData=function(dataObj){_this.updateData(dataObj)};Lib.checkAuthor();t.login($UID);t.setClientJsFun("$updateData");setTimeout(function(){_this.requestDataInterface()},100)},requestMsgDate:function(){this.updateView("loading");var me=this;var clearnum=0;if(this._hasOverview){clearnum=this._newnote;this._newnote=0;this._hasOverview=false}var inter=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/note/notetips.php?clearnum="+clearnum,"jsload");inter.request({GET:{uid:$UID},onSuccess:function(res){if(typeof res.announcement!="undefined"&&res.announcement){me.nodes["ccsysgonggao"].innerHTML='[<strong>公告</strong>]&nbsp;<a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">'+res.announcement+"</a>";me.nodes["ccsysgonggao"].parentNode.style.display=""}else{me.nodes["ccsysgonggao"].parentNode.style.display="none"}if(typeof res.sysNote!="undefined"&&res.sysNote){me.nodes["ccsystongzhi"].innerHTML='[<strong>通知</strong>]&nbsp;<a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">'+res.sysNote+"</a>";me.nodes["ccsystongzhi"].parentNode.style.display=""}else{me.nodes["ccsystongzhi"].parentNode.style.display="none"}if(typeof res.sysNote=="undefined"&&typeof res.announcement=="undefined"){me.nodes["ccsystongzhi"].parentNode.parentNode.style.display="none"}else{me.nodes["ccsystongzhi"].parentNode.parentNode.style.display=""}me.nodes["nomsgli"].style.display="";if(typeof res.notice!="undefined"&&res.notice){var aNotice=res.notice;while(me.nodes["changebgli2"].childNodes.length>2){me.nodes["changebgli2"].removeChild(me.nodes["changebgli2"].childNodes[me.nodes["changebgli2"].childNodes.length-3])}for(var i=aNotice.length-1;i>=0;i--){var li=$C("li");li.innerHTML=aNotice[i].data;li._href=aNotice[i].url;me.nodes["changebgli2"].insertBefore(li,me.nodes["changebgli2"].firstChild);li.onclick=function(){v7sendLog("45_01_11_"+$UID);window.location.href=this._href};me.nodes["nomsgli"].style.display="none"}}if(parseInt($E("ccnotepiaohong").innerHTML,10)>0){var num=parseInt($E("ccnotepiaohong").innerHTML,10);var cn=me.nodes["changebgli2"].childNodes;for(var j=0;j<cn.length-2&&j<num;j++){Core.Dom.removeClassName(cn[j],"cur");cn[j].className+=" cur"}}me.updateView("loaded");me._msgIsLoad=true;me.bindliEvent()},onError:function(data){},onFail:function(){}});var mailInter=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/note/unreadmail.php","jsload");mailInter.request({onSuccess:function(data){var tota=parseInt(data)||0;if(tota>99){tota="99+"}me.nodes.mailCount.innerHTML=tota||""},onError:function(){me.nodes.mailCount.innerHTML=""}})},requestDataInterface:function(){var _this=this;Lib.checkAuthor();var t=Lib.LocalDB;var d=null;if(t.isFlashReady&&!this.checkCache){this.clearCache();d=t.get("uid_"+$UID+"unread",60*1e3*4);this.checkCache=true}var unreadOk=function(data,isCache){if(!d&&!isCache){t.set("uid_"+$UID+"unread",data)}if(data["isBindToMsn"]==0&&Utils.Cookie.getCookie("noMoreMsnTips"+$UID)!=1){}_this.isMessageLoaded=true;_this.onMessageLoad(data["nickname"]);_this._listData=data;scope.unreadMsg=data;scope.nickname=data["full_nickname"];scope.loginUserWtype=data["login_wtype"];if(data.svr_time)scope.$svr_time=data.svr_time;if(data.nfn>=1){v7sendLog("40_01_03_"+$UID);_this.initNewStatusTip(data)}else{}_this.updateListData(data);if(_this.isMessageLoaded){_this.updateData({data:_this._listData});_this.onLoaded()}scope.hasOpenBlog=data.isbloguser==1?"open":"no";scope.bindTrayOpenTime=1;Lib.Listener.notify("tray-data-loaded",data);if(scope.hasOpenBlog=="no"&&scope.bindTrayOpenTime==1){if(!$E("openblogcss")){Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"})}$E("openedBlogTray").style.display="none";$E("noOpenedBlogTray").style.display="";$E("outOfOpenBlogTray").style.display="";scope.addBlogOpenerEvent($E("openBlogBtnTray"));$E("noOpenBlogName").href="http://blog.sina.com.cn/u/"+$UID;scope.bindTrayOpenTime=2}scope.unreadOkExecuted=true};if(d){unreadOk(d,true);trace("-------unread 使用缓存的数据!!!----")}else{trace("-----直接调用unread接口！！！");this.interfaceMessages.request({GET:{uid:$UID,product:"blog"},onSuccess:unreadOk,onError:function(data){},onFail:function(){}})}},clearCache:function(){var pageId={profile_notice:"notice",profile_paperlist:"message",profile_invitelist:"invite",profile_commlist:"blogcomment",profile_replylist:"blogrecomment",profile_guestBookM:"gbook",profile_commtrash:"trashcomment",profile_commphotolist:"photocomment",profile_index:"profile_index",profile_remind:"profile_remind"};var t=Lib.LocalDB;var d=t.get("uid_"+$UID+"unread",60*1e3*4);if(d&&pageId[scope.$pageid]&&typeof d[pageId[scope.$pageid]]!=undefined){trace("-----清除缓存");t.clearCache(10,"uid_"+$UID+"unread")}var ccn=$UID+"_clear_flash";var clearFlash=Utils.Cookie.getCookie(ccn);if(clearFlash==1){trace("【活动】根据cookie标记,清除Flash缓存");t.clearCache(10,"uid_"+$UID+"unread");Utils.Cookie.setCookie(ccn,"",0,"/",".sina.com.cn")}},initMsnTips:function(){Lib.checkAuthor();(new scope.msnTips).initUserInfo($nick,$UID)},initNewStatusTip:function(data){if(scope.$pageid=="profile_index"||scope.$pageid=="pageSetM"||scope.$pageid=="editor"){return}var tip=$E("newStatusTip");if(tip||!data){return}v7sendLog("45_01_07_"+$UID);tip=$C("div");tip.id="newStatusTip";tip.className="tb_layer_Y tb_layer_w3";tip.style.width="138px";tip.innerHTML=scope.newStatusTipTemplay;var a=$T($E("loginBarCenter"),"a")[0];var loc=Core.Dom.getXY(a);tip.style.left=loc[0]-(138/2-a.offsetWidth/2)+"px";tip.style.top=loc[1]+a.offsetHeight+"px";tip.style.zIndex="510";if(a.href.indexOf("?")==-1){a.href+="?type=2&from="+scope.$pageid}Core.Dom.opacity(tip,0);document.body.appendChild(tip);if(data.nfn>=1){$E("nstFeed").style.display="block";$E("nstFeed").onclick=function(){v7sendLog("45_01_09_"+$UID);v7sendLog("40_01_04_"+$UID)}}if(data.official_blog==1){$E("gbimg").style.display="";$E("gbmsg").style.display=""}for(var i=1;i<=500;i++){(function(val){setTimeout(function(){Core.Dom.opacity(tip,val*2/10)},val*2)})(i)}if(scope.$pageid=="editor"){a.target="_blank";$E("nstFeed").parentNode.target="_blank";$E("gbmsg").style.target="_blank";Core.Events.addEvent(a,this.closeTip(a),"click")}Core.Events.addEvent(window,function(){var a=$T($E("loginBarCenter"),"a")[0];var loc=Core.Dom.getXY(a);tip.style.left=loc[0]-(138/2-a.offsetWidth/2)+"px";tip.style.top=loc[1]+a.offsetHeight+"px"},"resize")},closeTip:function(ele){return function(){$E("newStatusTip").style.display="none";ele.href=ele.href.split("?")[0]}},updateData:function(dataObj){var t=Lib.LocalDB;var _this=this;Lib.checkAuthor();try{if($UID&&$UID==dataObj.uid||t.getServer()==true){_this.isHaveNewMessage=false;_this.isMessageLoaded=false;_this.updateListData(dataObj.data);if(_this._newnote>0){v7sendLog("45_01_08_"+$UID);v7sendLog("40_01_08_"+$UID)}if(dataObj.data.nfn>=1){_this.initNewStatusTip()}}}catch(ex){}if(t.getServer()==true){Lib.checkAuthor();t.sendToClient({data:dataObj.data,uid:$UID});setTimeout(function(){_this.requestUICService();_this.requestDataInterface()},6e4*4)}else{setTimeout(function(){if(t.getServer()){t.setClientJsFun("$updateData");_this.requestUICService();_this.requestDataInterface()}},6e4*4)}},initializeList:function(){this.requestUICService();this.checkCache=false},updateListData:function(dataCollection){try{var tota=0;tota+=parseInt(this._getFormatCountString(dataCollection["invite"])||0);if(tota>500){tota="500+"}this.nodes["inviteCount"].innerHTML=tota?tota:""}catch(e){}try{var tota=0;tota+=parseInt(this._getFormatCountString(dataCollection["message"])||0);if(tota>500){tota="500+"}this.nodes["messageCount"].innerHTML=tota?tota:""}catch(e){}try{var tota=0;tota+=parseInt(dataCollection["unreadnotices"]||0);tota+=parseInt(dataCollection["notice"]||0);if(tota>500){tota="500+"}this.nodes["sysnoticeCount"].innerHTML=tota?tota:""}catch(e){}Lib.checkAuthor();try{var tota=0;tota+=parseInt(this._getFormatCountString(dataCollection["gbook"])||0);tota+=parseInt(this._getFormatCountString(dataCollection["trashwall"])||0);if(tota>500){tota="500+"}this.nodes["guestBookCount"].innerHTML=tota?tota:""}catch(e){}try{var tota=0;tota+=parseInt(dataCollection["blogcomment"]||0);tota+=parseInt(dataCollection["blogrecomment"]||0);tota+=parseInt(dataCollection["photocomment"]||0);tota+=parseInt(dataCollection["trashcomment"]||0);if(tota>500){tota="500+"}this.nodes["commentRelapseCount"].innerHTML=tota?tota:""}catch(e){}this._newnote=parseInt(dataCollection["newnotes"],10);if(this._newnote>0){$E("ccnotepiaohong").innerHTML=this._newnote>500?"500+":this._newnote;$E("ccnotepiaohong").style.display=""}else{$E("ccnotepiaohong").style.display="none"}var i,msgCfg=["notice","invite","message","blogcomment","blogrecomment","photocomment","trashcomment","vblogcomment","gbook"],len=msgCfg.length;for(i=0;i<len;i++){if(parseInt(dataCollection[msgCfg[i]])>0){this.isHaveNewMessage=true}var k;for(k in dataCollection){if(k!="version"&&window.parseInt(dataCollection[k])>0){if($E("left_"+k)){$E("left_"+k).innerHTML="("+dataCollection[k]+")"}}}}},requestUICService:function(){Lib.checkAuthor();if(this.isMessageLoaded){this.updateData({data:this._listData});this.onLoaded()}},_getFormatCountString:function(count){var result="";if(!isNaN(parseInt(count))&&parseInt(count)!=0){if(parseInt(count)>500){result="(<strong>500+</strong>)"}else{result=count}}return result},updateView:function(loadState){this.nodes["newInboxLoding"].style.display=loadState=="loaded"?"none":"";if(loadState=="loading"){this.nodes["nomsgli"].style.display="none"}},onLoaded:function(){},onMessageLoad:function(nickname){$E("loginBarAppMenuLabel").innerHTML=Core.System.htmlFilter(nickname);$E("noOpenBlogName").innerHTML=Core.System.htmlFilter(nickname)},bindliEvent:function(){var lis=this.nodes["changebgli1"].getElementsByTagName("li");var lis2=this.nodes["changebgli2"].getElementsByTagName("li");for(var i=0;i<lis.length;i++){lis[i].style.cursor="pointer";lis[i].onmouseover=function(){this._className=this.className;this.className="on"};lis[i].onmouseout=function(){this.className=this._className}}for(var i=0;i<lis2.length-1;i++){if(lis2[i]==this.nodes["nomsgli"]){continue}lis2[i].style.cursor="pointer";lis2[i].onmouseover=function(){this._className=this.className;this.className="on"};lis2[i].onmouseout=function(){this.className=this._className}}var commentdata=$E("commentdata");if(commentdata){Core.Events.addEvent(commentdata,function(event){logFunc(event)})}Core.Events.addEvent(this.nodes["changebgli1"],function(event){logFunc(event)});Core.Events.addEvent(this.nodes["changebgli2"],function(event){logFunc(event)});function logFunc(event){var target=event&&event.target||window.event&&window.event.srcElement;if(target&&target.tagName&&(target.tagName.toLowerCase()=="a"||target.tagName.toLowerCase()=="li")&&!target.getAttribute("reject")){v7sendLog("40_01_10_"+$UID);v7sendLog("45_01_11_"+$UID)}}}});scope.addArticleTemplate=['<div id="#{panel}" class="wrtBlog_sub" style="z-index:512;">','<div class="wrtBlog_sub2">','<p><img width="15" height="16" align="absmiddle" title="写365" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon138"><a onclick="v7sendLog(\'48_01_18\');v7sendLog(\'40_01_14\');" href="http://control.blog.sina.com.cn/admin/article/article_add.php?tag365" target="_blank">写365</a></p>','<div class="SG_j_linedot"></div>','<p><img class="SG_icon SG_icon88" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="长微博" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\'40_01_14\')" href="http://control.blog.sina.com.cn/admin/article/changWeiBo.php">长微博</a></p>','<div class="SG_j_linedot"></div>','<p><img class="SG_icon SG_icon18" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="发照片" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\'40_01_14\')" href="http://photo.blog.sina.com.cn/upload/upload.php">发照片</a></p>','<div class="SG_j_linedot"></div>','<p><img class="SG_icon SG_icon16" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="发视频" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\'40_01_14\')" href="http://vupload.you.video.sina.com.cn/u.php?m=1">发视频</a></p>','<div id="tray_tbh_ware_linedot" style="display:none;" class="SG_j_linedot"></div>','<p id="tray_tbh_ware_link" style="display:none;"><img class="SG_icon SG_icon150" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="发商品" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\'40_01_14\')" href="http://control.blog.sina.com.cn/admin/article/article_add.php?tbh=1">发商品</a></p>',"</div>","</div>"].join("");scope.addArticlePanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.addArticleTemplate);this.hidden()},Lib.Panel,{});Lib.PlatformTrayPlus=Core.Class.create();Lib.PlatformTrayPlus.prototype={tray:null,subPanels:[],trayLogin:null,initialize:function(){},load:function(loginState){var bar_logo=$E("login_bar_logo_link_350");if(bar_logo&&$_GLOBAL&&$_GLOBAL.platformTrayLogo){if(!$IE6&&$_GLOBAL.platformTrayLogo.imgForOtherBrs){bar_logo.children[0].src=$_GLOBAL.platformTrayLogo.imgForOtherBrs}else if($_GLOBAL.platformTrayLogo.imgForIE6){bar_logo.children[0].src=$_GLOBAL.platformTrayLogo.imgForIE6}}switch(loginState){case"login":if($E("loginBarOptApp")==null||!$isAdmin){this.render(scope.trayPlusTemplayLogin);trace("++++js渲染 登陆后++++++")}this.initStatic();if(/ipad/i.test(navigator.userAgent)){v7sendLog("48_01_02")}this.setNodesMouseHoverStyle(["loginBarOptApp","loginBarMail","loginBarCenter","loginBarFriend","loginBarInbox"]);this.initNicknamePanel();this.initNewInboxPanel();this.initActivityPanel();var that=this;Utils.Io.JsLoad.request("http://service.mail.sina.com.cn/mailproxy/mail.php",{onComplete:function(){var email=sinamailinfo.email;if(email!=""){that.initMailRemind()}},onException:function(){}});this.initMsnLogout();if(scope&&scope.$private&&scope.$private.msnfeed){var _this=this;setTimeout(function(){_this.displayUserGuideTips()},1e3)}break;case"logout":this.trayLogin=new Lib.Login.Ui;if($E("phprender")===null){this.render(scope.trayPlusTemplayLogout);trace("-----------js渲染---------")}else{trace("-----------php渲染---------")}this.initLogin();this.initPopularize();break;case"oncelogedon":this.trayLogin=new Lib.Login.Ui;this.render(scope.trayPlusTemplayOnceLoged);this.setNodesMouseHoverStyle(["loginBarOptApp","loginBarMail","loginBarCenter","loginBarFriend","loginBarInbox"]);var info=Lib.Login.info();var uid=info&&info.uid;$E("loginBarAppMenuLabel").innerHTML=info&&info.nick;this.initPopularize();this.initOnceLogedEvent(["loginBarOptApp","loginBarMail","loginBarCenter","loginBarFriend","loginBarInbox"],uid);this.initOnceLogedTips(uid);this.initStatic();break}this.initAddArticlePanel();this.initSearchPanel();this.initFilmSearch()},displayUserGuideTips:function(){if(!window.scope||scope.$pageid==="profile_index"){Utils.Cookie.setCookie($UID+"alreadyVisitProfileIndex","true","86400","/",".sina.com.cn");return}var _this=this;function updateTipPos(){var loginBarCenter=$E("loginBarCenter");if(loginBarCenter){var pos=Core.Dom.getXY(loginBarCenter),left=pos[0]+loginBarCenter.offsetWidth/2-_this.tipsUserGuide.offsetWidth/2+"px",top=pos[1]+loginBarCenter.offsetHeight+10+"px"}_this.tipsUserGuide.style.left=left;_this.tipsUserGuide.style.top=top}},initStatic:function(){if(!this._commetTimer){var send=function(){var uid=scope.$uid;var blogid=scope.$articleid||"";var url="http://comet.blog.sina.com.cn/api?maintype=notice";Utils.Io.JsLoad.request(url,{GET:{uid:uid||"",blogid:blogid},onComplete:function(r){}})};this._commetTimer=setInterval(send,30*1e3);setTimeout(function(){send()},15)}},initFilmSearch:function(){var ele=$E("loginBarSearchInput");ele&&(ele.value="");var tag=$E("loginBarSearchSType");tag&&(tag.value="title")},render:function(html){$E("trayContainer").innerHTML=html},initLogin:function(){var me=this;var homeNode=Core.Dom.getElementsByClass($E("trayContainer"),"span","link")[0];homeNode.onclick=function(){v7sendLog("40_01_15")};Core.Events.addEvent($E("linkTrayLogin"),function(){v7sendLog("40_01_16");if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};me.trayLogin.login(function(){Lib.checkAuthor();var str=$UID==scope.$uid?"02":"01";v7sendLog("87_01_"+str+"_"+$UID,scope.$pageid);setTimeout(function(){window.location=window.location.toString().replace(/#.*/,"")},100)},false,"referer:"+location.hostname+location.pathname+",func:0007")},"click");$E("linkReg").href="http://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid="+scope.$uid+"&src=blogicp";$E("linkReg").onclick=function(){v7sendLog("40_01_17")};if(scope.$channel){if(scope.$channel==2){$E("linkReg").href="http://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid="+scope.$uid+"&src=baby"}}},initPopularize:function(){var popEl=$E("divPopularize");if(popEl){this.hideActiLink(popEl);this._loadPopularizeData(popEl)}},_loadPopularizeData:function(parentEl){Utils.Io.JsLoad.request("http://blog.sina.com.cn/lm/iframe/283/2012/0705/1.js",{charset:"utf-8",onComplete:function(data){var cfg=$_GLOBAL.popularizeConfig;if(!cfg||parentEl.innerHTML){return}var len=cfg.length;var cookieUtil=Utils.Cookie;var index=parseInt(cookieUtil.getCookie("blogPopularizeIndex")||0);if(len<=index){index=0}cookieUtil.setCookie("blogPopularizeIndex",1+index,24,"/",".blog.sina.com.cn");parentEl.innerHTML=cfg[index];if($E("err_i8t9c")){var txt=parentEl.innerText||parentEl.textContent||"";if(txt.length>10){parentEl.children[0].innerHTML=txt.substr(0,9)+"..."}}}})},setNodesMouseHoverStyle:function(nodeNames){var i,len=nodeNames.length;for(i=0;i<len;i++){Core.Events.addEvent($E(nodeNames[i]),function(idx){return function(){Core.Dom.removeClassName($E(nodeNames[idx]),"current");$E(nodeNames[idx]).className+=" current"}}(i),"mouseover");Core.Events.addEvent($E(nodeNames[i]),function(idx){return function(){Core.Dom.removeClassName($E(nodeNames[idx]),"current")}}(i),"mouseout")}$E("loginBarCenter").onclick=function(){v7sendLog("40_01_05_"+$UID)};$E("loginBarFriend").onclick=function(){v7sendLog("40_01_06_"+$UID)};$E("logOut").onclick=function(){v7sendLog("40_01_11_"+$UID)}},initNicknamePanel:function(){var nicknamePanel=new scope.NicknamePanel;Lib.checkAuthor();nicknamePanel.initUserInfo($UID);this.addSubPanel(nicknamePanel,$E("loginBarOptApp"),-98,-9);var me=this;if(Utils.Cookie.getCookie("loginFromMsn")&&!$E("msnLoginIcon")){var holder=$C("img");holder.src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif";holder.style.cssFloat=holder.style.styleFloat="left";holder.width="18";holder.height="0";holder.style.padding="9px 0";holder.align="absmiddle";Core.Dom.insertAfter(holder,$E("loginBarAppMenuLabel"));trace("创建msn icon");createLinkMask(holder)}else{trace("不渲染msn icon")}function createLinkMask(holder){var mask=$C("a");var span=holder.parentNode;var container=span.parentNode;var node=$C("img");container.style.position="relative";span.style.position="relative";node.id="msnLoginIcon";node.className="SG_icon SG_icon136";node.src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif";node.style.width="18px";node.style.height="18px";node.align="absmiddle";mask.appendChild(node);mask.href="http://control.blog.sina.com.cn/blogprofile/msnbind.php?c="+ +new Date;mask.target="_blank";mask.style.cssText="display:block; width:18px; height:18px; position:absolute; z-index:1024;";mask.style.paddingTop="4px";mask.title="MSN账号登录";container.insertBefore(mask,container.childNodes[0]);Core.Events.addEvent(window,relocation,"resize");trace("创建msn icon mask");relocation();function relocation(){var timer=setInterval(function(){var adminName=$E("loginBarAppMenuLabel").innerHTML;if(adminName!=="读取中..."){var strLeft=holder.offsetLeft+"px";mask.style.left=strLeft;trace("刷新msn icon mask");clearInterval(timer)}},300)}scope.$msnRelocation=relocation}},initAddArticlePanel:function(){var addArticlePanel=new scope.addArticlePanel;this.addSubPanel(addArticlePanel,$E("arrowAddArticle"),-81,0);$E("arrowAddArticle").onclick=function(){v7sendLog("40_01_13_"+($UID?$UID:""))};$E("arrowAddArticle").parentNode.children[0].onclick=function(){v7sendLog("40_01_12_"+($UID?$UID:""))}},showPublishWare:function(data){if(data["tbh_status"]&&parseInt(data["tbh_status"],10)){$E("tray_tbh_ware_linedot").style.display="";var publishBtn=$E("tray_tbh_ware_link");publishBtn.style.display="";try{var link=$T(publishBtn,"a")[0];if(scope&&"editor"==scope.$pageid){link.href="javascript:;";link.target="";link.onclick=function(){var plugin=$E("shortcut_content");var imgs=$T(plugin,"img");for(var i=0;i<imgs.length;i++){if(-1!=imgs[i].src.indexOf("element_shop")){Core.Events.click(imgs[i])}}}}link=null;publishBtn=null}catch(e){}}Lib.Listener.off({name:"tray-data-loaded",callBack:this.showPublishWare,scope:this})},initSearchPanel:function(){var searchPanel=new scope.SearchPanel;this.addSubPanel(searchPanel,$E("searchSelect"),-54,-4);Utils.Form.limitMaxLen($E("loginBarSearchInput"),50);var spNodes=searchPanel.getNodes();var cfg;for(cfg in searchPanel.config){(function(c){Core.Events.addEvent(spNodes[c],function(){_setActiveOption(c)},"click")})(cfg)}_setActiveOption("blog");$E("searchSelect").onclick=function(){v7sendLog("40_01_18")};var searchNode=Core.Dom.getElementsByClass($E("loginBarSearchForm"),"input","topbar_searchBtn")[0];searchNode.onclick=function(){v7sendLog("40_01_20")};Core.Events.addEvent($E("loginBarSearchInput"),function(e){var c=e.keyCode||e.charCode;if(c==15){v7sendLog("40_01_20")}},"keyup");function _setActiveOption(opt){var formEl=$E("loginBarSearchForm");formEl.action=searchPanel.config[opt]["url"];$E("loginBarSearchMenuLabel").innerHTML=spNodes[opt].getElementsByTagName("a")[0].innerHTML;var searchCEl=$E("loginBarSearchC"),searchTEl=$E("loginBarSearchT"),searchTypeEl=$E("loginBarSearchType"),searchSEl=$E("loginBarSearchS"),searchTSEl=$E("loginBarSearchTS"),searchTextEl=$E("loginBarSearchInput");switch(opt){case"all":case"blog":case"bauthor":if(!searchCEl){searchCEl=$C("input");searchCEl.type="hidden";searchCEl.name="c";searchCEl.id="loginBarSearchC";formEl.appendChild(searchCEl)}searchCEl.value="blog";searchTEl.value=searchPanel.config[opt]["range"];searchTEl.name="range";searchTypeEl.value=searchPanel.config[opt]["by"];searchTypeEl.name="by";searchTextEl.name=searchPanel.config[opt]["keyName"];break;case"song":case"video":case"vauthor":searchCEl&&(searchCEl.value="");searchTEl.value=searchPanel.config[opt]["t"];searchTEl.name="t";searchSEl.value=searchPanel.config[opt]["s"];searchTSEl.value=searchPanel.config[opt]["ts"];searchTypeEl.value=searchPanel.config[opt]["type"];searchTypeEl.name="type";$E("loginBarSearchSType").value=searchPanel.config[opt]["stype"];searchTextEl.name=searchPanel.config[opt]["keyName"];break}}},hideActiLink:function(el){var pageId=scope.$pageid;if("pageSetM"!==pageId&&"editor"!==pageId){el.style.display="none";el.setAttribute("shouldShow","1")}setTimeout(function(){if(typeof BLOG_AD_TIPS=="undefined"||!BLOG_AD_TIPS){el.style.display="";return}},3e3)},initActivityPanel:function(){if($_GLOBAL){var loginActLink=$E("loginBarActivity");if(loginActLink){this.hideActiLink(loginActLink);this._loadPopularizeData(loginActLink)}}if($_GLOBAL.activityBlackList&&$_GLOBAL.activityBlackList[scope.$pageid]){trace("【活动】当前页面在黑名单");return}},initMsnLogout:function(){var _tray=$E("openedBlogTray");var _a_list=_tray.getElementsByTagName("a");var _logout_a=_a_list[_a_list.length-1];_logout_a.href="#";_logout_a.onclick=function(){return false};var _tray_noIn=$E("noOpenedBlogTray");var _a_list_noIn=_tray_noIn.getElementsByTagName("a");var _logout_a_noIn=_a_list_noIn[_a_list_noIn.length-1];_logout_a_noIn.href="#";_logout_a_noIn.onclick=function(){return false};var _curHref=encodeURIComponent(window.location.href);if(_tray)Core.Events.addEvent(_logout_a,logoutMsnAndBlog);if(_tray_noIn)Core.Events.addEvent(_logout_a_noIn,logoutMsnAndBlog);function logoutMsnAndBlog(){new Interface("http://control.blog.sina.com.cn/blog_rebuild/msn/api/msnLoginOut.php","jsload").request({onSuccess:function(res){window.location.href="http://login.sina.com.cn/cgi/login/logout.php?r="+_curHref},onError:function(res){window.location.href="http://login.sina.com.cn/cgi/login/logout.php?r="+_curHref},onFail:function(res){window.location.href="http://login.sina.com.cn/cgi/login/logout.php?r="+_curHref}})}},addSubPanel:function(panel,dom,offsetLeft,offsetTop){var _this=this;this.subPanels.push(panel);function _showPanel(){Core.Events.stopEvent();var i,len=_this.subPanels.length;for(i=0;i<len;i++){_this.subPanels[i].hidden()}panel.showWithDom(dom,offsetLeft,offsetTop)}Core.Events.addEvent(dom,function(){if(dom===$E("loginBarOptApp")){v7sendLog("40_01_01_"+$UID)}_showPanel()},"click");Core.Events.addEvent(document.body,function(){panel.hidden()},"click");Core.Events.addEvent(panel.entity,function(){Core.Events.stopEvent()},"mousedown");Core.Events.addEvent(window,function(){var x=Core.Dom.getLeft(dom)+dom.offsetWidth+offsetLeft;var y=Core.Dom.getTop(dom)+dom.offsetHeight+offsetTop;if($IE6&&this.isFixed){x=x-document.documentElement.scrollLeft;y=y-document.documentElement.scrollTop}panel.setPosition(x,y)},"resize")},initNewInboxPanel:function(){var newInboxPanel=new scope.NewInboxPanel;this.addSubPanel(newInboxPanel,$E("loginBarInbox"),-137,-9);try{if(!$E("ccnotepiaohong")){var di=$C("div");di.className="imforbox";di.style.display="none";di.id="ccnotepiaohong";$E("loginBarInbox").appendChild(di)}$E("loginBarInbox").className="link imfor"}catch(e){}newInboxPanel.onMessageLoad=function(nickname){$E("loginBarAppMenuLabel").innerHTML=nickname;$E("noOpenBlogName").innerHTML=Core.System.htmlFilter(nickname)}},initMailRemind:function(){if($E("loginBarMail")&&$E("line")){$E("loginBarMail").style.display="";$E("line").style.display=""}function remindEmail(){var mailInter=new Interface("http://interface.blog.sina.com.cn/riaapi/profile/unreadmail.php","jsload");mailInter.request({onSuccess:function(data){var tota=parseInt(data,10);if(tota>99){tota="99+"}if(tota!==0&&$E("mailpiaohong")){
var num=$E("mailpiaohong");num.style.display="";num.innerHTML=tota}else{$E("mailpiaohong").style.display="none"}},onError:function(){$E("mailpiaohong").style.display="none"}})}remindEmail();var remind=setInterval(remindEmail,5*60*1e3);Core.Events.addEvent($E("loginBarMail"),function(){v7sendLog("40_01_07_"+$UID);var redEl=$E("mailpiaohong");var isRed=!redEl.style.display;if(isRed){redEl.style.display="none"}},"click");Core.Events.addEvent($E("mailpiaohong"),function(){var redEl=$E("mailpiaohong");redEl.style.display="none";window.open("http://mail.sina.com.cn/?s=2")},"click")},initOnceLogedEvent:function(nodeNames,uid){var i,len=nodeNames.length;var me=this;for(i=0;i<len;i++){$E(nodeNames[i]).onclick=function(){switch(this.id){case"loginBarOptApp":v7sendLog("44_01_07_"+uid);break;case"loginBarMail":v7sendLog("44_01_08_"+uid);break;case"loginBarCenter":v7sendLog("44_01_09_"+uid);break;case"loginBarFriend":v7sendLog("44_01_10_"+uid);break;case"loginBarInbox":v7sendLog("44_01_11_"+uid);break}if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};me.trayLogin.login(function(){setTimeout(function(){window.location=window.location.toString().replace(/#.*/,"")},100)},false);return false}}},initOnceLogedTips:function(uid){var me=this;var messageUrl="http://interface.blog.sina.com.cn/riaapi/profile/unread.php";Utils.Io.JsLoad.request(messageUrl,{GET:{uid:uid,product:"blog"},onComplete:function(res){if(scope.$pageid=="profile_index"||scope.$pageid=="pageSetM"||scope.$pageid=="editor"){return}var tip=$E("newStatusTip");if(!tip){tip=$C("div");tip.id="newStatusTip";tip.className="tb_layer_Y tb_layer_w3";tip.style.width="138px";tip.innerHTML=scope.onceLogedStatusTipTemplay;var a=$T($E("loginBarCenter"),"a")[0];var loc=Core.Dom.getXY(a);tip.style.left=loc[0]-(138/2-a.offsetWidth/2)+"px";tip.style.top=loc[1]+a.offsetHeight+"px";tip.style.zIndex="510";tip.style.display="none";document.body.appendChild(tip)}if(res.data.unreadnotes>=1){v7sendLog("44_01_12_"+uid);tip.style.display="block";$E("nstUnread").style.display="block";$E("nstUnread").onclick=function(){v7sendLog("44_01_13_"+uid);if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};me.trayLogin.login(function(){setTimeout(function(){window.location="http://i.blog.sina.com.cn/blogprofile/profilelatestnote.php"},100)},false);return false}}else if(res.data.nfn>=1){v7sendLog("44_01_14_"+uid);tip.style.display="block";$E("nstFeed").style.display="block";$E("nstFeed").onclick=function(){v7sendLog("44_01_15_"+uid);if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};me.trayLogin.login(function(){setTimeout(function(){window.location="http://i.blog.sina.com.cn/blogprofile/index.php?type=3&from=newstatus&com=2"},100)},false);return false}}Core.Events.addEvent(window,function(){var a=$T($E("loginBarCenter"),"a")[0];var loc=Core.Dom.getXY(a);tip.style.left=loc[0]-(138/2-a.offsetWidth/2)+"px";tip.style.top=loc[1]+a.offsetHeight+"px"},"resize")},onException:function(data){}})}};$registJob("tray",function(){Lib.Listener.add("tray-data-loaded");Lib.checkAuthor();var tray,isNewTray;var $logo=$E("login_bar_logo_link_350");if($logo&&"ntopbar_main"===$logo.parentNode.className){isNewTray=true}else{isNewTray=false}if(isNewTray){tray=Lib.TrayPanel()}else{tray=new Lib.PlatformTrayPlus}var userInfo=Lib.Login.info();var uid=userInfo.uid;window.$onceLog=false;var onceloggedonblog=unescape(Utils.Cookie.getCookie("onceloggedonblog"));if(onceloggedonblog&&uid){time=onceloggedonblog;var now=(new Date).getTime();if(time&&now>time){$onceLog=true}}if($isLogin){tray.load("login")}else if(!isNewTray&&$onceLog){tray.load("oncelogedon")}else{tray.load("logout")}window.$tray={};window.$tray.renderLogin=function(){Lib.checkAuthor();if($isLogin){tray.load("login")}};window.$tray.renderLogout=function(){tray.load("logout")}});$registJob("rssLog",function(){window.rssSendLog=function(key){v7sendLog(encodeURIComponent(key),scope.$pageid,"rssSend")}});Editor.Plugins.BabyTemplate=Core.Class.create();Editor.Plugins.BabyTemplate.prototype={initialize:function(){},_tmp:[['<div style="margin:0; padding:0; clear:both; color:#333; font-size:14px;">','  <div style="margin:0; padding:0;height:112px; overflow:hidden;clear:both;  background:url(#{bannerpic})  repeat-x left top; text-align:center;border-left:1px solid #fce6e9; border-right:1px solid #fce6e9;">',"    <h2 style=\" margin:0; padding:0; padding-top:48px;\"><span style=\"margin:0; padding:0; font-size:28px; text-align:center; display:inline;line-height:38px; padding:3px 7px; text-align:center; font-family:'微软雅黑','黑体';  color:#fff; background-color:##{titlebgcolor};\">#{title}</span></h2>",'<br class="hereistheend" style="display:none"/></div>','<div style="margin:0; padding:0; overflow:hidden;clear:both; border-left:1px solid #fce6e9; border-right:1px solid #fce6e9; background-color:##{bgcolor};" >','    <div style="margin:0; padding:0; clear:both; padding:10px 25px 15px; font-size:12px; position:relative;">','        <img src="#{focuspic}" style="margin:0; padding:0; position:absolute; right:22px; top:0;" align="right" alt="" />','        <div style="margin:0; padding:0; margin-right:200px; line-height:150%; min-height:140px; _height:140px;">','          <h4 style="margin:0; padding:0; font-size:14px;">导语</h4>','          <p style="margin:0; padding:0;">#{text}</p>',"        </div>","    </div>",'    <div style="margin:0; padding:0; clear:both;  margin:0 13px; padding:16px; background-color:#fffdfe; border:1px solid ##{bordercolor};line-height:150%;">','      <h4 style="margin:0; padding:0; font-size:14px;">我的想法:</h4>','        <div id="#{babyThink}">&nbsp;#{beforeContent}</div>',"    </div>","  </div>","</div>"].join("")],get:function(num,param){param["babyThink"]="babyTopicContent_"+ +new Date;var obj={};obj["content"]=new Ui.Template(this._tmp[num]).evaluate(param);obj["id"]=param["babyThink"];return obj}};Editor.Plugins.BabyTopic=Core.Class.create();Editor.Plugins.BabyTopic.prototype={initialize:function(){window.babyTopic=this;this.isSending=false;var id=Core.System.getParam("topicid");var channel=Core.System.getParam("topicchannel");if(id&&channel){this.select(id,channel)}if($E("topic_id")&&$E("topic_id").value!="0"){$E("topic_show_"+$E("topic_id").value).style.display="none";$E("topic_hidden_"+$E("topic_id").value).style.display=""}},select:function(id,channel){if(this.isSending){return}this.isSending=true;if(editor.modeType!="edit"){winDialog.alert("请到编辑模式下插入话题",{icon:"01"});this.isSending=false;return}if(!id){winDialog.alert("非法调用",{icon:"01"});this.isSending=false;return}if($E("topic_id")&&$E("topic_id").value!="0"){winDialog.alert("您已经选择了话题",{icon:"01"});this.isSending=false;return}var me=this;scope.$topic_channel=channel;new Interface("http://control.blog.sina.com.cn/admin/article/get_topic_module.php","jsload").request({GET:{topic_channel:scope.$topic_channel,topic_id:id},onSuccess:function(_data){_data.topic_id=id;me._appendBabyBaraAndTemplate(_data);me.isSending=false},onError:function(_data){if(_data.code=="A00003"||_data.code=="A00004"||_data.code=="A00005"){winDialog.alert("非法操作!",{icon:"02",funcOk:function(){window.location.reload()}});return}showError(_data.code);me.isSending=false},onFail:function(){winDialog.alert("请求发送失败！请重试。",{icon:"02"});me.isSending=false}})},_appendBabyBaraAndTemplate:function(_data){var babyBar=_data.babybar;if(_data.topic&&_data.topic.more){$E("topic_more").value=_data.topic.more}var me=this;if(babyBar){if(babyBar.join){this._whenaddedBar(_data);scope.babyNewsMsg=babyBar;insertYuerProgressbar.insertNow(3)}else{switch(babyBar){default:this._whenaddedBar(_data)}}}else{this._whenaddedBar(_data)}editor.baseTools.operate[editor.saveType]();this._focusToEle()},_focusToEle:function(){var doc=editor.iframeDocument;ele=doc.getElementById(scope.babyContentId);if(ele){if($IE){var range=editor.iframeDocument.body.createTextRange();range.moveToElementText(ele);range.moveEnd("character",0);range.moveStart("character",0);range.select();if($IE){editor.rangeCache.setRange(range)}}else{var selection=editor.iframeWindow.getSelection();var range=editor.iframeDocument.createRange();range.selectNodeContents(ele);selection.removeAllRanges();selection.addRange(range)}}},_whenaddedBar:function(_data){var tmp=new Editor.Plugins.BabyTemplate;var doc=editor.iframeDocument;var imgs=doc.getElementsByTagName("img");for(var i=0;imgs[i];i++){var att=imgs[i].getAttribute("imgType");if(att&&att=="yuer"){imgs[i].parentNode.removeChild(imgs[i]);i--}}_data.topic.beforeContent=doc.body.innerHTML;tmp=tmp.get(0,_data.topic);editor.iframeDocument.body.innerHTML="";editor.insertHTML(tmp.content);scope.babyContentId=tmp.id;scope.hasSelectBabyTopic=_data.topic_id;$E("topic_channel").value="2";$E("topic_id").value=_data.topic_id;$E("topic_show_"+_data.topic_id).style.display="none";$E("topic_hidden_"+_data.topic_id).style.display=""},cancel:function(which){if(!which){return}if(editor.modeType!="edit"){winDialog.alert("请到编辑模式下取消话题",{icon:"01"});this.isSending=false;return}var doc=editor.iframeDocument;var ele;if(scope.babyContentId){ele=doc.getElementById(scope.babyContentId)}else{var eles=doc.getElementsByTagName("div");for(var i=0;eles[i];i++){if(eles[i].id&&eles[i].id.indexOf("babyTopicContent_")!=-1){ele=eles[i];break}}}var me=this;if(ele){ele.removeAttribute("id");var parent=ele.parentNode;var wdxf=parent.getElementsByTagName("h4")[0];wdxf.parentNode.removeChild(wdxf);editor.iframeDocument.body.innerHTML=parent.innerHTML;me._afterDelete(which)}else{winDialog.confirm("无法准确定位到您的内容，是否清空编辑器?",{icon:"04",funcOk:function(){editor.iframeDocument.body.innerHTML="&nbsp;";me._afterDelete(which)},textOk:"是",textCancel:"否"})}},_afterDelete:function(which){$E("topic_channel").value="0";$E("topic_id").value="0";$E("topic_more").value="";delete scope.hasSelectBabyTopic;delete scope.babyContentId;editor.baseTools.operate[editor.saveType]();$E("topic_hidden_"+which).style.display="none";$E("topic_show_"+which).style.display=""}};$registJob("channelType",function(){new Editor.Plugins.BabyTopic});$registJob("miniBlogAttention",function(){var itfcAttention=new Interface("http://weibo.com/attention/aj_addfollow.php","jsload");scope.attMiniBlog=function(){Lib.checkAuthor();if($UID){Utils.Io.JsLoad.request("http://weibo.com/attention/aj_addfollow.php?jsdomain=1&uid=1231759973&fromuid="+$UID,{onComplete:function(){}})}}});$registJob("SinglesDay",function(){scope.addFriendForSinglesDay=function(){Lib.checkAuthor();if($UID){new Interface("http://control.blog.sina.com.cn/riaapi/profile/attention_add.php","ijax").request({POST:{uid:$UID,aid:1259295385}})}}});$registJob("timed_publish",function(){var TIPS_TITLE="标题",TIPS_NETERR="网络繁忙，请稍后再试";var __addEvent=Core.Events.addEvent,__trim=Core.String.trim;var YYMMDD=$E("date_pub").value,HHMMSS=$E("articleTime").value;var db_time;__addEvent($E("setPubTime"),function(){if(!db_time){var yyMMdd=YYMMDD.split("-"),hhmmss=HHMMSS.split(":");db_time=Core.Date.UTC({y:yyMMdd[0],M:parseInt(yyMMdd[1],10)-1,d:parseInt(yyMMdd[2],10),h:parseInt(hhmmss[0],10)+3,m:parseInt(hhmmss[1],10),s:parseInt(hhmmss[2],10)});scope.$pub_time=db_time}Mojie.setTimeDialog({time:db_time,funcOk:setTimeOk})});__addEvent($E("timeTips"),function(event){event=event||window.event;var t=event.srcElement||event.target;if(t.nodeName.toUpperCase()==="A"){if(articleEditorCFG.articleStatus=="7"){$E("timeTips").innerHTML="博文将于 "+YYMMDD+" "+HHMMSS+" 发布";return}winDialog.confirm("删除后，博文将于当前时间发布",{funcOk:function(){$E("date_pub").value=YYMMDD;$E("articleTime").value=HHMMSS;$E("timeTips").innerHTML="时间："+YYMMDD+" "+HHMMSS;$E("isTimed").value=0},icon:"04"})}});var servertime=parseInt(articleEditorCFG.servertime,10)||0;servertime*=1e3;function setTimeOk(time){db_time=time;scope.$pub_time=time;var tobj=Core.Date.getTimeObj(time),yMd=tobj.yy+"-"+tobj.MM+"-"+tobj.dd,hms=tobj.hh+":"+tobj.mm+":"+tobj.ss;$E("date_pub").value=yMd;$E("articleTime").value=hms;$E("timeTips").innerHTML="博文将于 "+yMd+" "+hms+' 发布<a href="javascript:;">×</a>';$E("isTimed").value=7;if(time<servertime){v7sendLog("50_01_20")}}if(articleEditorCFG.articleStatus=="7"){var yyMMdd=YYMMDD.split("-"),hhmmss=HHMMSS.split(":");db_time=Core.Date.UTC({y:yyMMdd[0],M:parseInt(yyMMdd[1],10)-1,d:parseInt(yyMMdd[2],10),h:parseInt(hhmmss[0],10),m:parseInt(hhmmss[1],10),s:parseInt(hhmmss[2],10)});scope.$pub_time=db_time;scope.$server_time=servertime;var timeoff=db_time-servertime;if(timeoff>6e5){setTimeout(function(){winDialog.alert("博文将于10分钟后发表，请尽快保存修改",{icon:"01"});setTimeout(function(){$E("setPubTime").parentNode.style.display="none"},58e4)},timeoff-6e5)}else if(timeoff>6e4){winDialog.alert("博文将于"+Math.floor(timeoff/6e4)+"分钟后发表",{icon:"01"});setTimeout(function(){$E("setPubTime").parentNode.style.display="none"},timeoff)}else{$E("setPubTime").parentNode.style.display="none"}}});$registJob("bindToTSina",function(){var tEle=$E("bindtot");if(tEle){Core.Events.addEvent(tEle,function(){var url="http://control.blog.sina.com.cn/t_sina_blog/bind_weibo_form.php?from=js";window.open(url,"mb","toolbar=0,status=0,resizable=1,width=440,height=430,left="+(screen.width-440)/2+",top="+(screen.height-430)/2);window.tOkBack=function(){trace("微博绑定 ok");var tEle=$E("bindtot");trace("微博绑定回调ok函数！");var ele=$C("label");ele.innerHTML="已同步到新浪微博";ele.setAttribute("for","input3");ele.title="取消微博绑定";tEle.parentNode.replaceChild(ele,tEle);Core.Events.addEvent(ele,function(){window.open("http://control.blog.sina.com.cn/blogprofile/bind_t_sina_blog.php")});var input=$C("input");input.id="input3";input.type="checkbox";input.checked="checked";input.disabled="disabled";ele.parentNode.insertBefore(input,ele);winDialog.alert("绑定微博成功",{icon:"03"})};window.tFailBack=function(){trace("微博绑定 fail");winDialog.alert("网络原因，操作失败<br/>请稍后再试。",{icon:"01"})}})}function openurl(){window.open("http://control.blog.sina.com.cn/blogprofile/bind_t_sina_blog.php")}if($E("tlabel")){Core.Events.addEvent($E("tlabel"),function(){window.open("http://control.blog.sina.com.cn/blogprofile/bind_t_sina_blog.php")})}if($E("mlabel")){Core.Events.addEvent($E("mlabel"),function(){window.open("http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/bindwemeet.php")})}});$registJob("bindTomsn",function(){var tEle=$E("bindtomsn");if(tEle){Core.Events.addEvent(tEle,function(){Utils.Cookie.setCookie("artPost","1",1,"/","control.blog.sina.com.cn");var url="https://login.live.com/oauth20_authorize.srf?client_id=0000000040046F08&redirect_uri=http%3A%2F%2Fcontrol.blog.sina.com.cn%2Fblog_rebuild%2Fmsn%2FmsnLoginCallBack.php&response_type=code&scope=wl.basic%20wl.signin%20wl.offline_access%20wl.share%20wl.emails";window.open(url,"mb","toolbar=0,status=0,resizable=1,width=440,height=430,left="+(screen.width-440)/2+",top="+(screen.height-430)/2);window.msnOkBack=function(){var tEle=$E("bindtomsn");trace("msn绑定回调ok函数！");var ele=$C("label");ele.innerHTML="已同步Windows Live";ele.setAttribute("for","input4");ele.title="取消连接MSN";tEle.parentNode.replaceChild(ele,tEle);Core.Events.addEvent(ele,function(){window.open("http://control.blog.sina.com.cn/blogprofile/msnbind.php")});var input=$C("input");input.id="input4";input.type="checkbox";input.checked="checked";input.disabled="disabled";ele.parentNode.insertBefore(input,ele);winDialog.alert("绑定MSN成功",{icon:"03"})};window.msnFailBack=function(){trace("msn绑定 fail");winDialog.alert("网络原因，操作失败<br/>请稍后再试。",{icon:"01"})}})}if($E("msnlabel")){Core.Events.addEvent($E("msnlabel"),function(){window.open("http://control.blog.sina.com.cn/blogprofile/msnbind.php")})}});$registJob("bindWeibo_auto",function(){var url="http://control.blog.sina.com.cn/t_sina_blog/bind_weibo_auto.php";var nowDate=new Date;var deadline=new Date("2012/12/07");var __addEvent=Core.Events.addEvent;var myPanel;Utils.Io.Ajax.request(url,{returnType:"json",onComplete:function(data){if(data.code==="A00006"){console.log("bindweibo success")}},onException:function(){}});function renderDiv(){var div=$C("div");div.setAttribute("id","bindPanelDiv");div.setAttribute("class","tb_layer_Y");div.setAttribute("style","position: relative; cursor: pointer; width: 300px; line-height: 20px; top: -85px; left: 187px;");var inner='<div class="tb_layer_Y_main tip_layer_main"><div class="tip_ps tip_miniblog"><a id="closeBindPanel" href="javascript:void(0);" class="tb_friend_inputDel" title="关闭"></a><p><strong>绑定微博成功：</strong></p><p id="bindPanel">您的博文将同步到微博，如需更改设置请<a href="javascript:void(0);"> 点击这里 </a></p></div></div><div style="margin-left: 20px;" class="tb_layer_arrow tip_arrow"></div>';div.innerHTML=inner;$E("tlabel").parentNode.appendChild(div);Core.Events.addEvent($E("bindPanel"),function(){$E("bindPanelDiv").style.display="none";window.open("http://control.blog.sina.com.cn/blogprofile/bind_t_sina_blog.php")});Core.Events.addEvent($E("closeBindPanel"),function(){$E("bindPanelDiv").style.display="none"})}function updateLayerPos(){var pos=Core.Dom.getXY($E("tlabel"));myPanel.entity.style.left=pos[0]+"px";if($IE){myPanel.entity.style.top=pos[1]-50+"px"}else{myPanel.entity.style.top=pos[1]-55+"px"}}function renderPanel(){myPanel=new Ui.Panel,uniqueID=myPanel.uniqueID,template='<div id="bindPanelDiv" class="tb_layer_Y" style="cursor:pointer;">'+'<div class="tb_layer_Y_main tip_layer_main">'+'<div class="tip_ps tip_miniblog">'+'<a id="closeBindPanel" href="javascript:void(0);" class="tb_friend_inputDel" title="关闭"></a>'+"<p><strong>绑定微博成功：</strong></p>"+'<p id="bindPanel">您的博文将同步到微博，如需更改设置请<a href="javascript:void(0);"> 点击这里 </a></p>'+"</div>"+"</div>"+'<div class="tb_layer_arrow tip_arrow"></div>'+"</div>";myPanel.setTemplate('<div id="#{panel}">'+template+"</div>");var posx=Core.Dom.getXY($E("tlabel"))[0];var posy=Core.Dom.getXY($E("tlabel"))[1];myPanel.entity.style.position="absolute";myPanel.entity.style.left=posx+"px";if($IE){myPanel.entity.style.top=posy-50+"px"}else{myPanel.entity.style.top=posy-55+"px"}myPanel.entity.children[0].style.width="300px";myPanel.entity.children[0].children[1].style.marginLeft="20px";myPanel.entity.style.display="block";Core.Events.addEvent($E("bindPanel"),function(){$E("_"+uniqueID+"_panel").style.display="none";window.open("http://control.blog.sina.com.cn/blogprofile/bind_t_sina_blog.php")});Core.Events.addEvent($E("closeBindPanel"),function(){$E("_"+uniqueID+"_panel").style.display="none"})}});$registJob("loginStatus",function(){Lib.checkAuthor();var _getCookie=Utils.Cookie.getCookie;var _setCookie=Utils.Cookie.setCookie;var statusUid=_getCookie("_s_loginStatus");var loginUid=_getCookie("_s_loginuid");if($isLogin){if(loginUid===$UID){return}}else{if(!statusUid||statusUid===loginUid){return}}_setCookie("_s_loginuid",$UID||statusUid,24-(new Date).getHours(),"","blog.sina.com.cn");var url="http://control.blog.sina.com.cn/blog_rebuild/riaapi/padblog/padInfo.php?rnd="+Math.random();Utils.Io.JsLoad.request(url,{onComplete:function(){},onException:function(){}})});$registJob("checkImgBlogger",function(){var itf={check:new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/points/check_vip.php","ajax"),redeem:new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/points/points_redeem.php","ajax")};checkImgBlogger();function checkImgBlogger(cb){var cb=cb||function(){};itf.check.request({POST:{type:3},onSuccess:function(data){scope.$is_photo_vip=1},onError:function(result){if(result&&result.code=="A00001"){scope.$redeemImgBloggerDialog=redeemImgBlogger}},onFail:function(){}})}function redeemImgBlogger(cb){v7sendLog("18_01_01");var sucdlg=winDialog.alert("抱歉，图片超过5m！",{funcOk:function(){itf.redeem.request({POST:{user:scope.$uid||$UID,type:3,auto:1},onSuccess:function(data){scope.$is_photo_vip=1;cb(data)},onError:function(result){if(result&&result.code=="A00003"){winDialog.alert(result.data,{subText:'<a href="http://blog.sina.com.cn/huodong/lottery.html?f=1">马上获得1888积分! </a>'})}else{winDialog.alert(result&&result.data)}},onFail:function(){}})},textOk:"马上兑换",subText:"150积分开通10m大图上传"},"redeemImgBloggerDialog")}});Lib.OnlyShadow=function(opacity,parent,id,cfg){this.entity=null;this.parent=parent||document.body;cfg=Lib.apply({zIndex:1024,backgroundColor:"black"},cfg);this._ie6Fixed=function(){if(_this.entity){_this.entity.style.top=document.documentElement.scrollTop+"px";var left=document.documentElement.scrollLeft-_this._ie6EntityXY[0];var wholeWidth=left+_this.entity.offsetWidth;var scrollWidth=document.documentElement.scrollWidth||document.body.scrollWidth;if(wholeWidth<=scrollWidth){_this.entity.style.left=left+"px"}if(_this.ifm){_this.ifm.style.top=_this.entity.style.top;if(wholeWidth<=scrollWidth){_this.ifm.style.left=_this.entity.style.left}}}};var _this=this;this.resetShadowDiv=Core.Function.bind3(function(){if(_this.entity){setTimeout(function(){_this.updateSize();if($IE6&&_this.isShow()){_this.entity.style.left="0px";var xy=Core.Dom.getXY(_this.entity);_this._ie6EntityXY=xy;_this._ie6Fixed()}},1)}},this);this._create=function(){_this.entity=$C("div");if(id){_this.entity.id=id}_this.entity.style.position="absolute";_this.entity.style.width=_this.getAreaWidth()+"px";_this.entity.style.height=_this.getAreaHeight()+"px";_this.entity.style.left="0px";_this.entity.style.top="0px";_this.entity.style.zIndex=cfg.zIndex;_this.entity.style.backgroundColor=cfg.backgroundColor;_this.parent.appendChild(_this.entity);_this._setOpacity(_this.entity,isNaN(opacity)?.5:opacity);if($IE6){var xy=Core.Dom.getXY(_this.entity);_this._ie6EntityXY=xy;var left=document.documentElement.scrollLeft-_this._ie6EntityXY[0];_this.entity.style.left=left+"px"}_this.addIframe();Core.Events.addEvent(window,_this.resetShadowDiv,"resize");_this.setFixed(true);_this.hidden()};(function initialize(){if(id&&$E(id)){_this.entity=$E(id)}else{_this._create()}})()};Lib.OnlyShadow.prototype={isShow:function(){return this.entity.offsetHeight>0?true:false},show:function(){this.entity.style.display="";if(this.ifm){this.ifm.style.display=""}if($IE6){this.updateSize();this.entity.style.left="0px";var xy=Core.Dom.getXY(this.entity);this._ie6EntityXY=xy;this._ie6Fixed()}this.onShow()},hidden:function(){this.entity.style.display="none";if(this.ifm){this.ifm.style.display="none"}this.onHidden()},close:function(){this.hidden();this.destroy()},destroy:function(){Core.Events.removeEvent(window,this._ie6Fixed,"scroll");Core.Events.removeEvent(window,this.resetShadowDiv,"resize");this.entity.parentNode.removeChild(this.entity);this.entity=null;if(this.ifm){this.ifm.parentNode.removeChild(this.ifm);this.ifm=null}},addIframe:function(){this.ifm=$C("iframe");this._setOpacity(this.ifm,0);this.ifm.style.position="absolute";this.ifm.style.zIndex=this.entity.style.zIndex;this.ifm.style.left=this.entity.style.left;this.ifm.style.top=this.entity.style.top;this.ifm.style.width=this.entity.style.width;this.ifm.style.height=this.entity.style.height;this.entity.parentNode.insertBefore(this.ifm,this.entity)},insertBefore:function(obj){obj.parentNode.insertBefore(this.entity,obj);if(this.ifm){this.entity.parentNode.insertBefore(this.ifm,this.entity)}},updateSize:function(){var width=this.getAreaWidth();var height=this.getAreaHeight();this.entity.style.width=width+"px";this.entity.style.height=height+"px";if(this.ifm){this.ifm.style.width=width+"px";this.ifm.style.height=height+"px"}},getAreaHeight:function(){var height=Math.max(document.documentElement.clientHeight,document.body.clientHeight);return height},getAreaWidth:function(){var width=document.documentElement.clientWidth||document.body.clientWidth;return width},setFixed:function(state){if($IE6){var _this=this;if(state){_this._ie6Fixed();Core.Events.addEvent(window,_this._ie6Fixed,"scroll")}else{Core.Events.removeEvent(window,_this._ie6Fixed,"scroll")}}else{this.entity.style.position=state?"fixed":"absolute"}},_setOpacity:function(obj,v){if($IE){obj.style.filter="alpha(opacity="+v*100+")"}else{obj.style.opacity=v}},onShow:function(){},onHidden:function(){}};$registJob("new_editor_guidelayer",function(){var noCookie=Utils.Cookie.getCookie("new_editor_guidelayer_"+scope.$uid)!=1,hasChangeNode=$E("new_editor");if(!hasChangeNode){return}if(noCookie){var panel=new Ui.Panel,shadow=new Lib.OnlyShadow(.2,document.body,"",{backgroundColor:"#000",zIndex:0}),layerHTML='<div id="#{entity}" class="b_old_cont">'+'<a id="#{change_new}" class="b_old_change" href="javascript:;" title="切换新版"></a>'+'<div class="b_old_box">'+'<a id="#{btn_close}" class="b_close" href="javascript:;" title="关闭"></a>'+'<a id="#{try_it_now}" class="b_btn" href="javascript:;" title="">马上试用</a>'+"</div>"+"</div>",layer=panel.setTemplate(layerHTML),pos=Core.Dom.getXY($E("SinaBlog_SLOT_44")),addEvent=Core.Events.addEvent;v7sendLog("11_01_01");shadow.show();layer.setPosition({x:pos[0]-549,y:pos[1]-30});layer.show();if(layer.nodes.btn_close){addEvent(layer.nodes.btn_close,function(){v7sendLog("11_01_03");layer.hide();shadow.close();Utils.Cookie.setCookie("new_editor_guidelayer_"+scope.$uid,1,24*30)})}if(layer.nodes.try_it_now){addEvent(layer.nodes.try_it_now,function(){v7sendLog("11_01_02");layer.hide();shadow.close();Utils.Cookie.setCookie("new_editor_guidelayer_"+scope.$uid,1,24*30);location.href="http://control.blog.sina.com.cn/admin/article/article_add.php?is_new_editor=1"})}if(layer.nodes.change_new){addEvent(layer.nodes.change_new,function(){layer.hide();shadow.close();Utils.Cookie.setCookie("new_editor_guidelayer_"+scope.$uid,1,24*30);location.href="http://control.blog.sina.com.cn/admin/article/article_add.php?is_new_editor=1"})}}});Core.Dom.byClass=function(className,tagName,elem){elem=elem||document;if(elem.getElementsByClassName){return elem.getElementsByClassName(className)}var rcn=new RegExp("\\b"+className+"\\b"),ret=[],els=elem.getElementsByTagName(tagName),i,len=els.length;for(i=0;i<len;i++){elem=els[i];if(elem.nodeType===1&&elem.className&&rcn.test(elem.className)){ret.push(elem)}}return ret};$registJob("uatrack",function(){Lib.sendSuda(function(){var pageid=scope.$pageid;var _byClass=Core.Dom.byClass;switch(pageid){case"editor":var el=_byClass("msnTips_lx","div");if(el){v7sendLog("41_01_05");SUDA.uaTrack("blog_post","v_post1")}break;case"article":case"articleM":var btjblog=$E("module_909");var blogxg=$E("module_903");var tjblog=$E("module_904");if(btjblog){SUDA.uaTrack("blog_btjblog","v_btjblog")}if(blogxg){SUDA.uaTrack("blog_xg","v_blogxg")}if(tjblog){SUDA.uaTrack("blog_tjblog","v_tjblog")}break}})});Utils.tpl=function(tpl,data){return tpl.replace(/{(\w+)}/g,function(all,match){return data[match]})};Lib.register("jfCheckIn",function(lib){var checkEL=$E("jf_check");var addEvent=Core.Events.addEvent;var stopDefaultEvent=Core.Events.stopDefaultEvent;var getEvent=Core.Events.getEvent;var getEventTarget=Core.Events.getEventTarget;var reqType=location.host=="control.blog.sina.com.cn"?"ajax":"ijax";var itf=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/points/register_get_points.php",reqType);var initHtml='<a href="javascript:void();" class="checkbtn">签到领积分</a><p>连续签到可领取更多积分<a href="javascript:void();">详情</a></p>';var checkedHtml='<a href="javascript:void();" class="checkbtn">已签到<span>＋{points}分</span></a><p>已连续签到<span>{days}</span>天，继续可获得更多积分 <a href="javascript:void();">详情</a></p>';var lock=0;var jfck={status:0,init:function(){if(!checkEL)return;var self=this;itf.request({POST:{act:"get"},onSuccess:function(data){var status=self.status=data.code/1;checkEL.innerHTML=status?Utils.tpl(checkedHtml,data):initHtml;addEvent(checkEL,function(){var ev=getEvent();var tarEl=getEventTarget(ev);stopDefaultEvent(ev);if(tarEl.tagName.toUpperCase()=="A"){if(/详情/.test(tarEl.innerHTML)){jfPannl.show()}else{if(!self.status&&!lock){lock=1;self.checkIn()}}}})},onError:function(){},onFail:function(){}})},checkIn:function(){var self=this;itf.request({POST:{},onSuccess:function(data){var status=self.status=data.code/1;checkEL.innerHTML=status?Utils.tpl(checkedHtml,data):initHtml},onError:function(result){winDialog.alert(result&&result.data||"操作失败");lock=0;if(result&&result.code=="A11109"){self.init()}},onFail:function(){winDialog.alert("请求异常");lock=0}})}};var jfPannl={tpl:'<table class="CP_w" id="#{panel}" style="z-index:9999">\r\n                <thead>\r\n                    <tr>\r\n                        <th class="tLeft"><span></span></th>\r\n                        <th class="tMid"><div class="bLyTop"><strong>签到积分规则：</strong><cite><a node-data="btnclose" href="#" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>\r\n                        <th class="tRight"><span></span></th>\r\n                    </tr>\r\n                </thead>\r\n                <tfoot>\r\n                    <tr>\r\n                        <td class="tLeft"><span></span></td>\r\n                        <td class="tMid"><span></span></td>\r\n                        <td class="tRight"><span></span></td>\r\n                    </tr>\r\n                </tfoot>\r\n                <tbody>\r\n                    <tr>\r\n                        <td class="tLeft"><span></span></td>\r\n                        <td class="tMid">\r\n                        <div class="CP_layercon1">\r\n                            <div class="CP_check">\r\n                              <table class="CP_w_ttl" width="100%">\r\n                                <tbody><tr><td class="td1">1天签到</td><td class="td2">每日＋1分</td></tr>\r\n                                <tr><td class="td1">连续3天签到</td><td class="td2">每日＋2分</td></tr>\r\n                                <tr><td class="td1">连续10天签到</td><td class="td2">每日＋4分</td></tr>\r\n                                <tr><td class="td1">连续20天签到</td><td class="td2">每日＋6分</td></tr>\r\n                                <tr><td class="td1">连续30天签到</td><td class="td2">每日＋8分</td></tr>\r\n                               </tbody></table>\r\n                               <div class="CP_w_cnt SG_tetb">如果连续签到中断（有一天未签到）重新计算积分</div>\r\n                               <p class="CP_w_btns_Mid"><a node-data="btnclose" class="SG_aBtn SG_aBtnB" href="#" ><cite>关闭</cite></a></p>\r\n                            </div>\r\n                        </div>\r\n                        </td>\r\n                        <td class="tRight"><span></span></td>\r\n                    </tr>\r\n                </tbody>\r\n            </table>',bs:null,panel:null,width:303,height:346,isInit:0,init:function(){var self=this;var bs=self.bs=new BackShadow(.4);var panel=self.panel=new Lib.Panel;panel.setTemplate(self.tpl);var box=panel.getNode("panel");addEvent(box,function(){var ev=getEvent();var tarEl=getEventTarget(ev);var nd=tarEl.getAttribute("node-data")||tarEl.parentNode.getAttribute("node-data");stopDefaultEvent(ev);if(nd=="btnclose"){self.hide()}});self.setPosition();self.isInit=1},setPosition:function(){var self=this;var win=Core.System.winSize();var x=win.width/2-self.width/2;var y=win.height/2-self.height/2-20;self.panel.setPosition(x,y);self.panel.setFixed(true)},show:function(obj){if(!this.isInit){this.init()}this.bs.show();this.panel.show()},hide:function(){this.panel.hide();this.bs.hidden()}};return jfck});$registJob("jfCheckIn",function(){Lib.jfCheckIn.init()});if(window!=parent){parent.location.href=window.location.href}function main(){v7sendLog("42_01_16");var job=new Jobs({onEnd:function(){var err=job.errorMsg;if(err.length>0){var params="&type=7&msg="+encodeURI(job.errorMsg.join("|"));var blog_id="blog_id="+window.location.href;if(blog_id){params+="&"+blog_id}scope&&scope.crtIfm&&scope.crtIfm(params)}}});job.add("suda");job.add("checkAccount");job.add("tray");job.add("checkImgBlogger");job.add("jfCheckIn");job.add("editor_init");job.add("format_title");job.add("editor_face");job.add("editor_mjtag");job.add("editor_articlecate");job.add("init_right_menu");job.add("send_article_page_init");job.add("editor_video");job.add("editor_img");job.add("editor_catedialog");job.add("insert_to_editor");job.add("timed_publish");job.add("bindWeibo_auto");job.add("bindToTSina");job.add("bindTomsn");job.add("rssLog");job.add("channelType");job.add("miniBlogAttention");job.add("SinglesDay");job.add("loginStatus");

job.add("new_editor_guidelayer");job.add("uatrack");job.start()}