if(typeof Sina=="undefined"){Sina={}}Sina.pkg=function(ns){if(!ns||!ns.length){return null}var levels=ns.split(".");var nsobj=Sina;for(var i=levels[0]=="Sina"?1:0;i<levels.length;++i){nsobj[levels[i]]=nsobj[levels[i]]||{};nsobj=nsobj[levels[i]]}return nsobj};function $E(oID){var node=typeof oID=="string"?document.getElementById(oID):oID;if(node!=null){return node}return null}function $C(tagName){return document.createElement(tagName)}function $N(name){return document.getElementsByName(name)}function $T(obj,tagName){return obj.getElementsByTagName(tagName)}try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}(function(){var bind=function(fFunction,object){var __method=fFunction;return function(){return __method.apply(object,arguments)}};var debug_namespace="Debug";if(window[debug_namespace]==null||typeof window[debug_namespace].log=="undefined"){window[debug_namespace]={cacheData:[],base_url:"http://sjs.sinajs.cn/bind2/",product:scope.$PRODUCT_NAME,baseColor:{1:{color:"#FFF",bgcolor:"#E00"},2:{color:"#F00"},3:{color:"#FFF000"},4:{color:"#0F0"},5:{color:"#FFF"}},fatal:function(sInfo){this.addData(sInfo,1)},error:function(sInfo){this.addData(sInfo,2)},warning:function(sInfo){this.addData(sInfo,3)},info:function(sInfo){this.addData(sInfo,4)},log:function(sInfo){this.addData(sInfo,5)},dir:function(oInfo){this.addData(oInfo,5)},addData:function(sInfo,nType,sColor,sBgColor){if(sInfo==null){return}if(typeof sInfo!="object"){sInfo=sInfo.toString()}var oOption={type:nType||"5",color:sColor||this.baseColor[nType].color,bgcolor:sBgColor||this.baseColor[nType].bgcolor};this.cacheData.push([sInfo,oOption]);if(this.initFinished==true){this.showCurrentData([sInfo,oOption])}}};window.trace=bind(window[debug_namespace].log,window[debug_namespace]);window.traceError=bind(window[debug_namespace].error,window[debug_namespace])}})();Sina.pkg("Core");if(typeof Core=="undefined"){Core=Sina.Core}Sina.pkg("Core.Array");Core.Array.foreach=function(ar,insp){if(ar==null&&ar.constructor!=Array){return[]}var i=0,len=ar.length,r=[];while(i<len){var x=insp(ar[i],i);if(x!==null){r[r.length]=x}i++}return r};Sina.pkg("Core.Events");(function(_s){var _ua=navigator.userAgent.toLowerCase();var system={$winXP:/windows nt 5.1/.test(_ua),$winVista:/windows nt 6.0/.test(_ua),$win7:/windows nt 6.1/.test(_ua),$macOS:/mac/.test(_ua)};var browser={$OPERA:false,$IE6:false,$IE7:false,$IE8:false,$IE9:false,$SAFARI:false,$FF2:false,$FF3:false,$FF4:false,$FF:false,$CHROME:false,$TT:false,$360:false,$SOGO:false,$Maxthon:false};var engine={$IE:0,$MOZ:false,$WEBKIT:false,$KHTML:false};if(/opera/.test(_ua)||_s.opera){browser.$OPERA=true}else if(/chrome\/(\S+)/.test(_ua)){browser.$CHROME=true}else if(/safari\/(\S+)/.test(_ua)){browser.$SAFARI=true}else if(/msie/.test(_ua)){engine.$IE=true;if(/360se/.test(_ua)){browser.$360=true}else if(/tencenttraveler/.test(_ua)){browser.$TT=true}else if(/se\s\S+\smetasr\s\d+\.\d+/.test(_ua)){browser.$SOGO=true}var uaVersionArray=_ua.match(/msie (\d+)/);var version=parseInt(uaVersionArray[1]);engine.$IE=version;if(version===8){browser.$IE8=true}else if(version===6){browser.$IE6=true}else if(version===9){browser.$IE9=true}else if(version===7){browser.$IE7=true}else if(version===10){browser.$IE10=true}}else if(/firefox/.test(_ua)){var uaVersionArray=_ua.match(/firefox\/(\d+)/);browser.$FF=parseInt(uaVersionArray[1]);if(/firefox\/3/.test(_ua)){browser.$FF3=true}else if(/firefox\/4/.test(_ua)){browser.$FF4=true}else if(/firefox\/2/.test(_ua)){browser.$FF2=true}}else if(/trident\/7.0/.test(_ua)&&/rv:11.0/.test(_ua)){engine.$IE=11;browser.$IE11=true}try{var t=window.external;browser.$Maxthon=t.max_version?true:false}catch(e){}if(/applewebkit\/(\S+)/.test(_ua)){engine.$WEBKIT=true}else if(/khtml\/(\S+)/.test(_ua)){engine.$KHTML=true}else if(/rv:([^\)]+)\) gecko\/\d{8}/.test(_ua)){engine.$MOZ=true}browser.$MOBILE=/mobile/i.test(_ua);if(!browser.$MOBILE){browser.$MOBILE=/HTC/.test(_ua)}function apply(thisObj,cfg){var p;for(p in cfg){thisObj[p]=cfg[p]}}apply(_s,browser);apply(_s,engine);apply(_s,system)})(window);Core.Events.addEvent=function(elm,func,evType,useCapture){var _el=typeof elm=="string"?$E(elm):elm;if(_el==null){trace("addEvent 找不到对象："+elm);return}if(typeof useCapture=="undefined"){useCapture=false}if(typeof evType=="undefined"){evType="click"}if(_el.addEventListener){if(evType=="mousewheel"&&$FF){evType="DOMMouseScroll"}_el.addEventListener(evType,func,useCapture);return true}else if(_el.attachEvent){var r=_el.attachEvent("on"+evType,func);return true}else{_el["on"+evType]=func}};Core.Events.removeEvent=function(oElement,fHandler,sName){var _el=$E(oElement);if(_el==null){trace("removeEvent 找不到对象："+oElement);return}if(typeof fHandler!="function"){return}if(typeof sName=="undefined"){sName="click"}if(_el.addEventListener){_el.removeEventListener(sName,fHandler,false)}else if(_el.attachEvent){_el.detachEvent("on"+sName,fHandler)}fHandler[sName]=null};Sina.pkg("Core.Function");Core.Function.bind3=function(fFunc,object,args){args=args==null?[]:args;var __method=fFunc;return function(){return __method.apply(object,args)}};Core.Array.findit=function(arr,v){var k=-1;Core.Array.foreach(arr,function(value,index){if(v==value){k=index}});return k};window.onerror=function(err,file,line){trace("Error occured:"+err+"<br/>file:"+file+"<br/>line:"+line+"<br/>");return true};function Jobs(oOption){this.option=oOption||{};this._jobTable=[[],[],[],[]]}Jobs.prototype={_registedJobTable:{},errorMsg:[],_registJob:function(jobName,rel){this._registedJobTable[jobName]=rel},error:function(sMsg){Debug.error(sMsg);this.errorMsg.push(sMsg)},add:function(jobName,type){type=type||1;if(Core.Array.findit(this._jobTable[type],jobName)==-1){this._jobTable[type].push(jobName)}else{this.error("Error: Job <b>"+jobName+"</b> is existed now.")}},start:function(){if(this.option.onStart!=null){this.option.onStart()}var regJobs=this._registedJobTable;var jobs=this._jobTable[1].concat(this._jobTable[2]);var _this=this;this.fe=Core.Function.bind3(_this.focus,_this,[]);var addFocus=function(){if(_this._jobTable[3].length==0){if(_this.option.onEnd!=null){_this.option.onEnd()}return}Core.Events.addEvent(document.body,_this.fe,"focus");Core.Events.addEvent(window,_this.fe,"scroll");Core.Events.addEvent(document.body,_this.fe,"mousemove");Core.Events.addEvent(document.body,_this.fe,"mouseover")};this.queue(jobs,addFocus)},focus:function(){var _this=this;if(this.focusdown){Core.Events.removeEvent(document.body,_this.fe,"focus");Core.Events.removeEvent(window,_this.fe,"scroll");Core.Events.removeEvent(document.body,_this.fe,"mousemove");Core.Events.removeEvent(document.body,_this.fe,"mouseover");_this.fe=null;return}this.focusdown=true;var jobs=this._jobTable[3];this.queue(jobs,this.option.onEnd)},queue:function(jobs,callback){var _this=this;var getTime=function(){return(new Date).valueOf()};var regJobs=this._registedJobTable;var joblen=jobs.length;var i=0;var interNum=window.setInterval(function(){if(i>=joblen){clearInterval(interNum);interNum=null;if(callback!=null){callback()}return}var jobName=jobs[i];var job=regJobs[jobName];i++;if(typeof job=="undefined"){_this.error("<b>Job["+jobName+"] is undefiend!!!</b>");return}var _try=true;var _start=getTime();try{job.call()}catch(e){_this.error("<b>Job["+jobName+"] failed!!!</b>"+e.message+"");if(callback!=null){callback()}_try=false;throw e}finally{if(_try){var _end=getTime();Debug.info("<b>Job["+jobName+"] done in "+(_end-_start)+"ms.</b>")}}},10)},call:function(jobName,args){if(typeof this._registedJobTable[jobName]!="undefined"){this._registedJobTable[jobName].apply(this,args)}else{trace("<b>Job["+jobName+"] is undefined!!!</b>",{color:"#900",bgColor:"#FFF;"})}}};$registJob=function(name,rel){Jobs.prototype._registJob(name,rel)};$callJob=function(name){var args=[];if(arguments.length>1){Core.Array.foreach(arguments,function(v,i){args[i]=v});args.shift()}Jobs.prototype.call(name,args)};Sina.pkg("Utils");if(typeof Utils=="undefined"){Utils=Sina.Utils}Sina.pkg("Utils.Io");Utils.Io.loadCss=function(oCss,oTarget){if(oCss==null){return false}oTarget=oTarget||window;var _target=oTarget.document;oCss.id=oCss.id||"";var _css;if(oCss.url){_css=_target.createElement("link");_css.setAttribute("rel","stylesheet");_css.setAttribute("type","text/css");_css.setAttribute("href",oCss.url)}else if(oCss.text){_css=_target.createElement("style");_css.setAttribute("type","text/css");if($IE){_css.styleSheet.cssText=oCss.text}else{_css.innerHTML=oCss.text}}_css.setAttribute("id",oCss.id);_target.getElementsByTagName("head")[0].appendChild(_css)};Sina.pkg("Core.System");(function(){var parseParam=function(oSource,oParams){var key;try{if(typeof oParams!="undefined"){for(key in oSource){if(oParams[key]!=null){oSource[key]=oParams[key]}}}}finally{key=null;return oSource}};Core.System.parseParam=parseParam})();Sina.pkg("Core.String");Utils.Url=function(url){url=url||"";this.url=url;this.query={};this.parse()};Utils.Url.prototype={parse:function(url){if(url){this.url=url}this.parseAnchor();this.parseParam()},parseAnchor:function(){var anchor=this.url.match(/\#(.*)/);anchor=anchor?anchor[1]:null;this._anchor=anchor;if(anchor!=null){this.anchor=this.getNameValuePair(anchor);this.url=this.url.replace(/\#.*/,"")}},parseParam:function(){var query=this.url.match(/\?([^\?]*)/);query=query?query[1]:null;if(query!=null){this.url=this.url.replace(/\?([^\?]*)/,"");this.query=this.getNameValuePair(query)}},getNameValuePair:function(str){var o={};str.replace(/([^&=]*)(?:\=([^&]*))?/gim,function(w,n,v){if(n==""){return}o[n]=v||""});return o},getParam:function(sPara){return this.query[sPara]||""},clearParam:function(){this.query={}},setParam:function(name,value){if(name==null||name==""||typeof name!="string"){throw new Error("no param name set")}this.query=this.query||{};this.query[name]=value},setParams:function(o){this.query=o},serialize:function(o){var ar=[];for(var i in o){if(o[i]==null||o[i]==""){ar.push(i+"=")}else{ar.push(i+"="+o[i])}}return ar.join("&")},toString:function(){var queryStr=this.serialize(this.query);return this.url+(queryStr.length>0?"?"+queryStr:"")+(this.anchor?"#"+this.serialize(this.anchor):"")},getHashStr:function(forceSharp){return this.anchor?"#"+this.serialize(this.anchor):forceSharp?"#":""}};Core.String.encodeDoubleByte=function(str){if(typeof str!="string"){return str}return encodeURIComponent(str)};Utils.Io.JsLoad={};(function(){function createScripts(oOpts,oCFG){processUrl(oOpts,oCFG);var urls=oOpts.urls;var i,len=urls.length;for(i=0;i<len;i++){var js=$C("script");js.src=urls[i].url;js.charset=urls[i].charset;js.onload=js.onerror=js.onreadystatechange=function(){if(js&&js.readyState&&js.readyState!="loaded"&&js.readyState!="complete"){return}oCFG.script_loaded_num++;js.onload=js.onreadystatechange=js.onerror=null;if(!1!==oOpts.isRemove){js.src="";js.parentNode.removeChild(js)}js=null};document.getElementsByTagName("head")[0].appendChild(js)}}function processUrl(oOpts,oCFG){var urls=oOpts.urls;var get_hash=oOpts.GET;var i,len=urls.length;var key,url_cls,varname,rnd;for(i=0;i<len;i++){rnd=window.parseInt(Math.random()*1e8);url_cls=new Utils.Url(urls[i].url);for(key in get_hash){if(oOpts.noencode==true){url_cls.setParam(key,get_hash[key])}else{url_cls.setParam(key,Core.String.encodeDoubleByte(get_hash[key]))}}varname=url_cls.getParam("varname")||"requestId_"+rnd;if(oOpts.noreturn!=true){url_cls.setParam("varname",varname)}if(oOpts.returnType=="jsonp"){var name=url_cls.getParam("callback")||"callback_"+rnd;var callback="script_callbackes."+name;url_cls.setParam("callback",callback);if(!window.script_callbackes){window.script_callbackes=[]}window.script_callbackes[name]=function(res){oCFG.is_loadcomplete=true;delete window.script_callbackes[name];if(oCFG.timeout_flag!=null){clearTimeout(oCFG.timeout_flag)}if(oCFG.is_timeout){return}if(oOpts.onComplete!=null){oOpts.onComplete(res)}}}oCFG.script_var_arr.push(varname);urls[i].url=url_cls.toString();urls[i].charset=urls[i].charset||oOpts.charset}}function ancestor(aUrls,oOpts){var _opts={isRemove:!0,urls:[],charset:"utf-8",noreturn:false,noencode:false,returnType:"",timeout:-1,POST:{},GET:{},onComplete:null,onException:null};var _cfg={script_loaded_num:0,is_timeout:false,is_loadcomplete:false,script_var_arr:[],timeout_flag:null};_opts.urls=typeof aUrls=="string"?[{url:aUrls}]:aUrls;Core.System.parseParam(_opts,oOpts);createScripts(_opts,_cfg);if(_opts.returnType!="jsonp"){(function(){if(_opts.noreturn==true&&_opts.onComplete==null){return}var i,data=[];if(_cfg.script_loaded_num==_opts.urls.length){_cfg.is_loadcomplete=true;if(_opts.onComplete!=null){for(i=0;i<_cfg.script_var_arr.length;i++){data.push(window[_cfg.script_var_arr[i]])}if(_cfg.script_var_arr.length<2){_opts.onComplete(data[0])}else{_opts.onComplete(data)}}return}if(_cfg.is_timeout==true){return}setTimeout(arguments.callee,50)})()}if(_opts.timeout>0){_cfg.timeout_flag=setTimeout(function(){if(_cfg.is_loadcomplete!=true){if(_opts.onException!=null){_opts.onException()}_cfg.is_timeout=true}},_opts.timeout)}}Utils.Io.JsLoad.request=function(aUrls,oOpts){new ancestor(aUrls,oOpts)}})();if(typeof Lib=="undefined"){Lib={}}Lib.pkg=function(ns){if(!ns||!ns.length){return null}var levels=ns.split(".");var nsobj=Lib;for(var i=levels[0]=="Lib"?1:0;i<levels.length;++i){nsobj[levels[i]]=nsobj[levels[i]]||{};nsobj=nsobj[levels[i]]}return nsobj};Sina.pkg("Utils.Cookie");Utils.Cookie.getCookie=function(name){name=name.replace(/([\.\[\]\$])/g,"\\$1");var rep=new RegExp(name+"=([^;]*)?;","i");var co=document.cookie+";";var res=co.match(rep);if(res){return res[1]||""}else{return""}};Core.System.keyValue=function(string,key){var arr=string.match(new RegExp("(\\?|&)"+key+"=([^&]*)(&|$)"));if(arr!=null)return arr[2];return null};Lib.checkAuthor=function(){var AuthorInfo=unescape(Utils.Cookie.getCookie("SUP"));if(AuthorInfo&&AuthorInfo!=""){$UID=Core.System.keyValue(AuthorInfo,"uid");$nick=decodeURIComponent(Core.System.keyValue(AuthorInfo,"nick"));$isLogin=!!$UID;if(typeof scope.$uid=="undefined"){$isAdmin=false}else{$isAdmin=scope.$uid==$UID}}else{AuthorInfo=Utils.Cookie.getCookie("SU");if(AuthorInfo&&AuthorInfo!=""){var match=AuthorInfo.match(/^([^:]*:){2}(\d{5,11})/);$UID=match&&match[2]||null;window.$isLogin=!!$UID;if(typeof scope.$uid=="undefined"){window.$isAdmin=false}else{window.$isAdmin=scope.$uid==$UID}}else{$UID=null;$isLogin=false;$isAdmin=false}}};Lib.register=function(name,fn){var ns=name.split(".");var obj={},tmp,nsobj=Lib;while(tmp=ns.shift()){if(ns.length){if(nsobj[tmp]===undefined){nsobj[tmp]={}}nsobj=nsobj[tmp]}else{if(nsobj[tmp]===undefined){nsobj[tmp]=fn(Lib)}}}};Lib.register("util.loadScript",function(){var TRUE=!0,FALSE=!1,cache={};var loadScript=function(url,item){Utils.Io.JsLoad.request(url,{isRemove:FALSE,noreturn:TRUE,onComplete:function(data){cache[url].isLoading=FALSE;var cb=cache[url].cb;for(var i=0,len=cb.length;i<len;i++){cb[i](data)}cache[url].cb=null}})};return function(url,fun){var item=cache[url];var cb=item&&item["cb"];if(!item){cb=[fun];item={isLoading:TRUE,cb:cb};cache[url]=item;loadScript(url,item)}else if(item.isLoading){cb.push(fun)}else{fun()}}});Lib.register("sendSuda",function(lib){var url="http://www.sinaimg.cn/unipro/pub/suda_s_v851c.js";return function(fun){lib.util.loadScript(url,fun)}});function v6SendLog(type,label){}function v7sendLog(type,pageid,msg){if(!type){return false}if(type.split("_").length==3){Lib.checkAuthor();if($isLogin){type+="_"+$UID}}if(typeof scope=="undefined"){window.scope={};scope.$pageid=""}pageid=pageid||scope.$pageid;msg=msg||"";Utils.Io.JsLoad.request("http://hits.sinajs.cn/A2/b.html?type="+type+"&pageid="+pageid+"&msg="+msg,{onComplete:function(){}})}Core.Array.uniq=function(ar){var result=[],x;for(var i=0;i<ar.length;i++){x=ar[i];if(Core.Array.findit(result,x)==-1){result.push(x)}}return result};Core.String.trimHead=function(str){return str.replace(/^(\u3000|\s|\t)*/gi,"")};Core.String.trimTail=function(str){return str.replace(/(\u3000|\s|\t)*$/gi,"")};Core.String.trim=function(str){return Core.String.trimHead(Core.String.trimTail(str))};Lib.Uic={_interfaceMultiquery:"http://uic.sso.sina.com.cn/uic/Mutiquery.php",cacheNickName:{},getNickName:function(arrUidLists,fCallBack,requestNo){arrUidLists=Core.Array.uniq(arrUidLists)||[];requestNo=requestNo||10;var _trim=Core.String.trim;var _cache=this.cacheNickName,_uidWithNoCache=[],nickType=[];var _data={};for(var i=0,len=arrUidLists.length;i<len;i++){if(typeof _cache[arrUidLists[i]]=="undefined"&&_cache[arrUidLists[i]]==null){var nickEl=$E("ownernick");var pageid=_trim(scope.$pageid);if(arrUidLists[i]==$UID&&scope.nickname!=null){_data[arrUidLists[i]]=_trim(scope.nickname);continue}_uidWithNoCache.push(arrUidLists[i])}else{_data[arrUidLists[i]]=_cache[arrUidLists[i]]||arrUidLists[i]}}if(_uidWithNoCache.length==0){fCallBack(_data);_data=null}else{var urls=[];for(var i=0;i<_uidWithNoCache.length;i++){nickType[i]=1}if(_uidWithNoCache.length>0){if(nickType.length>0){nickType="["+nickType.toString().replace(/,$/g,"")+"]"}_uidWithNoCache="["+_uidWithNoCache.toString().replace(/,$/g,"")+"]";urls.push({url:this._interfaceMultiquery+"?UID=0&Check=null&UIDS="+_uidWithNoCache+"&UserInfoTypes="+nickType+"&ProductType=2"})}var jsRequest=function(aUrl){Utils.Io.JsLoad.request(aUrl[0].url,{onComplete:function(data){if(data){var uids=data.UserInfos;for(var i=0;i<uids.length;i++){_data[uids[i][0]]=uids[i][2][1];Lib.Uic.cacheNickName[uids[i][0]]=uids[i][2][1]}fCallBack(_data)}}});if(urls.length>0){setTimeout(function(){jsRequest(urls.splice(0,1))},10)}};if(urls.length>0){setTimeout(function(){jsRequest(urls.splice(0,1))},10)}}}};Core.String.byteLength=function(str){if(typeof str=="undefined"){return 0}var aMatch=str.match(/[^\x00-\x80]/g);return str.length+(!aMatch?0:aMatch.length)};Core.String.leftB=function(str,len){var s=str.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**");str=str.slice(0,s.slice(0,len).replace(/\*\*/g," ").replace(/\*/g,"").length);if(Core.String.byteLength(str)>len)str=str.slice(0,str.length-1);return str};$registJob("suda",function(){var pageId=scope&&scope.$pageid;var wlh=window.location.href;var isTj=wlh.indexOf("tj=1")>-1;var suda_flag=pageId&&(pageId==="articletj"||pageId==="index"||pageId==="indexM"||pageId==="editor"||isTj);function addSudaPage(pageId,parm1,parm2,parm3,parm4){if(isTj){v7sendLog(parm4)}switch(pageId){case"index":case"indexM":v7sendLog(parm1);break;case"editor":v7sendLog(parm2);break;case"articletj":v7sendLog(parm3);break}}if(suda_flag){var url=encodeURIComponent(wlh);var refer=encodeURIComponent(document.referrer)}if(typeof _S_pSt=="function"){if(suda_flag){v7sendLog("42_01_03_"+(new Date).getTime()+"_"+url+"_"+refer)}return}if(suda_flag){if(!$isLogin){var tj="42_01_01_"+(new Date).getTime()+"_"+url+"_"+refer}else{var tj="42_01_01_"+$UID+"_"+(new Date).getTime()+"_"+url+"_"+refer}addSudaPage(pageId,"42_01_08","42_01_14",tj,"42_01_05")}Lib.sendSuda(function(){try{_S_pSt("")}catch(e){}if(suda_flag){if(!$isLogin){var succTj="42_01_02_"+(new Date).getTime()+"_"+url+"_"+refer}else{var succTj="42_01_02_"+$UID+"_"+(new Date).getTime()+"_"+url+"_"+refer}addSudaPage(pageId,"42_01_09","42_01_15",succTj,"42_01_06")}});var ele=$E("blognamespan");if(!ele){return}Lib.checkAuthor();Lib.Uic.getNickName([scope.$uid],function(oResult){var nickName=oResult[scope.$uid];nickName=nickName.replace(/\u7684\u535a\u5ba2$/,"");nickName=Core.String.leftB(nickName,30);nickName=nickName+"的博客";ele.innerHTML=nickName});(function(d,s,id){var n=d.getElementsByTagName(s)[0];if(d.getElementById(id))return;s=d.createElement(s);s.id=id;s.setAttribute("charset","utf-8");s.src="//d"+Math.floor(0+Math.random()*(8-0+1))+".sina.com.cn/litong/zhitou/sinaads/src/spec/sinaads_ck.js";n.parentNode.insertBefore(s,n)})(document,"script","sinaads-ck-script")});Sina.pkg("Core.Class");Core.Class.AsPrototype={};Core.Class.create=function(){return function(t){if(t!=Core.Class.AsPrototype){this.initialize.apply(this,arguments)}}};Sina.pkg("Core.Math");Core.Math.getUniqueId=function(_start,_end){return parseInt(Math.random()*1e4).toString()+(new Date).getTime().toString()};var Tabs=Core.Class.create();Tabs.prototype={initialize:function(container,option){option=option||{};var className=option.className||"";this.tabsArr=[];this.htmlEle=$C("ul");this.htmlEle.className=className;container.appendChild(this.htmlEle)},add:function(tab){this.tabsArr.push(tab);this.htmlEle.appendChild(tab.element);Core.Events.addEvent(tab.element,Core.Function.bind3(this.swapTags,this,[tab]))},swapTags:function(tab){if(tab.isFocus==false){for(var i=0;i<this.tabsArr.length;i++){this.tabsArr[i].setAbort()}tab.setFocus()}else{return}}};var Tab=Core.Class.create();Tab.prototype={isShow:true,initialize:function(title,option){this.id=Core.Math.getUniqueId();this.option=option||{};var isFocus=option.isFocus||false;this.className=option.className||"";this.focus=option.onfocus?[option.onfocus]:[];this.abotrts=option.onabort?[option.onabort]:[];this.element=$C("li");if(option.cls){this.element.className=option.cls}isFocus?this.setFocus():this.setAbort();this.element.innerHTML=title},setAbort:function(){if(this.isFocus==false){return}if(this.option.cls){this.element.className=this.option.cls}else{this.element.className=""}this.isFocus=false;this.onabort()},setFocus:function(){this.element.className=this.className;this.isFocus=true;this.onfocus()},onabort:function(){for(var i=0;i<this.abotrts.length;i++){this.abotrts[i]()}},onfocus:function(){for(var i=0;i<this.focus.length;i++){this.focus[i]()}},addOnAbort:function(abortFunc){this.abotrts.push(abortFunc)},addOnFocus:function(focusFunc){this.focus.push(focusFunc)},hidden:function(){this.element.style.display="none"},hidden:function(){this.element.style.display="none";this.isShow=false},show:function(){this.element.style.display="block";this.isShow=true}};Sina.pkg("Ui");if(typeof Ui=="undefined"){Ui=Sina.Ui}Core.Function.bind2=function(fFunc,object){var __method=fFunc;return function(){return __method.apply(object,arguments)}};Function.prototype.bind2=function(object){var __method=this;return function(){return __method.apply(object,arguments)}};Ui.Template=function(tmpl){this.tmpl=tmpl;this.pattern=/(#\{(.*?)\})/g};Ui.Template.prototype={evaluate:function(data){return this.tmpl.replace(this.pattern,function(){return data[arguments[2]]||""})},evaluateMulti:function(data,reverse){var _buffer=[];Core.Array.foreach(data,Core.Function.bind2(function(v,i){i=reverse?data.length-i:i;_buffer[i]=this.evaluate(v)},this));return _buffer.join("")}};Sina.pkg("Core.Dom");Core.Dom.removeNode=function(node){node=$E(node)||node;try{node.parentNode.removeChild(node)}catch(e){}};Core.Array.without=function(array,at){var arr1=array.slice(0,at);var arr2=array.slice(at+1);return arr1.concat(arr2)};Core.Array.up=function(arr,index,num){num=num>index?index:num;return arr.slice(0,index-num).concat(arr[index],arr.slice(index-num,index),arr.slice(index+1))};Core.Array.down=function(arr,index,num){num=num>arr.length-index?arr.length-index:num;return arr.slice(0,index).concat(arr.slice(index+1,index+num+1),arr[index],arr.slice(index+num+1))};Ui.Drag2={init:function(_root,_handle){var o=this;var blk=_root;blk.hdl=_handle;if(typeof blk.hdl=="undefined"||typeof _handle==undefined)blk.hdl=blk;blk.hdl.onmousedown=start;blk.onDragStart=new Function;blk.onDrag=new Function;blk.onDragEnd=new Function;function start(e){e=e||event;var src=e.target||e.srcElement;if(src.tagName.toUpperCase()=="A"||src.parentNode.tagName.toUpperCase()=="A"&&src.tagName.toUpperCase()!="IMG")return;var o=Ui.Drag2;v=blk;v.onDragStart();v.oX=o.getX(e);v.oY=o.getY(e);v.depth=v.style.zIndex;v.style.zIndex=1e6;v.rL=parseInt(v.style.left?v.style.left:0);v.rT=parseInt(v.style.top?v.style.top:0);document.onmousemove=drag;document.onmouseup=end;return false}function drag(e){var o=Ui.Drag2;var v=blk;var nX=o.getX(e);var nY=o.getY(e);var ll=v.rL+nX-v.oX;var tt=v.rT+nY-v.oY;v.style.left=ll+"px";v.style.top=tt+"px";v.onDrag(ll,tt);return false}function end(){v.style.zIndex=v.depth;document.onmousemove=null;document.onmouseup=null;v.onDragEnd()}},fixE:function(e){if(typeof e=="undefined")e=window.event;if(typeof e.layerX=="undefined")e.layerX=e.offsetX;if(typeof e.layerY=="undefined")e.layerY=e.offsetY;return e},getX:function(e){return this.fixE(e).clientX},getY:function(e){return this.fixE(e).clientY}};Core.Dom.getElementsByClass=function(el,tg,clz){el=el||document;var rs=[];clz=" "+clz+" ";var cldr=el.getElementsByTagName(tg),len=cldr.length;for(var i=0;i<len;++i){var o=cldr[i];if(o.nodeType==1){var ecl=" "+o.className+" ";if(ecl.indexOf(clz)!=-1){rs[rs.length]=o}}}return rs};Core.Dom.byClz=Core.Dom.getElementsByClass;Core.Dom.insertHTML=function(el,html,where){el=$E(el)||document.body;where=where.toLowerCase()||"beforeend";if(el.insertAdjacentHTML){switch(where){case"beforebegin":el.insertAdjacentHTML("BeforeBegin",html);return el.previousSibling;case"afterbegin":el.insertAdjacentHTML("AfterBegin",html);return el.firstChild;case"beforeend":el.insertAdjacentHTML("BeforeEnd",html);return el.lastChild;case"afterend":el.insertAdjacentHTML("AfterEnd",html);return el.nextSibling}throw'Illegal insertion point -> "'+where+'"'}var range=el.ownerDocument.createRange();var frag;switch(where){case"beforebegin":range.setStartBefore(el);frag=range.createContextualFragment(html);el.parentNode.insertBefore(frag,el);return el.previousSibling;case"afterbegin":if(el.firstChild){range.setStartBefore(el.firstChild);frag=range.createContextualFragment(html);el.insertBefore(frag,el.firstChild);return el.firstChild}else{el.innerHTML=html;return el.firstChild}break;case"beforeend":if(el.lastChild){range.setStartAfter(el.lastChild);frag=range.createContextualFragment(html);el.appendChild(frag);return el.lastChild}else{el.innerHTML=html;return el.lastChild}break;case"afterend":range.setStartAfter(el);frag=range.createContextualFragment(html);el.parentNode.insertBefore(frag,el.nextSibling);return el.nextSibling}throw'Illegal insertion point -> "'+where+'"'};Core.Events.getEvent=function(){return window.event};if(!$IE||$IE>8){Core.Events.getEvent=function(){if(!$IE&&window.event){return window.event}var o=arguments.callee.caller;var e;var n=0;while(o!=null&&n<40){e=o.arguments[0];if(e&&(e.constructor==Event||e.constructor==MouseEvent)){return e}n++;o=o.caller}return e}}Core.Events.stopBubble=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.cancelBubble=true}};if(!$IE||$IE>8){Core.Events.stopBubble=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.stopPropagation()}}}Core.Events.stopDefaultEvent=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){if(ev.preventDefault){ev.preventDefault()}else{ev.returnValue=false}}};var ImageDrag=Core.Class.create();ImageDrag.dragElementCounter=0;ImageDrag.dragSortObj={baseOffsetLeft:0,baseOffsetTop:0,imgOffsetWidth:0,imgOffsetHeight:0,horizontalGap:0,verticalGap:0};ImageDrag.prototype={constructor:ImageDrag,dragElementIndex:0,BLOCK_ID:"idarg_block",BORDER_ID:"id_border",BORDER_DIV:'<div id="id_border" style="position:absolute;top:0;left:0;float:left;width:2px;height:50px;border:2px dotted #51bd2f; margin-top: 2px;"></div>',CONTAINER_ID:"img_list",ITEM_ID:"image_list_",IMG_ID:"item_img_",ROW:2,COL:10,sortImagesByDrag:function(event){var dso=this.constructor.dragSortObj;if(this.constructor.dragElementCounter<=1){return}var mX=event.clientX,mY=event.clientY,v=mX-dso.baseOffsetLeft,v1=mY-dso.baseOffsetTop,modX=v%(dso.imgOffsetWidth+dso.horizontalGap),modY=v1%(dso.imgOffsetHeight+dso.verticalGap);if(modX<0||modX>dso.imgOffsetWidth||modY<0||modY>dso.imgOffsetHeight){return}var xMouseoverImgIndex=Math.ceil(v/(dso.imgOffsetWidth+dso.horizontalGap)),yMouseoverImgIndex=Math.ceil(v1/(dso.imgOffsetHeight+dso.verticalGap)),f=(yMouseoverImgIndex-1)*this.COL+xMouseoverImgIndex-1;if(f==this.dragElementIndex||f==this.dragElementIndex+1){$E(this.BORDER_ID).style.display="none";return}var eles=Core.Dom.getChildrenByClass($E(this.CONTAINER_ID),"orderCell");if(eles[f].getAttribute("isadd")=="yes"||f==this.constructor.dragElementCounter){var xy=Core.Dom.getXY(eles[f]);$E(this.BORDER_ID).style.display="";$E(this.BORDER_ID).style.left=xy[0]-5+"px";$E(this.BORDER_ID).style.top=xy[1]+"px";$E(this.BORDER_ID).borderIndex=f}else{$E(this.BORDER_ID).style.display="none"}},initialize:function(ele){var dso=this.constructor.dragSortObj;if(++this.constructor.dragElementCounter==1){var d=document.createElement("div");d.id="id_border";d.style.cssText="display:none;position:absolute;top:0;left:0;float:left;width:2px;height:50px;border:2px dotted #51bd2f; margin-top: 2px;";document.body.appendChild(d)}var r=Core.Dom.getElementsByClass($E(this.CONTAINER_ID),"div","divImg");if(r.length!=this.ROW*this.COL){return}var firstImg=r[0].getElementsByTagName("img")[0];var xy=Core.Dom.getXY(firstImg);dso.baseOffsetLeft=xy[0];dso.baseOffsetTop=xy[1];dso.imgOffsetWidth=firstImg.offsetWidth;dso.imgOffsetHeight=firstImg.offsetHeight;var nImg=r[this.COL+1].getElementsByTagName("img")[0];var xy1=Core.Dom.getXY(nImg);dso.horizontalGap=xy1[0]-dso.baseOffsetLeft-dso.imgOffsetWidth;dso.verticalGap=xy1[1]-dso.baseOffsetTop-dso.imgOffsetHeight;ImageDragArea.setAreaNumber(this.CONTAINER_ID);var _this=this;var headerTab=$E("headerTab");if(headerTab){var _CONTAINER_ID=this.CONTAINER_ID;var liArr=headerTab.getElementsByTagName("li");for(var i=0;i<liArr.length;i++){Core.Events.addEvent(liArr[i],function(){setTimeout(function(){var xy=Core.Dom.getXY($E(_CONTAINER_ID).firstChild.getElementsByTagName("img")[0]);dso.baseOffsetLeft=xy[0];dso.baseOffsetTop=xy[1];ImageDragArea.setAreaNumber(_CONTAINER_ID)},100)})}}var id=ele.id.split("_")[2];$E(this.IMG_ID+id).style.cursor="move";Core.Events.addEvent(ele,function(e){_this.drag(e,ele)},"mousedown",false);ele.onDragStart=this.onDragStart.bind2(this);ele.onDrag=this.onDrag.bind2(this);ele.onDragEnd=this.onDragEnd.bind2(this)},drag:function(e,dragElement){if(!document.all&&dragElement.style.position=="absolute"){return}e=e||window.event;if(!e.target){e.target=e.srcElement}if(e.target.tagName.toUpperCase()=="A"){this.constructor.dragElementCounter--;return}var xy=Core.Dom.getXY(dragElement);var startX=e.clientX-xy[0],startY=e.clientY-xy[1];if(Object.prototype.toString.call(dragElement.onDragStart)==="[object Function]"){dragElement.onDragStart()}if(document.addEventListener){document.addEventListener("mousemove",mousemove,true);document.addEventListener("mouseup",mouseup,true)}else{dragElement.setCapture();dragElement.attachEvent("onmousemove",mousemove);dragElement.attachEvent("onmouseup",mouseup);dragElement.attachEvent("onlosecapture",mouseup)}Core.Events.stopBubble(e);Core.Events.stopDefaultEvent(e);function mousemove(moveEvent){moveEvent=moveEvent||windwo.event;var currentLeft=moveEvent.clientX-startX;var currentTop=moveEvent.clientY-startY;if(ImageDragArea.minX){currentLeft=Math.max(Math.min(currentLeft,ImageDragArea.maxX),ImageDragArea.minX);currentTop=Math.max(Math.min(currentTop,ImageDragArea.maxY),ImageDragArea.minY)}dragElement.style.left=currentLeft+"px";dragElement.style.top=currentTop+"px";Core.Events.stopBubble(e);Core.Events.stopDefaultEvent(e);if(Object.prototype.toString.call(dragElement.onDrag)==="[object Function]"){dragElement.onDrag(moveEvent)}}function mouseup(upEvent){upEvent=upEvent||window.event;if(document.removeEventListener){document.removeEventListener("mousemove",mousemove,true);document.removeEventListener("mouseup",mouseup,true)}else{dragElement.detachEvent("onmousemove",mousemove);dragElement.detachEvent("onmouseup",mouseup);dragElement.detachEvent("onlosecapture",mouseup);dragElement.releaseCapture()}Core.Events.stopBubble(e);Core.Events.stopDefaultEvent(e);if(Object.prototype.toString.call(dragElement.onDragEnd)==="[object Function]"){dragElement.onDragEnd()}}},setBlockEle:function(ele){var html='<div id="'+this.BLOCK_ID+'" style="border: 2px dotted #51bd2f; float:left;height:58px;margin-left:4px;margin-bottom:12px;overflow:hidden;width:54px;"></div>';

var blockEle=$E(this.BLOCK_ID);if(blockEle){this.removeBlockEle()}Core.Dom.insertHTML(ele,html,"BeforeBegin")},initDragPosition:function(ele){var xy=Core.Dom.getXY($E(this.BLOCK_ID));ele.style.position="absolute";ele.style.zIndex=1e6;ele.style.top=xy[1]+1+"px";ele.style.left=xy[0]+1+"px"},onDragStart:function(e){var id=this.getIdByEle(Core.Events.getEventTarget());var ele=$E(this.ITEM_ID+id);var child=$E("img_list").childNodes;for(var i=0;i<child.length;i++){if(ele==child[i]){this.dragElementIndex=i;break}}child=null;ele.style.position="absolute";this.setBlockEle(ele);this.initDragPosition(ele);var useClient=$E("useClient");if(useClient&&useClient.style.display!="none"){var flashDiv=useClient.lastChild;if(flashDiv.tagName=="DIV"){flashDiv.style.display="none"}}},onDrag:function(event){this.sortImagesByDrag(event)},onDragEnd:function(){var useClient=$E("useClient");if(useClient&&useClient.style.display!="none"){var flashDiv=useClient.lastChild;if(flashDiv.tagName=="DIV"){flashDiv.style.display="block"}}var border_ele=$E(this.BORDER_ID);var eles=Core.Dom.getChildrenByClass($E(this.CONTAINER_ID),"orderCell");if(border_ele.style.display==""){imageList.inserBefore(eles[border_ele.borderIndex],eles[this.dragElementIndex]);border_ele.style.display="none"}else{var item=eles[this.dragElementIndex];item.style.position="";if(!document.all){item.getElementsByTagName("a")[1].blur()}else{item.firstChild.getElementsByTagName("div")[0].firstChild.style.borderColor="#F5F5F5"}}this.removeBlockEle()},getIdByEle:function(ele){var arr=ele.id.split("_");return arr[arr.length-1]},removeBlockEle:function(){Core.Dom.removeNode($E(this.BLOCK_ID))}};ImageDragArea={setAreaNumber:function(containerId){var container=$E(containerId);xy=Core.Dom.getXY(container);trace(">>>>>>>>>xy:"+xy);this.minX=xy[0];this.minY=xy[1];this.maxX=xy[0]+container.offsetWidth-57;this.maxY=xy[1]+container.offsetHeight-57}};Core.Array.insert=function(arr,index,value){return arr.slice(0,index).concat(value,arr.slice(index))};var ImageList=Core.Class.create();ImageList.prototype={ITEM_ID:"image_list_",CONTAINER_ID:"img_list",IMG_ID:"item_img_",TIP_ID:"image_list_tip_",DEL_ID:"item_del_",drags:{},containerId:"",eleList:[],eleMax:20,at:0,delCallbacks:[],initialize:function(containerId,max,operateCallback){this.containerId=containerId;this.operateCallback=operateCallback||function(){};if(max){this.eleMax=max}this.initElement()},initElement:function(){var innerHtml="";for(var i=0;i<this.eleMax;i++){var obj={};obj.id=Core.Math.getUniqueId();this.eleList.push(obj);innerHtml+=this.createNodes(obj.id)}$E(this.containerId).innerHTML=innerHtml},add:function(imageUrl,type){var type=type||"";if(type!="upload"){if(window.loadingList.checkIsWoking()){return false}}if(this.at<this.eleMax){this.eleList[this.at].value=imageUrl;this.eleList[this.at].type=type;var itemEle=$E(this.ITEM_ID+this.eleList[this.at].id);var imgEle=$E(this.IMG_ID+this.eleList[this.at].id);itemEle.isadd="yes";itemEle.setAttribute("isadd","yes");imgEle.src=imageUrl;this.getImageSize(this.at);this.drags[this.eleList[this.at].id]=new ImageDrag(itemEle);this.showDelEle(this.eleList[this.at].id);this.swapStatus();this.operateCallback(this.at+1,"add");return this.eleList[this.at++].id}return false},showDelEle:function(id){$E(this.DEL_ID+id).style.display=""},getIdByIndex:function(index){return this.eleList[index].id},addToEditor:function(){},remove:function(type,value){var delId,isAt=false,array=this.eleList,len=this.eleList.length,clen=this.delCallbacks.length;for(var i=0;i<len;i++){if(type=="id"){if(this.eleList[i].id==value){isAt=true}}else{if(this.eleList[i].value==value){isAt=true}}if(isAt==true){delId=this.eleList[i].id;for(var j=0;j<clen;j++){this.delCallbacks[j](delId,this.eleList[i].value)}this.eleList=Core.Array.without(this.eleList,i);break}}if(!isAt){return}var itemEle=$E(this.ITEM_ID+delId),isAdded=itemEle.getAttribute("isadd");if("yes"===isAdded&&this.at>0){this.at--}Core.Dom.removeNode(itemEle);var newid=Core.Math.getUniqueId();Core.Dom.addHTML($E(this.CONTAINER_ID),this.createNodes(newid));this.eleList.push({id:newid});this.swapStatus();this.operateCallback(this.at,"remove")},addDelCallback:function(callback){this.delCallbacks.push(callback)},getList:function(){return this.eleList},checkValue:function(value){for(var i=0;i<this.at;i++){if(this.eleList[i].value==value){return this.eleList[i].id}}return false},swapNode:function(id,type){var len=this.eleList.length;for(var i=0;i<this.at;i++){if(this.eleList[i].id==id){if(type=="left"){var up_node=$E(this.ITEM_ID+this.eleList[i-1].id);$E(this.ITEM_ID+id).id=up_node.id;up_node.id=this.ITEM_ID+id;var obj_bak=this.eleList[i];this.eleList[i]=this.eleList[i-1];this.eleList[i-1]=obj_bak;Core.Array.up(this.eleList,i,1)}else{var next_node=$E(this.ITEM_ID+this.eleList[i+1].id);$E(this.ITEM_ID+id).id=next_node.id;next_node.id=this.ITEM_ID+id;var obj_bak=this.eleList[i];this.eleList[i]=this.eleList[i+1];this.eleList[i+1]=obj_bak;Core.Array.down(this.eleList,i,1)}break}}this.createAllNodes()},inserBefore:function(itemEle,moveEle){itemEle.parentNode.insertBefore(moveEle,itemEle);moveEle.style.position="";if(document.all){moveEle.firstChild.getElementsByTagName("div")[0].firstChild.style.borderColor="#F5F5F5"}this.changeEleList(uploadMain.getIdByEle(moveEle),uploadMain.getIdByEle(itemEle))},changeEleList:function(moveId,atId){trace(moveId+":"+atId);var len=this.eleList.length;var moveObj={};for(var i=0;i<len;i++){if(this.eleList[i].id==moveId){moveObj=this.eleList[i];this.eleList=Core.Array.without(this.eleList,i);break}}len=this.eleList.length;for(var j=0;j<len;j++){if(this.eleList[j].id==atId){this.eleList=Core.Array.insert(this.eleList,j,moveObj);break}}},createAllNodes:function(){for(var i=0;i<this.at;i++){this.createNodes(i)}this.swapStatus()},swapStatus:function(){var l_class,l_click,r_class,r_click;for(var i=0;i<this.at;i++){if(i<1){l_class="La";l_click="javascript:;"}else{l_class="";l_click="javascript:window.imageList.swapNode('"+this.eleList[i].id+"','left');"}if(i>=this.at-1){r_class="Ra";r_click="javascript:;"}else{r_class="";r_click="javascript:window.imageList.swapNode('"+this.eleList[i].id+"','right');"}}},isFull:function(){if(this.at>=this.eleMax){return true}return false},createNodes:function(id){var html='<div isadd="no" id="'+this.ITEM_ID+id+'" class="orderCell"><div class="orderBlock">\r\n             <a style="display:none" id="'+this.DEL_ID+id+'" title="删除" class="del" onclick="window.uploadMain.removeImage(\''+id+'\');return false;" href="javascript:void(0);">\r\n             </a>\r\n            <div class="divImg">\r\n                <a onmouseover="this.style.borderColor=\'\';" href="javascript:void(0)">\r\n                    <img id="'+this.IMG_ID+id+'" height="50" width="50" alt=""  src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif"/>\r\n                </a>\r\n                <div id="loading_'+id+'" class="divImg_loading" style="display:none">\r\n               </div>\r\n            </div>\r\n             <span class="err" id="'+this.TIP_ID+id+'" style="display:none"></span>\r\n            </div></div>';return html},getImageSize:function(id){if(top.isPicFlaReady){try{uploadImage.getSizeStart();parent.trace(this.eleList[id].value);var t=this.eleList[id].value.replace(/square/,"mw690");uploadImage.getSize(t)}catch(e){}}}};Core.Math.getRandomNumber=function(_start,_end){if(isNaN(_start)||isNaN(_end)||_start<0&&_end<0){return null}var _s=Math.ceil(Math.min(_start,_end));var _e=Math.floor(Math.max(_start,_end));_s=_s>0?_s:0;return Math.round(_s+Math.random()*(_e-_s))};Core.Dom.opacity=function(elm,value){elm=typeof elm=="string"?$E(elm):elm;elm.style.filter="alpha(opacity="+value+")";elm.style.opacity=value/100};Core.String.j2o=function(str){if(!str||str==""){return null}try{var o=window.eval("("+str+")");return o}catch(e){trace("j2o : 数据分析出错");traceError(e);return null}};Core.Dom.getLeft=function(element){var left=0;var el=$E(element);if(typeof el.offsetParent!="unknown"){while(el.offsetParent){left+=el.offsetLeft;el=el.offsetParent}}else if(el.x){left+=el.x}return left};Core.Dom.getTop=function(element){var top=0;var el=$E(element);if(typeof el.offsetParent!="unknown"){while(el.offsetParent){top+=el.offsetTop;el=el.offsetParent}}else if(el.y){top+=el.y}return top};Core.Dom.getStyle=function(el,property){switch(property){case"opacity":var val=100;try{val=el.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(e){try{val=el.filters("alpha").opacity}catch(e){}}return val/100;case"float":property="styleFloat";default:var value=el.currentStyle?el.currentStyle[property]:null;return el.style[property]||value}};if(!$IE||$IE>8){Core.Dom.getStyle=function(el,property){if(property=="float"){property="cssFloat"}try{var computed=document.defaultView.getComputedStyle(el,"")}catch(e){traceError(e)}return el.style[property]||computed?computed[property]:null}}Core.Dom.setStyle=function(el,property,val){switch(property){case"opacity":el.style.filter="alpha(opacity="+val*100+")";if(!el.currentStyle||!el.currentStyle.hasLayout){el.style.zoom=1}break;case"float":property="styleFloat";default:el.style[property]=val}};if(!$IE||!($IE<9)){Core.Dom.setStyle=function(el,property,val){if(property=="float"){property="cssFloat"}el.style[property]=val}}Core.System.getScrollPos=function(oDocument){oDocument=oDocument||document;var dd=oDocument.documentElement;var db=oDocument.body;return[Math.max(dd.scrollTop,db.scrollTop),Math.max(dd.scrollLeft,db.scrollLeft),Math.max(dd.scrollWidth,db.scrollWidth),Math.max(dd.scrollHeight,db.scrollHeight)]};Core.Dom.getXY=function(el){if((el.parentNode==null||el.offsetParent==null||Core.Dom.getStyle(el,"display")=="none")&&el!=document.body){return false}var parentNode=null;var pos=[];var box;var doc=el.ownerDocument;box=el.getBoundingClientRect();var scrollPos=Core.System.getScrollPos(el.ownerDocument);return[box.left+scrollPos[1],box.top+scrollPos[0]];parentNode=el.parentNode;while(parentNode.tagName&&!/^body|html$/i.test(parentNode.tagName)){if(Core.Dom.getStyle(parentNode,"display").search(/^inline|table-row.*$/i)){pos[0]-=parentNode.scrollLeft;pos[1]-=parentNode.scrollTop}parentNode=parentNode.parentNode}return pos};if(!$IE){Core.Dom.getXY=function(el){if((el.parentNode==null||el.offsetParent==null||Core.Dom.getStyle(el,"display")=="none")&&el!=document.body){return false}var parentNode=null;var pos=[];var box;var doc=el.ownerDocument;pos=[el.offsetLeft,el.offsetTop];parentNode=el.offsetParent;var hasAbs=Core.Dom.getStyle(el,"position")=="absolute";if(parentNode!=el){while(parentNode){pos[0]+=parentNode.offsetLeft;pos[1]+=parentNode.offsetTop;if($SAFARI&&!hasAbs&&Core.Dom.getStyle(parentNode,"position")=="absolute"){hasAbs=true}parentNode=parentNode.offsetParent}}if($SAFARI&&hasAbs){pos[0]-=el.ownerDocument.body.offsetLeft;pos[1]-=el.ownerDocument.body.offsetTop}parentNode=el.parentNode;while(parentNode.tagName&&!/^body|html$/i.test(parentNode.tagName)){if(Core.Dom.getStyle(parentNode,"display").search(/^inline|table-row.*$/i)){pos[0]-=parentNode.scrollLeft;pos[1]-=parentNode.scrollTop}parentNode=parentNode.parentNode}return pos}}Core.Dom.setXY=function(el,pos,noRetry){var pos_style=Core.Dom.getStyle(el,"position");if(pos_style=="static"){Core.Dom.setStyle(el,"position","relative");pos_style="relative"}var page_xy=Core.Dom.getXY(el);if(page_xy==false){return false}var delta=[parseInt(Core.Dom.getStyle(el,"left"),10),parseInt(Core.Dom.getStyle(el,"top"),10)];if(isNaN(delta[0])){delta[0]=pos_style=="relative"?0:el.offsetLeft}if(isNaN(delta[1])){delta[1]=pos_style=="relative"?0:el.offsetTop}if(pos[0]!=null){el.style.left=pos[0]-page_xy[0]+delta[0]+"px"}if(pos[1]!=null){el.style.top=pos[1]-page_xy[1]+delta[1]+"px"}return true};Sina.pkg("Utils.Flash");if(typeof deconcept=="undefined")var deconcept=new Object;if(typeof deconcept.util=="undefined")deconcept.util=new Object;if(typeof deconcept.SWFObjectUtil=="undefined")deconcept.SWFObjectUtil=new Object;deconcept.SWFObject=function(swf,id,w,h,ver,c,quality,xiRedirectUrl,redirectUrl,detectKey){if(!document.getElementById){return}this.DETECT_KEY=detectKey?detectKey:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object;this.variables=new Object;this.attributes=new Array;if(swf){this.setAttribute("swf",swf)}if(id){this.setAttribute("id",id)}if(w){this.setAttribute("width",w)}if(h){this.setAttribute("height",h)}if(ver){this.setAttribute("version",new deconcept.PlayerVersion(ver.toString().split(".")))}this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){deconcept.SWFObject.doPrepUnload=true}if(c){this.addParam("bgcolor",c)}var q=quality?quality:"high";this.addParam("quality",q);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var xir=xiRedirectUrl?xiRedirectUrl:window.location;this.setAttribute("xiRedirectUrl",xir);this.setAttribute("redirectUrl","");if(redirectUrl){this.setAttribute("redirectUrl",redirectUrl)}};deconcept.SWFObject.prototype={useExpressInstall:function(path){this.xiSWFPath=!path?"expressinstall.swf":path;this.setAttribute("useExpressInstall",true)},setAttribute:function(name,value){this.attributes[name]=value},getAttribute:function(name){return this.attributes[name]},addParam:function(name,value){this.params[name]=value},getParams:function(){return this.params},addVariable:function(name,value){this.variables[name]=value},getVariable:function(name){return this.variables[name]},getVariables:function(){return this.variables},getVariablePairs:function(){var variablePairs=new Array;var key;var variables=this.getVariables();for(key in variables){variablePairs[variablePairs.length]=key+"="+variables[key]}return variablePairs},getSWFHTML:function(){var swfNode="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath)}swfNode='<embed pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" src="'+this.getAttribute("swf")+'" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'"';swfNode+=' id="'+this.getAttribute("id")+'" name="'+this.getAttribute("id")+'" ';var params=this.getParams();for(var key in params){swfNode+=[key]+'="'+params[key]+'" '}var pairs=this.getVariablePairs().join("&");if(pairs.length>0){swfNode+="flashvars="+pairs+'&realfull=1&moz=1"'}swfNode+="/>"}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath)}swfNode='<object id="'+this.getAttribute("id")+'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'">';swfNode+='<param name="movie" value="'+this.getAttribute("swf")+'" />';var params=this.getParams();for(var key in params){swfNode+='<param name="'+key+'" value="'+params[key]+'" />'}var pairs=this.getVariablePairs().join("&");if(pairs.length>0){swfNode+='<param name="flashvars" value="'+pairs+'" />'}swfNode+="</object>"}return swfNode},write:function(elementId){if(this.getAttribute("useExpressInstall")){var expressInstallReqVer=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(expressInstallReqVer)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title)}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){}else{if(this.getAttribute("redirectUrl")!=""){document.location.replace(this.getAttribute("redirectUrl"))}}var n=typeof elementId=="string"?document.getElementById(elementId):elementId;var oldTitle=document.title;n.innerHTML=this.getSWFHTML();if(oldTitle!==document.title){document.title=oldTitle}return true}};deconcept.SWFObjectUtil.getPlayerVersion=function(){var PlayerVersion=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description){PlayerVersion=new deconcept.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."))}}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;var counter=3;while(axo){try{counter++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+counter);PlayerVersion=new deconcept.PlayerVersion([counter,0,0])}catch(e){axo=null}}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");PlayerVersion=new deconcept.PlayerVersion([6,0,21]);axo.AllowScriptAccess="always"}catch(e){if(PlayerVersion.major==6){return PlayerVersion}}try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){}}if(axo!=null){PlayerVersion=new deconcept.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","))}}return PlayerVersion};deconcept.PlayerVersion=function(arrVersion){this.major=arrVersion[0]!=null?parseInt(arrVersion[0]):0;this.minor=arrVersion[1]!=null?parseInt(arrVersion[1]):0;this.rev=arrVersion[2]!=null?parseInt(arrVersion[2]):0};deconcept.PlayerVersion.prototype.versionIsValid=function(fv){if(this.major<fv.major)return false;if(this.major>fv.major)return true;if(this.minor<fv.minor)return false;if(this.minor>fv.minor)return true;if(this.rev<fv.rev)return false;return true};deconcept.util={getRequestParameter:function(param){var q=document.location.search||document.location.hash;if(param==null){return q}if(q){var pairs=q.substring(1).split("&");for(var i=0;i<pairs.length;i++){if(pairs[i].substring(0,pairs[i].indexOf("="))==param){return pairs[i].substring(pairs[i].indexOf("=")+1)}}}return""}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var objects=document.getElementsByTagName("OBJECT");for(var i=objects.length-1;i>=0;i--){objects[i].style.display="none";for(var x in objects[i]){if(typeof objects[i][x]=="function"){objects[i][x]=function(){}}}}};if(deconcept.SWFObject.doPrepUnload){if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs)};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true}}if(!document.getElementById&&document.all){document.getElementById=function(id){return document.all[id]}}var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;Utils.Flash.swfObject=deconcept.SWFObject;Utils.Flash.swfView={swfList:[],Add:function(sURL,sID,sPID,nWidth,nHeight,nVersion,sBGColor,oVar,oParam){if(sURL&&sPID){this.swfList[this.swfList.length]={sURL:sURL,sID:sID,sPID:sPID,nWidth:nWidth,nHeight:nHeight,nVersion:nVersion,sBGColor:sBGColor,oVar:oVar,oParam:oParam};this.Init();return}},Init:function(){var so;var list=this.swfList;for(var i=0,len=list.length;i<len;i++){var _list=list[i];so=new Utils.Flash.swfObject(_list.sURL,_list.sPID,_list.nWidth,_list.nHeight,_list.nVersion,_list.sBGColor);if(_list.oVar){for(var key in _list.oVar){so.addVariable(key,_list.oVar[key])}}if(_list.oParam){for(var Key in _list.oParam){so.addParam(Key,_list.oParam[Key])}}so.write(_list.sID)}list=[];_list=null;so=null}};Core.String.shorten=function(str,len,suffix){if(Core.String.byteLength(str)<=len){return str}if(suffix!=""){suffix=suffix||"..."}else{suffix=""}return Core.String.leftB(str,len)+suffix};Core.Dom.addHTML=function(oParentNode,sHTML){oParentNode.insertAdjacentHTML("beforeend",sHTML)};if(!$C("div").insertAdjacentHTML){Core.Dom.addHTML=function(oParentNode,sHTML){var oRange=oParentNode.ownerDocument.createRange();oRange.setStartBefore(oParentNode);var oFrag=oRange.createContextualFragment(sHTML);oParentNode.appendChild(oFrag)}}var $SYSMSG={};$SYSMSG.extend=function(info,override){for(var i in info){$SYSMSG[i]=!!override==false?info[i]:$SYSMSG[i]}};$SYSMSG.extend({A77771:"超出限制",A77772:"图片错误",A77773:"上传错误",A77774:"图片不存在",A77775:"关闭操作浮层将导致添加失败，是否继续？",A77776:"新浪声明：<br/>新浪博客允许用户上传图片并加水印的行为是出于传递更多信息、保护作者版权之目的，但并不意味着新浪博客已核实图片版权、认同其版权归属。用户据此操作，风险自担。  特此声明！"});var UploadLoading=Core.Class.create();UploadLoading.prototype={ELE_ID:"loading_",RATD_ID:"loading_range_",ERROR_ID:"image_list_tip_",TIP_ID:"loading_tip_",DEL_ID:"item_del_",state:1,initialize:function(containerId,name,cancelCallback){this.id=containerId;this.name=name;this.show();this.showDel();this.cancelCallback=cancelCallback||function(){};this.initElement()},hiddenDel:function(){$E(this.DEL_ID+this.id).style.display="none"},showDel:function(){$E(this.DEL_ID+this.id).style.display=""},show:function(){$E(this.ELE_ID+this.id).style.display="";this.state=2},setError:function(error,tip){var ele=$E(this.ERROR_ID+this.id),imgItemEl=$E(ImageList.prototype.ITEM_ID+this.id);if(error){ele.innerHTML=tip||$SYSMSG["A77773"];ele.style.display="";this.state=3;imgItemEl.setAttribute("isadd","yes")}else{ele.innerHTML="";ele.style.display=""}},setRange:function(range){$E(this.RATD_ID+this.id).style.width=range},setFinish:function(){var ele=$E(this.ELE_ID+this.id);ele.style.display="none";ele.innerHTML="";this.state=4},setTip:function(text){$E(this.TIP_ID+this.id).innerHTML=text},cancel:function(){var ele=$E(this.ELE_ID+this.id);ele.style.display="none";this.setError(false);ele.innerHTML="";this.hiddenDel();this.state=5;try{$E("uploadimage_"+uploadImage.id).cancel(this.name)}catch(e){}this.cancelCallback(this.name)},initElement:function(){var loadingTemplate='<p id="#{TIP_ID}#{id}">0%</p>\r\n         <div class="loadbanner">\r\n         	<div  style="width:0%;" id="#{RATD_ID}#{id}"class="loadbanner_c"></div>\r\n         </div>';this.setError(false);var loadEl=$E(this.TIP_ID+this.id);if(!loadEl){var l_t=new Ui.Template(loadingTemplate);var html=l_t.evaluate({id:this.id,RATD_ID:this.RATD_ID,TIP_ID:this.TIP_ID});Core.Dom.addHTML($E(this.ELE_ID+this.id),html)}}};Core.Array.ArrayWithout=function(){if(arguments.length<2){return arguments.length==1?arguments[0]:null}var results=[];var aa=arguments[0];if(aa===null||aa.constructor!=Array){return null}if(arguments[1].constructor==Array){var args=[];args[0]=aa;Core.Array.foreach(arguments[1],function(v,i){args[i+1]=v})}else{args=arguments}for(var i=0;i<aa.length;i++){var isWithout=true;for(var j=1;j<args.length;j++){if(aa[i]==args[j]){isWithout=false;break}}if(isWithout){results.push(aa[i])}}return results};var LoadingList=Core.Class.create();LoadingList.prototype={lst:{},key:[],initialize:function(){},add:function(id,name){this.key.push(name);this.lst[name]=new UploadLoading(id,name,this.cancelCallback.bind2(this))},cancelCallback:function(name){this.key=Core.Array.ArrayWithout(this.key,name);if(this.key.length<1){}},setRange:function(name,num){var text=num+"%";this.lst[name].setRange(text);this.lst[name].setTip(text);if(num==100){this.lst[name].state=4;this.lst[name].setFinish()}else{this.lst[name].state=2}},checkIsWoking:function(){var len=this.key.length;for(var i=0;i<len;i++){if(this.lst[this.key[i]].state==2){return true}}return false},error:function(name,isError,tip){var list=this.lst[name];if(list&&list.setError){list.setError(isError,tip)}},allError:function(){var len=this.key.length;for(var i=0;i<len;i++){if(this.lst[this.key[i]].state!=4){this.lst[this.key[i]].setError(true)}}},setFinish:function(name){this.lst[name].setFinish()},remove:function(id){var i=0;for(name in this.lst){if(this.lst[name].id==id){this.lst[name].cancel();delete this.lst[name]}}},setPid:function(name,pid){this.lst[name].pid=pid}};(function(){function object(o){function F(){}F.prototype=o;return new F}Function.prototype.$define=function(def){var k;for(k in def){this.prototype[k]=def[k]}if(this.__interface__){for(k in this.prototype){if(this.prototype[k]==="NI"){throw new Error("类定义错误，接口方法["+k+"]未实现")}}}this.prototype.constructor=this;this.$extends=this.$define=this.$implements=function(){throw new Error("$define语句定义后面不能再作其它定义")};return this};Function.prototype.$extends=function(){var me=this,i=arguments.length,sup,fn;if(i===0){throw new Error("$extends语句错误：未指定父类")}sup=arguments[0];fn=function(){sup.apply(this,arguments);me.apply(this,arguments)};fn.prototype=object(sup.prototype);fn.prototype.constructor=fn;fn.$super=sup.prototype;return fn};Function.prototype.$implements=function(){var arg=Array.prototype.slice.call(arguments,0),fn,i=arg.length,k;while(i--){if(typeof arg[i]!=="object"){throw new Error("$implements语句错误：参数必须为object类型")}for(k in arg[i]){typeof this.prototype[k]==="undefined"&&(this.prototype[k]="NI")}}this.__interface__=true;this.$extends=function(){throw new Error("$extends语句错误:$extends语句不能出现在$implements定义之后")};return this}})();(function(){Core.Function.defineGetter=function(obj,p,fn){if(p instanceof Array&&fn instanceof Array){var i=Math.min(p.length,fn.length);while(i--){if(typeof p[i]==="string"&&__checkFunction(fn[i])){obj[p[i]]={valueOf:function(j){return function(){return __getValue(obj,fn[j])}}(i),toString:this.valueOf}}}}else if(typeof p==="string"&&__checkFunction(fn)){obj[p]={valueOf:function(){return __getValue(obj,fn)},toString:this.valueOf}}};function __checkFunction(fn){return typeof fn!=="string"&&String.prototype.slice.call(fn,0,8)=="function"}function __getValue(obj,fn){var ret=fn.call(obj);return typeof ret==="string"||typeof ret==="number"?ret:null}})();Ui.IE6FixedController=function(){var me=this;this.node=null;this.iframeNode=null;this.__orgX=0;this.__orgY=0;this.__isBindScroll=false;this.__fixedHandle=function(){if(me.node){me.node.style.left=document.documentElement.scrollLeft+me.__orgX+"px";me.node.style.top=document.documentElement.scrollTop+me.__orgY+"px"}if(me.iframeNode){me.iframeNode.style.left=me.node.style.left;me.iframeNode.style.top=me.node.style.top}}}.$define({setFixed:function(node,state){this.updateOrgPosition();if(state&&!this.__isBindScroll){Core.Events.addEvent(window,this.__fixedHandle,"scroll");this.__isBindScroll=true}if(!state&&this.__isBindScroll){Core.Events.removeEvent(window,this.__fixedHandle,"scroll");this.__isBindScroll=false}},setPosition:function(node,fixedState,p){if(typeof p.x!=="undefined"){if(fixedState){node.style.left=p.x+document.documentElement.scrollLeft+"px";this.__orgX=parseInt(this.node.style.left)-document.documentElement.scrollLeft}else{node.style.left=p.x+"px"}}if(typeof p.y!=="undefined"){if(fixedState){node.style.top=p.y+document.documentElement.scrollTop+"px";this.__orgY=parseInt(this.node.style.top)-document.documentElement.scrollTop}else{node.style.top=p.y+"px"}}typeof p.z!=="undefined"&&(node.style.zIndex=p.z)},getX:function(node,fixedState){if(fixedState){return parseInt(node.style.left)-document.documentElement.scrollLeft}else{return parseInt(node.style.left)}},getY:function(node,fixedState){if(fixedState){return parseInt(node.style.top)-document.documentElement.scrollTop}else{return parseInt(node.style.top)}},updateIframe:function(isFixed){this.setFixed(this.iframeNode,isFixed);isFixed&&this.__fixedHandle()},updateOrgPosition:function(){if(!this.node){return}this.__orgX=parseInt(this.node.style.left)-document.documentElement.scrollLeft;this.__orgY=parseInt(this.node.style.top)-document.documentElement.scrollTop},destroy:function(){Core.Events.removeEvent(window,this.__fixedHandle,"scroll");this.__isBindScroll=false;this.node=null;this.iframeNode=null}});Core.Events.EventDispatcher=function(target){this.__target=target;this.__events={}}.$define({addEventListener:function(type,handle){if(!this.__checkFunction(handle)){return}var evts=this.__events;type=type.toLowerCase();!evts[type]&&(evts[type]=[]);evts[type].push(handle)},removeEventListener:function(type,handle){var evts=this.__events[type];type=type.toLowerCase();if(!this.__checkFunction(handle)||!evts||!evts.length){return}for(var i=evts.length-1;i>=0;i--){evts[i]==handle&&evts.splice(i,1)}},dispatchEvent:function(type){type=type.toLowerCase();var evts=this.__events[type];if(!evts||!evts.length){return}var args=Array.prototype.slice.call(arguments,0);args.shift();for(var i=0,l=evts.length;i<l;i++){evts[i].apply(this.__target,args)}},__checkFunction:function(func){return typeof func!=="string"&&String.prototype.slice.call(func,0,8)=="function"}});Ui.IRenderer={setCanShow:function(state){},setCanHidden:function(state){},show:function(node){},hidden:function(node){},addEventListener:function(type,handle){},removeEventListener:function(type,handle){}};Ui.SimpleRenderer=function(){this.__canShow=true;this.__canHidden=true;this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$implements(Ui.IRenderer).$define({setCanShow:function(state){this.__canShow=!!state},setCanHidden:function(state){this.__canHidden=!!state},show:function(node){this.__eventDispatcher.dispatchEvent("beforeShow");if(this.__canShow){node.style.display="";this.__eventDispatcher.dispatchEvent("show")}return this},hidden:function(node){this.__eventDispatcher.dispatchEvent("beforeHidden");if(this.__canHidden){node.style.display="none";this.__eventDispatcher.dispatchEvent("hidden")}return this},addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this}});Ui.DisplayObject=function(parent,node){Core.Function.defineGetter(this,["x","y","z","width","height"],[this.__getX,this.__getY,this.__getZ,this.__getWidth,this.__getHeight]);this.__renderer=null;this.__entity=node;this.__isInited=false;this.__parent=parent||document.body;this.__eventDispatcher=new Core.Events.EventDispatcher(this);var ed=this.__eventDispatcher;this.__onBeforeShow=function(){ed.dispatchEvent("beforeShow")};this.__onShow=function(){ed.dispatchEvent("show")};this.__onBeforeHidden=function(){ed.dispatchEvent("beforeHidden")};this.__onHidden=function(){ed.dispatchEvent("hidden")};this.__updateRenderer(Ui.SimpleRenderer)}.$define({isShow:!1,isHidden:!0,setPosition:function(p){!this.__isInited&&this.__initEntity();typeof p.x!=="undefined"&&(this.__entity.style.left=p.x+"px");typeof p.y!=="undefined"&&(this.__entity.style.top=p.y+"px");typeof p.z!=="undefined"&&(this.__entity.style.zIndex=p.z);return this},setSize:function(p){!this.__isInited&&this.__initEntity();typeof p.width!=="undefined"&&(this.__entity.style.width=p.width+"px");typeof p.height!=="undefined"&&(this.__entity.style.height=p.height+"px");return this},setRenderer:function(rendererConstructor){!this.__isInited&&this.__initEntity();this.__updateRenderer(rendererConstructor);return this},show:function(rendererConstructor){this.isHidden=!1;this.isShow=!0;!this.__isInited&&this.__initEntity();this.__updateRenderer(rendererConstructor);this.__renderer.show(this.__entity);return this},hidden:function(rendererConstructor){return this.hide(rendererConstructor)},hide:function(rendererConstructor){this.isHidden=!0;this.isShow=!1;!this.__isInited&&this.__initEntity();this.__updateRenderer(rendererConstructor);this.__renderer.hidden(this.__entity);return this},setCanShow:function(state){this.__renderer.setCanShow(state);return this},setCanHidden:function(state){this.__renderer.setCanHidden(state);return this},addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},destroy:function(){if(!this.__entity){return}!this.__isInited&&this.__initEntity();this.__entity.parentNode&&this.__entity.parentNode.removeChild(this.__entity);

this.__entity=null},__initEntity:function(){var st;!this.__entity&&(this.__entity=$C("div"));st=this.__entity.style;st.position="absolute";st.left=0;st.top=0;!this.__entity.parentNode&&this.__parent.appendChild(this.__entity);this.__isInited=true},__updateRenderer:function(rendererConstructor){if(!rendererConstructor){return}var addEvent=function(){this.__renderer.addEventListener("beforeShow",this.__onBeforeShow).addEventListener("show",this.__onShow).addEventListener("beforeHidden",this.__onBeforeHidden).addEventListener("hidden",this.__onHidden)};if(!this.__renderer){this.__renderer=new rendererConstructor;addEvent.call(this)}else if(this.__renderer.constructor!==rendererConstructor){this.__renderer.removeEventListener("beforeShow",this.__onBeforeShow).removeEventListener("show",this.__onShow).removeEventListener("beforeHidden",this.__onBeforeHidden).removeEventListener("hidden",this.__onHidden);this.__renderer=new rendererConstructor;addEvent.call(this)}},__getX:function(){!this.__isInited&&this.__initEntity();return parseInt(this.__entity.style.left)},__getY:function(){!this.__isInited&&this.__initEntity();return parseInt(this.__entity.style.top)},__getZ:function(){!this.__isInited&&this.__initEntity();return parseInt(this.__entity.style.zIndex)},__getWidth:function(){!this.__isInited&&this.__initEntity();return this.__getSize(this.__entity,"offsetWidth")},__getHeight:function(){!this.__isInited&&this.__initEntity();return this.__getSize(this.__entity,"offsetHeight")},__getSize:function(node,p){var et=node,v,ov=et.style.visibility;if(et.style.display=="none"){et.style.visibility="hidden";et.style.display="";v=et[p];et.style.display="none";et.style.visibility=ov}else{v=et[p]}return v}});Ui.Panel=function(parent,node){this.nodes={};this.uniqueID=this.__getUniqueID();this.entity=null;this.__iframe=null;this.__isSetAdamant=false;this.__templateNodesIDs=[];this.__isFixed=false;$IE6&&(this.__ie6FixedController=new Ui.IE6FixedController)}.$extends(Ui.DisplayObject).$define({setTemplate:function(tpl){var nd=$C("div");nd.innerHTML=new Ui.Template(tpl).evaluate(this.__getNodes(tpl,"i"));nd.style.display="none";this.__parent.appendChild(nd);this.__updateTemplate(nd);this.nodes=this.__getNodes(tpl);this.entity=this.__entity;this.nodes.panel=this.entity;return this},setFixed:function(state){!this.__isInited&&this.__initEntity();var x=parseInt(this.__entity.style.left),y=parseInt(this.__entity.style.top);if($IE6){this.__ie6FixedController.setFixed(this.__entity,state);this.__isSetAdamant&&this.__ie6FixedController.setFixed(this.__iframe,state)}else{if(state&&!this.__isFixed){this.setPosition({x:x-Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),y:y-Math.max(document.documentElement.scrollTop,document.body.scrollTop)});this.__entity.style.position="fixed"}if(!state&&this.__isFixed){this.setPosition({x:x+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),y:y+Math.max(document.documentElement.scrollTop,document.body.scrollTop)});this.__entity.style.position="absolute"}}this.__isFixed=!!state;this.__updateIframe();return this},setAdamant:function(state){this.__isSetAdamant=!!state;this.__isSetAdamant&&!this.__iframe&&this.__createIframe();this.__updateIframe();return this},destroy:function(){if(!this.__entity){return}Ui.Panel.$super.destroy.call(this);this.__ie6FixedController&&this.__ie6FixedController.destroy();this.__iframe&&this.__iframe.parentNode.removeChild(this.__iframe)},setPosition:function(p){!this.__isInited&&this.__initEntity();if($IE6){this.__ie6FixedController.setPosition(this.__entity,this.__isFixed,p)}else{Ui.Panel.$super.setPosition.call(this,p)}this.__updateIframe();return this},setSize:function(p){Ui.Panel.$super.setSize.call(this,p).__updateIframe();return this},show:function(renderer){Ui.Panel.$super.show.call(this,renderer).__updateIframe();return this},hidden:function(renderer){Ui.Panel.$super.hidden.call(this,renderer).__updateIframe();return this},__getX:function(){!this.__isInited&&this.__initEntity();if($IE6){return this.__ie6FixedController.getX(this.__entity,this.__isFixed)}else{return parseInt(this.__entity.style.left)}},__getY:function(){!this.__isInited&&this.__initEntity();if($IE6){return this.__ie6FixedController.getY(this.__entity,this.__isFixed)}else{return parseInt(this.__entity.style.top)}},__createIframe:function(){this.__iframe=$C("iframe");this.__iframe.frameBorder="none";this.__parent.insertBefore(this.__iframe,this.__entity);Core.Dom.setStyle(this.__iframe,"opacity",0);this.__ie6FixedController&&(this.__ie6FixedController.iframeNode=this.__iframe);this.__updateIframe()},__updateIframe:function(){if(this.__iframe){var st=this.__iframe.style;st.backgroundColor="#ffffff";st.left=this.x+"px";st.top=this.y+"px";st.width=this.width+"px";st.height=this.height+"px";st.position=this.__entity.style.position;st.display=this.__entity.style.display;st.zIndex=this.__entity.style.zIndex;$IE6&&this.__ie6FixedController.updateIframe(this.__isFixed)}},__updateIE6FCOrgPosition:function(){this.__ie6FixedController&&this.__ie6FixedController.updateOrgPosition()},__updateTemplate:function(nd){var l,t,z,p,d,et=this.__entity;if(et){et.parentNode&&et.parentNode.removeChild(et);l=et.style.left;t=et.style.top;z=et.style.zIndex;p=et.style.position;d=et.style.display}else{d="none"}et=this.__entity=$E("_"+this.uniqueID+"_panel");if(!et){et=this.__entity=$E("_"+this.uniqueID+"_entity")}if(!et){throw new Error("[Panel Error]there missing identifier #{panel} in panel template")}et.style.left=l||0;et.style.top=t||0;et.style.zIndex=z||0;et.style.position=p||"absolute";et.style.display=d;this.__parent.replaceChild(et,nd);this.__ie6FixedController&&(this.__ie6FixedController.node=this.__entity)},__getNodes:function(template,mode){var m=mode||"o",p=/\{[^\}]+(?=\})/g,i,nodes={},rets,r;this.__templateNodesIDs=template.match(p);rets=this.__templateNodesIDs;if(rets){i=rets.length;while(i--){r=rets[i].replace("{","");switch(m){case"o":nodes[r]=$E("_"+this.uniqueID+"_"+r);break;case"i":nodes[r]="_"+this.uniqueID+"_"+r;break}}}return nodes},__getUniqueID:function(){return parseInt(Math.random()*1e3).toString()+(new Date).getTime().toString()},setContent:function(str){this.nodes.content&&(this.nodes.content.innerHTML=str)},getNodes:function(){return this.nodes}});var WaterCopyright=Core.Class.create();WaterCopyright.prototype={initialize:function(eleId){this.layer=new Ui.Panel;this.layer.setTemplate(this.initElement());this.attachEvent(eleId)},initElement:function(){var html='\r\n		<div id="#{entity}" class="signtipLayer">\r\n	        <div class="arrow"></div>\r\n	        <div id="#{content}" class="signtipLayer_txt">'+$SYSMSG["A77776"]+"\r\n	        </div>\r\n        </div>";return html},setPosition:function(){var ele=Core.Events.getEventTarget();var left=Core.Dom.getLeft(ele)+ele.offsetWidth+5;var top=Core.Dom.getTop(ele)-8;this.layer.setPosition({x:left,y:top})},attachEvent:function(eleId){Core.Events.addEvent($E(eleId),this.show.bind2(this),"mouseover");Core.Events.addEvent($E(eleId),this.hidden.bind2(this),"mouseout")},show:function(){this.setPosition();this.layer.show()},hidden:function(){this.layer.hidden()}};(function(){var getImgStaticPath=function(pid,type){if(!pid){return""}var type=type||"orignal";try{var num=eval("0X"+pid.substring(pid.length-2))%16+1;return"http://s"+num+".sinaimg.cn/"+type+"/"+pid}catch(e){trace("图片URL计算出错！PID:"+pid);return""}};window.getImgStaticPath=getImgStaticPath})();Utils.Cookie.setCookie=function(name,value,expire,path,domain,secure){var cstr=[];cstr.push(name+"="+escape(value));if(expire){var dd=new Date;var expires=dd.getTime()+expire*36e5;dd.setTime(expires);cstr.push("expires="+dd.toGMTString())}if(path){cstr.push("path="+path)}if(domain){cstr.push("domain="+domain)}if(secure){cstr.push(secure)}document.cookie=cstr.join(";")};Utils.Json={eval:function(str){return eval("("+str+")")},flatten:function(x){var self=Utils.Json;if(x==null)return null;else if(x.constructor.toString()==String)return self.str2json(x);else if(x.constructor.toString()==Array)return self.arr2json(x);else if(x.constructor.toString()==Object)return self.obj2json(x);else if(x.constructor.toString()==Boolean)return self.bool2json(x);else if(x.constructor.toString()==Number)return self.num2json(x);else if(x.constructor.toString()==Date)return self.date2json(x);else return null},arr2json:function(x){var self=Utils.Json;var p=[];var l=x.length;var t;for(var i=0;i<l;++i){t=self.flatten(x[i]);if(t)p.push(t)}return"["+p.join(",")+"]"},obj2json:function(x){var self=Utils.Json;var p=[];var t;for(var i in x){t=self.flatten(x[i]);if(t)p.push(self.flatten(i)+":"+t)}return"{"+p.join(",")+"}"},date2json:function(x){function f(n){return n<10?"0"+n:n}return'"'+x.getFullYear()+"-"+f(x.getMonth()+1)+"-"+f(x.getDate())+"T"+f(x.getHours())+":"+f(x.getMinutes())+":"+f(x.getSeconds())+'"'},stringify:function(jsonObject){var self=Utils.Json;return self.flatten(jsonObject)},parse:function(jsonStr){return Utils.Json.eval(jsonStr)},num2json:function(x){return x?String(x):"0"},bool2json:function(x){return String(x)},str2json:function(x){var m={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(/["\\\x00-\x1f]/.test(x)){return'"'+x.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];if(c)return c;c=b.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+x+'"'}};Lib.applyIf=function(o,s,defaults){if(defaults){Lib.applyIf(o,defaults)}if(o&&s&&Lib.isObject(s)){for(var p in s){if(s.hasOwnProperty(p)&&!o[p]){o[p]=s[p]}}}return o};Lib.isObject=function(o){return Object.prototype.toString.call(o)==="[object Object]"};Lib.apply=function(o,ref,defaults,deep,original){if(defaults){Lib.applyIf(o,defaults)}for(var p in ref){if(original&&o[p]&&!Lib.isObject(o[p])){continue}if(ref.hasOwnProperty(p)){if(deep&&Lib.isObject(ref[p])){o[p]=Lib.apply(o[p]||{},ref[p],deep,original)}else{o[p]=ref[p]}}}return o};Lib.Ticket={requestTickets:[],_interface:"http://login.sina.com.cn/sso/getst.php",_setParam:function(param){var urlArray=[];urlArray.push(this._interface);var i=0;for(var name in param){if(i==0){urlArray.push("?")}else{urlArray.push("&")}urlArray.push(name);urlArray.push("=");urlArray.push(param[name]);i++}return urlArray.join("")},get:function(callbackFunc,count,entry,service){if(!callbackFunc){return}var options={success:function(){},fail:function(){}};if(typeof callbackFunc=="function"){options.success=callbackFunc}else{if(typeof callbackFunc.success=="function"){options.success=callbackFunc.success}if(typeof callbackFunc.fail=="function"){options.fail=callbackFunc.fail}}var param={};param.entry=entry||"blog";param.service=service||"tupian";param.cnt=count||20;var url=this._setParam(param);Utils.Io.JsLoad.request(url,{onComplete:function(result){var oldTickets=Lib.Ticket.requestTickets;if(result){Lib.Ticket.requestTickets=oldTickets.concat(result.ticket)}options.success(result)},onException:function(){options.fail()},timeout:3e4,charset:"UTF-8"})}};var UploadImage=Core.Class.create();UploadImage.prototype={width:310,height:30,view:"select",nodes:{relatedId:"upload_file_li",waterMarkId:"watermark",waterMarkNoticeId:"waternotice"},FLASH_ID:"uploadimageflash_",EMBED_ID:"uploadimage_",initialize:function(container,dialogName,opts){opts=opts||{};Lib.apply(this.nodes,opts.nodes,{},true);this.width=opts.width||this.width;this.height=opts.height||this.height;this.opts=opts;this.initFlashContainer(container);this.dialogName=dialogName||"imageDialog";this.initUploadFlash();if(false!==this.nodes.relatedId){this.initFlashPosition()}window.loadingList=new LoadingList;if(!opts.noMarker){Core.Events.addEvent($E(this.nodes.waterMarkId),this.waterMark.bind2(this));this.waterCopyright=new WaterCopyright(this.nodes.waterMarkNoticeId);this.initWaterMarkSelect()}this.initGetPicSizeFla()},initUploadFlash:function(){var params="uploadImage.setparams|uploadImage.error";var swf_url=$_GLOBAL.flashBasicURL+(!this.opts.flashFile?"fileuploadv6.swf?":this.opts.flashFile+"?")+Core.Math.getUniqueId();var x=Utils.Flash.swfView.Add(swf_url,this.FLASH_ID+this.id,this.EMBED_ID+this.id,this.width,this.height,"11.8","#000",{setparams:"uploadImage.setParams",isready:"uploadImageIsRead"},{scale:"showall",loop:"true",play:"true",pluginspage:"http://www.macromedia.com/go/getflashplayer",allowScriptAccess:"always",wmode:"transparent",allowFullScreen:"false",wmode:"transparent"})},initFlashContainer:function(container){this.id=Core.Math.getUniqueId();var flashContainer=$C("div");flashContainer.style.width=this.width+"px";flashContainer.style.height=this.height+"px";flashContainer.style.position="absolute";flashContainer.style.overflow="hidden";if(this.opts.zIndex){flashContainer.style.zIndex=this.opts.zIndex}flashContainer.id=this.FLASH_ID+this.id;Core.Dom.opacity(flashContainer,0);$E(container).appendChild(flashContainer)},initFlashPosition:function(){this.moveFlash()},uploadFinish:function(fileName,data,flashInfo){data=data.replace(/(<meta[\.\w\s\S\d]*\/><script[\.\w\s\S\d]*>[\.\w\s\S\d]*<\/script>)/gi,"");data=Core.String.j2o(data);if(this.opts.uploadFinish){this.opts.uploadFinish(fileName,data)}else if(data.code=="A00006"){trace(fileName+":sucsess");var imageData=data.data.pics.pic_1;this.setAllTip("finish");var isAdd=imageList.add(getImgStaticPath(imageData.pid,"square"),"upload");if(isAdd){window.loadingList.setPid(imageData.name,imageData.pid);window.loadingList.setRange(imageData.name,100)}else{window.loadingList.error(imageData.name,true,"图片已满")}}else{imageList.at++;var count=data.data.count.toString();switch(count){case"1":var imageData=data.data.pics.pic_1;var str=imageData.ret.toString();var name=imageData.name;switch(str){case"-11":window.loadingList.error(name,true,$SYSMSG["A77772"]);break;default:window.loadingList.error(name,true)}break;default:window.loadingList.error(fileName,true,$SYSMSG["A77772"])}this.setAllTip()}this.moveFlash()},error:function(code,name){try{var self=this,opts=self.opts,msg;switch(code){case"A06004":msg=$SYSMSG["A77771"];break;case"A06003":msg=$SYSMSG["A77773"];break;default:msg=$SYSMSG["A77774"]}if(opts.error){opts.error(code,name,msg)}else if(name){self.setAllTip();window.loadingList.error(name,true,msg)}else if(code!=="A00650"){self.setAllTip();window.loadingList.allError()}if(!opts.allFinish&&"A06004"===code){this.redeemPoints()}}catch(e){console.error(e.message,e.stack)}},redeemPoints:function(){var self=this;if(!parent.scope.$is_photo_vip&&parent.scope.$redeemImgBloggerDialog){parent.scope.$redeemImgBloggerDialog(function(data){var id=imageList.getIdByIndex(imageList.at);window.uploadMain.removeImage(id);scope.$token=data.token;scope.$vipsign=data.vipsign;scope.$pic_encrypt=data.pic_encrypt;self.setParams()})}},errorLog:function(msg){try{var createInput=function(name,value){var el=$C("input");el.setAttribute("name",name);el.setAttribute("value",value);el.setAttribute("type","hidden");return el};var err_log_url="http://control.blog.sina.com.cn/admin/article/ria_debug.php?timestamp="+ +new Date;var postIframe=$C("iframe"),postForm=$C("form");postIframe.id=postIframe.name="__flash_error_log"+ +new Date+parseInt(1e3*Math.random());postIframe.style.display="none";postForm.target=postIframe.name;postForm.method="POST";postForm.setAttribute("action",err_log_url);var typeEl=createInput("type","flash_err_log"),pageEl=createInput("page",scope.$PRODUCT_NAME+"_"+scope.$pageid),codeEl=createInput("code",500),descEl=createInput("desc","getTickets="+Lib.Ticket.requestTickets.join(",")+"||"+msg);postForm.appendChild(typeEl);postForm.appendChild(pageEl);postForm.appendChild(codeEl);postForm.appendChild(descEl);document.body.appendChild(postForm);document.body.appendChild(postIframe);postForm.submit();setTimeout(function(){document.body.removeChild(postForm);document.body.removeChild(postIframe)},50)}catch(e){}},selectFile:function(names){var loadFiles=names.split("|");var opts=this.opts;if(opts&&opts.selectFile){opts.selectFile(loadFiles)}else{for(var i=0;i<loadFiles.length;i++){if(imageList.eleMax-imageList.at-i>0){window.loadingList.add(imageList.getIdByIndex(imageList.at+i),loadFiles[i]);if(!imageList.isAddRemvoeFunc){imageList.addDelCallback(window.loadingList.remove.bind2(window.loadingList));imageList.isAddRemvoeFunc=true}}else{this.setAllTip("error");this.stopUpload(loadFiles[i])}}}this.setSize();this.moveFlash()},progress:function(name,num){if(num<100){window.loadingList.setRange(name,num)}},setParams:function(){try{var type="multi";if(window.imageList&&imageList.eleMax<2){type="single"}var url="http://upload.photo.sina.com.cn/interface/pic_upload.php?app=blog&s=json";if(scope.$token){url+="&token="+scope.$token}if(scope.$vipsign){url+="&vipsign="+scope.$vipsign}if(scope.$pic_encrypt){url+="&pic_encrypt="+scope.$pic_encrypt}var size="5M";if(parent.scope.$is_photo_vip){size="10M"}var params={phpurl:url,mode:type,maxsize:size,filterStr:"Images(jpg,jpeg,gif,png):*.jpg;*.jpeg;*.gif;*.png",begin:"uploadImage.selectFile",progress:"uploadImage.progress",end:"uploadImage.uploadFinish",error:"uploadImage.error",getTicket:"uploadImage.getTicket",overdue:"redo",errorLog:"uploadImage.errorLog",clickCb:"uploadImage.flashClick",allFinish:"uploadImage.allFinish",imageInfo:this.opts.imageInfo?"uploadImage.imageInfo":""};var paramsStr=Utils.Json.obj2json(params);$E(this.EMBED_ID+this.id).setParams(paramsStr)}catch(e){console.error(e.message,e.stack)}},imageInfo:function(name,width,height){this.opts.imageInfo(name,width,height)},flashClick:function(){var opts=this.opts;opts.click&&this.opts.click()},allFinish:function(total,finishFiles,cancelFiles,errorFiles){var JSON=Utils.Json;this.opts&&this.opts.allFinish(total,JSON.parse(finishFiles),JSON.parse(cancelFiles),JSON.parse(errorFiles))},waterDisabled:function(disabled){var id=this.nodes.waterMarkId;if(disabled){$E(id).disabled=true}else{$E(id).disabled=false}},setFlashSize:function(size){var ele=$E(this.FLASH_ID+this.id);var size=size||"small";switch(size){case"small":ele.style.width=60+"px";ele.style.height=25+"px";break;case"hidden":ele.style.width=1+"px";ele.style.height=1+"px";break;default:ele.style.width=this.width+"px";ele.style.height=this.height+"px"}},setSize:function(){top[this.dialogName].setSize(660,document.body.offsetHeight)},setAllTip:function(type){var html="";switch(type){case"error":html='<span class="cRed">'+imageList.eleMax+"张以后的图片已自动忽略</span>";break;case"wait":html='<span class="cGreen">添加中，请等待...</span>';break;case"finish":html='<span class="cGreen">图片已经添加完成</span>';break;default:html=""}$E("upload_image_note").innerHTML=html;this.moveFlash()},moveFlash:function(){var xy=Core.Dom.getXY($E(this.nodes.relatedId));this.setFlashPosition(xy[0]+100,xy[1])},getTicket:function(){Lib.checkAuthor();if(!$isLogin&&"editor"===top.scope.$pageid){top.winDialog.alert("您已退出登录，请先登录！");return}Lib.Ticket.get(this.ticketCallback.bind2(this),20)},ticketCallback:function(json){var ele=$E(this.EMBED_ID+this.id);if(!json||6103===parseInt(json.retcode)){top.winDialog.alert("您已退出登录，请先登录！");return}var jsonStr=Utils.Json.obj2json(json);ele.addTicket(jsonStr)},setFlashPosition:function(x,y){var flashEle=$E(this.FLASH_ID+this.id);Core.Dom.setXY(flashEle,[x,y])},stopUpload:function(name){$E(this.EMBED_ID+this.id).cancel(name)},swapGoto:function(type){var type=type||"show";if(typeof this.gotoType=="undefined"){this.gotoType="show"}if(type=="show"&&this.gotoType!="show"){$E("upload_go_on").parentNode.style.display="";this.gotoType="show";this.moveFlash()}if(type=="hidden"&&this.gotoType!="hidden"){$E("upload_go_on").parentNode.style.display="none";this.setFlashSize("hidden");this.gotoType="hidden"}},initWaterMarkSelect:function(){var id=this.nodes.waterMarkId;var ele=$E(id);var cookieValue=Utils.Cookie.getCookie("water_mark_"+scope.$uid);if(cookieValue=="1"){ele.checked=true;this.waterMark()}else{ele.checked=false}},waterMark:function(){var id=this.nodes.waterMarkId;var ele=$E(id);var url;var flashEle=$E(this.EMBED_ID+this.id);if(typeof flashEle.setMask!="undefined"){if(ele.checked){if(top.scope.$uhost&&top.scope.$uhost!=""){url="blog.sina.com.cn/"+top.scope.$uhost}else{url="blog.sina.com.cn/u/"+top.scope.$uid}flashEle.setMask(1,url);Utils.Cookie.setCookie("water_mark_"+scope.$uid,"1",999)}else{flashEle.setMask(0);Utils.Cookie.setCookie("water_mark_"+scope.$uid,"0",999)}}else{setTimeout(this.waterMark.bind2(this),50)}},initGetPicSizeFla:function(){try{var fNode=$C("div");fNode.id="GetPicSize";$E("headerTab").appendChild(fNode);var tStr="";if($TT||$360||$Maxthon){tStr="?t="+Core.Math.getRandomNumber(1,99999)}Utils.Flash.swfView.Add($_GLOBAL.flashBasicURL+"getPicSize.swf"+tStr,"GetPicSize","getPicSizeSWF","1","1","8","#ffffff",{},{allowScriptAccess:"always",wmode:"transparent"});Utils.Flash.swfView.Init();this._getPicSizeSWF=$E("getPicSizeSWF");parent.trace("获取图片大小flash加载成功！！！！！")}catch(ex){parent.trace("获取图片大小flash加载失败")}},getFlashReady:function(){parent.trace("flash回调");top.isPicFlaReady=true},getSizeStart:function(){try{$E("getPicSizeSWF").getStart()}catch(e){parent.trace("flash getStart函数不可用")}},getSize:function(url){try{this._getPicSizeSWF.getPicSize(url)}catch(e){parent.trace("flash getPicSize函数不可用")}},ImgSizeRet:function(url,obj){if(url.indexOf("photo.sina")!=-1||url.indexOf("sinaimg.cn")!=-1){var pId=url.substring(url.lastIndexOf("/")+1);pId=pId.replace(/&\d{3}/,"");parent.top.ArticleIMGFuncs.picSizeObj[pId]=obj}else{parent.top.ArticleIMGFuncs.picSizeObj[url]=obj}}};Ui.Pagination={config:{pageNode:null,nodeClassNamePrefix:"CP",curPage:1,maxPage:1,minPage:1,pageTpl:"@page@.html",type:1,showPrevNext:true,viewSize:5,dotIsPage:false,dotRate:5,showGoto:false,countTpl:"",language:"zh-cn",theme:1,showLastPage:true,showTotal:false},_list:{},_resource:{"en-us":["Pages (@data@): ","Go to First Page","Go to Previous Page (@data@)","Go to Page @data@","Go to Next Page (@data@)","Go to Last Page","Current Page in View"],"zh-cn":["共 @data@ 页","跳转至第一页","跳转至前 @data@ 页","跳转至第 @data@ 页","跳转至后 @data@ 页","跳转至最后一页","当前所在页"]},_template:'<li class="#{class}" title="#{title}">#{link}</li>',init:function(oOption){var node=$E(oOption.pageNode);if(node==null){trace("分页指定的父容器不存在");return}Ui.Pagination._list[node.id]={};var hash=Ui.Pagination._list[node.id];for(var key in this.config){hash[key]=oOption[key]===undefined?this.config[key]:oOption[key]}if(hash.type==2){hash.viewSize=4}hash.minPage=Math.min(hash.minPage,hash.maxPage)*1;hash.maxPage=Math.max(hash.minPage,hash.maxPage)*1;hash.curPage=hash.curPage>hash.maxPage?hash.minPage:hash.curPage;hash.curPage=hash.curPage*1;if(hash.curPage+hash.viewSize>=100){hash.viewSize=3}this._cache_node=hash;return this},show:function(oNode,nCurPage){nCurPage=nCurPage*1;var hash=this._cache_node;if(oNode!=null){this._cache_node=hash=Ui.Pagination._list[oNode.id];hash.curPage=nCurPage}var ambit=[];if(hash.viewSize*2+1>=hash.maxPage){ambit[1]=hash.minPage;ambit[2]=hash.maxPage}else if(hash.curPage<=hash.minPage+hash.viewSize){ambit[1]=hash.minPage;ambit[2]=hash.minPage+(hash.viewSize*2-1);ambit[3]=hash.maxPage}else if(hash.curPage>=hash.maxPage-hash.viewSize){ambit[0]=hash.minPage;ambit[1]=hash.maxPage-(hash.viewSize*2-1);ambit[2]=hash.maxPage}else{ambit[0]=hash.minPage;ambit[1]=hash.curPage-(hash.viewSize-1);ambit[2]=hash.curPage+(hash.viewSize-1);ambit[3]=hash.maxPage}var result=[];if(hash.countTpl!=null){result.push(this._createPage("","","","",hash.countTpl))}if(hash.type!=2&&hash.curPage!=hash.minPage){if(hash.type==3)result.push(this._createPage(hash.nodeClassNamePrefix+"_s_pgprev",hash.curPage-1,3,hash.curPage-1,"上页"));else result.push(this._createPage(hash.nodeClassNamePrefix+"_pgprev",hash.curPage-1,3,hash.curPage-1,"< 上一页"))}if(hash.type!=3){if(ambit[0]!=null){var str=ambit[0]==hash.curPage?this._createPage(hash.nodeClassNamePrefix+"_pgon",1,6,"",ambit[0]):this._createPage("",1,1,ambit[0],ambit[0]);result.push(str)}if(hash.type==1&&ambit[0]!=null){result.push(this._createPage(hash.nodeClassNamePrefix+"_pgelip","","","","..."))}for(var i=ambit[1];i<=ambit[2];i++){if(i==ambit[1]&&i!=hash.minPage&&hash.type==2){var LS=hash.curPage-hash.dotRate;LS=LS<hash.minPage?hash.minPage:LS;result.push(this._createPage(hash.nodeClassNamePrefix+"_pgelip",hash.viewSize+1,2,hash.curPage-hash.viewSize-1,"..."))}else if(i==ambit[2]&&i!=hash.maxPage&&hash.type==2){var RS=hash.curPage+hash.dotRate;RS=RS>hash.maxPage?hash.maxPage:RS;result.push(this._createPage(hash.nodeClassNamePrefix+"_pgelip",hash.viewSize+1,4,hash.curPage+hash.viewSize+1,"..."))}else{str=i==hash.curPage?this._createPage(hash.nodeClassNamePrefix+"_pgon",1,6,"",i):this._createPage("",i,3,i,i);result.push(str)}}if(hash.type==1&&ambit[3]!=null){result.push(this._createPage(hash.nodeClassNamePrefix+"_pgelip","","","","..."))}if(ambit[3]!=null&&hash.showLastPage){str=ambit[3]==hash.curPage?this._createPage(hash.nodeClassNamePrefix+"_pgon",hash.curPage-1,3,"",ambit[3]):this._createPage("",1,5,ambit[3],ambit[3]);result.push(str)}}else{result.push(this._createPage(hash.nodeClassNamePrefix+"_s_pgnum","","","","<strong>"+hash.curPage+"</strong>/"+hash.maxPage))}if(hash.type!=2&&hash.curPage!=hash.maxPage){if(hash.type==3)result.push(this._createPage(hash.nodeClassNamePrefix+"_s_pgnext",hash.curPage+1,3,hash.curPage+1,"下页"));else result.push(this._createPage(hash.nodeClassNamePrefix+"_pgnext",hash.curPage+1,3,hash.curPage+1,"下一页 >"))}if(hash.showTotal==true){result.push(this._createPage(hash.nodeClassNamePrefix+"_pgttl","","","","共"+hash.maxPage+"页"))}$E(hash.pageNode).innerHTML='<ul class="'+hash.nodeClassNamePrefix+'_pages">'+result.join("")+"</ul>"},_createPage:function(sClass,sTipPage,nTipIndex,nHrefPage,sHrefText){if(sHrefText==""){return""}var sTitle=sTipPage===""||nTipIndex==""?"":this._getTips(sTipPage,nTipIndex);var sLink=nHrefPage!==""?"<a "+this._getUrl(nHrefPage)+">"+sHrefText+"</a>":sHrefText;return this._template.replace(/(#\{\w+\})/g,function(a,b){switch(b){case"#{class}":return sClass;case"#{title}":return sTitle;case"#{link}":return sLink}})},showPage:function(sParentNodeID,nCurPage){this._cache_node=Ui.Pagination._list[sParentNodeID];var _autoShowPage=this._cache_node.pageTpl(nCurPage);if(_autoShowPage!=false){Ui.Pagination.show($E(sParentNodeID),nCurPage)}},_getUrl:function(idx){if(typeof this._cache_node.pageTpl=="string"){return'href="'+this._cache_node.pageTpl.replace(/@page@/,idx)+'"'}else{return"href=\"javascript:Ui.Pagination.showPage('"+this._cache_node.pageNode+"',"+idx+');"'}},_getTips:function(nPage,nIndex){return this._resource[this._cache_node.language][nIndex].replace(/@data@/g,nPage)}};Core.Array.each=function(ar,insp){var r=[];for(var i=0;i<ar.length;i++){var x=insp(ar[i],i);if(x!==null){r.push(x)}}return r};var Lib=Lib||{};(function(proxy){var Builder=function(domJson,box){this.box=null;this.domList={};this.actList={};if(box){this.box=box}else{this.box=document.createElement("DIV")}if(domJson){this.makeTree(this.box,domJson)}};(function(_p){_p.init=function(){};_p.disp=function(){};_p.NODEMAP={AREA:"MAP",CAPTION:"TABLE",COL:"TABLE|COLGROUP",COLGROUP:"TABLE",LEGEND:"FIELDSET",OPTGROUP:"SELECT",OPTION:"SELECT",PARAM:"OBJECT",TBODY:"TABLE",TD:"TR",TFOOT:"TABLE",TH:"TABLE|TR",THEAD:"TABLE",TR:"TBODY|THEAD|TH|TFOOT"};_p.create=function(tagName,attributes){var dom=null;if(tagName=="TEXT"){dom=document.createTextNode(attributes)}else{dom=document.createElement(tagName)}if(typeof attributes=="object"){for(var k in attributes){switch(k){case"class":dom.className=attributes[k];break;case"id":this.domList[attributes[k]]=dom;break;case"action":if(this.actList[attributes[k]]){this.actList[attributes[k]]=[dom].concat(this.actList[attributes[k]])}else{this.actList[attributes[k]]=dom}break;case"style":dom.style.cssText=attributes[k];break;case"innerHTML":dom.innerHTML=attributes[k];break;case"nodeValue":dom.nodeValue=attributes[k];break;default:dom.setAttribute(k,attributes[k])}}}return dom};_p.check=function(parent,childObj){var tnames=this.NODEMAP[childObj.tagName];if(this.NODEMAP[childObj.tagName]){var pList=tnames.split("|");for(var i=0,len=pList.length;i<len;i++){if(parent.tagName==pList[i]){return true}}return false}return true};_p.append=function(parent,childObj){childObj.tagName=childObj.tagName.toLocaleUpperCase();if(!this.check(parent,childObj)){return false}var returnDom=this.create(childObj.tagName,childObj.attributes);parent.appendChild(returnDom);return returnDom};_p.makeTree=function(parent,objList){for(var i=0,len=objList.length;i<len;i++){var Leaves=this.append(parent,objList[i]);if(!Leaves){alert("tree wrong!!!");return false}if(objList[i].childList&&objList[i].childList.length){this.makeTree(Leaves,objList[i].childList)}}}})(Builder.prototype);proxy.Builder=Builder;proxy.domBuilder=new Builder})(Lib);Core.Events.fixEvent=function(e){if(typeof e=="undefined")e=window.event;if(!e.target){e.target=e.srcElement;e.pageX=e.x;e.pageY=e.y}if(typeof e.layerX=="undefined")e.layerX=e.offsetX;if(typeof e.layerY=="undefined")e.layerY=e.offsetY;return e};Core.Events.getEventTarget=function(ev){ev=ev||Core.Events.getEvent();Core.Events.fixEvent(ev);return ev.target};Core.Dom.getChildrenByClass=function(el,clz){var rs=[];var cldr=el.childNodes||el.children;var clz=" "+clz+" ";var len=cldr.length;for(var i=0;i<len;++i){var o=cldr[i];var ecl=" "+o.className+" ";if(ecl.indexOf(clz)!=-1){rs[rs.length]=o}}return rs};var AlbumImage=Core.Class.create();AlbumImage.prototype={prePics:{count:0},initialize:function(){this.initAlbumPic()},initAlbumPic:function(){var url="http://control.blog.sina.com.cn/admin/myalbum/user_category_list.php";setTimeout(function(){Utils.Io.JsLoad.request(url,{onComplete:function(data,doc){if(data.code=="A00006"){var list=data.data;var t=$E("album_menu");var s=[];s.push('<li class="current" onmouseover="window.albumImage.albumListHover(this);" onclick="window.albumImage.showAlbumPics(\'0\', this);this.blur();"><a href="#" onclick="return false;">全部图片</a></li>');if(list!=null){Core.Array.each(list,function(cur){var cls="";var key=cur["sns:vid"];var title=cur["sns:title"];s.push('<li id="album_'+key+'" class="'+cls+'" onmouseover="window.albumImage.albumListHover(this);" onclick="window.albumImage.showAlbumPics(\''+key+'\', this);this.blur();" ><a href="#" onclick="return false;" title="'+title+'" >'+Core.String.shorten(title,14,"")+"</a></li>")})}t.innerHTML=s.join("\n");this.currMenu=t.firstChild;this.showCategorys()}}.bind2(this)})}.bind2(this),1);ctgKey="0";this.getAlbumPics(1)},showCategorys:function(){var ctg_id=Core.System.getParam("ctg_id");if(ctg_id){var ele=$E("album_"+ctg_id);this.showAlbumPics(ctg_id,ele);ele.blur()}},albumListHover:function(){var aListHover=function(el){el=$(el);if(el.className=="current"){return}el.className="over";el.onmouseout=function(){if(el.className=="current"){return}el.className=""}}},showAlbumPics:function(key,el){ctgKey=key;this.getAlbumPics(1);if(this.currMenu){$E(this.currMenu).className=""}var ep=$E(el);ep.className="current";this.currMenu=ep},getAlbumPics:function(pageNum){var key=ctgKey;this.currAlbum={};var url="http://control.blog.sina.com.cn/admin/myalbum/user_photo_list.php?ctg_id="+key+"&pagesize=14&p="+pageNum;setTimeout(function(){Utils.Io.JsLoad.request(url,{onComplete:function(data,doc){if(data.code=="A00006"){list=data.data;var t=$E("album_pics");t.innerHTML="";if(list.list.length<1){var tip=key==0?"你的博客图片暂无内容。":"此专辑暂无内容。";t.innerHTML="<li >"+tip+"</li>";return}if(!window.imageList.albumCallback){window.imageList.addDelCallback(window.albumImage.cancelSelect);window.imageList.albumCallback=true}Core.Array.each(list.list,function(curPic){var curPicUrl=curPic.link;var smallPicUrl=curPic["sns:link1"];var struc=$C("li");var struc_a=$C("a");var struc_a_img=$C("img");var struc_img=$C("img");struc_a.href="javascript: void(0);";struc_img.className="SG_icon SG_icon106";struc_img.align="absmiddle";struc_img.title="选中";struc_img.src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif";struc_img.width=18;struc_img.height=18;struc_a_img.src=smallPicUrl;struc_a_img.width=50;

struc_a_img.height=50;struc_a_img.alt="点击添加";struc_a.appendChild(struc_a_img);struc.appendChild(struc_a);struc.appendChild(struc_img);t.appendChild(struc);var imageListId=window.imageList.checkValue(smallPicUrl);if(imageListId!=false){struc.className="cur";struc_a_img.delId=imageListId;struc_a_img.isSelect=true}struc_a_img.onclick=function(){var ele=Core.Events.getEventTarget();if(typeof ele.isSelect=="undefined"){ele.isSelect="0"}if(ele.isSelect=="1"){window.albumImage.delPreviewPics(ele.delId);ele.parentNode.parentNode.className="";ele.isSelect="0"}else{if(imageList.at>=imageList.eleMax){if(imageList.eleMax>1){top.showError("B79006")}else{top.showError("B79005")}}var delId=window.albumImage.addPreviewPics(curPicUrl,smallPicUrl);if(delId){ele.delId=delId;ele.parentNode.parentNode.className="cur";ele.isSelect="1"}else{top.showError("B79010")}}};window.albumImage.currAlbum[curPicUrl]=struc});var maxPage=Math.ceil(list.count/14,14);if(maxPage>1){Ui.Pagination.init({pageNode:"pagingContent",nodeClassNamePrefix:"SG",curPage:pageNum,maxPage:maxPage,pageTpl:window.albumImage.getAlbumPics,type:2}).show()}else{$E("pagingContent").innerHTML=""}uploadImage.setSize()}else{$WP.errTips(data.code,"01");return}}})}.bind2(this),1)},addPreviewPics:function(url,preview){return window.imageList.add(preview,"album")},delPreviewPics:function(id){window.imageList.remove("id",id)},cancelSelect:function(id,value){var eleLis=Core.Dom.getChildrenByClass($E("album_pics"),"cur");for(var j=0;j<eleLis.length;j++){var eleImg=eleLis[j].childNodes[0].childNodes[0];if(eleImg.delId==id){eleLis[j].className="";eleImg.isSelect="0"}}}};Sina.pkg("Utils.Form");Utils.Form.inputListen=function(el,nLen,oOption){el=$E(el);if(typeof nLen!="undefined"){nLen=isNaN(nLen)?null:nLen*1}if(el==null||nLen==null||el.nodeType!=1){return false}oOption=oOption||{};var limitRe=oOption.limitRe;var doubleByte=oOption.doubleByte;doubleByte=doubleByte==null?true:doubleByte;var userinput=function(){try{var evt=Core.Events.getEvent();if(evt){var keyCode=evt.which||evt.keyCode;if(keyCode==37||keyCode==39){return false}}}catch(e){}var nLength=el.max;while(limitRe!=null&&limitRe.test(el.value)){el.value=el.value.replace(limitRe,"")}if(doubleByte==true){if(Core.String.byteLength(el.value)>nLength){var str=el.value.substr(0,nLength);while(Core.String.byteLength(str)>nLength){str=str.replace(/.$/,"")}el.value=str;el.maxLength=str.length}else{el.maxLength=nLength-el.value.replace(/[\x00-\xff]/g,"").length}}else{el.maxLength=nLength}if(nLength<el.value){el.value=el.value.substr(0,nLength)}};var Blur=function(){if(limitRe!=null&&limitRe.test(el.value)){el.value=el.value.replace(limitRe,"")}};el.max=nLen;el.maxLength=nLen;userinput();if(el.beWatched==null){el.beWatched=true;if(!$IE){Core.Events.addEvent(el,userinput,"input")}else{Core.Events.addEvent(el,userinput,"keyup");Core.Events.addEvent(el,userinput,"keypress");Core.Events.addEvent(el,userinput,"mouseout")}Core.Events.addEvent(el,Blur,"blur")}};var WebImage=Core.Class.create();WebImage.prototype={initialize:function(){Core.Events.addEvent($E("web_image_submit"),this.addImage,"click");this.buttonStatus();Utils.Form.inputListen($E("web_image_input"),400)},buttonStatus:function(){if(!imageList.isFull()){$E("web_image_submit").parentNode.className="SG_aBtn SG_aBtnB"}else{$E("web_image_submit").parentNode.className="SG_aBtn SG_aBtn_dis"}},addImage:function(){if(imageList.isFull()){return}url="http://comet.blog.sina.com.cn/api?maintype=hits&act=3&uid=00000202&varname=urlpic";Utils.Io.JsLoad.request(url,{onComplete:function(){}});var ele=$E("web_image_input");var value=ele.value.toLowerCase();if(value=="http://"||value.indexOf("http://")!=0){top.winDialog.alert($SYSMSG["A06012"],{icon:"01"});return}if(window.imageList.checkValue(value)!=false){top.winDialog.alert($SYSMSG["A06011"],{icon:"01"});return}if(!window.imageList.add(ele.value)){top.showError("B79010")}ele.value="http://"}};var PropertySet=Core.Class.create();PropertySet.prototype={initialize:function(containerId,option){if(!containerId||!$E(containerId)){return}this.containerId=containerId;this.id=Core.Math.getUniqueId();this.propertys=option.p;this.initElement(option.n);var p=Utils.Cookie.getCookie("property_set_"+this.containerId+"_"+scope.$uid);this.setProperty(p)},initElement:function(name){Core.Dom.addHTML($E(this.containerId),name+'：<span style="padding:0px;" id="pt_c_'+this.id+'"></span>')},setProperty:function(property){var htmlArr=[];var i=0;for(var name in this.propertys){if(i==0&&!property){property=name}if(name==property){htmlArr.push("<strong>"+this.propertys[name]+"</strong>")}else{htmlArr.push('<a href="#" id="ps_set_'+name+'" onclick="return false">'+this.propertys[name]+"</a>")}i++}$E("pt_c_"+this.id).innerHTML=htmlArr.join("");this.value=property;this.saveToCookie(property);this.setEvent()},saveToCookie:function(value){Utils.Cookie.setCookie("property_set_"+this.containerId+"_"+scope.$uid,value,999)},setEvent:function(){for(var name in this.propertys){var ele=$E("ps_set_"+name);if(ele){Core.Events.removeEvent(ele,Core.Function.bind3(this.setProperty,this,[name]),"click");Core.Events.addEvent(ele,Core.Function.bind3(this.setProperty,this,[name]),"click")}}}};Core.Events.stopEvent=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.cancelBubble=true;ev.returnValue=false}};if(!$IE||$IE>8){Core.Events.stopEvent=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.preventDefault();ev.stopPropagation()}}}Ui.Drag=function(captureNode,attachNodes,isDragCapureNode){var me=this;this.canDrag=true;this.isLock=false;this.lockArea={left:0,right:0,top:0,bottom:0};this.__captureNode=captureNode;this.__dragNodes=[];this.__deltaX=[];this.__deltaY=[];this.__eventDispatcher=new Core.Events.EventDispatcher(this);this.__isDraging=false;this.__canDragX=true;this.__canDragY=true;this.__dragHandle=function(){me.__drag()};this.__mouseDownHandle=function(){me.__isDraging=true;me.__eventDispatcher.dispatchEvent("beforeDrag");me.__setCapture(true)};this.__mouseUpHandle=function(){me.__isDraging&&me.__eventDispatcher.dispatchEvent("afterDrag");me.__isDraging=false;me.__setCapture(false)};this.__initNodes(captureNode,attachNodes,isDragCapureNode);this.__initCaputerNode()}.$define({addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},destroy:function(){Core.Events.removeEvent(this.__captureNode,this.__mouseDownHandle,"mousedown");Core.Events.removeEvent(document,this.__mouseUpHandle,"mouseup");this.__captureNode=null;this.__dragNodes=null},__initNodes:function(captureNode,attachNodes,isDragCapureNode){if(attachNodes){attachNodes instanceof Array?this.__dragNodes=attachNodes:this.__dragNodes.push(attachNodes);(typeof isDragCapureNode==="undefined"||isDragCapureNode)&&this.__dragNodes.push(this.__captureNode)}else{this.__dragNodes.push(this.__captureNode)}var dns=this.__dragNodes,i=dns.length;while(i--){!dns[i].style.position&&(dns[i].style.position="absolute");!dns[i].style.left&&(dns[i].style.left=0);!dns[i].style.top&&(dns[i].style.top=0)}},__initCaputerNode:function(){var cn=this.__captureNode,me=this;Core.Events.addEvent(cn,this.__mouseDownHandle,"mousedown");Core.Events.addEvent(document,this.__mouseUpHandle,"mouseup")},__setCapture:function(isCapture){var cn=this.__captureNode,dns=this.__dragNodes,evt=Core.Events.getEvent(),i=dns.length;while(i--){this.__deltaX[i]=evt.clientX-parseInt(dns[i].style.left);this.__deltaY[i]=evt.clientY-parseInt(dns[i].style.top)}if(isCapture){if($IE){cn.setCapture();Core.Events.addEvent(cn,this.__dragHandle,"mousemove")}else{Core.Events.addEvent(document,this.__dragHandle,"mousemove")}}else{if($IE){cn.releaseCapture();Core.Events.removeEvent(cn,this.__dragHandle,"mousemove")}else{Core.Events.removeEvent(document,this.__dragHandle,"mousemove")}}},__drag:function(){if(!this.canDrag){return}var dns=this.__dragNodes,evt=Core.Events.getEvent(),i=dns.length,la=this.lockArea,dX=0,dY=0;this.__eventDispatcher.dispatchEvent("drag");while(i--){dX=evt.clientX-this.__deltaX[i];dY=evt.clientY-this.__deltaY[i];if(this.isLock){dX=Math.min(Math.max(dX,la.left),la.right);dY=Math.min(Math.max(dY,la.top),la.bottom)}dns[i].style.left=dX+"px";dns[i].style.top=dY+"px"}}});Ui.IDragger={addEventListener:function(type,handle){},removeEventListener:function(type,handle){},setDrag:function(node,attachNodes,isDragCapureNode){},setLock:function(state){},setArea:function(area){},destroy:function(){}};Ui.SimpleDragger=function(){this.__drag=null;this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$implements(Ui.IDragger).$define({addEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.addEventListener(type,handle)}else{this.__drag.addEventListener(type,handle)}return this},removeEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.removeEventListener(type,handle)}else{this.__drag.removeEventListener(type,handle)}return this},setDrag:function(node,attachNode,isDragCapureNode){var me=this;this.__drag=new Ui.Drag(node,attachNode,isDragCapureNode);this.__drag.addEventListener("afterDrag",function(){me.__eventDispatcher.dispatchEvent("afterDrag")});return this},setLock:function(state){this.__drag.isLock=!!state;return this},setArea:function(area){this.__drag.lockArea=area;return this},destroy:function(){this.__drag.destroy()}});Ui.Dialog=function(parent,node){var me=this;this.__dragger=null;this.__isBindUpadateAreaEvent=false;this.__isBindUpdateIE6AreaEvent=false;this.__beforeDragHandle=function(){me.__updateDraggerArea();me.__eventDispatcher.dispatchEvent("beforedrag")};this.__dragHandle=function(){me.__isSetAdamant&&me.__updateIframe();me.__eventDispatcher.dispatchEvent("drag")};this.__afterDragHandle=function(){me.__isFixed&&$IE6&&me.__updateIE6FCOrgPosition();me.__eventDispatcher.dispatchEvent("afterdrag")};this.__updateDraggerAreaHandle=function(){setTimeout(function(){me.__updateDraggerArea()},1)};this.__setMiddleHandle=function(){me.setMiddle()}}.$extends(Ui.Panel).$define({setTemplate:function(tpl){Ui.Dialog.$super.setTemplate.call(this,tpl);this.__initTitleBar();this.setDragger(Ui.SimpleDragger);return this},setContent:function(content){if(!this.nodes.content){return this}this.nodes.content.innerHTML=new Ui.Template(content).evaluate(this.__getNodes(content,"i"));this.__addContentNodes(this.__getNodes(content));return this},setFixed:function(state){Ui.Dialog.$super.setFixed.call(this,state);if(state){Core.Events.addEvent(window,this.__setMiddleHandle,"resize")}else{Core.Events.removeEvent(window,this.__setMiddleHandle,"resize")}this.__updateDraggerArea();return this},setMiddle:function(){var areaHeight=this.__getDocumentSize().height-this.height,goldenSection=(Math.sqrt(5)-1)/2,totalSection=1,goldenSectionY=areaHeight*goldenSection/(goldenSection+totalSection),middleX=this.__getDocumentSize().width/2-this.width/2;if(!this.__isFixed){goldenSectionY+=Math.max(document.documentElement.scrollTop,document.body.scrollTop);middleX+=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft)}this.setPosition({x:Math.max(middleX,0),y:Math.max(goldenSectionY,0)});return this},setAreaLocked:function(state){if(!this.__dragger){return this}this.__dragger.setLock(state);return this},setSize:function(p){!this.__isInited&&this.__initEntity();if(this.nodes.content){typeof p.width!=="undefined"&&(this.nodes.content.style.width=p.width+"px");typeof p.height!=="undefined"&&(this.nodes.content.style.height=p.height+"px")}else{typeof p.width!=="undefined"&&(this.__entity.style.width=p.width+"px");typeof p.height!=="undefined"&&(this.__entity.style.height=p.height+"px")}return this},setDragger:function(draggerConstructor){if(!this.nodes.titleBar||!draggerConstructor){return this}if(!this.__dragger){this.__dragger=new draggerConstructor}else if(this.__dragger.constructor===draggerConstructor){return this}this.__updateDragger(draggerConstructor);return this},destroy:function(){if(!this.__entity){return}Ui.Dialog.$super.destroy.call(this);Core.Events.removeEvent(window,this.__updateDraggerAreaHandle,"resize");Core.Events.removeEvent(window,this.__setMiddleHandle,"resize")},__addContentNodes:function(nodes){var nds=this.nodes,k;for(k in nodes){nds[k]=nodes[k]}},__updateDragger:function(draggerConstructor){if(this.__dragger.constructor!==draggerConstructor){this.__dragger.removeEventListener("beforedrag",this.__beforeDragHandle).removeEventListener("drag",this.__dragHandle).removeEventListener("afterdrag",this.__afterDragHandle);this.__dragger.destroy();this.__dragger=new draggerConstructor}this.__dragger.setDrag(this.nodes.titleBar,this.__entity,false);this.__dragger.addEventListener("beforedrag",this.__beforeDragHandle).addEventListener("drag",this.__dragHandle).addEventListener("afterdrag",this.__afterDragHandle)},__updateDraggerArea:function(){var l,t,r,b;if(this.__isFixed){l=$IE6?document.documentElement.scrollLeft:0;t=$IE6?document.documentElement.scrollTop:0;r=$IE6?document.documentElement.scrollLeft+this.__getDocumentSize().width-this.width:this.__getDocumentSize().width-this.width;b=$IE6?document.documentElement.scrollTop+this.__getDocumentSize().height-this.height:this.__getDocumentSize().height-this.height}else{l=0;t=0;r=document.documentElement.scrollWidth-this.width;b=document.documentElement.scrollHeight-this.height}this.__dragger.setArea({left:l,top:t,right:r,bottom:b})},__initTitleBar:function(){if(!this.nodes.titleBar){return}var tb=this.nodes.titleBar;tb.style.cursor="move";if($IE){Core.Events.addEvent(tb,function(){return false},"selectstart")}else{tb.style.MozUserSelect="none"}},__getDocumentSize:function(){var w=document.documentElement.clientWidth||document.body.clientWidth,h=document.documentElement.clientHeight||document.body.clientHeight;return{width:w,height:h}}});Ui.ModuleDialog=function(tplConfig,iconSet,cfg){this.__bgShadow=null;this.__dialog=null;this.__isInitBgShadow=false;this.__tplConfig=tplConfig;this.__iconSet=iconSet;this.__dialogQueue=[];this.__zIndex=cfg&&cfg.zIndex||5e3;this.__cfg=cfg||{};this.__initDialogEvent()}.$define({alert:function(text,cfg){cfg=cfg||{};var dlg=this.__createMessageDialog(cfg.tplConfig||this.__tplConfig.alert,cfg);dlg.nodes.text&&(dlg.nodes.text.innerHTML=text||"");dlg.show(cfg.renderer||this.__cfg.renderer).addEventListener("hidden",function(){this.destroy()});dlg.nodes.linkOk&&dlg.nodes.linkOk.style.display!=="none"&&dlg.nodes.linkOk.focus();return dlg},newAlert:function(text,cfg,name){cfg.tplConfig=this.__tplConfig.newAlert;this.alert(text,cfg,name)},confirm:function(text,cfg){cfg=cfg||{};var dlg=this.__createMessageDialog(cfg.tplConfig||this.__tplConfig.confirm,cfg),me=this;dlg.nodes.text&&(dlg.nodes.text.innerHTML=text||"");if(dlg.nodes.btnCancel){dlg.nodes.btnCancel.innerHTML=cfg.textCancel||"取消";Core.Events.addEvent(dlg.nodes.btnCancel,function(){cfg.funcCancel&&cfg.funcCancel.call(dlg);dlg.hidden(cfg.renderer||me.__cfg.renderer);Core.Events.stopEvent()},"click");dlg.nodes.linkCancel&&Core.Events.addEvent(dlg.nodes.linkCancel,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){cfg.funcCancel&&cfg.funcCancel.call(dlg);dlg.hidden(cfg.renderer||me.__cfg.renderer)}},"keydown")}dlg.show(cfg.renderer||me.__cfg.renderer).addEventListener("hidden",function(){this.destroy()});if(cfg.defaultButton==0){dlg.nodes.linkCancel&&dlg.nodes.linkCancel.style.display!=="none"&&dlg.nodes.linkCancel.focus()}else{dlg.nodes.linkOk&&dlg.nodes.linkOk.style.display!=="none"&&dlg.nodes.linkOk.focus()}return dlg},newConfirm:function(text,cfg,name){cfg.tplConfig=this.__tplConfig.newConfirm;this.confirm(text,cfg,name)},create:function(cfg){var me=this;cfg=cfg||{};var dlg=new Ui.Dialog;dlg.setTemplate(cfg.tpl||this.__tplConfig.customs);cfg.content&&dlg.setContent(cfg.content);cfg.width&&!isNaN(cfg.width)&&dlg.setSize({width:cfg.width});cfg.height&&!isNaN(cfg.height)&&dlg.setSize({height:cfg.height});return this.__initDialog(dlg,cfg)},__initDialogEvent:function(){var queue=this.__dialogQueue;Core.Events.addEvent(document,function(){var e=Core.Events.getEvent();if(queue.length&&e.keyCode=="27"){queue[queue.length-1].hidden()}},"keydown")},__createMessageDialog:function(tpl,cfg){var dlg=new Ui.Dialog,me=this,i;dlg.setTemplate(tpl);cfg.width&&!isNaN(cfg.width)&&dlg.setSize({width:cfg.width});cfg.height&&!isNaN(cfg.height)&&dlg.setSize({height:cfg.height});dlg.nodes.subText&&(dlg.nodes.subText.innerHTML=cfg.subText||"");if(dlg.nodes.icon){dlg.nodes.icon.className=this.__iconSet[cfg.icon||"01"]["class"];dlg.nodes.icon.alt=this.__iconSet[cfg.icon||"01"]["alt"]}if(dlg.nodes.btnOk){dlg.nodes.btnOk.innerHTML=cfg.textOk||"确定";Core.Events.addEvent(dlg.nodes.btnOk,function(){dlg.hidden(cfg.renderer||me.__cfg.renderer);cfg.funcOk&&cfg.funcOk.call(dlg);Core.Events.stopEvent()},"click")}dlg.nodes.linkOk&&Core.Events.addEvent(dlg.nodes.linkOk,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){dlg.hidden(cfg.renderer||me.__cfg.renderer);cfg.funcOk&&cfg.funcOk.call(dlg)}},"keydown");dlg.setDragger(cfg.dragger||me.__cfg.dragger).setFixed(true).setAreaLocked(true);return this.__initDialog(dlg,cfg)},__initDialog:function(dlg,cfg){var me=this;cfg.zIndex&&(me.__zIndex=cfg.zIndex);dlg.nodes.titleName&&(dlg.nodes.titleName.innerHTML=cfg.title||"提示");if(dlg.nodes.btnClose){Core.Events.addEvent(dlg.nodes.btnClose,function(){var isCanHidden=true;cfg.funcBeforeClose&&(isCanHidden=cfg.funcBeforeClose.call(dlg)!==false);cfg.funcClose&&cfg.funcClose.call(dlg);isCanHidden&&dlg.hidden()},"click");Core.Events.addEvent(dlg.nodes.btnClose,function(){Core.Events.stopEvent()},"mousedown")}dlg.setPosition({z:cfg.zIndex||me.__zIndex});dlg.setRenderer(cfg.renderer||this.__cfg.renderer);dlg.setDragger(cfg.dragger||this.__cfg.dragger);dlg.setMiddle();dlg.addEventListener("beforeHidden",function(){me.__updateDialogQueue(this,"remove")});dlg.addEventListener("beforeShow",function(){this.nodes.panel.parentNode.appendChild(this.nodes.panel);var that=this;if(!me.__isInitBgShadow){me.__initBGShadow(this,cfg.isAdamant||me.__cfg.isAdamant)}me.__setBGShadowOpacity(cfg.bgShadowOpacity!==0?cfg.bgShadowOpacity||.4:cfg.bgShadowOpacity);window.setTimeout(function(){me.__bgShadow.show();me.__updateDialogQueue(that,"add")},1)});dlg.setTitle=function(title){this.nodes.titleName&&(this.nodes.titleName.innerHTML=title)};dlg.setHelp=function(url){this.nodes.btnHelp&&(this.nodes.btnHelp.href=url)};dlg.close=function(){this.hidden()};dlg.getNodes=function(){return this.nodes};dlg.getX=function(){return this.x};dlg.getY=function(){return this.y};dlg.getWidth=function(){return this.width};dlg.getHeight=function(){return this.height};return dlg},__initBGShadow:function(dlg,isAdamant){var w=this.__getDocumentSize().width,h=this.__getDocumentSize().height,me=this;this.__bgShadow=new Ui.Panel;this.__bgShadow.setTemplate('<div id="#{panel}" style="background-color:black"></div>').setSize({width:w,height:h}).setAdamant(isAdamant).setFixed(true).setPosition({x:0,y:0,z:me.__zIndex});Core.Events.addEvent(window,function(){me.__bgShadow.setPosition({x:0,y:0}).setSize({width:me.__getDocumentSize().width,height:me.__getDocumentSize().height})},"resize");this.__isInitBgShadow=true},__updateDialogQueue:function(dialog,op){var i,dlg;if(op==="add"){this.__dialogQueue.push(dialog)}else if(op==="remove"){i=this.__dialogQueue.length;while(i--){this.__dialogQueue[i]===dialog&&this.__dialogQueue.splice(i,1)}}if(this.__dialogQueue.length===0){this.__bgShadow.hidden()}else{dlg=this.__dialogQueue[this.__dialogQueue.length-1];this.__bgShadow.nodes.panel.parentNode.insertBefore(this.__bgShadow.nodes.panel,dlg.nodes.panel);this.__bgShadow.__iframe&&this.__bgShadow.__iframe.parentNode.insertBefore(this.__bgShadow.__iframe,this.__bgShadow.nodes.panel);dlg.nodes.linkOk&&dlg.nodes.linkOk.style.display!=="none"&&dlg.nodes.linkOk.focus()}},__setBGShadowOpacity:function(v){v=isNaN(v)?0:Math.max(Math.min(v,1),0);Core.Dom.setStyle(this.__bgShadow.nodes.panel,"opacity",v)},__getDocumentSize:function(){var w=document.documentElement.clientWidth||document.body.clientWidth,h=document.documentElement.clientHeight||document.body.clientHeight;return{width:w,height:h}}});Ui.Transition={simple:function(t,b,c,d){return c*t/d+b},backEaseIn:function(t,b,c,d){var s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b},backEaseOut:function(t,b,c,d){var s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},backEaseInOut:function(t,b,c,d){var s=1.70158;if((t/=d/2)<1){return c/2*(t*t*(((s*=1.525)+1)*t-s))+b}return c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b},bounceEaseOut:function(t,b,c,d){if((t/=d)<1/2.75){return c*(7.5625*t*t)+b}else if(t<2/2.75){return c*(7.5625*(t-=1.5/2.75)*t+.75)+b}else if(t<2.5/2.75){return c*(7.5625*(t-=2.25/2.75)*t+.9375)+b}else{return c*(7.5625*(t-=2.625/2.75)*t+.984375)+b}},bounceEaseIn:function(t,b,c,d){return c-Transition.bounceEaseOut(d-t,0,c,d)+b},bounceEaseInOut:function(t,b,c,d){if(t<d/2){return Transition.bounceEaseIn(t*2,0,c,d)*.5+b}else{return Transition.bounceEaseOut(t*2-d,0,c,d)*.5+c*.5+b}},regularEaseIn:function(t,b,c,d){return c*(t/=d)*t+b},regularEaseOut:function(t,b,c,d){return-c*(t/=d)*(t-2)+b},regularEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b}return-c/2*(--t*(t-2)-1)+b},strongEaseIn:function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},strongEaseOut:function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},strongEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t*t+b}return c/2*((t-=2)*t*t*t*t+2)+b},elasticEaseIn:function(t,b,c,d){var a,p;if(t==0){return b}if((t/=d)==1){return b+c}p=d*.3;if(!a||a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b},elasticEaseOut:function(t,b,c,d){var a,p;if(t==0){return b}if((t/=d)==1){return b+c}if(!p){p=d*.3}if(!a||a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b},elasticEaseInOut:function(t,b,c,d){var a,p;if(t==0){return b}if((t/=d/2)==2){return b+c}if(!p){var p=d*(.3*1.5)}if(!a||a<Math.abs(c)){var a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}if(t<1){return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b}return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b}};Ui.TweenStrategy=function(startValue,endValue,duration,motion){this.startValue=startValue||0;this.endValue=endValue||0;this.duration=duration||0;this.motion=motion||Ui.Transition.simple;this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$define({motion:null,duration:0,startValue:0,endValue:0,_itvID:0,_isTweenning:false,addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},start:function(){if(this._isTweenning){return}this._isTweenning=true;var me=this,t,sv=this.startValue,ev=this.endValue,d=this.duration,value,startTime=(new Date).getTime();this._itvID=window.setInterval(function(){t=((new Date).getTime()-startTime)/1e3;t>me.duration&&(t=me.duration);value=me.motion(t,sv,ev-sv,d);me.onTween&&me.onTween(value);me.__eventDispatcher.dispatchEvent("tween",value);t==me.duration&&me.stop()},25);return this},stop:function(){window.clearInterval(this._itvID);this._isTweenning=false;this.onEnd&&this.onEnd();this.__eventDispatcher.dispatchEvent("end");return this},onTween:function(value){},onEnd:function(){}});Ui.OpacityRenderer=function(){this.__canShow=true;this.__canHidden=true;this.__node=null;this.__tween=new Ui.TweenStrategy(0,0,.6,Ui.Transition.strongEaseOut);this.__state="";this.__lastState="";this.__value=0;this.__node=null;this.__eventDispatcher=new Core.Events.EventDispatcher(this);this.__initTweenEvent()}.$implements(Ui.IRenderer).$define({setCanShow:function(state){this.__canShow=!!state},setCanHidden:function(state){this.__canHidden=!!state},show:function(node){var tn=this.__tween;tn.stop();Core.Dom.setStyle(node,"opacity",this.__value);node.style.display="";this.__node=node;this.__state="show";this.__eventDispatcher.dispatchEvent("beforeShow");if(this.__canShow){tn.startValue=this.__value;tn.endValue=1;tn.start()}return this},hidden:function(node){var tn=this.__tween;tn.stop();this.__node=node;this.__state="hidden";this.__eventDispatcher.dispatchEvent("beforeHidden");if(this.__canHidden){tn.startValue=this.__value;tn.endValue=0;tn.start()}return this},addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},__initTweenEvent:function(){var me=this;this.__tween.addEventListener("tween",function(v){me.__value=v;Core.Dom.setStyle(me.__node,"opacity",v)});this.__tween.addEventListener("end",function(){me.__node&&me.__node.style.filter&&(me.__node.style.filter="");if(me.__state!==""&&me.__state!==me.__lastState){me.__lastState=me.__state;me.__eventDispatcher.dispatchEvent(me.__state)}me.__state==="hidden"&&(me.__node.style.display="none")})}});Ui.BorderDragger=function(){this.__drag=null;this.__isBindEvent=false;this.__border=null;this.__dragNode=null;this.__isCreated=false;this.__tweenX=new Ui.TweenStrategy(0,0,.5,Ui.Transition.strongEaseOut);this.__tweenY=new Ui.TweenStrategy(0,0,.5,Ui.Transition.strongEaseOut);this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$implements(Ui.IDragger).$define({addEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.addEventListener(type,handle)}else{this.__drag.addEventListener(type,handle)}return this},removeEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.removeEventListener(type,handle)}else{this.__drag.removeEventListener(type,handle)}return this},setDrag:function(node,attachNode,isDragCapureNode){if(!this.__isCreated){this.__createBorder(attachNode);this.__initTweenEvent(attachNode)}this.__drag=new Ui.Drag(node,this.__border,isDragCapureNode);this.__dragNode=attachNode;this.__initDragEvent();return this},setLock:function(state){this.__drag.isLock=!!state;return this},setArea:function(area){this.__drag.lockArea=area;return this},destroy:function(){this.__drag.destroy()},__createBorder:function(node){this.__border=$C("div");var st=this.__border.style;st.border="2px dashed #BCC4D0";st.position="absolute";st.display="none";st.backgroundColor="transparent";st.MozUserSelect="none";document.body.appendChild(this.__border);this.__isCreated=true},__initDragEvent:function(){if(this.__isBindEvent){return}var me=this,bst=this.__border.style,nst=this.__dragNode.style,twX=this.__tweenX,twY=this.__tweenY;this.__drag.addEventListener("beforeDrag",function(){bst.zIndex=nst.zIndex+1;bst.position=nst.position;bst.width=me.__dragNode.offsetWidth-4+"px";bst.height=me.__dragNode.offsetHeight-4+"px";bst.left=parseInt(nst.left)+"px";bst.top=parseInt(nst.top)+"px";bst.display=""});this.__drag.addEventListener("afterDrag",function(){if($IE6){nst.left=parseInt(bst.left)+"px";nst.top=parseInt(bst.top)+"px";bst.display="none";me.__eventDispatcher.dispatchEvent("afterDrag")}else{twX.startValue=parseInt(nst.left);twX.endValue=parseInt(bst.left);twY.startValue=parseInt(nst.top);twY.endValue=parseInt(bst.top);twX.start();twY.start()}});this.__isBindEvent=true},__initTweenEvent:function(node){var nst=node.style,bst=this.__border.style,me=this;this.__tweenX.addEventListener("tween",function(v){nst.left=v+"px"});this.__tweenY.addEventListener("tween",function(v){nst.top=v+"px"});this.__tweenX.addEventListener("end",function(){bst.display="none";me.__eventDispatcher.dispatchEvent("afterDrag")})}});var winDialog={};var DialogTemplate={};(function(){var dialogTemplates={alert:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示标题</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}" class="CP_layercon1">','<div class="CP_prompt">','<img id="#{icon}" class="SG_icon SG_icon201" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="50" height="50" align="absmiddle"/>','<table class="CP_w_ttl"><tr><td id="#{text}"></td></tr></table>','<div id="#{subText}" class="CP_w_cnt SG_txtb"></div>','<p class="CP_w_btns_Mid"><a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnOk}"> </cite></a></p>',"</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),newAlert:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div class="CP_layercon2 pop_v">','<div class="v_prompt">','<img id="#{icon}" class="SG_icon SG_icon148" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="20" height="20" align="absmiddle" />','<div id="#{text}" class="v_cnt SG_txtb"></div>','<div id="#{subText}"></div>','<p class="v_btns">','<a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#"><cite id="#{btnOk}">确定</cite></a>',"</p>","</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),confirm:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示标题</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}" class="CP_layercon1">','<div class="CP_prompt">','<img id="#{icon}" class="SG_icon SG_icon201" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="50" height="50" align="absmiddle"/>','<table class="CP_w_ttl"><tr><td id="#{text}"></td></tr></table>','<div id="#{subText}" class="CP_w_cnt SG_txtb"></div>','<p class="CP_w_btns">','<a  id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnOk}"></cite></a>','<a style="margin-left:5px;" id="#{linkCancel}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnCancel}"> <span id="#{cancel}"></span> </cite></a></p>',"</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),newConfirm:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div class="CP_layercon2 pop_v">','<div class="v_prompt">','<img id="#{icon}" class="SG_icon SG_icon148" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="20" height="20" align="absmiddle" />','<div id="#{text}" class="v_cnt SG_txtb"></div>','<div id="#{subText}"></div>','<p class="v_btns">','<a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#"><cite id="#{btnOk}">确定</cite></a>&nbsp;&nbsp;','<a id="#{linkCancel}" class="SG_aBtn SG_aBtnB SG_aBtn_g" href="#"><cite id="#{btnCancel}">取消</cite></a>',"</p>","</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),
customs:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}">提示标题</strong>','<cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">',"</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join("")};var iconSet={"01":{"class":"SG_icon SG_icon201",alt:"警告"},"02":{"class":"SG_icon SG_icon202",alt:"失败"},"03":{"class":"SG_icon SG_icon203",alt:"成功"},"04":{"class":"SG_icon SG_icon204",alt:"询问"},"05":{"class":"SG_icon SG_bigLoading",alt:"正在加载"},"06":{"class":"SG_icon SG_icon148",alt:"警告"}};var dialogs={};var moduleDialog=new Ui.ModuleDialog(dialogTemplates,iconSet,{renderer:Ui.OpacityRenderer,dragger:Ui.BorderDragger,isAdamant:$IE6});winDialog.create=winDialog.createCustomsDialog=function(args,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.create(args);return dialogs[name]}else{return moduleDialog.create(args)}};winDialog.alert=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.alert(text,cfg);return dialogs[name]}else{return moduleDialog.alert(text,cfg)}};winDialog.newAlert=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.newAlert(text,cfg);return dialogs[name]}else{return moduleDialog.newAlert(text,cfg)}};winDialog.confirm=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.confirm(text,cfg);return dialogs[name]}else{return moduleDialog.confirm(text,cfg)}};winDialog.newConfirm=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.newConfirm(text,cfg);return dialogs[name]}else{return moduleDialog.newConfirm(text,cfg)}};winDialog.getDialog=function(name){if(name&&typeof name==="string"){return dialogs[name]}};DialogTemplate=dialogTemplates})();$SYSMSG.extend({A00001:"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电4006900000。",A00002:"很抱歉，您的IP出现异常，请稍后再试",A00003:"无权限进行此操作，请重新登录。",A00004:"无权限进行此操作，请重新登录。",A00005:"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电4006900000。",A00006:"操作成功",A00007:"无权限进行此操作，请重新登录。",A00009:"网络繁忙，请稍后再试",A00010:"无升级权限",A11007:"你还未开通新浪博客，请先<a href='http://login.sina.com.cn/hd/reg_sec.php?entry=blog'> 开通博客</a>",A00800:"对不起，您短时间点击喜欢过多，请多休息，注意身体！感谢您对新浪博客的支持和关注！"});function showError(code,ico){var msg=$SYSMSG[code]||code;winDialog.alert(msg,{icon:ico||"01"})}$SYSMSG.extend({A06001:'<b><span class="reason green">添加中，</span>请稍候...</b>',A06002:'<span class="reason red">图片格式必须是jpg、gif、png，请重新选择。</span>',A06003:'<span class="reason red">路径错误或找不到文件，请重新选择。</span>',A06004:"<b>图片大小必须是500K以内。</b>",A06005:"<b style='color:#F00;'>添加失败，请重试。</b>",A06006:"<b>关闭操作层将导致添加失败，是否继续？</b>",A06007:"<b>离开操作层将导致上传中断，是否继续？</b>",A06008:'<span class="reason green">图片已添加成功。</span>',A06009:"<b>图片格式必须是jpg、gif、png，请重新选择。</b>",A06010:"跨域错误",A06011:"您已经添加过这张图片了...",A06012:"请输入图片的网络地址。"});Core.System.getParam=function(name){var arr=window.location.search.match(new RegExp("(\\?|&)"+name+"=([^&]*)(&|$)"));if(arr!=null)return unescape(arr[2]);return null};var UploadMain=Core.Class.create();UploadMain.prototype={initialize:function(insertFunc,max,dialogName){var max=max||20;this.insertFunc=insertFunc||function(){};this.dialogName=dialogName||"imageDialog";this.createVipLayer();this.initTab();this.setHelp("http://photo.blog.sina.com.cn/client/SinaImageUpload-2-1-7120-2009-07-13.exe");window.uploadImageIsRead=function(){if(window.uploadImage){return true}else{return false}};window.uploadImage=new UploadImage("useClient",dialogName);window.imageList=new ImageList("img_list",max,this.swapButtonStatus.bind2(this));Core.Events.addEvent($E("insert_image"),this.insertToEditor.bind2(this),"click");this.attachFuncOnClose();this.sizeSet=new PropertySet("chicun",{n:"尺寸",p:{middle:"大",bmiddle:"中",small:"小"}});this.positionSet=new PropertySet("duiqi",{n:"对齐",p:{left:"左",center:"中",right:"右"}});this.setSize();var ctg_id=Core.System.getParam("ctg_id");if(ctg_id){this.tabs.swapTags(this.albumTab)}},createVipLayer:function(){if(top.scope.$is_photo_vip){var html='<div class="errTips_l">\r\n				<p>尊敬的图片VIP用户，您好：为了方便您在博文中插入照片，我们特为您提供单张照片最大10M的VIP服务，我们期待您的更多佳作。\r\n				</p>\r\n         		</div>';var ele=Core.Dom.getElementsByClass(document.body,"div","insetPhotoContent")[0];Core.Dom.insertHTML(ele,html,"afterbegin")}},closeVipLayer:function(ele){ele.parentNode.style.display="none";this.setSize();uploadImage.moveFlash()},swapButtonStatus:function(len,type){if(len>0){$E("insert_image").title="";$E("insert_image").parentNode.className="SG_aBtn SG_aBtnB"}else{$E("insert_image").title="请先添加图片";$E("insert_image").parentNode.className="SG_aBtn SG_aBtn_dis"}this.initWeb();webImage.buttonStatus();if(type&&type!="add"){uploadImage.swapGoto()}},attachFuncOnClose:function(){var dialog=top.winDialog.getDialog(this.dialogName+"_"+top[this.dialogName].num);var btnClose=dialog.getNodes().btnClose;Core.Events.addEvent(btnClose,function(){if(imageList.at>0||uploadImage.loadingList&&uploadImage.loadingList.key.length>0){this.showConfirm()}}.bind2(this))},showConfirm:function(){top.winDialog.confirm($SYSMSG["A77775"],{funcOk:function(){},textOk:"是",textCancel:"否",funcCancel:function(){top[this.dialogName].dialog.show()}.bind2(this),defaultButton:1,title:"提示",icon:"04"})},setHelp:function(url){},initTab:function(){this.tabs=new Tabs($E("headerTab"),{});var clientTab=new Tab('<a href="javascript:void(0);">我的电脑</a>',{isFocus:true,className:"cur"});this.albumTab=new Tab('<a href="javascript:void(0);">博客图片</a>',{isFocus:false,className:"cur"});var webTab=new Tab('<a href="javascript:void(0);">网上图片</a>',{isFocus:false,className:"cur"});clientTab.addOnAbort(Core.Function.bind3(swapTab,this,["useClient","hidden"]));this.albumTab.addOnAbort(Core.Function.bind3(swapTab,this,["sinaAlbum","hidden"]));webTab.addOnAbort(Core.Function.bind3(swapTab,this,["webUrl","hidden"]));clientTab.addOnFocus(Core.Function.bind3(swapTab,this,["useClient"]));this.albumTab.addOnFocus(Core.Function.bind3(swapTab,this,["sinaAlbum"]));this.albumTab.addOnFocus(this.initAlbum);webTab.addOnFocus(Core.Function.bind3(swapTab,this,["webUrl"]));webTab.addOnFocus(this.initWeb);this.tabs.add(clientTab);this.tabs.add(this.albumTab);this.tabs.add(webTab);function swapTab(tabContentId,type){if(type&&type=="hidden"){$E(tabContentId).style.display="none"}else{$E(tabContentId).style.display="";if(tabContentId=="sinaAlbum"){$E("list_container").style.marginTop="25px"}else{$E("list_container").style.marginTop=""}if(tabContentId=="useClient"){if(!this.view!="loading"){uploadImage.initFlashPosition()}}}this.setSize();uploadImage.moveFlash()}},initAlbum:function(){if(!window.albumImage){window.albumImage=new AlbumImage}},initWeb:function(){if(!window.webImage){window.webImage=new WebImage}},insertToEditor:function(){if(imageList.at<1){return}var len=imageList.eleList.length;var imageLst=[],uplaodImageLst=[],selectImageList=[];for(var i=0;i<len;i++){if(imageList.eleList[i].value&&imageList.eleList[i].value!=""){type=imageList.eleList[i].type;if(type=="album"||type=="upload"){imageLst.push(imageList.eleList[i].value.replace(/bsquare/,"mw690"));var curPic=imageList.eleList[i].value;var pId=curPic.substring(curPic.lastIndexOf("/")+1);if(type=="album"){selectImageList.push(pId)}else{uplaodImageLst.push(pId)}}else{imageLst.push(imageList.eleList[i].value)}}}this.insertFunc(imageLst,uplaodImageLst,this.getSetObj(),selectImageList)},setSize:function(){top[this.dialogName].setSize(660,document.body.offsetHeight)},getIdByEle:function(ele){var arr=ele.id.split("_");return arr[arr.length-1]},getSetObj:function(){var obj={};obj.position=this.positionSet.value;obj.size=this.sizeSet.value;return obj},removeImage:function(id){loadingList.remove(id);imageList.remove("id",id)}};$registJob("add_template_image",function(){window.uploadMain=new UploadMain(replaceImage,1,"templateDialog");function replaceImage(imageLst,uplaodImageLst){top.ArticleIMGFuncs.replaceTemplateImage(imageLst,uplaodImageLst.join(","))}});$registJob("rssLog",function(){window.rssSendLog=function(key){v7sendLog(encodeURIComponent(key),scope.$pageid,"rssSend")}});$registJob("loginStatus",function(){Lib.checkAuthor();var _getCookie=Utils.Cookie.getCookie;var _setCookie=Utils.Cookie.setCookie;var statusUid=_getCookie("_s_loginStatus");var loginUid=_getCookie("_s_loginuid");if($isLogin){if(loginUid===$UID){return}}else{if(!statusUid||statusUid===loginUid){return}}_setCookie("_s_loginuid",$UID||statusUid,24-(new Date).getHours(),"","blog.sina.com.cn");var url="http://control.blog.sina.com.cn/blog_rebuild/riaapi/padblog/padInfo.php?rnd="+Math.random();Utils.Io.JsLoad.request(url,{onComplete:function(){},onException:function(){}})});function main(){var job=new Jobs;job.add("suda");job.add("add_template_image");job.add("rssLog");job.add("loginStatus");job.start()}function exeute(){var job=new Jobs;job.start()}