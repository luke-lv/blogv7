{ code: 'function $E(t){var e="string"==typeof t?document.getElementById(t):t;return null!=e?e:null}function $C(t){return document.createElement(t)}function $N(t){return document.getElementsByName(t)}function $T(t,e){return t.getElementsByTagName(e)}function Jobs(t){this.option=t||{},this._jobTable=[[],[],[],[]]}function v6SendLog(){}function v7sendLog(t,e,i){return t?(3==t.split("_").length&&(Lib.checkAuthor(),$isLogin&&(t+="_"+$UID)),"undefined"==typeof scope&&(window.scope={},scope.$pageid=""),e=e||scope.$pageid,i=i||"",void Utils.Io.JsLoad.request("http://hits.sinajs.cn/A2/b.html?type="+t+"&pageid="+e+"&msg="+i,{onComplete:function(){}})):!1}function setFontColor(t){window.editor.operate.setFontColor(t)}function setBackgroundColor(t){window.editor.operate.setBackgroundColor(t)}function showError(t,e){var i=$SYSMSG[t]||t;winDialog.alert(i,{icon:e||"01"})}function msnrefreshWindow(){function t(t){if(trace("has Account"),t){trace("alt:"+t);var e=$C("iframe");e.setAttribute("height",0),e.setAttribute("width",0),document.body.appendChild(e),e.src="https://login.sina.com.cn/sso/login.php?entry=blogmsn&service=blogmsn&alt="+encodeURIComponent(t)+"&savestate=7&returntype=TEXT",function(){var t=arguments.callee;return t.count||(t.count=0),t.count++>10?(trace("放弃获取SUP"),void e.parentNode.removeChild(e)):(trace("尝试获取SUP, count:"+t.count),o("SUP")?(trace("获取到 SUP"+o("SUP")),void window.location.reload()):void setTimeout(t,1e3))}()}else window.location.reload()}function e(){trace("noAccount"),window.location.href="http://blog.sina.com.cn/blog_rebuild/msn/interface/connect_user_confirm.php"}function i(t){var e=new Date;e.setTime(e.getTime()-1),document.cookie=t+"=_pass;path=/;domain=.blog.sina.com.cn;expires="+e.toGMTString()}var n=Utils.Cookie.setCookie,o=Utils.Cookie.getCookie;clearTimeout(msnRefreshTimer);var s=o("reg_token");if(!s)return trace("no token..."),void(msnRefreshTimer=setTimeout(msnrefreshWindow,1e3));trace("token find out..."),n("reg_token","","","/",".blog.sina.com.cn");var a,r,l,c=o("c_uid"),d=o("msnLinkCB"),h=o("AlT");if(n("msnLoginComeFrom",window.location.href,1,"/",".blog.sina.com.cn"),d&&(a=d.split("_"),r=a[0],l=a[1]),c==r)switch(l){case"noCid":break;case"loginError":break;case"unlink":i("msnLinkCB"),e(s);break;case"done":i("msnLinkCB"),n("loginFromMsn","msn",24,"/",".blog.sina.com.cn"),t(h,s);break;case"pass":}}function CustomsDialog(t,e){this.nodesPattern=/[^\\{\\}]+(?=\\})/g,this._dialog=DialogManager.create(t,e),this.entity=this._dialog.entity,this.templateString="",this.nodes={};var i=this;!function(){i._dialog.onDrag=function(){$IE6?this.getProperty().isFixed&&this.setPosition({x:parseInt(this.entity.style.left)-document.documentElement.scrollLeft,y:parseInt(this.entity.style.top)-document.documentElement.scrollTop}):this.getProperty().isFixed&&this.setPosition({x:parseInt(this.entity.style.left),y:parseInt(this.entity.style.top)}),i.onDrag()},i.updateNodes(),i.nodes.btnClose&&Core.Events.addEvent(i.nodes.btnClose,function(){var t=Core.Events.getEvent();t&&(t.cancelBubble=!0)},"mousedown")}(),this._hiddenDialog=function(){i.hidden()},this._closeDialog=function(){i.close()}}function main(){var t=new Jobs;t.add("tray"),t.add("suda"),t.add("publicFunc"),t.add("editor_pageInit"),t.add("editor_initOptions"),t.add("editor_initSendArticle"),t.add("editor_cate"),t.add("editor_tag"),t.add("editor_articlecate"),t.add("editor_catedialog"),t.add("loginStatus"),t.start()}"undefined"==typeof Sina&&(Sina={}),Sina.pkg=function(t){if(!t||!t.length)return null;for(var e=t.split("."),i=Sina,n="Sina"==e[0]?1:0;n<e.length;++n)i[e[n]]=i[e[n]]||{},i=i[e[n]];return i};try{document.execCommand("BackgroundImageCache",!1,!0)}catch(e){}!function(){var t=function(t,e){var i=t;return function(){return i.apply(e,arguments)}},e="Debug";(null==window[e]||"undefined"==typeof window[e].log)&&(window[e]={cacheData:[],base_url:"http://sjs.sinajs.cn/bind2/",product:scope.$PRODUCT_NAME,baseColor:{1:{color:"#FFF",bgcolor:"#E00"},2:{color:"#F00"},3:{color:"#FFF000"},4:{color:"#0F0"},5:{color:"#FFF"}},fatal:function(t){this.addData(t,1)},error:function(t){this.addData(t,2)},warning:function(t){this.addData(t,3)},info:function(t){this.addData(t,4)},log:function(t){this.addData(t,5)},dir:function(t){this.addData(t,5)},addData:function(t,e,i,n){if(null!=t){"object"!=typeof t&&(t=t.toString());var o={type:e||"5",color:i||this.baseColor[e].color,bgcolor:n||this.baseColor[e].bgcolor};this.cacheData.push([t,o]),1==this.initFinished&&this.showCurrentData([t,o])}}},window.trace=t(window[e].log,window[e]),window.traceError=t(window[e].error,window[e]))}(),Sina.pkg("Core"),"undefined"==typeof Core&&(Core=Sina.Core),Sina.pkg("Core.Array"),Core.Array.foreach=function(t,e){if(null==t&&t.constructor!=Array)return[];for(var i=0,n=t.length,o=[];n>i;){var s=e(t[i],i);null!==s&&(o[o.length]=s),i++}return o},Sina.pkg("Core.Events"),function(t){function e(t,e){var i;for(i in e)t[i]=e[i]}var i=navigator.userAgent.toLowerCase(),n={$winXP:/windows nt 5.1/.test(i),$winVista:/windows nt 6.0/.test(i),$win7:/windows nt 6.1/.test(i),$macOS:/mac/.test(i)},o={$OPERA:!1,$IE6:!1,$IE7:!1,$IE8:!1,$IE9:!1,$SAFARI:!1,$FF2:!1,$FF3:!1,$FF4:!1,$FF:!1,$CHROME:!1,$TT:!1,$360:!1,$SOGO:!1,$Maxthon:!1},s={$IE:0,$MOZ:!1,$WEBKIT:!1,$KHTML:!1};if(/opera/.test(i)||t.opera)o.$OPERA=!0;else if(/chrome\\/(\\S+)/.test(i))o.$CHROME=!0;else if(/safari\\/(\\S+)/.test(i))o.$SAFARI=!0;else if(/msie/.test(i)){s.$IE=!0,/360se/.test(i)?o.$360=!0:/tencenttraveler/.test(i)?o.$TT=!0:/se\\s\\S+\\smetasr\\s\\d+\\.\\d+/.test(i)&&(o.$SOGO=!0);var a=i.match(/msie (\\d+)/),r=parseInt(a[1]);s.$IE=r,8===r?o.$IE8=!0:6===r?o.$IE6=!0:9===r?o.$IE9=!0:7===r?o.$IE7=!0:10===r&&(o.$IE10=!0)}else if(/firefox/.test(i)){var a=i.match(/firefox\\/(\\d+)/);o.$FF=parseInt(a[1]),/firefox\\/3/.test(i)?o.$FF3=!0:/firefox\\/4/.test(i)?o.$FF4=!0:/firefox\\/2/.test(i)&&(o.$FF2=!0)}else/trident\\/7.0/.test(i)&&/rv:11.0/.test(i)&&(s.$IE=11,o.$IE11=!0);try{var l=window.external;o.$Maxthon=l.max_version?!0:!1}catch(c){}/applewebkit\\/(\\S+)/.test(i)?s.$WEBKIT=!0:/khtml\\/(\\S+)/.test(i)?s.$KHTML=!0:/rv:([^\\)]+)\\) gecko\\/\\d{8}/.test(i)&&(s.$MOZ=!0),o.$MOBILE=/mobile/i.test(i),o.$MOBILE||(o.$MOBILE=/HTC/.test(i)),e(t,o),e(t,s),e(t,n)}(window),Core.Events.addEvent=function(t,e,i,n){var o="string"==typeof t?$E(t):t;if(null==o)return void trace("addEvent 找不到对象："+t);if("undefined"==typeof n&&(n=!1),"undefined"==typeof i&&(i="click"),o.addEventListener)return"mousewheel"==i&&$FF&&(i="DOMMouseScroll"),o.addEventListener(i,e,n),!0;if(o.attachEvent){{o.attachEvent("on"+i,e)}return!0}o["on"+i]=e},Core.Events.removeEvent=function(t,e,i){var n=$E(t);return null==n?void trace("removeEvent 找不到对象："+t):void("function"==typeof e&&("undefined"==typeof i&&(i="click"),n.addEventListener?n.removeEventListener(i,e,!1):n.attachEvent&&n.detachEvent("on"+i,e),e[i]=null))},Sina.pkg("Core.Function"),Core.Function.bind3=function(t,e,i){i=null==i?[]:i;var n=t;return function(){return n.apply(e,i)}},Core.Array.findit=function(t,e){var i=-1;return Core.Array.foreach(t,function(t,n){e==t&&(i=n)}),i},window.onerror=function(t,e,i){return trace("Error occured:"+t+"<br/>file:"+e+"<br/>line:"+i+"<br/>"),!0},Jobs.prototype={_registedJobTable:{},errorMsg:[],_registJob:function(t,e){this._registedJobTable[t]=e},error:function(t){Debug.error(t),this.errorMsg.push(t)},add:function(t,e){e=e||1,-1==Core.Array.findit(this._jobTable[e],t)?this._jobTable[e].push(t):this.error("Error: Job <b>"+t+"</b> is existed now.")},start:function(){null!=this.option.onStart&&this.option.onStart();var t=(this._registedJobTable,this._jobTable[1].concat(this._jobTable[2])),e=this;this.fe=Core.Function.bind3(e.focus,e,[]);var i=function(){return 0==e._jobTable[3].length?void(null!=e.option.onEnd&&e.option.onEnd()):(Core.Events.addEvent(document.body,e.fe,"focus"),Core.Events.addEvent(window,e.fe,"scroll"),Core.Events.addEvent(document.body,e.fe,"mousemove"),void Core.Events.addEvent(document.body,e.fe,"mouseover"))};this.queue(t,i)},focus:function(){var t=this;if(this.focusdown)return Core.Events.removeEvent(document.body,t.fe,"focus"),Core.Events.removeEvent(window,t.fe,"scroll"),Core.Events.removeEvent(document.body,t.fe,"mousemove"),Core.Events.removeEvent(document.body,t.fe,"mouseover"),void(t.fe=null);this.focusdown=!0;var e=this._jobTable[3];this.queue(e,this.option.onEnd)},queue:function(t,e){var i=this,n=function(){return(new Date).valueOf()},o=this._registedJobTable,s=t.length,a=0,r=window.setInterval(function(){if(a>=s)return clearInterval(r),r=null,void(null!=e&&e());var l=t[a],c=o[l];if(a++,"undefined"==typeof c)return void i.error("<b>Job["+l+"] is undefiend!!!</b>");var d=!0,h=n();try{c.call()}catch(u){throw i.error("<b>Job["+l+"] failed!!!</b>"+u.message),null!=e&&e(),d=!1,u}finally{if(d){var p=n();Debug.info("<b>Job["+l+"] done in "+(p-h)+"ms.</b>")}}},10)},call:function(t,e){"undefined"!=typeof this._registedJobTable[t]?this._registedJobTable[t].apply(this,e):trace("<b>Job["+t+"] is undefined!!!</b>",{color:"#900",bgColor:"#FFF;"})}},$registJob=function(t,e){Jobs.prototype._registJob(t,e)},$callJob=function(t){var e=[];arguments.length>1&&(Core.Array.foreach(arguments,function(t,i){e[i]=t}),e.shift()),Jobs.prototype.call(t,e)},Sina.pkg("Utils"),"undefined"==typeof Utils&&(Utils=Sina.Utils),Sina.pkg("Utils.Io"),Utils.Io.loadCss=function(t,e){if(null==t)return!1;e=e||window;var i=e.document;t.id=t.id||"";var n;t.url?(n=i.createElement("link"),n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",t.url)):t.text&&(n=i.createElement("style"),n.setAttribute("type","text/css"),$IE?n.styleSheet.cssText=t.text:n.innerHTML=t.text),n.setAttribute("id",t.id),i.getElementsByTagName("head")[0].appendChild(n)},Sina.pkg("Core.System"),function(){var t=function(t,e){var i;try{if("undefined"!=typeof e)for(i in t)null!=e[i]&&(t[i]=e[i])}finally{return i=null,t}};Core.System.parseParam=t}(),Sina.pkg("Core.String"),Utils.Url=function(t){t=t||"",this.url=t,this.query={},this.parse()},Utils.Url.prototype={parse:function(t){t&&(this.url=t),this.parseAnchor(),this.parseParam()},parseAnchor:function(){var t=this.url.match(/\\#(.*)/);t=t?t[1]:null,this._anchor=t,null!=t&&(this.anchor=this.getNameValuePair(t),this.url=this.url.replace(/\\#.*/,""))},parseParam:function(){var t=this.url.match(/\\?([^\\?]*)/);t=t?t[1]:null,null!=t&&(this.url=this.url.replace(/\\?([^\\?]*)/,""),this.query=this.getNameValuePair(t))},getNameValuePair:function(t){var e={};return t.replace(/([^&=]*)(?:\\=([^&]*))?/gim,function(t,i,n){""!=i&&(e[i]=n||"")}),e},getParam:function(t){return this.query[t]||""},clearParam:function(){this.query={}},setParam:function(t,e){if(null==t||""==t||"string"!=typeof t)throw new Error("no param name set");this.query=this.query||{},this.query[t]=e},setParams:function(t){this.query=t},serialize:function(t){var e=[];for(var i in t)e.push(null==t[i]||""==t[i]?i+"=":i+"="+t[i]);return e.join("&")},toString:function(){var t=this.serialize(this.query);return this.url+(t.length>0?"?"+t:"")+(this.anchor?"#"+this.serialize(this.anchor):"")},getHashStr:function(t){return this.anchor?"#"+this.serialize(this.anchor):t?"#":""}},Core.String.encodeDoubleByte=function(t){return"string"!=typeof t?t:encodeURIComponent(t)},Utils.Io.JsLoad={},function(){function t(t,i){e(t,i);var n,o=t.urls,s=o.length;for(n=0;s>n;n++){var a=$C("script");a.src=o[n].url,a.charset=o[n].charset,a.onload=a.onerror=a.onreadystatechange=function(){a&&a.readyState&&"loaded"!=a.readyState&&"complete"!=a.readyState||(i.script_loaded_num++,a.onload=a.onreadystatechange=a.onerror=null,!1!==t.isRemove&&(a.src="",a.parentNode.removeChild(a)),a=null)},document.getElementsByTagName("head")[0].appendChild(a)}}function e(t,e){var i,n,o,s,a,r=t.urls,l=t.GET,c=r.length;for(i=0;c>i;i++){a=window.parseInt(1e8*Math.random()),o=new Utils.Url(r[i].url);for(n in l)1==t.noencode?o.setParam(n,l[n]):o.setParam(n,Core.String.encodeDoubleByte(l[n]));s=o.getParam("varname")||"requestId_"+a,1!=t.noreturn&&o.setParam("varname",s),e.script_var_arr.push(s),r[i].url=o.toString(),r[i].charset=r[i].charset||t.charset}}function i(e,i){var n={isRemove:!0,urls:[],charset:"utf-8",noreturn:!1,noencode:!1,timeout:-1,POST:{},GET:{},onComplete:null,onException:null},o={script_loaded_num:0,is_timeout:!1,is_loadcomplete:!1,script_var_arr:[]};n.urls="string"==typeof e?[{url:e}]:e,Core.System.parseParam(n,i),t(n,o),function(){if(1!=n.noreturn||null!=n.onComplete){var t,e=[];if(o.script_loaded_num!=n.urls.length)1!=o.is_timeout&&setTimeout(arguments.callee,50);else if(o.is_loadcomplete=!0,null!=n.onComplete){for(t=0;t<o.script_var_arr.length;t++)e.push(window[o.script_var_arr[t]]);n.onComplete(o.script_var_arr.length<2?e[0]:e)}}}(),n.timeout>0&&setTimeout(function(){1!=o.is_loadcomplete&&(null!=n.onException&&n.onException(),o.is_timeout=!0)},n.timeout)}Utils.Io.JsLoad.request=function(t,e){new i(t,e)}}(),"undefined"==typeof Lib&&(Lib={}),Lib.pkg=function(t){if(!t||!t.length)return null;for(var e=t.split("."),i=Lib,n="Lib"==e[0]?1:0;n<e.length;++n)i[e[n]]=i[e[n]]||{},i=i[e[n]];return i},Sina.pkg("Utils.Cookie"),Utils.Cookie.getCookie=function(t){t=t.replace(/([\\.\\[\\]\\$])/g,"\\\\$1");var e=new RegExp(t+"=([^;]*)?;","i"),i=document.cookie+";",n=i.match(e);return n?n[1]||"":""},Core.System.keyValue=function(t,e){var i=t.match(new RegExp("(\\\\?|&)"+e+"=([^&]*)(&|$)"));return null!=i?i[2]:null},Lib.checkAuthor=function(){var t=unescape(Utils.Cookie.getCookie("SUP"));if(t&&""!=t)$UID=Core.System.keyValue(t,"uid"),$nick=decodeURIComponent(Core.System.keyValue(t,"nick")),$isLogin=!!$UID,$isAdmin="undefined"==typeof scope.$uid?!1:scope.$uid==$UID;else if(t=Utils.Cookie.getCookie("SU"),t&&""!=t){var e=t.match(/^([^:]*:){2}(\\d{5,11})/);$UID=e&&e[2]||null,window.$isLogin=!!$UID,window.$isAdmin="undefined"==typeof scope.$uid?!1:scope.$uid==$UID}else $UID=null,$isLogin=!1,$isAdmin=!1},Lib.register=function(t,e){for(var i,n=t.split("."),o=Lib;i=n.shift();)n.length?(void 0===o[i]&&(o[i]={}),o=o[i]):void 0===o[i]&&(o[i]=e(Lib))},Lib.register("util.loadScript",function(){var t=!0,e=!1,i={},n=function(n){Utils.Io.JsLoad.request(n,{isRemove:e,noreturn:t,onComplete:function(t){i[n].isLoading=e;for(var o=i[n].cb,s=0,a=o.length;a>s;s++)o[s](t);i[n].cb=null}})};return function(e,o){var s=i[e],a=s&&s.cb;s?s.isLoading?a.push(o):o():(a=[o],s={isLoading:t,cb:a},i[e]=s,n(e,s))}}),Lib.register("sendSuda",function(t){var e="http://www.sinaimg.cn/unipro/pub/suda_s_v851c.js";return function(i){t.util.loadScript(e,i)}}),$registJob("suda",function(){function t(t,e,i,o,s){switch(n&&v7sendLog(s),t){case"index":case"indexM":v7sendLog(e);break;case"editor":v7sendLog(i);break;case"articletj":v7sendLog(o)}}var e=scope&&scope.$pageid,i=window.location.href,n=i.indexOf("tj=1")>-1,o=e&&("articletj"===e||"index"===e||"indexM"===e||"editor"===e||n);if(o)var s=encodeURIComponent(i),a=encodeURIComponent(document.referrer);if("function"==typeof _S_pSt)return void(o&&v7sendLog("42_01_03_"+(new Date).getTime()+"_"+s+"_"+a));if(o){if($isLogin)var r="42_01_01_"+$UID+"_"+(new Date).getTime()+"_"+s+"_"+a;else var r="42_01_01_"+(new Date).getTime()+"_"+s+"_"+a;t(e,"42_01_08","42_01_14",r,"42_01_05")}Lib.sendSuda(function(){try{_S_pSt("")}catch(i){}if(o){if($isLogin)var n="42_01_02_"+$UID+"_"+(new Date).getTime()+"_"+s+"_"+a;else var n="42_01_02_"+(new Date).getTime()+"_"+s+"_"+a;t(e,"42_01_09","42_01_15",n,"42_01_06")}})}),Core.Function.bind2=function(t,e){var i=t;return function(){return i.apply(e,arguments)}},Function.prototype.bind2=function(t){var e=this;return function(){return e.apply(t,arguments)}},Sina.pkg("Ui"),"undefined"==typeof Ui&&(Ui=Sina.Ui),Ui.Template=function(t){this.tmpl=t,this.pattern=/(#\\{(.*?)\\})/g},Ui.Template.prototype={evaluate:function(t){return this.tmpl.replace(this.pattern,function(){return t[arguments[2]]||""})},evaluateMulti:function(t,e){var i=[];return Core.Array.foreach(t,Core.Function.bind2(function(n,o){o=e?t.length-o:o,i[o]=this.evaluate(n)},this)),i.join("")}},Utils.Cookie.setCookie=function(t,e,i,n,o,s){var a=[];if(a.push(t+"="+escape(e)),i){var r=new Date,l=r.getTime()+36e5*i;r.setTime(l),a.push("expires="+r.toGMTString())}n&&a.push("path="+n),o&&a.push("domain="+o),s&&a.push(s),document.cookie=a.join(";")},Sina.pkg("Core.Class"),Core.Class.AsPrototype={},Core.Class.create=function(){return function(t){t!=Core.Class.AsPrototype&&this.initialize.apply(this,arguments)}},Sina.pkg("Core.Math"),Core.Math.getUniqueId=function(){return parseInt(1e4*Math.random()).toString()+(new Date).getTime().toString()},Sina.pkg("Core.Dom"),Core.Dom.addHTML=function(t,e){t.insertAdjacentHTML("beforeend",e)},$C("div").insertAdjacentHTML||(Core.Dom.addHTML=function(t,e){var i=t.ownerDocument.createRange();i.setStartBefore(t);var n=i.createContextualFragment(e);t.appendChild(n)}),Utils.UserData=Core.Class.create(),Utils.UserData.prototype={initialize:function(t){$IE&&(trace("UserData"),this.id=t||"sina_user_data",Core.Dom.addHTML(document.body,\'<img style="width: 1px; display: none;" id="\'+this.id+\'" />\'),this.setDefaultProperty())},setDefaultProperty:function(){$IE&&$E(this.id).addBehavior("#default#userData")},save:function(t,e){if($IE)try{if(0==this[t])return;if(e.length>2e4)return;var i=$E(this.id);for(var n in e)i.setAttribute(n,e[n]);i.save(t)}catch(o){traceError(o)}},load:function(t,e){if(!$IE)return{};try{var i=$E(this.id),n={};$E(this.id).load(t);for(var o=e.length,s=0;o>s;s++)n[e[s]]=i.getAttribute(e[s]||"");return this[t]=!0,n}catch(a){traceError(a)}},clear:function(t,e){if($IE)try{trace("userData.clear"),this[t]=!1;for(var i=$E(this.id),n=e.length,o=0;n>o;o++)i.setAttribute(e[o],"");i.save(t)}catch(s){traceError(s)}}},Core.Events.getEvent=function(){return window.event},(!$IE||$IE>8)&&(Core.Events.getEvent=function(){if(!$IE&&window.event)return window.event;for(var t,e=arguments.callee.caller,i=0;null!=e&&40>i;){if(t=e.arguments[0],t&&(t.constructor==Event||t.constructor==MouseEvent))return t;i++,e=e.caller}return t}),Core.Events.stopEvent=function(t){var e=t?t:Core.Events.getEvent();null!=e&&(e.cancelBubble=!0,e.returnValue=!1)},(!$IE||$IE>8)&&(Core.Events.stopEvent=function(t){var e=t?t:Core.Events.getEvent();null!=e&&(e.preventDefault(),e.stopPropagation())}),Core.Events.stopBubble=function(t){var e=t?t:Core.Events.getEvent();null!=e&&(e.cancelBubble=!0)},(!$IE||$IE>8)&&(Core.Events.stopBubble=function(t){var e=t?t:Core.Events.getEvent();null!=e&&e.stopPropagation()}),Core.Events.stopDefaultEvent=function(t){var e=t?t:Core.Events.getEvent();null!=e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},Utils.excBeforeCloseWin=function(t,e,i,n){closeVar={},closeVar.func=i,closeVar.tips1=t,closeVar.tips2=e,closeVar.args=n,closeVar.length=arguments.length,window.beforeunloadfunc=function(){function t(t){1==t&&(closeVar.args?Core.Function.bind3(closeVar.func,closeVar.func,[closeVar.args])():closeVar.func())}if(1==closeVar.length)return closeVar.tips1;if(!$IE)return t.call(this,confirm(closeVar.tips2));var e=Core.Events.fixEvent(Core.Events.getEvent());(e.clientY<0||e.altKey)&&confirm(closeVar.tips2)&&(closeVar.args?Core.Function.bind3(closeVar.func,closeVar.func,[closeVar.args])():closeVar.func())},Core.Events.addEvent(window,beforeunloadfunc,"beforeunload")},Core.Class.extend=function(t,e,i){for(var n in e)null!=i?t[n]||(t[n]=e[n]):t[n]=e[n];return t},Core.Events.fixEvent=function(t){return"undefined"==typeof t&&(t=window.event),t.target||(t.target=t.srcElement,t.pageX=t.x,t.pageY=t.y),"undefined"==typeof t.layerX&&(t.layerX=t.offsetX),"undefined"==typeof t.layerY&&(t.layerY=t.offsetY),t},Core.Events.getEventTarget=function(t){return t=t||Core.Events.getEvent(),Core.Events.fixEvent(t),t.target};var Editor={};if(Editor.AbstractBase=Core.Class.create(),Editor.AbstractBase.prototype={_id:null,_focusElementId:"",_iframeUrl:"",iframe:null,iframeWindow:null,iframeDocument:null,rangeCache:null,initialize:function(){throw new Error("Editor.AbstractBase为抽象类不能被实例化")},blur:function(){$E(this._focusElementId).focus()},execCommand:function(t,e){this.iframeWindow.focus(),this.iframeDocument.execCommand(t,"",e),this.iframeWindow.focus()},getContentHtml:function(){return this.iframeDocument.body.innerHTML},getContentText:function(){return $IE?this.iframeDocument.body.innerText:this.iframeDocument.body.textContent},selectRange:function(){this.rangeCache.select()},getFocusElement:function(){if($IE){var t=this.iframeDocument.selection.createRange();return t.item?t.item(0):t.parentElement()}var e=this.iframeWindow.getSelection(),t=e.getRangeAt(0),i=t.commonAncestorContainer;return i.tagName&&"body"==i.tagName.toLowerCase()?i:t.collapsed?i.parentNode:t.startContainer!=t.endContainer&&t.startContainer!=t.endContainer.parentNode||!t.startContainer.hasChildNodes()?i.parentNode:t.startContainer.childNodes[t.startOffset]},getRangTxt:function(t){if($IE){t&&this.selectRange();var e=this.iframeDocument.selection.createRange();return e.item?e.item(0).outerHTML:e.htmlText}var e=this.iframeWindow.getSelection().getRangeAt(0),i=e.cloneContents(),n=document.createElement("div");return n.appendChild(i),n.innerHTML},insertHTML:function(t,e){if($IE&&this.history&&this.history.add(),$IE)try{this.selectRange(),this.iframeWindow.focus();var i=this.iframeDocument.selection.createRange();if("control"==this.iframeDocument.selection.type.toLowerCase()){var n=this.iframeDocument.body.createTextRange();n.moveToElementText(i.item(0)),i=n}i.pasteHTML(t),i.collapse(!1),i.select(),this.rangeCache.save()}catch(o){}else if(this.execCommand("insertHTML",t),e){var s=this.iframeDocument.getElementById(e.id);if(s){for(var a in e.properites)s.setAttribute(a,e.properites[a]);s.removeAttribute("id")}}},_onLoadOperates:function(){if(this.loadOpartes)for(var t=this.loadOpartes.length,e=0;t>e;e++)try{this.loadOpartes[e]()}catch(i){}},_addOperateToOnload:function(t){this.loadOpartes||(this.loadOpartes=[]),this.loadOpartes.push(t)},_initIframe:function(t,e){this._id=Core.Math.getUniqueId();var i=t;i.innerHTML="",this.iframe=$C("iframe"),this.iframe.className=e,""!=this._iframeUrl&&(this.iframe.src=this._iframeUrl+"?"+Math.random()),this.iframe.setAttribute("frameborder","0",0),i.appendChild(this.iframe),this.iframeWindow=this.iframe.contentWindow,Core.Events.addEvent(this.iframe,function(){this.onload=!0,arguments.callee.down||(this.iframeDocument=this.iframeWindow.document,$IE?this.iframeDocument.body.contentEditable=!0:this.iframeDocument.designMode="on",arguments.callee.down=!0,this._onLoadOperates())}.bind2(this),"load"),""==this._iframeUrl&&(this.iframeWindow.document.open(),this.iframeWindow.document.write(this._setEditorHTML("")),this.iframeWindow.document.close())},_setEditorHTML:function(t){var e="<html></head><body>"+t+"</body></html>";return e}},Editor.AbstractStandard=Core.Class.create(),Editor.AbstractStandard.prototype={textarea:null,history:null,tools:null,operate:null,formatDoc:null,imageOperate:null,modeType:"edit",initialize:function(){throw new Error("Editor.AbstractStandard为抽象类不能被实例化")},initTextArea:function(t){this.textarea=t},swapMode:function(){this.swapShutOut(this.modeType),"edit"==this.modeType?(this.iframeDocument&&this.frameToArea(),this.iframe.parentNode.style.display="none",this.textarea.parentNode.style.display="block",this.textarea.style.display="block",this.modeType="code"):(this.iframeDocument&&this.areaToFrame(),this.textarea.parentNode.style.display="none",this.iframe.parentNode.style.display="block",this.textarea.style.display="none",this.modeType="edit")},getContentHtml:function(){return this.frameToArea(),this.textarea.value},swapShutOut:function(){},frameToArea:function(){this.textarea.parentNode.style.display="none",this.textarea.value=this.formatCode(this.iframeDocument.body.innerHTML)},areaToFrame:function(){return this.iframeDocument?void(this.iframeDocument.body.innerHTML=this.textarea.value):void setTimeout(function(){this.areaToFrame()}.bind2(this),500)},formatCode:function(t){return t=t.replace(/<(\\/?)(ul|hr|table|meta|link|tbody|tr|object|body|head|html)(|[^>]+)>\\s*/g,"\\n<$1$2$3>\\n"),t=t.replace(/\\s*<(p|h[1-6]|div|title|style|pre|script|td|li)(|[^>]+)>/g,"\\n<$1$2>"),t=t.replace(/<\\/(p|h[1-6]|div|title|style|pre|script|td|li)>\\s*/g,"</$1>\\n"),t=t.replace(/(<font)(>)/gi,"$1 size=#$2")}},Core.Class.extend(Editor.AbstractStandard.prototype,Editor.AbstractBase.prototype,!0),"undefined"==typeof Editor.Tools&&(Editor.Tools={}),"undefined"==typeof Editor.Utils&&(Editor.Utils={}),Core.Dom.getLeft=function(t){var e=0,i=$E(t);if("unknown"!=typeof i.offsetParent)for(;i.offsetParent;)e+=i.offsetLeft,i=i.offsetParent;else i.x&&(e+=i.x);return e},Core.Dom.getTop=function(t){var e=0,i=$E(t);if("unknown"!=typeof i.offsetParent)for(;i.offsetParent;)e+=i.offsetTop,i=i.offsetParent;else i.y&&(e+=i.y);return e},Core.Dom.setStyle=function(t,e,i){switch(e){case"opacity":t.style.filter="alpha(opacity="+100*i+")",t.currentStyle&&t.currentStyle.hasLayout||(t.style.zoom=1);break;case"float":e="styleFloat";default:t.style[e]=i}},$IE&&$IE<9||(Core.Dom.setStyle=function(t,e,i){"float"==e&&(e="cssFloat"),t.style[e]=i}),Editor.Utils.ShutOut=Core.Class.create(),Editor.Utils.ShutOut.prototype={initialize:function(){this.id=Core.Math.getUniqueId(),Core.Dom.addHTML(document.body,\'<div id="shut_out\'+this.id+\'" style="display:none;background:#F1F1F1;position: absolute; z-index: 1025;"></div>\')},setProperty:function(t){var e=Core.Dom.getLeft(t),i=Core.Dom.getTop(t),n=t.offsetWidth,o=t.offsetHeight;this.setPosition(e,i),this.setSize(n,o),this.setOpacity()},setOpacity:function(t){Core.Dom.setStyle($E("shut_out"+this.id),"opacity",t||.8)},setPosition:function(t,e){$E("shut_out"+this.id).style.top=e+"px",$E("shut_out"+this.id).style.left=t+"px"},setSize:function(t,e){$E("shut_out"+this.id).style.width=t+"px",$E("shut_out"+this.id).style.height=e+"px"},show:function(){$E("shut_out"+this.id).style.display="block"},hidden:function(){$E("shut_out"+this.id).style.display="none"}},Editor.Tools.Tool=Core.Class.create(),Editor.Tools.Tool.prototype={id:null,operate:null,container:null,shutOut:null,config:{},initialize:function(t,e){this.id=Core.Math.getUniqueId(),this.container=$E(t),this.config=e,this.shutOut=new Editor.Utils.ShutOut},setOperate:function(t){this.operate=t},setShutOutProperty:function(t){this.shutOut.setProperty(t||this.container.parentNode)},initElements:function(){this.temp=new Ui.Template(this.config.classTemplate);var t=this.config.tools;this.buildNods(t,this.container)},buildNods:function(t,e){for(var i in t)if(/group_/.test(i)){var n=$C("div");n.className=t[i].cls,this.buildNods(t[i].items,n),e.appendChild(n)}else{var o=this.createButton(this.temp.evaluate({operate:i,num:1}),this.operate[i]||function(){});o.id=i+"_"+this.id,o.title=t[i].title,t[i].style&&(o.style.cssText=t[i].style),t[i].inner&&(o.innerHTML=t[i].inner),e.appendChild(o)}},createButton:function(t,e){var i=$C("div");return i.className=t,i.unselectable="on",Core.Events.addEvent(i,e.bind2(this.operate),"click"),Core.Events.addEvent(i,Core.Function.bind3(this.swapButtonState,this,["in"]),"mouseover"),Core.Events.addEvent(i,Core.Function.bind3(this.swapButtonState,this,["out"]),"mouseout"),i},swapButtonState:function(t){var e=Core.Events.getEventTarget();if(!e._disabled){var i=e.className,n=i.split("_"),o=n.pop();"in"==t&&"1"==o&&(e.className=n.join("_")+"_2"),"out"==t&&"2"==o&&(e.className=n.join("_")+"_1")}},setButtonState:function(t,e){var i=$E(t+"_"+this.id),n=i.className,o=n.split("_");o.pop(),i.className=o.join("_")+"_"+e,i._disabled=!0},show:function(){this.container.parentNode.style.display=""},hidden:function(){this.container.parentNode.style.display="none"}},Editor.Utils.EditorHistory=Core.Class.create(),Editor.Utils.EditorHistory.prototype={levels:[],current:0,editor:null,initialize:function(t,e){this.editor=t,this.max=e||100},add:function(){function t(){var t={},i=e.document.body.innerHTML;return t.htmlcode=i,"Text"==e.document.selection.type&&(t.selrange=e.document.selection.createRange().getBookmark()),t}if($IE){var e=this.editor.iframeWindow;this.levels[this.current++]=t(),this.current>=this.max&&this.levels.shift(),this.current=this.levels.length}},gotoLevel:function(t){if($IE){var e=this.levels[t];if(this.editor.iframeWindow.document.body.innerHTML=e.htmlcode,e.selrange){var i=this.editor.iframeDocument.selection.createRange();i.moveToBookmark(e.selrange),i.select()}}},redo:function(){var t=this.current+1;this.levels[t]&&(this.gotoLevel(t),this.current++)},undo:function(){var t=this.current-1;this.levels[t]&&(this.gotoLevel(t),this.current--)}},Editor.Utils.RangeCache=Core.Class.create(),Editor.Utils.RangeCache.prototype={range:null,selection:null,initialize:function(t){this.editor=t},save:function(){$IE&&(this.selection=this.editor.iframeDocument.selection,this.range=this.selection.createRange())},select:function(){if($IE)if(this.range)try{this.editor.iframeDocument.focus(),this.range.select()}catch(t){this.editor.iframeDocument.focus()}else this.editor.iframeDocument.focus()},setRange:function(t){this.range=t}},Core.Dom.getStyle=function(t,e){switch(e){case"opacity":var i=100;try{i=t.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(n){try{i=t.filters("alpha").opacity}catch(n){}}return i/100;case"float":e="styleFloat";default:var o=t.currentStyle?t.currentStyle[e]:null;return t.style[e]||o}},(!$IE||$IE>8)&&(Core.Dom.getStyle=function(t,e){"float"==e&&(e="cssFloat");try{var i=document.defaultView.getComputedStyle(t,"")}catch(n){traceError(n)}return t.style[e]||i?i[e]:null}),Core.System.getScrollPos=function(t){t=t||document;var e=t.documentElement,i=t.body;return[Math.max(e.scrollTop,i.scrollTop),Math.max(e.scrollLeft,i.scrollLeft),Math.max(e.scrollWidth,i.scrollWidth),Math.max(e.scrollHeight,i.scrollHeight)]},Core.Dom.getXY=function(t){if((null==t.parentNode||null==t.offsetParent||"none"==Core.Dom.getStyle(t,"display"))&&t!=document.body)return!1;{var e;t.ownerDocument}e=t.getBoundingClientRect();var i=Core.System.getScrollPos(t.ownerDocument);return[e.left+i[1],e.top+i[0]]},$IE||(Core.Dom.getXY=function(t){if((null==t.parentNode||null==t.offsetParent||"none"==Core.Dom.getStyle(t,"display"))&&t!=document.body)return!1;{var e=null,i=[];t.ownerDocument}i=[t.offsetLeft,t.offsetTop],e=t.offsetParent;var n="absolute"==Core.Dom.getStyle(t,"position");if(e!=t)for(;e;)i[0]+=e.offsetLeft,i[1]+=e.offsetTop,$SAFARI&&!n&&"absolute"==Core.Dom.getStyle(e,"position")&&(n=!0),e=e.offsetParent;for($SAFARI&&n&&(i[0]-=t.ownerDocument.body.offsetLeft,i[1]-=t.ownerDocument.body.offsetTop),e=t.parentNode;e.tagName&&!/^body|html$/i.test(e.tagName);)Core.Dom.getStyle(e,"display").search(/^inline|table-row.*$/i)&&(i[0]-=e.scrollLeft,i[1]-=e.scrollTop),e=e.parentNode;return i}),Editor.Utils.ImageDrag=Core.Class.create(),Editor.Utils.ImageDrag.prototype={initialize:function(t){this.editor=t},drag:function(t){if($IE){var e=t.target||t.srcElement,i=null,n=null,o={},s="",a={},r={},l=Core.System.getScrollPos(this.editor.iframeDocument)[0];null==e.s&&(e.s={},e.s.w=e.offsetWidth,e.s.h=e.offsetHeight),e.onresizestart=function(){this.editor.imageOperate.hidden(),o.l=this.utils.getLeft(e),o.t=this.utils.getTop(e),o.w=e.offsetWidth,o.h=e.offsetHeight,o.nl=o.l,o.nt=o.t,o.nw=o.w,o.nh=o.h,a.x=t.x,a.y=t.y,i=$C("img"),i.src=e.src,Core.Dom.setStyle(i,"position","absolute"),Core.Dom.setStyle(i,"border","dashed black 1px"),Core.Dom.setStyle(i,"opacity","0.4"),Core.Dom.setStyle(i,"left",o.l-1),Core.Dom.setStyle(i,"top",o.t-1),Core.Dom.setStyle(i,"width",o.w+"px"),Core.Dom.setStyle(i,"height",o.h+"px"),e.insertAdjacentElement("afterEnd",i),n=$C("div"),n.innerText=o.w+" x "+o.h+" (0, 0)",Core.Dom.setStyle(n,"position","absolute"),Core.Dom.setStyle(n,"border","solid black 1px"),Core.Dom.setStyle(n,"left",t.x),Core.Dom.setStyle(n,"top",t.y),Core.Dom.setStyle(n,"width","130px"),Core.Dom.setStyle(n,"height","20px"),Core.Dom.setStyle(n,"backgroundColor","#ffffff"),Core.Dom.setStyle(n,"lineHeight","20px"),Core.Dom.setStyle(n,"textAlign","center"),Core.Dom.setStyle(n,"fontSize","12px"),i.insertAdjacentElement("afterEnd",n),s=t.x>o.l+e.offsetWidth-4?t.y+l>o.t+e.offsetHeight-4?"rb":t.y+l<o.t+4?"rt":"rm":t.x<o.l+4?t.y+l>o.t+e.offsetHeight-4?"lb":t.y+l<o.t+4?"lt":"lm":t.y+l<o.t+4?"ct":"cb"\n}.bind2(this),e.onresizeend=function(){i.removeNode(!0),n.removeNode(!0),e.s.w=o.nw,e.s.h=o.nh,Core.Dom.setStyle(e,"width",o.nw+"px"),Core.Dom.setStyle(e,"height",o.nh+"px"),this.editor.history.add()}.bind2(this),e.onresize=function(){"rb"==s?(o.nw=t.x-o.l,o.nh=Math.floor(o.nw*(e.s.h/e.s.w))):"cb"==s?o.nh=t.y-a.y+o.h:"ct"==s?(o.nh=a.y-t.y+o.h,o.nt=o.t+Math.floor(o.h-o.nh)):"rm"==s?o.nw=t.x-a.x+o.w:"lm"==s?(o.nw=a.x-t.x+o.w,o.nl=o.l+Math.floor(o.w-o.nw)):"rt"==s?(o.nw=t.x-o.l,o.nh=Math.floor(o.nw*(e.s.h/e.s.w)),o.nt=o.t+Math.floor(o.h-o.nh)):"lt"==s?(o.nw=a.x-t.x+o.w,o.nh=Math.floor(o.nw*(e.s.h/e.s.w)),o.nl=o.l+Math.floor(o.w-o.nw),o.nt=o.t+Math.floor(o.h-o.nh)):"lb"==s&&(o.nw=a.x-t.x+o.w,o.nh=Math.floor(o.nw*(e.s.h/e.s.w)),o.nl=o.l+Math.floor(o.w-o.nw)),o.nw=Math.max(o.nw,2),o.nh=Math.max(o.nh,2),isNaN(o.nw)||isNaN(o.nh)||(Core.Dom.setStyle(i,"width",o.nw+"px"),Core.Dom.setStyle(i,"height",o.nh+"px"),Core.Dom.setStyle(i,"top",o.nt-1+"px"),Core.Dom.setStyle(i,"left",o.nl-1+"px"),Core.Dom.setStyle(n,"top",t.y+"px"),Core.Dom.setStyle(n,"left",t.x+"px"),r.x=o.nw-e.s.w,r.y=o.nh-e.s.h,n.innerText=o.nw+" x "+o.nh+" ("+(r.x>0?"+":"-")+Math.abs(r.x)+","+(r.y>0?"+":"-")+Math.abs(r.y)+")")}}},utils:{getTop:function(t){var e=0,i=$E(t);if(i.offsetParent)for(;i.offsetParent&&"relative"!=i.offsetParent.style.position;)e+=i.offsetTop,i=i.offsetParent;else i.y&&(e+=i.y);return e},getLeft:function(t){var e=0,i=$E(t);if(i.offsetParent)for(;i.offsetParent&&"relative"!=i.offsetParent.style.position;)e+=i.offsetLeft,i=i.offsetParent;else i.x&&(e+=i.x);return e}}},Editor.Tools.Status=Core.Class.create(),Editor.Tools.Status.prototype={config:[],initialize:function(t,e,i){this.id=t,this.editor=e,this.config=i||["bold","italic","underline","forecolor","hilitecolor","fontsize","family"]},checkAllStatus:function(){for(var t=0;t<this.config.length;t++)this.setToolItemStatus(this.config[t])},setToolItemStatus:function(t){switch(t){case"bold":case"italic":case"underline":var e=this.editor.iframeDocument.queryCommandState(t);this.swapStatus(t,e);break;case"forecolor":var i=this.editor.getFocusElement(),n=Core.Dom.getStyle(i,"color");if(!n)break;try{Core.Dom.setStyle($E("forecolor_"+this.id),"backgroundColor",n)}catch(o){}break;case"hilitecolor":var i=this.editor.getFocusElement(),s=Core.Dom.getStyle(i,"backgroundColor");if(!s)break;"transparent"==s&&(s="#ccc");try{Core.Dom.setStyle($E("hilitecolor_"+this.id),"backgroundColor",s)}catch(o){}break;case"fontsize":var i=this.editor.getFocusElement(),a=Core.Dom.getStyle(i,"fontSize");if(!a)break;if(-1!=a.indexOf(".")||-1==a.indexOf("px"))return void(a="");1==a?a="10px":2==a?a="13px":3==a?a="16px":4==a?a="18px":5==a?a="24px":6==a?a="32px":a>=7&&(a="48px"),$IE||(a=window.parseInt(a)+"px"),$E("fontsize_"+this.id).innerHTML="<div>"+a+"</div>";break;case"family":var i=this.editor.getFocusElement(),r=Core.Dom.getStyle(i,"fontFamily");if(!r)break;r=r.split(","),r=r[0].replace(/\'|"/g,"");var l=r.split("_");l.length>0&&(r=l[0]),$E("family_"+this.id).innerHTML="<div>"+this.__getFontName(r)+"</div>";break;case"redo":break;case"undo":}},swapStatus:function(t,e){var i=$E(t+"_"+this.id),n=i.className.split("_");n.pop(),i.className=e?n.join("_")+"_3":n.join("_")+"_1"},__getFontName:function(t){var e="";switch(t.toLowerCase()){case"simsun":e="宋体";break;case"microsoft yahei":e="微软雅黑";break;default:e=t}return e}},function(){function t(t){function e(){}return e.prototype=t,new e}Function.prototype.$define=function(t){var e;for(e in t)this.prototype[e]=t[e];if(this.__interface__)for(e in this.prototype)if("NI"===this.prototype[e])throw new Error("类定义错误，接口方法["+e+"]未实现");return this.prototype.constructor=this,this.$extends=this.$define=this.$implements=function(){throw new Error("$define语句定义后面不能再作其它定义")},this},Function.prototype.$extends=function(){var e,i,n=this,o=arguments.length;if(0===o)throw new Error("$extends语句错误：未指定父类");return e=arguments[0],i=function(){e.apply(this,arguments),n.apply(this,arguments)},i.prototype=t(e.prototype),i.prototype.constructor=i,i.$super=e.prototype,i},Function.prototype.$implements=function(){for(var t,e=Array.prototype.slice.call(arguments,0),i=e.length;i--;){if("object"!=typeof e[i])throw new Error("$implements语句错误：参数必须为object类型");for(t in e[i])"undefined"==typeof this.prototype[t]&&(this.prototype[t]="NI")}return this.__interface__=!0,this.$extends=function(){throw new Error("$extends语句错误:$extends语句不能出现在$implements定义之后")},this}}(),function(){function t(t){return"string"!=typeof t&&"function"==String.prototype.slice.call(t,0,8)}function e(t,e){var i=e.call(t);return"string"==typeof i||"number"==typeof i?i:null}Core.Function.defineGetter=function(i,n,o){if(n instanceof Array&&o instanceof Array)for(var s=Math.min(n.length,o.length);s--;)"string"==typeof n[s]&&t(o[s])&&(i[n[s]]={valueOf:function(t){return function(){return e(i,o[t])}}(s),toString:this.valueOf});else"string"==typeof n&&t(o)&&(i[n]={valueOf:function(){return e(i,o)},toString:this.valueOf})}}(),Ui.IE6FixedController=function(){var t=this;this.node=null,this.iframeNode=null,this.__orgX=0,this.__orgY=0,this.__isBindScroll=!1,this.__fixedHandle=function(){t.node&&(t.node.style.left=document.documentElement.scrollLeft+t.__orgX+"px",t.node.style.top=document.documentElement.scrollTop+t.__orgY+"px"),t.iframeNode&&(t.iframeNode.style.left=t.node.style.left,t.iframeNode.style.top=t.node.style.top)}}.$define({setFixed:function(t,e){this.updateOrgPosition(),e&&!this.__isBindScroll&&(Core.Events.addEvent(window,this.__fixedHandle,"scroll"),this.__isBindScroll=!0),!e&&this.__isBindScroll&&(Core.Events.removeEvent(window,this.__fixedHandle,"scroll"),this.__isBindScroll=!1)},setPosition:function(t,e,i){"undefined"!=typeof i.x&&(e?(t.style.left=i.x+document.documentElement.scrollLeft+"px",this.__orgX=parseInt(this.node.style.left)-document.documentElement.scrollLeft):t.style.left=i.x+"px"),"undefined"!=typeof i.y&&(e?(t.style.top=i.y+document.documentElement.scrollTop+"px",this.__orgY=parseInt(this.node.style.top)-document.documentElement.scrollTop):t.style.top=i.y+"px"),"undefined"!=typeof i.z&&(t.style.zIndex=i.z)},getX:function(t,e){return e?parseInt(t.style.left)-document.documentElement.scrollLeft:parseInt(t.style.left)},getY:function(t,e){return e?parseInt(t.style.top)-document.documentElement.scrollTop:parseInt(t.style.top)},updateIframe:function(t){this.setFixed(this.iframeNode,t),t&&this.__fixedHandle()},updateOrgPosition:function(){this.node&&(this.__orgX=parseInt(this.node.style.left)-document.documentElement.scrollLeft,this.__orgY=parseInt(this.node.style.top)-document.documentElement.scrollTop)},destroy:function(){Core.Events.removeEvent(window,this.__fixedHandle,"scroll"),this.__isBindScroll=!1,this.node=null,this.iframeNode=null}}),Core.Events.EventDispatcher=function(t){this.__target=t,this.__events={}}.$define({addEventListener:function(t,e){if(this.__checkFunction(e)){var i=this.__events;t=t.toLowerCase(),!i[t]&&(i[t]=[]),i[t].push(e)}},removeEventListener:function(t,e){var i=this.__events[t];if(t=t.toLowerCase(),this.__checkFunction(e)&&i&&i.length)for(var n=i.length-1;n>=0;n--)i[n]==e&&i.splice(n,1)},dispatchEvent:function(t){t=t.toLowerCase();var e=this.__events[t];if(e&&e.length){var i=Array.prototype.slice.call(arguments,0);i.shift();for(var n=0,o=e.length;o>n;n++)e[n].apply(this.__target,i)}},__checkFunction:function(t){return"string"!=typeof t&&"function"==String.prototype.slice.call(t,0,8)}}),Ui.IRenderer={setCanShow:function(){},setCanHidden:function(){},show:function(){},hidden:function(){},addEventListener:function(){},removeEventListener:function(){}},Ui.SimpleRenderer=function(){this.__canShow=!0,this.__canHidden=!0,this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$implements(Ui.IRenderer).$define({setCanShow:function(t){this.__canShow=!!t},setCanHidden:function(t){this.__canHidden=!!t},show:function(t){return this.__eventDispatcher.dispatchEvent("beforeShow"),this.__canShow&&(t.style.display="",this.__eventDispatcher.dispatchEvent("show")),this},hidden:function(t){return this.__eventDispatcher.dispatchEvent("beforeHidden"),this.__canHidden&&(t.style.display="none",this.__eventDispatcher.dispatchEvent("hidden")),this},addEventListener:function(t,e){return this.__eventDispatcher.addEventListener(t,e),this},removeEventListener:function(t,e){return this.__eventDispatcher.removeEventListener(t,e),this}}),Ui.DisplayObject=function(t,e){Core.Function.defineGetter(this,["x","y","z","width","height"],[this.__getX,this.__getY,this.__getZ,this.__getWidth,this.__getHeight]),this.__renderer=null,this.__entity=e,this.__isInited=!1,this.__parent=t||document.body,this.__eventDispatcher=new Core.Events.EventDispatcher(this);var i=this.__eventDispatcher;this.__onBeforeShow=function(){i.dispatchEvent("beforeShow")},this.__onShow=function(){i.dispatchEvent("show")},this.__onBeforeHidden=function(){i.dispatchEvent("beforeHidden")},this.__onHidden=function(){i.dispatchEvent("hidden")},this.__updateRenderer(Ui.SimpleRenderer)}.$define({isShow:!1,isHidden:!0,setPosition:function(t){return!this.__isInited&&this.__initEntity(),"undefined"!=typeof t.x&&(this.__entity.style.left=t.x+"px"),"undefined"!=typeof t.y&&(this.__entity.style.top=t.y+"px"),"undefined"!=typeof t.z&&(this.__entity.style.zIndex=t.z),this},setSize:function(t){return!this.__isInited&&this.__initEntity(),"undefined"!=typeof t.width&&(this.__entity.style.width=t.width+"px"),"undefined"!=typeof t.height&&(this.__entity.style.height=t.height+"px"),this},setRenderer:function(t){return!this.__isInited&&this.__initEntity(),this.__updateRenderer(t),this},show:function(t){return this.isHidden=!1,this.isShow=!0,!this.__isInited&&this.__initEntity(),this.__updateRenderer(t),this.__renderer.show(this.__entity),this},hidden:function(t){return this.hide(t)},hide:function(t){return this.isHidden=!0,this.isShow=!1,!this.__isInited&&this.__initEntity(),this.__updateRenderer(t),this.__renderer.hidden(this.__entity),this},setCanShow:function(t){return this.__renderer.setCanShow(t),this},setCanHidden:function(t){return this.__renderer.setCanHidden(t),this},addEventListener:function(t,e){return this.__eventDispatcher.addEventListener(t,e),this},removeEventListener:function(t,e){return this.__eventDispatcher.removeEventListener(t,e),this},destroy:function(){this.__entity&&(!this.__isInited&&this.__initEntity(),this.__entity.parentNode&&this.__entity.parentNode.removeChild(this.__entity),this.__entity=null)},__initEntity:function(){var t;!this.__entity&&(this.__entity=$C("div")),t=this.__entity.style,t.position="absolute",t.left=0,t.top=0,!this.__entity.parentNode&&this.__parent.appendChild(this.__entity),this.__isInited=!0},__updateRenderer:function(t){if(t){var e=function(){this.__renderer.addEventListener("beforeShow",this.__onBeforeShow).addEventListener("show",this.__onShow).addEventListener("beforeHidden",this.__onBeforeHidden).addEventListener("hidden",this.__onHidden)};this.__renderer?this.__renderer.constructor!==t&&(this.__renderer.removeEventListener("beforeShow",this.__onBeforeShow).removeEventListener("show",this.__onShow).removeEventListener("beforeHidden",this.__onBeforeHidden).removeEventListener("hidden",this.__onHidden),this.__renderer=new t,e.call(this)):(this.__renderer=new t,e.call(this))}},__getX:function(){return!this.__isInited&&this.__initEntity(),parseInt(this.__entity.style.left)},__getY:function(){return!this.__isInited&&this.__initEntity(),parseInt(this.__entity.style.top)},__getZ:function(){return!this.__isInited&&this.__initEntity(),parseInt(this.__entity.style.zIndex)},__getWidth:function(){return!this.__isInited&&this.__initEntity(),this.__getSize(this.__entity,"offsetWidth")},__getHeight:function(){return!this.__isInited&&this.__initEntity(),this.__getSize(this.__entity,"offsetHeight")},__getSize:function(t,e){var i,n=t,o=n.style.visibility;return"none"==n.style.display?(n.style.visibility="hidden",n.style.display="",i=n[e],n.style.display="none",n.style.visibility=o):i=n[e],i}}),Ui.Panel=function(){this.nodes={},this.uniqueID=this.__getUniqueID(),this.entity=null,this.__iframe=null,this.__isSetAdamant=!1,this.__templateNodesIDs=[],this.__isFixed=!1,$IE6&&(this.__ie6FixedController=new Ui.IE6FixedController)}.$extends(Ui.DisplayObject).$define({setTemplate:function(t){var e=$C("div");return e.innerHTML=new Ui.Template(t).evaluate(this.__getNodes(t,"i")),e.style.display="none",this.__parent.appendChild(e),this.__updateTemplate(e),this.nodes=this.__getNodes(t),this.entity=this.__entity,this.nodes.panel=this.entity,this},setFixed:function(t){!this.__isInited&&this.__initEntity();var e=parseInt(this.__entity.style.left),i=parseInt(this.__entity.style.top);return $IE6?(this.__ie6FixedController.setFixed(this.__entity,t),this.__isSetAdamant&&this.__ie6FixedController.setFixed(this.__iframe,t)):(t&&!this.__isFixed&&(this.setPosition({x:e-Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),y:i-Math.max(document.documentElement.scrollTop,document.body.scrollTop)}),this.__entity.style.position="fixed"),!t&&this.__isFixed&&(this.setPosition({x:e+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),y:i+Math.max(document.documentElement.scrollTop,document.body.scrollTop)}),this.__entity.style.position="absolute")),this.__isFixed=!!t,this.__updateIframe(),this},setAdamant:function(t){return this.__isSetAdamant=!!t,this.__isSetAdamant&&!this.__iframe&&this.__createIframe(),this.__updateIframe(),this},destroy:function(){this.__entity&&(Ui.Panel.$super.destroy.call(this),this.__ie6FixedController&&this.__ie6FixedController.destroy(),this.__iframe&&this.__iframe.parentNode.removeChild(this.__iframe))},setPosition:function(t){return!this.__isInited&&this.__initEntity(),$IE6?this.__ie6FixedController.setPosition(this.__entity,this.__isFixed,t):Ui.Panel.$super.setPosition.call(this,t),this.__updateIframe(),this},setSize:function(t){return Ui.Panel.$super.setSize.call(this,t).__updateIframe(),this},show:function(t){return Ui.Panel.$super.show.call(this,t).__updateIframe(),this},hidden:function(t){return Ui.Panel.$super.hidden.call(this,t).__updateIframe(),this},__getX:function(){return!this.__isInited&&this.__initEntity(),$IE6?this.__ie6FixedController.getX(this.__entity,this.__isFixed):parseInt(this.__entity.style.left)},__getY:function(){return!this.__isInited&&this.__initEntity(),$IE6?this.__ie6FixedController.getY(this.__entity,this.__isFixed):parseInt(this.__entity.style.top)},__createIframe:function(){this.__iframe=$C("iframe"),this.__iframe.frameBorder="none",this.__parent.insertBefore(this.__iframe,this.__entity),Core.Dom.setStyle(this.__iframe,"opacity",0),this.__ie6FixedController&&(this.__ie6FixedController.iframeNode=this.__iframe),this.__updateIframe()},__updateIframe:function(){if(this.__iframe){var t=this.__iframe.style;t.backgroundColor="#ffffff",t.left=this.x+"px",t.top=this.y+"px",t.width=this.width+"px",t.height=this.height+"px",t.position=this.__entity.style.position,t.display=this.__entity.style.display,t.zIndex=this.__entity.style.zIndex,$IE6&&this.__ie6FixedController.updateIframe(this.__isFixed)}},__updateIE6FCOrgPosition:function(){this.__ie6FixedController&&this.__ie6FixedController.updateOrgPosition()},__updateTemplate:function(t){var e,i,n,o,s,a=this.__entity;if(a?(a.parentNode&&a.parentNode.removeChild(a),e=a.style.left,i=a.style.top,n=a.style.zIndex,o=a.style.position,s=a.style.display):s="none",a=this.__entity=$E("_"+this.uniqueID+"_panel"),a||(a=this.__entity=$E("_"+this.uniqueID+"_entity")),!a)throw new Error("[Panel Error]there missing identifier #{panel} in panel template");a.style.left=e||0,a.style.top=i||0,a.style.zIndex=n||0,a.style.position=o||"absolute",a.style.display=s,this.__parent.replaceChild(a,t),this.__ie6FixedController&&(this.__ie6FixedController.node=this.__entity)},__getNodes:function(t,e){var i,n,o,s=e||"o",a=/\\{[^\\}]+(?=\\})/g,r={};if(this.__templateNodesIDs=t.match(a),n=this.__templateNodesIDs)for(i=n.length;i--;)switch(o=n[i].replace("{",""),s){case"o":r[o]=$E("_"+this.uniqueID+"_"+o);break;case"i":r[o]="_"+this.uniqueID+"_"+o}return r},__getUniqueID:function(){return parseInt(1e3*Math.random()).toString()+(new Date).getTime().toString()},setContent:function(t){this.nodes.content&&(this.nodes.content.innerHTML=t)},getNodes:function(){return this.nodes}}),Lib.Ticket={requestTickets:[],_interface:"http://login.sina.com.cn/sso/getst.php",_setParam:function(t){var e=[];e.push(this._interface);var i=0;for(var n in t)e.push(0==i?"?":"&"),e.push(n),e.push("="),e.push(t[n]),i++;return e.join("")},get:function(t,e,i,n){if(t){var o={success:function(){},fail:function(){}};"function"==typeof t?o.success=t:("function"==typeof t.success&&(o.success=t.success),"function"==typeof t.fail&&(o.fail=t.fail));var s={};s.entry=i||"blog",s.service=n||"tupian",s.cnt=e||20;var a=this._setParam(s);Utils.Io.JsLoad.request(a,{onComplete:function(t){var e=Lib.Ticket.requestTickets;t&&(Lib.Ticket.requestTickets=e.concat(t.ticket)),o.success(t)},onException:function(){o.fail()},timeout:3e4,charset:"UTF-8"})}}},Editor.Utils.staticClass={flash_id:"image_modify_emb",userData:null,getArgs:function(t,e){switch(trace(t),t){case"ClientName":return"sinaBowen";case"PicUrl":return scope.editImage.src;case"Ticket":Lib.Ticket.get(function(t){this.setArgs(t)}.bind2(this),1);break;case"Domain":return scope.modify_flash_domain;case"UploadUrl":return"http://upload.photo.sina.com.cn/interface/pic_upload.php?app=blog&data=1&mime=image/jpeg&ticket=";case"Close":this.closeEditLayer();break;case"ReturnPicId":this.changeImg(e)}},refresh:function(){return this.userData||(this.userData=new Utils.UserData),this.userData.save("image_edit_data_"+scope.$uid,{content:editor.iframeDocument.body.innerHTML}),window.location.href=this.setParam(window.location.href,"imgEdit=1"),!1},setParam:function(){return"http://control.blog.sina.com.cn/admin/article/article_add.php?imgedit=1"},changeImg:function(){},closeEditLayer:function(){},setArgs:function(t){var e=$E(this.flash_id);try{e.setArgs("SINA_BLOG_TICKET",t.ticket[0])}catch(i){}}},Sina.pkg("Utils.Flash"),"undefined"==typeof deconcept)var deconcept=new Object;"undefined"==typeof deconcept.util&&(deconcept.util=new Object),"undefined"==typeof deconcept.SWFObjectUtil&&(deconcept.SWFObjectUtil=new Object),deconcept.SWFObject=function(t,e,i,n,o,s,a,r,l,c){if(document.getElementById){this.DETECT_KEY=c?c:"detectflash",this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY),this.params=new Object,this.variables=new Object,this.attributes=new Array,t&&this.setAttribute("swf",t),e&&this.setAttribute("id",e),i&&this.setAttribute("width",i),n&&this.setAttribute("height",n),o&&this.setAttribute("version",new deconcept.PlayerVersion(o.toString().split("."))),this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion(),!window.opera&&document.all&&this.installedVer.major>7&&(deconcept.SWFObject.doPrepUnload=!0),s&&this.addParam("bgcolor",s);var d=a?a:"high";this.addParam("quality",d),this.setAttribute("useExpressInstall",!1),this.setAttribute("doExpressInstall",!1);var h=r?r:window.location;this.setAttribute("xiRedirectUrl",h),this.setAttribute("redirectUrl",""),l&&this.setAttribute("redirectUrl",l)}},deconcept.SWFObject.prototype={useExpressInstall:function(t){this.xiSWFPath=t?t:"expressinstall.swf",this.setAttribute("useExpressInstall",!0)},setAttribute:function(t,e){this.attributes[t]=e},getAttribute:function(t){return this.attributes[t]},addParam:function(t,e){this.params[t]=e},getParams:function(){return this.params},addVariable:function(t,e){this.variables[t]=e},getVariable:function(t){return this.variables[t]},getVariables:function(){return this.variables},getVariablePairs:function(){var t,e=new Array,i=this.getVariables();for(t in i)e[e.length]=t+"="+i[t];return e},getSWFHTML:function(){var t="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){this.getAttribute("doExpressInstall")&&(this.addVariable("MMplayerType","PlugIn"),this.setAttribute("swf",this.xiSWFPath)),t=\'<embed pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" src="\'+this.getAttribute("swf")+\'" width="\'+this.getAttribute("width")+\'" height="\'+this.getAttribute("height")+\'" style="\'+this.getAttribute("style")+\'"\',t+=\' id="\'+this.getAttribute("id")+\'" name="\'+this.getAttribute("id")+\'" \';var e=this.getParams();for(var i in e)t+=[i]+\'="\'+e[i]+\'" \';var n=this.getVariablePairs().join("&");n.length>0&&(t+="flashvars="+n+\'&realfull=1&moz=1"\'),t+="/>"}else{this.getAttribute("doExpressInstall")&&(this.addVariable("MMplayerType","ActiveX"),this.setAttribute("swf",this.xiSWFPath)),t=\'<object id="\'+this.getAttribute("id")+\'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0" width="\'+this.getAttribute("width")+\'" height="\'+this.getAttribute("height")+\'" style="\'+this.getAttribute("style")+\'">\',t+=\'<param name="movie" value="\'+this.getAttribute("swf")+\'" />\';var e=this.getParams();for(var i in e)t+=\'<param name="\'+i+\'" value="\'+e[i]+\'" />\';var n=this.getVariablePairs().join("&");n.length>0&&(t+=\'<param name="flashvars" value="\'+n+\'" />\'),t+="</object>"}return t},write:function(t){if(this.getAttribute("useExpressInstall")){var e=new deconcept.PlayerVersion([6,0,65]);this.installedVer.versionIsValid(e)&&!this.installedVer.versionIsValid(this.getAttribute("version"))&&(this.setAttribute("doExpressInstall",!0),this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl"))),document.title=document.title.slice(0,47)+" - Flash Player Installation",this.addVariable("MMdoctitle",document.title))}this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))||""!=this.getAttribute("redirectUrl")&&document.location.replace(this.getAttribute("redirectUrl"));var i="string"==typeof t?document.getElementById(t):t,n=document.title;return i.innerHTML=this.getSWFHTML(),n!==document.title&&(document.title=n),!0}},deconcept.SWFObjectUtil.getPlayerVersion=function(){var t=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var e=navigator.plugins["Shockwave Flash"];e&&e.description&&(t=new deconcept.PlayerVersion(e.description.replace(/([a-zA-Z]|\\s)+/,"").replace(/(\\s+r|\\s+b[0-9]+)/,".").split(".")))}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0)for(var i=1,n=3;i;)try{n++,i=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+n),t=new deconcept.PlayerVersion([n,0,0])}catch(o){i=null}else{try{var i=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(o){try{var i=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");t=new deconcept.PlayerVersion([6,0,21]),i.AllowScriptAccess="always"}catch(o){if(6==t.major)return t}try{i=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(o){}}null!=i&&(t=new deconcept.PlayerVersion(i.GetVariable("$version").split(" ")[1].split(",")))}return t},deconcept.PlayerVersion=function(t){this.major=null!=t[0]?parseInt(t[0]):0,this.minor=null!=t[1]?parseInt(t[1]):0,this.rev=null!=t[2]?parseInt(t[2]):0},deconcept.PlayerVersion.prototype.versionIsValid=function(t){return this.major<t.major?!1:this.major>t.major?!0:this.minor<t.minor?!1:this.minor>t.minor?!0:this.rev<t.rev?!1:!0},deconcept.util={getRequestParameter:function(t){var e=document.location.search||document.location.hash;if(null==t)return e;if(e)for(var i=e.substring(1).split("&"),n=0;n<i.length;n++)if(i[n].substring(0,i[n].indexOf("="))==t)return i[n].substring(i[n].indexOf("=")+1);return""}},deconcept.SWFObjectUtil.cleanupSWFs=function(){for(var t=document.getElementsByTagName("OBJECT"),e=t.length-1;e>=0;e--){t[e].style.display="none";for(var i in t[e])"function"==typeof t[e][i]&&(t[e][i]=function(){})}},deconcept.SWFObject.doPrepUnload&&(deconcept.unloadSet||(deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){},__flash_savedUnloadHandler=function(){},window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs)},window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload),deconcept.unloadSet=!0)),!document.getElementById&&document.all&&(document.getElementById=function(t){return document.all[t]});var getQueryParamValue=deconcept.util.getRequestParameter,FlashObject=deconcept.SWFObject;Utils.Flash.swfObject=deconcept.SWFObject,Editor.Utils.Modify=Core.Class.create(),Editor.Utils.Modify.prototype={_getFlashUrl:"http://www.picself.cn/GetPicselfUrl.php",_flashUrl:"",_dFlashUrl:"http://www.picself.cn/flash/picself.swf",container_id:"image_modify_con",isInit:!1,isClosed:!0,showNum:0,initialize:function(t){this.target=t,this.checkFlashVersion()?this.init():this.installTip()},init:function(){this.isInit||(this.getFlash(),this.initDialog(),this.bindFuncToStatic(),this.isInit=!0)},checkFlashVersion:function(){var t=deconcept.SWFObjectUtil.getPlayerVersion();return t.major<10?!1:!0},installTip:function(){winDialog.alert(\'我们的产品需要安装flashplayer 10或更高版本，请<a href="http://get.adobe.com/flashplayer">点击此处</a>免费下载\')},refreshTip:function(){winDialog.alert(\'<a href="#" onclick="Editor.Utils.staticClass.refresh()">点击刷新</a>，我们帮您检测是否已成功安装flashplayer 10\',{textOk:"刷新",funcOk:function(){Editor.Utils.staticClass.refresh()}})},initDialog:function(){var t=this,e=[\'<table id="#{entity}" class="CP_w">\',\'<thead id="#{titleBar}">\',"<tr>",\'<th class="tLeft"><span></span></th>\',\'<th class="tMid">\',\'<div class="bLyTop">\',\'<strong id="#{titleName}"></strong>\',\'<cite><a title="关闭" class="CP_w_shut" id="#{btnClose}" href="javascript:;" onclick="return false">关闭</a></cite>\',"</div>","</th>",\'<th class="tRight"><span></span></th>\',"</tr>","</thead>","<tfoot>","<tr>",\'<td class="tLeft"><span/></td>\',\'<td class="tMid"><span></span></td>\',\'<td class="tRight"><span></span></td>\',"</tr>","</tfoot>","<tbody>","<tr>",\'<td class="tLeft"><span></span></td>\',\'<td class="tMid">\',\'<div id="#{content}">\',"</div>","</td>",\'<td class="tRight"><span></span></td>\',"</tr>","</tbody>","</table>"].join("");this.dialog=winDialog.createCustomsDialog({tpl:e,title:"编辑图片",content:"<div id="+this.container_id+\'><div style="width:920px;height:500px;"></div></div>\',renderer:Ui.SimpleRenderer,width:920},"imageModify"),this.dialog.addEventListener("hidden",function(){t.isClosed=!0,$E(t.container_id).innerHTML=""}),this.dialog.setMiddle(),this.dialog.setAreaLocked(!0);var i=20;setTimeout(function(){var e=t.setContent();!e&&i-->0&&arguments.callee()},100)},bindFuncToStatic:function(){Editor.Utils.staticClass.closeEditLayer=this.hide.bind2(this),Editor.Utils.staticClass.changeImg=this.changeImg.bind2(this)},getFlash:function(){var t=new Interface(this._getFlashUrl,"jsload");t.request({GET:{},onSuccess:function(t){this._flashUrl=t,scope.modify_flash_domain=t.replace(/\\w*\\.swf.*$/,"")}.bind2(this),onError:function(){this._flashUrl=this._dFlashUrl,scope.modify_flash_domain=this._dFlashUrl.replace(/\\w*\\.swf.*$/,"")}.bind2(this),onFail:function(){this._flashUrl=this._dFlashUrl,scope.modify_flash_domain=this._dFlashUrl.replace(/\\w*\\.swf.*$/,"")}.bind2(this)})},changeImg:function(t){if(!this.isClosed){rssSendLog("11_31_pic_tupianbaocun");var e=scope.editImage.src;scope.editImage.src=e.replace(/\\/\\w*&/,"/"+t+"&"),scope.editImage.style.height="",scope.editImage.style.width="",scope.editImage.removeAttribute("width"),scope.editImage.removeAttribute("height"),this.hide()}},hide:function(){this.dialog.hidden(),$E(this.container_id).innerHTML=""},show:function(){var t=this;this.isClosed=!1,this.isInit?(this.dialog.show(),window.setTimeout(function(){t.setContent()},1)):this.checkFlashVersion()?this.init():this.showNum>0&&this.refreshTip(),this.showNum++},setContent:function(){return""==this._flashUrl?!1:(Utils.Flash.swfView.Add(this._flashUrl,this.container_id,Editor.Utils.staticClass.flash_id,"920","500","9.0.0.0","#000",{getArgs:"Editor.Utils.staticClass.getArgs"},{scale:"showall",pluginspage:"http://www.macromedia.com/go/getflashplayer",allowScriptAccess:"always",allowFullScreen:"false",wmode:"opaque"}),!0)}},Editor.Utils.ImageOperate=Core.Class.create(),Editor.Utils.ImageOperate.prototype={sizeStatus:["mw690","bmiddle","small"],size:"big",isShow:!1,regStr:"",sizeOperate:!0,initialize:function(t){var e=\'<div id="#{panel}" class="img_ediLayer" style="position:absolute;"><div id="#{content}"></div></div>\';this.regStr=t||"sinaimg.cn",this.layer=new Ui.Panel,this.layer.setTemplate(e),this.initElement();var i=$E("SinaEditor_Iframe");this.editorTop=Core.Dom.getTop(i),this.editorLeft=Core.Dom.getLeft(i),this.editorBottom=this.editorTop+i.offsetHeight,this.editorRight=this.editorLeft+i.offsetWidth,this.setOpacity()},setOpacity:function(t){t=t||.8,Core.Dom.setStyle(this.layer.entity,"opacity","0.8")},show:function(t){var e;this.target=t,-1==this.target.src.indexOf("sinajs.cn")&&-1==this.target.src.indexOf("/myshow/")&&(-1!=t.src.indexOf(this.regStr)?(this.sizeOperate||this.showSizeOperate(),t.src.replace(/(\\/)(small|bmiddle|mw690|middle)(\\/)/g,function(t,i,n){e=n}),this.setSize(e),this.setSizeColor(),this.setAllCacheImage(),this.checkFlashVersion()?this.showEdit():this.hiddenEdit()):(this.hiddenEdit(),this.sizeOperate&&this.hiddenSizeOperate()),this.setPosition(),this.layer.show(),this.isShow=!0)},checkFlashVersion:function(){var t=deconcept.SWFObjectUtil.getPlayerVersion();return t.major<10?!1:!0},setCacheImage:function(t){var e={size:t};e.url=this.target.src.replace(/(\\/)(small|bmiddle|bmiddle)(\\/)/g,"$1"+t+"$3");var i=\'<img style="display:none" src="#{url}" id="image_operate_cache_#{size}"/>\',n=new Ui.Template(i);Core.Dom.addHTML(document.body,n.evaluate(e))},setAllCacheImage:function(){for(var t=this.sizeStatus.length,e=0;t>e;e++)this.setCacheImage(this.sizeStatus[e])},removeAllCache:function(){for(var t=this.sizeStatus.length,e=0;t>e;e++){var i=$E("image_operate_cache_"+this.sizeStatus[e]);i&&i.parentNode.removeChild(i)}},setPosition:function(){var t=Core.System.getScrollPos(editor.iframeDocument),e=this.editorTop+Core.Dom.getTop(this.target)-t[0];e<this.editorTop&&(e=this.editorTop);var i=this.editorLeft+Core.Dom.getLeft(this.target)+19;this.layer.setPosition({x:i,y:e})},getTop:function(t){var e=0,i=t;if(i.offsetParent)for(;i.offsetParent;)e+=i.offsetTop,i=i.offsetParent;else i.y&&(e+=i.y);return e},getLeft:function(t){var e=0,i=t;if(i.offsetParent)for(;i.offsetParent;)e+=i.offsetLeft,i=i.offsetParent;else i.x&&(e+=i.x);return e},hidden:function(){this.isShow&&(this.removeAllCache(),this.layer.hidden(),this.finalize(),this.isShow=!1)},finalize:function(){this.target&&(this.target=null)},change:function(){window.templateDialog&&window.templateDialog.entity||(window.templateDialog=new Editor.Utils.IframeDialog({url:"http://control.blog.sina.com.cn/admin/ria/article_addM_image.php?type=1",title:"插入图片",width:650,height:500,dialogName:"templateDialog"})),window.templateDialog.show(),editor.iframeWindow.focus(),this.layer.hidden()},del:function(){this.target.parentNode.removeChild(this.target),this.hidden()},edit:function(){return this.modify||(this.modify=new Editor.Utils.Modify),rssSendLog("11_31_pic_tupianchuli2"),scope.editImage=this.target,this.modify.show(),this.hidden(),!1},setBig:function(){"big"!=this.size&&(this.clearWidth(),this.target.src=this.target.src.replace(/(\\/)(small|bmiddle)(\\/)/g,"$1mw690$3"),this.size="big",this.setSizeColor(),this.hidden())},setMiddle:function(){"middle"!=this.size&&(this.clearWidth(),this.target.src=this.target.src.replace(/(\\/)(small|mw690)(\\/)/g,"$1bmiddle$3"),this.size="middle",this.setSizeColor(),this.hidden())},setSmall:function(){"small"!=this.size&&(this.clearWidth(),this.target.src=this.target.src.replace(/(\\/)(mw690|bmiddle)(\\/)/g,"$1small$3"),this.size="small",this.setSizeColor(),this.hidden())},clearWidth:function(){this.target.style.height="",this.target.style.width="",this.target.removeAttribute("width"),this.target.removeAttribute("height")},setSize:function(t){switch(t){case"mw690":case"middle":this.size="big";break;case"bmiddle":this.size="middle";\nbreak;case"small":this.size="small"}},showSizeOperate:function(){var t=$E("image_operate_size");t&&(t.style.display=""),$E("image_operate_big").style.display="",$E("image_operate_middle").style.display="",$E("image_operate_small").style.display="",t=null,this.sizeOperate=!0},showEdit:function(){$E("image_operate_edit").style.display=""},hiddenEdit:function(){$E("image_operate_edit").style.display="none"},hiddenSizeOperate:function(){var t=$E("image_operate_size"),e=$E("image_operate_big"),i=$E("image_operate_big"),n=$E("image_operate_small");t&&(t.style.display="none"),e&&(e.style.display="none"),i&&(i.style.display="none"),n&&(n.style.display="none"),t=e=i=n=null,this.sizeOperate=!1},setSizeColor:function(){$E("image_operate_big").className="",$E("image_operate_middle").className="",$E("image_operate_small").className="",$E("image_operate_"+this.size).className="size"},initElement:function(){var t=\'<div class="conn">\t\t\t\t\t\t<div class="tit">编辑图片</div>\t\t\t\t\t\t<ul>\t\t\t\t\t\t\t<li><a href="javascript:void(0);" onclick="return false" id="image_operate_edit">美化图片</a></li>\t\t\t\t\t\t\t<li><a href="javascript:void(0);" onclick="return false" id="image_operate_change">更改图片</a></li>\t\t\t\t\t\t\t<li><a href="javascript:void(0);" onclick="return false" id="image_operate_del">删除图片</a></li>\t\t\t\t\t\t\t<li>\t\t\t\t\t\t\t\t<a href="javascript:void(0);" onclick="return false" id="image_operate_big" class="size">大</a>\t\t\t\t\t\t\t\t<a href="javascript:void(0);" onclick="return false" id="image_operate_middle" class="mid">中</a>\t\t\t\t\t\t\t\t<a href="javascript:void(0);" onclick="return false" id="image_operate_small">小</a>\t\t\t\t\t\t\t</li>\t\t\t\t\t\t</ul>\t\t\t\t\t</div>\',e=new Ui.Template(t),i={};this.layer.setContent(e.evaluate(i)),Core.Events.addEvent($E("image_operate_change"),this.change.bind2(this)),Core.Events.addEvent($E("image_operate_del"),this.del.bind2(this)),Core.Events.addEvent($E("image_operate_edit"),this.edit.bind2(this)),Core.Events.addEvent($E("image_operate_big"),this.setBig.bind2(this)),Core.Events.addEvent($E("image_operate_middle"),this.setMiddle.bind2(this)),Core.Events.addEvent($E("image_operate_small"),this.setSmall.bind2(this))}},Editor.Tools.OperateLayerList=Core.Class.create(),Editor.Tools.OperateLayerList.prototype={names:[],initialize:function(){},add:function(t,e){this.names.push(t),this[t]=e},show:function(t){for(var e=this.names.length,i=0;e>i;i++)this.names[i]!=t&&this[this.names[i]].hidden&&this[this.names[i]].hidden();this[t]&&this[t].show&&this[t].show()}},Editor.Tools.Operate=Core.Class.create(),Editor.Tools.Operate.prototype={initFunctions:function(){},initialize:function(t,e){this.editor=t,this.isDomain=e||!1,this.layers=new Editor.Tools.OperateLayerList,this.initFunctions()}},Core.Class.extend(Editor.Tools.Operate.prototype,{undo:function(){$IE?this.editor.history.undo():this.editor.execCommand("undo")}}),Core.Class.extend(Editor.Tools.Operate.prototype,{bold:function(){this.editor.history.add(),this.editor.execCommand("bold"),this.editor.swapToolStatus&&this.editor.swapToolStatus("bold")}}),Core.Class.extend(Editor.Tools.Operate.prototype,{italic:function(){this.editor.history.add(),this.editor.execCommand("italic"),this.editor.swapToolStatus("italic")}}),Core.Class.extend(Editor.Tools.Operate.prototype,{underline:function(){this.editor.history.add(),this.editor.execCommand("underline"),this.editor.swapToolStatus("underline")}}),Editor.Tools.OperateLayer=Core.Class.create(),Editor.Tools.OperateLayer.prototype={initialize:function(){},initElement:function(){},setPosition:function(){var t=Core.Events.getEvent(),e=Core.Events.fixEvent(t),i=e.target,n=Core.Dom.getLeft(i),o=Core.Dom.getTop(i)+i.offsetHeight+1;this.layer.setPosition({x:n-5,y:o})},stopEvent:function(){Core.Events.stopEvent()},getEventElement:function(){var t=Core.Events.getEvent(),e=Core.Events.fixEvent(t);return e.target},exec:function(){},hidden:function(){this.layer.hidden(),this.isShow=!1},show:function(){this.isShow=this.isShow||!1,this.isShow?this.hidden():(this.setPosition(),this.stopEvent(),this.layer.show(),this.layer.entity.style.zIndex="1025",this.setColor(this.getEventElement().style.backgroundColor),this.isShow=!0)},setColor:function(t){var e=$E("seteditorcolorswf_"+this.id);e&&e.setColor&&e.setColor(t)}},Editor.Tools.FontSize=Core.Class.create(),Editor.Tools.FontSize.prototype={initialize:function(t,e){this.stopEvent(),this.editor=t,this.layer=new Ui.Panel,this.layer.setTemplate(e),this.initElement(),this.setPosition()},initElement:function(){var t;t="smallEditor"!=this.editor.type?{"10px":"10px<i>(六号)</i>","12px":"12px<i>(小五)</i>","14px":"14px<i>(五号)</i>","16px":"16px<i>(小四)</i>","18px":"18px","20px":"20px<i>(小三)</i>","22px":"22px","24px":"24px<i>(小二)</i>","32px":"32px<i>(小一)</i>","56px":"56px<i>(初号)</i>"}:{"10px":"10px<i>(六号)</i>","12px":"12px<i>(小五)</i>","18px":"18px","22px":"22px","32px":"32px<i>(小一)</i>","56px":"56px<i>(初号)</i>"};for(var e in t){var i=$C("a");i.innerHTML=t[e],"smallEditor"!=this.editor.type&&(i.style.cssText="font-size:"+e),i.href="javascript:void(0);",i.onclick=function(){return!1},i.className="fontItem",this.layer.entity.appendChild(i),Core.Events.addEvent(i,this.exec.bind2(this),"click")}},replaceSize:function(t){var e=this.editor.iframeDocument.body.getElementsByTagName("font"),i=e.length,n=null,o=!1;trace(i);for(var s=0;i>s;s++)if(n=e[s],"SinaEditor_Temp_FontName"==n.getAttribute("face")){Core.Dom.setStyle(n,"fontSize",t),n.removeAttribute("face"),o=!0;for(var a=n.getElementsByTagName("font"),r=a.length,l=n.parentNode,c=0;r>c;c++)Core.Dom.setStyle(a[c],"fontSize",""),"font"==l.tagName.toLowerCase()&&l.innerText==n.innerText&&Core.Dom.setStyle(l,"fontSize","")}},exec:function(){this.hidden();var t=this.getEventElement();"a"!=t.nodeName.toLowerCase()&&(t=t.parentNode);var e=t.innerHTML.replace(/(\\d{1,2}px).*/gi,"$1");if(this.editor.iframeWindow.focus(),$IE)this.editor.selectRange(),this.editor.execCommand("fontname","SinaEditor_Temp_FontName",""),this.replaceSize(e);else{this.editor.execCommand("FontSize",e,!1);for(var i,n=this.editor.iframeDocument.getElementsByTagName("font"),o=n.length,s=!1;o--;)n[o].getAttribute("size")&&(i=n[o],i.removeAttribute("size"),i.style.fontSize=e,fuckBrw=!1);if(s){this.editor.execCommand("CreateLink","#SinaEditor_Temp_FontName",!1);for(var a,r,l,c=this.editor.iframeDocument.getElementsByTagName("a"),d=c.length,h=0;d>h;h++)a=c[h],-1!=a.href.indexOf("#SinaEditor_Temp_FontName")&&(r=a.parentNode,l=a.childNodes[0],r.removeAttribute("size"),"#SinaEditor_Temp_FontName"===l.nodeValue?l.nodeValue="":r.style.fontSize=e,r.replaceChild(l,a))}}this.editor.swapToolStatus&&this.editor.swapToolStatus("fontsize"),this.editor.iframeWindow.focus()}},Core.Class.extend(Editor.Tools.FontSize.prototype,Editor.Tools.OperateLayer.prototype,!0),Core.Array.ArrayWithout=function(){if(arguments.length<2)return 1==arguments.length?arguments[0]:null;var t=[],e=arguments[0];if(null===e||e.constructor!=Array)return null;if(arguments[1].constructor==Array){var i=[];i[0]=e,Core.Array.foreach(arguments[1],function(t,e){i[e+1]=t})}else i=arguments;for(var n=0;n<e.length;n++){for(var o=!0,s=1;s<i.length;s++)if(e[n]==i[s]){o=!1;break}o&&t.push(e[n])}return t},Editor.Utils.EventObserver=Core.Class.create(),Editor.Utils.EventObserver.prototype={observers:[],type:"click",initialize:function(t,e){this.type=e,Core.Events.addEvent(t,this.exec.bind2(this),this.type)},attach:function(t){return this.observers.push(t),this.observers.length-1},exec:function(){for(var t=this.observers.length,e=0;t>e;e++)this.observers[e]()},detach:function(t){this.observers[t]=function(){}},finalize:function(){this.observers=[]}},Core.Class.extend(Editor.Tools.Operate.prototype,{fontsize:function(){this.layers.fs?this.layers.show("fs"):("smallEditor"==this.editor.type?this.layers.add("fs",new Editor.Tools.FontSize(this.editor,\'<div id="#{entity}" class="fontItemContent_small"><div id="#{content}" class="fontItemTitle">字号</div></div>\')):this.layers.add("fs",new Editor.Tools.FontSize(this.editor,\'<div id="#{entity}" class="fontItemContent"><div id="#{content}" class="fontItemTitle">字号</div></div>\')),this.documentClickObserver||(this.documentClickObserver=new Editor.Utils.EventObserver(document,"click"),this.documentMousedownObserver=new Editor.Utils.EventObserver(this.editor.iframeDocument,"mousedown"),this.bodyClickObserver=new Editor.Utils.EventObserver(this.editor.iframeDocument.body,"click")),this.documentClickObserver.attach(this.layers.fs.hidden.bind2(this.layers.fs)),this.documentMousedownObserver.attach(this.layers.fs.hidden.bind2(this.layers.fs)),this.bodyClickObserver.attach(this.layers.fs.hidden.bind2(this.layers.fs)),this.layers.show("fs"))}}),Utils.Flash.swfView={swfList:[],Add:function(t,e,i,n,o,s,a,r,l){return t&&i?(this.swfList[this.swfList.length]={sURL:t,sID:e,sPID:i,nWidth:n,nHeight:o,nVersion:s,sBGColor:a,oVar:r,oParam:l},void this.Init()):void 0},Init:function(){for(var t,e=this.swfList,i=0,n=e.length;n>i;i++){var o=e[i];if(t=new Utils.Flash.swfObject(o.sURL,o.sPID,o.nWidth,o.nHeight,o.nVersion,o.sBGColor),o.oVar)for(var s in o.oVar)t.addVariable(s,o.oVar[s]);if(o.oParam)for(var a in o.oParam)t.addParam(a,o.oParam[a]);t.write(o.sID)}e=[],o=null,t=null}},Editor.Tools.SetColor=Core.Class.create(),Editor.Tools.SetColor.prototype={initialize:function(t,e,i){this.stopEvent(),this.editor=t,this.id=Core.Math.getUniqueId(),this.layer=new Ui.Panel,this.layer.setTemplate(e),this.initElement(i),this.setPosition()},initElement:function(t){var e=$_GLOBAL.flashBasicURL+"ColorPicker.swf?"+Core.Math.getUniqueId();Utils.Flash.swfView.Add(e,this.layer.entity,"seteditorcolorswf_"+this.id,"251","264","8.0.0.0","#000",{callback:t},{scale:"showall",loop:"true",play:"true",pluginspage:"http://www.macromedia.com/go/getflashplayer",allowScriptAccess:"always",wmode:"window"}),Core.Events.addEvent(this.layer.entity,this.stopEvent.bind2(this),"click"),Core.Events.addEvent(this.layer.entity,this.hidden.bind2(this),"dblclick")}},Core.Class.extend(Editor.Tools.SetColor.prototype,Editor.Tools.OperateLayer.prototype,!0),Core.Class.extend(Editor.Tools.Operate.prototype,{forecolor:function(){this.layers.fc?this.layers.show("fc"):(this.layers.add("fc",new Editor.Tools.SetColor(this.editor,\'<div id="#{entity}" class="colorItemContent"><div id="#{content}" class="colorItemTitle">颜色选取</div></div>\',"setFontColor")),this.documentClickObserver||(this.documentClickObserver=new Editor.Utils.EventObserver(document,"click"),this.documentMousedownObserver=new Editor.Utils.EventObserver(this.editor.iframeDocument,"mousedown"),this.bodyClickObserver=new Editor.Utils.EventObserver(this.editor.iframeDocument.body,"click")),this.documentClickObserver.attach(this.layers.fc.hidden.bind2(this.layers.fc)),this.documentMousedownObserver.attach(this.layers.fc.hidden.bind2(this.layers.fc)),this.bodyClickObserver.attach(this.layers.fc.hidden.bind2(this.layers.fc)),this.layers.show("fc"))},setFontColor:function(t){this.layers.fc.hidden(),this.editor.execCommand("foreColor",t),this.editor.swapToolStatus&&this.editor.swapToolStatus("forecolor")}}),Ui.Drag=function(t,e,i){var n=this;this.canDrag=!0,this.isLock=!1,this.lockArea={left:0,right:0,top:0,bottom:0},this.__captureNode=t,this.__dragNodes=[],this.__deltaX=[],this.__deltaY=[],this.__eventDispatcher=new Core.Events.EventDispatcher(this),this.__isDraging=!1,this.__canDragX=!0,this.__canDragY=!0,this.__dragHandle=function(){n.__drag()},this.__mouseDownHandle=function(){n.__isDraging=!0,n.__eventDispatcher.dispatchEvent("beforeDrag"),n.__setCapture(!0)},this.__mouseUpHandle=function(){n.__isDraging&&n.__eventDispatcher.dispatchEvent("afterDrag"),n.__isDraging=!1,n.__setCapture(!1)},this.__initNodes(t,e,i),this.__initCaputerNode()}.$define({addEventListener:function(t,e){return this.__eventDispatcher.addEventListener(t,e),this},removeEventListener:function(t,e){return this.__eventDispatcher.removeEventListener(t,e),this},destroy:function(){Core.Events.removeEvent(this.__captureNode,this.__mouseDownHandle,"mousedown"),Core.Events.removeEvent(document,this.__mouseUpHandle,"mouseup"),this.__captureNode=null,this.__dragNodes=null},__initNodes:function(t,e,i){e?(e instanceof Array?this.__dragNodes=e:this.__dragNodes.push(e),("undefined"==typeof i||i)&&this.__dragNodes.push(this.__captureNode)):this.__dragNodes.push(this.__captureNode);for(var n=this.__dragNodes,o=n.length;o--;)!n[o].style.position&&(n[o].style.position="absolute"),!n[o].style.left&&(n[o].style.left=0),!n[o].style.top&&(n[o].style.top=0)},__initCaputerNode:function(){var t=this.__captureNode;Core.Events.addEvent(t,this.__mouseDownHandle,"mousedown"),Core.Events.addEvent(document,this.__mouseUpHandle,"mouseup")},__setCapture:function(t){for(var e=this.__captureNode,i=this.__dragNodes,n=Core.Events.getEvent(),o=i.length;o--;)this.__deltaX[o]=n.clientX-parseInt(i[o].style.left),this.__deltaY[o]=n.clientY-parseInt(i[o].style.top);t?$IE?(e.setCapture(),Core.Events.addEvent(e,this.__dragHandle,"mousemove")):Core.Events.addEvent(document,this.__dragHandle,"mousemove"):$IE?(e.releaseCapture(),Core.Events.removeEvent(e,this.__dragHandle,"mousemove")):Core.Events.removeEvent(document,this.__dragHandle,"mousemove")},__drag:function(){if(this.canDrag){var t=this.__dragNodes,e=Core.Events.getEvent(),i=t.length,n=this.lockArea,o=0,s=0;for(this.__eventDispatcher.dispatchEvent("drag");i--;)o=e.clientX-this.__deltaX[i],s=e.clientY-this.__deltaY[i],this.isLock&&(o=Math.min(Math.max(o,n.left),n.right),s=Math.min(Math.max(s,n.top),n.bottom)),t[i].style.left=o+"px",t[i].style.top=s+"px"}}}),Ui.IDragger={addEventListener:function(){},removeEventListener:function(){},setDrag:function(){},setLock:function(){},setArea:function(){},destroy:function(){}},Ui.SimpleDragger=function(){this.__drag=null,this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$implements(Ui.IDragger).$define({addEventListener:function(t,e){return"afterdrag"===t.toLowerCase()?this.__eventDispatcher.addEventListener(t,e):this.__drag.addEventListener(t,e),this},removeEventListener:function(t,e){return"afterdrag"===t.toLowerCase()?this.__eventDispatcher.removeEventListener(t,e):this.__drag.removeEventListener(t,e),this},setDrag:function(t,e,i){var n=this;return this.__drag=new Ui.Drag(t,e,i),this.__drag.addEventListener("afterDrag",function(){n.__eventDispatcher.dispatchEvent("afterDrag")}),this},setLock:function(t){return this.__drag.isLock=!!t,this},setArea:function(t){return this.__drag.lockArea=t,this},destroy:function(){this.__drag.destroy()}}),Ui.Dialog=function(){var t=this;this.__dragger=null,this.__isBindUpadateAreaEvent=!1,this.__isBindUpdateIE6AreaEvent=!1,this.__beforeDragHandle=function(){t.__updateDraggerArea(),t.__eventDispatcher.dispatchEvent("beforedrag")},this.__dragHandle=function(){t.__isSetAdamant&&t.__updateIframe(),t.__eventDispatcher.dispatchEvent("drag")},this.__afterDragHandle=function(){t.__isFixed&&$IE6&&t.__updateIE6FCOrgPosition(),t.__eventDispatcher.dispatchEvent("afterdrag")},this.__updateDraggerAreaHandle=function(){setTimeout(function(){t.__updateDraggerArea()},1)},this.__setMiddleHandle=function(){t.setMiddle()}}.$extends(Ui.Panel).$define({setTemplate:function(t){return Ui.Dialog.$super.setTemplate.call(this,t),this.__initTitleBar(),this.setDragger(Ui.SimpleDragger),this},setContent:function(t){return this.nodes.content?(this.nodes.content.innerHTML=new Ui.Template(t).evaluate(this.__getNodes(t,"i")),this.__addContentNodes(this.__getNodes(t)),this):this},setFixed:function(t){return Ui.Dialog.$super.setFixed.call(this,t),t?Core.Events.addEvent(window,this.__setMiddleHandle,"resize"):Core.Events.removeEvent(window,this.__setMiddleHandle,"resize"),this.__updateDraggerArea(),this},setMiddle:function(){var t=this.__getDocumentSize().height-this.height,e=(Math.sqrt(5)-1)/2,i=1,n=t*e/(e+i),o=this.__getDocumentSize().width/2-this.width/2;return this.__isFixed||(n+=Math.max(document.documentElement.scrollTop,document.body.scrollTop),o+=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft)),this.setPosition({x:Math.max(o,0),y:Math.max(n,0)}),this},setAreaLocked:function(t){return this.__dragger?(this.__dragger.setLock(t),this):this},setSize:function(t){return!this.__isInited&&this.__initEntity(),this.nodes.content?("undefined"!=typeof t.width&&(this.nodes.content.style.width=t.width+"px"),"undefined"!=typeof t.height&&(this.nodes.content.style.height=t.height+"px")):("undefined"!=typeof t.width&&(this.__entity.style.width=t.width+"px"),"undefined"!=typeof t.height&&(this.__entity.style.height=t.height+"px")),this},setDragger:function(t){if(!this.nodes.titleBar||!t)return this;if(this.__dragger){if(this.__dragger.constructor===t)return this}else this.__dragger=new t;return this.__updateDragger(t),this},destroy:function(){this.__entity&&(Ui.Dialog.$super.destroy.call(this),Core.Events.removeEvent(window,this.__updateDraggerAreaHandle,"resize"),Core.Events.removeEvent(window,this.__setMiddleHandle,"resize"))},__addContentNodes:function(t){var e,i=this.nodes;for(e in t)i[e]=t[e]},__updateDragger:function(t){this.__dragger.constructor!==t&&(this.__dragger.removeEventListener("beforedrag",this.__beforeDragHandle).removeEventListener("drag",this.__dragHandle).removeEventListener("afterdrag",this.__afterDragHandle),this.__dragger.destroy(),this.__dragger=new t),this.__dragger.setDrag(this.nodes.titleBar,this.__entity,!1),this.__dragger.addEventListener("beforedrag",this.__beforeDragHandle).addEventListener("drag",this.__dragHandle).addEventListener("afterdrag",this.__afterDragHandle)},__updateDraggerArea:function(){var t,e,i,n;this.__isFixed?(t=$IE6?document.documentElement.scrollLeft:0,e=$IE6?document.documentElement.scrollTop:0,i=$IE6?document.documentElement.scrollLeft+this.__getDocumentSize().width-this.width:this.__getDocumentSize().width-this.width,n=$IE6?document.documentElement.scrollTop+this.__getDocumentSize().height-this.height:this.__getDocumentSize().height-this.height):(t=0,e=0,i=document.documentElement.scrollWidth-this.width,n=document.documentElement.scrollHeight-this.height),this.__dragger.setArea({left:t,top:e,right:i,bottom:n})},__initTitleBar:function(){if(this.nodes.titleBar){var t=this.nodes.titleBar;t.style.cursor="move",$IE?Core.Events.addEvent(t,function(){return!1},"selectstart"):t.style.MozUserSelect="none"}},__getDocumentSize:function(){var t=document.documentElement.clientWidth||document.body.clientWidth,e=document.documentElement.clientHeight||document.body.clientHeight;return{width:t,height:e}}}),Ui.ModuleDialog=function(t,e,i){this.__bgShadow=null,this.__dialog=null,this.__isInitBgShadow=!1,this.__tplConfig=t,this.__iconSet=e,this.__dialogQueue=[],this.__zIndex=i&&i.zIndex||5e3,this.__cfg=i||{},this.__initDialogEvent()}.$define({alert:function(t,e){e=e||{};var i=this.__createMessageDialog(e.tplConfig||this.__tplConfig.alert,e);return i.nodes.text&&(i.nodes.text.innerHTML=t||""),i.show(e.renderer||this.__cfg.renderer).addEventListener("hidden",function(){this.destroy()}),i.nodes.linkOk&&"none"!==i.nodes.linkOk.style.display&&i.nodes.linkOk.focus(),i},newAlert:function(t,e,i){e.tplConfig=this.__tplConfig.newAlert,this.alert(t,e,i)},confirm:function(t,e){e=e||{};var i=this.__createMessageDialog(e.tplConfig||this.__tplConfig.confirm,e),n=this;return i.nodes.text&&(i.nodes.text.innerHTML=t||""),i.nodes.btnCancel&&(i.nodes.btnCancel.innerHTML=e.textCancel||"取消",Core.Events.addEvent(i.nodes.btnCancel,function(){e.funcCancel&&e.funcCancel.call(i),i.hidden(e.renderer||n.__cfg.renderer),Core.Events.stopEvent()},"click"),i.nodes.linkCancel&&Core.Events.addEvent(i.nodes.linkCancel,function(){var t=Core.Events.getEvent();"13"==t.keyCode&&(e.funcCancel&&e.funcCancel.call(i),i.hidden(e.renderer||n.__cfg.renderer))},"keydown")),i.show(e.renderer||n.__cfg.renderer).addEventListener("hidden",function(){this.destroy()}),0==e.defaultButton?i.nodes.linkCancel&&"none"!==i.nodes.linkCancel.style.display&&i.nodes.linkCancel.focus():i.nodes.linkOk&&"none"!==i.nodes.linkOk.style.display&&i.nodes.linkOk.focus(),i},newConfirm:function(t,e,i){e.tplConfig=this.__tplConfig.newConfirm,this.confirm(t,e,i)},create:function(t){t=t||{};var e=new Ui.Dialog;return e.setTemplate(t.tpl||this.__tplConfig.customs),t.content&&e.setContent(t.content),t.width&&!isNaN(t.width)&&e.setSize({width:t.width}),t.height&&!isNaN(t.height)&&e.setSize({height:t.height}),this.__initDialog(e,t)},__initDialogEvent:function(){var t=this.__dialogQueue;Core.Events.addEvent(document,function(){var e=Core.Events.getEvent();t.length&&"27"==e.keyCode&&t[t.length-1].hidden()},"keydown")},__createMessageDialog:function(t,e){var i=new Ui.Dialog,n=this;return i.setTemplate(t),e.width&&!isNaN(e.width)&&i.setSize({width:e.width}),e.height&&!isNaN(e.height)&&i.setSize({height:e.height}),i.nodes.subText&&(i.nodes.subText.innerHTML=e.subText||""),i.nodes.icon&&(i.nodes.icon.className=this.__iconSet[e.icon||"01"]["class"],i.nodes.icon.alt=this.__iconSet[e.icon||"01"].alt),i.nodes.btnOk&&(i.nodes.btnOk.innerHTML=e.textOk||"确定",Core.Events.addEvent(i.nodes.btnOk,function(){i.hidden(e.renderer||n.__cfg.renderer),e.funcOk&&e.funcOk.call(i),Core.Events.stopEvent()},"click")),i.nodes.linkOk&&Core.Events.addEvent(i.nodes.linkOk,function(){var t=Core.Events.getEvent();"13"==t.keyCode&&(i.hidden(e.renderer||n.__cfg.renderer),e.funcOk&&e.funcOk.call(i))},"keydown"),i.setDragger(e.dragger||n.__cfg.dragger).setFixed(!0).setAreaLocked(!0),this.__initDialog(i,e)},__initDialog:function(t,e){var i=this;return e.zIndex&&(i.__zIndex=e.zIndex),t.nodes.titleName&&(t.nodes.titleName.innerHTML=e.title||"提示"),t.nodes.btnClose&&(Core.Events.addEvent(t.nodes.btnClose,function(){var i=!0;e.funcBeforeClose&&(i=e.funcBeforeClose.call(t)!==!1),e.funcClose&&e.funcClose.call(t),i&&t.hidden()},"click"),Core.Events.addEvent(t.nodes.btnClose,function(){Core.Events.stopEvent()},"mousedown")),t.setPosition({z:e.zIndex||i.__zIndex}),t.setRenderer(e.renderer||this.__cfg.renderer),t.setDragger(e.dragger||this.__cfg.dragger),t.setMiddle(),t.addEventListener("beforeHidden",function(){i.__updateDialogQueue(this,"remove")}),t.addEventListener("beforeShow",function(){this.nodes.panel.parentNode.appendChild(this.nodes.panel);var t=this;i.__isInitBgShadow||i.__initBGShadow(this,e.isAdamant||i.__cfg.isAdamant),i.__setBGShadowOpacity(0!==e.bgShadowOpacity?e.bgShadowOpacity||.4:e.bgShadowOpacity),window.setTimeout(function(){i.__bgShadow.show(),i.__updateDialogQueue(t,"add")},1)}),t.setTitle=function(t){this.nodes.titleName&&(this.nodes.titleName.innerHTML=t)},t.setHelp=function(t){this.nodes.btnHelp&&(this.nodes.btnHelp.href=t)},t.close=function(){this.hidden()},t.getNodes=function(){return this.nodes},t.getX=function(){return this.x},t.getY=function(){return this.y},t.getWidth=function(){return this.width},t.getHeight=function(){return this.height},t},__initBGShadow:function(t,e){var i=this.__getDocumentSize().width,n=this.__getDocumentSize().height,o=this;this.__bgShadow=new Ui.Panel,this.__bgShadow.setTemplate(\'<div id="#{panel}" style="background-color:black"></div>\').setSize({width:i,height:n}).setAdamant(e).setFixed(!0).setPosition({x:0,y:0,z:o.__zIndex}),Core.Events.addEvent(window,function(){o.__bgShadow.setPosition({x:0,y:0}).setSize({width:o.__getDocumentSize().width,height:o.__getDocumentSize().height})},"resize"),this.__isInitBgShadow=!0},__updateDialogQueue:function(t,e){var i,n;if("add"===e)this.__dialogQueue.push(t);else if("remove"===e)for(i=this.__dialogQueue.length;i--;)this.__dialogQueue[i]===t&&this.__dialogQueue.splice(i,1);0===this.__dialogQueue.length?this.__bgShadow.hidden():(n=this.__dialogQueue[this.__dialogQueue.length-1],this.__bgShadow.nodes.panel.parentNode.insertBefore(this.__bgShadow.nodes.panel,n.nodes.panel),this.__bgShadow.__iframe&&this.__bgShadow.__iframe.parentNode.insertBefore(this.__bgShadow.__iframe,this.__bgShadow.nodes.panel),n.nodes.linkOk&&"none"!==n.nodes.linkOk.style.display&&n.nodes.linkOk.focus())},__setBGShadowOpacity:function(t){t=isNaN(t)?0:Math.max(Math.min(t,1),0),Core.Dom.setStyle(this.__bgShadow.nodes.panel,"opacity",t)},__getDocumentSize:function(){var t=document.documentElement.clientWidth||document.body.clientWidth,e=document.documentElement.clientHeight||document.body.clientHeight;return{width:t,height:e}}}),Ui.Transition={simple:function(t,e,i,n){return i*t/n+e},backEaseIn:function(t,e,i,n){var o=1.70158;return i*(t/=n)*t*((o+1)*t-o)+e},backEaseOut:function(t,e,i,n){var o=1.70158;return i*((t=t/n-1)*t*((o+1)*t+o)+1)+e},backEaseInOut:function(t,e,i,n){var o=1.70158;return(t/=n/2)<1?i/2*t*t*(((o*=1.525)+1)*t-o)+e:i/2*((t-=2)*t*(((o*=1.525)+1)*t+o)+2)+e},bounceEaseOut:function(t,e,i,n){return(t/=n)<1/2.75?7.5625*i*t*t+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},bounceEaseIn:function(t,e,i,n){return i-Transition.bounceEaseOut(n-t,0,i,n)+e},bounceEaseInOut:function(t,e,i,n){return n/2>t?.5*Transition.bounceEaseIn(2*t,0,i,n)+e:.5*Transition.bounceEaseOut(2*t-n,0,i,n)+.5*i+e},regularEaseIn:function(t,e,i,n){return i*(t/=n)*t+e},regularEaseOut:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},regularEaseInOut:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},strongEaseIn:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},strongEaseOut:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},strongEaseInOut:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},elasticEaseIn:function(t,e,i,n){var o,s;if(0==t)return e;if(1==(t/=n))return e+i;if(s=.3*n,!o||o<Math.abs(i)){o=i;var a=s/4}else var a=s/(2*Math.PI)*Math.asin(i/o);return-(o*Math.pow(2,10*(t-=1))*Math.sin(2*(t*n-a)*Math.PI/s))+e},elasticEaseOut:function(t,e,i,n){var o,s;if(0==t)return e;if(1==(t/=n))return e+i;if(s||(s=.3*n),!o||o<Math.abs(i)){o=i;var a=s/4}else var a=s/(2*Math.PI)*Math.asin(i/o);return o*Math.pow(2,-10*t)*Math.sin(2*(t*n-a)*Math.PI/s)+i+e},elasticEaseInOut:function(t,e,i,n){var o,s;if(0==t)return e;if(2==(t/=n/2))return e+i;if(!s)var s=.3*n*1.5;if(!o||o<Math.abs(i))var o=i,a=s/4;else var a=s/(2*Math.PI)*Math.asin(i/o);return 1>t?-.5*o*Math.pow(2,10*(t-=1))*Math.sin(2*(t*n-a)*Math.PI/s)+e:o*Math.pow(2,-10*(t-=1))*Math.sin(2*(t*n-a)*Math.PI/s)*.5+i+e}},Ui.TweenStrategy=function(t,e,i,n){this.startValue=t||0,this.endValue=e||0,this.duration=i||0,this.motion=n||Ui.Transition.simple,this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$define({motion:null,duration:0,startValue:0,endValue:0,_itvID:0,_isTweenning:!1,addEventListener:function(t,e){return this.__eventDispatcher.addEventListener(t,e),this},removeEventListener:function(t,e){return this.__eventDispatcher.removeEventListener(t,e),this},start:function(){if(!this._isTweenning){this._isTweenning=!0;var t,e,i=this,n=this.startValue,o=this.endValue,s=this.duration,a=(new Date).getTime();return this._itvID=window.setInterval(function(){t=((new Date).getTime()-a)/1e3,t>i.duration&&(t=i.duration),e=i.motion(t,n,o-n,s),i.onTween&&i.onTween(e),i.__eventDispatcher.dispatchEvent("tween",e),t==i.duration&&i.stop()},25),this}},stop:function(){return window.clearInterval(this._itvID),this._isTweenning=!1,this.onEnd&&this.onEnd(),this.__eventDispatcher.dispatchEvent("end"),this},onTween:function(){},onEnd:function(){}}),Ui.OpacityRenderer=function(){this.__canShow=!0,this.__canHidden=!0,this.__node=null,this.__tween=new Ui.TweenStrategy(0,0,.6,Ui.Transition.strongEaseOut),this.__state="",this.__lastState="",this.__value=0,this.__node=null,this.__eventDispatcher=new Core.Events.EventDispatcher(this),this.__initTweenEvent()}.$implements(Ui.IRenderer).$define({setCanShow:function(t){this.__canShow=!!t},setCanHidden:function(t){this.__canHidden=!!t},show:function(t){var e=this.__tween;return e.stop(),Core.Dom.setStyle(t,"opacity",this.__value),t.style.display="",this.__node=t,this.__state="show",this.__eventDispatcher.dispatchEvent("beforeShow"),this.__canShow&&(e.startValue=this.__value,e.endValue=1,e.start()),this},hidden:function(t){var e=this.__tween;return e.stop(),this.__node=t,this.__state="hidden",this.__eventDispatcher.dispatchEvent("beforeHidden"),this.__canHidden&&(e.startValue=this.__value,e.endValue=0,e.start()),this},addEventListener:function(t,e){return this.__eventDispatcher.addEventListener(t,e),this},removeEventListener:function(t,e){return this.__eventDispatcher.removeEventListener(t,e),this},__initTweenEvent:function(){var t=this;this.__tween.addEventListener("tween",function(e){t.__value=e,Core.Dom.setStyle(t.__node,"opacity",e)}),this.__tween.addEventListener("end",function(){t.__node&&t.__node.style.filter&&(t.__node.style.filter=""),""!==t.__state&&t.__state!==t.__lastState&&(t.__lastState=t.__state,t.__eventDispatcher.dispatchEvent(t.__state)),"hidden"===t.__state&&(t.__node.style.display="none")})}}),Ui.BorderDragger=function(){this.__drag=null,this.__isBindEvent=!1,this.__border=null,this.__dragNode=null,this.__isCreated=!1,this.__tweenX=new Ui.TweenStrategy(0,0,.5,Ui.Transition.strongEaseOut),this.__tweenY=new Ui.TweenStrategy(0,0,.5,Ui.Transition.strongEaseOut),this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$implements(Ui.IDragger).$define({addEventListener:function(t,e){return"afterdrag"===t.toLowerCase()?this.__eventDispatcher.addEventListener(t,e):this.__drag.addEventListener(t,e),this},removeEventListener:function(t,e){return"afterdrag"===t.toLowerCase()?this.__eventDispatcher.removeEventListener(t,e):this.__drag.removeEventListener(t,e),this},setDrag:function(t,e,i){return this.__isCreated||(this.__createBorder(e),this.__initTweenEvent(e)),this.__drag=new Ui.Drag(t,this.__border,i),this.__dragNode=e,this.__initDragEvent(),this},setLock:function(t){return this.__drag.isLock=!!t,this},setArea:function(t){return this.__drag.lockArea=t,this},destroy:function(){this.__drag.destroy()},__createBorder:function(){this.__border=$C("div");var t=this.__border.style;t.border="2px dashed #BCC4D0",t.position="absolute",t.display="none",t.backgroundColor="transparent",t.MozUserSelect="none",document.body.appendChild(this.__border),this.__isCreated=!0},__initDragEvent:function(){if(!this.__isBindEvent){var t=this,e=this.__border.style,i=this.__dragNode.style,n=this.__tweenX,o=this.__tweenY;this.__drag.addEventListener("beforeDrag",function(){e.zIndex=i.zIndex+1,e.position=i.position,e.width=t.__dragNode.offsetWidth-4+"px",e.height=t.__dragNode.offsetHeight-4+"px",e.left=parseInt(i.left)+"px",e.top=parseInt(i.top)+"px",e.display=""}),this.__drag.addEventListener("afterDrag",function(){$IE6?(i.left=parseInt(e.left)+"px",i.top=parseInt(e.top)+"px",e.display="none",t.__eventDispatcher.dispatchEvent("afterDrag")):(n.startValue=parseInt(i.left),n.endValue=parseInt(e.left),o.startValue=parseInt(i.top),o.endValue=parseInt(e.top),n.start(),o.start())}),this.__isBindEvent=!0}},__initTweenEvent:function(t){var e=t.style,i=this.__border.style,n=this;this.__tweenX.addEventListener("tween",function(t){e.left=t+"px"}),this.__tweenY.addEventListener("tween",function(t){e.top=t+"px"}),this.__tweenX.addEventListener("end",function(){i.display="none",n.__eventDispatcher.dispatchEvent("afterDrag")})}});var winDialog={},DialogTemplate={};!function(){var t={alert:[\'<table id="#{panel}" class="CP_w">\',\'<thead id="#{titleBar}">\',"<tr>",\'<th class="tLeft"><span></span></th>\',\'<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示标题</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>\',\'<th class="tRight"><span></span></th>\',"</tr>","</thead>","<tfoot>","<tr>",\'<td class="tLeft"><span></span></td>\',\'<td class="tMid"><span></span></td>\',\'<td class="tRight"><span></span></td>\',"</tr>","</tfoot>","<tbody>","<tr>",\'<td class="tLeft"><span></span></td>\',\'<td class="tMid">\',\'<div id="#{content}" class="CP_layercon1">\',\'<div class="CP_prompt">\',\'<img id="#{icon}" class="SG_icon SG_icon201" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="50" height="50" align="absmiddle"/>\',\'<table class="CP_w_ttl"><tr><td id="#{text}"></td></tr></table>\',\'<div id="#{subText}" class="CP_w_cnt SG_txtb"></div>\',\'<p class="CP_w_btns_Mid"><a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnOk}"> </cite></a></p>\',"</div>","</div>","</td>",\'<td class="tRight"><span></span></td>\',"</tr>","</tbody>","</table>"].join(""),newAlert:[\'<table id="#{panel}" class="CP_w">\',\'<thead id="#{titleBar}">\',"<tr>",\'<th class="tLeft"><span></span></th>\',\'<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>\',\'<th class="tRight"><span></span></th>\',"</tr>","</thead>","<tfoot>","<tr>",\'<td class="tLeft"><span></span></td>\',\'<td class="tMid"><span></span></td>\',\'<td class="tRight"><span></span></td>\',"</tr>","</tfoot>","<tbody>","<tr>",\'<td class="tLeft"><span></span></td>\',\'<td class="tMid">\',\'<div class="CP_layercon2 pop_v">\',\'<div class="v_prompt">\',\'<img id="#{icon}" class="SG_icon SG_icon148" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="20" height="20" align="absmiddle" />\',\'<div id="#{text}" class="v_cnt SG_txtb"></div>\',\'<div id="#{subText}"></div>\',\'<p class="v_btns">\',\'<a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#"><cite id="#{btnOk}">确定</cite></a>\',"</p>","</div>","</div>","</td>",\'<td class="tRight"><span></span></td>\',"</tr>","</tbody>","</table>"].join(""),confirm:[\'<table id="#{panel}" class="CP_w">\',\'<thead id="#{titleBar}">\',"<tr>",\'<th class="tLeft"><span></span></th>\',\'<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示标题</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>\',\'<th class="tRight"><span></span></th>\',"</tr>","</thead>","<tfoot>","<tr>",\'<td class="tLeft"><span></span></td>\',\'<td class="tMid"><span></span></td>\',\'<td class="tRight"><span></span></td>\',"</tr>","</tfoot>","<tbody>","<tr>",\'<td class="tLeft"><span></span></td>\',\'<td class="tMid">\',\'<div id="#{content}" class="CP_layercon1">\',\'<div class="CP_prompt">\',\'<img id="#{icon}" class="SG_icon SG_icon201" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="50" height="50" align="absmiddle"/>\',\'<table class="CP_w_ttl"><tr><td id="#{text}"></td></tr></table>\',\'<div id="#{subText}" class="CP_w_cnt SG_txtb"></div>\',\'<p class="CP_w_btns">\',\'<a  id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnOk}"></cite></a>\',\'<a style="margin-left:5px;" id="#{linkCancel}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnCancel}"> <span id="#{cancel}"></span> </cite></a></p>\',"</div>","</div>","</td>",\'<td class="tRight"><span></span></td>\',"</tr>","</tbody>","</table>"].join(""),newConfirm:[\'<table id="#{panel}" class="CP_w">\',\'<thead id="#{titleBar}">\',"<tr>",\'<th class="tLeft"><span></span></th>\',\'<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>\',\'<th class="tRight"><span></span></th>\',"</tr>","</thead>","<tfoot>","<tr>",\'<td class="tLeft"><span></span></td>\',\'<td class="tMid"><span></span></td>\',\'<td class="tRight"><span></span></td>\',"</tr>","</tfoot>","<tbody>","<tr>",\'<td class="tLeft"><span></span></td>\',\'<td class="tMid">\',\'<div class="CP_layercon2 pop_v">\',\'<div class="v_prompt">\',\'<img id="#{icon}" class="SG_icon SG_icon148" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="20" height="20" align="absmiddle" />\',\'<div id="#{text}" class="v_cnt SG_txtb"></div>\',\'<div id="#{subText}"></div>\',\'<p class="v_btns">\',\'<a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#"><cite id="#{btnOk}">确定</cite></a>&nbsp;&nbsp;\',\'<a id="#{linkCancel}" class="SG_aBtn SG_aBtnB SG_aBtn_g" href="#"><cite id="#{btnCancel}">取消</cite></a>\',"</p>","</div>","</div>","</td>",\'<td class="tRight"><span></span></td>\',"</tr>","</tbody>","</table>"].join(""),customs:[\'<table id="#{panel}" class="CP_w">\',\'<thead id="#{titleBar}">\',"<tr>",\'<th class="tLeft"><span></span></th>\',\'<th class="tMid">\',\'<div class="bLyTop">\',\'<strong id="#{titleName}">提示标题</strong>\',\'<cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite>\',"</div>","</th>",\'<th class="tRight"><span></span></th>\',"</tr>","</thead>","<tfoot>","<tr>",\'<td class="tLeft"><span></span></td>\',\'<td class="tMid"><span></span></td>\',\'<td class="tRight"><span></span></td>\',"</tr>","</tfoot>","<tbody>","<tr>",\'<td class="tLeft"><span></span></td>\',\'<td class="tMid" id="#{content}">\',"</td>",\'<td class="tRight"><span></span></td>\',"</tr>","</tbody>","</table>"].join("")},e={"01":{"class":"SG_icon SG_icon201",alt:"警告"},"02":{"class":"SG_icon SG_icon202",alt:"失败"},"03":{"class":"SG_icon SG_icon203",alt:"成功"},"04":{"class":"SG_icon SG_icon204",alt:"询问"},"05":{"class":"SG_icon SG_bigLoading",alt:"正在加载"},"06":{"class":"SG_icon SG_icon148",alt:"警告"}},i={},n=new Ui.ModuleDialog(t,e,{renderer:Ui.OpacityRenderer,dragger:Ui.BorderDragger,isAdamant:$IE6});\nwinDialog.create=winDialog.createCustomsDialog=function(t,e){return e&&"string"==typeof e?(i[e]=n.create(t),i[e]):n.create(t)},winDialog.alert=function(t,e,o){return o&&"string"==typeof o?(i[o]=n.alert(t,e),i[o]):n.alert(t,e)},winDialog.newAlert=function(t,e,o){return o&&"string"==typeof o?(i[o]=n.newAlert(t,e),i[o]):n.newAlert(t,e)},winDialog.confirm=function(t,e,o){return o&&"string"==typeof o?(i[o]=n.confirm(t,e),i[o]):n.confirm(t,e)},winDialog.newConfirm=function(t,e,o){return o&&"string"==typeof o?(i[o]=n.newConfirm(t,e),i[o]):n.newConfirm(t,e)},winDialog.getDialog=function(t){return t&&"string"==typeof t?i[t]:void 0},DialogTemplate=t}(),Editor.Utils.IframeDialog=Core.Class.create(),Editor.Utils.IframeDialog.prototype={dialog:null,num:0,initialize:function(t){this.id=Core.Math.getUniqueId(),this.dialogContent="<iframe frameborder=\'0\' id=\'iframeDialog_"+this.id+"\' scrolling=\'no\' style=\'width: #{width}px; height: #{height}px;\' src=\'\'></iframe>",this.option=t},initDialog:function(){this.num++;var t=new Ui.Template(this.dialogContent).evaluate(this.option),e={ad:!1,drag:!0,title:this.option.title,content:t,renderer:Ui.SimpleRenderer,width:this.option.width,height:this.option.height};this.option.dialogName&&"imageDialog"==this.option.dialogName&&(e.tpl=this.getTpl());var i=winDialog.createCustomsDialog(e,this.option.dialogName+"_"+this.num||"");this.dialog=i,this.dialog.setAreaLocked(!0),$E("iframeDialog_"+this.id).src=this.option.url,this.bindColseFunc()},getTpl:function(){var t=[\'<table id="#{entity}" class="CP_w">\',\'<thead id="#{titleBar}">\',"<tr>",\'<th class="tLeft"><span></span></th>\',\'<th class="tMid">\',\'<div class="bLyTop">\',\'<strong id="#{titleName}">提示标题</strong>\',\'<cite style="width:35px;">\',\'<a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite>\',"</div>","</th>",\'<th class="tRight"><span></span></th>\',"</tr>","</thead>","<tfoot>","<tr>",\'<td class="tLeft"><span></span></td>\',\'<td class="tMid"><span></span></td>\',\'<td class="tRight"><span></span></td>\',"</tr>","</tfoot>","<tbody>","<tr>",\'<td class="tLeft"><span></span></td>\',\'<td class="tMid" id="#{content}">\',"</td>",\'<td class="tRight"><span></span></td>\',"</tr>","</tbody>","</table>"];return t.join("")},reset:function(){if(this.dialog){this.hidden();var t=this.dialog.nodes.panel||this.dialog.nodes.entity;t.parentNode.removeChild(t),this.dialog=null}},bindColseFunc:function(){Core.Events.addEvent(this.dialog.nodes.btnClose,function(){editor.iframeWindow.focus()},"click")},setSize:function(t,e){var i=this.dialog.nodes.content.firstChild;this.dialog.setSize({width:t,height:e}),i.style.width=t+"px",i.style.height=e+"px"},show:function(){this.reset(),this.initDialog(),this.dialog.show(),this.dialog.setMiddle()},hidden:function(){this.dialog.hidden()}},Core.Class.extend(Editor.Tools.Operate.prototype,{link:function(){var t="http://control.blog.sina.com.cn/admin/ria/article_addM_link.php";this.isDomain&&(t+="?domain=dom"),window.linkDialog&&window.linkDialog.entity||(window.linkDialog=new Editor.Utils.IframeDialog({url:t,title:"插入链接",width:300,height:150})),window.linkDialog.show()}}),Core.Class.extend(Editor.Tools.Operate.prototype,{justifyleft:function(){this.editor.history.add(),this.editor.execCommand("justifyleft")}}),Core.Class.extend(Editor.Tools.Operate.prototype,{justifycenter:function(){this.editor.history.add(),this.editor.execCommand("justifycenter")}}),Core.Class.extend(Editor.Tools.Operate.prototype,{justifyright:function(){this.editor.history.add(),this.editor.execCommand("justifyright")}}),Core.Class.extend(Editor.Tools.Operate.prototype,{marklist:function(){this.editor.history.add(),this.editor.execCommand("insertunorderedlist")}}),Core.Class.extend(Editor.Tools.Operate.prototype,{numberlist:function(){this.editor.history.add(),this.editor.execCommand("insertorderedlist")}}),Core.Class.extend(Editor.Tools.Operate.prototype,{img:function(){if(!window.imageDialog){var t="http://control.blog.sina.com.cn/admin/ria/article_addM_image.php";this.ctg_id&&(t+="?ctg_id="+this.ctg_id),this.isDomain&&(t+="?domain"),window.imageDialog=new Editor.Utils.IframeDialog({url:t,title:"插入图片",width:660,height:450,dialogName:"imageDialog"}),this.editor.initImageOpertae&&this.editor.initImageOpertae()}this.editor.blur(),window.imageDialog.show()}}),Core.Class.extend(Editor.Tools.Operate.prototype,{video:function(){window.VideoDialog&&window.VideoDialog.entity||(window.VideoDialog=new Editor.Utils.IframeDialog({url:"http://weibo.com/aj/video/upload?entry=blog",title:"插入视频",width:800,height:517,alpha:1}),window.VideoDialog.show(),window.insertVideoCallbackXHW=function(t){var e="tmp_id"+ +new Date;editor.insertHTML("<img src=\'http://simg.sinajs.cn/blog7style/images/common/editor/insetvideo2.gif\' width=\'482\' height=\'388\' id=\'"+e+"\' vid=\'"+t+"\'/>",{id:e,properites:{vid:t}}),$E("is_media").value="true",VideoDialog.reset()})}}),"undefined"==typeof Editor.Plugins&&(Editor.Plugins={}),scope.faceOperate={container_id:"face_container",show_dia_id:"show_dialog_id",hot_container:"fd_hot_list",hot_in_container:"fd_hot_in_list",high_container:"fd_high_list",in_container:"fd_in_list",high_page_container:"fd_high_page",in_page_container:"fd_in_page",tab_container:"fd_tab",high_content:"fd_tab_high_con",in_content:"fd_tab_in_con",pop:"371",high:"372",iny:"373",morehigh:"374",moreiny:"375",logType:{pop:[17,18,19,20,21,22,23,24,25],more:"26",tool:"27",dialog:"28"},highpage:55,inypage:8,inyCount:2,highCount:12,popCount:9,itemTemp:\'<li><a href="#" onclick="scope.faceOperate.toEditor();return false"><img title="#{name}" src="#{imgSrc}"></a></li>\',itemTemp_name:\'<li onclick="scope.faceOperate.toEditor()">#{divStart}<span><img onmouseover="scope.faceOperate.onmouseIn()" onmouseout="scope.faceOperate.onmouseOut()" title="#{name}" src="#{imgSrc}"></span><p onmouseover="scope.faceOperate.onmouseIn()" onmouseout="scope.faceOperate.onmouseOut()">#{name}</p>#{divEnd}</li>\',toEditor:function(){var t,e=Core.Events.getEventTarget(),i=this.getLiEle(e);t=$IE?i.innerText:i.textContent;var n=e.tagName.toLowerCase();"img"!=n&&(e=i.getElementsByTagName("img")[0]),this.sendLog(e);var o="";o=""==t?\'<img type="face" src="\'+e.src+\'">\':\'<img type="face" src="\'+e.src+\'">\'+t,editor.insertHTML(o);var s=winDialog.getDialog("face");s&&s.hidden()},sendLog:function(t){var e="08_",i=this.getLiEle(t),n=i.parentNode,o=/.*\\/(E[^\\.]*).gif/gi;if(n.id==this.container_id){for(var s=n.childNodes,a=s.length,r=0;a>r;r++)if(i==s[r]){e+=this.logType.pop[r];break}}else e+=this.logType.dialog;e+="_010_"+t.src.replace(o,"$1"),v7sendLog(e,scope.$pageid,"editorFace")},renderList:function(t,e,i,n){var o,s=e,a=n||1;o=new Ui.Template(i&&"name"==i?this.itemTemp_name:this.itemTemp);{var r,l,c,d,h="",u=this.getData(s).data;u.length}switch(s){case"morehigh":var p=(a-1)*this.highpage;r=u.slice(p,p+this.highpage),l=this.highpage;break;case"moreiny":var g=(a-1)*this.inypage;r=u.slice(g,g+this.inypage),l=this.inypage;break;case"iny":r=u.slice(0,this.inyCount);break;case"high":r=u.slice(0,this.highCount);break;case"pop":r=u.slice(0,this.popCount)}c=r,d=c.length,l||(l=d);for(var f=0,m=0;d>m;m++){var v={imgSrc:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/"+c[m].code+"G.gif",name:c[m].name};if("moreiny"==s?(v.divStart=\'<div class="facein_bg">\',v.divEnd="</div>"):(v.divStart="",v.divEnd=""),h+=o.evaluate(v),f>=l)break;f++}t.innerHTML=h},getData:function(t){return trace("getData:type:"+t),this.data[this[t]]},getLiEle:function(t){for(;;){var e=t.tagName.toLowerCase();if(trace(e),"li"==e)return t;t=t.parentNode}},onmouseIn:function(){var t=Core.Events.getEventTarget();this.getLiEle(t).className="hover"},onmouseOut:function(){var t=Core.Events.getEventTarget();this.getLiEle(t).className=""}},Core.Class.extend(Editor.Tools.Operate.prototype,{face:function(){v7sendLog("08_"+scope.faceOperate.logType.tool+"_000_000",scope.$pageid,"editorFace"),window.editorFace.showDialog()}}),Core.Class.extend(Editor.Tools.Operate.prototype,{justifyfull:function(){this.editor.history.add();for(var t=this.editor.iframeDocument.body,e=t.childNodes,i=0;i<e.length;i++)e[i].tagName?(e[i].innerHTML=e[i].innerHTML.split("&nbsp;").join(""),e[i].innerHTML=e[i].innerHTML.replace(/(^[ |　|]*)|([ |　|]*$)/g,""),e[i].innerHTML=e[i].innerHTML.split("").join("&nbsp;"),e[i].style.textIndent=e[i].style.textIndent?"":"2em"):t.innerHTML=\'<div style="text-indent:2em;">\'+t.innerHTML.replace(/(^[ |　]*)|([ |　]*$)/g,""),$IE&&this.editor.iframeDocument.selection.createRange().collapse(!1),this.editor.rangeCache.save()}}),Editor.Utils.EditorLayer=Core.Class.create(),Editor.Utils.EditorLayer.prototype={initialize:function(){this.initLayer()},initLayer:function(){var t=\'<div id="#{entity}" class="editor_tip"><div id="#{content}">dd</div></div>\';this.layer=new Ui.Panel,this.layer.setTemplate(t)},setContent:function(t){var e={};(new Date).toLocaleString().replace(/[(^\\s)*](\\d*:\\d*)/g,function(t,i){e.time=i}),e.tip=t||"";var i=new Ui.Template("<span>#{time}</span>#{tip}");this.layer.setContent(i.evaluate(e))},setPosition:function(){var t=$E("SinaEditor_Iframe"),e=Core.Dom.getLeft(t)+t.offsetWidth-this.layer.entity.offsetWidth-43,i=Core.Dom.getTop(t);this.layer.setPosition({x:e,y:i})},hidden:function(){this.layer.hidden(),this.isShow=!1},show:function(){this.isShow=this.isShow||!1,this.isShow?this.hidden():(this.layer.show(),this.setPosition(),this.isShow=!0)}},Core.Class.extend(Editor.Tools.Operate.prototype,{quickpost:function(){this.editor.post||(this.editor.post=!0,this.editor.disabledToolItem("quickpost"),this.editor.tipLayer||(this.editor.tipLayer=new Editor.Utils.EditorLayer),this.editor.tipLayer.setContent("博文保存中"),this.editor.tipLayer.show(),articlePostBtnFunc({callback:function(t){this.editor.tipLayer.hidden(),this.editor.tipLayer.setContent(\'<span>博文已经发表<span><a href="http://blog.sina.com.cn/s/blog_\'+t.data+\'.html" target="_blank">[查看]</a>\'),this.editor.tipLayer.show(),setTimeout(function(){this.editor.tipLayer.hidden()}.bind2(this),5e3)}.bind2(this),hiddenTip:function(){this.editor.tipLayer.hidden(),this.editor.disabledToolItem("quickpost",!0),this.editor.post=!1}.bind2(this)}))}}),Core.Class.extend(Editor.Tools.Operate.prototype,{quicksave:function(){this.editor.isSaveing||(this.editor.isSaveing=!0,this.editor.disabledToolItem("quicksave"),this.editor.tipLayer||(this.editor.tipLayer=new Editor.Utils.EditorLayer,this.editor.tipLayer.setContent("博文已经成功保存到草稿箱")),articlePosTempBtnFunc({callback:function(){this.editor.tipLayer.show(),setTimeout(function(){this.editor.tipLayer.hidden()}.bind2(this),5e3)}.bind2(this),hiddenTip:function(){this.editor.tipLayer.hidden(),this.editor.disabledToolItem("quicksave",!0),this.editor.isSaveing=!1}.bind2(this)}))}}),Core.Class.extend(Editor.Tools.Operate.prototype,{paste:function(){$IE?(this.editor.history.add(),this.editor.execCommand("paste")):winDialog.alert("您的浏览器安全设置不允许使用粘贴操作，请使用快捷键(Cmd/Ctrl+V)来完成。",{icon:"01"})}}),Core.Class.extend(Editor.Tools.Operate.prototype,{cut:function(){this.editor.history.add(),this.editor.execCommand("cut")}}),Core.Class.extend(Editor.Tools.Operate.prototype,{copy:function(){this.editor.history.add(),this.editor.execCommand("copy")}}),Core.Class.extend(Editor.Tools.Operate.prototype,{redo:function(){$IE?this.editor.history.redo():this.editor.execCommand("redo")}}),Editor.Tools.FontFamily=Core.Class.create(),Editor.Tools.FontFamily.prototype={initialize:function(t,e){this.stopEvent(),this.editor=t,this.layer=new Ui.Panel,this.layer.setTemplate(e),this.initElement(),this.setPosition()},initElement:function(){for(var t=["宋体","黑体","隶书","楷体_GB2312,楷体","幼圆","微软雅黑","Arial","Impact","Georgia","Verdana","Courier New","Times New Roman"],e=0;e<t.length;e++){var i=$C("a"),n=t[e],o={font:this.__getFont(t[e]),family:t[e]},s=n.split(",");s.length>1&&(o.family=s[1]),i.style.cssText="font-family:\'"+o.font+"\'",i.innerHTML=o.family,i.href="javascript:void(0);",i.onclick=function(){return!1},i.className="fontItem",Core.Events.addEvent(i,this.exec.bind2(this),"click"),this.layer.entity.appendChild(i)}},exec:function(){this.hidden();var t=this.getEventElement(),e=this.__getFont(t.innerHTML);if(this.editor.iframeWindow.focus(),$IE){this.editor.selectRange(),this.editor.execCommand("fontname","SinaEditor_Temp_FontName","");for(var i=this.editor.iframeDocument.body.getElementsByTagName("font"),n=i.length,o=null,s=0;n>s;s++)o=i[s],"SinaEditor_Temp_FontName"==o.getAttribute("face")&&(Core.Dom.setStyle(o,"fontFamily",e),o.removeAttribute("face"))}else this.editor.execCommand("fontname",e,!1);this.editor.swapToolStatus&&this.editor.swapToolStatus("family"),this.editor.iframeWindow.focus()},__getFont:function(t){var e="";switch(t){case"宋体":e="SimSun";break;case"微软雅黑":e="Microsoft YaHei";break;case"楷体":e="楷体_GB2312,楷体";break;default:e=t}return e}},Core.Class.extend(Editor.Tools.FontFamily.prototype,Editor.Tools.OperateLayer.prototype,!0),Core.Class.extend(Editor.Tools.Operate.prototype,{family:function(){this.layers.f?this.layers.show("f"):(this.layers.add("f",new Editor.Tools.FontFamily(this.editor,\'<div id="#{entity}" class="fontItemContent"><div id="#{content}" class="fontItemTitle">字体</div></div>\')),this.documentClickObserver||(this.documentClickObserver=new Editor.Utils.EventObserver(document,"click"),this.documentMousedownObserver=new Editor.Utils.EventObserver(this.editor.iframeDocument,"mousedown"),this.bodyClickObserver=new Editor.Utils.EventObserver(this.editor.iframeDocument.body,"click")),this.documentClickObserver.attach(this.layers.f.hidden.bind2(this.layers.f)),this.documentMousedownObserver.attach(this.layers.f.hidden.bind2(this.layers.f)),this.bodyClickObserver.attach(this.layers.f.hidden.bind2(this.layers.f)),this.layers.show("f"))}}),Core.Class.extend(Editor.Tools.Operate.prototype,{hilitecolor:function(){this.layers.hc?this.layers.show("hc"):(this.layers.add("hc",new Editor.Tools.SetColor(this.editor,\'<div id="#{entity}" class="colorItemContent"><div id="#{content}" class="colorItemTitle">颜色选取</div></div>\',"setBackgroundColor")),this.documentClickObserver||(this.documentClickObserver=new Editor.Utils.EventObserver(document,"click"),this.documentMousedownObserver=new Editor.Utils.EventObserver(this.editor.iframeDocument,"mousedown"),this.bodyClickObserver=new Editor.Utils.EventObserver(this.editor.iframeDocument.body,"click")),this.documentClickObserver.attach(this.layers.hc.hidden.bind2(this.layers.hc)),this.documentMousedownObserver.attach(this.layers.hc.hidden.bind2(this.layers.hc)),this.bodyClickObserver.attach(this.layers.hc.hidden.bind2(this.layers.hc)),this.layers.show("hc"))},setBackgroundColor:function(t){this.layers.hc.hidden(),$IE?this.editor.execCommand("backcolor",t):this.editor.execCommand("hiliteColor",t),this.editor.swapToolStatus("hilitecolor")}}),Core.Class.extend(Editor.Tools.Operate.prototype,{outdent:function(){this.editor.history.add(),this.editor.execCommand("outdent")}}),Core.Class.extend(Editor.Tools.Operate.prototype,{indent:function(){this.editor.history.add(),this.editor.execCommand("indent")}}),Core.Class.extend(Editor.Tools.Operate.prototype,{imgdefault:function(){var t=this.editor.getFocusElement();"img"==t.tagName.toLowerCase()&&(t.removeAttribute("align"),Core.Dom.setStyle(t,"display",""),Core.Dom.setStyle(t,"margin",""),Core.Dom.setStyle(t,"textAlign",""))}}),Core.Class.extend(Editor.Tools.Operate.prototype,{imgtop:function(){var t=this.editor.getFocusElement();"img"==t.tagName.toLowerCase()&&(t.removeAttribute("align"),Core.Dom.setStyle(t,"display","block"),Core.Dom.setStyle(t,"margin","0 auto"),Core.Dom.setStyle(t,"textAlign","center"))}}),Core.Class.extend(Editor.Tools.Operate.prototype,{imgleft:function(){var t=this.editor.getFocusElement();"img"==t.tagName.toLowerCase()&&(t.setAttribute("align","left"),Core.Dom.setStyle(t,"display",""),Core.Dom.setStyle(t,"margin",""),Core.Dom.setStyle(t,"textAlign",""))}}),Core.Class.extend(Editor.Tools.Operate.prototype,{imgright:function(){var t=this.editor.getFocusElement();"img"==t.tagName.toLowerCase()&&(t.setAttribute("align","right"),Core.Dom.setStyle(t,"display",""),Core.Dom.setStyle(t,"margin",""),Core.Dom.setStyle(t,"textAlign",""))}}),Core.Class.extend(Editor.Tools.Operate.prototype,{table:function(){window.tableDialog&&window.tableDialog.entity||(window.tableDialog=new Editor.Utils.IframeDialog({url:"http://control.blog.sina.com.cn/admin/ria/article_addM_table.html",title:"插入表格",width:311,height:256})),window.tableDialog.show()}}),Editor.Utils.CacheIframe=Core.Class.create(),Editor.Utils.CacheIframe.prototype={initialize:function(t){this.id=Core.Math.getUniqueId(),this.initHtml(),t&&""!=t&&this.setUrl(t)},initHtml:function(){var t=\'<iframe id="cache_iframe_#{id}" style="visibility: hidden; position: absolute; top: -1000px; left: -1000px;"></iframe>\',e=new Ui.Template(t);Core.Dom.addHTML(document.body,e.evaluate({id:this.id}))},setUrl:function(t){$E("cache_iframe_"+this.id).src=t},get:function(){return $E("cache_iframe_"+this.id)}};var $SYSMSG={};if($SYSMSG.extend=function(t,e){for(var i in t)$SYSMSG[i]=0==!!e?t[i]:$SYSMSG[i]},$SYSMSG.extend({B01001:"标题必须是48个中文或96个字符以内，请重新输入。",B02001:"请输入内容。",B02002:"博文内容超过容量限制，请重新编辑。 <br/><span style=\'font-size: 12px; font-weight: normal;\'>博文内容最多允许1万汉字，2万字符。</span>",B02003:"是否要清除格式？粘帖的内容中含有冗余的格式，会影响在博客中的排版。",B02004:"上次撰写的博文未进行保存，要恢复内容继续编辑吗？",B02005:\'您提交的内容中含有广告等不适当内容，"确认"后将被清除！\',B03001:"标签总字数必须是30个中文或60个字符以内，请重新输入。",B03002:"标签个数必须是5个以内，请重新输入。",B03003:"每个标签字数必须是7个中文或14个字符以内，请重新输入。",B03105:"无法提取到有效标签，请手动输入些标签：如“体育、生活”。",B03106:"博文内容必须大于20个中文或40个字符，才能提取有效标签。",B03107:"博文内容必须大于20个中文或40个字符，才能提取有效标签。",B04001:"发布时间不能超出当前时间，请重新输入。",B04002:"抱歉,请选择“我记录”活动投稿类别。",B04022:"标签总字数必须是30个中文或60个字符以内，请重新输入。",B06001:"博文已发布成功。",B06011:"博文已发布成功。",B06012:"博文已发布成功。",B06002:"博文已发布，稍后显示，请耐心等待一下。",B06003:"博文已成功保存到草稿箱。",B06004:"您的博文已经发表成功，目前已经进入后台审核中。审核时间为12小时，请耐心等候。",B07001:"博文发布失败，请梢后再试。建议先将内容拷贝到本地硬盘备份。",B07003:"博文保存失败，请梢后再试。建议先将内容拷贝到本地硬盘备份。",B07004:"博文保存失败，请梢后再试。建议先将内容拷贝到本地硬盘备份。",B07005:"您短时间发表文章过多，请稍后再试",B08001:"不能一分钟内连续发博文，请稍后再试。",B08002:"发布中，请稍候…",B08003:"保存中，请稍候…",B08004:"由于网络原因上传失败，请稍后再试。或者尝试使用<a href=\'http://photo.blog.sina.com.cn/upload/upload_html.php\'>旧版网页上传</a>。",B08005:"由于网络原因上传失败，请稍后再试。",B36101:"文章不存在",B78001:"选择已达相关博文上限！请删除一些再勾选",B79001:\'音乐地址要求是mp3格式，请重新输入！或者直接去<a onclick="scope.musicOperate.showStore();return false;" href="#">新浪乐库</a>中搜索。\',B79002:\'音乐地址要求以http://开始，请重新输入！或者直接去<a onclick="scope.musicOperate.showStore();return false;" href="#">新浪乐库</a>中搜索。\',B79003:"是否要删除背景音乐？",B79004:"是否要删除相关博文？",B79005:"在模板中只能插入一张图片。",B79006:"每次最多只能插入20张图片。<br/>请先完成图片添加，再插入新图片",B79007:"<strong>此分类尚无博文，请选择其他分类</strong>",B79008:"<strong>尚无博文</strong>",B79009:"是否要删除推荐活动？",B89001:"请输入文章内容。",B89002:"正文内空转码失败。",B89003:"服务分析出错。",B89004:"没有找到匹配的歌曲名。",B89005:"为了保证您的博文打开速度，每篇博文最多只能插入3个音乐播放器。",B89006:"每个播放器最多只能添加20首歌",B89007:"歌曲已成功添加！<br/>但添加至上一个播放器，仅在当本博文中已有播放器时适用。",B89008:"歌曲已成功添加！<br/>但插入歌词功能仅在插入单首歌曲时可用。",B89009:"请输入搜索内容",B89011:"抱歉，您还没有选择音乐，请至少选择一首。",B89012:\'博文中无可识别的歌曲名。<br/><span style="color:#999">帮助：此功能会根据您输入的博文内容，自动识别出您博文内容中出现的歌曲名，并为此歌曲名匹配相应试听链接，浏览者即可一键轻松试听您博文中的音乐。</span>\',B89013:"已成功添加至上一个播放器中！",B79010:"请在图片上传完成后再进行添加。",A00200:"您输入的内容包含非法字符"}),Editor.Utils.FormatDoc=Core.Class.create(),Editor.Utils.FormatDoc.prototype={reg:/<\\w[^>]* class="?(MsoNormal)|(MsoTitle)"?/gi,initialize:function(t,e){this.editor=e,this.cache=new Editor.Utils.CacheIframe(this.editor.iframeUrl),t.body.onbeforepaste=function(){this.operate()}.bind2(this)},format:function(t){return t=t.replace(/<\\/?SPAN[^>]*>/gi,""),t=t.replace(/<(\\w[^>]*) class=([^ |>]*)([^>]*)/gi,"<$1$3"),t=t.replace(/<(\\w[^>]*) style="([^"]*)"([^>]*)/gi,"<$1$3"),t=t.replace(/<(\\w[^>]*) lang=([^ |>]*)([^>]*)/gi,"<$1$3"),t=t.replace(/<\\\\?\\?xml[^>]*>/gi,""),t=t.replace(/<\\/?\\w+:[^>]*>/gi,""),t=t.replace(/<img+.[^>]*>/gi,"")},getPasteData:function(){var t=this.cache.get();if(tlf=t.contentWindow.document,tlf.body.innerHTML="",!tlf.body.createTextRange)return"";tlf.body.createTextRange().execCommand("Paste");var e=tlf.body.innerHTML,i=e.indexOf("&nbsp;");0==i&&(e=e.replace(/\\&nbsp;/i,""));var n=e;return tlf.body.innerHTML="",n},isDoc:function(t){return t=t||this.getPasteData(),this.reg.test(t)},operate:function(){var t=this.getPasteData();this.isDoc(t)&&(clipboardData.setData("text",""),winDialog.confirm($SYSMSG.B02003,{funcOk:function(){t=this.format(t),this.editor.insertHTML(t)}.bind2(this),funcCancel:function(){t=t.replace(/<img+.[^>]*>/gi,""),t=t.replace(/<\\/?\\w+:imagedata[^>]*>/gi,""),t=t.replace(/<\\/?\\w+:shape[^>]*>/gi,""),this.editor.insertHTML(t)}.bind2(this),textOk:"是",textCancel:"否",defaultButton:1,title:"提示",icon:"03"}))}},$SYSMSG.extend({B88001:"备孕宝贝时间出错",B88002:"宝贝预产期错误",B88003:"宝贝昵称 字符过长",B88004:"宝贝昵称  为空",B88005:"宝宝昵称 非法",B88006:"宝贝性别 有误",B88007:"宝贝生日  有误",B88008:"系统异常"}),Editor.BlogEditor=Core.Class.create(),Editor.BlogEditor.prototype={baseTools:null,proTools:null,type:"blogEditor",toolType:"base",initialize:function(t){if(t&&t.iframe_container){this._focusElementId=t.focusElementId,this._addOperateToOnload(this.addEventsToBody.bind2(this)),this._addOperateToOnload(this.addEventsToDocument.bind2(this)),this._addOperateToOnload(this.initToosStatus.bind2(this)),this._addOperateToOnload(function(){this.formatDoc=new Editor.Utils.FormatDoc(this.iframeDocument,this)}.bind2(this)),this.initTextArea($E(t.textarea)),this._initIframe($E(t.iframe_container),t.iframe_cls),this.operate=new Editor.Tools.Operate(this),this.history=new Editor.Utils.EditorHistory(this,50),this.rangeCache=new Editor.Utils.RangeCache(this),this.initTool(),this.initModeSwap(t.checkbox),this.initHeightModeSwap(t.heightModeId),"edit"!=t.mode&&this.swapMode(),this.swapTools(t.toolType),this.imageOperate=new Editor.Utils.ImageOperate,this.userData=new Utils.UserData;var e=this;if(Core.Events.addEvent(window,function(){e.baseTools.setShutOutProperty(e.baseTools.container.parentNode),e.proTools.setShutOutProperty(e.proTools.container.parentNode)},"resize"),t.checkbox){var i=$E(t.checkbox);i&&(i.checked=!1)}}},redoData:function(){var t=this.userData.load("blog_user_data_"+scope.$uid,["content"]);if(t&&t.content&&""!=t.content){if(scope.$user_channel&&2===parseInt(scope.$user_channel))return void this.userData.clear("blog_user_data_"+scope.$uid,["content"]);winDialog.confirm($SYSMSG.B02004,{funcOk:function(){this.iframeDocument.body.innerHTML=t.content,this.userData["blog_user_data_"+scope.$uid]=!0,this.userData.clear("blog_user_data_"+scope.$uid,["content"])}.bind2(this),textOk:"是",textCancel:"否",funcCancel:function(){this.userData.clear("blog_user_data_"+scope.$uid,["content"])}.bind2(this),defaultButton:1,title:"提示",icon:"04"})}},initTool:function(){var t="ico_#{operate}_#{num}",e={classTemplate:t,tools:{undo:{title:"撤销（Ctrl+Z）"},bold:{title:"加粗"},italic:{title:"斜体"},underline:{title:"下划线"},fontsize:{title:"字号",inner:"<div>14px</div>"},forecolor:{title:"文字颜色",style:"background-color:#000;"},link:{title:"插入链接"},justifyleft:{title:"左对齐"},justifycenter:{title:"居中对齐"},justifyright:{title:"右对齐"},marklist:{title:"项目符号"},numberlist:{title:"编号"},img:{title:"插入图片"},video:{title:"插入视频"},face:{title:"插入表情"},justifyfull:{title:"自动排版"},quicksave:{title:"快速保存（Ctrl+S）",style:"display:none"},quickpost:{title:"快速发表",style:"display:none"}}},i={classTemplate:t,tools:{group_1:{cls:"ctl_grp",items:{paste:{title:"粘贴（Ctrl+V）"},cut:{title:"剪切（Ctrl+X）"},copy:{title:"复制（Ctrl+C）"}}},group_2:{cls:"undo_grp",items:{redo:{title:"重做（Ctrl+Y）"},undo:{title:"撤销（Ctrl+Z）"}}},group_3:{cls:"font_grp",items:{family:{title:"字体",inner:" <div>"+(scope.$newFontFamily?"微软雅黑":"宋体")+"</div>"},fontsize:{title:"字号",inner:"<div>14px</div>"},bold:{title:"加粗"},italic:{title:"斜体"},underline:{title:"下划线"},forecolor:{title:"文字颜色",style:"background-color:#000;"},hilitecolor:{title:"背景颜色",style:"background-color:#fff;"},link:{title:"插入链接"}}},group_4:{cls:"format_grp",items:{marklist:{title:"项目符号"},numberlist:{title:"编号"},outdent:{title:"减少缩进"},indent:{title:"增加缩进"},imgdefault:{title:"默认排版"},imgtop:{title:"图片居中排版"},justifyleft:{title:"左对齐"},justifycenter:{title:"居中对齐"},justifyright:{title:"右对齐"},space:{title:""},imgleft:{title:"图片居左混排"},imgright:{title:"图片居右混排"}}},group_5:{cls:"media_grp",items:{img:{title:"插入图片"},video:{title:"插入视频"},face:{title:"插入表情"},table:{title:"插入表格"}}},group_6:{cls:"ext_grp",items:{justifyfull:{title:"自动排版"}}},group_7:{cls:"ext_grp",items:{quickpost:{title:"快速发表",style:"display:none"},quicksave:{title:"快速保存（Ctrl+S）",style:"display:none"}}}}};this.baseTools=new Editor.Tools.Tool("base_tools",e),this.proTools=new Editor.Tools.Tool("pro_tools",i),this.baseTools.setOperate(this.operate),this.baseTools.initElements(),this.proTools.setOperate(this.operate),this.proTools.initElements();var n=Core.Function.bind3;Core.Events.addEvent("SinaEditor_Baselink",n(this.swapTools,this,["base"])),Core.Events.addEvent("SinaEditor_Prolink",n(this.swapTools,this,["pro"]))},swapShutOut:function(t){"base"==this.toolType?"edit"==t?(this.baseTools.setShutOutProperty(),this.baseTools.shutOut.show()):this.baseTools.shutOut.hidden():"edit"==t?(this.proTools.setShutOutProperty(),this.proTools.shutOut.show()):this.proTools.shutOut.hidden(),this.rightMenuShutOut||(this.rightMenuShutOut=new Editor.Utils.ShutOut,this.rightMenuShutOut.setProperty($E("editor_box_right")),Core.Events.addEvent(window,function(){this.rightMenuShutOut.setProperty($E("editor_box_right"))}.bind2(this),"resize")),"edit"==t?(this.rightMenuShutOut.setProperty($E("editor_box_right")),this.rightMenuShutOut.show()):this.rightMenuShutOut.hidden()},getToolElement:function(t,e){var i;return i="base"==t?this.baseTools.id:this.proTools.id,$E(e+"_"+i)},initToosStatus:function(){var t=setInterval(function(){this.baseTools&&this.proTools&&(this.baseToolStatus=new Editor.Tools.Status(this.baseTools.id,this,["bold","italic","underline","fontsize"]),this.preToolStatus=new Editor.Tools.Status(this.proTools.id,this),Core.Events.addEvent(this.iframeDocument.body,this.baseToolStatus.checkAllStatus.bind2(this.baseToolStatus),"mouseup"),Core.Events.addEvent(this.iframeDocument.body,this.preToolStatus.checkAllStatus.bind2(this.preToolStatus),"mouseup"),clearInterval(t))}.bind2(this),50)},swapToolStatus:function(t,e){"base"==this.toolType?this.baseToolStatus.setToolItemStatus(t,e):this.preToolStatus.setToolItemStatus(t,e)},initModeSwap:function(t){var e=$E(t);e.disabled&&(e.disabled=!1),Core.Events.addEvent(t,this.swapMode.bind2(this),"click")},initHeightModeSwap:function(t){Core.Events.addEvent(t,this.swapHightMode.bind2(this),"click")},addEventsToBody:function(){Core.Events.addEvent(this.iframeDocument.body,this.rangeCache.save.bind2(this.rangeCache),"mouseup")},addEventsToDocument:function(){function t(){!this.op_hidden&&this.imageOperate.isShow&&(setTimeout(function(){this.imageOperate.hidden(),this.op_hidden=!1}.bind2(this),1e3),this.op_hidden=!0)}var e;Core.Events.addEvent(this.iframeDocument,function(){this.closeConfirm(),clearTimeout(e),e=setTimeout(function(){this.rangeCache.save()}.bind2(this),500)}.bind2(this),"mouseup"),Core.Events.addEvent(this.iframeDocument,function(t){return this.closeConfirm(),83==t.keyCode&&t.ctrlKey?($IE||Core.Events.stopEvent(),void(this.saveType&&this.operate[this.saveType]())):t.ctrlKey&&90==t.keyCode?void($IE&&this.operate.undo()):t.ctrlKey&&89==t.keyCode?void($IE&&this.operate.redo()):void this.imageOperate.hidden()}.bind2(this),"keyup");var i;Core.Events.addEvent(this.iframeDocument,function(t){t.ctrlKey&&90==t.keyCode||t.ctrlKey||(this.initUserData||(this.initUserData=!0,setInterval(function(){this.iframeDocument.body.innerHTML.length<4e4&&this.userData.save("blog_user_data_"+scope.$uid,{content:this.iframeDocument.body.innerHTML})}.bind2(this),6e4)),clearTimeout(i),i=setTimeout(function(){this.history.add(),this.rangeCache.save()}.bind2(this),500))}.bind2(this),"keydown"),$IE?Core.Events.addEvent(this.iframeWindow,t.bind2(this),"scroll"):Core.Events.addEvent(this.iframeDocument,t.bind2(this),"scroll")},initImageOpertae:function(){if(!this.isInitImageOpertae){if(!this.iframeDocument)return;Core.Events.addEvent(this.iframeDocument.body,function(t){var e=t.target||t.srcElement;"img"==e.tagName.toLowerCase()&&(this.imageDrag?this.imageDrag.drag(t):this.imageDrag=new Editor.Utils.ImageDrag(this))}.bind2(this),"mousedown"),Core.Events.addEvent(this.iframeDocument.body,function(t){var e=t.target||t.srcElement;"img"==e.tagName.toLowerCase()?"articleTemplate"!=e.name.split("_")[0]&&(editor.templateImageId=e.id="image_operate_"+Core.Math.getUniqueId(),this.imageOperate.show(e)):this.imageOperate.hidden()}.bind2(this),"mousemove"),this.isInitImageOpertae=!0}},initTemplateImage:function(){if(this.initImageOpertae(),!this.isInitTemplateImage){if(!this.iframeDocument)return;Core.Events.addEvent(this.iframeDocument.body,function(t){var e=t.target||t.srcElement;"img"==e.tagName.toLowerCase()&&(this.imageDrag?this.imageDrag.drag(t):this.imageDrag=new Editor.Utils.ImageDrag(this),"articleTemplate"==e.name.split("_")[0]&&(e.id=e.name),"articleTemplate"==e.id.split("_")[0]&&(editor.templateImageId=e.id,t.cancelBubble=!0,t.returnValue=!1,window.templateDialog||(window.templateDialog=new Editor.Utils.IframeDialog({url:"http://control.blog.sina.com.cn/admin/ria/article_addM_image.php?type=1",title:"插入图片",width:660,height:450,dialogName:"templateDialog"})),window.templateDialog.show()))}.bind2(this),"dblclick"),this.isInitTemplateImage=!0}},swapTools:function(t){"pro"==t?(this.baseTools.hidden(),this.proTools.show(),Utils.Cookie.setCookie("EditorToolType","pro"),this.toolType="pro"):(this.proTools.hidden(),this.baseTools.show(),Utils.Cookie.setCookie("EditorToolType","base"),this.toolType="base")},disabledToolItem:function(t,e){e?(this.proTools.setButtonState(t,1),this.baseTools.setButtonState(t,1)):(this.proTools.setButtonState(t,4),this.baseTools.setButtonState(t,4))},setSourceValue:function(){"edit"==this.modeType&&(this.frameToArea(),this.textarea.value=this.iframeDocument.body.innerHTML.replace(/title="?双击图片可进行替换"?/gi,""))},swapHightMode:function(){var t=!1,e=$E("editor_box_right"),i=this.iframe.className,n=this.textarea.className,o=e.className,s=i.split("_"),a=n.split("_"),r=o.split(" "),l=Core.Events.getEventTarget();if(s.length>1&&"h"==s[s.length-1]&&(t=!0),t?(s.pop(),a.pop(),r.pop(),this.iframe.className=s.join("_"),this.textarea.className=a.join("_"),e.className=r.join(" "),l.innerHTML="扩大编辑区域 "):(this.iframe.className=i+"_h",this.textarea.className=n+"_h",e.className=o+" EditorBoxRight_h",l.innerHTML="缩小编辑区域 "),this.rightMenuShutOut){var l=$E("editor_box_right");this.rightMenuShutOut.setSize(l.offsetWidth,l.offsetHeight)}},checkStock:function(){var t=0;return/stock_image_\\d{15,25}/g.test(this.iframeDocument.body.innerHTML)&&(t=1),t},getMediaTag:function(){for(var t=this.iframeDocument.getElementsByTagName("img"),e=t.length,i="http://simg.sinajs.cn/blog/images/face/",n="sina.com.cn/myshow/blog/misc/gif/",o="simg.sinajs.cn/blog7style/images/common/worldcup",s="simg.sinajs.cn/blog7style/images/common/sg_trans.gif",a=i.length,r=0,l=0,c=0;e>c&&0==r;c++)-1==t[c].src.indexOf(o)&&-1==t[c].src.indexOf(n)&&t[c].src.substr(0,a)!=i&&"http://simg.sinajs.cn/blog7style/images/common/editor/insetvideo.gif"!=t[c].src&&-1==t[c].src.indexOf(s)&&(t[c].getAttribute("type")||"face"==t[c].getAttribute("type")||(r=1)),"http://simg.sinajs.cn/blog7style/images/common/editor/insetvideo.gif"==t[c].src&&(l=1);var d=this.iframeDocument.getElementsByTagName("object");d.length>0&&(l=1);var d=this.iframeDocument.getElementsByTagName("embed");return d.length>0&&(l=1),[r,l]},closeConfirm:function(){this.isCloseConfirm||(this.isCloseConfirm=!0)},_setEditorHTML:function(t){var e="";return e+="<html>",e+="<head>",e+=\'<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\',e+="<style>",e+="p {*margin:0.2em auto;}",e+="body {\t\t\tmargin: 0;\t\t\tscrollbar-face-color: #ffffff;\t\t\tscrollbar-highlight-color: #ffffff;\t\t\tscrollbar-shadow-color: #c0c1bb;\t\t\tscrollbar-3dlight-color: #c0c1bb;\t\t\tscrollbar-arrow-color: #c9cbb6;\t\t\tscrollbar-track-color: #f4f5f0;\t\t\tscrollbar-darkshadow-color: #ffffff;\t\t\tscrollbar-base-color: #ffffff;\t\t\tpadding: 10px;\t\t\tword-wrap: break-word;\t\t\toverflow: scroll;\t\t\toverflow-x: auto;\t\t\theight: 90%;\t\t\tfont-size: 14px;\t\t}",e+="body, td, textarea, input, br, div, span{",e+="\tfont-family: "+(scope.$newFontFamily?"\'Microsoft YaHei\',":"")+"\'SimSun\', Verdana,Arial, Helvetica, sans-serif;",e+="\tline-height:1.5;",e+="}",e+="img{\t\t\tborder: 0;\t\t}\t\thtml{\t\t\theight: 100%;\t\t\tcursor: text;\t\t}\t\tpre{\t\t\twhite-space:normal;\t\t}\t\tins{\t\t\twidth:0px;\t\t\theight:0px;\t\t\toverflow:hidden;\t\t\tposition:absolute;\t\t}\t\tform{margin: 0;}\t\tbody table{font-size: 14px;}\t\t.border{ border:1px dashed #cfcfcf;}\t\t</style>",e+="</head>",e+="<body>",e+=t,e+="</body>",e+="</html>"\n}},Core.Class.extend(Editor.BlogEditor.prototype,Editor.AbstractStandard.prototype,!0),$registJob("editor",function(){var t={iframe_container:"SinaEditor_Iframe",iframe_cls:"iframe",textarea:"SinaEditorTextarea",checkbox:"SinaEditor_59_viewcodecheckbox",heightModeId:"height_mode"};window.editor=new BlogEditor(t)}),Core.String.byteLength=function(t){if("undefined"==typeof t)return 0;var e=t.match(/[^\\x00-\\x80]/g);return t.length+(e?e.length:0)},Core.String.trimHead=function(t){return t.replace(/^(\\u3000|\\s|\\t)*/gi,"")},Core.String.trimTail=function(t){return t.replace(/(\\u3000|\\s|\\t)*$/gi,"")},Core.String.trim=function(t){return Core.String.trimHead(Core.String.trimTail(t))},$registJob("editor_tag",function(){function t(){u.value==articleEditorCFG.dftTagValue&&(u.value=""),u.style.color="#000",Core.Events.removeEvent(u,t,"click")}var e=function(t,e){for(var i=t.split(""),n=new Array,o=-1,s=0,a=0;a<i.length;a++)o=Core.String.byteLength(i[a]),e>=s+o&&(n[n.length]=i[a],s+=o);return n.join("")},i=60,n=!1;scope.noDisplayPageId={editor_film:1,nineGrid:1},window.currentTag="例如：高考 互联网 影评 李宇春 情感 口述实录 越狱 老照片",2==scope.$user_channel&&(articleEditorCFG.dftTagValue="例如：宝宝 满月 照片 4岁 生日 妈妈 全家福",currentTag="例如：宝宝 满月 照片 4岁 生日 妈妈 全家福"),"editor_film"==scope.$pageid&&(articleEditorCFG.dftTagValue="影评 ",currentTag="影评 ",$E("articleTagInput").value&&(articleEditorCFG.dftTagValue=$E("articleTagInput").value,currentTag=$E("articleTagInput").value,$E("articleTagInput").style.color="#333")),"nineGrid"==scope.$pageid&&(articleEditorCFG.dftTagValue="九宫格日记 ",currentTag="九宫格日记 ",$E("articleTagInput").style.color="#333");var o={filter:function(){for(var t=o.format(u.value),n=-1,s=new Array,a=0,r=i,l="",c=0;c<t.length;c++)n=Core.String.byteLength(t[c]),r>=a+n?(""!=t[c]&&(s[s.length]=t[c]),a+=n):(l=e(t[c],r-a),""!=l&&(s[s.length]=l),a=r);u.value=s.join(" ")},format:function(t){var e=Core.String.trim(t),i=e.replace(/ |;|；|　/g,",").split(",");return i},addTag:function(t){for(var e=o.format(u.value),i=new Array,n=!1,s=0;s<e.length;s++)""!=e[s]&&(t==e[s]&&(n=!0),i[i.length]=e[s]);0==n&&(u.value=i.join(" ")+" "+t),o.filter()},focus:function(){m=Core.Dom.getXY(u),$E("articleTagInput").style.color="#000","block"!=p.style.display&&scope.noDisplayPageId[scope.$pageid]&&$E("articleTagInput").select(),Core.Dom.setStyle(p,"display","block"),n||Core.String.trim($E("articleTagInput").value)!=Core.String.trim(currentTag)||scope.noDisplayPageId[scope.$pageid]||($E("articleTagInput").value="")},blur:function(){return""==$E("articleTagInput").value&&(scope.noDisplayPageId[scope.$pageid]||($E("articleTagInput").style.color="#ccc",$E("articleTagInput").value=currentTag),n=!1),1!=o.isClick?(Core.Dom.setStyle(p,"display","none"),u.value=o.format(u.value).join(" "),o.filter(),!1):void 0},keyup:function(){var t=Core.String.byteLength(o.format(u.value).join(""));t>i&&o.filter(),n=!0},submit:function(){},isClick:!1};window.TagFuncs=o;for(var s=new Array,a=$E("userTagList"),r=articleEditorCFG.articleAllTagList.user,l=0;l<r.length;l++)s[s.length]="<a href=\'javascript:void(0);\' onclick=\'return false\'  onmousedown=\'window.TagFuncs.addTag(\\""+r[l]+"\\");\'>"+r[l]+"</a>&nbsp;";a.innerHTML=s.join("");for(var c=new Array,d=$E("hotTagList"),h=articleEditorCFG.articleAllTagList.hot,l=0;l<h.length;l++)c[c.length]="<a style=\'color: #ff6600;  margin-right: 4px;\' onclick=\'return false\' href=\'javascript:void(0);\' onmousedown=\'window.TagFuncs.addTag(\\""+h[l].label+"\\");\'>"+h[l].label+"</a><a target=\'_blank\' style=\'color: #7E7E7E; margin-right: 10px;\' href=\'"+h[l].link+" \'>(话题排行榜)</a>&nbsp;";h.length>0&&(c[c.length]="<br/>");for(var h=articleEditorCFG.articleAllTagList.tag_Recommend,l=0;l<h.length;l++)c[c.length]="绿丝带"==h[l]?"<a style=\'color: green;\' title=\'绿丝带在行动：每个人都是抗灾最前线！\' href=\'javascript:void(0);\' onclick=\'return false\' onmousedown=\'window.TagFuncs.addTag(\\""+h[l]+"\\");\'>"+h[l]+"</a>&nbsp;":"<a href=\'javascript:void(0);\' onclick=\'return false\' onmousedown=\'window.TagFuncs.addTag(\\""+h[l]+"\\");\'>"+h[l]+"</a>&nbsp;";d.innerHTML=c.join(""),articleEditorCFG.dftTagValue=currentTag;var u=$E("articleTagInput");u.value=articleEditorCFG.articleTagList||articleEditorCFG.dftTagValue,"1"!=articleEditorCFG.articleStatus||scope.noDisplayPageId[scope.$pageid]||(u.style.color="#ccc"),scope.noDisplayPageId[scope.$pageid]||Core.Events.addEvent(u,t,"click");{var p=$E("articleTagList"),g=$E("tagListClose"),u=$E("articleTagInput"),f=($E("componentSelect"),$E("articleTagAutoSub")),m=[];u.offsetHeight}Core.Events.addEvent(u,o.focus.bind2(u),"focus"),Core.Events.addEvent(u,o.focus.bind2(u),"click"),Core.Events.addEvent(u,o.blur.bind2(u),"blur"),Core.Events.addEvent(g,function(){Core.Events.stopEvent(),Core.Dom.setStyle(p,"display","none"),u.value=o.format(u.value).join(" "),o.filter()},"click"),Core.Events.addEvent(u,o.keyup.bind2(u),"keyup"),Core.Events.addEvent(p,function(){o.isClick=!0,setTimeout(function(){o.isClick=!1},100)}.bind2(u),"mousedown"),Core.Events.addEvent(u,o.submit.bind2(f),"click")}),$SYSMSG.extend({A00001:"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电4006900000。",A00002:"很抱歉，您的IP出现异常，请稍后再试",A00003:"无权限进行此操作，请重新登录。",A00004:"无权限进行此操作，请重新登录。",A00005:"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电4006900000。",A00006:"操作成功",A00007:"无权限进行此操作，请重新登录。",A00009:"网络繁忙，请稍后再试",A00010:"无升级权限",A11007:"你还未开通新浪博客，请先<a href=\'http://login.sina.com.cn/hd/reg_sec.php?entry=blog\'> 开通博客</a>",A00800:"对不起，您短时间点击喜欢过多，请多休息，注意身体！感谢您对新浪博客的支持和关注！"}),Core.String.leftB=function(t,e){var i=t.replace(/\\*/g," ").replace(/[^\\x00-\\xff]/g,"**");return t=t.slice(0,i.slice(0,e).replace(/\\*\\*/g," ").replace(/\\*/g,"").length),Core.String.byteLength(t)>e&&(t=t.slice(0,t.length-1)),t},Core.Dom.removeNode=function(t){t=$E(t)||t;try{t.parentNode.removeChild(t)}catch(e){}},Core.Dom.getElementsByClass=function(t,e,i){t=t||document;var n=[];i=" "+i+" ";for(var o=t.getElementsByTagName(e),s=o.length,a=0;s>a;++a){var r=o[a];if(1==r.nodeType){var l=" "+r.className+" ";-1!=l.indexOf(i)&&(n[n.length]=r)}}return n},Core.Dom.byClz=Core.Dom.getElementsByClass,Utils.Io.Ijax={arrTaskLists:[],createLoadingIframe:function(){if(null!=this.loadFrames)return!1;var t="loadingIframe_thread"+Math.ceil(1e4*Math.random()),e="loadingIframe_thread"+Math.ceil(1e4*(Math.random()+1));this.loadFrames=[t,e];var i=\'<iframe id="\'+t+\'" name="\'+t+\'" class="invisible"\t              scrolling="no" src=""\t              allowTransparency="true" style="display:none;" frameborder="0"\t              ></iframe>\t\t\t\t  <iframe id="\'+e+\'" name="\'+e+\'" class="invisible"\t              scrolling="no" src=""\t              allowTransparency="true" style="display:none;" frameborder="0"\t              ></iframe>\',n=$C("div");n.id="ijax_iframes",n.innerHTML=i,trace("创建 Ijax 需要的 iframe"),document.body.appendChild(n);var o=setInterval(Core.Function.bind2(function(){null!=$E(this.loadFrames[0])&&null!=$E(this.loadFrames[1])&&(clearInterval(o),o=null,this.loadingIframe={thread1:{container:$E(this.loadFrames[0]),isBusy:!1},thread2:{container:$E(this.loadFrames[1]),isBusy:!1}},this.loadByList())},this),10)},isIjaxReady:function(){if("undefined"==typeof this.loadingIframe)return!1;for(var t in this.loadingIframe)if(0==this.loadingIframe[t].isBusy)return this.loadingIframe[t].isBusy=!0,this.loadingIframe[t];return!1},request:function(t,e){var i={};i.url=t,i.option=e||{},this.arrTaskLists.push(i),null==this.loadFrames?this.createLoadingIframe():this.loadByList()},loadByList:function(){if(0==this.arrTaskLists.length)return!1;var t=this.isIjaxReady();if(0==t)return!1;var e=this.arrTaskLists[0];this.loadData(e.url,e.option,t),this.arrTaskLists.shift()},loadData:function(t,e,i){var n=new Utils.Url(t);if(e.GET)for(var o in e.GET)n.setParam(o,Core.String.encodeDoubleByte(e.GET[o]));/\\bdomain\\b/.test(t)||n.setParam("domain","1"),n=n.toString();var s=i.container;if(s.listener=Core.Function.bind2(function(){try{var t,o=s.contentWindow.document,a=Core.Dom.byClz(o,"textarea","")[0];t="undefined"!=typeof a?a.value:o.body.innerHTML,e.onComplete?e.onComplete(t):e.onException()}catch(r){traceError(r),e.onException&&e.onException(r.message,n.toString())}i.isBusy=!1,Core.Events.removeEvent(s,s.listener,"load"),this.loadByList()},this),Core.Events.addEvent(s,s.listener,"load"),e.POST){var a=$C("form");a.id="IjaxForm",a.action=n,a.method="post",a.target=s.id;for(var r in e.POST){var l;l=e.noEncode?Core.String.encodeDoubleByte(e.POST[r]):e.POST[r];var c=$C("input");c.type="hidden",c.name=r,c.value=l,a.appendChild(c)}document.body.appendChild(a),a.submit()}else try{window.frames(s.id).location.href=n}catch(d){s.src=n}}},"undefined"==typeof App)var App={};App.getArticlesSort=function(t,e){e=e||scope.$uid;var i=$C("script");Lib.checkAuthor(),i.src="http://comet.blog.sina.com.cn/api?maintype=acate&varname=x&uid="+e,i.charset="utf-8",i.onload=i.onerror=i.onreadystatechange=Core.Function.bind2(function(){i&&i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(App.ArticlesSort=x,null!=t&&t(App.ArticlesSort),i.onload=i.onreadystatechange=i.onerror=null,i.src="",i.parentNode.removeChild(i),i=null)},this),document.getElementsByTagName("head")[0].appendChild(i)};var cateDialog=Core.Class.create();cateDialog.prototype={uid:"",initialize:function(t){this.action=t||!1},show:function(t){this.uid=t||scope.$uid,this.initDialog(),this.dialog.show(),this.dialog.setFixed(!0),this.dialog.setAreaLocked(!0),this.dialog.setMiddle()},initDialog:function(){var t=this,e={width:492,height:0,url:"http://control.blog.sina.com.cn/admin/article/article_class_list.php?"+(this.action?"action=editor":"")};Lib.checkAuthor(),this.url="http://control.blog.sina.com.cn/admin/article/article_class_save2.php?uid="+$UID+(this.action?"&action=editor":""),this.id=Core.Math.getUniqueId(),this.manage=null,this.manage=new cateMng(this.id,this.itemTpl,this.uid),this.manage.onSuccess=function(e){t.onSuccess(e)};var i=new Ui.Template("<div style=\'width: #{width}px; height: #{height}px;\' id=\'category_"+this.id+"\'></div>"),n={ad:!1,drag:!0,title:"分类管理",content:i.evaluate(e),shadow:1,width:e.width,height:e.height},o={},s=winDialog.createCustomsDialog(n,o);this.dialog=s,$E("category_"+this.id).innerHTML=this.tpl.join("");var a=this;this.dialog.nodes.btnClose.href="javascript:;",this.dialog.nodes.btnClose.onclick=function(){a.manage.getEdit()?winDialog.confirm("是否保存此更改？",{funcOk:function(){a.manage.saveHandler(a.url)},funcCancel:function(){a.close()},funcClose:function(){a.dialog.show()},textOk:"是",textCancel:"否"}):a.close()},this.initEvent()},initEvent:function(){this.manage.nameEvent(),this.manage.createEvent(),this.manage.dataProvider(),this.manage.saveEvent(this.url)},hidden:function(){this.dialog.hidden()},close:function(){this.dialog.hidden(),this.dialog.destroy()},showOld:function(){this.dialog.show()},reset:function(){window.CateDialog.dialog.setCloseEvent(!0),window.CateDialog.dialog.hidden(),window.CateDialog.dialog=null,window.CateDialog.init=!1},setSize:function(t,e){var i=this.dialog.nodes.content.firstChild;this.dialog.setSize(t,e),i.style.width=t+"px",i.style.height=e+"px"},setCloseEvent:function(){},getDialog:function(){return this.dialog},getId:function(){return this.id},getDataList:function(){return this.manage.list},onSuccess:function(){},init:!1,dialog:null,tpl:[\'<div id="categoryBody">\',\'<div id="categoryTitle">\',"</div>",\'<div id="categoryHead">\',"<table>","<tr>",\'<td><input type="text" maxlength="28" value="最多可输入14个中文字符" id="categoryName"/></td>\',\'<td width="80"><a id="categoryCreate" href="javascript:void(0);" class="SG_aBtn SG_aBtnB SG_aBtn_sub"><cite>创建分类</cite></a></td>\',\'<td><span class="SG_txtc">请用中文、英文或数字。</span></td>\',"</tr>","</table>",\'<div id="errTips"></div>\',"</div>",\'<form method="post" id="categoryForm" name="form">\',\'<div id="categoryList">\',\'<ul class="clearfix" id="datalist">&nbsp;</ul>\',\'<div class="SG_j_linedot"></div>\',"</div>",\'<div id="categoryBottom" style="text-align:center">\',\'<a id="categorySave" href="javascript:void(0);" class="SG_aBtn SG_aBtnB SG_aBtn_sub"><cite>保存设置<input type="button" value="保存设置"/></cite></a>\',"</div>","</form>","</div>"],itemTpl:[\'<li class="{class}">\',\'<span class="htit" style="color:#000000" id="cate_{index}">{cate}</span>\',\'<input type="hidden" value="{cate}" name="typename[]" class="catName"/>\',\'<input type="hidden" value="{id}" name="number[]"/>\',\'<span id="ctrl_{index}" class="control">\',\'<div class="manage">\',\'<a class="CP_a_fuc" id="edit_{index}" href="javascript:;" onclick="javascript:window.CateDialog.manage.editCate(this);">[<cite>编辑</cite>]</a>\',\'<a class="CP_a_fuc" id="del_{index}" index="{index}" href="javascript:;" onclick="javascript:window.CateDialog.manage.delCate(this);">[<cite>删除</cite>]</a>\',"</div>",\'<div class="arrow">\',\'<a id="up_{index}" class="{up_class}" href="javascript:;" onclick="javascript:window.CateDialog.manage.upHandler(this);"/>\',\'<a id="down_{index}" class="{down_class}" href="javascript:;" onclick="javascript:window.CateDialog.manage.downHandler(this);"/>\',"</div>","</span>",\'<div id="editctrl_{index}" class="writeinfo" style="display:none">\',\'<input id="new_{index}" type="text" value="" /><a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;"><cite>确定</cite></a><a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;"><cite>取消</cite></a></div>\',"<div/>","</li>"]};var cateMng=Core.Class.create();cateMng.prototype={list:null,orilen:0,edit:!1,uid:null,initialize:function(t,e,i){this.uid=i||scope.$uid,this.id=t,this.itemTpl=e,Array.prototype.remove=function(t){return isNaN(t)||t>this.length?!1:void this.splice(t,1)}},nameEvent:function(){var t=this;$E("categoryName").onfocus=function(){"最多可输入14个中文字符"==this.value&&(this.value="")},$E("categoryName").onblur=function(){var e=/[ ><\\\\\\\'\\;\\"`\\|\\t\\r\\n|\\u3000]/gi;this.value=this.value.replace(e,""),""==Core.String.trim($E("categoryName").value)?(this.value="最多可输入14个中文字符",this.edit=!1):this.edit=!0,t.showTips("")},$E("categoryName").onkeyup=function(){var t=Core.String.trim(this.value);Core.String.byteLength(t)>28?this.value=Core.String.leftB(t,28):t!=this.value&&(this.value=t)},t.showTips("")},createEvent:function(){function t(){var t=Core.String.trim($E("categoryName").value);i="",""==t||"最多可输入14个中文字符"==t?i="分类名称不能为空":-1!=t.indexOf("&")||-1!=t.indexOf("＆")?i="分类名称不能包含&符号":e.list.length>=15?i="抱歉！最多可创建15条分类":Core.String.byteLength(t)>28&&(i="最多可输入14个中文字符");for(var n=0;n<e.list.length;n++)if(e.list[n].name==t){i="您已经添加过此分类";break}return""!=i?!1:!0}var e=this,i="";$E("categoryCreate").onclick=function(){if(t()&&$E("categoryName").edit){var n={id:-1,name:$E("categoryName").value};$E("categoryName").value="最多可输入14个中文字符",$E("categoryName").edit=!1,e.list.push(n),e.update()}e.showTips(i)}},saveEvent:function(t){Core.Events.stopEvent();var e=this;$E("categorySave").onclick=function(){e.saveHandler(t)}},saveHandler:function(url){var _this=this,length=_this.list.length;if(_this.orilen-length>2)return void winDialog.confirm("您本次删除的博文分类太多，确定删除？",{funcOk:function(){_this.orilen=length,$E("categorySave").onclick()}});for(var cateName=[],cateId=[],i=0;length>i;i++){var item=_this.list[i];cateName.push(item.name),cateId.push(item.id)}Utils.Io.Ijax.request(url+"&r="+Math.random(),{POST:{typename:cateName.join("|"),number:cateId.join("|")},onComplete:function(res){eval("var result = "+res);try{try{$E("module_3")&&Lib.Component.refresh(3,{width:scope.catedialogwidth||210}),$E("module_7")&&location.reload()}catch(error){trace(error)}try{window.ArticleCateFuncs.reloadCate(result.msg)}catch(error){}window.CateDialog.close()}catch(e){}var r;eval("r="+res),_this.onSuccess(r.msg)},onException:function(){}})},editCate:function(t){function e(t,e){var o=t,a="";if(Core.String.byteLength(o)>28&&(o=Core.String.leftB(o,28)),1==e)for(var r=0;r<i.list.length;r++)if(i.list[r].name==o){a="您已经添加过此分类";break}if(""!=a)$E("err_"+n)?$E("err_"+n).value=a:(Core.Dom.addHTML($E("editctrl_"+n),\'<div id="err_\'+n+\'" class="errTips">\'+a+"</div>"),s.style.height="60px");else{i.list[n].name=o;var l=i.itemTpl.join("");l=l.replace(\'<li class="{class}">\',""),l=l.replace("</li>");var c=i.list[n];l=l.replace(/\\{cate\\}/gi,c.name),l=l.replace(/\\{id\\}/gi,c.id),l=l.replace(/\\{index\\}/gi,n),l=l.replace(/\\{up_class\\}/,0==n?"up_disabled":"up"),l=l.replace(/\\{down_class\\}/,n==i.list.length-1?"down_disabled":"down"),s.innerHTML=l,s.className=n%2==0?"":"cline",s.style.height="30px",1==e&&(i.edit=!0)}a=""}var i=this,n=t.id.split("_")[1],o=$E("cate_"+n).innerHTML,s=$E("cate_"+n).parentNode;$E("ctrl_"+n).className="control hide",s.className=n%2==0?"editName":"cline editName";var a=\'<div id="editctrl_\'+n+\'" class="writeinfo"><input id="new_\'+n+\'" type="text" value="\'+o+\'"><a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;"><cite>确定</cite></a><a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;"><cite>取消</cite></a></div>\';s.innerHTML=a,$E("new_"+n).onkeyup=function(){var t=/[ >&<\\\\\\\'\\,\\;\\"`\\|\\t\\r\\n|\\u3000]/gi,e=Core.String.trim(this.value.replace(t,""));e!=this.value&&(this.value=e),$E("editctrl_"+n).childNodes[1].disabled=""==e?!0:!1},$E("new_"+n).onblur=function(){Core.String.byteLength(this.value)>=28&&(this.value=Core.String.leftB(this.value,28))},$E("editctrl_"+n).childNodes[1].onclick=function(){$E("new_"+n).value==o?e(o,2):e($E("new_"+n).value,1)},$E("editctrl_"+n).childNodes[2].onclick=function(){e(o,2)}},delCate:function(t){var e=this,i=t.id.split("_")[1];winDialog.confirm("确实要删除此分类吗？删除后不可恢复。",{funcOk:function(){e.list.remove(i),e.update()}})},upHandler:function(t){var e=t.id.split("_")[1];if(e>0){var i=this.list[e];this.list[e]=this.list[e-1],this.list[e-1]=i,this.update()}},downHandler:function(t){var e=t.id.split("_")[1];if(e<this.list.length-1){var i=1*e+1,n=this.list[i];this.list[i]=this.list[e],this.list[e]=n,this.update()}},showTips:function(t){$E("errTips").innerHTML=t},dataProvider:function(){var t=this;App.getArticlesSort(function(e){t.list=e.data,t.orilen=t.list.length,$E("datalist").innerHTML="";for(var i=0;i<t.list.length;i++){var n=t.itemTpl.join(""),o=t.list[i];n=n.replace(/\\{cate\\}/gi,o.name),n=n.replace(/\\{class\\}/gi,i%2==0?"":"cline"),n=n.replace(/\\{id\\}/gi,o.id),n=n.replace(/\\{index\\}/gi,i),n=n.replace(/\\{up_class\\}/,0==i?"up_disabled":"up"),n=n.replace(/\\{down_class\\}/,i==t.list.length-1?"down_disabled":"down"),Core.Dom.addHTML($E("datalist"),n)}},this.uid)},update:function(){$E("datalist").innerHTML="";for(var t=0;t<this.list.length;t++){var e=this.itemTpl.join(""),i=this.list[t];e=e.replace(/\\{cate\\}/gi,i.name),e=e.replace(/\\{class\\}/gi,t%2==0?"":"cline"),e=e.replace(/\\{id\\}/gi,i.id),e=e.replace(/\\{index\\}/gi,t),e=e.replace(/\\{up_class\\}/,0==t?"up_disabled":"up"),e=e.replace(/\\{down_class\\}/,t==this.list.length-1?"down_disabled":"down"),Core.Dom.addHTML($E("datalist"),e)}this.edit||(this.edit=!0)},getEdit:function(){return this.edit},onSuccess:function(){}},$registJob("editor_catedialog",function(){window.CateDialog=new cateDialog("editor")}),$registJob("editor_articlecate",function(){window.ArticleCateFuncs={reloadCate:function(t){var e=$E("componentSelect");e.options.length=0,e.options.add(new Option("默认分类",1));for(var i=0;i<t.length;i++)e.options.add(new Option(t[i].label,t[i].value));$E("xRankRadio")&&e.options.add(new Option("私密博文",0)),e.selectedIndex=$E("xRankRadio")&&!$E("xRankRadio").checked?e.length-2:e.length-1,CateDialog.setCloseEvent(!0),CateDialog.hidden()}}}),$registJob("editor_cate",function(){window.CateFuncs={rndID:20,showCate:function(t){this.menuNode.innerHTML=this.articleCate[t.id].cateDesc.split(",").join("<br/>");var e=Core.Dom.getXY(t);Core.Dom.setStyle(this.menuNode,"left",e[0]+"px"),Core.Dom.setStyle(this.menuNode,"top",e[1]+20+"px"),Core.Dom.setStyle(this.menuNode,"display","")},hideCate:function(){Core.Dom.setStyle(this.menuNode,"display","none")},articleCate:{105:{cateName:"娱乐",cateDesc:"明星日志,八卦爆料,影音评论,粉丝心情"},102:{cateName:"文化",cateDesc:"人文历史,原创文学,书籍评论,文化评论"},104:{cateName:"体育",cateDesc:"篮球风云,天下足球,综合体育"},149:{cateName:"情感",cateDesc:"情感故事,青春随想,血缘亲情,同志爱人"},113:{cateName:"IT",cateDesc:"数码科技,IT评论,科技动态"},153:{cateName:"财经",cateDesc:"证券理财,理财技巧,产经发展,经济管理"},111:{cateName:"股票",cateDesc:"行情汇报,走势分析,股票心得"},152:{cateName:"校园",cateDesc:"校园生活,青春梦想,留学就业"},122:{cateName:"教育",cateDesc:"教育时评,考试资料,教育交流"},131:{cateName:"星座",cateDesc:"星座命运,预测生肖,占卜测试"},127:{cateName:"旅游",cateDesc:"旅游景点,路线推介,交通住宿,游记散文"},134:{cateName:"时尚",cateDesc:"美丽潮流,流行服饰,时尚杂志"},145:{cateName:"休闲",cateDesc:"私人生活,休闲方式,减压放松,家中宠物"},108:{cateName:"美食",cateDesc:"美食推介,餐厅品鉴,食谱大全"},130:{cateName:"汽车",cateDesc:"行业评论,业界动态,汽车产品,精彩旅程"},116:{cateName:"军事",cateDesc:"军事热点,军情揭秘,军史回顾,军事装备"},129:{cateName:"房产",cateDesc:"地产行情,房屋推介,租住日记"},136:{cateName:"家居",cateDesc:"家装设计,家居生活,装修点滴"},125:{cateName:"育儿",cateDesc:"亲子孕育,怀孕生子,婴幼教育,温馨家庭"},141:{cateName:"健康",cateDesc:"健康资讯,寻医问药,保健养生,心理卫生,美容瘦身"},118:{cateName:"游戏",cateDesc:"游戏新闻,评论杂谈,游戏介绍,游戏cosplay,攻略心得"},117:{cateName:"杂谈",cateDesc:"随笔感悟,生活记录,综合评论"}},writeCate:function(){var t=[],e=null,i="",n={101:105,103:113,105:149,112:125,113:102,114:122,116:141,117:116,118:131,120:153,121:117},o=window.location.href,s=/channel_id=(\\d*)&/i.exec(o);for(var a in this.articleCate)e=this.articleCate[a],i=\'<span>\t\t\t\t\t<input type="radio" name="sina_sort_id" id="sort_id_\'+this.rndID+"_"+a+\'" value="\'+a+\'">\t\t\t\t\t<label style="text-align: left;" onmouseover="CateFuncs.showCate(this)" onmouseout="CateFuncs.hideCate(this)" id="\'+a+\'" for="sort_id_\'+this.rndID+"_"+a+\'">\'+e.cateName+"</label></span>\t\t   \t\t",t[t.length]=i,i=null;Core.Dom.addHTML($E("cateContent"),t.join("")),null!=s&&null!=s[1]&&"undefined"!=typeof n[s[1]]?$E("sort_id_"+this.rndID+"_"+n[s[1]]).checked=!0:(articleEditorCFG.articleClassID&&$E("sort_id_"+this.rndID+"_"+articleEditorCFG.articleClassID)&&($E("sort_id_"+this.rndID+"_"+articleEditorCFG.articleClassID).checked=!0),"editor_film"==scope.$pageid&&($E("sort_id_"+this.rndID+"_105").checked=!0))},writeCateMenu:function(){Core.Dom.addHTML($E("cateContent"),\'<div id="sort_id_menu_\'+this.rndID+\'" style="line-height: 20px; width: 80px; background: #f4f4f4; position: absolute; top: 0; left: 0; border: 1px solid #7D7D7D; padding: 6px 0; display: none; text-align: center; color: #7D7D7D;">&nbsp;</div>\'),this.menuNode=document.getElementById("sort_id_menu_"+this.rndID)}},CateFuncs.writeCate(),CateFuncs.writeCateMenu()}),Core.Dom.getChildrenByClass=function(t,e){for(var i=[],n=t.childNodes||t.children,e=" "+e+" ",o=n.length,s=0;o>s;++s){var a=n[s],r=" "+a.className+" ";-1!=r.indexOf(e)&&(i[i.length]=a)}return i},Core.Dom.insertHTML=function(t,e,i){if(t=$E(t)||document.body,i=i.toLowerCase()||"beforeend",t.insertAdjacentHTML){switch(i){case"beforebegin":return t.insertAdjacentHTML("BeforeBegin",e),t.previousSibling;case"afterbegin":return t.insertAdjacentHTML("AfterBegin",e),t.firstChild;case"beforeend":return t.insertAdjacentHTML("BeforeEnd",e),t.lastChild;case"afterend":return t.insertAdjacentHTML("AfterEnd",e),t.nextSibling}throw\'Illegal insertion point -> "\'+i+\'"\'}var n,o=t.ownerDocument.createRange();switch(i){case"beforebegin":return o.setStartBefore(t),n=o.createContextualFragment(e),t.parentNode.insertBefore(n,t),t.previousSibling;case"afterbegin":return t.firstChild?(o.setStartBefore(t.firstChild),n=o.createContextualFragment(e),t.insertBefore(n,t.firstChild),t.firstChild):(t.innerHTML=e,t.firstChild);case"beforeend":return t.lastChild?(o.setStartAfter(t.lastChild),n=o.createContextualFragment(e),t.appendChild(n),t.lastChild):(t.innerHTML=e,t.lastChild);case"afterend":return o.setStartAfter(t),n=o.createContextualFragment(e),t.parentNode.insertBefore(n,t.nextSibling),t.nextSibling}throw\'Illegal insertion point -> "\'+i+\'"\'},Core.Dom.contains=document.documentElement.contains?function(t,e){return t.contains?t.contains(e):!0}:document.documentElement.compareDocumentPosition?function(t,e){return t===e||!!(16&t.compareDocumentPosition(e))}:function(t,e){for(;e;){if(t===e)return!0;e=e.parentNode}return!1},Core.Dom.insertAfter=function(t,e){var i=e.parentNode;return i.lastChild==e?i.appendChild(t):i.insertBefore(t,e.nextSibling),t},Lib.applyIf=function(t,e,i){if(i&&Lib.applyIf(t,i),t&&e&&Lib.isObject(e))for(var n in e)e.hasOwnProperty(n)&&!t[n]&&(t[n]=e[n]);return t},Lib.isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)},Lib.apply=function(t,e,i,n,o){i&&Lib.applyIf(t,i);for(var s in e)o&&t[s]&&!Lib.isObject(t[s])||e.hasOwnProperty(s)&&(t[s]=n&&Lib.isObject(e[s])?Lib.apply(t[s]||{},e[s],n,o):e[s]);return t},Lib.HtmlTemplate=function(t,e){this.uniqueID=e}.$extends(Ui.Template).$define({getHtmlString:function(){return this._htmlStr||(this._htmlStr=this.evaluate(this.getNodeIds())),this._htmlStr},getNodeIds:function(){if(!this._nodes){var t,e,i,n=/\\{[^\\}]+(?=\\})/g,o={},s=this._getUniqueID();if(this.__templateNodesIDs=this.tmpl.match(n),e=this.__templateNodesIDs)for(t=e.length;t--;)i=e[t].replace("{",""),o[i]="_"+s+"_"+i;this._nodes=o}return this._nodes},getNodeId:function(t){return this._nodes||this.getNodeIds(),this._nodes[t]},getNode:function(t){var e=this.getNodeId(t);return e?$E(e):null},_getUniqueID:function(){return this.uniqueID||(this.uniqueID=parseInt(1e3*Math.random()).toString()+(new Date).getTime().toString()),this.uniqueID}}),Lib.Panel=Core.Class.create(),Lib.Panel.prototype={noIframe:!1,isPostion:!0,appendTo:null,entity:null,backIframe:null,uniqueID:null,isFixed:!1,isShow:!1,isHidden:!0,x:0,y:0,template:"",initialize:function(t){Lib.apply(this,t);var e=this;this.uniqueID=this._getUniqueID(),this._ie6Fixed=function(){e.entity&&(e.entity.style.left=document.documentElement.scrollLeft+e.x+"px",e.entity.style.top=document.documentElement.scrollTop+e.y+"px"),e.backIframe&&(e.backIframe.style.left=e.entity.style.left,e.backIframe.style.top=e.entity.style.top)}},getNode:function(t){return this.tpl.getNode(t)},setTemplate:function(t){this.template=t,this.entity&&this.entity.parentNode&&(this.entity.parentNode.removeChild(this.entity),this.backIframe&&this.backIframe.parentNode.removeChild(this.backIframe)),this.entity=$C("div");var e=$C("div"),i=new Lib.HtmlTemplate(this.template,this.uniqueID);this.tpl=i,e.innerHTML=i.getHtmlString(),e.style.display="none",this.appendTo?$E(this.appendTo).appendChild(e):document.body.appendChild(e),this.entity=$E("_"+this.uniqueID+"_panel"),this.isPostion&&(this.entity.style.position="absolute"),this.entity.style.display="none",this.appendTo?$E(this.appendTo).replaceChild(this.entity,e):document.body.replaceChild(this.entity,e),e=null,this.noIframe||(this.backIframe=$C("iframe"),this.backIframe.style.display="none",this.backIframe.style.border="none",this.backIframe.style.zIndex=this.entity.style.zIndex-1,document.body.appendChild(this.backIframe),this._updateBackIframe())},setPosition:function(t,e){this.x=t,this.y=e,this.entity.style.left=t+"px",this.entity.style.top=e+"px",$IE6&&this.isFixed&&(this.entity.style.left=t+document.documentElement.scrollLeft+"px",this.entity.style.top=e+document.documentElement.scrollTop+"px"),this.backIframe&&(this.backIframe.style.left=this.entity.style.left,this.backIframe.style.top=this.entity.style.top)},setFixed:function(t){if(this.isFixed=t,$IE6){var e=this;return this.entity.style.position="absolute",void(this.isFixed?(e._ie6Fixed(),Core.Events.addEvent(window,e._ie6Fixed,"scroll")):Core.Events.removeEvent(window,e._ie6Fixed,"scroll"))}this.entity.style.position=this.isFixed?"fixed":"absolute",this.backIframe&&(this.backIframe.style.position=this.entity.style.position)},show:function(){this.entity.style.display="",this.isHidden=!1,this.isShow=!0,this.backIframe&&(this._updateBackIframe(),this.backIframe.style.display="")},hidden:function(){this.hide()},hide:function(){this.entity.style.display="none",this.isHidden=!0,this.isShow=!1,this.backIframe&&(this.backIframe.style.display="none")},close:function(){this.hidden(),this.destroy()},destroy:function(){Core.Events.removeEvent(window,this._ie6Fixed,"scroll"),this.entity.parentNode.removeChild(this.entity),this.entity=null,this.backIframe&&(this.backIframe.parentNode.removeChild(this.backIframe),this.backIframe=null)},showWithDom:function(t,e,i){var n=Core.Dom.getLeft(t)+t.offsetWidth+e,o=Core.Dom.getTop(t)+t.offsetHeight+i;$IE6&&this.isFixed&&(n-=document.documentElement.scrollLeft,o-=document.documentElement.scrollTop),this.setPosition(n,o),this.show()},getWidth:function(){var t=this.entity.style.display,e=this.entity.style.visibility;return this.entity.style.visibility="hidden",this.entity.style.display="",w=this.entity.offsetWidth,this.entity.style.display=t,this.entity.style.visibility=e,w},getHeight:function(){var t=this.entity.style.display,e=this.entity.style.visibility;return this.entity.style.visibility="hidden",this.entity.style.display="",h=this.entity.offsetHeight,this.entity.style.display=t,this.entity.style.visibility=e,h},getX:function(){return parseInt(this.entity.style.left)},getY:function(){return parseInt(this.entity.style.top)},getNodes:function(t){var e,i=t||"o",n=/[^\\{\\}]+(?=\\})/g,o={},s=this.template.match(n);if(s)for(e=0;e<s.length;e++){var a=s[e];switch(i){case"o":o[a]=$E("_"+this.uniqueID+"_"+a);break;case"i":o[a]="_"+this.uniqueID+"_"+a}}return o},_updateBackIframe:function(){Core.Dom.setStyle(this.backIframe,"opacity",0),this.backIframe.style.display="",this.backIframe.style.position=this.entity.style.position,this.backIframe.style.width=this.entity.offsetWidth+"px",this.backIframe.style.height=this.entity.offsetHeight+"px",this.backIframe.style.left=this.entity.style.left,this.backIframe.style.top=this.entity.style.top},_getUniqueID:function(){return parseInt(1e3*Math.random()).toString()+(new Date).getTime().toString()}},Lib.register("Listener",function(){var t={};return t.listeners={},{add:function(e){if(t.listeners[e])throw new Error("listener \'"+e+"\' has registed!");t.listeners[e]=[]},remove:function(e){return t.listeners[e]?(t.listeners[e]=null,!0):!1},notify:function(e,i){var n=t.listeners[e],o=null;if(n)for(var s=0,a=n.length;a>s;s++)o=n[s],o.callBack.call(o.scope,i)},on:function(){for(var e=arguments,i=null,n=0,o=e.length;o>n;n++)i=e[n],this.isListen(i)||(t.listeners[i.name]||(t.listeners[i.name]=[]),t.listeners[i.name].push(i))},off:function(e){var i=t.listeners[e.name];if(!i)return!0;for(var n=null,o=0,s=i.length;s>o;o++)n=i[o],n.callBack==e.callBack&&n.scope==e.scope&&i.splice(o,1)},isListen:function(e){var i=t.listeners[e.name],n=null;if(!i)return!1;for(var o=0,s=i.length;s>o;o++)if(n=i[o],n.callBack==e.callBack&&n.scope==e.scope)return!0;return!1}}}),Lib.register("util.JSON",function(){var t=function(t){if(t.JSON)return t.JSON;var e={parse:function(t){return new Function("return "+t)()},stringify:function(t){if(t instanceof Object){var e="";if(t.constructor===Array){for(var i=0;i<t.length;e+=this.stringify(t[i])+",",i++);return"["+e.substr(0,e.length-1)+"]"}if(t.toString!==Object.prototype.toString)return\'"\'+t.toString().replace(/"/g,"\\\\$&")+\'"\';for(var n in t)e+=\'"\'+n.replace(/"/g,"\\\\$&")+\'":\'+this.stringify(t[n])+",";return"{"+e.substr(0,e.length-1)+"}"}return"string"==typeof t?\'"\'+t.replace(/"/g,"\\\\$&")+\'"\':String(t)}};return e}(window);return t}),Lib.pkg("util"),Lib.util.hoverJq=function(t){var e={elm:document.body,mouseenter:function(){},mouseleave:function(){},delay:0};t=Lib.apply(e,t);var i=$IE?"mouseenter":"mouseover",n=$IE?"mouseleave":"mouseout";if("length"in t.elm)try{t.elm=Array.prototype.slice.call(t.elm,0)}catch(o){for(var s=[],a=0,r=t.elm.length;r>a;a++)s.push(t.elm[a]);t.elm=s}else t.elm=[t.elm];Core.Array.foreach(t.elm,function(e,o){Core.Events.removeEvent(e,i),Core.Events.removeEvent(e,n),Core.Events.addEvent(e,function(t,e,i){return function(n){n=n||window.event,$IE?e.apply(t,[n,t,i]):l(n,"mouseenter",t,i)}}(e,t[i],o),i),Core.Events.addEvent(e,function(t,e,i){return function(n){$IE?e.apply(t,[n,t,i]):l(n,"mouseleave",t,i)}}(e,t[n],o),n)});var l=function(e,i,n,o){var s=e.relatedTarget;try{if(s&&s!==document&&!s.parentNode)return;for(;s&&s!==n;)s=s.parentNode;s!==n&&t[i].apply(n,[e,n,o])}catch(a){}return!1}},Lib.register("tray.tpl.loginMemu",function(){var t=[\'<div class="ntopbar_menu" id="#{panel}">\',\'<div id="#{openBlog}" style="display:none;">\',\'<span class="link" id="#{userMenu}"><a id="#{userNick}" onclick="v7sendLog(\\\'40_01_21\\\');return false;" href="###">读取中...</a><a href="javascript:;" class="link_arrow" title=""></a></span>\',\'<span id="#{msnHolder}" class="ico_msn" style="display:none"><a id="#{msnLink}" href="http://control.blog.sina.com.cn/blogprofile/msnbind.php?c=" target="_blank"><img height="18" width="18" align="absmiddle" class="SG_icon SG_icon136" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif"></a></span>\',\'<span class="line_s"></span>\',\'<span class="link"><a onclick="v7sendLog(\\\'40_01_27\\\')" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1">个人中心</a></span>\',\'<span class="line_s"></span>\',\'<em id="#{newFeed}" class="mtip" style="left:341px;display:none;cursor:pointer;"></em>\',\'<span class="link" id="#{blogMenu}"><a target="_blank" onclick="v7sendLog(\\\'40_01_24\\\')" href="http://control.blog.sina.com.cn/admin/article/article_add.php">发博文</a><a id="#{addArticle}" onclick="v7sendLog(\\\'40_01_25\\\');return false;" href="###" class="link_arrow"></a></span>\',\'<span class="line_s"></span>\',\'<span class="link" id="#{trayMsg}" msg-panel-show-state="0"><a onclick="v7sendLog(\\\'40_01_30\\\');return false;" href="###">消息</a><a href="javascript:return false;" class="link_arrow" title=""></a></span>\',\'<em id="#{newTips}" onclick="v7sendLog(\\\'40_01_29\\\')" class="mtip" style="left:341px;display:none;cursor:pointer;"></em>\',"</div>",\'<div id="#{noOpenBlog}" style="display:none;">\',\'<span class="link"><a id="#{ssoNick}" onclick="v7sendLog(\\\'40_01_40\\\');return false;" href="###">读取中...</a></span>\',\'<span class="line_s"></span>\',\'<span class="link"><a id="#{ssoLoginOut}" onclick="v7sendLog(\\\'40_01_41\\\');return false;" href="###">退出</a></span>\',\'<div class="ntopbar_login" style="float:left;"><a id="#{openBlogBtn}" onclick="v7sendLog(\\\'40_01_42\\\')" class="login" href="###"><span>立即拥有一个新博客</span></a></div>\',"</div>","</div>"].join("");\nreturn t}),Lib.register("tray.tpl.loginOutMemu",function(){var t=scope.$uid||"",e="http://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid="+t+"&src=";e+=2==scope.$channel?"baby":"blogicp";var i=[\'<div id="#{panel}" class="ntopbar_login">\',\'<a class="login" onclick="v7sendLog(\\\'40_01_38\\\');return false;" href="###" action-type="tray-login-btn"><span>登录</span></a>\',\'<a class="register" onclick="v7sendLog(\\\'40_01_39\\\')" target="_blank" href="\',e,\'">注册</a></div>\'].join("");return i}),Core.Class.define=function(t,e,i){if(t&&t.__isClass&&t.__isClass())throw new Error("class cnt be used as another class\' constructor : "+t);if(e=e||Object,i=i||{},i.initialize=t||i.initialize||e.prototype.initialize||function(){},"function"!=typeof i.initialize)throw new Error("only function can be used as constructor");i.__isClass=function(){return!0};var n=Core.Class.create();n.__isClass=i.__isClass;var o=e==Object?{}:new e(Core.Class.AsPrototype);return n.prototype=Core.Class.extend(o,i),n},Lib.register("tray.tpl.userMenu",function(){var t=[\'<div id="#{panel}" class="mUserMenu">\',"<ul>","<li>",\'<span class="tb_ps_nm"><a id="#{linkBlog}" onclick="v7sendLog(\\\'40_01_22\\\')" href="###"><img class="SG_icon SG_icon15" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="博客" align="absmiddle">博客</a></span>\',\'<span class="rlink"><a target="_blank" onclick="v7sendLog(\\\'40_01_22\\\')" id="#{linkPostBlog}" href="http://control.blog.sina.com.cn/admin/article/article_add.php">发博文</a></span>\',"</li>",\'<li> <span class="tb_ps_nm"><a id="#{linkPhoto}" onclick="v7sendLog(\\\'40_01_22\\\')" href="###"><img class="SG_icon SG_icon18" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="相册" align="absmiddle">相册</a></span> <span class="rlink"><a target="_blank" id="#{linkPostPhoto}" onclick="v7sendLog(\\\'40_01_22\\\')" href="http://photo.blog.sina.com.cn/upload/upload.php">发图片</a></span> </li>\',\'<li> <span class="tb_ps_nm"><a id="#{miniblog}" onclick="v7sendLog(\\\'40_01_22\\\')" href="###" target="_blank"><img class="SG_icon SG_icon110" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="17" title="微博" align="absmiddle">微博</a></span> </li>\',\'<li> <span class="tb_ps_nm"><a id="#{qingblog}" onclick="v7sendLog && v7sendLog(\\\'79_01_02\\\',scope.$pageid,\\\'qingLink\\\');" onclick="v7sendLog(\\\'40_01_22\\\')" href="###" target="_blank"><img class="SG_icon SG_icon205" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="Qing" align="absmiddle">Qing</a></span> </li>\',\'<li style="display:none;" id="#{mail}"> <span class="tb_ps_nm"><a id="#{bindEmail}" target="_blank" href="http://mail.sina.com.cn/?s=2" onclick="v7sendLog(\\\'40_01_22\\\')"><img class="SG_icon SG_icon212" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="13" title="邮件" align="absmiddle">邮件</a></span> </li>\',\'<li> <span class="tb_ps_nm"><a id="#{mySpace}" onclick="v7sendLog(\\\'40_01_22\\\')" href="###"><img class="SG_icon SG_icon41" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="关于我" align="absmiddle">关于我</a></span> </li>\',"</ul>",\'<div class="links">\',\'<p><a target="_blank" id="#{linkChangeFace}" onclick="v7sendLog(\\\'40_01_22\\\')" href="###">修改头像昵称&gt;&gt;</a></p>\',\'<p><a target="_blank" id="#{linkChangePassword}" onclick="v7sendLog(\\\'40_01_22\\\')" href="###">修改登录密码&gt;&gt;</a></p>\',\'<p><a target="_blank" id="#{linkAccountSetup}" onclick="v7sendLog(\\\'40_01_22\\\')" href="###">帐号安全设置&gt;&gt;</a></p>\',\'<p><a id="#{loginOut}" onclick="v7sendLog(\\\'40_01_23\\\');return false;" href="#">退出&gt;&gt;</a></p>\',"</div>","</div>"].join("");return t}),Core.String.j2o=function(t){if(!t||""==t)return null;try{var e=window.eval("("+t+")");return e}catch(i){return trace("j2o : 数据分析出错"),traceError(i),null}},Utils.Io.Ajax={createRequest:function(){var t=null;try{t=new XMLHttpRequest}catch(e){try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(i){try{t=ActiveXObject("Microsoft.XMLHTTP")}catch(n){}}}return null!=t?t:void 0},request:function(t,e){return e=e||{},e.onComplete=e.onComplete||function(){},e.onException=e.onException||function(){},e.returnType=e.returnType||"txt",e.method=e.method||"get",e.data=e.data||{},"undefined"!=typeof e.GET&&"undefined"!=typeof e.GET.url_random&&0==e.GET.url_random&&(this.rand=!1,e.GET.url_random=null),this.loadData(t,e)},loadData:function(url,option){var request=this.createRequest(),tmpArr=[],_url=new Utils.Url(url);if(option.POST)for(var postkey in option.POST){var postvalue=option.POST[postkey];null!=postvalue&&tmpArr.push(postkey+"="+Core.String.encodeDoubleByte(postvalue))}var sParameter=tmpArr.join("&")||"";if(option.GET)for(var key in option.GET)"url_random"!=key&&_url.setParam(key,Core.String.encodeDoubleByte(option.GET[key]));0!=this.rand,request.onreadystatechange=function(){if(4==request.readyState){var response,type=option.returnType;try{switch(type){case"txt":response=request.responseText;break;case"xml":if($IE)response=request.responseXML;else{var Dparser=new DOMParser;response=Dparser.parseFromString(request.responseText,"text/xml")}break;case"json":response=eval("("+request.responseText+")")}option.onComplete(response)}catch(e){return option.onException(e.message,_url),!1}}};try{option.POST?(request.open("POST",_url,!0),request.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),request.send(sParameter)):(request.open("GET",_url,!0),request.send(null))}catch(e){return option.onException(e.message,_url),!1}return request}},$IE6&&"undefined"!=typeof Utils.Io.Ijax&&(Utils.Io.Ijax.loadData=function(t,e,i){function n(){if(h>0)try{r.submit()}catch(t){setTimeout(n,10)}h--}var o=new Utils.Url(t);if(e.GET)for(var s in e.GET)o.setParam(s,Core.String.encodeDoubleByte(e.GET[s]));/\\bdomain\\b/.test(t)||o.setParam("domain","1"),o=o.toString();var a=i.container;if(a.listener=Core.Function.bind2(function(){try{var t,n=a.contentWindow.document,s=Core.Dom.byClz(n,"textarea","")[0];t="undefined"!=typeof s?s.value:n.body.innerHTML,e.onComplete?e.onComplete(t):e.onException()}catch(r){traceError(r),e.onException&&e.onException(r.message,o.toString())}i.isBusy=!1,Core.Events.removeEvent(a,a.listener,"load"),this.loadByList()},this),Core.Events.addEvent(a,a.listener,"load"),e.POST){var r=$C("form");r.id="IjaxForm",r.action=o,r.method="post",r.target=a.id;for(var l in e.POST){var c;c=e.noEncode?Core.String.encodeDoubleByte(e.POST[l]):e.POST[l];var d=$C("input");d.type="hidden",d.name=l,d.value=c,r.appendChild(d)}document.body.appendChild(r);var h=100;n()}else try{window.frames(a.id).location.href=o}catch(u){a.src=o}});var Interface=function(t,e){this.url=new Utils.Url(t),this.type=e.toLowerCase()};Interface.prototype={url:null,type:"",request:function(t){var e=t.onError,i=t.onSuccess;t.onComplete=t.onSuccess=function(t){try{if("string"==typeof t&&(t=t.replace(/;$/,"")),t="string"==typeof t&&/\\s*{/.test(t)?Core.String.j2o(t):t,null!=t&&"undefined"==typeof t.code)return void trace("接口数据异常："+this.url,"#F00");null!=t&&"A00006"==t.code?i(t.data):e(t)}catch(n){traceError(n)}}.bind2(this),t.onException=t.onError=t.onFail||function(){if(trace("接口失败："+this.url,"#F00"),arguments.length>0)for(var t=0,e=arguments.length;e>t;t++)arguments[t]&&"undefined"!=typeof arguments[t]&&trace("错误信息："+arguments[t].toString())}.bind2(this);var n=this.url.toString();switch(this.type){case"ijax":Utils.Io.Ijax.request(n,t);break;case"ajax":Utils.Io.Ajax.request(n,t);break;case"script":case"jsload":Utils.Io.JsLoad.request(n,t);break;default:throw new Error("未指定有效的数据传输类型")}}},Lib.register("tray.loginOut",function(t){var e=t.Listener;return function(t,i){var n=encodeURIComponent(window.location.href);new Interface("http://control.blog.sina.com.cn/blog_rebuild/msn/api/msnLoginOut.php","jsload").request({onSuccess:function(o){e.notify("global-login-out",o),t&&t(o),i&&(window.location.href="http://login.sina.com.cn/cgi/login/logout.php?r="+n)},onError:function(t){e.notify("global-login-out",t),i&&(window.location.href="http://login.sina.com.cn/cgi/login/logout.php?r="+n)},onFail:function(t){e.notify("global-login-out",t),i&&(window.location.href="http://login.sina.com.cn/cgi/login/logout.php?r="+n)}})}}),Lib.register("tray.UserMenuPanel",function(t){var e=Core.Class.define(function(){t.Panel.prototype.initialize.apply(this,arguments),this.setTemplate(t.tray.tpl.userMenu)},t.Panel,{initUserInfo:function(t){var e=this.getNodes();e.linkBlog.href="http://blog.sina.com.cn/u/"+t,e.linkPhoto.href="http://photo.blog.sina.com.cn/u/"+t,e.miniblog.href="http://control.blog.sina.com.cn/t_sina_blog/tb.php?uname="+t,e.qingblog.href="http://qing.weibo.com/fancy.html",e.mySpace.href="http://blog.sina.com.cn/s/profile_"+t+".html",e.linkChangeFace.href="http://control.blog.sina.com.cn/blogprofile/nick.php",e.linkChangePassword.href="http://login.sina.com.cn/member/security/password.php",e.linkAccountSetup.href="http://login.sina.com.cn/member/security.php",this.initLoginOut(e.loginOut)},initLoginOut:function(e){e.onclick=function(){return!1},Core.Events.addEvent(e,function(){t.tray.loginOut(null,!0)})}});return e}),Lib.register("tray.tpl.blogMenu",function(){var t=[\'<div id="#{panel}" class="wrtBlog_sub">\',\'<div class="wrtBlog_sub3">\',\'<p><a target="_blank" onclick="v7sendLog(\\\'40_01_26\\\')" href="http://control.blog.sina.com.cn/admin/article/article_add.php?tag365">写365</a></p>\',\'<p><a target="_blank" onclick="v7sendLog(\\\'40_01_26\\\')" href="http://control.blog.sina.com.cn/admin/article/changWeiBo.php">长微博</a></p>\',\'<p><a target="_blank" onclick="v7sendLog(\\\'40_01_26\\\')" href="http://control.blog.sina.com.cn/weiyulu/weiyulu.php">微语录</a></p>\',\'<p><a target="_blank" onclick="v7sendLog(\\\'40_01_26\\\')" href="http://control.blog.sina.com.cn/admin/article/daily.php">九宫格</a></p>\',\'<p><a target="_blank" onclick="v7sendLog(\\\'40_01_26\\\')" href="http://photo.blog.sina.com.cn/upload/upload.php">发照片</a></p>\',"</div>","</div>"].join("");return t}),Lib.register("tray.BlogMenuPanel",function(t){var e=Core.Class.define(function(){t.Panel.prototype.initialize.apply(this,arguments),this.setTemplate(t.tray.tpl.blogMenu)},t.Panel,{});return e}),Core.Events.fireEvent=function(t,e){var i;t=$E(t),t.fireEvent?t.fireEvent("on"+e):(i=document.createEvent($MOBILE?"HTMLEvents":"MouseEvents"),i.initEvent(e,!0,!0),t.dispatchEvent(i))},Lib.register("tray.tpl.searchForm",function(){var t=[\'<div class="ntopbar_input" id="#{panel}">\',\'<form id="#{searchForm}" method="get" target="_blank" action="http://search.sina.com.cn">\',\'<input id="#{queryTxt}" class="ntopbar_txt" type="text" name="q" autocomplete="off"/>\',\'<input id="#{submit}" type="submit" onclick="v7sendLog(\\\'40_01_44\\\')" class="ntopbar_searchBtn" value=""/>\',\'<input type="hidden" name="ie" value="utf-8"/>\',\'<input type="hidden" name="e" value="utf-8"/>\',\'<input id="#{range}" type="hidden" name="range" value="article"/>\',\'<input id="#{t}" type="hidden" name="t" value=""/>\',\'<input id="#{s}" type="hidden" name="s" value="sup"/>\',\'<input id="#{by}" type="hidden" name="by" value="all"/>\',\'<input id="#{type}" type="hidden" name="type" value=""/>\',\'<input id="#{stype}" type="hidden" name="stype" value="1"/>\',\'<input id="#{c}" type="hidden" name="c" value="blog"/>\',"</form>","</div>"].join("");return t}),Core.Dom.addClass=function(t,e){var i=Core.String.trim;if(e=i(e),!e)return t;t=$E(t);var n=i(t.className||""),o=" "+n+" ";if(!n)return t.className=i(e),t;for(var s,a=e.split(" "),r=[],l=0;l<a.length;l++)s=a[l],s&&-1===o.indexOf(" "+s+" ")&&r.push(s);return t.className=n+" "+r.join(" "),t},Core.Dom.removeClass=function(t,e){t=$E(t),t.className=t.className.replace(new RegExp("\\\\s*\\\\b"+e+"\\\\b"),"")},Lib.util.getActionData=function(t,e,i,n){if(!e)throw"[Lib.util.getActionData] param actionType is undefined!";t=t||window.event;var o,s,a,r,l,c,d=Core.Events.getEventTarget,i=i||"action-type",n=n||"action-data";for(o=d(t),s=t.currentTarget||document.documentElement||document.body;o&&o!=s;){a=o.getAttribute(i)||"",r=a.split(",");for(var h=0,u=r.length;u>h;h++)if(l=r[h],e===l)return c=o.getAttribute(n),{actionType:e,targetEl:o,data:c};o=o.parentNode}return null},Lib.register("tray.tpl.cateSearch",function(){var t=[\'<div id="#{panel}" class="mCatSearch">\',"<ul>",\'<li action-type="tray-search" onclick="v7sendLog(\\\'40_01_43\\\')" action-data="article" class="current">含“<span id="#{article}"></span>”的博文</li>\',\'<li action-type="tray-search" onclick="v7sendLog(\\\'40_01_43\\\')" action-data="bloger">含“<span id="#{bloger}"></span>”的博主</li>\',\'<li action-type="tray-search" onclick="v7sendLog(\\\'40_01_43\\\')" action-data="music">含“<span id="#{music}"></span>”的音乐</li>\',\'<li action-type="tray-search" onclick="v7sendLog(\\\'40_01_43\\\')" action-data="video">含“<span id="#{video}"></span>”的视频</li>\',"</ul>","</div>"].join("");return t}),Lib.register("tray.CateSearchPanel",function(t){var e=Core.Events.addEvent,i=Core.String.leftB,n=Core.String.byteLength,o=Core.Class.define(function(){t.Panel.prototype.initialize.apply(this,arguments),this.setTemplate(t.tray.tpl.cateSearch),this.initEvt()},t.Panel,{initEvt:function(){var i=this.getNodes(),n=$T(i.panel,"li");t.util.hoverJq({elm:n,mouseenter:function(t,e){Core.Dom.addClass(e,"current")},mouseleave:function(t,e){Core.Dom.removeClass(e,"current")},delay:50}),e(i.panel,function(e){e=e||window.event;var i=t.util.getActionData(e,"tray-search");i&&t.Listener.notify("tray-categroy-search",i.data)})},updateSearch:function(t){5<n(t)&&(t=i(t,4)+"...");var e=t.replace(/(<|>)/g,function(t){return"<"===t?"&lt;":"&gt;"}),o=this.getNodes();o.article.innerHTML=e,o.bloger.innerHTML=e,o.music.innerHTML=e,o.video.innerHTML=e}});return o}),Lib.register("tray.SearchFormPanel",function(t){var e=Core.Events.addEvent,i=Core.String.trim,n=Core.Class.define(function(){t.Panel.prototype.initialize.apply(this,arguments),this.setTemplate(t.tray.tpl.searchForm),this.initEvt(),this.catePanel=new t.tray.CateSearchPanel,this.catePanel.entity.style.zIndex=512,t.Listener.on({name:"tray-categroy-search",callBack:this.search,scope:this})},t.Panel,{initEvt:function(){var t=this,i=this.getNode("queryTxt");e(i,function(e){e=e||window.event;var i=e.target||e.srcElement,n=i.offsetWidth;t.showCateSearch(i,n,i.value)},"input"),e(i,function(e){if(console.log(e),e=e||window.event,"value"===e.propertyName){var i=e.target||e.srcElement,n=i.offsetWidth;t.showCateSearch(i,n,i.value)}},"propertychange"),e(i,function(e){e=e||window.event;var i=e.target||e.srcElement,n=i.offsetWidth;t.showCateSearch(i,n,i.value)},"focus"),e(this.getNode("searchForm"),function(e){e=e||window.event;var i=e.target||e.srcElement;t.checkValidate(i)?setTimeout(function(){t.hideCateSearch(),t.resetForm()},100):Core.Events.stopEvent(e)},"submit"),e(window,function(){if(t.catePanel.isShow){var e=i.offsetWidth;t.catePanel.showWithDom(i,-e,4)}},"resize")},checkValidate:function(t){return"q"in t&&!i(t.q.value)?!1:"k"in t&&!i(t.k.value)?!1:!0},setForm:function(e,i){var n={queryTxt:"q",ie:"utf-8",range:"",t:"",s:"",by:"",type:"",stype:"",e:"utf-8",c:""},o=this.getNode("searchForm");o.action=e,t.apply(n,i);var s=this.getNode("queryTxt");s.name=n.queryTxt,delete n.queryTxt;var a,r;for(var l in n)a=n[l],"string"==typeof a&&(r=this.getNode(l))&&(r.value=a)},resetForm:function(){this.setForm("http://search.sina.com.cn",{queryTxt:"q",range:"article",s:"sup",by:"all",stype:"1",c:"blog"})},search:function(t){var e=(this.getNode("searchForm"),"http://search.sina.com.cn"),i="http://video.sina.com.cn/search/index.php",n="http://music.sina.com.cn/yueku/search/s.php";switch(t){case"video":this.setForm(i,{queryTxt:"k",s:"sup",type:"boke",stype:"1"});break;case"bloger":this.setForm(e,{queryTxt:"q",range:"author",s:"sup",by:"all",stype:"1",c:"blog"});break;case"music":this.setForm(n,{queryTxt:"k",t:"song"});break;default:this.setForm(e,{queryTxt:"q",range:"article",s:"sup",by:"all",stype:"1",c:"blog"})}$IE?this.getNode("submit").click():Core.Events.fireEvent(this.getNode("submit"),"click")},showCateSearch:function(t,e,i){var n=this.catePanel;i&&n.isHidden?n.showWithDom(t,-e,4):i||this.hideCateSearch(),n.updateSearch(i)},hideCateSearch:function(){var t=this.catePanel;t.hide(),t.updateSearch("")}});return n}),Lib.register("util.LS",function(){var t,e=function(t){var e,i,n="data-sina-blog-storage",o="data-sina-blog-storage-keys",s=t.document,a=s.createElement("input"),r=Core.Array.ArrayWithout,l=function(t,e,i,s){a.load(n),i=a.getAttribute(o)||"",s=RegExp("\\\\b"+t+"\\\\b,?","i");var r=s.test(i)?1:0;i=e?i.replace(s,""):r?i:""===i?t:i.split(",").concat(t).join(","),a.setAttribute(o,i),a.save(n)},c=document.body||document.getElementsByTagName("head")[0]||document.documentElement;a.id="____storage_container_box",a.type="hidden",c.appendChild(a),a.addBehavior("#default#userData"),a.load(n);var d=a.getAttribute(o);return i=d?d.split(","):[],e=i.length,{key:function(t){return isNaN(t)&&(t=0),i[parseInt(t,10)]},getItem:function(t){return a.load(n),a.getAttribute(t)},setItem:function(t,e){a.setAttribute(t,e),a.save(n),this.length++,i.push(t),l(t)},removeItem:function(t){a.removeAttribute(t),a.save(n),this.length--,r(i,t),l(t,1)},clear:function(){a.load(n);var t=a.getAttribute(o).split(","),e=t.length;if(""!==t[0]){for(var i=0;e>i;i++)a.removeAttribute(t[i]),a.save(n);a.setAttribute(o,""),a.save(n),this.length=0}},length:e}},i=function(t){return t.localStorage?t.localStorage:t.sessionStorage?t.sessionStorage:t.globalStorage?t.globalStorage:e(t)},n=function(){return t||(t=i(window)),t};return{key:function(t){return n().key(t)},getItem:function(t){return n().getItem(t)},setItem:function(t,e){return n().setItem(t,e)},removeItem:function(t){return n().removeItem(t)},clear:function(){return n().clear()}}}),Lib.register("tray.loadUserInfo",function(t){var e=t.util.LS,i=t.util.JSON,n=function(n,o){var s="http://interface.blog.sina.com.cn/riaapi/profile/getNickName.php";Utils.Io.JsLoad.request(s,{GET:{uid:n},onComplete:function(s){if(s&&"A00006"===s.code){var a=(s.data.nickname,{time:(new Date).getTime()/1e3});t.apply(a,s.data),e.setItem("uid"+n,i.stringify(a)),o(a)}},onException:function(){},timeout:1e4})};return function(t,o,s){var a=e.getItem("uid"+t);if(!s&&a){a=i.parse(a);var r=(new Date).getTime()/1e3,l=r-a.time;if(240>l&&a.nickname)return void o(a)}n(t,o)}}),Lib.register("tray.MsgLoader",function(t){var e,i=function(t){var e=$C("div");e.style.cssText="position:absolute;top:-1000px;left:-1000px;",document.body.appendChild(e),t.write(e)},n="";(window.$Maxthon||window.$360||window.$TT)&&(n="?t="+Core.Math.getUniqueId());var o=function(o){if(t.apply(this,o),!e)try{var s=new Utils.Flash.swfObject($_GLOBAL.flashBasicURL+"blogMessageReminding.swf"+n,"__msgTipsPlayer","1px","1px","9","#00ff00");s.addParam("quality","high"),s.addParam("wmode","transparent"),s.addParam("allowScriptAccess","always"),s.addParam("freeTime",27e3),"complete"===document.readyState?(i(s),e=$E("__msgTipsPlayer")):_addEvt(window,function(){i(s),e=$E("__msgTipsPlayer")},"load")}catch(a){}}.$define({time:30,url:"http://comet.blog.sina.com.cn/api?maintype=notice",getFlaDom:function(){return e},play:function(){if($_GLOBAL.msgPlaySound&&e&&e.PlaySound)try{e.PlaySound()}catch(t){}},load:function(e){var i=scope.$articleid||"";e&&Utils.Io.JsLoad.request(this.url,{GET:{uid:e||"",blogid:i},onComplete:function(n){if(n&&"A00006"==n.code){var o,s;if(e&&(o=n.data[e])){var a={};a.sum=0;for(var r in o)a[r]=o[r],a.sum+=o[r];a.blogrecomment=a.blogrecomment?a.blogrecomment:0,t.Listener.notify("tray-newmsg-loaded",a)}i&&(s=n.data[i])&&t.Listener.notify("article-msg-loaded",s)}},onException:function(){},timeout:1e4})}});return o}),Lib.register("tray.tpl.notice",function(){var t=[\'<div id="#{panel}" class="horn">\',\'<div id="#{tj}" class="horn_con" style="display:none;">推荐：<a id="#{noticeAd1}" target="_blank" href="#"></a><a id="#{noticeAd2}" target="_blank" href="#"></a></div>\',\'<div id="#{announce}" class="horn_con" style="display:none;"><p id="#{announceCon}">公告：<em>请您及时更换请请请您正在使用的模版将于2周后被下线，请您及时更换</em></p></div>\',\'<a class="close" title="关闭" id="#{close}" style="float:none;">×</a>\',"</div>"].join("");return t}),Lib.register("tray.BlogNotice",function(t){var e=Core.Events.addEvent,i=Utils.Cookie.setCookie,n=scope.$pageid,o=Core.Class.define(function(){t.Panel.prototype.initialize.apply(this,arguments),this.setTemplate(t.tray.tpl.notice),this.initEvt()},t.Panel,{initEvt:function(){var n=this;e(this.getNode("close"),function(e){e=e||window.event,i("closeNotice_fzp",$UID,24,"/",".blog.sina.com.cn"),t.Listener.notify("tray-announce-close",{}),n.destroy()})},update:function(t){var e=this.getNode("tj"),i=this.getNode("announce"),o=["SLOT_58","SLOT_59","SLOT_98","SLOT_99","SLOT_100","SLOT_101","SLOT_102"],s="http://comet.blog.sina.com.cn/api?maintype=pageslot",a={id:o};if("undefined"!=typeof scope&&(a.blogeruid=scope.$uid),$UID&&(a.loginuid=$UID),$isLogin&&t.announce.result&&("indexM"===n||"articleM"===n||"articlelistM"===n))i.innerHTML=t.announce.announce_con,i.style.display="";else{var r=this.getNode("noticeAd1"),l=this.getNode("noticeAd2"),c=function(t){var i=0,n=t[o[0]].res,s=t[o[1]].res;(n||s)&&(n&&(i=0,n.length>1&&(i=Math.floor((n.length+1)*Math.random())),r.innerHTML=n[i].words,r.href=n[i].a_href,r.title=n[i].a_title,r.setAttribute("suda-uatrack",n[i].a_c_suda.replace("suda-uatrack=","").replace(\'"\',"").replace(\'"\',"")),"undefined"!=typeof SUDA&&SUDA.uaTrack(n[i].a_v_suda_key,n[i].a_v_suda_value)),s&&(i=0,s.length>1&&(i=Math.floor((s.length+1)*Math.random())),l.innerHTML=s[i].words,l.href=s[i].a_href,l.title=s[i].a_title,l.setAttribute("suda-uatrack",s[i].a_c_suda.replace("suda-uatrack=","").replace(\'"\',"").replace(\'"\',"")),"undefined"!=typeof SUDA&&SUDA.uaTrack(s[i].a_v_suda_key,s[i].a_v_suda_value)),e.style.display="")};"waitting"===scope.__subscribeSlot?scope.__subscribeSlotFunc=c:"object"==typeof scope.__subscribeSlot?c(scope.__subscribeSlot):(scope.__subscribeSlot="waitting",Utils.Io.JsLoad.request(s,{GET:a,onComplete:function(t){c(t),scope.__subscribeSlot=t,"function"==typeof scope.__subscribeSlotFunc&&scope.__subscribeSlotFunc(t)},onException:function(){}}))}},setTemplate:function(t){this.template=t;var e=new Lib.HtmlTemplate(this.template,this.uniqueID);this.tpl=e,Core.Dom.insertHTML($E(this.appendTo),e.getHtmlString(),"afterbegin"),this.entity=$E("_"+this.uniqueID+"_panel"),this.entity.style.display="none",tempEntity=null}});return o}),Lib.register("tray.unReadMsgPanel",function(t){var e=Core.Class.define(function(e){if(t.Panel.prototype.initialize(),"editor"!=scope.$pageid){this._lockstate=0,this._scrolling=0,this._srcPot=e;var i=[\'<div class="cor"></div>\',\'<div class="bd">\',\'<a href="#" id="j-unread-msg-close" class="close" title="关闭">×</a>\',\'<ul id="j-unre-list">\',"</ul>","</div>"].join("");this.setTemplate(\'<div class="messageTips" id="#{panel}" style="left:850px; top:10px;">\'+i+"</div>"),this.entity.style.zIndex=500,this._bindEvent()}},t.Panel,{show:function(){this.isShow||(v7sendLog("40_02_01"),this.entity.style.display="",this._srcPot&&this._srcPot.setAttribute("unread-show-state",1),this.isHidden=!1,this.isShow=!0,this.backIframe&&(this._updateBackIframe(),this.backIframe.style.display=""),t.Listener.notify("tray-unread-panel-show",{}))},hide:function(){t.Panel.prototype.hide.call(this),this._srcPot&&this._srcPot.setAttribute("unread-show-state",0),t.Listener.notify("tray-unread-panel-hide",{})},_updatePanelIframe:function(){this.backIframe&&this._updateBackIframe()},_updateCont:function(t){var e=[];if(t.comment+t.message+t.notice+t.gbook==0)return void this.hide();if(t.comment>0&&e.push("<li>"+t.comment+\'条新评论，<a onclick="v7sendLog(\\\'40_02_02\\\')" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1">查看评论</a></li>\'),t.message>0&&e.push("<li>"+t.message+\'条新纸条，<a onclick="v7sendLog(\\\'40_02_03\\\')" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1">查看纸条</a></li>\'),t.gbook>0&&e.push("<li>"+t.gbook+\'条新留言，<a onclick="v7sendLog(\\\'40_02_04\\\')" href="http://i.blog.sina.com.cn/blogprofile/wall.php">查看留言</a></li>\'),t.notice>0){var i={notice:"http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote",like:"http://i.blog.sina.com.cn/profilelist/profilelikelist.php",notice_favourite:"http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice",notice_quote:"http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice",invite:"http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php",unreadnotices:"http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice",point:"http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/points_note.php"},n=i.notice;for(var o in t.notices)if(t.notices[o]>0){n=i[o]||n;break}e.push("<li>"+t.notice+\'条新通知，<a onclick="v7sendLog(\\\'40_02_05\\\')" href="\'+n+\'">查看通知</a></li>\')}$E("j-unre-list").innerHTML=e.join(""),this.show(),this._setThePos()},_setThePos:function(){var t=Core.Dom.getXY(this._srcPot),e="link"==this._srcPot.className?-2:0,i=$IE7||$IE6?this.entity.offsetWidth:this.entity.clientWidth;if(t[0]){var n=t[0]+this._srcPot.clientWidth-i+e,o=0;1==this._srcPot.getAttribute("adshow")&&0==this._scrolling&&(o=t[1]);var s=this._srcPot.clientHeight+o+10;this.setPosition(n,s)}},_bindEvent:function(){var t=this;Lib.Listener.on({name:"tray-newmsg-loaded",callBack:function(e){t._lockstate||(t._eventHandle(e),t._setThePos())}}),Lib.Listener.on({name:"tray-scrolling-fix",callBack:function(){t._scrolling=1,t._lockstate||(t.setFixed(1),t._setThePos())}}),Lib.Listener.on({name:"tray-scrolling-nofix",callBack:function(){t._scrolling=0,t._lockstate||(t.setFixed(0),t._setThePos())}}),Lib.Listener.on({name:"topad680-show-end",callBack:function(){t._srcPot.setAttribute("adshow",1),t.isShow&&t._setThePos()}}),Core.Events.addEvent($E("j-unread-msg-close"),function(e){var i=e||window.event;i.preventDefault?i.preventDefault():i.returnValue=!1,t.hide(),t._lockstate=1},"click"),Core.Events.addEvent(window,function(){t.isShow&&t._setThePos()},"resize")},_eventHandle:function(t){var e={};e.comment=t.blogcomment-0+(t.photocomment-0)+t.blogrecomment,e.notice=t.notice+t.like+t.notice_favourite+t.notice_quote+t.invite+t.unreadnotices+t.point,e.notices={notice:t.notice,like:t.like,notice_favourite:t.notice_favourite,notice_quote:t.notice_quote,invite:t.invite,unreadnotices:t.unreadnotices,point:t.point},e.message=t.message,e.gbook=t.gbook,this._updateCont(e)}});return e}),Lib.register("tray.msgSummaryPanel",function(t){var e=t.util.JSON,i=[\'<li><a onclick="v7sendLog(\\\'40_02_12\\\')" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1"><span class="icoms_comment"></span>查看评论</a></li>\',\'<li><a onclick="v7sendLog(\\\'40_02_13\\\')" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1"><span class="icoms_tips"></span>查看纸条</a></li>\',\'<li><a onclick="v7sendLog(\\\'40_02_14\\\')" href="http://i.blog.sina.com.cn/blogprofile/wall.php"><span class="icoms_message"></span>查看留言</a></li>\',\'<li><a onclick="v7sendLog(\\\'40_02_15\\\')" href="http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice"><span class="icoms_notice"></span>查看通知</a></li>\'],n=Core.Class.define(function(e){t.Panel.prototype.initialize(),this._srcPot=e,this._lock=1,this._scrolling=0,this._requirestate=1,this._nums={};var n=[\'<div class="bd">\',\'<ul id="j-summary-list">\',i.join(""),"</ul>","</div>"].join("");this.setTemplate(\'<div class="messageBox" id="#{panel}">\'+n+"</div>"),this.entity.style.zIndex=500,this._bindEvent(),this._initNums()},t.Panel,{show:function(){this._checkNumChange()?this._updateCont():this._showAction()},_showAction:function(){this.isHidden?(this._srcPot&&this._srcPot.setAttribute("msg-panel-show-state",1),this.entity.style.display="",this.isHidden=!1,this.isShow=!0,this.backIframe&&(this._updateBackIframe(),this.backIframe.style.display=""),this._setThePos()):this._setThePos()},_checkNumChange:function(){var t=this._srcPot.getAttribute("msg-count"),e=this._srcPot.getAttribute("old-msg-count");return t==e?!1:!0},hide:function(){t.Panel.prototype.hide.call(this),this._srcPot&&this._srcPot.setAttribute("msg-panel-show-state",0),t.Listener.notify("tray-msg-panel-hide",{})},_initNums:function(){var t=e.parse(this._srcPot.getAttribute("msg-count"));this._formatData(t)},_setThePos:function(){($IE6||$IE7||$IE8)&&(this.entity.style.width="auto");var t=Core.Dom.getXY(this._srcPot),e="link"==this._srcPot.className?-2:0,i=$IE7||$IE6?this.entity.offsetWidth:this.entity.clientWidth,n=t[0]+this._srcPot.clientWidth-i+e,o=0;1==this._srcPot.getAttribute("adshow")&&0==this._scrolling&&(o=$IE6||$IE7||$IE8?t[1]-2:t[1]);var s=this._srcPot.clientHeight+o+1;($IE6||$IE7||$IE8)&&(this.entity.style.width=this.entity.clientWidth+1+"px",this.entity.style.width=this.entity.clientWidth-1+"px"),this.setPosition(n,s)},_updatePanelIframe:function(){this.backIframe&&this._updateBackIframe()},_updateCont:function(){var t=[],e=this;this._lock=0,this._requirestate&&(this._getDate({},function(i){t.push(e._getComment(i)),t.push(e._getMessage(i)),t.push(e._getGbook(i)),t.push(e._getNotice(i)),$E("j-summary-list").innerHTML=t.join(""),e._srcPot.setAttribute("old-msg-count",e._srcPot.getAttribute("msg-count")),$IE6&&($E("j-summary-list").style.width="270px"),e._showAction()},function(){}),this._requirestate=0)},_getDate:function(t,e,i){e=e||function(){},i=i||function(){};Lib.checkAuthor();var n=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/note/notelist.php","jsload");n.request({GET:{uid:$UID},onSuccess:function(t){e(t)}.bind2(this),onError:function(){i({num:0})}.bind2(this),onFail:function(){i({num:0})}.bind2(this)})},_getUserPicUrl:function(t,e){var e=e||50,i=parseInt(t)%8+1;return"http://portrait"+i+".sinaimg.cn/"+t+"/blog/"+e},getLen:function(t){if(!t)return 0;var e=t.match(/[^\\x00-\\xff]/g);return t.length+(e?e.length:0)},strTruncate:function(t,e,i){return t=t||"","undefined"==typeof i&&(i="..."),this.getLen(t)>e?this.truncete(t,e)+i:t},truncete:function(t,e){var i=t.replace(/\\*/g," ").replace(/[^\\x00-\\xff]/g,"**");return t=t.slice(0,i.slice(0,e).replace(/\\*\\*/g," ").replace(/\\*/g,"").length),this.getLen(t)>e&&e>0&&(t=t.slice(0,t.length-1)),t},getVipIcon:function(t){if(!t)return"";var e={1:{icon:"SG_icon146",info:"新浪个人认证"},2:{icon:"SG_icon147",info:"新浪机构认证"}},t=t||1,i=\'<img class="SG_icon \'+e[t].icon+\'" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="13" title="\'+e[t].info+\'" alt="\'+e[t].info+\'" align="absmiddle" />\';return i},_setNameforIE6:function(t){return $IE6?this.strTruncate(t,4):t},_getComment:function(t){var e="";if(this._nums._comment>0){var n=t.msg.cms;if(n.length>0){for(var o={1:"评论了你的博文",2:"评论了你的图片",6:"回复了你的评论"},s={1:"http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1",2:"http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=2",6:"http://i.blog.sina.com.cn/blogprofile/profilereplylist.php"},a=[],r=0,l=n.length;l>r;r++){var c=n[r],d=c.nick_name||c.name;d=this._setNameforIE6(d);var h=this._getUserPicUrl(c.uid,30),u=c.msg_type;a.push(u);var p=c.user_type||0,g=c.time;e+=\'<li><a onclick="v7sendLog(\\\'40_02_06\\\')" href="\'+s[u]+\'"><img src="\'+h+\'"><em class="nl">\'+d+"</em>"+this.getVipIcon(p)+\'<em class="tm">\'+g+"</em>"+o[u]+"</a></li>"}a.sort(),this._nums._comment>3&&(e+=\'<li class="lcount"><a onclick="v7sendLog(\\\'40_02_07\\\')" href="\'+s[a[0]]+\'">总共\'+this._nums._comment+"条新评论</a></li>")}else e=i[0]}else e=i[0];return e},_getMessage:function(t){var e="";if(this._nums._message>0){var n=t.msg.note[0],o=n.name||n.nick_name;o=this._setNameforIE6(o);var s=this._nums._message>1?"等"+this._nums._message+"人":"",a=n.user_type||0;e+=\'<li class="bgc"><a onclick="v7sendLog(\\\'40_02_08\\\')" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1"><span class="icoms_tips"></span><em class="nl">\'+o+"</em>"+this.getVipIcon(a)+s+\'发来纸条<em class="nr">查看纸条</em></a></li>\'\n}else e=i[1];return e},_getGbook:function(t){var e="";if(this._nums._gbook>0){var n=t.msg.note[1],o=n.name||n.nick_name;if(o){o=this._setNameforIE6(o);var s=this._nums._gbook>1?"等"+this._nums._gbook+"人":"给你",a=n.user_type||0;e+=\'<li class="bgc"><a onclick="v7sendLog(\\\'40_02_09\\\')" href="http://i.blog.sina.com.cn/blogprofile/wall.php"><span class="icoms_message"></span><em class="nl">\'+o+"</em>"+this.getVipIcon(a)+s+\'留言<em class="nr">查看留言</em></a></li>\'}}else e=i[2];return e},_getNotice:function(t){var e="",n="http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice",o="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote",s={3:"http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php",7:n,8:n,9:n,23:n,55:"http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/points_note.php",13:"http://i.blog.sina.com.cn/profilelist/profilelikelist.php",100:o,101:o,102:o,103:o,104:o,105:o,106:o,107:o,108:o,109:o,110:o,111:o,112:o};if(this._nums._notice>0){var a=t.msg.note[2],r=a.msg_type||23;e+=\'<li class="bgc last"><a onclick="v7sendLog(\\\'40_02_10\\\')" href="\'+s[r]+\'"><span class="icoms_notice"></span>\'+this._nums._notice+\'条新通知<em class="nr">查看通知</em></a></li>\'}else e=i[3];return e},_bindEvent:function(){var t=this;Lib.Listener.on({name:"tray-newmsg-loaded",callBack:function(e){t._requirestate=1,t._eventHandle(e)}}),Lib.Listener.on({name:"tray-scrolling-nofix",callBack:function(){t._scrolling=0,t._lockstate||(t.setFixed(0),t._setThePos())}}),Lib.Listener.on({name:"tray-scrolling-fix",callBack:function(){t._scrolling=1,t._lockstate||(t.setFixed(1),t._setThePos())}}),Lib.Listener.on({name:"topad680-show-end",callBack:function(){t.isShow&&t._setThePos()}})},_eventHandle:function(t){this._formatData(t),this.isShow&&this._updateCont()},_formatData:function(t){var e={};e._comment=t.blogcomment-0+(t.photocomment-0)+t.blogrecomment,e._notice=t.notice+t.like+t.notice_favourite+t.notice_quote+t.invite+t.unreadnotices+t.point,e._message=t.message,e._gbook=t.gbook,this._cacheNums(t,e)},_cacheNums:function(t,e){for(var i in t)this._nums[i]=t[i];for(var n in e)this._nums[n]=e[n]}});return n}),Core.System.winSize=function(t){var e,i;return target=t?t.document:document,self.innerHeight?(target=t?t.self:self,e=target.innerWidth,i=target.innerHeight):target.documentElement&&target.documentElement.clientHeight?(e=target.documentElement.clientWidth,i=target.documentElement.clientHeight):target.body&&(e=target.body.clientWidth,i=target.body.clientHeight),{width:e,height:i}},Core.System.pageSize=function(t){target=t?t.document:document;var e,i,n="CSS1Compat"==target.compatMode?target.documentElement:target.body;window.innerHeight&&window.scrollMaxY?(e=n.scrollWidth,i=window.innerHeight+window.scrollMaxY):n.scrollHeight>n.offsetHeight?(e=n.scrollWidth,i=n.scrollHeight):(e=n.offsetWidth,i=n.offsetHeight);var o=Core.System.winSize(t);return pageHeight=i<o.height?o.height:i,pageWidth=e<o.width?o.width:e,[pageWidth,pageHeight,o.width,o.height]},function(){function t(t,e){this.node=t,this.config=e;for(var i in this.defaultConfig)this.config[i]=this.defaultConfig[i];return this.initialize(),this}t.prototype={defaultConfig:{preloadPixel:500},initialize:function(){this.viewableHeight=e.getViewableHeight(),e.enrol(this)},callback:function(t){if(0!=this.node.length){this.viewableHeight=t||this.viewableHeight;for(var e=[],i=0,n=this.node.length;n>i;i++)this.node[i]&&null==this.node[i].dom&&Core.Dom.getXY(this.node[i])[1]<this.viewableHeight+this.config.preloadPixel?(this.config.callback(this.node[i]),this.node[i]=null):this.node[i]&&this.node[i].dom&&Core.Dom.getXY(this.node[i].dom)[1]<this.viewableHeight+this.config.preloadPixel?(this.node[i].callback(this.node[i].dom),this.node[i]=null):e.push(this.node[i]);this.node=e}}};var e={_isInit:null,_binder:null,_isWindow:null,_member:[],initialize:function(){var t=window,e=t==window||t==document||!t.tagName||/^(?:body|html)$/i.test(t.tagName);if(e){var i=t.document;t="CSS1Compat"==i.compatMode&&($IE||$FF||$OPERA)?i.documentElement:i.body}this._container=t,this._binder=e?window:t,this._isWindow=e,this._isInit=!0,this.delayResize(),this.bindEvent()},getViewableHeight:function(){var t=e._container.scrollTop+Core.System.winSize().height;return this.eyeableHeight=t,t},bindEvent:function(){return this._isInit?(Core.Events.addEvent(this._binder,e.delayLoad,"scroll"),this._isWindow&&Core.Events.addEvent(this._binder,e.delayResize,"resize"),void(this.binded=!0)):void this.initialize()},unbindEvent:function(){Core.Events.removeEvent(e._binder,e.delayLoad,"scroll"),this._isWindow&&Core.Events.removeEvent(e._binder,e.delayResize,"resize"),this.binded=!1},delayLoad:function(){e.scrollWatch&&clearTimeout(e.scrollWatch),e.scrollWatch=setTimeout(function(){e.callback(),clearTimeout(e.scrollWatch),e.scrollWatch=null},100)},delayResize:function(){e.resizeWatch&&clearTimeout(e.resizeWatch),e.resizeWatch=setTimeout(function(){e.callback(),clearTimeout(e.resizeWatch),e.resizeWatch=null},100)},enrol:function(t){e._member.push(t)},callback:function(){if(e.getViewableHeight(),e._member.length>0)for(var t=0,i=e._member.length;i>t;t++)e._member[t].callback(e.eyeableHeight);e.eyeableHeight==Core.System.pageSize()[1]&&e.unbindEvent()}};Lib.LazyLoad=function(i,n){1!=e.binded&&e.bindEvent(i,n),new t(i,n)}}();var Layer=function(t){this.entity=null,this.ifm=null;var e=this,i={width:0,height:0,x:0,y:0,isFixed:!1,uniqueID:"",entityID:"",contentID:"",template:t,templateString:"",nodes:{}};this.getProperty=function(){return i},function(){var t=e.getProperty();t.uniqueID="_"+e.getUniqueID(),t.entityID=t.uniqueID+"_entity",t.contentID=t.uniqueID+"_content",e.setTemplate(t.template),t.width=parseInt(e.entity.style.width),$IE6&&e.addIframe(),document.body.appendChild(e.entity),e.hidden()}(),this._ie6Fixed=function(){e.entity.style.left=document.documentElement.scrollLeft+e.getProperty().x+"px",e.entity.style.top=document.documentElement.scrollTop+e.getProperty().y+"px",e.ifm&&(e.ifm.style.left=document.documentElement.scrollLeft+e.getProperty().x+"px",e.ifm.style.top=document.documentElement.scrollTop+e.getProperty().y+"px")}};Layer.prototype={setTemplate:function(t){var e=this.getProperty();if(this.entity&&(this.entity.parentNode.removeChild(this.entity),this.entity=null),"object"==typeof t){if(e.nodes=t,this.entity&&(this.entity.parentNode.removeChild(this.entity),this.entity=null),this.entity=e.nodes.entity,document.body.appendChild(this.entity),!e.nodes.entity||!e.nodes.content)throw new Error("[layer.js] missing entity or content in layer nodes");return this.entity.style.position="absolute",this.entity.style.zIndex="1024",this.entity.style.left=e.x+"px",this.entity.style.top=e.y+"px",void 0}var i=/[^\\{\\}]+(?=\\})/g;e.template=t,e.templateString=e.template.match(i),this.entity=$C("div");var n=$C("div"),o=new Ui.Template(e.template);if(n.innerHTML=o.evaluate(this.getNodes("i")),document.body.appendChild(n),!$E(e.entityID)||!$E(e.contentID))throw new Error("[layer.js] there missing #{entityID} or #{contentID} in layer template");this.entity=$E(e.entityID),this.entity.style.position="absolute",this.entity.style.zIndex="1024",this.entity.style.left=e.x+"px",this.entity.style.top=e.y+"px",document.body.replaceChild(this.entity,n),n=null,e.nodes=this.getNodes()},setSize:function(t){var e=this.getProperty();Core.System.parseParam(e,t),t.width&&(e.nodes.content.style.width=e.width+"px"),t.height&&(e.nodes.content.style.height=e.height+"px"),this.updateIfmSize()},setPosition:function(t){var e=this.getProperty();Core.System.parseParam(e,t),this.entity.style.left=e.x+"px",this.entity.style.top=e.y+"px",$IE6&&e.isFixed&&(this.entity.style.left=e.x+document.documentElement.scrollLeft+"px",this.entity.style.top=e.y+document.documentElement.scrollTop+"px"),this.ifm&&(this.ifm.style.left=this.entity.style.left,this.ifm.style.top=this.entity.style.top)},getWidth:function(){var t=this.entity.style.display,e=this.entity.style.visibility;return this.entity.style.visibility="hidden",this.entity.style.display="",w=this.entity.offsetWidth,this.entity.style.display=t,this.entity.style.visibility=e,w},getHeight:function(){var t=this.entity.style.display,e=this.entity.style.visibility;return this.entity.style.visibility="hidden",this.entity.style.display="",h=this.entity.offsetHeight,this.entity.style.display=t,this.entity.style.visibility=e,h},getX:function(){return parseInt(this.entity.style.left)},getY:function(){return parseInt(this.entity.style.top)},updateIfmSize:function(){if(this.ifm){var t=this;t.ifm.style.width=t.entity.offsetWidth+"px",t.ifm.style.height=t.entity.offsetHeight+"px"}},setFixed:function(t){var e=this.getProperty();e.isFixed=t;var i=this;return $IE6?(i.entity.style.position="absolute",void(e.isFixed?(i._ie6Fixed(),Core.Events.addEvent(window,i._ie6Fixed,"scroll")):Core.Events.removeEvent(window,i._ie6Fixed,"scroll"))):e.isFixed&&$FF2?void i.updateFixed():void(this.entity.style.position=e.isFixed?"fixed":"absolute")},updateFixed:function(){var t=this.getProperty();if(t.isFixed&&$FF2){var e=this,i=t.x,n=t.y;e.entity.style.position="absolute",e.setPosition({x:t.x+document.documentElement.scrollLeft,y:t.y+document.documentElement.scrollTop}),e.entity.style.position="fixed",e.setPosition({x:i,y:n})}},show:function(){this.entity.style.display="",this.ifm&&(this.ifm.style.display="",this.updateIfmSize())},hidden:function(){this.entity.style.display="none",this.ifm&&(this.ifm.style.display="none")},addIframe:function(){this.ifm=$C("iframe"),this.ifm.style.position="absolute",this.ifm.style.zIndex="1024",this.ifm.style.left=this.entity.style.left,this.ifm.style.top=this.entity.style.top,document.body.appendChild(this.ifm),Core.Dom.setStyle(this.ifm,"opacity",0)},getNodes:function(t){var e,i=this.getProperty(),n=t||"o",o={},s=i.templateString;if(s)for(e=0;e<s.length;e++){var a=s[e];switch(n){case"o":o[a]=$E(i.uniqueID+"_"+a);break;case"i":o[a]=i.uniqueID+"_"+a}}return"entity"in o?o:i.nodes},getUniqueID:function(){return parseInt(1e4*Math.random()).toString()+(new Date).getTime().toString()},setContent:function(t){var e=this.getProperty();t&&(e.nodes.content.innerHTML=t)}},function(){function t(t){try{var e=t.constructor.toString().toLowerCase();return e.slice(e.indexOf("function")+9,e.indexOf("()"))}finally{e=null}}function e(t,e){var i,n,o=[];for(n=e.length,i=0;n>i;i++)o[o.length]=parseFloat(Core.Dom.getStyle(t,e[i]));return o}function i(e){return"array"!=t(e)?[e]:e}function n(e,i){try{var n,s,a,r=t(e),l=[],c=[];if("array"!=r)a=o(e),a[1]="opacity"==i?"":a[1],l=[a[0]],c=[a[1]];else for(s=e.length,n=0;s>n;n++)a=o(e[n]),a[1]="opacity"==i[n]?"":a[1],l[l.length]=a[0],c[c.length]=a[1];return[l,c]}finally{r=l=c=n=s=a=null}}function o(t){try{var e=/(-?\\d.?\\d*)([a-z%]*)/i.exec(t);return[e[1],e[2]?e[2]:"px"]}finally{e=null}}function s(t){try{var e,i=c(t);return 1!=d[i]?(e=new a,h[i]={node:t,func:e},d[i]=!0,e):h[i].func}finally{i=e=null}}function a(){this._timer=null}function r(t){var e=s(t);e.start.apply(e,arguments)}var l={simple:function(t,e,i,n){return i*t/n+e},backEaseIn:function(t,e,i,n){var o=1.70158;return i*(t/=n)*t*((o+1)*t-o)+e},backEaseOut:function(t,e,i,n){var o=1.70158;return i*((t=t/n-1)*t*((o+1)*t+o)+1)+e},backEaseInOut:function(t,e,i,n){var o=1.70158;return(t/=n/2)<1?i/2*t*t*(((o*=1.525)+1)*t-o)+e:i/2*((t-=2)*t*(((o*=1.525)+1)*t+o)+2)+e},bounceEaseOut:function(t,e,i,n){return(t/=n)<1/2.75?7.5625*i*t*t+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},bounceEaseIn:function(t,e,i,n){return i-l.bounceEaseOut(n-t,0,i,n)+e},bounceEaseInOut:function(t,e,i,n){return n/2>t?.5*l.bounceEaseIn(2*t,0,i,n)+e:.5*l.bounceEaseOut(2*t-n,0,i,n)+.5*i+e},strongEaseInOut:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},regularEaseIn:function(t,e,i,n){return i*(t/=n)*t+e},regularEaseOut:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},regularEaseInOut:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},strongEaseIn:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},strongEaseOut:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},strongEaseInOut:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},elasticEaseIn:function(t,e,i,n,o,s){if(0==t)return e;if(1==(t/=n))return e+i;if(s||(s=.3*n),!o||o<Math.abs(i)){o=i;var a=s/4}else var a=s/(2*Math.PI)*Math.asin(i/o);return-(o*Math.pow(2,10*(t-=1))*Math.sin(2*(t*n-a)*Math.PI/s))+e},elasticEaseOut:function(t,e,i,n,o,s){if(0==t)return e;if(1==(t/=n))return e+i;if(s||(s=.3*n),!o||o<Math.abs(i)){o=i;var a=s/4}else var a=s/(2*Math.PI)*Math.asin(i/o);return o*Math.pow(2,-10*t)*Math.sin(2*(t*n-a)*Math.PI/s)+i+e},elasticEaseInOut:function(t,e,i,n,o,s){if(0==t)return e;if(2==(t/=n/2))return e+i;if(!s)var s=.3*n*1.5;if(!o||o<Math.abs(i))var o=i,a=s/4;else var a=s/(2*Math.PI)*Math.asin(i/o);return 1>t?-.5*o*Math.pow(2,10*(t-=1))*Math.sin(2*(t*n-a)*Math.PI/s)+e:o*Math.pow(2,-10*(t-=1))*Math.sin(2*(t*n-a)*Math.PI/s)*.5+i+e}},c=function(t){return t.uniqueID};$IE||(c=function(t){try{var e;return null==t.getAttribute("uniqueID")?(e="moz__id"+parseInt(100*Math.random())+"_"+(new Date).getTime(),t.setAttribute("uniqueID",e),e):t.getAttribute("uniqueID")}finally{e=null}});var d={},h={};a.prototype.start=function(t,o,s,a,r,c){this.reset(),c=c||{},c.before&&(this._func.before=c.before),c.end&&(this._func.end=c.end),c.tween&&(this._func.tween=c.tween);var d=i(o),h=e(t,d),u=n(s,d);this._node=t,this._property=d,this._endingvalue=u[0],this._suffixvalue=u[1],this._startvalue=h,this._end=!1,this._fps=0,null!=a&&(this._seconds=a),null!=l[r]&&(this._animation=l[r]),this._starttime=(new Date).getTime(),this._func.before(),this._timer=setInterval(Core.Function.bind3(this.play,this),10)},a.prototype.play=function(){var t,e,i=((new Date).getTime()-this._starttime)/1e3,n=this._property.length;for(i>this._seconds&&(i=this._seconds),t=0;n>t;t++)e=this._animation(i,this._startvalue[t],this._endingvalue[t]-this._startvalue[t],this._seconds),Core.Dom.setStyle(this._node,this._property[t],e+this._suffixvalue[t]);this._fps++,this._func.tween(),i==this._seconds&&this.stop()},a.prototype.stop=function(){clearInterval(this._timer),this._end=!0,this._func.end()},a.prototype.reset=function(){clearInterval(this._timer),this._end=!1,this._node=null,this._property=[],this._startvalue=[],this._endingvalue=[],this._suffixvalue=[],this._fps=0,this._seconds=.5,this._animation=l.simple,this._func={end:function(){},tween:function(){},before:function(){}}},r.stop=function(t){s(t).stop()},r.isTween=function(t){return!s(t)._end},Ui.tween=r}();var DialogDisplaySet={alpha1:{show:function(t,e,i){var n=0,o=0,s=parseInt(t.style.top)-e;t.style.top=s,Core.Dom.setStyle(t,"opacity",n),t.style.display="";var a=window.setInterval(function(){1>=n&&Core.Dom.setStyle(t,"opacity",n),s+e>=o&&(t.style.top=s+o+"px"),o+=1.5,n+=.05,n>.9&&parseInt(t.style.top)>=s+e&&(window.clearInterval(a),i&&i())},10)},hidden:function(t,e,i){var n=1,o=parseInt(t.style.top),s=o-e,a=o,r=window.setInterval(function(){n>=0&&Core.Dom.setStyle(t,"opacity",n),a>=s&&(t.style.top=a+"px"),a-=1.5,n-=.05,0>=n&&s>a&&(window.clearInterval(r),i&&i())},10)}},alpha:{show:function(t,e,i){Core.Dom.setStyle(t,"opacity",.3),t.style.display="",t.style.top=parseInt(t.style.top)-e+"px";var n=parseInt(t.style.top)+e;Ui.tween(t,["top","opacity"],[n,.9],.4,"simple",{end:i})},hidden:function(t,e,i){var n=parseInt(t.style.top)-e;Ui.tween(t,["top","opacity"],[n,0],.2,"simple",{end:i})}},fallDown:{show:function(t,e,i,n){t.style.display="",t.style.top=e+"px",Ui.tween(t,"top",i,.6,"bounceEaseOut",{end:n})},hidden:function(t,e,i,n){t.style.display="",t.style.top=e+"px",Ui.tween(t,"top",i,.6,"strongEaseIn",{end:n})}}},Drag3=function(t,e,i){var n=this;this.beDragObj=t,this.movedObjs=e||this.beDragObj,this.dragMode=i||"normal",this.canDrag=!0,this.isLock=!1,this.lockArea={left:0,right:0,top:0,bottom:0},this.dragSet={normal:function(){n.normalDrag()},border:function(){n.borderDrag()},opacity:function(){n.opacityDrag()}},this.dragObjsFunc=function(){n.onDrag(),n.dragObjs()},function(){n.beDragObj.style.MozUserSelect="none",Core.Events.addEvent(n.beDragObj,function(){return!1},"selectstart"),Core.Events.addEvent(n.beDragObj,function(){return!1},"drag");for(var t=0;t<n.movedObjs.length;t++)n.movedObjs[t]!=n.beDragObj&&(n.movedObjs[t].style.position="absolute",n.movedObjs[t].style.left||(n.movedObjs[t].style.left=n.movedObjs[t].offsetLeft+"px"),n.movedObjs[t].style.top||(n.movedObjs[t].style.top=n.movedObjs[t].offsetTop+"px"));Core.Events.addEvent(n.beDragObj,n.dragSet[n.dragMode],"mousedown"),$IE?Core.Events.addEvent(n.beDragObj,function(){Core.Events.removeEvent(n.beDragObj,n.dragObjsFunc,"mousemove"),n.beDragObj.releaseCapture(),n.onDragEnd()},"mouseup"):Core.Events.addEvent(document,function(){Core.Events.removeEvent(document,n.dragObjsFunc,"mousemove"),n.onDragEnd()},"mouseup")}()};Drag3.prototype={capture:function(){this.canDrag=!0},release:function(){this.canDrag=!1},onDragStart:function(){},onDrag:function(){},onDragEnd:function(){},dragObjs:function(){e=Core.Events.getEvent();for(var t=0;t<this.movedObjs.length;t++)this.isLock?(this.movedObjs[t].style.left=e.clientX-this.movedObjs[t].deltaX<this.lockArea.left?this.lockArea.left+"px":e.clientX-this.movedObjs[t].deltaX>this.lockArea.right-this.movedObjs[t].offsetWidth?this.lockArea.right-this.movedObjs[t].offsetWidth+"px":e.clientX-this.movedObjs[t].deltaX+"px",this.movedObjs[t].style.top=e.clientY-this.movedObjs[t].deltaY<this.lockArea.top?this.lockArea.top+"px":e.clientY-this.movedObjs[t].deltaY>this.lockArea.bottom-this.movedObjs[t].offsetHeight?this.lockArea.bottom-this.movedObjs[t].offsetHeight+"px":e.clientY-this.movedObjs[t].deltaY+"px"):(this.movedObjs[t].style.left=e.clientX-this.movedObjs[t].deltaX+"px",this.movedObjs[t].style.top=e.clientY-this.movedObjs[t].deltaY+"px")},normalDrag:function(){var t=this;e=Core.Events.getEvent();for(var i=0;i<t.movedObjs.length;i++)t.movedObjs[i].deltaX=e.clientX-parseInt(t.movedObjs[i].style.left),t.movedObjs[i].deltaY=e.clientY-parseInt(t.movedObjs[i].style.top);t.canDrag&&($IE?(t.beDragObj.setCapture(),Core.Events.addEvent(t.beDragObj,t.dragObjsFunc,"mousemove")):Core.Events.addEvent(document,t.dragObjsFunc,"mousemove")),t.onDragStart()},borderDrag:function(){},opacityDrag:function(){}},Ui.Drag3=Drag3;var Dialog=function(t){var e=this;e.entity=null,e.ifm=null;var i={id:"",x:0,y:0,width:0,height:0,isFixed:!1,layer:new Layer(t),template:t,canDrag:!1,dragEntity:null,name:"",uniqueID:"",isShow:!1,nodes:{},focusNode:null,displayMode:"normal",_modeDisplayRuning:!1,enabled:!0};this.getProperty=function(){return i},function(){var t=e.getProperty();t.uniqueID=t.layer.getProperty().uniqueID,t.id=t.uniqueID+"_dialog",t.nodes=e.getNodes(),e.entity=t.layer.entity,e.ifm=t.layer.ifm,t.width=parseInt(e.entity.style.width),t.nodes.titleBar&&(t.dragEntity=new Ui.Drag3(t.nodes.titleBar,e.ifm?[e.ifm,e.entity]:[e.entity]),t.nodes.titleBar.style.cursor="move",Core.Events.addEvent(t.nodes.titleBar,function(){return!1},"selectstart"),t.dragEntity.onDrag=function(){e.onDrag()}),Core.Events.addEvent(window,function(){if(t.isShow&&t.isFixed){var i=Core.System.winSize(),n=i.width/2-e.getWidth()/2,o=i.height/2-e.getHeight()/2;n=0>n?0:n,o=0>o?0:o,e.setPosition({x:n,y:o})}},"resize")}()};Dialog.prototype={setPosition:function(t){var e=this.getProperty();Core.System.parseParam(e,t),this.getProperty().layer.setPosition(t)},setSize:function(t){var e=this.getProperty();Core.System.parseParam(e,t),e.layer.setSize(t)},setFixed:function(t){var e=this.getProperty();e.isFixed=t,this.getProperty().layer.setFixed(e.isFixed)},setContent:function(t){this.getProperty();this.getProperty().layer.setContent(t)},setTemplate:function(t){var e=this.getProperty();e.template=t,e.layer.setTemplate(e.template)},setDrag:function(t){var e=this.getProperty();e.canDrag=t,e.canDrag?e.dragEntity.capture():e.dragEntity.release()},getWidth:function(){return this.getProperty().layer.getWidth()},getHeight:function(){return this.getProperty().layer.getHeight()},getX:function(){return this.getProperty().layer.getX()},getY:function(){return this.getProperty().layer.getY()},show:function(t){var e=this.getProperty(),i=this;e.isShow=!0,this.ifm&&(this.ifm.style.display=""),this.onShow(),"normal"==e.displayMode||"normal"==t?this.entity.style.display="":(e._modeDisplayRuning=!0,e.enabled=!1,this._showWithMode(function(){e._modeDisplayRuning=!1,e.enabled=!0,i.onDisplaied&&i.onDisplaied()}))},close:function(t){var e=this,i=this.getProperty();"normal"==i.displayMode||"normal"==t?(i.isShow=!1,i.layer.hidden(),this.destroy(),this.onClose(),e.onDisplayFinished&&e.onDisplayFinished()):i._modeDisplayRuning||(i._modeDisplayRuning=!0,i.enabled=!1,this._hiddenWithMode(function(){i.isShow=!1,i.layer.hidden(),i._modeDisplayRuning=!1,i.enabled=!0,e.destroy(),e.onClose(),e.onDisplayFinished&&e.onDisplayFinished()}))},hidden:function(t){var e=this,i=this.getProperty();"normal"==i.displayMode||"normal"==t?(i.isShow=!1,i.layer.hidden(),this.onHidden(),e.onDisplayFinished&&e.onDisplayFinished()):i._modeDisplayRuning||(i._modeDisplayRuning=!0,i.enabled=!1,this._hiddenWithMode(function(){i.isShow=!1,i.layer.hidden(),e.onHidden(),i._modeDisplayRuning=!1,i.enabled=!0,e.onDisplayFinished&&e.onDisplayFinished()}))},_showWithMode:function(t){{var e=this.getProperty();Core.System.winSize()}switch(e.displayMode){case"alpha":DialogDisplaySet.alpha.show(this.entity,20,t)}},_hiddenWithMode:function(t){{var e=this.getProperty();Core.System.winSize()}switch(e.displayMode){case"alpha":DialogDisplaySet.alpha.hidden(this.entity,20,t)}},destroy:function(){try{this.getProperty().nodes.iframe&&(this.getProperty().nodes.iframe.src="")}catch(t){}this.entity&&this.entity.parentNode.removeChild(this.entity),this.entity=null,this.ifm&&(this.ifm.parentNode.removeChild(this.ifm),this.ifm=null)},onShow:function(){},onClose:function(){},onHidden:function(){},onDrag:function(){},onDisplaied:function(){},onDisplayFinished:function(){},setAreaLocked:function(t){var e=this.getProperty();e.dragEntity.isLock=t;var i=this;t&&(i._updateLockArea(),Core.Events.addEvent(window,function(){i._updateLockArea()},"resize"))},_updateLockArea:function(){var t=this.getProperty(),e=Core.System.winSize();t.isFixed?$IE6?(t.dragEntity.lockArea={left:document.documentElement.scrollLeft,right:document.documentElement.scrollLeft+e.width,top:document.documentElement.scrollTop,bottom:document.documentElement.scrollTop+e.height},Core.Events.addEvent(window,function(){t.dragEntity.lockArea={left:document.documentElement.scrollLeft,right:document.documentElement.scrollLeft+e.width,top:document.documentElement.scrollTop,bottom:document.documentElement.scrollTop+e.height}},"scroll"),Core.Events.addEvent(window,function(){t.dragEntity.lockArea={left:document.documentElement.scrollLeft,right:document.documentElement.scrollLeft+e.width,top:document.documentElement.scrollTop,bottom:document.documentElement.scrollTop+e.height}},"resize")):t.dragEntity.lockArea={left:0,right:e.width,top:0,bottom:e.height}:t.dragEntity.lockArea={left:0,right:document.documentElement.scrollWidth,top:0,bottom:document.documentElement.scrollHeight}},updateFixed:function(){this.getProperty().layer.updateFixed()},getNodes:function(t){return this.getProperty().layer.getNodes(t)},setFocus:function(){var t=this.getProperty();if(t.focusNode&&"none"!=t.focusNode.style.display)try{t.focusNode.focus()}catch(e){}else"none"!=this.entity.style.display&&this.entity.focus()},getUniqueID:function(){return this.getProperty().layer.getUniqueID()}},$SYSMSG.extend({A00001:"系统繁忙，请稍候再试。",A00007:"未登录。",A00004:"系统繁忙，请稍候再试。",A00112:"博客名称超长。",A00113:"您已开通博客，请点击<a href=\'http://control.blog.sina.com.cn/blogprofile/index.php\'>个人中心</a>进入。",A00116:"不能包含 sina 等有特殊含义的字符。",A11003:"此账户已完成博客快速设置，点击确定，直接进入博客。",A44001:"博客个性地址不能为空。",A44002:"地址格式不对。",A44003:"抱歉，此地址已被占用。",A44005:"抱歉，请按照正确格式填写博客地址。"}),function(){function t(){for(var t=$nick,e=Core.String.byteLength(t);e>18;)t=t.substring(0,t.length-1),e=Core.String.byteLength(t);return t+"的博客"}function e(t,e,i,n){t.onfocus=function(){t.className="ipt focus",s(i,""),n.style.display=""},t.onblur=function(){t.className="ipt",a(t,e,n),s(i,"none")},t.onkeyup=function(){a(t,e,n)}}function i(t){if(i.requestComplete!==!1){if(t.nameErrorEle.innerHTML)return n(t.nameErrorEle.parentNode),void setTimeout(function(){n(t.nameErrorEle.parentNode)},442);i.requestComplete=!1;var e="floatingLayer"===t.from?"openBlogOkBtn_t":"openBlogOkBtn";$E(e).className="loading";var s={loginName:o(),blogName:t.openName};new Interface(c,"jsload").request({GET:{uid:$UID,loginname:s.loginName,blogname:s.blogName,version:7,src:"layer",isprivate:t.isprivate},onSuccess:function(n){i.requestComplete=!0,$E(e).className="btn",t.okCallback(n,s),s=null},onError:function(n){var o=$E("blogNameError"),s=$E("blogNameIcon"),a=$E("blogNameError_t"),l=$E("blogNameIcon_t");switch(n.code){case"A11008":o&&s&&r(o,"输入内容有误，请修改",s),a&&l&&r(a,"输入内容有误，请修改",l);break;case"A11010":o&&s&&r(o,"输入内容有误，请修改",s),a&&l&&r(a,"输入内容有误，请修改",l);break;default:r(t.errorEle,"系统繁忙，请稍后再试。")}i.requestComplete=!0,$E(e).className="btn"}})}}function n(t){for(var e=1;55>=e;e++)!function(e){setTimeout(function(){t.style.backgroundColor="rgb(255, "+ +(200+e)+", "+(200+e)+")"},8*e)}(e)}function o(){var t=decodeURIComponent(Utils.Cookie.getCookie("SUP"));return t=t.split("&name=")[1],t=decodeURIComponent(t.split("&")[0])}function s(t,e){for(var i=0;t[i];i++)t[i].style.display=e}function a(t,e,i){var n=t.value;if(/^(?:\\s|[　])+|(?:\\s|[　])+$/.test(n)&&(t.value=Core.String.trim(n),n=t.value),n){var o=Core.String.byteLength(n);o>24?r(e,"博客名称超长",i):l(e,i)}else r(e,"博客名称不能为空",i)}function r(t,e,i){t.innerHTML=e,t.style.display="block",t.id.indexOf("ErrTips")>=0&&(t.style.visibility="visible"),i&&(i.className="SG_icon SG_icon48 tips")}function l(t,e){t.innerHTML="",t.style.display="none",e&&(e.className="SG_icon SG_icon49 tips")}if(scope.blogOpener)return void(scope.addBlogOpenerEvent=function(){});var c="http://control.blog.sina.com.cn/riaapi/reg/open_blog.php",d=function(){this._hasInit=!1};d.prototype={getCon:function(){return[\'<div class="CP_layercon8"><div class="nowOpenBlog"><strong>您的博客尚未开通,仅一步操作就能开通您的个人博客</strong><div class="boxA"><label>博客名称：</label><input id="blogNameInput_t" type="text" class="ipt" /><img style="display:none" id="blogNameIcon_t" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" class="SG_icon SG_icon49 tips"><p id="blogNameError_t" class="tip">名称不能为空</p></div><div  class="boxA"> <p>隐私设置：<input type="radio" name="isPrivate_t" checked id="openAll1_t" class="rd" /><label for="openAll1_t">对所有人开放</label><input type="radio" name="isPrivate_t" id="openMe1_t" class="rd" /><label for="openMe1_t">仅对自己开放，私密博客</label></p></div><div id="ErrTips_t" class="ErrTips">系统繁忙，请稍后再试</div><div class="boxB"><p><a id="openBlogOkBtn_t" class="btn" href="javascript:void(0)">完成开通</a><a id="openBlogCancel" href="javascript:void(0)">取消</a></p></div></div></div>\'].join("")},_initDialog:function(){Lib.checkAuthor(),this.key=o(),this._dialog=winDialog.createCustomsDialog({content:this.getCon()},"openblog"),this.bindEvent(),e($E("blogNameInput_t"),$E("blogNameError_t"),[],$E("blogNameIcon_t"))},showDialog:function(t,e,i){e=e||!1,this._hasInit||(this._initDialog(),this._hasInit=!0);var n=this;if(scope.whenOpenBlogCallback=t,scope.hasOpenBlog)trace("这是已登陆的用户"),"open"==scope.hasOpenBlog?(trace("并且他开通的博客"),scope.whenOpenBlogCallback&&scope.whenOpenBlogCallback()):($E("openblogcss")||Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"}),trace("他们没有开通博客"),this._showDialog(e));else{trace("这是一位后登陆的用户");var o=0,s=setInterval(function(){trace("呀，怎么还没有出结果啊--"+o),scope.hasOpenBlog&&(clearInterval(s),"open"==scope.hasOpenBlog?(trace("并且他开通的博客"),scope.whenOpenBlogCallback&&scope.whenOpenBlogCallback()):(trace("他们没有开通博客"),n._showDialog(e))),o++,10==o&&(Lib.checkAuthor(),trace("等不及了，自己发吧。。。"),clearInterval(s),new Interface("http://control.blog.sina.com.cn/riaapi/profile/unread.php","jsload").request({GET:{uid:$UID,product:"blog"},onSuccess:function(t){scope.hasOpenBlog=1==t.isbloguser?"open":"no",trace("~~~~~~~~~~~~~~~~~~~"+scope.hasOpenBlog),"open"==scope.hasOpenBlog?(trace("并且他开通的博客"),scope.whenOpenBlogCallback&&scope.whenOpenBlogCallback()):($E("openblogcss")||Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"}),trace("他们没有开通博客"),n._showDialog(e))}}))},10)}i&&($E("openBlogCancel").style.display="none",this._dialog.getNodes().btnClose.style.display="none")},_showDialog:function(){$E("blogNameInput_t").value=t(),l($E("blogNameError_t"),$E("blogNameIcon_t")),$E("ErrTips_t").style.visibility="hidden",$E("blogNameIcon_t").style.display="none",this._dialog.show(),this._dialog.setAreaLocked(!0),this._dialog.setMiddle()},bindEvent:function(){var e=this;Core.Events.addEvent($E("openBlogCancel"),function(){return e.closeDialog(),!1}),Core.Events.addEvent($E("openBlogOkBtn_t"),function(){return i({nameErrorEle:$E("blogNameError_t"),nameOkIcon:$E("blogNameIcon_t"),openName:$E("blogNameInput_t").value||t(),isprivate:$E("openAll1_t").checked?0:1,errorEle:$E("ErrTips_t"),from:"floatingLayer",okCallback:function(t,i){scope.whenOpenBlogCallback&&scope.whenOpenBlogCallback(t,i),$E("openedBlogTray")&&"none"==$E("openedBlogTray").style.display&&($E("outOfOpenBlogTray").style.display="none",$E("noOpenedBlogTray").style.display="none",$E("openedBlogTray").style.display=""),$E("noOpendBlogSearchTip")&&"block"==$E("noOpendBlogSearchTip").style.display&&($E("noOpendBlogSearchTip").style.display="none",$E("opendBlogSearchTip").style.display="block"),scope.hasOpenBlog="open",e.closeDialog(),scope.whenOpenBlogCallback=function(){}}}),!1})},closeDialog:function(){this._dialog.hidden()}},scope.openBlogGetShotName=t,scope.openBlogNameEvent=e,scope.openBlogWhenOpenBlog=i,scope.blogOpener=new d,scope.addBlogOpenerEvent=function(t){Core.Events.addEvent(t,function(){scope.blogOpener.showDialog(function(t,e){if(Lib.LocalDB.clearCache(1,"uid_"+$UID+"unread"),Lib.util.LS.removeItem("uid"+$UID),"fakeIndex"==scope.$pageid)return void(window.location.href="http://i.blog.sina.com.cn/blogprofile/index.php?atten=1");if($E("openedBlogTray"))$E("openedBlogTray").style.display="",$E("noOpenedBlogTray").style.display="none",$E("outOfOpenBlogTray").style.display="none",e&&($E("loginBarAppMenuLabel").innerHTML=e.loginNick);else{var i=window;i.$tray&&i.$tray.renderLogin()}var n=function(){scope.___importV&&(scope.___importV(),scope.___openBlogFlag=1)},o={subText:scope.___importV?"":[\'<div class="CP_w_cnt SG_txtb">欢迎您在新浪博客安家！除了写博客，看博客外，您还可以进入个人中心完善您的个人资料，更有很多有趣的应用等着您哦。</div>\',\'<ul class="CP_w_part CP_w_aLine">\',\'<li><a href="http://control.blog.sina.com.cn/blogprofile/index.php" onclick="winDialog.getDialog(\\\'unregister\\\').hidden();" target="_blank">到博客个人中心&gt;&gt;</a></li>\',"</ul>"].join(""),icon:"03",funcOk:n,funcClose:n,width:300};winDialog.alert("开通博客成功",o,"unregister");var s=$E("commentNick");if(s){for(var a=s.firstChild;a;)s.removeChild(a),a=s.firstChild;s.innerHTML=e.loginNick+":"}},!0)},"click")}}(),Lib.register("TrayPanel",function(t){var e=Core.Events.addEvent,i=Core.Events.removeEvent,n=Utils.Cookie.getCookie,o=Core.Dom.contains,s=t.util.JSON,a=Core.Dom.getChildrenByClass,r="login_bar_logo_link_350",l="______noticeTrayHolder",c=0,d=null,h=function(t,e,i){return"string"!=typeof i?t.getAttribute(e):void t.setAttribute(e,i)},u=Core.Class.define(function(){var e=a(document.body,"nsinatopbar")[0],i=this.$main=a(e,"ntopbar_main")[0];this.newTipsLog=0,t.Panel.prototype.initialize.call(this,{appendTo:i,isPostion:!1,noIframe:!0}),t.Listener.on({name:"tray-data-loaded",callBack:this.showPublishWare,scope:this},{name:"tray-newmsg-loaded",callBack:this.showNewMsgTips,scope:this},{name:"global-login-out",callBack:function(){clearInterval(this._msgTimer)\n},scope:this},{name:"tray-announce-loaed",callBack:function(t){var e=arguments,i=this;return this.notice?void this.notice.update(t):void setTimeout(function(){e.callee.call(i,t)},200)},scope:this},{name:"tray-unread-panel-hide",callBack:function(){var t=this.getNode("trayMsg"),e=s.parse(t.getAttribute("msg-count"));this.showNewMsgTips(e,1)},scope:this},{name:"tray-unread-panel-show",callBack:function(){var t=this.getNode("newTips");t.style.display="none"},scope:this},{name:"tray-msg-panel-hide",callBack:function(){var t=this.getNode("trayMsg"),e=s.parse(t.getAttribute("msg-count"));this.showNewMsgTips(e,1)},scope:this},{name:"tray-announce-close",callBack:function(){this.setTrayPosition()},scope:this},{name:"topad680-show-start",callBack:function(){this._hideActiveSub()},scope:this}),c&&c++},t.Panel,{subPanels:[],hoverTimeout:"",hoverTime:400,load:function(e){if(!c){var i=$E(r);i&&$_GLOBAL&&$_GLOBAL.platformTrayLogo&&(!$IE6&&$_GLOBAL.platformTrayLogo.imgForOtherBrs?i.children[0].src=$_GLOBAL.platformTrayLogo.imgForOtherBrs:$_GLOBAL.platformTrayLogo.imgForIE6&&(i.children[0].src=$_GLOBAL.platformTrayLogo.imgForIE6)),this.initSearch()}switch(e){case"login":/ipad/i.test(navigator.userAgent)&&v7sendLog("48_01_02");var n=(new Date,this);t.tray.loadUserInfo($UID,function(e){scope.unreadMsg=e,scope.nickname=e.full_nickname,scope.loginUserWtype=e.login_wtype,n._isRenderUser||(n.renderRight(t.tray.tpl.loginMemu),n._isRenderUser=!0);var i,o,s;if(e.isbloguser){var a=n.getNode("noOpenBlog");a.style.display="none",n.initUserMenu(),n.initBlogMenu(e),n.initNewMsgEvt(),n.initMsg(),n.initMsgLoder(),n.initHideSub(),n.initunReadMsgPanel(),i=n.getNode("userNick"),o=n.getNode("openBlog")}else i=n.getNode("ssoNick"),i.href="http://control.blog.sina.com.cn/myblog/htmlsource/blog_notopen.php?uid="+$UID+"&version=7",n.initOpenBlog(),n.initLogout(),o=n.getNode("noOpenBlog");i.innerHTML="";var r=document.createTextNode(e.nickname);i.appendChild(r),o.style.display="block";var l=Utils.Cookie.getCookie("loginFromMsn");if(l&&i){s=n.getNode("msnHolder"),s.style.display="block";var c=n.getNode("msnLink");c.href+=$UID}s&&Core.Dom.insertAfter(s,i.parentNode),n.initNotice()});break;case"logout":this.trayLogin||(this.trayLogin=new t.Login.Ui,this.renderRight(t.tray.tpl.loginOutMemu)),this.initLogin(),this.initNotice();break;case"oncelogedon":}c++},initMsgLoder:function(){if(!this.msgLoader){this.msgLoader=new t.tray.MsgLoader,this.msgLoader.load($UID);var e=this;this._msgTimer=setInterval(function(){e.msgLoader.load($UID)},3e4)}},initLogin:function(){var i=this,n=h(this._el,"login");n||(h(this._el,"login","1"),e(this._el,function(e){var n=t.util.getActionData(e,"tray-login-btn");n&&("undefined"!=typeof sinaSSOController&&(sinaSSOController.loginExtraQuery={}),i.trayLogin.login(function(){Lib.checkAuthor();var t=$UID==scope.$uid?"02":"01";v7sendLog("87_01_"+t+"_"+$UID,scope.$pageid),setTimeout(function(){window.location=window.location.toString().replace(/#.*/,"")},100)},!1,"referer:"+location.hostname+location.pathname+",func:0007"))},"click"))},initLogout:function(){var i=this.getNode("ssoLoginOut"),n=h(i,"loginout");n||(h(this._el,"login","1"),e(i,function(){t.tray.loginOut(null,!0)})),i=null},initHideSub:function(){var t=this;e(document.body,function(e){if(t._activeTab){for(var i,n=e.target||e.srcElement,s=t.subPanels,a=s.length-1;a>=0;a--){if(i=s[a],i.tab===n||o(i.tab,n))return;if(i.panel.entity===n||o(i.panel.entity,n))return}t._hideActiveSub()}},"click"),e(window,function(){var e=t._activeTab;if(e){var i=e.tab,n=e.panel,o=e.left,s=e.top,a=Core.Dom.getLeft(i)+i.offsetWidth+o,r=Core.Dom.getTop(i)+i.offsetHeight+s;$IE6&&this.isFixed&&(a-=document.documentElement.scrollLeft,r-=document.documentElement.scrollTop),n.setPosition(a,r)}},"resize")},_hideActiveSub:function(){var t=this;if(t._activeTab){var e=t._activeTab.tab,i=t._activeTab.panel;t._activeTab=null,i.hidden(),e.className=e.className.replace(/(?:[ ]*)\\bcurrent\\b/g,"")}},initUserMenu:function(){var e=this.getNode("userMenu"),i=h(e,"init");if(!i){h(e,"init","1");var n,o=this,s=o.getNode("userMenu"),a=o._findSub("userMenu"),r=0;Lib.util.hoverJq({elm:e,mouseenter:function(){if(clearTimeout(o.hoverTimeout),!r){r=1;var i;a?i=a.panel:(i=new t.tray.UserMenuPanel,o.addSubPanel("userMenu",i,e,s));var n=i.getNode("panel");i.initUserInfo($UID),Lib.util.hoverJq({elm:n,mouseenter:function(){clearTimeout(o.hoverTimeout),o._showPanel("userMenu",-160,0)},mouseleave:function(){o.hoverTimeout=setTimeout(function(){o._hideActiveSub()},o.hoverTime)}}),l(function(t){t&&(i.getNode("mail").style.display="")})}o._showPanel("userMenu",-160,0)},mouseleave:function(){o.hoverTimeout=setTimeout(function(){o._hideActiveSub()},o.hoverTime)}});var l=function(t){"boolean"==typeof n?t(n):Utils.Io.JsLoad.request("http://service.mail.sina.com.cn/mailproxy/mail.php",{onComplete:function(){var e=sinamailinfo.email;n=""!=e?!0:!1,t(n)},onException:function(){}})}}},initBlogMenu:function(e){var i=this.getNode("addArticle"),n=h(i,"init");if(!n){h(i,"init","1");var o=this,s=o.getNode("blogMenu"),a=0;Lib.util.hoverJq({elm:s,mouseenter:function(){if(clearTimeout(o.hoverTimeout),!a){a=1;var n,r=o._findSub("blogMenu");r||(n=new t.tray.BlogMenuPanel,o.addSubPanel("blogMenu",n,i,s),1===e.tbh_status&&(n.getNode("tbh_status").style.display=""));var l=n.getNode("panel");Lib.util.hoverJq({elm:l,mouseenter:function(){clearTimeout(o.hoverTimeout),o._showPanel("blogMenu",-74,0)},mouseleave:function(){o.hoverTimeout=setTimeout(function(){o._hideActiveSub()},o.hoverTime)}})}o._showPanel("blogMenu",-74,0)},mouseleave:function(){o.hoverTimeout=setTimeout(function(){o._hideActiveSub()},o.hoverTime)}})}},initNotice:function(){var o=scope.$PRODUCT_NAME,s=scope.$pageid;if("blog7"!==o)return void(this.noNotice=!0);if(-1===s.indexOf("article")&&-1===s.indexOf("index"))return void(this.noNotice=!0);var a=n("closeNotice_fzp"),l=$E("sinablogHead");if(Lib.checkAuthor(),a&&a===$UID||!l)return void(this.noNotice=!0);if(!this.notice){var c=new t.tray.BlogNotice({appendTo:$E(r).parentNode,isPostion:!1,noIframe:!0});this.notice=c;var d,h=this,u=l.offsetHeight+30,p=function(){var t=document,e=t.body.scrollTop+t.documentElement.scrollTop;e>u?(h.hideActive(),h.setTrayFixed(),d||(d=1,v7sendLog("48_01_11_"+scope.$pageid))):setTimeout(function(){h.setTrayPosition(),c.hide()})};e(window,p,"scroll"),t.Listener.on({name:"tray-announce-close",callBack:function(){i(window,p,"scroll")}})}},initNewMsgEvt:function(){var t=(this.tpl,this.getNode("newTips")),i=h(t,"init");if(!i){h(t,"init","1");var n=this;e(t,function(t){t=t||window.event;var e=t.target||t.srcElement;Core.Events.stopEvent(t),e.style.display="none",e.innerHTML="";var i=n.getNode("trayMsg");Core.Events.fireEvent(i,"click")},"click"),t=null}},initMsg:function(){var t=this.getNode("trayMsg"),e=h(t,"init");if(!e){h(t,"init","1");var i=this,n=0;Lib.util.hoverJq({elm:t,mouseenter:function(t){if(clearTimeout(i.hoverTimeout),!n){n=1;var e=window.event||t;e.preventDefault?e.preventDefault():e.returnValue=!1;var o,s=i.getNode("trayMsg"),a=i._findSub("msgPanel");a||(o=new Lib.tray.msgSummaryPanel(s),i.addSubPanel("msgPanel",o,s,s));var r=o.getNode("panel");Lib.util.hoverJq({elm:r,mouseenter:function(){clearTimeout(i.hoverTimeout),i._showPanel("msgPanel",-400,0)},mouseleave:function(){i.hoverTimeout=setTimeout(function(){i._hideActiveSub()},i.hoverTime)}})}i._showPanel("msgPanel",-400,0)},mouseleave:function(){i.hoverTimeout=setTimeout(function(){i._hideActiveSub()},i.hoverTime)}})}},initunReadMsgPanel:function(){var e=this.getNode("trayMsg"),i=h(e,"init-unre");i||(h(e,"init-unre","1"),new t.tray.unReadMsgPanel(e))},initSearch:function(){if(!c){var i=new t.tray.SearchFormPanel({isPostion:!1,appendTo:"traySearchBar",noIframe:!0});i.show(),e(document.body,function(t){t=t||window.event;var e=t.target||t.srcElement,n=i.getNode("queryTxt");n===e||i.entity===e||o(e,i.entity)||i.catePanel.hide()},"click")}},initOpenBlog:function(){var t=$E("openblogcss");if(!t){Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"});var e=this.getNode("openBlogBtn");scope.addBlogOpenerEvent(e)}},notifyMsgPanel:function(t){var e=t.getAttribute("msg-count");if(e)try{e=s.parse(e)}catch(i){e={}}else e=-1},renderRight:function(t){this.setTemplate(t),this._el=this.entity;var e=a(this.$main,"ntopbar_loading")[0];e.style.display="none",this.show()},addSubPanel:function(t,e,i,n){this.subPanels.push({name:t,tab:n,bind:i,panel:e})},_showPanel:function(t,e,i){var n=this._findSub(t);if(n){var o=n.panel,s=n.tab;if(o.entity.style.zIndex=512,"msgPanel"===t){var a=this.getNode("newTips");this.notifyMsgPanel(s),a.style.display="none"}var r,l;if(r=this._activeTab){if(l=r.tab,l===s)return;r.panel.hide(),l.className=l.className.replace(/(?:[ ]*)\\bcurrent\\b/g,"")}var c=s.className;/\\bcurrent\\b/.test(c)||(s.className+=" current"),this._activeTab={name:t,tab:s,panel:o,left:e,top:i};var d=o.entity;d.style.position=this.isFixed&&(!$IE||$IE>6)?"fixed":"absolute",o.showWithDom(s,e,i)}},_findSub:function(t){for(var e,i=this.subPanels.length-1;i>=0;i--)if(e=this.subPanels[i],t===e.name)return e;return null},showNewMsgTips:function(t){var i=t.sum-t.feed,n=this.getNode("newTips"),o=this.getNode("trayMsg");if(i){0==o.getAttribute("unread-show-state")&&0==o.getAttribute("msg-panel-show-state")&&(n.style.display="block"),"editor"==scope.$pageid&&(n.style.display="block");var a=this.entity.offsetWidth;n.style.left=a-n.offsetWidth-10+"px",n.innerHTML=10>i?i:"•••",this.newTipsLog||(v7sendLog("40_01_49_"+$UID),this.newTipsLog=1),o.setAttribute("msg-count",s.stringify(t)),this.startTitleTips(i)}else o.setAttribute("msg-count",s.stringify(t)),this.stopTitleTips();var r=t.feed;if(r){var l=this.getNode("newFeed");l.style.display="block";var a=this.entity.offsetWidth;l.style.left=a-l.offsetWidth-197+"px",r=10>r?r:"•••",l.innerHTML=r,l.addEvt||(l.addEvt=1,e(l,function(){location.href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1",l.style.display="none",l.innerHTML=""}))}},stopTitleTips:function(){if("editor"!=scope.$pageid){var t=document.title.replace(/\\(\\d+\\+*\\)/,"");document.title=t}},startTitleTips:function(t){if("editor"!=scope.$pageid){var e;t&&(t=t>=1e5?"99999+":t,e=/\\(\\d+\\+*\\)/.test(document.title)?document.title.replace(/\\(\\d+\\+*\\)/,"("+t+")"):"("+t+")"+document.title),document.title=e}},hideActive:function(){var t,e;(t=this._activeTab)&&(t.panel.hide(),e=t.tab,e.className=e.className.replace(/(?:[ ]*)\\bcurrent\\b/g,""),this._activeTab=null)},setTrayFixed:function(){var i=$E(r);this.notice.show();var n=this;setTimeout(function(){$E("traySearchBar").parentNode.style.display="none",i.style.display="none";var o=i.parentNode.parentNode;if(!$IE||$IE>6?(t.Listener.notify("tray-scrolling-fix",{}),o.style.position="fixed",o.style.top="0px"):6===$IE&&(n.__isFixie6||(e(window,function(t){if(n.isFixed){var e=document.documentElement.scrollTop;setTimeout(function(){var i=document.documentElement.scrollTop;e===i?(o.style.display="block",n._ie6fix(t)):n.isFixed&&(o.style.display="none")},50)}},"scroll"),n.__isFixie6=!0)),o.style.width="100%",!$E(l)){var s=o.offsetHeight,a=$C("div");a.style.height=s+"px",a.id=l,Core.Dom.insertAfter(a,o)}n.isFixed=!0})},_ie6fix:function(){if(this.isFixed){var e=$E(r),i=e.parentNode.parentNode;i.style.position="absolute",i.style.top=document.documentElement.scrollTop+"px";var n=this.getNode("trayMsg");n&&(n.style.display="none",n.style.display=""),t.Listener.notify("tray-scrolling-fix",{})}},setTrayPosition:function(){if($IE6){var e=this.getNode("trayMsg");e&&(e.style.display="none",e.style.display="")}t.Listener.notify("tray-scrolling-nofix",{});var i=$E(r),n=i.parentNode.parentNode;$E(l)&&n.parentNode.removeChild($E(l)),n.style.position="";var o=$E("traySearchBar");o.style.position="",o.style.top="",this.notice.hide(),n.style.display="block",i.style.display="block",$E("traySearchBar").parentNode.style.display="block",this.isFixed=!1}});return Lib.tray.TrayPanel=u,function(){return d||(d=new u),d}}),Sina.pkg("Utils.Form"),Utils.Form.limitMaxLen=function(t,e){var i,n=function(){i=t.value;var n=Core.String.byteLength(i);n>e&&(t.value=Core.String.leftB(i,e))};Core.Events.addEvent(t,Core.Function.bind3(n,t),"keyup"),Core.Events.addEvent(t,Core.Function.bind3(n,t),"blur"),Core.Events.addEvent(t,Core.Function.bind3(n,t),"focus")},Core.System.htmlFilter=function(t){var e,i={"&":"&#038;","<":"&#060;",">":"&#062;"};for(e in i)t=t.replace(new RegExp(e,"g"),i[e]);return t},Utils.Io.loadExternalCSS=function(t,e){if("string"==typeof t){var i,n,o=document.getElementsByTagName("head")[0];$FF?(n=$C("style"),n.type="text/css",n.innerHTML="@import url("+t+")",o.appendChild(n),function(){try{n.sheet.cssRules,"function"==typeof e&&e()}catch(t){setTimeout(arguments.callee,50)}}()):(i=$C("link"),i.href=t,i.type="text/css",i.rel="stylesheet",i.media="all",o.appendChild(i),$SAFARI||$CHROME?!function(){try{i.sheet.cssRules,"function"==typeof e&&e()}catch(t){setTimeout(arguments.callee,50)}}():i.onload=function(){i.onload=null,"function"==typeof e&&e()})}},Core.Events.click=function(){var t=/mobile/i.test(navigator.userAgent);return $IE&&$IE<9?function(t){t.click()}:function(e){var i;i=document.createEvent(t?"HTMLEvents":"MouseEvents"),i.initEvent("click",!0,!0),e.dispatchEvent(i)}}(),Core.Dom.removeClassName=Core.Dom.removeClass,scope.trayPlusTemplayLogout=[\'<div class="topbar_menu">\',\'<span class="link"><a target="_blank" href="http://blog.sina.com.cn">博客首页</a></span>\',\'<span class="line_s"></span>\',"</div>",\'<div class="topbar_login"><a id="linkTrayLogin" class="login" href="javascript:;">登录</a><a id="linkReg" target="_blank" class="register" href="">注册</a></div>\',\'<div id="divPopularize" class="topbar_ad"></div>\',\'<div id="loginBarActivity" class="topbar_activity"></div>\'].join(""),scope.trayPlusTemplayLogin=[\'<div class="topbar_menu" id="openedBlogTray">\',\'<span id="loginBarOptApp" class="link"><a id="loginBarAppMenuLabel" href="javascript:;">读取中...</a><a href="javascript:;" class="link_arrow" title=""></a></span>\',\'<span class="line_s"></span>\',\'<span style="display:none;" id="loginBarMail" class="link imfor blog_to_mail"><a target="_blank" href="http://mail.sina.com.cn/?s=2">邮件</a><div id="mailpiaohong" style="display:none;" class="imforbox"></div></span>\',\'<span class="line_s" style="display:none;" id="line"></span>\',\'<span id="loginBarCenter" class="link"><a target="_self" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1">个人中心</a></span>\',\'<span class="line_s"></span>\',\'<span id="loginBarFriend" class="link"><a target="_blank" href="http://control.blog.sina.com.cn/blogprofile/profilefriendlist.php">好友</a></span>\',\'<span class="line_s"></span>\',\'<span id="loginBarInbox" class="link imfor"><img id="imgNewMessage" style="display:none;" class="topbar_msg" src="http://simg.sinajs.cn/blog7style/images/common/topbar/topbar_msg.gif"/><a href="#" onclick="return false;">消息</a><a href="#" onclick="return false;" class="link_arrow" title=""></a><div id="ccnotepiaohong" style="display:none;" class="imforbox"></div></span>\',\'<span class="line_s"></span>\',\'<span class="link" id="logOut"><a href="#">退出</a></span>\',"</div>",\'<div style="display:none" class="topbar_menu" id="noOpenedBlogTray">\',\'<span class="link" style="cursor:default;"><a id="noOpenBlogName">读取中...</a></span>\',\'<span class="line_s"></span>\',\'<span class="link"><a href="#">退出</a></span>\',"</div>",\'<div class="topbar_noopen" style="display:none" id="outOfOpenBlogTray">\',\'<a id="openBlogBtnTray" title="立即开通博客" class="nowopen" href="javascript:void(0)" onclick="return false;"></a>\',"</div>",\'<div id="loginBarActivity" class="topbar_activity"></div>\'].join(""),scope.trayPlusTemplayOnceLoged=[\'<div class="topbar_menu" id="openedBlogTray">\',\'<span id="loginBarOptApp" class="link"><a id="loginBarAppMenuLabel" href="javascript:;">读取中...</a></span>\',\'<span class="line_s"></span>\',\'<span id="loginBarMail" class="link imfor blog_to_mail"><a target="_blank" href="http://mail.sina.com.cn/?s=2">邮件</a><div id="mailpiaohong" style="display:none;" class="imforbox"></div></span>\',\'<span class="line_s" id="line"></span>\',\'<span id="loginBarCenter" class="link"><a target="_self" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1">个人中心</a></span>\',\'<span class="line_s"></span>\',\'<span id="loginBarFriend" class="link"><a target="_blank" href="http://control.blog.sina.com.cn/blogprofile/profilefriendlist.php">好友</a></span>\',\'<span class="line_s"></span>\',\'<span id="loginBarInbox" class="link imfor"><img id="imgNewMessage" style="display:none;" class="topbar_msg" src="http://simg.sinajs.cn/blog7style/images/common/topbar/topbar_msg.gif"/><a href="#" onclick="return false;">消息</a><div id="ccnotepiaohong" style="display:none;" class="imforbox"></div></span>\',"</div>",\'<div style="display:none" class="topbar_menu" id="noOpenedBlogTray">\',\'<span class="link" style="cursor:default;"><a id="noOpenBlogName">读取中...</a></span>\',\'<span class="line_s"></span>\',\'<span class="link"><a href="#">退出</a></span>\',"</div>",\'<div class="topbar_noopen" style="display:none" id="outOfOpenBlogTray">\',\'<a id="openBlogBtnTray" title="立即开通博客" class="nowopen" href="javascript:void(0)" onclick="return false;"></a>\',"</div>",\'<div id="divPopularize" class="topbar_ad"></div>\',\'<div id="loginBarActivity" class="topbar_activity"></div>\'].join(""),scope.newStatusTipTemplay=[\'<div class="tb_layer_arrow"></div>\',\'<div class="tb_layer_Y_main tip_ps" style="width:130px;text-align:left;padding:5px 0 2px 5px;color:#000000">\',\'<a onclick="$E(\\\'newStatusTip\\\').style.display=\\\'none\\\';return false" href="#" class="tb_friend_inputDel" title="关闭" style="margin-top: 5px;"></a>\',\'<a href="http://i.blog.sina.com.cn/blogprofile/index.php?type=3&from=newstatus&com=2"><span id="nstFeed" style="padding:2px 2px;display:none;">你有<span style="color:red">新动态</span>可查看</span></a>\',\'<a href="http://control.blog.sina.com.cn/blogprofile/profileremind.php?com=2"><span id="nstFavorite" style="padding:3px 2px;display:none;">你有博文被<span style="color:red">转载/收藏</span></span></a>\',\'<img id="gbimg" class="SG_icon SG_icon83" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="17" height="15" align="absmiddle" style="display:none"/><a style="display:none" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=g" id="gbmsg">官博<em>新动态</em></a>\',"</div>"].join(""),scope.onceLogedStatusTipTemplay=[\'<div class="tb_layer_arrow"></div>\',\'<div class="tb_layer_Y_main tip_ps" style="width:130px;text-align:left;padding:5px 0 2px 5px;color:#000000">\',\'<a onclick="$E(\\\'newStatusTip\\\').style.display=\\\'none\\\';return false" href="#" class="tb_friend_inputDel" title="关闭" style="margin-top: 5px;"></a>\',\'<a href="javascript:void(0);return false;"><span id="nstUnread" style="padding:3px 2px;display:none;">你有<span style="color:red">未读消息</span>可查看</span></a>\',\'<a href="javascript:void(0);return false;"><span id="nstFeed" style="padding:2px 2px;display:none;">你有<span style="color:red">新动态</span>可查看</span></a>\',\'<a href="javascript:void(0);return false;"><span id="nstUpdate" style="padding:3px 2px;display:none;">你最近浏览的博主<span style="color:red">有更新</span></span></a>\',\'<a href="javascript:void(0);return false;"><span id="nstUnpub" style="padding:2px 2px;display:none;">你有<span style="color:red">尚未发表</span>的博文</span></a>\',"</div>"].join(""),scope.nicknamePanelTemplate=[\'<div id="#{panel}" class="tb_layer_Y tb_layer_w2" style="z-index:512;">\',\'<div class="tb_layer_arrow"></div>\',\'<div class="tb_layer_Y_main">\',\'<div class="tb_ps">\',\'<div class="tb_ps_list">\',"<ul>","<li>",\'<span class="tb_ps_nm"><a id="#{linkBlog}" href="javascript:;"><img class="SG_icon SG_icon15" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="博客" align="absmiddle" /><strong>博客</strong></a></span>\',\'<span class="tb_ps_set">[<a target="_blank" id="#{linkPostBlog}" href="http://control.blog.sina.com.cn/admin/article/article_add.php">发博文</a>]</span>\',"</li>","<li>",\'<span class="tb_ps_nm"><a id="#{linkPhoto}" href="javascript:;"><img class="SG_icon SG_icon18" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="相册" align="absmiddle" /><strong>相册</strong></a></span>\',\'<span class="tb_ps_set">[<a target="_blank" id="#{linkPostPhoto}" href="http://photo.blog.sina.com.cn/upload/upload.php">发图片</a>]</span>\',"</li>","<li>",\'<span class="tb_ps_nm"><a target="_blank" id="#{linkVBlog}" href="javascript:;"><img class="SG_icon SG_icon16" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="播客" align="absmiddle" /><strong>播客</strong></a></span>\',\'<span class="tb_ps_set">[<a target="_blank" id="#{linkUpload}" href="http://vupload.you.video.sina.com.cn/u.php?m=1">发视频</a>][<a id="#{linkRecord}" href="http://vupload.you.video.sina.com.cn/r.php" target="_blank">录视频</a>]</span>\',"</li>","<li>",\'<span class="tb_ps_nm"><a id="#{miniblog}" href="javascript:;" target="_blank"><img class="SG_icon SG_icon51" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="微博" align="absmiddle" /><strong>微博</strong></a></span>\',"</li>","<li>",\'<span class="tb_ps_nm"><a id="#{qingblog}" onclick="v7sendLog && v7sendLog(\\\'79_01_02\\\',scope.$pageid,\\\'qingLink\\\');" href="javascript:;" target="_blank"><img class="SG_icon SG_icon205" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="Qing" align="absmiddle" /><strong>Qing</strong></a></span>\',"</li>","<li>",\'<span class="tb_ps_nm"><a id="#{mySpace}" href="javascript:;"><img class="SG_icon SG_icon41" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="关于我" align="absmiddle" /><strong>关于我</strong></a></span>\',"</li>","</ul>",\'<div class="clearit"></div>\',"</div>",\'<div class="tb_ps_manage">\',\'<p><a target="_blank" id="#{linkChangeFace}" href="javascript:;">修改头像昵称</a></p>\',\'<p><a target="_blank" id="#{linkChangePassword}" href="javascript:;">修改登录密码</a></p>\',\'<p><a target="_blank" id="#{linkAccountSetup}" href="javascript:;">账号安全设置</a></p>\',\'<p><a target="_blank" id="#{bindEmail}" href="javascript:;">绑定邮箱</a></p>\',"</div>","</div>","</div>","</div>"].join(""),scope.NicknamePanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments),this.setTemplate(scope.nicknamePanelTemplate)},Lib.Panel,{initUserInfo:function(t){var e=this.getNodes();scope.$bindEmail=function(t){var i=e.bindEmail;"y"!=t.ret&&"not_verify"!=t.errcode?i.parentNode.removeChild(i):i.href="http://login.sina.com.cn/bindmail/bindmail.php?entry=blog"};try{var i=/user=([^&]+)&/g.exec(decodeURIComponent(Utils.Cookie.getCookie("SUP")))[1];Utils.Io.JsLoad.request("http://login.sina.com.cn/bindmail/checkmailuser.php?entry=blog&name="+encodeURIComponent(i)+"&utf82bgk=1&callback=scope.$bindEmail",{noreturn:!0})}catch(n){}e.linkBlog.href="http://blog.sina.com.cn/u/"+t,e.linkPhoto.href="http://photo.blog.sina.com.cn/u/"+t,e.linkVBlog.href="http://you.video.sina.com.cn/m/"+t,e.miniblog.href="http://control.blog.sina.com.cn/t_sina_blog/tb.php?uname="+t,e.qingblog.href="http://qing.blog.sina.com.cn/fancy.html",e.mySpace.href="http://blog.sina.com.cn/s/profile_"+t+".html",e.linkChangeFace.href="http://control.blog.sina.com.cn/blogprofile/nick.php",e.linkChangePassword.href="http://login.sina.com.cn/member/security/password.php",e.linkAccountSetup.href="http://login.sina.com.cn/member/security.php";for(var o=["linkBlog","linkPhoto","linkVBlog","miniblog","qingblog","mySpace","linkChangeFace","linkChangePassword","linkAccountSetup"],s=0;s<o.length;s++)e[o[s]].onclick=function(){v7sendLog("40_01_02_"+$UID)}}});var st=[\'<div id="#{panel}" style="z-index:512;" class="tb_layerBox">\',"<ul>",\'<li id="#{blog}"><a href="javascript:;" onclick="v7sendLog(\\\'40_01_19\\\')">博文</a></li>\',\'<li id="#{bauthor}"><a href="javascript:;" onclick="v7sendLog(\\\'40_01_19\\\')">博主</a></li>\',\'<li id="#{song}"><a href="javascript:;" onclick="v7sendLog(\\\'40_01_19\\\')">音乐</a></li>\',\'<li id="#{video}"><a href="javascript:;" onclick="v7sendLog(\\\'40_01_19\\\')">视频</a></li>\',\'<li id="#{vauthor}"><a href="javascript:;" onclick="v7sendLog(\\\'40_01_19\\\')">播主 </a></li>\',"</ul>","</div>"];scope.searchPanelTemplate=st.join(""),scope.SearchPanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments),this.setTemplate(scope.searchPanelTemplate)},Lib.Panel,{config:{blog:{text:"博文",url:"http://search.sina.com.cn/?c=blog",keyName:"q",range:"article",by:"all"},bauthor:{text:"博主",url:"http://search.sina.com.cn/?c=blog",keyName:"q",range:"author",by:"all"},song:{text:"音乐",url:"http://music.sina.com.cn/yueku/search/s.php",keyName:"k",t:"song",s:"",ts:"",type:"",stype:""},video:{text:"视频",url:"http://search.video.sina.com.cn/search.php",keyName:"k",t:"",s:"sup",ts:"",type:"boke",stype:"1"},vauthor:{text:"播主",url:"http://search.video.sina.com.cn/search.php",keyName:"k",t:"",s:"sup",ts:"",type:"boke",stype:"3"}}}),Core.Dom.opacity=function(t,e){t="string"==typeof t?$E(t):t,t.style.filter="alpha(opacity="+e+")",t.style.opacity=e/100};var st=[\'<div id="#{panel}" style="z-index:512;" class="tb_layer_Y tb_layer_w6" style="left:400px; top:700px;">\',\'<div class="tb_layer_arrow"></div>\',\'<div class="tb_layer_Y_main">\',\'<div class="tb_mas" id="#{newInboxList}" style="">\',\'<div class="tb_mas_list">\',\'<ul id="#{changebgli1}"  style="display:none" >\',\'<li  style="display:none" >\',\'<span id="#{ccsysgonggao}" class="tb_friend_nm">[<strong>公告</strong>] <a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">新浪邀你一起共度中秋活动</a></span>\',\'<span class="tb_friend_set"><a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">&gt;&gt;</a></span>\',"</li>",\'<li style="display:none">\',\'<span id="#{ccsystongzhi}" class="tb_friend_nm">[<strong>通知</strong>] <a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">新浪2010邀你一起共度中秋活动...</a></span>\',\'<span class="tb_friend_set"><a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">&gt;&gt;</a></span>\',"</li>","</ul>",\'<ul class="bd" id="#{changebgli2}">\',\'<li  id="#{newInboxLoding}" style="cursor:default" ><div style="margin: 0pt; padding: 10px;text-align:center;"><img src="http://simg.sinajs.cn/blog7style/images/common/loading.gif"><div></li>\',\'<li  id="#{nomsgli}" style="cursor:default;" >还没有消息</li>\',\'<li style="float:none;"><span class="mas_more"><a id="#{mas_moremsg}" href="http://i.blog.sina.com.cn/blogprofile/profilelatestnote.php">全部消息</a></span></li>\',"</ul>",\'<div class="clearit"></div>\',"</div>",\'<ul class="commentslist" id="commentdata">\',\'<li><a class="conn" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1">评论</a><a class="num" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1" id="#{commentRelapseCount}" ></a></li>\',\'<li><a class="conn" href="http://i.blog.sina.com.cn/blogprofile/wall.php">留言</a><a class="num" href="http://i.blog.sina.com.cn/blogprofile/wall.php" id="#{guestBookCount}">1</a></li>\',\'<li class="lst"><a class="conn" href="http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php">好友邀请</a><a class="num" href="http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php" id="#{inviteCount}" ></a></li>\',\'<li><a class="conn" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1">纸条</a><a class="num" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1" id="#{messageCount}" ></a></li>\',\'<li><a class="conn" target="_blank" href="http://mail.sina.com.cn" reject="1">邮箱</a><a class="num" href="http://mail.sina.com.cn" id="#{mailCount}" target="_blank" reject="1"></a></li>\',\'<li><a class="conn" href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">系统消息</a><a class="num" href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote" id="#{sysnoticeCount}" ></a></li>\',"</ul>","</div>","</div>","</div>"];scope.newInboxPanelTemplate=st.join(""),Lib.LocalDB={_this:null,isFlashReady:!1,FlaDom:null,updataFun:null,loadedFun:null,regiFun:[],regiFunArgs:[],scacheReady:function(){var t=Lib.LocalDB;t.isFlashReady=!0,t.loadedFun&&t.loadedFun(t._this);for(var e=t.regiFun,i=t.regiFunArgs,n=0;n<e.length;n++)e[n].apply(null,i[n])},registerFun:function(t,e){this.regiFun.push(t);var i=e||[];this.regiFunArgs.push(i)},set:function(t,e){if(this.isFlashReady)try{return this.FlaDom.setLazyInterface(t,e),!0}catch(i){trace("set函数出错")}return!1},get:function(t,e,i){if(this.isFlashReady)try{return this.FlaDom.getLazyInterface(t,e,i)}catch(n){trace("get函数出错")}return!1},clearCache:function(t,e){if(this.isFlashReady)try{$E("scache").clearCache(t,e)}catch(i){trace("gclearCache函数出错")}return!1},loadFlash:function(t){var e="";if((window.$Maxthon||window.$360||window.$TT)&&(e="?t="+Core.Math.getUniqueId()),!this.FlaDom){var i=new Utils.Flash.swfObject($_GLOBAL.flashBasicURL+"scache.swf"+e,"scache","1","1","9","#00ff00");i.addParam("quality","high"),i.addParam("wmode","transparent"),i.addParam("allowScriptAccess","always"),i.write(t),this.FlaDom=$E("scache")}},getServer:function(){try{return this.FlaDom.isServer()}catch(t){return trace("判断是否是通信主机发生错误"),!1}},login:function(t){try{this.FlaDom.login(t)}catch(e){trace("login函数出错"),trace(t)}},sendToClient:function(t){try{this.getServer()&&this.FlaDom.sendToClient(t)}catch(e){trace("sendToClient函数出错")}},setClientJsFun:function(t){try{this.getServer()?this.FlaDom.setClientJsFun(t):trace("非主机不可以设置接收函数")}catch(e){trace("setClientJsFun函数出错")}},receive:function(t){this.updataFun(t)}},scope.msnTipsTemplate=[\'<div id="#{panel}" style="position: absolute; width: 369px; padding-top: 7px; font-size: 12px; z-index:511">\',"<div  style=\\"top: 0pt; left: 65px; position: absolute; width: 16px; height: 8px; background: url(\'http://simg.sinajs.cn/blog7style/images/special/move/bg_boxtop_01.png\') no-repeat scroll 0pt 0pt transparent; z-index: 100;\\"></div>","<div style=\\"padding: 5px 6px 9px 14px; border: 1px solid rgb(181, 202, 214); background: url(\'http://simg.sinajs.cn/blog7style/images/special/move/bg_asiangames.jpg\') no-repeat scroll left bottom rgb(255, 255, 255); z-index: 1;\\">",\'<p id="#{close}" class="close" style="float: right; margin: 0pt; cursor: pointer; width: 8px; height: 8px; font-size: 0pt;background:url(\\\'http://simg.sinajs.cn/blog7style/images/special/move/btn_close.gif\\\') no-repeat 0 0;"></p>\',\'<div style="width: 342px; margin: 10px 0pt 0pt; padding: 0pt 0pt 3px;">\',\'<a style="float: left; margin: 0pt 10px 0pt 0pt;" href="#"><img height="91" width="122" style="border: 0pt none;" alt="MSN" src="http://simg.sinajs.cn/blog7style/images/special/move/img_msnphoto.png"></a>\',\'<h3 style="padding: 2px 0pt 5px; color: rgb(0, 0, 0); margin: 0pt; font-size: 12px;">各位拥有MSN帐号的同学注意啦!</h3>\',\'<p style="width: 268px; display: inline; text-indent: 0pt; padding: 0pt; color: rgb(51, 51, 51); line-height: 19px;">新浪博客帐号与MSN帐号已经实现关联。您可以使用MSN帐号来登录博客，绑定后发博文、发图片可同步到Live，第一时间让您的MSN好友知晓。</p>\',"</div>",\'<p style="clear: both; height: 30px; margin: 12px 10px 4px 0pt; padding: 12px 0pt 0pt; border-top: 1px solid rgb(220, 213, 211); text-align: right;"><a style="float: right; color: rgb(176, 173, 172); margin-top: 10px; text-decoration: none;" href="javascript:void(0);" id="#{noMoreShow}">不再显示</a><a style="float: right; text-decoration: none; margin: 10px 14px 0pt 16px;color:#2d3186;" href="http://blog.sina.com.cn/s/blog_4b0f52990100lt3i.html">帮助</a><a id="#{setNow}"style="float: right;" href="http://control.blog.sina.com.cn/blogprofile/msnbind.php"><img height="32" width="105" style="border: medium none;" alt="立即设置" src="http://simg.sinajs.cn/blog7style/images/special/move/btn_receive01.jpg"></a></p>\',"</div>","</div>"].join(""),scope.msnTips=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments),this.setTemplate(scope.msnTipsTemplate)\n},Lib.Panel,{initUserInfo:function(){var t=this.getNodes();this.setFixed($E("loginBarActivity"),-230,-2);var e=this;t.close.onclick=function(){e.hidden()},t.noMoreShow.onclick=function(){e.hidden(),Utils.Cookie.setCookie("noMoreMsnTips"+$UID,1,2400,"/",".blog.sina.com.cn")},t.setNow.onclick=function(){v7sendLog("95_02_01",scope.$pageid,"")}},setFixed:function(t,e,i){var n=this;setTimeout(function(){n.showWithDom(t,e,i),n.fadeIn()},2e3),Core.Events.addEvent(window,function(){var o=Core.Dom.getLeft(t)+t.offsetWidth+e,s=Core.Dom.getTop(t)+t.offsetHeight+i;$IE6&&n.isFixed&&(o-=document.documentElement.scrollLeft,s-=document.documentElement.scrollTop),n.setPosition(o,s)},"resize")},fadeIn:function(){var t=this.entity;Core.Dom.opacity(t,0);var e=0;!function i(){Core.Dom.opacity(t,e+=5),Core.Dom.getStyle(t,"opacity")<1&&setTimeout(i,20)}()}}),scope.NewInboxPanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments),this.setTemplate(scope.newInboxPanelTemplate),this.nodes=this.getNodes();var t=this,e=Lib.LocalDB;/Mobile/i.test(navigator.userAgent)?setTimeout(function(){t.requestDataInterface()},100):e.FlaDom?t.FlashLoaded(t):(e._this=t,e.loadedFun=t.FlashLoaded,e.loadFlash("trayFlashConnetion")),Core.Events.addEvent($E("loginBarInbox"),function(e){v7sendLog("40_01_09_"+$UID);var i=e&&e.target||window.event&&window.event.srcElement;i&&i.tagName&&"a"==i.tagName.toLowerCase()&&v7sendLog("45_01_10_"+$UID),t._hasOverview=!0,$E("ccnotepiaohong").style.display="none",t.requestMsgDate()},"click"),this.interfaceMessages=new Interface("http://interface.blog.sina.com.cn/riaapi/profile/unread.php","jsload")},Lib.Panel,{nodes:null,_connectSWF:null,_SWFChannelName:"inboxConnection",interfaceMessges:null,isMessageLoaded:!1,isUICServiceLoaded:!0,isHaveNewMessage:!1,_listData:null,_productIDs:{blog:1,vblog:2,group:4,photo:8,cube:16},_msgIsLoad:!1,_newnote:0,_hasOverview:!1,interfaceUICServiceURL:"http://uic.sinajs.cn/uic?type=service&uids=#{uids}&varname=service",FlashLoaded:function(t){var e=Lib.LocalDB,i=t;window.$updateData=function(t){i.updateData(t)},Lib.checkAuthor(),e.login($UID),e.setClientJsFun("$updateData"),setTimeout(function(){i.requestDataInterface()},100)},requestMsgDate:function(){this.updateView("loading");var t=this,e=0;this._hasOverview&&(e=this._newnote,this._newnote=0,this._hasOverview=!1);var i=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/note/notetips.php?clearnum="+e,"jsload");i.request({GET:{uid:$UID},onSuccess:function(e){if("undefined"!=typeof e.announcement&&e.announcement?(t.nodes.ccsysgonggao.innerHTML=\'[<strong>公告</strong>]&nbsp;<a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">\'+e.announcement+"</a>",t.nodes.ccsysgonggao.parentNode.style.display=""):t.nodes.ccsysgonggao.parentNode.style.display="none","undefined"!=typeof e.sysNote&&e.sysNote?(t.nodes.ccsystongzhi.innerHTML=\'[<strong>通知</strong>]&nbsp;<a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">\'+e.sysNote+"</a>",t.nodes.ccsystongzhi.parentNode.style.display=""):t.nodes.ccsystongzhi.parentNode.style.display="none",t.nodes.ccsystongzhi.parentNode.parentNode.style.display="undefined"==typeof e.sysNote&&"undefined"==typeof e.announcement?"none":"",t.nodes.nomsgli.style.display="","undefined"!=typeof e.notice&&e.notice){for(var i=e.notice;t.nodes.changebgli2.childNodes.length>2;)t.nodes.changebgli2.removeChild(t.nodes.changebgli2.childNodes[t.nodes.changebgli2.childNodes.length-3]);for(var n=i.length-1;n>=0;n--){var o=$C("li");o.innerHTML=i[n].data,o._href=i[n].url,t.nodes.changebgli2.insertBefore(o,t.nodes.changebgli2.firstChild),o.onclick=function(){v7sendLog("45_01_11_"+$UID),window.location.href=this._href},t.nodes.nomsgli.style.display="none"}}if(parseInt($E("ccnotepiaohong").innerHTML,10)>0)for(var s=parseInt($E("ccnotepiaohong").innerHTML,10),a=t.nodes.changebgli2.childNodes,r=0;r<a.length-2&&s>r;r++)Core.Dom.removeClassName(a[r],"cur"),a[r].className+=" cur";t.updateView("loaded"),t._msgIsLoad=!0,t.bindliEvent()},onError:function(){},onFail:function(){}});var n=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/note/unreadmail.php","jsload");n.request({onSuccess:function(e){var i=parseInt(e)||0;i>99&&(i="99+"),t.nodes.mailCount.innerHTML=i||""},onError:function(){t.nodes.mailCount.innerHTML=""}})},requestDataInterface:function(){var t=this;Lib.checkAuthor();var e=Lib.LocalDB,i=null;e.isFlashReady&&!this.checkCache&&(this.clearCache(),i=e.get("uid_"+$UID+"unread",24e4),this.checkCache=!0);var n=function(n,o){i||o||e.set("uid_"+$UID+"unread",n),0==n.isBindToMsn&&1!=Utils.Cookie.getCookie("noMoreMsnTips"+$UID),t.isMessageLoaded=!0,t.onMessageLoad(n.nickname),t._listData=n,scope.unreadMsg=n,scope.nickname=n.full_nickname,scope.loginUserWtype=n.login_wtype,n.svr_time&&(scope.$svr_time=n.svr_time),n.nfn>=1&&(v7sendLog("40_01_03_"+$UID),t.initNewStatusTip(n)),t.updateListData(n),t.isMessageLoaded&&(t.updateData({data:t._listData}),t.onLoaded()),scope.hasOpenBlog=1==n.isbloguser?"open":"no",scope.bindTrayOpenTime=1,Lib.Listener.notify("tray-data-loaded",n),"no"==scope.hasOpenBlog&&1==scope.bindTrayOpenTime&&($E("openblogcss")||Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"}),$E("openedBlogTray").style.display="none",$E("noOpenedBlogTray").style.display="",$E("outOfOpenBlogTray").style.display="",scope.addBlogOpenerEvent($E("openBlogBtnTray")),$E("noOpenBlogName").href="http://blog.sina.com.cn/u/"+$UID,scope.bindTrayOpenTime=2),scope.unreadOkExecuted=!0};i?(n(i,!0),trace("-------unread 使用缓存的数据!!!----")):(trace("-----直接调用unread接口！！！"),this.interfaceMessages.request({GET:{uid:$UID,product:"blog"},onSuccess:n,onError:function(){},onFail:function(){}}))},clearCache:function(){var t={profile_notice:"notice",profile_paperlist:"message",profile_invitelist:"invite",profile_commlist:"blogcomment",profile_replylist:"blogrecomment",profile_guestBookM:"gbook",profile_commtrash:"trashcomment",profile_commphotolist:"photocomment",profile_index:"profile_index",profile_remind:"profile_remind"},e=Lib.LocalDB,i=e.get("uid_"+$UID+"unread",24e4);i&&t[scope.$pageid]&&void 0!=typeof i[t[scope.$pageid]]&&(trace("-----清除缓存"),e.clearCache(10,"uid_"+$UID+"unread"));var n=$UID+"_clear_flash",o=Utils.Cookie.getCookie(n);1==o&&(trace("【活动】根据cookie标记,清除Flash缓存"),e.clearCache(10,"uid_"+$UID+"unread"),Utils.Cookie.setCookie(n,"",0,"/",".sina.com.cn"))},initMsnTips:function(){Lib.checkAuthor(),(new scope.msnTips).initUserInfo($nick,$UID)},initNewStatusTip:function(t){if("profile_index"!=scope.$pageid&&"pageSetM"!=scope.$pageid&&"editor"!=scope.$pageid){var e=$E("newStatusTip");if(!e&&t){v7sendLog("45_01_07_"+$UID),e=$C("div"),e.id="newStatusTip",e.className="tb_layer_Y tb_layer_w3",e.style.width="138px",e.innerHTML=scope.newStatusTipTemplay;var i=$T($E("loginBarCenter"),"a")[0],n=Core.Dom.getXY(i);e.style.left=n[0]-(69-i.offsetWidth/2)+"px",e.style.top=n[1]+i.offsetHeight+"px",e.style.zIndex="510",-1==i.href.indexOf("?")&&(i.href+="?type=2&from="+scope.$pageid),Core.Dom.opacity(e,0),document.body.appendChild(e),t.nfn>=1&&($E("nstFeed").style.display="block",$E("nstFeed").onclick=function(){v7sendLog("45_01_09_"+$UID),v7sendLog("40_01_04_"+$UID)}),1==t.official_blog&&($E("gbimg").style.display="",$E("gbmsg").style.display="");for(var o=1;500>=o;o++)!function(t){setTimeout(function(){Core.Dom.opacity(e,2*t/10)},2*t)}(o);"editor"==scope.$pageid&&(i.target="_blank",$E("nstFeed").parentNode.target="_blank",$E("gbmsg").style.target="_blank",Core.Events.addEvent(i,this.closeTip(i),"click")),Core.Events.addEvent(window,function(){var t=$T($E("loginBarCenter"),"a")[0],i=Core.Dom.getXY(t);e.style.left=i[0]-(69-t.offsetWidth/2)+"px",e.style.top=i[1]+t.offsetHeight+"px"},"resize")}}},closeTip:function(t){return function(){$E("newStatusTip").style.display="none",t.href=t.href.split("?")[0]}},updateData:function(t){var e=Lib.LocalDB,i=this;Lib.checkAuthor();try{($UID&&$UID==t.uid||1==e.getServer())&&(i.isHaveNewMessage=!1,i.isMessageLoaded=!1,i.updateListData(t.data),i._newnote>0&&(v7sendLog("45_01_08_"+$UID),v7sendLog("40_01_08_"+$UID)),t.data.nfn>=1&&i.initNewStatusTip())}catch(n){}1==e.getServer()?(Lib.checkAuthor(),e.sendToClient({data:t.data,uid:$UID}),setTimeout(function(){i.requestUICService(),i.requestDataInterface()},24e4)):setTimeout(function(){e.getServer()&&(e.setClientJsFun("$updateData"),i.requestUICService(),i.requestDataInterface())},24e4)},initializeList:function(){this.requestUICService(),this.checkCache=!1},updateListData:function(t){try{var e=0;e+=parseInt(this._getFormatCountString(t.invite)||0),e>500&&(e="500+"),this.nodes.inviteCount.innerHTML=e?e:""}catch(i){}try{var e=0;e+=parseInt(this._getFormatCountString(t.message)||0),e>500&&(e="500+"),this.nodes.messageCount.innerHTML=e?e:""}catch(i){}try{var e=0;e+=parseInt(t.unreadnotices||0),e+=parseInt(t.notice||0),e>500&&(e="500+"),this.nodes.sysnoticeCount.innerHTML=e?e:""}catch(i){}Lib.checkAuthor();try{var e=0;e+=parseInt(this._getFormatCountString(t.gbook)||0),e+=parseInt(this._getFormatCountString(t.trashwall)||0),e>500&&(e="500+"),this.nodes.guestBookCount.innerHTML=e?e:""}catch(i){}try{var e=0;e+=parseInt(t.blogcomment||0),e+=parseInt(t.blogrecomment||0),e+=parseInt(t.photocomment||0),e+=parseInt(t.trashcomment||0),e>500&&(e="500+"),this.nodes.commentRelapseCount.innerHTML=e?e:""}catch(i){}this._newnote=parseInt(t.newnotes,10),this._newnote>0?($E("ccnotepiaohong").innerHTML=this._newnote>500?"500+":this._newnote,$E("ccnotepiaohong").style.display=""):$E("ccnotepiaohong").style.display="none";var n,o=["notice","invite","message","blogcomment","blogrecomment","photocomment","trashcomment","vblogcomment","gbook"],s=o.length;for(n=0;s>n;n++){parseInt(t[o[n]])>0&&(this.isHaveNewMessage=!0);var a;for(a in t)"version"!=a&&window.parseInt(t[a])>0&&$E("left_"+a)&&($E("left_"+a).innerHTML="("+t[a]+")")}},requestUICService:function(){Lib.checkAuthor(),this.isMessageLoaded&&(this.updateData({data:this._listData}),this.onLoaded())},_getFormatCountString:function(t){var e="";return isNaN(parseInt(t))||0==parseInt(t)||(e=parseInt(t)>500?"(<strong>500+</strong>)":t),e},updateView:function(t){this.nodes.newInboxLoding.style.display="loaded"==t?"none":"","loading"==t&&(this.nodes.nomsgli.style.display="none")},onLoaded:function(){},onMessageLoad:function(t){$E("loginBarAppMenuLabel").innerHTML=Core.System.htmlFilter(t),$E("noOpenBlogName").innerHTML=Core.System.htmlFilter(t)},bindliEvent:function(){function t(t){var e=t&&t.target||window.event&&window.event.srcElement;!e||!e.tagName||"a"!=e.tagName.toLowerCase()&&"li"!=e.tagName.toLowerCase()||e.getAttribute("reject")||(v7sendLog("40_01_10_"+$UID),v7sendLog("45_01_11_"+$UID))}for(var e=this.nodes.changebgli1.getElementsByTagName("li"),i=this.nodes.changebgli2.getElementsByTagName("li"),n=0;n<e.length;n++)e[n].style.cursor="pointer",e[n].onmouseover=function(){this._className=this.className,this.className="on"},e[n].onmouseout=function(){this.className=this._className};for(var n=0;n<i.length-1;n++)i[n]!=this.nodes.nomsgli&&(i[n].style.cursor="pointer",i[n].onmouseover=function(){this._className=this.className,this.className="on"},i[n].onmouseout=function(){this.className=this._className});var o=$E("commentdata");o&&Core.Events.addEvent(o,function(e){t(e)}),Core.Events.addEvent(this.nodes.changebgli1,function(e){t(e)}),Core.Events.addEvent(this.nodes.changebgli2,function(e){t(e)})}}),scope.addArticleTemplate=[\'<div id="#{panel}" class="wrtBlog_sub" style="z-index:512;">\',\'<div class="wrtBlog_sub2">\',\'<p><img width="15" height="16" align="absmiddle" title="写365" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon138"><a onclick="v7sendLog(\\\'48_01_18\\\');v7sendLog(\\\'40_01_14\\\');" href="http://control.blog.sina.com.cn/admin/article/article_add.php?tag365" target="_blank">写365</a></p>\',\'<div class="SG_j_linedot"></div>\',\'<p><img class="SG_icon SG_icon88" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="长微博" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\\\'40_01_14\\\')" href="http://control.blog.sina.com.cn/admin/article/changWeiBo.php">长微博</a></p>\',\'<div class="SG_j_linedot"></div>\',\'<p><img class="SG_icon SG_icon87" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="微语录" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\\\'40_01_14\\\')" href="http://control.blog.sina.com.cn/weiyulu/weiyulu.php">微语录</a></p>\',\'<div class="SG_j_linedot"></div>\',\'<p><img class="SG_icon SG_icon85" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="九宫格" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\\\'40_01_14\\\')" href="http://control.blog.sina.com.cn/admin/article/daily.php">九宫格</a></p>\',\'<div class="SG_j_linedot"></div>\',\'<p><img class="SG_icon SG_icon18" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="发照片" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\\\'40_01_14\\\')" href="http://photo.blog.sina.com.cn/upload/upload.php">发照片</a></p>\',\'<div class="SG_j_linedot"></div>\',\'<p><img class="SG_icon SG_icon16" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="发视频" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\\\'40_01_14\\\')" href="http://vupload.you.video.sina.com.cn/u.php?m=1">发视频</a></p>\',\'<div id="tray_tbh_ware_linedot" style="display:none;" class="SG_j_linedot"></div>\',\'<p id="tray_tbh_ware_link" style="display:none;"><img class="SG_icon SG_icon150" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="发商品" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\\\'40_01_14\\\')" href="http://control.blog.sina.com.cn/admin/article/article_add.php?tbh=1">发商品</a></p>\',"</div>","</div>"].join(""),scope.addArticlePanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments),this.setTemplate(scope.addArticleTemplate),this.hidden()},Lib.Panel,{}),String.prototype.format=function(){var t=(arguments[0]&&"undefined"!=typeof arguments[0]?arguments[0].toString():"",/(.*?)({(\\d+)(:([0-9a-z]+))?})/gi),e=this.match(t);if(e){for(var i=0,n=e.length;n>i;i++)switch(e[i]=e[i].replace(t,function(){return RegExp.$1}),e[i]=RegExp.$1,typeof arguments[parseInt(RegExp.$3)]){case"undefined":e[i]+=RegExp.$2;break;case"number":e[i]+=isNaN(RegExp.$5)||""==RegExp.$5?arguments[parseInt(RegExp.$3)]:arguments[parseInt(RegExp.$3)].toString(Math.max(Math.min(Math.round(RegExp.$5),36),2));break;default:e[i]+=arguments[parseInt(RegExp.$3)]}return e.push(this.replace(t,"")),e.join("")}return this},Lib.pkg("Login"),Lib.Login.info=function(){var t;return window.sinaSSOController&&(t=sinaSSOController.getLoginInfo())?t:{}},Lib.Login.LoginPost=Core.Class.create(),Lib.Login.LoginPost.prototype={url:"http://i.sso.sina.com.cn/js/ssologin.js",callback:null,initialize:function(t,e,i){window.sinaSSOConfig=new function(){i&&(this.from=i),this.pageCharset="utf-8",this.noActiveTime=14400,this.setDomain=!0,this.entry="boke",this.customInit=function(){},this.customLoginCallBack=t,this.customLogoutCallBack=function(){},this.useIframe=!0}},login:function(t,e,i){function n(){"undefined"==typeof i?sinaSSOController.login(t,e):sinaSSOController.login(t,e,i)}"undefined"!=typeof sinaSSOController&&sinaSSOController?(trace("has sso"),sinaSSOController.init(),"function"==typeof sinaSSOController.setLoginType&&sinaSSOController.setLoginType(2),"function"==typeof sinaSSOController.getServerTime,trace("init ok"),n()):(trace("no sso"),Utils.Io.JsLoad.request(this.url,{onComplete:function(){n()},onException:function(){},timeout:3e4,isRemove:!1}))},parse:function(t){this.callback.call(t)}},function(){var t=parseInt(100*Math.random()),e=[],i=-1,n="",o="#userPosition {padding: 0;margin: 0;border: 0;position: absolute;z-index: 999;}\t\t\t\t#sinaNote {position: absolute;z-index: 999999;width: auto;overflow: hidden;padding: 0;margin: 0;\t\t\t\tborder: 1px solid #CCCCCC;background: #ffffff;text-align:left;}\t\t\t\t#sinaNote li {font-size: 12px;list-style: none;margin: 0 1px;height: 20px;padding: 0 5px;clear: both;\t\t\t\tline-height: 20px;cursor: pointer;color: #999999;}\t\t\t\t#sinaNote li.note {text-align: left;color: #999999;}",s=window,a={overfcolor:"#999",overbgcolor:"#e8f4fc",outfcolor:"#000000",outbgcolor:"",menuStatus:{"sina.com":!0,"sina.cn":!0,"vip.sina.com":!0,"qq.com":!0,"163.com":!0,"126.com":!0,"hotmail.com":!0,"yahoo.com.cn":!0,"gmail.com":!0}};a.createNode=function(){var t=s.document,e=t.createElement("div");e.innerHTML=\'<ul id="sinaNote" style="display:none;"></ul>\';var i=t.createElement("style");i.setAttribute("type","text/css");try{$IE?i.styleSheet.cssText=o:i.innerHTML=o}catch(n){trace(n.message)}var a=t.createElement("div");a.appendChild(e),a.appendChild(i),t.body.appendChild(a)},a.arrowKey=function(t){38==t&&(0>=i&&(i=e.length),i--,a.selectLi(i)),40==t&&(i>=e.length-1&&(i=-1),i++,a.selectLi(i))},a.showList=function(o){n="";var r=Core.Events.getEvent().keyCode;if(38==r||40==r)return a.arrowKey(r),!1;$E("sinaNote")||a.createNode();var l=$E(o).value,c=l.indexOf("@"),d="",h="";c>-1&&(d=l.substr(c+1),h=l.substr(0,c)),e=[],i=0,e[e.length]="sinaNote_MenuItem_Title_"+t;for(var u in this.menuStatus)this.menuStatus[u]=!0,""!=d&&d!=u.substr(0,d.length)?this.menuStatus[u]=!1:e[e.length]="sinaNote_MenuItem_"+u+"_"+t;var p=\'<li class="note">请选择登录类型</li>\';p+=\'<li id="sinaNote_MenuItem_Title_\'+t+\'">\'+l+"</li>";var g;for(var f in this.menuStatus)1==this.menuStatus[f]&&(g=""==h?l+"@"+f:h+"@"+f,p+=\'<li id="sinaNote_MenuItem_\'+f+"_"+t+\'" title="\'+g+\'">\'+g+"</li>");$E("sinaNote").innerHTML=p;for(var m=0;m<l.length;m++)l.charCodeAt(m)<160?($E("sinaNote").style.display="",this.selectList(o)):this.hideList();var v,y=$E(o),_=$E("sinaNote"),b=0,E=0;s!=window&&(v=Core.Dom.getXY(window.frameElement),b=v[0],E=v[1]);var w=y.offsetWidth;200>w&&(w=200),_.style.width=w-2+"px";var C=Core.Dom.getXY(y);_.style.left=C[0]-($IE?2:-1)+b+"px",_.style.top=C[1]+y.offsetHeight-($IE?2:-1)+E+"px"},a.selectList=function(t){for(var e=$E("sinaNote").getElementsByTagName("li"),i=1;i<e.length;i++)e[1].style.backgroundColor=a.overbgcolor,e[1].style.color=a.outfcolor,e[i].onmousedown=function(){var e=this.innerHTML;if(e.indexOf("非新浪邮箱")>-1){var i=e.split("@");$E(t).value=i[0]}else $E(t).value=this.innerHTML;null!=Core.Events.getEvent()&&Core.Events.stopEvent()},e[i].onmouseover=function(){1!=i&&(e[1].style.backgroundColor=a.outbgcolor,e[1].style.color=a.overfcolor),this.style.backgroundColor=a.overbgcolor,this.style.color=a.outfcolor},e[i].onmouseout=function(){this.style.backgroundColor=a.outbgcolor,this.style.color=a.overfcolor,e[1].style.backgroundColor=a.overbgcolor,e[1].style.color=a.outfcolor}},a.selectLi=function(i){var o;$E("sinaNote_MenuItem_Title_"+t).style.backgroundColor=a.outbgcolor,$E("sinaNote_MenuItem_Title_"+t).style.color=a.overfcolor;for(var s=0;s<e.length;s++)o=$E(e[s]),o.style.backgroundColor=a.outbgcolor,o.style.color=a.overfcolor;$E(e[i]).style.backgroundColor=a.overbgcolor,$E(e[i]).style.color=a.outfcolor,n=$E(e[i]).innerHTML},a.hideList=function(){$E("sinaNote")||a.createNode(),$E("sinaNote").style.display="none"},a.init=function(t,e,i,o){o=o||window,null==o.document.body&&setTimeout(Core.Function.bind3(function(){this.init(t,e,i,o)},this),100);for(var r in e)this[r]=e[r];Core.Events.addEvent(document,a.hideList,"click"),Core.Events.addEvent(t,a.hideList,"blur"),Core.Events.addEvent(t,Core.Function.bind3(a.showList,this,[t]),"keyup"),Core.Events.addEvent(t,function(){var e,o=Core.Events.getEvent().keyCode;if(13==o||9==o){if(""!=n){var s=n;if(s.indexOf("非新浪邮箱")>-1){var a=s.split("@");t.value=a[0]+"@",e=!1}else t.value=n,e=!0}e?null!=i&&setTimeout(function(){i.focus()},0):t&&t.focus()}},"keydown"),o&&(s=o)},Lib.passcardOBJ=a}(),Lib.Login.Ui=Core.Class.create();var msnRefreshTimer=0;Lib.Login.Ui.prototype={dialog:null,isInit:!1,request:null,callback:null,initialize:function(){},login:function(t,e,i){this.callback=t||null,this.clearDomain=e||!1,this.from=i||null,this.initDom(),this.initEvent(),this.dialog.show(),this.dialog.setAreaLocked(!0),this.reloadName(),this.onShow(),this.focus(),"blogMove"===scope.$pageid&&($E("login_move_tip").style.display=""),$IE6&&this.initAD(),Lib.passcardOBJ.init($E("login_name_d"),{overfcolor:"#999",overbgcolor:"#e8f4fc",outfcolor:"#000000",outbgcolor:""},$E("login_pass_d"))},reloadName:function(){var t=Lib.Login.info(),e=t.ln;e&&($E("login_name_d").value=e);var i=Utils.Cookie.getCookie("ALF");""!=i&&$E("login_save")&&($E("login_save").checked=!0,$E("login_save_tips").style.display="none"),i=Utils.Cookie.getCookie("LiRe"),""!=i&&$E("login_save")&&($E("login_save").checked=!0,$E("login_save_tips").style.display="none")},initDom:function(){var t=this;this.dialog=winDialog.createCustomsDialog({tpl:t.tpl}),this.dialog.addEventListener("hidden",function(){this.destroy()}),this.dialog.setContent(this.struc),this.dialog.setTitle("登录新浪博客"),this.dialog.setMiddle()},initEvent:function(){var t=this.parse.bind2(this);this.request=new Lib.Login.LoginPost(t,this.clearDomain,this.from),Core.Events.addEvent("login_button",this.doLogin.bind2(this)),Core.Events.addEvent("login_name_d",function(t){var e=t.keyCode;13==e&&this.doLogin()}.bind2(this),"keydown"),Core.Events.addEvent("login_pass_d",function(t){var e=t.keyCode;13==e&&this.doLogin()}.bind2(this),"keydown");var e=1;Core.Events.addEvent("login_save",function(){if($E("login_save_tips").style.display=$E("login_save").checked?"":"none",e){var t="http://control.blog.sina.com.cn/blog_rebuild/riaapi/padblog/padInfo.php?ck_login=A00001&rnd="+Math.random();Utils.Io.JsLoad.request(t,{onComplete:function(){},onException:function(){}}),e=null}})},doLogin:function(){Core.Events.stopEvent();var t=$E("login_name_d").value,e=$E("login_pass_d").value;if(t=Core.String.trim(t),e=e,""==t)return this.error("请输入登录名"),!1;if(""==e)return this.error("请输入密码"),!1;if("undefined"!=typeof sinaSSOController&&"undefined"!=typeof sinaSSOController.loginExtraQuery&&"undefined"!=typeof sinaSSOController.loginExtraQuery.door){var i=$E("login_vcode").value;sinaSSOController.loginExtraQuery.door=i||1}return $E("login_save").checked?(v7sendLog("48_01_38_1"),this.request.login(t,e,60)):(v7sendLog("48_01_38_0"),this.request.login(t,e)),!1},parse:function(t){function e(){if(this.callback){try{$tray.renderLogin()}catch(t){}this.callback.call()}else window.location=window.location.toString().replace(/#.*/,"")}if(t.result){Lib.checkAuthor(),$E("login_save").checked?Utils.Cookie.setCookie("LiRe",!0,2400,"/",".blog.sina.com.cn"):Utils.Cookie.setCookie("LiRe","",2400,"/",".blog.sina.com.cn");var i=new Date,n=i.getFullYear(),o=i.getMonth(),s=i.getDate(),a=new Date(n,o,s,24).getTime();Utils.Cookie.setCookie("onceloggedonblog",a,720,"/",".blog.sina.com.cn");var r=this,l=!1;Utils.Io.JsLoad.request("http://login.sina.com.cn/bindmail/checkmailuser.php?entry=blog&name="+encodeURIComponent($E("login_name_d").value)+"&utf82gbk=1&callback=scope.$bindEmailAlert",{noreturn:!0,timeout:5e3,onException:function(){l||e.call(r)}}),scope.$bindEmailAlert=function(t){if(l=!0,"y"!=t.ret&&"not_verify"!=t.errcode||1==Utils.Cookie.getCookie("sbr_noTBE"))e.call(r);else{var i=winDialog.createCustomsDialog({content:[\'<div id="#{entityID} style="width:358px;height:144px" class="CP_layercon2 unilayer">\',\'<div id="#{contentID}" class="CP_prompt">\',\'<img height="50" align="absmiddle" width="50" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon201">\',\'<table class="CP_w_ttl"><tbody><tr><td>经检测您的帐号存在一定的安全隐患！<br>建议绑定邮箱</td></tr></tbody></table>\',\'<p class="CP_w_btns_Mid"><a href="javascript:;" class="SG_aBtn SG_aBtnB" id="#{bindit}" target="_blank"><cite> 绑定 </cite></a>&nbsp;&nbsp;<a href="javascript:;" class="SG_aBtn SG_aBtnB" id="#{nobind}"><cite> 暂不绑定 </cite></a></p>\',"</div>",\'<div class="unilayerB SG_j_linedot1">\',\'<p class="SG_txtb"><input type="checkbox" id="#{noalertbind}"><label for="#{noalertbind}">一周内不提醒</label></p>\',"</div>","</div>"].join(""),shadow:1},"bindEmail");i.setMiddle(),i.show(),i.nodes.btnClose.onclick=function(){e.call(r),i.hidden()},i.nodes.nobind.onclick=function(){setTimeout(function(){e.call(r),i.hidden()},100)},i.nodes.bindit.href="http://login.sina.com.cn/bindmail/bindmail.php?entry=blog",i.nodes.bindit.onclick=function(){e.call(r)},i.nodes.noalertbind.onclick=function(){this.checked?Utils.Cookie.setCookie("sbr_noTBE","1",168,"/",".blog.sina.com.cn"):Utils.Cookie.setCookie("sbr_noTBE","",0,"/",".blog.sina.com.cn")}}},this.dialog.hidden()}else{if("4049"===t.errno)return sinaSSOController.loginExtraQuery={door:0},$E("login_ckimg").style.display="",$E("login_vcode").value="",$E("checkImg").src="http://login.sina.com.cn/cgi/pin.php?r="+Core.Math.getUniqueId()+"&s=0",Core.Events.addEvent($E("reloadCode"),function(){$E("checkImg").src="http://login.sina.com.cn/cgi/pin.php?r="+Core.Math.getUniqueId()+"&s=0",$E("login_vcode").value="",$E("login_div_error").innerHTML=""}),void this.error("");if("2070"===t.errno)return Core.Events.fireEvent($E("reloadCode"),"click"),void this.error(t.reason);if("4047"==t.errno)return void this.error(t.reason);if("4057"==t.errno)return void this.error(t.reason);if("4040"==t.errno)return void this.error(t.reason);this.error("登录名或密码错误"),$E("checkImg").src="http://login.sina.com.cn/cgi/pin.php?r="+Core.Math.getUniqueId()+"&s=0",$E("login_vcode").value=""}},friendlyTip:function(t){var e=t,i=$E("login_name_d"),n=i.value;if(!/[\\u0391-\\uFFE5]+/.test(n)&&!/^\\d+$/.test(n)&&!/^@/.test(n)){var o="你的登录名可能是 ",s=\'<a href="#" class="underline" onclick="$_RENAME(/@.*/, \\\'{1}\\\');return false">{0}{1}</a>\',a=["@sina.com","@sina.cn"],r="";r=/@sina\\.cn$/.test(n)?s.format("{0}",a[0]):/@sina\\.com$/.test(n)?s.format("{0}",a[1]):s.format("{0}",a[0])+" 或 "+s.format("{0}",a[1]),e=(o+r).format(n.replace(/@.*/,""))}return e},rename:function(){return window.$_RENAME=function(t,e){var i=$E("login_name_d");i.value=i.value.replace(t,"")+e,$E("login_pass_d").focus(),$E("login_div_error").innerHTML=""},window.$_RENAME}(),focus:function(){var t=$E("login_name_d");""==t.value?t.focus():$E("login_pass_d").focus()},initAD:function(){$E("login_ad").src="http://blog.sina.com.cn/lm/iframe/71/2008/0731/21.html"},onShow:function(){},error:function(t){$E("login_div_error").innerHTML=t,$E("login_pass_d").value="",this.focus()},tpl:[\'<table id="#{panel}" class="CP_w">\',\'<thead id="#{titleBar}">\',"<tr>",\'<th class="tLeft"><span></span></th>\',\'<th class="tMid">\',\'<div class="bLyTop">\',\'<strong id="#{titleName}">提示标题</strong>\',\'<cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite>\',"</div>","</th>",\'<th class="tRight"><span></span></th>\',"</tr>","</thead>","<tfoot>","<tr>",\'<td class="tLeft"><span></span></td>\',\'<td class="tMid"><span></span></td>\',\'<td class="tRight"><span></span></td>\',"</tr>","</tfoot>","<tbody>","<tr>",\'<td class="tLeft"><span></span></td>\',\'<td class="tMid" id="#{content}">\',"</td>",\'<td class="tRight"><span></span></td>\',"</tr>","</tbody>","</table>"].join(""),struc:\'\t\t<div class="CP_layercon2 passLoginItem">\t\t\t<div>\t\t\t\t<div id="login_move_tip" style="display:none;margin-bottom:12px">可以使用新浪微博、邮箱、通行证的帐号进行登录</div>\t\t\t\t<div class="boxA">登录名：\t\t\t\t\t<input tabIndex="201" type="text" class="fm1" style="width:215px;" name="login_name" id="login_name_d" tabIndex=1/>  <a style="font-size: 12px;" href="http://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid=\'+scope.$uid+\'&src=blogicp" target="_blank">立即注册</a>\t\t\t\t</div>\t\t\t\t<div class="boxA">密　码：\t\t\t\t\t<input tabIndex="202" type="password" class="fm1" style="width:215px;" name="login_pass" maxlength="16" id="login_pass_d" tabIndex=2/>  <a style="font-size: 12px;" href="http://login.sina.com.cn/getpass.html" target="_blank">找回密码</a>\t\t\t\t</div>\t\t\t\t<div id="login_ckimg" class="boxA" style="display:none"> <p class="p_img">验证码：                  \t<input type="text" id="login_vcode" name="login_vcode" class="fm1" size="10" maxlength="5" />                  \t<img width="100" align="absmiddle" id="checkImg" src="http://login.sina.com.cn/cgi/pin.php?r=\'+Core.Math.getUniqueId()+\'&s=0" /> <a href="javascript:;" onclick="return false;" style="font-size: 12px;"><span id="reloadCode">换一换</span></a></p> \t\t\t    </div>\t\t\t\t<div class="ErrTips" id="login_div_error"></div>\t\t\t\t<div class="boxB"><p><input tabIndex="203" type="checkbox" value="" id="login_save" checked="checked" /><label for="login_save"> 记住登录状态</label></p><p id="login_save_tips" style="color:#999;display:none;">建议在网吧/公用电脑上取消该选项</p><p style="margin-top: 8px;"><a id="login_button" class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;" tabIndex=204><cite>登录<input type="text"/></cite></a> </p></div>\t\t\t</div>\t\t\t<div class="connect_msn" id="connect_msn" style="position:relative;">\t\t\t\t<span>使用 MSN 帐号登录博客</span>\t\t\t\t<a href="#" onclick="Lib.checkAuthor();v7sendLog(\\\'48_01_36\\\'); window.open(\\\'https://login.live.com/oauth20_authorize.srf?client_id=0000000040046F08&redirect_uri=http%3A%2F%2Fcontrol.blog.sina.com.cn%2Fblog_rebuild%2Fmsn%2FmsnLoginCallBack.php&response_type=code&scope=wl.basic%20wl.signin%20wl.offline_access%20wl.share%20wl.emails\\\',\\\'neww\\\',\\\'left=\'+(screen.width-440)/2+",top="+(screen.height-400)/2+\',height=400,width=440\\\');msnrefreshWindow();" style="background:transparent url(http://simg.sinajs.cn/blog7style/images/msn_login01.gif) no-repeat left top; width:70px; height:22px; line-height:22px; display:inline-block; text-align:left; text-indent:2em; text-decoration:none; color:white; font-weight:bold; font-size:14px;">登录</a>\t\t\t</div>\t\t\t<a href="http://blog.sina.com.cn/s/blog_4b0f52990100miil.html" target="_blank"style="left:308px;position:relative;top:-24px;">如何登录？</a>\t\t\t<div class="CP_lg_ad SG_j_linedot1">\t\t\t\t<iframe id="login_ad" src="http://blog.sina.com.cn/lm/iframe/71/2008/0731/21.html" frameborder="0" scrolling="no" height="25" width="auto"></iframe>\t\t\t</div>\t\t</div>\'},Lib.PlatformTrayPlus=Core.Class.create(),Lib.PlatformTrayPlus.prototype={tray:null,subPanels:[],trayLogin:null,initialize:function(){},load:function(t){var e=$E("login_bar_logo_link_350");switch(e&&$_GLOBAL&&$_GLOBAL.platformTrayLogo&&(!$IE6&&$_GLOBAL.platformTrayLogo.imgForOtherBrs?e.children[0].src=$_GLOBAL.platformTrayLogo.imgForOtherBrs:$_GLOBAL.platformTrayLogo.imgForIE6&&(e.children[0].src=$_GLOBAL.platformTrayLogo.imgForIE6)),t){case"login":null!=$E("loginBarOptApp")&&$isAdmin||(this.render(scope.trayPlusTemplayLogin),trace("++++js渲染 登陆后++++++")),this.initStatic(),/ipad/i.test(navigator.userAgent)&&v7sendLog("48_01_02"),this.setNodesMouseHoverStyle(["loginBarOptApp","loginBarMail","loginBarCenter","loginBarFriend","loginBarInbox"]),this.initNicknamePanel(),this.initNewInboxPanel(),this.initActivityPanel();var i=this;if(Utils.Io.JsLoad.request("http://service.mail.sina.com.cn/mailproxy/mail.php",{onComplete:function(){var t=sinamailinfo.email;""!=t&&i.initMailRemind()},onException:function(){}}),this.initMsnLogout(),scope&&scope.$private&&scope.$private.msnfeed){var n=this;setTimeout(function(){n.displayUserGuideTips()},1e3)}break;case"logout":this.trayLogin=new Lib.Login.Ui,null===$E("phprender")?(this.render(scope.trayPlusTemplayLogout),trace("-----------js渲染---------")):trace("-----------php渲染---------"),this.initLogin(),this.initPopularize();break;case"oncelogedon":this.trayLogin=new Lib.Login.Ui,this.render(scope.trayPlusTemplayOnceLoged),this.setNodesMouseHoverStyle(["loginBarOptApp","loginBarMail","loginBarCenter","loginBarFriend","loginBarInbox"]);var o=Lib.Login.info(),s=o&&o.uid;$E("loginBarAppMenuLabel").innerHTML=o&&o.nick,this.initPopularize(),this.initOnceLogedEvent(["loginBarOptApp","loginBarMail","loginBarCenter","loginBarFriend","loginBarInbox"],s),this.initOnceLogedTips(s),this.initStatic()\n}this.initAddArticlePanel(),this.initSearchPanel(),this.initFilmSearch()},displayUserGuideTips:function(){if(!window.scope||"profile_index"===scope.$pageid)return void Utils.Cookie.setCookie($UID+"alreadyVisitProfileIndex","true","86400","/",".sina.com.cn")},initStatic:function(){if(!this._commetTimer){var t=function(){var t=scope.$uid,e=scope.$articleid||"",i="http://comet.blog.sina.com.cn/api?maintype=notice";Utils.Io.JsLoad.request(i,{GET:{uid:t||"",blogid:e},onComplete:function(){}})};this._commetTimer=setInterval(t,3e4),setTimeout(function(){t()},15)}},initFilmSearch:function(){var t=$E("loginBarSearchInput");t&&(t.value="");var e=$E("loginBarSearchSType");e&&(e.value="title")},render:function(t){$E("trayContainer").innerHTML=t},initLogin:function(){var t=this,e=Core.Dom.getElementsByClass($E("trayContainer"),"span","link")[0];e.onclick=function(){v7sendLog("40_01_15")},Core.Events.addEvent($E("linkTrayLogin"),function(){v7sendLog("40_01_16"),"undefined"!=typeof sinaSSOController&&(sinaSSOController.loginExtraQuery={}),t.trayLogin.login(function(){Lib.checkAuthor();var t=$UID==scope.$uid?"02":"01";v7sendLog("87_01_"+t+"_"+$UID,scope.$pageid),setTimeout(function(){window.location=window.location.toString().replace(/#.*/,"")},100)},!1,"referer:"+location.hostname+location.pathname+",func:0007")},"click"),$E("linkReg").href="http://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid="+scope.$uid+"&src=blogicp",$E("linkReg").onclick=function(){v7sendLog("40_01_17")},scope.$channel&&2==scope.$channel&&($E("linkReg").href="http://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid="+scope.$uid+"&src=baby")},initPopularize:function(){var t=$E("divPopularize");t&&(this.hideActiLink(t),this._loadPopularizeData(t))},_loadPopularizeData:function(t){Utils.Io.JsLoad.request("http://blog.sina.com.cn/lm/iframe/283/2012/0705/1.js",{charset:"utf-8",onComplete:function(){var e=$_GLOBAL.popularizeConfig;if(e&&!t.innerHTML){var i=e.length,n=Utils.Cookie,o=parseInt(n.getCookie("blogPopularizeIndex")||0);if(o>=i&&(o=0),n.setCookie("blogPopularizeIndex",1+o,24,"/",".blog.sina.com.cn"),t.innerHTML=e[o],$E("err_i8t9c")){var s=t.innerText||t.textContent||"";s.length>10&&(t.children[0].innerHTML=s.substr(0,9)+"...")}}}})},setNodesMouseHoverStyle:function(t){var e,i=t.length;for(e=0;i>e;e++)Core.Events.addEvent($E(t[e]),function(e){return function(){Core.Dom.removeClassName($E(t[e]),"current"),$E(t[e]).className+=" current"}}(e),"mouseover"),Core.Events.addEvent($E(t[e]),function(e){return function(){Core.Dom.removeClassName($E(t[e]),"current")}}(e),"mouseout");$E("loginBarCenter").onclick=function(){v7sendLog("40_01_05_"+$UID)},$E("loginBarFriend").onclick=function(){v7sendLog("40_01_06_"+$UID)},$E("logOut").onclick=function(){v7sendLog("40_01_11_"+$UID)}},initNicknamePanel:function(){function t(t){function e(){var e=setInterval(function(){var n=$E("loginBarAppMenuLabel").innerHTML;if("读取中..."!==n){var o=t.offsetLeft+"px";i.style.left=o,trace("刷新msn icon mask"),clearInterval(e)}},300)}var i=$C("a"),n=t.parentNode,o=n.parentNode,s=$C("img");o.style.position="relative",n.style.position="relative",s.id="msnLoginIcon",s.className="SG_icon SG_icon136",s.src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif",s.style.width="18px",s.style.height="18px",s.align="absmiddle",i.appendChild(s),i.href="http://control.blog.sina.com.cn/blogprofile/msnbind.php?c="+ +new Date,i.target="_blank",i.style.cssText="display:block; width:18px; height:18px; position:absolute; z-index:1024;",i.style.paddingTop="4px",i.title="MSN账号登录",o.insertBefore(i,o.childNodes[0]),Core.Events.addEvent(window,e,"resize"),trace("创建msn icon mask"),e(),scope.$msnRelocation=e}var e=new scope.NicknamePanel;Lib.checkAuthor(),e.initUserInfo($UID),this.addSubPanel(e,$E("loginBarOptApp"),-98,-9);if(Utils.Cookie.getCookie("loginFromMsn")&&!$E("msnLoginIcon")){var i=$C("img");i.src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif",i.style.cssFloat=i.style.styleFloat="left",i.width="18",i.height="0",i.style.padding="9px 0",i.align="absmiddle",Core.Dom.insertAfter(i,$E("loginBarAppMenuLabel")),trace("创建msn icon"),t(i)}else trace("不渲染msn icon")},initAddArticlePanel:function(){var t=new scope.addArticlePanel;this.addSubPanel(t,$E("arrowAddArticle"),-81,0),$E("arrowAddArticle").onclick=function(){v7sendLog("40_01_13_"+($UID?$UID:""))},$E("arrowAddArticle").parentNode.children[0].onclick=function(){v7sendLog("40_01_12_"+($UID?$UID:""))}},showPublishWare:function(t){if(t.tbh_status&&parseInt(t.tbh_status,10)){$E("tray_tbh_ware_linedot").style.display="";var e=$E("tray_tbh_ware_link");e.style.display="";try{var i=$T(e,"a")[0];scope&&"editor"==scope.$pageid&&(i.href="javascript:;",i.target="",i.onclick=function(){for(var t=$E("shortcut_content"),e=$T(t,"img"),i=0;i<e.length;i++)-1!=e[i].src.indexOf("element_shop")&&Core.Events.click(e[i])}),i=null,e=null}catch(n){}}Lib.Listener.off({name:"tray-data-loaded",callBack:this.showPublishWare,scope:this})},initSearchPanel:function(){function t(t){var i=$E("loginBarSearchForm");i.action=e.config[t].url,$E("loginBarSearchMenuLabel").innerHTML=n[t].getElementsByTagName("a")[0].innerHTML;var o=$E("loginBarSearchC"),s=$E("loginBarSearchT"),a=$E("loginBarSearchType"),r=$E("loginBarSearchS"),l=$E("loginBarSearchTS"),c=$E("loginBarSearchInput");switch(t){case"all":case"blog":case"bauthor":o||(o=$C("input"),o.type="hidden",o.name="c",o.id="loginBarSearchC",i.appendChild(o)),o.value="blog",s.value=e.config[t].range,s.name="range",a.value=e.config[t].by,a.name="by",c.name=e.config[t].keyName;break;case"song":case"video":case"vauthor":o&&(o.value=""),s.value=e.config[t].t,s.name="t",r.value=e.config[t].s,l.value=e.config[t].ts,a.value=e.config[t].type,a.name="type",$E("loginBarSearchSType").value=e.config[t].stype,c.name=e.config[t].keyName}}var e=new scope.SearchPanel;this.addSubPanel(e,$E("searchSelect"),-54,-4),Utils.Form.limitMaxLen($E("loginBarSearchInput"),50);var i,n=e.getNodes();for(i in e.config)!function(e){Core.Events.addEvent(n[e],function(){t(e)},"click")}(i);t("blog"),$E("searchSelect").onclick=function(){v7sendLog("40_01_18")};var o=Core.Dom.getElementsByClass($E("loginBarSearchForm"),"input","topbar_searchBtn")[0];o.onclick=function(){v7sendLog("40_01_20")},Core.Events.addEvent($E("loginBarSearchInput"),function(t){var e=t.keyCode||t.charCode;15==e&&v7sendLog("40_01_20")},"keyup")},hideActiLink:function(t){var e=scope.$pageid;"pageSetM"!==e&&"editor"!==e&&(t.style.display="none",t.setAttribute("shouldShow","1")),setTimeout(function(){return"undefined"!=typeof BLOG_AD_TIPS&&BLOG_AD_TIPS?void 0:void(t.style.display="")},3e3)},initActivityPanel:function(){if($_GLOBAL){var t=$E("loginBarActivity");t&&(this.hideActiLink(t),this._loadPopularizeData(t))}return $_GLOBAL.activityBlackList&&$_GLOBAL.activityBlackList[scope.$pageid]?void trace("【活动】当前页面在黑名单"):void 0},initMsnLogout:function(){function t(){new Interface("http://control.blog.sina.com.cn/blog_rebuild/msn/api/msnLoginOut.php","jsload").request({onSuccess:function(){window.location.href="http://login.sina.com.cn/cgi/login/logout.php?r="+r},onError:function(){window.location.href="http://login.sina.com.cn/cgi/login/logout.php?r="+r},onFail:function(){window.location.href="http://login.sina.com.cn/cgi/login/logout.php?r="+r}})}var e=$E("openedBlogTray"),i=e.getElementsByTagName("a"),n=i[i.length-1];n.href="#",n.onclick=function(){return!1};var o=$E("noOpenedBlogTray"),s=o.getElementsByTagName("a"),a=s[s.length-1];a.href="#",a.onclick=function(){return!1};var r=encodeURIComponent(window.location.href);e&&Core.Events.addEvent(n,t),o&&Core.Events.addEvent(a,t)},addSubPanel:function(t,e,i,n){function o(){Core.Events.stopEvent();var o,a=s.subPanels.length;for(o=0;a>o;o++)s.subPanels[o].hidden();t.showWithDom(e,i,n)}var s=this;this.subPanels.push(t),Core.Events.addEvent(e,function(){e===$E("loginBarOptApp")&&v7sendLog("40_01_01_"+$UID),o()},"click"),Core.Events.addEvent(document.body,function(){t.hidden()},"click"),Core.Events.addEvent(t.entity,function(){Core.Events.stopEvent()},"mousedown"),Core.Events.addEvent(window,function(){var o=Core.Dom.getLeft(e)+e.offsetWidth+i,s=Core.Dom.getTop(e)+e.offsetHeight+n;$IE6&&this.isFixed&&(o-=document.documentElement.scrollLeft,s-=document.documentElement.scrollTop),t.setPosition(o,s)},"resize")},initNewInboxPanel:function(){var t=new scope.NewInboxPanel;this.addSubPanel(t,$E("loginBarInbox"),-137,-9);try{if(!$E("ccnotepiaohong")){var e=$C("div");e.className="imforbox",e.style.display="none",e.id="ccnotepiaohong",$E("loginBarInbox").appendChild(e)}$E("loginBarInbox").className="link imfor"}catch(i){}t.onMessageLoad=function(t){$E("loginBarAppMenuLabel").innerHTML=t,$E("noOpenBlogName").innerHTML=Core.System.htmlFilter(t)}},initMailRemind:function(){function t(){var t=new Interface("http://interface.blog.sina.com.cn/riaapi/profile/unreadmail.php","jsload");t.request({onSuccess:function(t){var e=parseInt(t,10);if(e>99&&(e="99+"),0!==e&&$E("mailpiaohong")){var i=$E("mailpiaohong");i.style.display="",i.innerHTML=e}else $E("mailpiaohong").style.display="none"},onError:function(){$E("mailpiaohong").style.display="none"}})}$E("loginBarMail")&&$E("line")&&($E("loginBarMail").style.display="",$E("line").style.display=""),t();setInterval(t,3e5);Core.Events.addEvent($E("loginBarMail"),function(){v7sendLog("40_01_07_"+$UID);var t=$E("mailpiaohong"),e=!t.style.display;e&&(t.style.display="none")},"click"),Core.Events.addEvent($E("mailpiaohong"),function(){var t=$E("mailpiaohong");t.style.display="none",window.open("http://mail.sina.com.cn/?s=2")},"click")},initOnceLogedEvent:function(t,e){var i,n=t.length,o=this;for(i=0;n>i;i++)$E(t[i]).onclick=function(){switch(this.id){case"loginBarOptApp":v7sendLog("44_01_07_"+e);break;case"loginBarMail":v7sendLog("44_01_08_"+e);break;case"loginBarCenter":v7sendLog("44_01_09_"+e);break;case"loginBarFriend":v7sendLog("44_01_10_"+e);break;case"loginBarInbox":v7sendLog("44_01_11_"+e)}return"undefined"!=typeof sinaSSOController&&(sinaSSOController.loginExtraQuery={}),o.trayLogin.login(function(){setTimeout(function(){window.location=window.location.toString().replace(/#.*/,"")},100)},!1),!1}},initOnceLogedTips:function(t){var e=this,i="http://interface.blog.sina.com.cn/riaapi/profile/unread.php";Utils.Io.JsLoad.request(i,{GET:{uid:t,product:"blog"},onComplete:function(i){if("profile_index"!=scope.$pageid&&"pageSetM"!=scope.$pageid&&"editor"!=scope.$pageid){var n=$E("newStatusTip");if(!n){n=$C("div"),n.id="newStatusTip",n.className="tb_layer_Y tb_layer_w3",n.style.width="138px",n.innerHTML=scope.onceLogedStatusTipTemplay;var o=$T($E("loginBarCenter"),"a")[0],s=Core.Dom.getXY(o);n.style.left=s[0]-(69-o.offsetWidth/2)+"px",n.style.top=s[1]+o.offsetHeight+"px",n.style.zIndex="510",n.style.display="none",document.body.appendChild(n)}i.data.unreadnotes>=1?(v7sendLog("44_01_12_"+t),n.style.display="block",$E("nstUnread").style.display="block",$E("nstUnread").onclick=function(){return v7sendLog("44_01_13_"+t),"undefined"!=typeof sinaSSOController&&(sinaSSOController.loginExtraQuery={}),e.trayLogin.login(function(){setTimeout(function(){window.location="http://i.blog.sina.com.cn/blogprofile/profilelatestnote.php"},100)},!1),!1}):i.data.nfn>=1&&(v7sendLog("44_01_14_"+t),n.style.display="block",$E("nstFeed").style.display="block",$E("nstFeed").onclick=function(){return v7sendLog("44_01_15_"+t),"undefined"!=typeof sinaSSOController&&(sinaSSOController.loginExtraQuery={}),e.trayLogin.login(function(){setTimeout(function(){window.location="http://i.blog.sina.com.cn/blogprofile/index.php?type=3&from=newstatus&com=2"},100)},!1),!1}),Core.Events.addEvent(window,function(){var t=$T($E("loginBarCenter"),"a")[0],e=Core.Dom.getXY(t);n.style.left=e[0]-(69-t.offsetWidth/2)+"px",n.style.top=e[1]+t.offsetHeight+"px"},"resize")}},onException:function(){}})}},$registJob("tray",function(){Lib.Listener.add("tray-data-loaded"),Lib.checkAuthor();var t,e=$E("login_bar_logo_link_350"),i="ntopbar_main"===e.parentNode.className;t=i?Lib.TrayPanel():new Lib.PlatformTrayPlus;var n=Lib.Login.info(),o=n.uid;window.$onceLog=!1;var s=unescape(Utils.Cookie.getCookie("onceloggedonblog"));if(s&&o){time=s;var a=(new Date).getTime();time&&a>time&&($onceLog=!0)}t.load($isLogin?"login":!i&&$onceLog?"oncelogedon":"logout"),window.$tray={},window.$tray.renderLogin=function(){Lib.checkAuthor(),$isLogin&&t.load("login")},window.$tray.renderLogout=function(){t.load("logout")}}),$registJob("publicFunc",function(){scope.cIFM=function(t){$E(t)&&Core.Dom.removeNode($E(t)),Core.Dom.addHTML(document.body,"<iframe name=\'"+t+"\' id=\'"+t+"\' style=\'display: none;\'></iframe>")},scope.getFrameValue=function(t){return Core.String.j2o(Core.String.trim(t.contentWindow.document.body.innerHTML))},scope.tagFunc=function(t,e){try{var i=scope.getFrameValue(t);null==i&&(i={code:"A00001",data:[]}),null!=i.code&&(e?e(i):showError(i.code,{close:!1}))}catch(n){}}}),Core.System.getParam=function(t){var e=window.location.search.match(new RegExp("(\\\\?|&)"+t+"=([^&]*)(&|$)"));return null!=e?unescape(e[2]):null},Core.String.expand=function(t){var e=t.replace(/([\\u00ff-\\ufffe])/gi,"￿$1");return e},Core.String.collapse=function(t){return t.replace(/\\uffff/gi,"")},$registJob("editor_pageInit",function(){function t(t,e){var i="";for(var n in e)i=i+n+"="+e[n]+"&";i.length>0&&(i=i.substr(0,i.length-1),t=t+"?"+i);var o=$C("script");o.src=t,o.charset="utf-8",o.onload=o.onerror=o.onreadystatechange=function(){o&&o.readyState&&"loaded"!=o.readyState&&"complete"!=o.readyState||(o.onload=o.onreadystatechange=o.onerror=null,o.src="",o.parentNode.removeChild(o),o=null)},document.getElementsByTagName("head")[0].appendChild(o)}var e=$C("div"),i=$E("blog_body"),n=i.value;n=n.replace(/&nbsp;/gi," "),n=n.replace(/\\r?\\n/gi,""),n=n.replace(/<br\\s*\\/?>/g,"{#sina_text_n_tag}"),e.innerHTML=n,n=e.innerHTML,n=n.replace(/&lt;/gi,"<").replace(/&gt;/gi,">"),n=n.replace(/<br\\s*\\/?>/gi,""),n=n.replace(/{#sina_text_n_tag}/gi,"\\n"),i.value=n,e=null;var o=function(){i.style.cssText="",i.value="",Core.Events.removeEvent(i,o,"focus")},s=Core.System.getParam("blog_id");s||Core.Events.addEvent(i,o,"focus");var a=Core.System.getParam("film_id")||scope.$film_id;a=encodeURIComponent(a);var r=Core.System.getParam("type")||scope.$type||"movie";return scope.filmType=r,a?(scope.getFilmInfo=function(t){function e(t,e){var i=Core.String.expand(t);return i.length>e&&(i=i.substr(0,e)),i=Core.String.collapse(i)}if(t&&t.result&&t.result.status)if("0"==t.result.status.code){var i=t.result.data;scope.filmData=i,""==i.picture&&(i.picture="http://simg.sinajs.cn/blog7style/images/center/movies/img_200_266.png"),i.picture&&i.picture.toString().indexOf("http:")>-1?$E("filmImg").src=i.picture:i.picture=$E("filmImg").src="http://cache.mars.sina.com.cn/nd/dataent"+i.picture;var n=i.title.length;"《"==i.title.substr(0,1)&&"》"==i.title.substr(n-1)&&(trace("影视名称中带括号了！"),i.title=i.title.substr(1,n-2)),$E("filmName").innerHTML=i.title,scope.filmName=i.title,articleEditorCFG.dftTagValue="影评 "+e(i.title,14),$E("articleTagInput").value=articleEditorCFG.dftTagValue,window.currentTag=articleEditorCFG.dftTagValue;var o=$E("articleTitle");if(!s){var l="movie"==r?"电影":"连续剧";$E("editorTitle").innerHTML="评论"+l+"《"+i.title+"》"}Core.Events.addEvent(o,function(){o.select()},"focus");var c="http://data.ent.sina.com.cn/"+r+"/"+a+".html";$E("filmImgA").href=$E("filmName").href=c,$E("engName").innerHTML=i.entitle,$E("moreName").innerHTML=i.moreentitle||"暂无";var d=40,h=Core.String.expand(i.directorcontent),u=\'…<a href="\'+c+\'" target="_blank">[更多]</a>\';h=h.length>d?Core.String.collapse(h.substr(0,d))+u:Core.String.collapse(h),$E("director").innerHTML=h;var p=Core.String.expand(i.actorcontent);p=p.length>d?Core.String.collapse(p.substr(0,d))+u:Core.String.collapse(p),$E("mainActor").innerHTML=p,$E("filmType").innerHTML=i["class"],$E("region").innerHTML=i.area,$E("country").innerHTML=i.nationality,$E("filmTime").innerHTML=""==i.length?"暂无":i.length+"分钟",$E("filmDate").innerHTML=i.premiere,"tv"==r&&($E("filmTime").parentNode.style.display="none",$E("filmDate").parentNode.firstChild.innerHTML="出品年份：");var g=i.official;if(g.length>0){var f=/http:\\/\\//gi;f.test(g)||(g="http://"+g),$E("filmSite").href=g,d=18;for(var m=g.length/d,v=g.length,y="",_=1;m>=_;_++){if(d*(_+1)>v-1)var b=v-1;else var b=d*(_+1);y=y+g.substr(d*(_-1),d*_)+"  "+g.substr(d*_,b)}$E("filmSite").innerHTML=y}else $E("filmSite").parentNode.innerHTML="暂无"}else winDialog.alert(t.result.status.msg||"数据接口出错。",{icon:"01",funcOk:function(){}})},void t("http://data.ent.sina.com.cn/interface/movieapi.php",{auth_type:"uuid",auth_value:"4c4a98cd-0d6c-478c-8873-14449fde689a",type:r,id:a,callback:"scope.getFilmInfo",withintro:"none"})):(winDialog.alert("出错啦,没有传入影视信息。",{icon:"01",funcOk:function(){}}),!1)}),$registJob("editor_initOptions",function(){Core.Events.addEvent($E("moreOptions"),function(){var t=$E("optionPanel");"none"==t.style.display?(t.style.display="block",$E("moreOptions").lastChild.className="SG_icon SG_icon84"):(t.style.display="none",$E("moreOptions").lastChild.className="SG_icon SG_icon82")},"click"),$E("cateManageLink").onclick=function(){return window.CateDialog.show(),!1},$E("articleTagAutoSub").onclick=function(){return $E("articleTagAutoSub").disabled=!0,scope.cIFM("tagDataIframe"),$E("editorForm").target="tagDataIframe",$E("editorForm").action=articleEditorCFG.tagPostURL,Core.Events.addEvent($E("tagDataIframe"),Core.Function.bind3(scope.tagFunc,this,[$E("tagDataIframe"),function(t){switch(trace("提取Tag,返回状态码: "+t.code),$E("articleTagAutoSub").disabled=!1,t.code){case"B00000":break;case"B00006":$E("articleTagInput").style.color="#000",$E("articleTagInput").value=t.data;break;case"00001":break;case"00006":$E("articleTagInput").style.color="#000",$E("articleTagInput").value=t.data;break;default:showError("0"==t.code.charAt(0)?"B"+t.code:t.code)}v7sendLog("48_01_01_"+t.code)}]),"load"),$E("editorForm").submit(),!1}});var DialogManager={dialogs:[],activeDialog:{},backShadow:null,create:function(t,e){var i=this,n=new Dialog(t);return this.dialogs.push(n),this.activeDialog=n,n.name=e||n.getUniqueID(),n.entity.style.zIndex=1024,n.onDrag=function(){$IE6?this.getProperty().isFixed&&this.setPosition({x:parseInt(this.entity.style.left)-document.documentElement.scrollLeft,y:parseInt(this.entity.style.top)-document.documentElement.scrollTop}):this.getProperty().isFixed&&this.setPosition({x:parseInt(this.entity.style.left),y:parseInt(this.entity.style.top)})},n.onClose=function(){i.removeDialog(this.name),i.updateActiveDialog(),i.updateShadow(),i.activeDialog&&i.activeDialog.setFocus()},n.onHidden=function(){this.isHidden=!0,this==i.activeDialog&&(i.activeDialog=null),i.updateActiveDialog(),i.updateShadow(),i.activeDialog&&i.activeDialog.setFocus()},n.onShow=function(){if(this.isHidden){this.isHidden=!1;var t,e=i.dialogs.length;for(t=0;e>t;t++)i.dialogs[t]==this&&(document.body.appendChild(i.dialogs[t].entity),i.dialogs.push(i.dialogs[t]),i.dialogs.splice(t,1));i.activeDialog=this,i.backShadow.show(),i.updateShadow()}},this.backShadow.isShow?this.updateShadow():this.backShadow.show(),n.hidden(),n},getDialog:function(t){var e=0,i=this.dialogs.length;for(e=0;i>e;e++)if(this.dialogs[e].name==t)return this.dialogs[e]},removeDialog:function(t){var e=0,i=this.dialogs.length;for(e=i-1;e>=0;e--)if(this.dialogs[e].name==t){this.dialogs.splice(e,1),this.activeDialog=this.dialogs[this.dialogs.length-1];break}},updateActiveDialog:function(){var t,e=this.dialogs.length;for(t=e-1;t>=0;t--)if(!this.dialogs[t].isHidden){this.activeDialog=this.dialogs[t];break}},updateShadow:function(){this.activeDialog&&!this.activeDialog.isHidden?(this.backShadow.insertBefore(this.activeDialog.entity),this.activeDialog.updateFixed()):this.backShadow.hidden()},close:function(t){if(!t)return void(this.activeDialog&&this.activeDialog.close());var e,i=this.dialogs.length;for(e=i-1;e>=0;e--)if(this.dialogs[e].name==t){this.dialogs[e].close();break}}},BackShadow=function(t){this.entity=null,this.isShow=!1,this._ie6Fixed=function(){e.entity&&(e.entity.style.top=document.documentElement.scrollTop+"px",e.entity.style.left=document.documentElement.scrollLeft+"px",e.ifm&&(e.ifm.style.top=e.entity.style.top,e.ifm.style.left=e.entity.style.left),e.updateSize())};var e=this;!function(){e.entity=$C("div"),e.entity.style.position="absolute",e.entity.style.width=e.getAreaWidth()+"px",e.entity.style.height=e.getAreaHeight()+"px",e.entity.style.left="0px",e.entity.style.top="0px",e.entity.style.zIndex=1024,e.entity.style.backgroundColor="black",document.body.appendChild(e.entity),e._setOpacity(e.entity,isNaN(t)?.5:t),$IE6&&(e.entity.style.top=document.documentElement.scrollTop+"px",e.addIframe()),Core.Events.addEvent(window,function(){e.entity&&($IE6&&e.isShow&&(document.documentElement.scrollLeft=0,e._ie6Fixed()),setTimeout(function(){e.updateSize()},1))},"resize"),e.setFixed(!0),e.hidden()}()};BackShadow.prototype={show:function(){this.entity.style.display="",this.ifm&&(this.ifm.style.display=""),this.isShow=!0,this.onShow()},hidden:function(){this.entity.style.display="none",this.ifm&&(this.ifm.style.display="none"),this.isShow=!1,this.onHidden()},close:function(){this.hidden(),this.destroy()},destroy:function(){Core.Events.removeEvent(window,this._ie6Fixed,"scroll"),this.entity.parentNode.removeChild(this.entity),this.entity=null,this.ifm&&(this.ifm.parentNode.removeChild(this.ifm),this.ifm=null)},addIframe:function(){this.ifm=$C("iframe"),this._setOpacity(this.ifm,0),this.ifm.style.position="absolute",this.ifm.style.zIndex=this.entity.style.zIndex,this.ifm.style.left=this.entity.style.left,this.ifm.style.top=this.entity.style.top,this.ifm.style.width=this.entity.style.width,this.ifm.style.height=this.entity.style.height,document.body.insertBefore(this.ifm,this.entity)},insertBefore:function(t){document.body.insertBefore(this.entity,t),this.ifm&&document.body.insertBefore(this.ifm,this.entity)},updateSize:function(){this.entity.style.width=this.getAreaWidth()+"px",this.entity.style.height=this.getAreaHeight()+"px",this.ifm&&(this.ifm.style.width=this.getAreaWidth()+"px",this.ifm.style.height=this.getAreaHeight()+"px")},getAreaHeight:function(){return document.documentElement.clientHeight},getAreaWidth:function(){return document.documentElement.clientWidth},setFixed:function(t){if($IE6){var e=this;t?(e._ie6Fixed(),Core.Events.addEvent(window,e._ie6Fixed,"scroll")):Core.Events.removeEvent(window,e._ie6Fixed,"scroll")}else this.entity.style.position=t?"fixed":"absolute"},_setOpacity:function(t,e){$IE&&$IE<=9?t.style.filter="alpha(opacity="+100*e+")":t.style.opacity=e},onShow:function(){},onHidden:function(){}},CustomsDialog.prototype={isSetMiddle:!1,setContent:function(t){var e=t;this.templateString=e.match(this.nodesPattern);var i=new Ui.Template(e);this.nodes.content.innerHTML=i.evaluate(this.getContentNodes("i")),this.updateNodes()},setTitle:function(t){this.nodes.titleName&&(this.nodes.titleName.innerHTML=t)},setHelp:function(t){this.nodes.btnHelp&&(t?this.nodes.btnHelp.href=t:this.nodes.btnHelp.innerHTML="")},setClose:function(t){var e=this;if(e.nodes.btnClose)switch(t=t||"hidden"){case"hidden":Core.Events.addEvent(e.nodes.btnClose,e._hiddenDialog,"click");break;case"close":Core.Events.addEvent(e.nodes.btnClose,e._closeDialog,"click")}},setPosition:function(t,e){this._dialog.setPosition({x:t,y:e})},setMiddle:function(){var t,e,i=Core.System.winSize(),n=this._dialog.entity.style.display;this._dialog.setPosition({x:-1e4}),this._dialog.entity.style.display="";var o=this.nodes.titleBar?this.nodes.titleBar.offsetHeight:0,s=i.height-this.nodes.content.offsetHeight-o,a=(Math.sqrt(5)-1)/2,r=1,l=s*a/(a+r);t=i.width/2-this.nodes.content.offsetWidth/2,t=0>t?0:t,e=0>l?0:l,this._dialog.getProperty().isFixed||(t+=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),e+=Math.max(document.documentElement.scrollTop,document.body.scrollTop)),this._dialog.entity.style.display=n,this._dialog.setPosition({x:t,y:e}),this.isSetMiddle=!0},setSize:function(t,e){this._dialog.setSize({width:t,height:e})},setFixed:function(t){this._dialog.setFixed(t)},setAreaLocked:function(t){this._dialog.setAreaLocked(t)},setFocusNode:function(t){this._dialog.getProperty().focusNode=t},setDisplayMode:function(t){this._dialog.getProperty().displayMode=t||"normal"},getWidth:function(){return this._dialog.getProperty().width},getHeight:function(){return this._dialog.getProperty().height},getX:function(){return this._dialog.getProperty().x},getY:function(){return this._dialog.getProperty().y},show:function(){this.isSetMiddle&&this.setMiddle(),this._dialog.show(),this.onShow()},hidden:function(){this._dialog.hidden(),this.onHidden()},close:function(){var t=this;t._dialog.close(),t.onClose(),t.nodes.btnClose&&(Core.Events.removeEvent(t.nodes.btnClose,t._hiddenDialog,"click"),Core.Events.removeEvent(t.nodes.btnClose,t._CloseDialog,"click"))},updateNodes:function(){this.nodes=this._dialog.getNodes();var t=this.getContentNodes();for(k in t)this.nodes[k]=t[k]},getContentNodes:function(t){var e,i=t||"o",n={},o=this.templateString;if(o)for(e=0;e<o.length;e++){var s=o[e];switch(i){case"o":n[s]=$E(this.nodes.content.id+"_"+s);break;case"i":n[s]=this.nodes.content.id+"_"+s}}return n},setOnDisplaied:function(t){this._dialog.onDisplaied=t},setOnDisplayFinished:function(t){this._dialog.onDisplayFinished=t},onDrag:function(){},onShow:function(){},onHidden:function(){},onClose:function(){}};var LayerTemplate={alert:\'<table id="#{entity}"  class="gModLy"><thead id="#{titleBar}"><tr><td class="tbgleft"><div></div></td><td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div><div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td><td class="tbgright"><div></div></td></tr></thead><tfoot><tr><td class="tbgleft"><div></div></td><td class="tdmain"></td><td class="tbgright"><div></div></td></tr></tfoot><tbody><tr><td class="tbgleft"><div></div></td><td class="tdmain" id="layer_2"><div id="#{content}" class="gModLyCont"><!-- 内容区域 --><div class="gDialogDoc"><div class="diaBd"><div class="gDiaC1"><img id="#{icon}" width="50" height="50" class="" src="http://simg.sinajs.cn/tiezi/images/icon/icon.gif" alt=""/></div><div class="gDiaC2"><h5 id="#{text}"></h5><div id="#{subText}"></div><p/></div></div><div class="btnRow"><a class="gBtnb gBtnbClr" id="#{linkOk}" href="javascript:;"><cite id="#{btnOk}"><em id="#{ok}"></em></cite></a></div></div><!-- 内容区域 --></div></td><td class="tbgright"><div></div></td></tr></tbody></table>\',confirm:\'<table id="#{entity}"  class="gModLy"><thead id="#{titleBar}"><tr><td class="tbgleft"><div></div></td><td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div><div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td><td class="tbgright"><div></div></td></tr></thead><tfoot><tr><td class="tbgleft"><div></div></td><td class="tdmain"></td><td class="tbgright"><div></div></td></tr></tfoot><tbody><tr><td class="tbgleft"><div></div></td><td class="tdmain" id="layer_2"><div id="#{content}" class="gModLyCont"><!-- 内容开始 --><div class="gDialogDoc"><div class="diaBd"><div class="gDiaC1"><img id="#{icon}" width="50" height="50" class="" src="http://simg.sinajs.cn/tiezi/images/icon/icon.gif" alt=""/></div><div class="gDiaC2"><h5 id="#{text}"></h5><div id="#{subText}"></div><p/></div></div><div class="btnRow"><a class="gBtnb gBtnbClr" id="#{linkOk}" href="javascript:;"><cite id="#{btnOk}"><em id="#{ok}"></em></cite></a><a class="gBtnb gBtnbClr" id="#{linkCancel}" href="javascript:;"><cite id="#{btnCancel}"><em id="#{cancel}"></em></cite></a></div></div><!-- 内容结束 --></div></td><td class="tbgright"><div></div></td></tr></tbody></table>\',iframe:\'<table id="#{entity}"  class="gModLy"><thead id="#{titleBar}"><tr><td class="tbgleft"><div></div></td><td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div><div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td><td class="tbgright"><div></div></td></tr></thead><tfoot><tr><td class="tbgleft"><div></div></td><td class="tdmain"></td><td class="tbgright"><div></div></td></tr></tfoot><tbody><tr><td class="tbgleft"><div></div></td><td class="tdmain" id="layer_2"><div id="#{content}" class="gModLyCont"><div id="#{loadState}">Loading...</div><iframe style="width:100%;height:500px;" id="#{iframe}" src="#{iframeURL}"></iframe></div></td><td class="tbgright"><div></div></td></tr></tbody></table>\',customs:\'<table id="#{entity}"  class="gModLy"><thead id="#{titleBar}"><tr><td class="tbgleft"><div></div></td><td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div><div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td><td class="tbgright"><div></div></td></tr></thead><tfoot><tr><td class="tbgleft"><div></div></td><td class="tdmain"></td><td class="tbgright"><div></div></td></tr></tfoot><tbody><tr><td class="tbgleft"><div></div></td><td class="tdmain" id="layer_2"><div id="#{content}" class="gModLyCont"><!-- 内容区域 --><!-- 内容区域 --></div></td><td class="tbgright"><div></div></td></tr></tbody></table>\'};!function(){var t=function(t,e){this.template=e||{},DialogManager.backShadow=t};t.prototype={iconSet:{"01":{"class":"SG_icon SG_icon201",alt:"警告"},"02":{"class":"SG_icon SG_icon202",alt:"失败"},"03":{"class":"SG_icon SG_icon203",alt:"成功"},"04":{"class":"SG_icon SG_icon204",alt:"询问"},"06":{"class":"SG_icon SG_icon148",alt:"警告"}},alert:function(t,e,i){e=e||{};var n=DialogManager.create(e.template||this.template.alert||LayerTemplate.alert,i),o=(Core.System.winSize(),n.getNodes());n.onDisplaied=e.funcDisplaied,n.onDisplayFinished=e.funcDisplayFinished,n.setSize({width:e.width,height:e.height}),n.setFixed(!0),this._setDialogMiddle(n),n.show(),n.setAreaLocked(!0),o.linkOk.focus(),o.text.innerHTML=t,o.titleName&&(o.titleName.innerHTML=e.title||"提示"),o.icon&&(o.icon.className=e.icon?this.iconSet[e.icon]["class"]:this.iconSet["01"]["class"],o.icon.alt=e.icon?this.iconSet[e.icon].alt:this.iconSet["01"].alt),o.ok.innerHTML=e.textOk||"确定",o.subText&&(o.subText.innerHTML=e.subText||""),n.getProperty().focusNode=o.linkOk,Core.Events.addEvent(o.btnOk,function(){return e.funcOk&&n.getProperty().enabled&&(e.funcOk(),Core.Events.stopEvent()),n.close(),!1},"click"),Core.Events.addEvent(o.linkOk,function(){var t=Core.Events.getEvent();"13"==t.keyCode&&(e.funcOk&&n.getProperty().enabled&&e.funcOk(),n.close())},"keydown"),Core.Events.addEvent(o.btnClose,function(){e.funcClose&&n.getProperty().enabled&&e.funcClose(),n.close()},"click"),Core.Events.addEvent(o.btnClose,function(){var t=Core.Events.getEvent();t.cancelBubble=!0},"mousedown")},newAlert:function(t,e,i){e.template=this.template.newAlert,this.alert(t,e,i)},confirm:function(t,e,i){e=e||{};var n=DialogManager.create(e.template||this.template.confirm||LayerTemplate.confirm,i),o=(Core.System.winSize(),n.getNodes());n.onDisplaied=e.funcDisplaied,n.onDisplayFinished=e.funcDisplayFinished,n.setSize({width:e.width,height:e.height}),n.setFixed(!0),this._setDialogMiddle(n),n.show(),n.setAreaLocked(!0),0==e.defaultButton?(o.linkCancel.focus(),n.getProperty().focusNode=o.linkCancel):(o.linkOk.focus(),n.getProperty().focusNode=o.linkOk),o.text.innerHTML=t,o.titleName&&(o.titleName.innerHTML=e.title||"提示"),o.icon&&(o.icon.className=e.icon?this.iconSet[e.icon]["class"]:this.iconSet["04"]["class"],o.icon.alt=e.icon?this.iconSet[e.icon].alt:this.iconSet["04"].alt),o.ok.innerHTML=e.textOk||"确定",o.cancel.innerHTML=e.textCancel||"取消",o.subText&&(o.subText.innerHTML=e.subText||""),Core.Events.addEvent(o.btnOk,function(){return e.funcOk&&n.getProperty().enabled&&(e.funcOk(),Core.Events.stopEvent()),n.close(),!1\n},"click"),Core.Events.addEvent(o.linkOk,function(){var t=Core.Events.getEvent();"13"==t.keyCode&&(e.funcOk&&n.getProperty().enabled&&e.funcOk(),n.close())},"keydown"),Core.Events.addEvent(o.btnCancel,function(){return e.funcCancel&&n.getProperty().enabled&&(e.funcCancel(),Core.Events.stopEvent()),n.close(),!1},"click"),Core.Events.addEvent(o.linkCancel,function(){var t=Core.Events.getEvent();"13"==t.keyCode&&(e.funcCancel&&n.getProperty().enabled&&e.funcCancel(),n.close())},"keydown"),Core.Events.addEvent(o.btnClose,function(){return e.funcClose&&n.getProperty().enabled&&(e.funcClose(),Core.Events.stopEvent()),n.close(),!1},"click"),Core.Events.addEvent(o.btnClose,function(){var t=Core.Events.getEvent();t.cancelBubble=!0},"mousedown")},newConform:function(t,e,i){e.template=this.template.newConfirm,this.confirm(t,e,i)},showIframe:function(t,e){t=t||{};var i=DialogManager.create(this.template.iframe||LayerTemplate.iframe,e),n=Core.System.winSize(),o=i.getNodes();i.setSize({width:t.width||320,height:t.height||150});var s=n.width/2-i.getProperty().width/2<0?0:n.width/2-i.getProperty().width/2,a=n.height/2-i.getProperty().height/2<0?0:n.height/2-i.getProperty().height/2;i.setPosition(t.fixed?{x:s,y:a}:{x:s+document.documentElement.scrollLeft,y:a+document.documentElement.scrollTop}),$IE6||(i.getProperty().displayMode="alpha"),i.setFixed(!!t.fixed),i.show(),i.setAreaLocked(!0),o.titleName.innerHTML=t.title||"",o.iframe.src=t.url||"about:blank",Core.Events.addEvent(o.iframe,function(){o.iframe.style.display="",o.loadState.style.display="none"},"load"),Core.Events.addEvent(o.btnClose,function(){i.close()},"click"),Core.Events.addEvent(o.btnClose,function(){var t=Core.Events.getEvent();t.cancelBubble=!0},"mousedown")},createCustomsDialog:function(t,e){t=t||{};var i=new CustomsDialog(t.tpl||this.template.customs||LayerTemplate.customs,e);return t.content&&i.setContent(t.content),i.setTitle(t.title||"提示"),i.setHelp(t.help||""),i.setClose("hidden"),i.setOnDisplaied(t.funcDisplaied),i.setOnDisplayFinished(t.funcDisplayFinished),i},getDialog:function(t){return DialogManager.getDialog(t)},close:function(t){DialogManager.close(t)},_setDialogMiddle:function(t){var e,i,n=Core.System.winSize(),o=t.getNodes(),s=t.entity.style.display;t.setPosition({x:-1e4}),t.entity.style.display="";var a=o.titleBar?o.titleBar.offsetHeight:0,r=n.height-o.content.offsetHeight-a,l=(Math.sqrt(5)-1)/2,c=1,d=r*l/(l+c);e=n.width/2-o.content.offsetWidth/2,e=0>e?0:e,i=0>d?0:d,t.getProperty().isFixed||(e+=document.documentElement.scrollLeft,i+=document.documentElement.scrollTop),t.entity.style.display=s,t.setPosition({x:e,y:i})}},Sina.Ui.WindowDialog=t}(),Core.String.decodeHTML=function(t){var e=document.createElement("div");return e.innerHTML=t,void 0==e.innerText?e.textContent:e.innerText},$registJob("editor_initSendArticle",function(){function t(t){window.location.href="http://blog.sina.com.cn/s/blog_"+t.data+".html"}function e(){var t="http://interface.blog.sina.com.cn/riaapi/checkwd_image.php",i=[\'<table id="#{entity}" class="CP_w">\',\'<thead id="#{titleBar}">\',"<tr>",\'<th class="tLeft"><span></span></th>\',\'<th class="tMid">\',\'<div class="bLyTop">\',\'<strong id="#{titleName}"></strong>\',\'<cite><a title="关闭" class="CP_w_shut"  id="#{btnClose}" href="javascript:;">关闭</a></cite>\',"</div>","</th>",\'<th class="tRight"><span></span></th>\',"</tr>","</thead>","<tfoot>","<tr>",\'<td class="tLeft"><span></span></td>\',\'<td class="tMid"><span></span></td>\',\'<td class="tRight"><span></span></td>\',"</tr>","</tfoot>","<tbody>","<tr>",\'<td class="tLeft"><span></span></td>\',\'<td class="tMid">\',\'<div class="" style="width:auto;" id="#{content}">\',"</div>","</td>",\'<td class="tRight"><span></span></td>\',"</tr>","</tbody>","</table>"].join(""),n=\'<div class="CP_layercon2">\t\t\t\t\t\t<div class="CP_prompt">\t\t\t\t\t\t<img class="SG_icon SG_icon201" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="50" height="50" align="absmiddle" />\t\t\t\t\t\t<table class="CP_w_ttl CP_m"><tr>\t\t\t\t\t\t  <td >请输入验证码......</td>\t\t\t\t\t\t</tr></table>\t\t\t\t\t\t<ul class="CP_w_part SG_txtb">\t\t\t\t\t\t\t<li class="mb">填写验证码后可继续操作</li>\t\t\t                <li><span class="a">验证码：</span><span class="b"><input name="checkword" id="xssSafeCodeDiag_checkword" type="text" class="SG_input" style="width:75px;" />  <a href="javascript:scope.xssSafeCodeDiag.changeSafeCode();void(0);"><img id="xssSafeCodeDiag_safeimg"  src="http://simg.sinajs.cn/blog7style/images/common/yzm1.gif" width="58" height="20" align="absmiddle" /></a> <a href="javascript:scope.xssSafeCodeDiag.changeSafeCode();void(0);">换一个</a></span></li>\t\t\t\t\t\t</ul>\t\t\t\t\t\t<p class="CP_w_btns_Mid"><a class="SG_aBtn SG_aBtnB" id="xssSafeCodeDiag_okbtn" href="javascript:scope.xssSafeCodeDiag.ok();void(0);"><cite> 确定 </cite></a>&nbsp;&nbsp;<a class="SG_aBtn SG_aBtnB" id="xssSafeCodeDiag_cancelbtn"  href="javascript:scope.xssSafeCodeDiag.cancel();void(0);"><cite> 取消 </cite></a></p>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\';"undefined"==typeof scope.xssSafeCodeDiag&&(scope.xssSafeCodeDiag=winDialog.createCustomsDialog({tpl:i,title:"提示",content:n,width:400,height:210,funcDisplayFinished:function(){}},"note"),scope.xssSafeCodeDiag.changeSafeCode=function(){$E("xssSafeCodeDiag_checkword").value="",$E("xssSafeCodeDiag_safeimg").src=t+"?r="+Math.random()},scope.xssSafeCodeDiag.ok=function(){var t=$E("xssSafeCodeDiag_checkword").value;if(""===t)return scope.xssSafeCodeDiag.hidden(),void winDialog.alert("请输入验证码。",{textOk:"确定",icon:"01",funcOk:function(){winDialog.close(),e()}});if("undefined"==typeof $E("editorForm").checkword||null==$E("editorForm").checkword){var i=document.createElement($IE?\'<input value="\'+t+\'" type="hidden" name="checkword" />\':"input");$E("editorForm").appendChild(i),i.name="checkword",i.type="hidden",i.value=t}$E("editorForm").submit(),scope.xssSafeCodeDiag.hidden(),$E("editorForm").removeChild($E("editorForm").checkword),$E("editorForm").checkword=null},scope.xssSafeCodeDiag.cancel=function(){scope.xssSafeCodeDiag.hidden()},Core.Events.addEvent($E("xssSafeCodeDiag_checkword"),function(){"undefined"==typeof scope.xssSafeCodeDiag.keydownFn&&(scope.xssSafeCodeDiag.keydownFn=function(t){t=t||window.event;var e=t.keyCode||t.charCode;"13"==e&&scope.xssSafeCodeDiag.ok()},Core.Events.addEvent($E("xssSafeCodeDiag_checkword"),scope.xssSafeCodeDiag.keydownFn,"keydown"))},"focus"),Core.Events.addEvent($E("xssSafeCodeDiag_checkword"),function(){"undefined"!=typeof scope.xssSafeCodeDiag.keydownFn&&(Core.Events.removeEvent($E("xssSafeCodeDiag_checkword"),scope.xssSafeCodeDiag.keydownFn,"keydown"),scope.xssSafeCodeDiag.keydownFn=null)},"blur")),scope.xssSafeCodeDiag.show(),scope.xssSafeCodeDiag.setMiddle(),scope.xssSafeCodeDiag.changeSafeCode()}function i(t){v7sendLog("48_01_26");var e="http://blog.sina.com.cn/s/blog_"+t.data+".html",i="http://sina.allyes.com/main/adfclick?db=sina&bid=204720,574361,579621&cid=0,0,0&sid=581984&advid=358&camid=37389&show=ignore&url=http://e.weibo.com/1795839430/app_3089170920?key=from_blog",n="http://sina.allyes.com/main/adfclick?db=sina&bid=204720,574363,579623&cid=0,0,0&sid=581986&advid=358&camid=37389&show=ignore&url=http://e.weibo.com/1795839430/app_3089170920?key=from_blog";winDialog.confirm($SYSMSG.B06012,{icon:"03",width:300,textOk:"知道了",textCancel:"去看看",defaultButton:0,funcOk:function(){v7sendLog("48_01_41"),$E("upColorSprite").checked?o("iknow"):setTimeout(function(){location.href=e},1e3)},funcClose:function(){$E("upColorSprite").checked?o("iknow"):window.location.href=e},funcCancel:function(){v7sendLog("48_01_42"),$E("upColorSprite").checked?o("see"):s()},subText:\'这是一篇跟快乐有关的博文。<br/><input id="upColorSprite" type="checkbox" checked/>投稿到可口可乐圈？<br/><a style="color:red" href="\'+i+\'" target="_blank">去活动站看看，惊喜奖品等你来拿</a>\'});var o=function(i){var i=i||"iknow",n=50,o=$E("SinaEditor_Iframe").children[0].contentWindow.document,a=o.getElementsByTagName("img")[0],r=a?a.src:"",l=Core.String.decodeHTML(o.body.innerHTML);Core.String.byteLength(l)>n&&(l=Core.String.leftB(l,n)),Utils.Io.Ijax.request("http://happiness.sinaapp.com/services/blogsync",{POST:{url:encodeURIComponent("http://blog.sina.com.cn/s/blog_"+t.data+".html"),uid:scope.$uid,title:encodeURIComponent(""==$E("articleTitle").value?Comment.formatTime():$E("articleTitle").value),nick:encodeURIComponent(scope.nickname),"abstract":l?encodeURIComponent(l):"",img:encodeURIComponent(r)},onComplete:function(){},onError:function(){}}),"iknow"===i?setTimeout(function(){location.href=e},1e3):"see"===i&&s()},s=function(){window.open(n),setTimeout(function(){location.href=e},1e3)}}function n(){var t={},e=scope.filmData;t.film_id=e.id,t.type="movie"==scope.filmType?2:1,t.film_name=e.title,t.film_poster=e.picture,t.film_url="http://data.ent.sina.com.cn/"+scope.filmType+"/"+e.id+".html";for(var i=document.getElementsByName("filmRecord"),n=null,o=0,s=i.length;s>o;o++)if(i[o].checked){n=i[o].value;break}t.film_record=n||3,t.film_official=e.official||"";var a=[];for(var r in t)a.push(\'"\'+r+\'":"\'+t[r]+\'"\');a="{"+a.join(",")+"}",$E("film").value=a}window.editor_Timer=0,$E("xRankRadio")&&(Core.Events.addEvent($E("componentSelect"),function(){$E("xRankRadio").checked="0"==$E("componentSelect").value?!0:!1},"change"),Core.Events.addEvent($E("xRankRadio"),function(){$E("componentSelect").selectedIndex=$E("xRankRadio").checked?$E("componentSelect").length-1:"0"},"click")),window.articlePostBtnFunc=function(){function o(t,e){var i=Core.String.expand(t);return i.length>e&&(i=i.substr(0,e)),i=Core.String.collapse(i)}var s=$E("blog_body"),a=s.value,r=Core.String.trim(a);if(""==r||"快说两句吧，让更多的博友也分享我看过的电影。"==r)return void winDialog.alert("请输入内容。");a=a.replace(/<br\\s*\\/?>/g,"{#sina_text_n_tag}"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/\\n/g,"<br/>"),a=a.replace(/{#sina_text_n_tag}/g,"<br/>"),a=a.replace(/\\s/g,"&nbsp;"),s.id="old_blog_body",s.name="old_blog_body";var l;if($IE?l=document.createElement(\'<textarea id="blog_body" name="blog_body"></textarea>\'):(l=document.createElement("textarea"),l.id="blog_body",l.name="blog_body"),l.style.display="none",s.parentNode.insertBefore(l,s),l.value=a,s=null,l=null,!window.isSended){window.isSended=!0,n(),scope.cIFM("fileFrame");var c;c=arguments[0]&&arguments[0].hiddenTip?arguments[0].hiddenTip:function(){};var d;d=arguments[0]&&arguments[0].callback?arguments[0].callback:function(t){var e,i="1"==scope.$private.isprivate,n="0"===$E("componentSelect").value;try{var o=new Function("return "+decodeURIComponent(Utils.Cookie.getCookie("wl_internalState")))();e=o.wl_cid,trace("获取wl_internalState_cid cookies成功")}catch(s){trace("获取wl_internalState_cid cookies失败！")}!e||i||n?trace("不发送feed，info:"+[e,!i,!n]):(new Interface("http://control.blog.sina.com.cn/riaapi/feed/msn_feed.php","jsload").request({GET:{uid:scope.$uid,title:encodeURIComponent($E("articleTitle").value),link:encodeURIComponent("http://blog.sina.com.cn/s/blog_"+t.data+".html")},onSuccess:function(){}}),trace("有msncookie，发送feed, 放弃使用new image方式"));var a=Core.System.getParam("blog_id")?"博文已修改成功":"博文已发布成功",r=(winDialog.alert(a,{funcOk:function(){setTimeout(function(){window.onbeforeunload=function(){},window.location.href="http://blog.sina.com.cn/s/blog_"+t.data+".html"},1)},textOk:"确定",title:"提示",icon:"03"},"sendArticleSucsessDialog"),winDialog.getDialog("sendArticleSucsessDialog").getNodes().btnClose);Core.Events.addEvent(r,function(){setTimeout(function(){window.onbeforeunload=function(){},window.location.href=window.location.href="http://blog.sina.com.cn/s/blog_"+t.data+".html"},1)},"click")},$E("editorForm").target="fileFrame",$E("editorForm").action=Core.System.getParam("blog_id")?articleEditorCFG.articleEditPostURL:articleEditorCFG.articlePostURL,!$E("articleTagInput")||$E("articleTagInput").value!=articleEditorCFG.dftTagValue&&""!=$E("articleTagInput").value||($E("articleTagInput").value="影评 "+o(scope.filmName,14)||""),$E("articleTitle")&&""==Core.String.trim($E("articleTitle").value)&&($E("articleTitle").value="影评《"+scope.filmName+"》"),Core.Events.addEvent($E("fileFrame"),Core.Function.bind3(scope.tagFunc,this,[$E("fileFrame"),function(n){switch(trace("新发文章,返回状态码: "+n.code),trace("新发文章,返回内容: "+n.data),window.isSended=!1,c(),n.code){case"B66666":{winDialog.alert("服务器临时遇见问题，发博文功能暂时不可用。工程师正在恢复中，请稍后再试。",{funcOk:function(){}.bind2(this),textOk:"确定",title:"提示",icon:"03"},"sendArticleProblemDialog")}break;case"B07006":{winDialog.alert("您已发的博文正在审查中，请稍后再发文",{funcOk:function(){}.bind2(this),textOk:"确定",title:"提示",icon:"03"},"sendArticleSucsessDialog")}break;case"B06001":editor_Timer=(new Date).valueOf(),succ_code="B06001",d(n);break;case"B02005":{winDialog.confirm($SYSMSG.B02005,{funcOk:function(){var t=$C("input");t.id="feifa",t.name="check",t.value="no",t.type="hidden",$E("editorForm").appendChild(t),articlePostBtnFunc()},funcCancel:function(){var t=$E("feifa");t&&$E("editorForm").removeChild(t)},textOk:"确定",textCancel:"取消",title:"提示",icon:"02"})}break;case"B06002":if((new Date).valueOf()-editor_Timer<6e4)return void showError("B08001");editor_Timer=(new Date).valueOf(),showError(n.code);break;case"B06004":if((new Date).valueOf()-editor_Timer<6e4)return void showError("B08001");editor_Timer=(new Date).valueOf(),showError(n.code);break;case"B06011":t(n);break;case"B06013":e(n);break;case"B06014":safeCodeErr(n);break;case"B06012":i(n);break;case"B07001":winDialog.confirm($SYSMSG.B07001,{ico:"03",btn:[{label:"是",focus:!0,func:function(){articlePostBtnFunc(),$E("editorForm").submit()}},{label:"否"}],close:!1});break;case"A00004":(new Lib.Login.Ui).login(articlePostBtnFunc,!0);break;case"B00905":case"B00907":case"B00908":case"B00909":case"B00906":showError(n.code);break;case"B00010":winDialog.alert("无权限。",{funcOk:function(){Lib.checkAuthor(),window.location.href="http://control.blog.sina.com.cn/myblog/htmlsource/blog_notopen.php?uid="+$UID+"&version=7"}.bind2(this),textOk:"确定",title:"提示",icon:"01"});break;default:showError(n.code)}}]),"load"),$E("editorForm").submit()}},Core.Events.addEvent($E("sendBtn1"),articlePostBtnFunc,"click")}),$registJob("loginStatus",function(){Lib.checkAuthor();var t=Utils.Cookie.getCookie,e=Utils.Cookie.setCookie,i=t("_s_loginStatus"),n=t("_s_loginuid");if($isLogin){if(n===$UID)return}else if(!i||i===n)return;e("_s_loginuid",$UID||i,24-(new Date).getHours(),"","blog.sina.com.cn");var o="http://control.blog.sina.com.cn/blog_rebuild/riaapi/padblog/padInfo.php?rnd="+Math.random();Utils.Io.JsLoad.request(o,{onComplete:function(){},onException:function(){}})}),window!=parent&&(parent.location.href=window.location.href);',
  map: 'null' }
2854 'ms'
